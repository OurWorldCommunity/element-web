/*! For license information please see vendors~element-web-app.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1401:function(e,t,a){"use strict";(function(e){var t=a(107);if(e.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");let n;e.__js_sdk_entrypoint=!0;try{n=e.indexedDB}catch(e){}n&&t.setCryptoStoreFactory((function(){return new t.IndexedDBCryptoStore(n,"matrix-js-sdk:crypto")}));e.matrixcs=t}).call(this,a(30))},1402:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(1),s=a(92),o=a(94),c=a(302);var l;!function(e){e.Online="online",e.Offline="offline",e.Unavailable="unavailable"}(l||(l={}));t.a=new class{constructor(){i()(this,"unavailableTimer",null),i()(this,"dispatcherRef",null),i()(this,"state",null),i()(this,"onAction",e=>{"user_activity"===e.action&&(this.setState(l.Online),this.unavailableTimer.restart())})}async start(){for(this.unavailableTimer=new c.a(18e4),this.dispatcherRef=o.a.register(this.onAction);this.unavailableTimer;)try{await this.unavailableTimer.finished(),this.setState(l.Unavailable)}catch(e){}}stop(){this.dispatcherRef&&(o.a.unregister(this.dispatcherRef),this.dispatcherRef=null),this.unavailableTimer&&(this.unavailableTimer.abort(),this.unavailableTimer=null)}getState(){return this.state}async setState(e){if(e===this.state)return;const t=this.state;if(this.state=e,!s.a.get().isGuest())try{await s.a.get().setPresence({presence:this.state}),r.a.info("Presence:",e)}catch(e){r.a.error("Failed to set presence:",e),this.state=t}}}},1403:function(e,t){e.exports="fonts/Twemoji_Mozilla/TwemojiMozilla-colr.59b896a.woff2"},1404:function(e,t){e.exports="fonts/Twemoji_Mozilla/TwemojiMozilla-sbix.cebcdf9.woff2"},1405:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 3.05v6.22C2 15.63 9 17 9 17s7-1.37 7-7.73V3.05L9 1 2 3.05zm9.94 2.47c.19-.18.49-.17.67.02.16.18.16.45.02.63l-4.22 5.11-.03.04c-.28.34-.79.39-1.13.11a.29.29 0 01-.077-.067.912.912 0 00-.023-.023L5.34 9.26c-.2-.24-.18-.6.06-.8.2-.18.49-.18.7-.04l1.57 1.1 4.27-4z",fill:"#010101"})))}t.default="img/e2e/verified-deprecated.5be6c9f.svg"},1406:function(e,t,a){"use strict";t.a={}},1407:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(123),s=a(91),o=a(100);t.a=e=>{const t=o.b.get().brand,a=Object(s.a)("%(brand)s now uses 3-5x less memory, by only loading information about other users when needed. Please wait whilst we resynchronise with the server!",{brand:t});return i.a.createElement(r.a,{hasCancelButton:!1,title:Object(s.a)("Updating %(brand)s",{brand:t}),description:i.a.createElement("div",null,a),button:Object(s.a)("OK"),onFinished:e.onFinished})}},1408:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(123),s=a(91),o=a(100);t.a=e=>{const t=o.b.get().brand,a=Object(s.a)("You've previously used %(brand)s on %(host)s with lazy loading of members enabled. In this version lazy loading is disabled. As the local cache is not compatible between these two settings, %(brand)s needs to resync your account.",{brand:t,host:e.host}),n=Object(s.a)("If the other version of %(brand)s is still open in another tab, please close it as using %(brand)s on the same host with both lazy loading enabled and disabled simultaneously will cause issues.",{brand:t});return i.a.createElement(r.a,{hasCancelButton:!1,title:Object(s.a)("Incompatible local cache"),description:i.a.createElement("div",null,i.a.createElement("p",null,a),i.a.createElement("p",null,n)),button:Object(s.a)("Clear cache and resync"),onFinished:e.onFinished})}},1409:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(100),c=a(97),l=a(91),d=a(123),u=a(250),m=a(105),h=a(115);class p extends s.a.Component{constructor(){super(...arguments),i()(this,"sendBugReport",()=>{c.a.createDialog(u.a,{error:this.props.error})}),i()(this,"onClearStorageClick",()=>{c.a.createDialog(d.a,{title:Object(l.a)("Sign out"),description:s.a.createElement("div",null,Object(l.a)("Sign out and remove encryption keys?")),button:Object(l.a)("Sign out"),danger:!0,onFinished:this.props.onFinished})}),i()(this,"onRefreshClick",()=>{window.location.reload()})}render(){const e=o.b.get().brand,t=s.a.createElement("button",{onClick:this.onClearStorageClick,className:"danger"},Object(l.a)("Clear Storage and Sign Out"));let a;return a=o.b.get().bug_report_endpoint_url?s.a.createElement(h.a,{primaryButton:Object(l.a)("Send Logs"),onPrimaryButtonClick:this.sendBugReport,focus:!0,hasCancel:!1},t):s.a.createElement(h.a,{primaryButton:Object(l.a)("Refresh"),onPrimaryButtonClick:this.onRefreshClick,focus:!0,hasCancel:!1},t),s.a.createElement(m.a,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:Object(l.a)("Unable to restore session"),contentId:"mx_Dialog_content",hasCancel:!1},s.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},s.a.createElement("p",null,Object(l.a)("We encountered an error trying to restore your previous session.")),s.a.createElement("p",null,Object(l.a)("If you have previously used a more recent version of %(brand)s, your session may be incompatible with this version. Close this window and return to the more recent version.",{brand:e})),s.a.createElement("p",null,Object(l.a)("Clearing your browser's storage may fix the problem, but will sign you out and cause any encrypted chat history to become unreadable."))),a)}}},1410:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(100),c=a(97),l=a(91),d=a(105),u=a(115),m=a(250),h=a(93);class p extends s.a.Component{constructor(){super(...arguments),i()(this,"sendBugReport",e=>{e.preventDefault(),c.a.createDialog(m.a,{})}),i()(this,"onSignOutClick",()=>{this.props.onFinished(!0)})}render(){let e;return o.b.get().bug_report_endpoint_url&&(e=Object(l.a)("To help us prevent this in future, please <a>send us logs</a>.",{},{a:e=>s.a.createElement(h.a,{kind:"link_inline",onClick:this.sendBugReport},e)})),s.a.createElement(d.a,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:Object(l.a)("Missing session data"),contentId:"mx_Dialog_content",hasCancel:!1},s.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},s.a.createElement("p",null,Object(l.a)("Some session data, including encrypted message keys, is missing. Sign out and sign in to fix this, restoring keys from backup.")),s.a.createElement("p",null,Object(l.a)("Your browser likely removed this data when running low on disk space.")," ",e)),s.a.createElement(u.a,{primaryButton:Object(l.a)("Sign out"),onPrimaryButtonClick:this.onSignOutClick,focus:!0,hasCancel:!1}))}}},1411:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({viewBox:"-1 -1 13 13",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("g",{stroke:"#4A4A4A",strokeWidth:2.82,strokeLinecap:"square",fill:"none",fillRule:"evenodd"},i.createElement("path",{d:"M6 2.229V9.77M2.229 6H9.77"}))))}t.default="img/plus.53bc1d6.svg"},1412:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return We}));var n=a(101),i=a.n(n),r=a(6),s=a.n(r),o=a(90),c=a.n(o),l=a(107),d=a(209),u=a(260),m=a(7),h=a(1),p=a(116),g=a(145),v=(a(1413),a(1414),a(127)),f=a(839),b=a(92),y=a(124),E=a(100),_=a(94),w=a(243),S=a(97),O=a(199),C=a(255),x=a(428),k=(a(1415),a(1428),a(388)),j=a(187),R=a(91),I=a(95),T=a(574),N=a(848),D=a(346),P=a(1429),M=a(320),A=a(133),L=a(427),U=a(575),F=a(351),B=a(165),V=a(394),z=a(1523),W=a(98),H=a(865),G=a(572),q=a(112),K=a(184),Y=a(106),J=a(835),$=a(126),Q=a(1492),X=a(1493),Z=a(433),ee=a(194),te=a(156),ae=a(266),ne=a(104),ie=a(123),re=a(1524),se=a(528),oe=a(600),ce=a(1501),le=a(1529),de=a(1502),ue=a(1532),me=a(1533),he=a(1534),pe=a(1535),ge=a(1536),ve=a(435),fe=a(1511),be=a(1537),ye=a(163),Ee=a(1538),_e=a(135),we=a(152),Se=a(166),Oe=a(544),Ce=a(154),xe=a(221),ke=a(93),je=a(331),Re=a(16),Ie=a(450),Te=a(249),Ne=a(151),De=a(143),Pe=a(109),Me=a(1530),Ae=a(186),Le=a(130),Ue=a(1512),Fe=a(235);function Be(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const Ve=["register","login","forgot_password","start_sso","start_cas","welcome"],ze=[W.a.ViewUserSettings,"view_create_chat","view_create_room"];class We extends c.a.PureComponent{constructor(t){if(super(t),s()(this,"firstSyncComplete",!1),s()(this,"firstSyncPromise",void 0),s()(this,"screenAfterLogin",void 0),s()(this,"tokenLogin",void 0),s()(this,"accountPassword",void 0),s()(this,"accountPasswordTimer",void 0),s()(this,"focusComposer",void 0),s()(this,"subTitleStatus",void 0),s()(this,"prevWindowWidth",void 0),s()(this,"voiceBroadcastResumer",void 0),s()(this,"loggedInView",void 0),s()(this,"dispatcherRef",void 0),s()(this,"themeWatcher",void 0),s()(this,"fontWatcher",void 0),s()(this,"stores",void 0),s()(this,"onWindowResized",()=>{this.warnInConsole()}),s()(this,"warnInConsole",Object(p.throttle)(()=>{const t=Object(R.a)("Wait!"),a=Object(R.a)("If someone told you to copy/paste something here, there is a high likelihood you're being scammed!"),n=Object(R.a)("If you know what you're doing, Element is open-source, be sure to check out our GitHub (https://github.com/vector-im/element-web/) and contribute!");e.mx_rage_logger.bypassRageshake("log",`%c${t}\n%c${a}\n%c${n}`,"font-size:50px; color:blue;","font-size:15px; color:red;","font-size:15px;")},1e3)),s()(this,"onAction",e=>{var t;if(null!==(t=b.a.get())&&void 0!==t&&t.isGuest()&&ze.includes(e.action))return _.a.dispatch({action:W.a.DoAfterSyncPrepared,deferred_action:e}),void _.a.dispatch({action:"require_registration"});switch(e.action){case"MatrixActions.accountData":if("m.identity_server"===e.event_type){const t=e.event_content?e.event_content.base_url:null;t?(b.a.get().setIdentityServerUrl(t),localStorage.removeItem("mx_is_access_token"),localStorage.setItem("mx_is_url",t)):(b.a.get().setIdentityServerUrl(null),localStorage.removeItem("mx_is_access_token"),localStorage.removeItem("mx_is_url")),_.a.dispatch({action:"id_server_changed"})}break;case"logout":Ce.b.instance.hangupAllCalls(),Promise.all([...Te.a.instance.activeCalls].map(e=>e.disconnect())).finally(()=>x.i());break;case"require_registration":Object(N.b)(e);break;case"start_registration":if(x.g()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.startRegistration(e.params||{});break;case"start_login":if(x.g()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.viewLogin();break;case"start_password_recovery":this.setStateForNewView({view:je.a.FORGOT_PASSWORD}),this.notifyNewScreen("forgot_password");break;case"start_chat":Object(j.b)({dmUserId:e.user_id});break;case"leave_room":this.leaveRoom(e.room_id);break;case"forget_room":this.forgetRoom(e.room_id);break;case"copy_room":this.copyRoom(e.room_id);break;case"reject_invite":S.a.createDialog(ie.a,{title:Object(R.a)("Reject invitation"),description:Object(R.a)("Are you sure you want to reject the invitation?"),onFinished:t=>{if(t){const t=S.a.createDialog(ne.a,null,"mx_Dialog_spinner");b.a.get().leave(e.room_id).then(()=>{t.close(),this.state.currentRoomId===e.room_id&&_.a.dispatch({action:W.a.ViewHomePage})},e=>{t.close(),S.a.createDialog(q.a,{title:Object(R.a)("Failed to reject invitation"),description:e.toString()})})}}});break;case"view_user_info":this.viewUser(e.userId,e.subAction);break;case"MatrixActions.RoomState.events":{const t=e.event;t.getType()===l.EventType.RoomCanonicalAlias&&t.getRoomId()===this.state.currentRoomId&&this.viewRoom({action:W.a.ViewRoom,room_id:this.state.currentRoomId,metricsTrigger:void 0});break}case W.a.ViewRoom:{const t=this.viewRoom(e);e.deferred_action&&t.then(()=>{_.a.dispatch(e.deferred_action)});break}case W.a.ViewUserDeviceSettings:Object(Ue.a)(I.b.getValue("feature_new_device_manager"));break;case W.a.ViewUserSettings:{const t=e;S.a.createDialog(re.a,{initialTabId:t.initialTabId},null,!1,!0),this.viewSomethingBehindModal();break}case"view_create_room":this.createRoom(e.public,e.defaultName,e.type),this.viewSomethingBehindModal();break;case W.a.ViewRoomDirectory:S.a.createDialog(oe.a,{initialText:e.initialText},"mx_RoomDirectory_dialogWrapper",!1,!0),this.viewSomethingBehindModal();break;case"view_welcome_page":this.viewWelcome();break;case W.a.ViewHomePage:this.viewHome(e.justRegistered);break;case W.a.ViewStartChatOrReuse:this.chatCreateOrReuse(e.user_id);break;case"view_create_chat":Object(O.f)(e.initialText||""),this.viewSomethingBehindModal();break;case"view_invite":{const t=b.a.get().getRoom(e.roomId);null!=t&&t.isSpaceRoom()?Object(xe.i)(t):Object(O.e)(e.roomId);break}case"view_last_screen":this.showScreenAfterLogin();break;case"hide_left_panel":this.setState({collapseLhs:!0},()=>{this.state.resizeNotifier.notifyLeftHandleResized()});break;case"show_left_panel":this.setState({collapseLhs:!1},()=>{this.state.resizeNotifier.notifyLeftHandleResized()});break;case W.a.OpenDialPad:S.a.createDialog(Q.a,{},"mx_Dialog_dialPadWrapper");break;case W.a.OnLoggedIn:this.stores.client=b.a.get(),this.tokenLogin||x.g()||this.state.view===je.a.LOGIN||this.state.view===je.a.REGISTER||this.state.view===je.a.COMPLETE_SECURITY||this.state.view===je.a.E2E_SETUP||this.state.view===je.a.USE_CASE_SELECTION||this.onLoggedIn();break;case"on_client_not_viable":this.onSoftLogout();break;case W.a.OnLoggedOut:this.onLoggedOut();break;case"will_start_client":this.setState({ready:!1},()=>{this.onWillStartClient()});break;case"client_started":this.onClientStarted();break;case"send_event":this.onSendEvent(e.room_id,e.event);break;case"aria_hide_main_app":this.setState({hideToSRUsers:!0});break;case"aria_unhide_main_app":this.setState({hideToSRUsers:!1});break;case W.a.PseudonymousAnalyticsAccept:Object(H.b)(),I.b.setValue("pseudonymousAnalyticsOptIn",null,Y.a.ACCOUNT,!0);break;case W.a.PseudonymousAnalyticsReject:Object(H.b)(),I.b.setValue("pseudonymousAnalyticsOptIn",null,Y.a.ACCOUNT,!1);break;case W.a.ShowThread:{const{rootEvent:t,initialEvent:a,highlighted:n,scrollIntoView:i,push:r}=e,s={phase:Ne.a.ThreadView,state:{threadHeadEvent:t,initialEvent:a,isInitialEventHighlighted:n,initialEventScrollIntoView:i}};null!=r&&r?De.a.instance.pushCard(s):De.a.instance.setCards([{phase:Ne.a.ThreadPanel},s]),_.a.dispatch({action:W.a.FocusSendMessageComposer,context:Pe.a.Thread});break}}}),s()(this,"handleResize",()=>{const e=ye.b.instance.windowWidth;this.prevWindowWidth<1e3&&e>=1e3&&_.a.dispatch({action:"show_left_panel"}),this.prevWindowWidth>=1e3&&e<1e3&&_.a.dispatch({action:"hide_left_panel"}),this.prevWindowWidth=e,this.state.resizeNotifier.notifyWindowResized()}),s()(this,"onRegisterClick",()=>{this.showScreen("register")}),s()(this,"onLoginClick",()=>{this.showScreen("login")}),s()(this,"onForgotPasswordClick",()=>{this.showScreen("forgot_password")}),s()(this,"onRegisterFlowComplete",(e,t)=>this.onUserCompletedLoginFlow(e,t)),s()(this,"onUpdateStatusIndicator",(e,t)=>{const a=e.numUnreadStates;y.a.get()&&(y.a.get().setErrorStatus(t===d.b.Error),y.a.get().setNotificationCount(a)),this.subTitleStatus="",t===d.b.Error&&(this.subTitleStatus+=`[${Object(R.a)("Offline")}] `),a>0&&(this.subTitleStatus+=`[${a}]`),this.setPageSubtitle()}),s()(this,"onServerConfigChange",e=>{this.setState({serverConfig:e})}),s()(this,"makeRegistrationUrl",e=>(this.props.startingFragmentQueryParams.referrer&&(e.referrer=this.props.startingFragmentQueryParams.referrer),this.props.makeRegistrationUrl(e))),s()(this,"onUserCompletedLoginFlow",async(e,t)=>{this.accountPassword=t,null!==this.accountPasswordTimer&&clearTimeout(this.accountPasswordTimer),this.accountPasswordTimer=setTimeout(()=>{this.accountPassword=null,this.accountPasswordTimer=null},3e5),await x.k(e),await this.postLoginSetup(),be.b.instance.stop(be.a.LOGIN),be.b.instance.stop(be.a.REGISTER)}),s()(this,"onCompleteSecurityE2eSetupFinished",()=>{this.onLoggedIn()}),this.stores=Le.b.instance,this.stores.constructEagerStores(),this.state={view:je.a.LOADING,collapseLhs:!1,hideToSRUsers:!1,syncError:null,resizeNotifier:new P.a,ready:!1},this.loggedInView=Object(o.createRef)(),E.b.put(this.props.config),this.firstSyncComplete=!1,this.firstSyncPromise=Object(m.l)(),this.props.config.sync_timeline_limit&&(b.a.opts.initialSyncLimit=this.props.config.sync_timeline_limit),this.screenAfterLogin=this.props.initialScreenAfterLogin,this.screenAfterLogin){const e=this.screenAfterLogin.params||{};if(this.screenAfterLogin.screen.startsWith("room/")&&e.signurl&&e.email){const t=this.screenAfterLogin.screen.substring("room/".length);J.a.instance.storeInvite(t,e)}}this.prevWindowWidth=ye.b.instance.windowWidth||1e3,ye.b.instance.on(ye.a.Resize,this.handleResize),this.state.resizeNotifier.on("middlePanelResized",this.dispatchTimelineResize),K.a.instance.on(K.b,this.onUpdateStatusIndicator),x.g()&&x.h(),this.accountPassword=null,this.accountPasswordTimer=null,this.dispatcherRef=_.a.register(this.onAction),this.themeWatcher=new L.a,this.fontWatcher=new U.a,this.themeWatcher.start(),this.fontWatcher.start(),this.focusComposer=!1,this.subTitleStatus="",x.g()||x.a(this.props.realQueryParams,this.props.defaultDeviceDisplayName,this.getFragmentAfterLogin()).then(async e=>{var t;if(null!==(t=this.props.realQueryParams)&&void 0!==t&&t.loginToken&&this.props.onTokenLoginCompleted(),e)return this.tokenLogin=!0,await x.j({ignoreGuest:!0}),this.postLoginSetup();const a=this.screenAfterLogin?this.screenAfterLogin.screen:null;return!!await this.loadSession()||("login"!==a&&"register"!==a&&"forgot_password"!==a||this.showScreenAfterLogin(),!1)}),Object(Oe.a)(E.b.get("sentry"))}async postLoginSetup(){const e=b.a.get(),t=e.isCryptoEnabled();t||this.onLoggedIn();const a=[this.firstSyncPromise.promise];if(t&&a.push(e.downloadKeys([e.getUserId()])),this.setState({pendingInitialSync:!0}),await Promise.all(a),!t)return void this.setState({pendingInitialSync:!1});e.getStoredCrossSigningForUser(e.getUserId())?!1===ae.a.SHOW_ENCRYPTION_SETUP_UI?this.onLoggedIn():this.setStateForNewView({view:je.a.COMPLETE_SECURITY}):await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing")?this.setStateForNewView({view:je.a.E2E_SETUP}):this.onLoggedIn(),this.setState({pendingInitialSync:!1})}UNSAFE_componentWillUpdate(e,t){this.shouldTrackPageChange(this.state,t)&&this.startPageChangeTimer()}componentDidMount(){window.addEventListener("resize",this.onWindowResized)}componentDidUpdate(e,t){if(this.shouldTrackPageChange(t,this.state)){const e=this.stopPageChangeTimer();v.b.instance.trackPageChange(this.state.view,this.state.page_type,e)}this.focusComposer&&(_.a.fire(W.a.FocusSendMessageComposer),this.focusComposer=!1)}componentWillUnmount(){x.m(),_.a.unregister(this.dispatcherRef),this.themeWatcher.stop(),this.fontWatcher.stop(),ye.b.destroy(),this.state.resizeNotifier.removeListener("middlePanelResized",this.dispatchTimelineResize),window.removeEventListener("resize",this.onWindowResized),null!==this.accountPasswordTimer&&clearTimeout(this.accountPasswordTimer),this.voiceBroadcastResumer&&this.voiceBroadcastResumer.destroy()}getFallbackHsUrl(){var e;return null!==(e=this.props.serverConfig)&&void 0!==e&&e.isDefault?this.props.config.fallback_hs_url:null}getServerProperties(){let e=this.state.serverConfig;return e||(e=this.props.serverConfig),e||(e=E.b.get("validated_server_config")),{serverConfig:e}}loadSession(){return Promise.resolve().then(()=>x.h({fragmentQueryParams:this.props.startingFragmentQueryParams,enableGuest:this.props.enableGuest,guestHsUrl:this.getServerProperties().serverConfig.hsUrl,guestIsUrl:this.getServerProperties().serverConfig.isUrl,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName})).then(e=>(e||(J.a.instance.pickBestInvite()?_.a.dispatch({action:"start_registration"}):_.a.dispatch({action:"view_welcome_page"})),e))}startPageChangeTimer(){be.b.instance.start(be.a.PAGE_CHANGE)}stopPageChangeTimer(){const e=be.b.instance;e.stop(be.a.PAGE_CHANGE);const t=e.getEntries({name:be.a.PAGE_CHANGE}).pop();return t?t.duration:null}shouldTrackPageChange(e,t){return e.currentRoomId!==t.currentRoomId||e.view!==t.view||e.page_type!==t.page_type}setStateForNewView(e){if(void 0===e.view)throw new Error("setStateForNewView with no view!");const t={currentUserId:null,justRegistered:!1};Object.assign(t,e),this.setState(t)}setPage(e){this.setState({page_type:e})}async startRegistration(e){const t={view:je.a.REGISTER};if(e.client_secret&&e.session_id&&e.hs_url&&e.is_url&&e.sid){t.serverConfig=await M.a.validateServerConfigWithStaticUrls(e.hs_url,e.is_url);const a=E.b.get("validated_server_config");a&&a.hsUrl===t.serverConfig.hsUrl&&(t.serverConfig.hsName=a.hsName,t.serverConfig.hsNameIsDifferent=a.hsNameIsDifferent,t.serverConfig.isDefault=a.isDefault,t.serverConfig.isNameResolvable=a.isNameResolvable),t.register_client_secret=e.client_secret,t.register_session_id=e.session_id,t.register_id_sid=e.sid}this.setStateForNewView(t),T.a.isLogin=!0,this.themeWatcher.recheck(),this.notifyNewScreen("register")}async viewRoom(e){if(this.focusComposer=!0,e.room_alias?h.a.log(`Switching to room alias ${e.room_alias} at event ${e.event_id}`):h.a.log(`Switching to room id ${e.room_id} at event ${e.event_id}`),!this.firstSyncComplete){if(!this.firstSyncPromise)return void h.a.warn("Cannot view a room before first sync. room_id:",e.room_id);await this.firstSyncPromise.promise}let t=e.room_alias||e.room_id;const a=b.a.get().getRoom(e.room_id);if(a){var n;a.decryptAllEvents();const e=C.b(a);e&&(t=e,Object(F.b)(e,a.roomId)),null===(n=localStorage)||void 0===n||n.setItem("mx_last_room_id",a.roomId)}let i="#"===t[0]&&e.room_id===this.state.currentRoomId;var r,s,o,c;(Object(Ae.a)(this.state.currentRoomId)&&(i=!0),e.room_id===this.state.currentRoomId)&&(e.threepid_invite=null!==(r=e.threepid_invite)&&void 0!==r?r:this.state.threepidInvite,e.oob_data=null!==(s=e.oob_data)&&void 0!==s?s:this.state.roomOobData,e.forceTimeline=null!==(o=e.forceTimeline)&&void 0!==o?o:this.state.forceTimeline,e.justCreatedOpts=null!==(c=e.justCreatedOpts)&&void 0!==c?c:this.state.roomJustCreatedOpts);e.event_id&&e.highlighted&&(t+="/"+e.event_id),this.setState({view:je.a.LOGGED_IN,currentRoomId:e.room_id||null,page_type:k.a.RoomView,threepidInvite:e.threepid_invite,roomOobData:e.oob_data,forceTimeline:e.forceTimeline,ready:!0,roomJustCreatedOpts:e.justCreatedOpts},()=>{this.notifyNewScreen("room/"+t,i)})}viewSomethingBehindModal(){this.state.view===je.a.LOGGED_IN?this.state.currentRoomId||this.state.currentUserId||this.viewHome():this.viewWelcome()}viewWelcome(){if(Object(Z.b)(E.b.get()))return this.viewLogin();this.setStateForNewView({view:je.a.WELCOME}),this.notifyNewScreen("welcome"),T.a.isLogin=!0,this.themeWatcher.recheck()}viewLogin(e){this.setStateForNewView(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(a),!0).forEach((function(t){s()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Be(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({view:je.a.LOGIN},e)),this.notifyNewScreen("login"),T.a.isLogin=!0,this.themeWatcher.recheck()}viewHome(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setStateForNewView({view:je.a.LOGGED_IN,justRegistered:e,currentRoomId:null}),this.setPage(k.a.HomePage),this.notifyNewScreen("home"),T.a.isLogin=!1,this.themeWatcher.recheck()}viewUser(e,t){(this.firstSyncPromise?this.firstSyncPromise.promise:Promise.resolve()).then(()=>{"chat"!==t?(this.notifyNewScreen("user/"+e),this.setState({currentUserId:e}),this.setPage(k.a.UserView)):this.chatCreateOrReuse(e)})}async createRoom(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;const n=S.a.createDialog(se.a,{type:a,defaultPublic:e,defaultName:t}),[i,r]=await n.finished;i&&Object(j.b)(r)}chatCreateOrReuse(e){const t=new Re.a(this.props.config);if(b.a.get().isGuest())return e!==t.get("welcome_user_id")&&_.a.dispatch({action:W.a.DoAfterSyncPrepared,deferred_action:{action:W.a.ViewStartChatOrReuse,user_id:e}}),void _.a.dispatch({action:"require_registration",go_welcome_on_cancel:!0,screen_after:{screen:"user/"+t.get("welcome_user_id"),params:{action:"chat"}}});const a=b.a.get(),n=new A.a(a).getDMRoomsForUserId(e);n.length>0?_.a.dispatch({action:W.a.ViewRoom,room_id:n[0],metricsTrigger:"MessageUser"}):_.a.dispatch({action:"start_chat",user_id:e})}leaveRoomWarnings(e){const t=b.a.get().getRoom(e),a=null==t?void 0:t.isSpaceRoom(),n=[];if(1===t.currentState.getJoinedMemberCount())return n.push(c.a.createElement("span",{className:"warning",key:"only_member_warning"}," ",Object(R.a)("You are the only person here. If you leave, no one will be able to join in the future, including you."))),n;const i=t.currentState.getStateEvents("m.room.join_rules","");if(i){"public"!==i.getContent().join_rule&&n.push(c.a.createElement("span",{className:"warning",key:"non_public_warning"}," ",a?Object(R.a)("This space is not public. You will not be able to rejoin without an invite."):Object(R.a)("This room is not public. You will not be able to rejoin without an invite.")))}return n}leaveRoom(e){const t=b.a.get().getRoom(e),a=this.leaveRoomWarnings(e),n=null==t?void 0:t.isSpaceRoom();S.a.createDialog(ie.a,{title:n?Object(R.a)("Leave space"):Object(R.a)("Leave room"),description:c.a.createElement("span",null,n?Object(R.a)("Are you sure you want to leave the space '%(spaceName)s'?",{spaceName:t.name}):Object(R.a)("Are you sure you want to leave the room '%(roomName)s'?",{roomName:t.name}),a),button:Object(R.a)("Leave"),onFinished:t=>{t&&(Object(Ie.a)(e),_.a.dispatch({action:W.a.AfterLeaveRoom,room_id:e}))}})}forgetRoom(e){const t=b.a.get().getRoom(e);b.a.get().forget(e).then(()=>{this.state.currentRoomId===e&&_.a.dispatch({action:W.a.ViewHomePage}),ee.c.instance.manualRoomUpdate(t,te.c.RoomRemoved)}).catch(e=>{const t=e.errcode||Object(R.c)("unknown error code");S.a.createDialog(q.a,{title:Object(R.a)("Failed to forget room %(errCode)s",{errCode:t}),description:e&&e.message?e.message:Object(R.a)("Operation failed")})})}async copyRoom(e){const t=Object(_e.h)(e);await Object(we.c)(t)||S.a.createDialog(q.a,{title:Object(R.a)("Unable to copy room link"),description:Object(R.a)("Unable to copy a link to the room to the clipboard.")})}async startWelcomeUserChat(){let e;e=this.firstSyncComplete?Promise.resolve():this.firstSyncPromise.promise,await e;const t=new Re.a(this.props.config);if(0===A.a.shared().getDMRoomsForUserId(t.get("welcome_user_id")).length){const e=await Object(j.b)({dmUserId:t.get("welcome_user_id"),andView:!this.state.currentRoomId,spinner:!1}),a=e=>{e.getType()===l.EventType.Direct&&e.getContent()[t.get("welcome_user_id")]&&(b.a.get().store.save(!0),b.a.get().removeListener(l.ClientEvent.AccountData,a))};return b.a.get().on(l.ClientEvent.AccountData,a),e}return null}async onLoggedIn(){if(T.a.isLogin=!1,this.themeWatcher.recheck(),V.f(),!b.a.currentUserIsJustRegistered()||null!==I.b.getValue("FTUE.useCaseSelection"))return this.onShowPostLoginScreen();this.setStateForNewView({view:je.a.USE_CASE_SELECTION}),I.b.watchSetting("FTUE.useCaseSelection",null,(e,t,a,n,i)=>{null!==i&&this.state.view===je.a.USE_CASE_SELECTION&&this.onShowPostLoginScreen()})}async onShowPostLoginScreen(e){if(e&&(Se.a.instance.setProperty("ftueUseCaseSelection",e),I.b.setValue("FTUE.useCaseSelection",null,Y.a.ACCOUNT,e)),this.setStateForNewView({view:je.a.LOGGED_IN}),this.screenAfterLogin&&this.screenAfterLogin.screen)this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=null;else if(b.a.currentUserIsJustRegistered()){b.a.setJustRegisteredUserId(null);if(new Re.a(this.props.config).get("welcome_user_id")&&Object(R.e)().startsWith("en")){null===await this.startWelcomeUserChat()&&_.a.dispatch({action:W.a.ViewHomePage,justRegistered:!0})}else if(J.a.instance.pickBestInvite()){const e=J.a.instance.pickBestInvite(),t=J.a.instance.translateToWireFormat(e);this.showScreen("room/"+e.roomId,t)}else _.a.dispatch({action:W.a.ViewHomePage,justRegistered:!0})}else this.showScreenAfterLogin();E.b.get("mobile_guide_toast")&&Object(X.a)()}initPosthogAnalyticsToast(){null===I.b.getValue("pseudonymousAnalyticsOptIn")&&Object(H.c)(),I.b.watchSetting("pseudonymousAnalyticsOptIn",null,(e,t,a,n,i)=>{null===i?Object(H.c)():Object(H.b)()})}showScreenAfterLogin(){this.screenAfterLogin&&this.screenAfterLogin.screen?(this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=null):localStorage&&localStorage.getItem("mx_last_room_id")?this.viewLastRoom():b.a.get().isGuest()?_.a.dispatch({action:"view_welcome_page"}):_.a.dispatch({action:W.a.ViewHomePage})}viewLastRoom(){_.a.dispatch({action:W.a.ViewRoom,room_id:localStorage.getItem("mx_last_room_id"),metricsTrigger:void 0})}onLoggedOut(){this.viewLogin({ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onSoftLogout(){this.notifyNewScreen("soft_logout"),this.setStateForNewView({view:je.a.SOFT_LOGOUT,ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onWillStartClient(){this.firstSyncComplete=!1,this.firstSyncPromise=Object(m.l)();const e=b.a.get();e.setCanResetTimelineCallback(e=>(h.a.log("Request to reset timeline in room ",e," viewing:",this.state.currentRoomId),e!==this.state.currentRoomId||(!this.loggedInView.current||this.loggedInView.current.canResetTimelineInRoom(e)))),e.on(l.ClientEvent.Sync,(e,t,a)=>{e===d.b.Error||e===d.b.Reconnecting?(a.error instanceof u.c&&x.d(a.error),this.setState({syncError:a.error})):this.state.syncError&&this.setState({syncError:null}),e===d.b.Syncing&&t===d.b.Syncing||(h.a.info("MatrixClient sync state => %s",e),e===d.b.Prepared&&(this.firstSyncComplete=!0,this.firstSyncPromise.resolve(),w.default.shouldShowPrompt()&&!b.a.userRegisteredWithinLastHours(24)&&Object(G.b)(!1),_.a.fire(W.a.FocusSendMessageComposer),this.setState({ready:!0})))}),e.on(l.HttpApiEvent.SessionLoggedOut,(function(e){if(!x.f()){if(S.a.closeCurrentModal("Session.logged_out"),401===e.httpStatus&&e.data&&e.data.soft_logout)return h.a.warn("Soft logout issued by server - avoiding data deletion"),void x.l();S.a.createDialog(q.a,{title:Object(R.a)("Signed Out"),description:Object(R.a)("For security, this session has been signed out. Please sign in again.")}),_.a.dispatch({action:"logout"})}})),e.on(l.HttpApiEvent.NoConsent,(function(t,a){S.a.createDialog(ie.a,{title:Object(R.a)("Terms and Conditions"),description:c.a.createElement("div",null,c.a.createElement("p",null," ",Object(R.a)("To continue using the %(homeserverDomain)s homeserver you must review and agree to our terms and conditions.",{homeserverDomain:e.getDomain()}))),button:Object(R.a)("Review terms and conditions"),cancelButton:Object(R.a)("Dismiss"),onFinished:e=>{if(e){window.open(a,"_blank").opener=null}}},null,!0)}));const t=f.a.instance;t.start(),e.on(l.HttpApiEvent.SessionLoggedOut,()=>t.stop()),e.on(l.MatrixEventEvent.Decrypted,(e,a)=>t.eventDecrypted(e,a)),e.on(l.ClientEvent.Room,e=>{if(b.a.get().isCryptoEnabled()){const t=I.b.getValueAt(Y.a.ROOM_DEVICE,"blacklistUnverifiedDevices",e.roomId,!0);e.setBlacklistUnverifiedDevices(t)}}),e.on(g.b.Warning,e=>{switch(e){case"CRYPTO_WARNING_OLD_VERSION_DETECTED":S.a.createDialog(q.a,{title:Object(R.a)("Old cryptography data detected"),description:Object(R.a)("Data from an older version of %(brand)s has been detected. This will have caused end-to-end cryptography to malfunction in the older version. End-to-end encrypted messages exchanged recently whilst using the older version may not be decryptable in this version. This may also cause messages exchanged with this version to fail. If you experience problems, log out and back in again. To retain message history, export and re-import your keys.",{brand:E.b.get().brand})})}}),e.on(g.b.KeyBackupFailed,async e=>{let t,n;if(b.a.get().getKeyBackupEnabled())t=!0;else try{n=await b.a.get().getKeyBackupVersion(),null!==n&&(t=!0)}catch(e){return void h.a.error("Saw key backup error but failed to check backup version!",e)}t?S.a.createDialogAsync(a.e(33).then(a.bind(null,1513)),{newVersionInfo:n}):S.a.createDialogAsync(a.e(34).then(a.bind(null,1514)))}),e.on(g.b.KeySignatureUploadFailure,(e,t,a)=>{S.a.createDialog(ce.a,{failures:e,source:t,continuation:a})}),e.on(g.b.VerificationRequest,e=>{e.verifier?S.a.createDialog(le.a,{verifier:e.verifier},null,!1,!0):e.pending&&B.a.sharedInstance().addOrReplaceToast({key:"verifreq_"+e.channel.transactionId,title:Object(R.a)("Verification requested"),icon:"verification",props:{request:e},component:fe.a,priority:90})}),this.voiceBroadcastResumer=new Fe.t(e)}onClientStarted(){const e=b.a.get();if(e.isCryptoEnabled()){const t=I.b.getValueAt(Y.a.DEVICE,"blacklistUnverifiedDevices");e.setGlobalBlacklistUnverifiedDevices(t),e.setGlobalErrorOnUnknownDevices(!1)}Se.a.instance.isEnabled()&&I.b.isLevelSupported(Y.a.ACCOUNT)&&this.initPosthogAnalyticsToast()}showScreen(e,t){const a=b.a.get();if(!a||a.isGuest()||!Ve.includes(e))if("register"===e)_.a.dispatch({action:"start_registration",params:t}),be.b.instance.start(be.a.REGISTER);else if("login"===e)_.a.dispatch({action:"start_login",params:t}),be.b.instance.start(be.a.LOGIN);else if("forgot_password"===e)_.a.dispatch({action:"start_password_recovery",params:t});else if("soft_logout"===e)a.getUserId()&&!x.g()?this.viewLastRoom():_.a.dispatch({action:"start_login",params:t});else if("new"===e)_.a.dispatch({action:"view_create_room"});else if("dm"===e)_.a.dispatch({action:"view_create_chat"});else if("settings"===e)_.a.fire(W.a.ViewUserSettings);else if("welcome"===e)_.a.dispatch({action:"view_welcome_page"});else if("home"===e)_.a.dispatch({action:W.a.ViewHomePage});else if("start"===e)this.showScreen("home"),_.a.dispatch({action:"require_registration"});else if("directory"===e)_.a.fire(W.a.ViewRoomDirectory);else if("start_sso"===e||"start_cas"===e){let t=b.a.get();if(!t){const{hsUrl:e,isUrl:a}=this.props.serverConfig;t=Object(l.createClient)({baseUrl:e,idBaseUrl:a})}const a="start_sso"===e?"sso":"cas";y.a.get().startSingleSignOn(t,a,this.getFragmentAfterLogin())}else if(0===e.indexOf("room/")){var n,i,r;const a=e.substring(5),s=a.indexOf(":")+1;let o=a.length;a.substring(s).indexOf("/")>-1&&(o=s+a.substring(s).indexOf("/"));const c=a.substring(0,o);let l,d=a.substring(o+1);if(d||(d=void 0),t.signurl&&t.email&&(l=J.a.instance.storeInvite(c,t)),!l){l=J.a.instance.getInvites().find(e=>e.roomId===c)}let u=[];t.via&&(u="string"==typeof t.via?[t.via]:t.via);const m={action:W.a.ViewRoom,event_id:d,via_servers:u,highlighted:Boolean(d),threepid_invite:l,oob_data:{name:null===(n=l)||void 0===n?void 0:n.roomName,avatarUrl:null===(i=l)||void 0===i?void 0:i.roomAvatarUrl,inviterName:null===(r=l)||void 0===r?void 0:r.inviterName},room_alias:void 0,room_id:void 0,metricsTrigger:void 0};"#"===c[0]?m.room_alias=c:m.room_id=c,_.a.dispatch(m)}else if(0===e.indexOf("user/")){const a=e.substring(5);_.a.dispatch({action:"view_user_info",userId:a,subAction:t.action})}else h.a.info("Ignoring showScreen for '%s'",e);else _.a.dispatch({action:W.a.ViewHomePage})}notifyNewScreen(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.props.onNewScreen&&this.props.onNewScreen(e,t),this.setPageSubtitle()}onLogoutClick(e){_.a.dispatch({action:"logout"}),e.stopPropagation(),e.preventDefault()}dispatchTimelineResize(){_.a.dispatch({action:"timeline_resize"})}onRegistered(e){return x.k(e)}onSendEvent(e,t){const a=b.a.get();a&&a.sendEvent(e,t.getType(),t.getContent()).then(()=>{_.a.dispatch({action:"message_sent"})})}setPageSubtitle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.state.currentRoomId){const t=b.a.get(),a=t&&t.getRoom(this.state.currentRoomId);a&&(e=`${this.subTitleStatus} | ${a.name} ${e}`)}else e=`${this.subTitleStatus} ${e}`;const t=`${E.b.get().brand} ${e}`;document.title!==t&&(document.title=t)}getFragmentAfterLogin(){let e="";const t=this.props.initialScreenAfterLogin;return t&&!["welcome","login","register","start_sso","start_cas"].includes(t.screen)&&(e="/"+t.screen),e}render(){const e=this.getFragmentAfterLogin();let t=null;if(this.state.view===je.a.LOADING)t=c.a.createElement("div",{className:"mx_MatrixChat_splash"},c.a.createElement(ne.a,null));else if(this.state.view===je.a.COMPLETE_SECURITY)t=c.a.createElement(de.a,{onFinished:this.onCompleteSecurityE2eSetupFinished});else if(this.state.view===je.a.E2E_SETUP)t=c.a.createElement(he.a,{onFinished:this.onCompleteSecurityE2eSetupFinished,accountPassword:this.accountPassword,tokenLogin:!!this.tokenLogin});else if(this.state.view===je.a.LOGGED_IN){const e=this.state.syncError&&this.state.syncError instanceof u.c;if(this.state.ready&&this.state.page_type&&!e)t=c.a.createElement(z.a,i()({},this.props,this.state,{ref:this.loggedInView,matrixClient:b.a.get(),onRegistered:this.onRegistered,currentRoomId:this.state.currentRoomId}));else{let a;this.state.syncError&&!e&&(a=c.a.createElement("div",{className:"mx_MatrixChat_syncError"},Object(D.b)(this.state.syncError))),t=c.a.createElement("div",{className:"mx_MatrixChat_splash"},a,c.a.createElement(ne.a,null),c.a.createElement("div",{className:"mx_MatrixChat_splashButtons"},c.a.createElement(ke.a,{kind:"link_inline",onClick:this.onLogoutClick},Object(R.a)("Logout"))))}}else if(this.state.view===je.a.WELCOME)t=c.a.createElement(ue.a,null);else if(this.state.view===je.a.REGISTER&&I.b.getValue($.b.Registration)){var a;const n=null===(a=J.a.instance.pickBestInvite())||void 0===a?void 0:a.toEmail;t=c.a.createElement(pe.a,i()({clientSecret:this.state.register_client_secret,sessionId:this.state.register_session_id,idSid:this.state.register_id_sid,email:n,brand:this.props.config.brand,makeRegistrationUrl:this.makeRegistrationUrl,onLoggedIn:this.onRegisterFlowComplete,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,fragmentAfterLogin:e},this.getServerProperties()))}else if(this.state.view===je.a.FORGOT_PASSWORD&&I.b.getValue($.b.PasswordReset))t=c.a.createElement(me.a,i()({onComplete:this.onLoginClick,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange},this.getServerProperties()));else if(this.state.view===je.a.LOGIN){const a=I.b.getValue($.b.PasswordReset);t=c.a.createElement(ge.a,i()({isSyncing:this.state.pendingInitialSync,onLoggedIn:this.onUserCompletedLoginFlow,onRegisterClick:this.onRegisterClick,fallbackHsUrl:this.getFallbackHsUrl(),defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,onForgotPasswordClick:a?this.onForgotPasswordClick:void 0,onServerConfigChange:this.onServerConfigChange,fragmentAfterLogin:e,defaultUsername:this.props.startingFragmentQueryParams.defaultUsername},this.getServerProperties()))}else this.state.view===je.a.SOFT_LOGOUT?t=c.a.createElement(Ee.a,{realQueryParams:this.props.realQueryParams,onTokenLoginCompleted:this.props.onTokenLoginCompleted,fragmentAfterLogin:e}):this.state.view===je.a.USE_CASE_SELECTION?t=c.a.createElement(Me.a,{onFinished:e=>this.onShowPostLoginScreen(e)}):h.a.error("Unknown view "+this.state.view);return c.a.createElement(ve.a,null,c.a.createElement(Le.a.Provider,{value:this.stores},t))}}s()(We,"displayName","MatrixChat"),s()(We,"defaultProps",{realQueryParams:{},startingFragmentQueryParams:{},config:{},onTokenLoginCompleted:()=>{}})}).call(this,a(30))},1413:function(e,t,a){!function(){"use strict";function e(e){var t=!0,a=!1,n=null,i={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function r(e){return!!(e&&e!==document&&"HTML"!==e.nodeName&&"BODY"!==e.nodeName&&"classList"in e&&"contains"in e.classList)}function s(e){e.classList.contains("focus-visible")||(e.classList.add("focus-visible"),e.setAttribute("data-focus-visible-added",""))}function o(e){t=!1}function c(){document.addEventListener("mousemove",l),document.addEventListener("mousedown",l),document.addEventListener("mouseup",l),document.addEventListener("pointermove",l),document.addEventListener("pointerdown",l),document.addEventListener("pointerup",l),document.addEventListener("touchmove",l),document.addEventListener("touchstart",l),document.addEventListener("touchend",l)}function l(e){e.target.nodeName&&"html"===e.target.nodeName.toLowerCase()||(t=!1,document.removeEventListener("mousemove",l),document.removeEventListener("mousedown",l),document.removeEventListener("mouseup",l),document.removeEventListener("pointermove",l),document.removeEventListener("pointerdown",l),document.removeEventListener("pointerup",l),document.removeEventListener("touchmove",l),document.removeEventListener("touchstart",l),document.removeEventListener("touchend",l))}document.addEventListener("keydown",(function(a){a.metaKey||a.altKey||a.ctrlKey||(r(e.activeElement)&&s(e.activeElement),t=!0)}),!0),document.addEventListener("mousedown",o,!0),document.addEventListener("pointerdown",o,!0),document.addEventListener("touchstart",o,!0),document.addEventListener("visibilitychange",(function(e){"hidden"===document.visibilityState&&(a&&(t=!0),c())}),!0),c(),e.addEventListener("focus",(function(e){var a,n,o;r(e.target)&&(t||(a=e.target,n=a.type,"INPUT"===(o=a.tagName)&&i[n]&&!a.readOnly||"TEXTAREA"===o&&!a.readOnly||a.isContentEditable))&&s(e.target)}),!0),e.addEventListener("blur",(function(e){var t;r(e.target)&&(e.target.classList.contains("focus-visible")||e.target.hasAttribute("data-focus-visible-added"))&&(a=!0,window.clearTimeout(n),n=window.setTimeout((function(){a=!1}),100),(t=e.target).hasAttribute("data-focus-visible-added")&&(t.classList.remove("focus-visible"),t.removeAttribute("data-focus-visible-added")))}),!0),e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&e.host?e.host.setAttribute("data-js-focus-visible",""):e.nodeType===Node.DOCUMENT_NODE&&(document.documentElement.classList.add("js-focus-visible"),document.documentElement.setAttribute("data-js-focus-visible",""))}if("undefined"!=typeof window&&"undefined"!=typeof document){var t;window.applyFocusVisiblePolyfill=e;try{t=new CustomEvent("focus-visible-polyfill-ready")}catch(e){(t=document.createEvent("CustomEvent")).initCustomEvent("focus-visible-polyfill-ready",!1,!1,{})}window.dispatchEvent(t)}"undefined"!=typeof document&&e(document)}()},1414:function(e,t,a){var n;n=function(){return function(e){var t={};function a(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}return a.m=e,a.c=t,a.p="",a(0)}([function(e,t){"use strict";e.exports=function(){if("undefined"==typeof document||"undefined"==typeof window)return{ask:function(){return"initial"},element:function(){return null},ignoreKeys:function(){},specificKeys:function(){},registerOnChange:function(){},unRegisterOnChange:function(){}};var e=document.documentElement,t=null,a="initial",n=a,i=Date.now(),r=!1,s=["button","input","select","textarea"],o=[],c=[16,17,18,91,93],l=[],d={keydown:"keyboard",keyup:"keyboard",mousedown:"mouse",mousemove:"mouse",MSPointerDown:"pointer",MSPointerMove:"pointer",pointerdown:"pointer",pointermove:"pointer",touchstart:"touch",touchend:"touch"},u=!1,m={x:null,y:null},h={2:"touch",3:"touch",4:"mouse"},p=!1;try{var g=Object.defineProperty({},"passive",{get:function(){p=!0}});window.addEventListener("test",null,g)}catch(e){}var v=function(){var e=!p||{passive:!0,capture:!0};document.addEventListener("DOMContentLoaded",f,!0),window.PointerEvent?(window.addEventListener("pointerdown",b,!0),window.addEventListener("pointermove",E,!0)):window.MSPointerEvent?(window.addEventListener("MSPointerDown",b,!0),window.addEventListener("MSPointerMove",E,!0)):(window.addEventListener("mousedown",b,!0),window.addEventListener("mousemove",E,!0),"ontouchstart"in window&&(window.addEventListener("touchstart",b,e),window.addEventListener("touchend",b,!0))),window.addEventListener(x(),E,e),window.addEventListener("keydown",b,!0),window.addEventListener("keyup",b,!0),window.addEventListener("focusin",_,!0),window.addEventListener("focusout",w,!0)},f=function(){if(r=!("false"===e.getAttribute("data-whatpersist")||"false"===document.body.getAttribute("data-whatpersist")))try{window.sessionStorage.getItem("what-input")&&(a=window.sessionStorage.getItem("what-input")),window.sessionStorage.getItem("what-intent")&&(n=window.sessionStorage.getItem("what-intent"))}catch(e){}y("input"),y("intent")},b=function(e){var t=e.which,i=d[e.type];"pointer"===i&&(i=O(e));var r=!l.length&&-1===c.indexOf(t),o=l.length&&-1!==l.indexOf(t),u="keyboard"===i&&t&&(r||o)||"mouse"===i||"touch"===i;if(C(i)&&(u=!1),u&&a!==i&&(S("input",a=i),y("input")),u&&n!==i){var m=document.activeElement;m&&m.nodeName&&(-1===s.indexOf(m.nodeName.toLowerCase())||"button"===m.nodeName.toLowerCase()&&!R(m,"form"))&&(S("intent",n=i),y("intent"))}},y=function(t){e.setAttribute("data-what"+t,"input"===t?a:n),k(t)},E=function(e){var t=d[e.type];"pointer"===t&&(t=O(e)),j(e),(!u&&!C(t)||u&&"wheel"===e.type||"mousewheel"===e.type||"DOMMouseScroll"===e.type)&&n!==t&&(S("intent",n=t),y("intent"))},_=function(a){a.target.nodeName?(t=a.target.nodeName.toLowerCase(),e.setAttribute("data-whatelement",t),a.target.classList&&a.target.classList.length&&e.setAttribute("data-whatclasses",a.target.classList.toString().replace(" ",","))):w()},w=function(){t=null,e.removeAttribute("data-whatelement"),e.removeAttribute("data-whatclasses")},S=function(e,t){if(r)try{window.sessionStorage.setItem("what-"+e,t)}catch(e){}},O=function(e){return"number"==typeof e.pointerType?h[e.pointerType]:"pen"===e.pointerType?"touch":e.pointerType},C=function(e){var t=Date.now(),n="mouse"===e&&"touch"===a&&t-i<200;return i=t,n},x=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},k=function(e){for(var t=0,i=o.length;t<i;t++)o[t].type===e&&o[t].fn.call(void 0,"input"===e?a:n)},j=function(e){m.x!==e.screenX||m.y!==e.screenY?(u=!1,m.x=e.screenX,m.y=e.screenY):u=!0},R=function(e,t){var a=window.Element.prototype;if(a.matches||(a.matches=a.msMatchesSelector||a.webkitMatchesSelector),a.closest)return e.closest(t);do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null};return"addEventListener"in window&&Array.prototype.indexOf&&(d[x()]="mouse",v()),{ask:function(e){return"intent"===e?n:a},element:function(){return t},ignoreKeys:function(e){c=e},specificKeys:function(e){l=e},registerOnChange:function(e,t){o.push({fn:e,type:t||"input"})},unRegisterOnChange:function(e){var t=function(e){for(var t=0,a=o.length;t<a;t++)if(o[t].fn===e)return t}(e);(t||0===t)&&o.splice(t,1)},clearStorage:function(){window.sessionStorage.clear()}}}()}])},e.exports=n()},1415:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(1416),s=a(98),o=a(94);const c={deferredAction:null};class l extends r.Store{constructor(){super(o.a),i()(this,"state",c)}setState(e){this.state=Object.assign(this.state,e),this.__emitChange()}__onDispatch(e){switch(e.action){case s.a.DoAfterSyncPrepared:this.setState({deferredAction:e.deferred_action});break;case"cancel_after_sync_prepared":this.setState({deferredAction:null});break;case"MatrixActions.sync":{if("PREPARED"!==e.state)break;if(!this.state.deferredAction)break;const t=Object.assign({},this.state.deferredAction);this.setState({deferredAction:null}),o.a.dispatch(t);break}case"on_client_not_viable":case s.a.OnLoggedOut:this.reset()}}reset(){this.state=Object.assign({},c)}}let d=null;d||(d=new l)},1416:function(e,t,a){e.exports.Container=a(1417),e.exports.MapStore=a(1419),e.exports.Mixin=a(1427),e.exports.ReduceStore=a(844),e.exports.Store=a(845)},1417:function(e,t,a){"use strict";var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=a(843),o=a(242),c=a(1418),l={pure:!0,withProps:!1};e.exports={create:function(e,t){var a;(a=e).getStores||o(!1),a.calculateState||o(!1);var d=n({},l,t||{}),u=function(t){function a(n){i(this,a),t.call(this,n),this.state=d.withProps?e.calculateState(null,n):e.calculateState(null,void 0)}return r(a,t),a.prototype.componentDidMount=function(){var a=this;t.prototype.componentDidMount&&t.prototype.componentDidMount.call(this);var n=e.getStores(),i=!1,r=function(){i=!0};this._fluxContainerSubscriptions=n.map((function(e){return e.addListener(r)}));this._fluxContainerStoreGroup=new s(n,(function(){i&&a.setState((function(t){return d.withProps?e.calculateState(t,a.props):e.calculateState(t,void 0)})),i=!1}))},a.prototype.componentWillReceiveProps=function(a,n){t.prototype.componentWillReceiveProps&&t.prototype.componentWillReceiveProps.call(this,a,n),d.withProps&&(d.pure&&c(this.props,a)||this.setState((function(t){return e.calculateState(t,a)})))},a.prototype.componentWillUnmount=function(){t.prototype.componentWillUnmount&&t.prototype.componentWillUnmount.call(this),this._fluxContainerStoreGroup.release();var e=this._fluxContainerSubscriptions,a=Array.isArray(e),n=0;for(e=a?e:e[Symbol.iterator]();;){var i;if(a){if(n>=e.length)break;i=e[n++]}else{if((n=e.next()).done)break;i=n.value}i.remove()}this._fluxContainerSubscriptions=[]},a}(e),m=d.pure?function(e){function t(){i(this,t),e.apply(this,arguments)}return r(t,e),t.prototype.shouldComponentUpdate=function(e,t){return!c(this.props,e)||!c(this.state,t)},t}(u):u,h=e.displayName||e.name;return m.displayName="FluxContainer("+h+")",m}}},1418:function(e,t,a){"use strict";var n=Object.prototype.hasOwnProperty;e.exports=function(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return!1;for(var r=n.bind(t),s=0;s<a.length;s++)if(!r(a[s])||e[a[s]]!==t[a[s]])return!1;return!0}},1419:function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=a(844),r=a(1426),s=a(242),o=function(e){function t(){n(this,t),e.apply(this,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getInitialState=function(){return r.Map()},t.prototype.at=function(e){return this.has(e)||s(!1),this.get(e)},t.prototype.has=function(e){return this.getState().has(e)},t.prototype.get=function(e){return this.getState().get(e)},t.prototype.getAll=function(e,t){var a=this,n=r.Set(e),i=t||r.Map();return i.withMutations((function(e){var t=i,r=Array.isArray(t),s=0;for(t=r?t:t[Symbol.iterator]();;){var o;if(r){if(s>=t.length)break;o=t[s++]}else{if((s=t.next()).done)break;o=s.value}var c=o[0];n.has(c)&&a.has(c)||e.delete(c)}var l=n,d=Array.isArray(l),u=0;for(l=d?l:l[Symbol.iterator]();;){var m;if(d){if(u>=l.length)break;m=l[u++]}else{if((u=l.next()).done)break;m=u.value}var h=m;a.has(h)&&e.set(h,a.at(h))}}))},t}(i);e.exports=o},1420:function(e,t,a){var n={EventEmitter:a(1421),EmitterSubscription:a(846)};e.exports=n},1421:function(e,t,a){"use strict";var n=a(846),i=a(1423),r=a(1424),s=a(847),o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._subscriber=new i,this._currentSubscription=null}return e.prototype.addListener=function(e,t,a){return this._subscriber.addSubscription(e,new n(this._subscriber,t,a))},e.prototype.once=function(e,t,a){var n=this;return this.addListener(e,(function(){n.removeCurrentListener(),t.apply(a,arguments)}))},e.prototype.removeAllListeners=function(e){this._subscriber.removeAllSubscriptions(e)},e.prototype.removeCurrentListener=function(){this._currentSubscription||s(!1),this._subscriber.removeSubscription(this._currentSubscription)},e.prototype.listeners=function(e){var t=this._subscriber.getSubscriptionsForType(e);return t?t.filter(r.thatReturnsTrue).map((function(e){return e.listener})):[]},e.prototype.emit=function(e){var t=this._subscriber.getSubscriptionsForType(e);if(t){for(var a=Object.keys(t),n=0;n<a.length;n++){var i=a[n],r=t[i];r&&(this._currentSubscription=r,this.__emitToSubscription.apply(this,[r].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},e.prototype.__emitToSubscription=function(e,t){var a=Array.prototype.slice.call(arguments,2);e.listener.apply(e.context,a)},e}();e.exports=o},1422:function(e,t,a){"use strict";var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscriber=t}return e.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},e}();e.exports=n},1423:function(e,t,a){"use strict";var n=a(847),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._subscriptionsForType={},this._currentSubscription=null}return e.prototype.addSubscription=function(e,t){t.subscriber!==this&&n(!1),this._subscriptionsForType[e]||(this._subscriptionsForType[e]=[]);var a=this._subscriptionsForType[e].length;return this._subscriptionsForType[e].push(t),t.eventType=e,t.key=a,t},e.prototype.removeAllSubscriptions=function(e){void 0===e?this._subscriptionsForType={}:delete this._subscriptionsForType[e]},e.prototype.removeSubscription=function(e){var t=e.eventType,a=e.key,n=this._subscriptionsForType[t];n&&delete n[a]},e.prototype.getSubscriptionsForType=function(e){return this._subscriptionsForType[e]},e}();e.exports=i},1424:function(e,t,a){"use strict";function n(e){return function(){return e}}var i=function(){};i.thatReturns=n,i.thatReturnsFalse=n(!1),i.thatReturnsTrue=n(!0),i.thatReturnsNull=n(null),i.thatReturnsThis=function(){return this},i.thatReturnsArgument=function(e){return e},e.exports=i},1425:function(e,t,a){"use strict";var n=a(242);e.exports=function(e,t){n(!1)}},1426:function(e,t,a){e.exports=function(){"use strict";var e=Array.prototype.slice;function t(e,t){t&&(e.prototype=Object.create(t.prototype)),e.prototype.constructor=e}function a(e){return s(e)?e:z(e)}function n(e){return o(e)?e:W(e)}function i(e){return c(e)?e:H(e)}function r(e){return s(e)&&!l(e)?e:G(e)}function s(e){return!(!e||!e[u])}function o(e){return!(!e||!e[m])}function c(e){return!(!e||!e[h])}function l(e){return o(e)||c(e)}function d(e){return!(!e||!e[p])}t(n,a),t(i,a),t(r,a),a.isIterable=s,a.isKeyed=o,a.isIndexed=c,a.isAssociative=l,a.isOrdered=d,a.Keyed=n,a.Indexed=i,a.Set=r;var u="@@__IMMUTABLE_ITERABLE__@@",m="@@__IMMUTABLE_KEYED__@@",h="@@__IMMUTABLE_INDEXED__@@",p="@@__IMMUTABLE_ORDERED__@@",g={},v={value:!1},f={value:!1};function b(e){return e.value=!1,e}function y(e){e&&(e.value=!0)}function E(){}function _(e,t){t=t||0;for(var a=Math.max(0,e.length-t),n=new Array(a),i=0;i<a;i++)n[i]=e[i+t];return n}function w(e){return void 0===e.size&&(e.size=e.__iterate(O)),e.size}function S(e,t){if("number"!=typeof t){var a=t>>>0;if(""+a!==t||4294967295===a)return NaN;t=a}return t<0?w(e)+t:t}function O(){return!0}function C(e,t,a){return(0===e||void 0!==a&&e<=-a)&&(void 0===t||void 0!==a&&t>=a)}function x(e,t){return j(e,t,0)}function k(e,t){return j(e,t,t)}function j(e,t,a){return void 0===e?a:e<0?Math.max(0,t+e):void 0===t?e:Math.min(t,e)}var R,I,T,N="function"==typeof Symbol&&Symbol.iterator,D=N||"@@iterator";function P(e){this.next=e}function M(e,t,a,n){var i=0===e?t:1===e?a:[t,a];return n?n.value=i:n={value:i,done:!1},n}function A(){return{value:void 0,done:!0}}function L(e){return!!B(e)}function U(e){return e&&"function"==typeof e.next}function F(e){var t=B(e);return t&&t.call(e)}function B(e){var t=e&&(N&&e[N]||e["@@iterator"]);if("function"==typeof t)return t}function V(e){return e&&"number"==typeof e.length}function z(e){return null==e?Q():s(e)?e.toSeq():function(e){var t=ee(e)||"object"==typeof e&&new K(e);if(!t)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+e);return t}(e)}function W(e){return null==e?Q().toKeyedSeq():s(e)?o(e)?e.toSeq():e.fromEntrySeq():X(e)}function H(e){return null==e?Q():s(e)?o(e)?e.entrySeq():e.toIndexedSeq():Z(e)}function G(e){return(null==e?Q():s(e)?o(e)?e.entrySeq():e:Z(e)).toSetSeq()}function q(e){this._array=e,this.size=e.length}function K(e){var t=Object.keys(e);this._object=e,this._keys=t,this.size=t.length}function Y(e){this._iterable=e,this.size=e.length||e.size}function J(e){this._iterator=e,this._iteratorCache=[]}function $(e){return!(!e||!e["@@__IMMUTABLE_SEQ__@@"])}function Q(){return R||(R=new q([]))}function X(e){var t=Array.isArray(e)?new q(e).fromEntrySeq():U(e)?new J(e).fromEntrySeq():L(e)?new Y(e).fromEntrySeq():"object"==typeof e?new K(e):void 0;if(!t)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+e);return t}function Z(e){var t=ee(e);if(!t)throw new TypeError("Expected Array or iterable object of values: "+e);return t}function ee(e){return V(e)?new q(e):U(e)?new J(e):L(e)?new Y(e):void 0}function te(e,t,a,n){var i=e._cache;if(i){for(var r=i.length-1,s=0;s<=r;s++){var o=i[a?r-s:s];if(!1===t(o[1],n?o[0]:s,e))return s+1}return s}return e.__iterateUncached(t,a)}function ae(e,t,a,n){var i=e._cache;if(i){var r=i.length-1,s=0;return new P((function(){var e=i[a?r-s:s];return s++>r?{value:void 0,done:!0}:M(t,n?e[0]:s-1,e[1])}))}return e.__iteratorUncached(t,a)}function ne(e,t){return t?function e(t,a,n,i){return Array.isArray(a)?t.call(i,n,H(a).map((function(n,i){return e(t,n,i,a)}))):re(a)?t.call(i,n,W(a).map((function(n,i){return e(t,n,i,a)}))):a}(t,e,"",{"":e}):ie(e)}function ie(e){return Array.isArray(e)?H(e).map(ie).toList():re(e)?W(e).map(ie).toMap():e}function re(e){return e&&(e.constructor===Object||void 0===e.constructor)}function se(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!("function"!=typeof e.equals||"function"!=typeof t.equals||!e.equals(t))}function oe(e,t){if(e===t)return!0;if(!s(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||o(e)!==o(t)||c(e)!==c(t)||d(e)!==d(t))return!1;if(0===e.size&&0===t.size)return!0;var a=!l(e);if(d(e)){var n=e.entries();return t.every((function(e,t){var i=n.next().value;return i&&se(i[1],e)&&(a||se(i[0],t))}))&&n.next().done}var i=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{i=!0;var r=e;e=t,t=r}var u=!0,m=t.__iterate((function(t,n){if(a?!e.has(t):i?!se(t,e.get(n,g)):!se(e.get(n,g),t))return u=!1,!1}));return u&&e.size===m}function ce(e,t){if(!(this instanceof ce))return new ce(e,t);if(this._value=e,this.size=void 0===t?1/0:Math.max(0,t),0===this.size){if(I)return I;I=this}}function le(e,t){if(!e)throw new Error(t)}function de(e,t,a){if(!(this instanceof de))return new de(e,t,a);if(le(0!==a,"Cannot step a Range by 0"),e=e||0,void 0===t&&(t=1/0),a=void 0===a?1:Math.abs(a),t<e&&(a=-a),this._start=e,this._end=t,this._step=a,this.size=Math.max(0,Math.ceil((t-e)/a-1)+1),0===this.size){if(T)return T;T=this}}function ue(){throw TypeError("Abstract")}function me(){}function he(){}function pe(){}P.prototype.toString=function(){return"[Iterator]"},P.KEYS=0,P.VALUES=1,P.ENTRIES=2,P.prototype.inspect=P.prototype.toSource=function(){return this.toString()},P.prototype[D]=function(){return this},t(z,a),z.of=function(){return z(arguments)},z.prototype.toSeq=function(){return this},z.prototype.toString=function(){return this.__toString("Seq {","}")},z.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},z.prototype.__iterate=function(e,t){return te(this,e,t,!0)},z.prototype.__iterator=function(e,t){return ae(this,e,t,!0)},t(W,z),W.prototype.toKeyedSeq=function(){return this},t(H,z),H.of=function(){return H(arguments)},H.prototype.toIndexedSeq=function(){return this},H.prototype.toString=function(){return this.__toString("Seq [","]")},H.prototype.__iterate=function(e,t){return te(this,e,t,!1)},H.prototype.__iterator=function(e,t){return ae(this,e,t,!1)},t(G,z),G.of=function(){return G(arguments)},G.prototype.toSetSeq=function(){return this},z.isSeq=$,z.Keyed=W,z.Set=G,z.Indexed=H,z.prototype["@@__IMMUTABLE_SEQ__@@"]=!0,t(q,H),q.prototype.get=function(e,t){return this.has(e)?this._array[S(this,e)]:t},q.prototype.__iterate=function(e,t){for(var a=this._array,n=a.length-1,i=0;i<=n;i++)if(!1===e(a[t?n-i:i],i,this))return i+1;return i},q.prototype.__iterator=function(e,t){var a=this._array,n=a.length-1,i=0;return new P((function(){return i>n?{value:void 0,done:!0}:M(e,i,a[t?n-i++:i++])}))},t(K,W),K.prototype.get=function(e,t){return void 0===t||this.has(e)?this._object[e]:t},K.prototype.has=function(e){return this._object.hasOwnProperty(e)},K.prototype.__iterate=function(e,t){for(var a=this._object,n=this._keys,i=n.length-1,r=0;r<=i;r++){var s=n[t?i-r:r];if(!1===e(a[s],s,this))return r+1}return r},K.prototype.__iterator=function(e,t){var a=this._object,n=this._keys,i=n.length-1,r=0;return new P((function(){var s=n[t?i-r:r];return r++>i?{value:void 0,done:!0}:M(e,s,a[s])}))},K.prototype[p]=!0,t(Y,H),Y.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);var a=F(this._iterable),n=0;if(U(a))for(var i;!(i=a.next()).done&&!1!==e(i.value,n++,this););return n},Y.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var a=F(this._iterable);if(!U(a))return new P(A);var n=0;return new P((function(){var t=a.next();return t.done?t:M(e,n++,t.value)}))},t(J,H),J.prototype.__iterateUncached=function(e,t){if(t)return this.cacheResult().__iterate(e,t);for(var a,n=this._iterator,i=this._iteratorCache,r=0;r<i.length;)if(!1===e(i[r],r++,this))return r;for(;!(a=n.next()).done;){var s=a.value;if(i[r]=s,!1===e(s,r++,this))break}return r},J.prototype.__iteratorUncached=function(e,t){if(t)return this.cacheResult().__iterator(e,t);var a=this._iterator,n=this._iteratorCache,i=0;return new P((function(){if(i>=n.length){var t=a.next();if(t.done)return t;n[i]=t.value}return M(e,i,n[i++])}))},t(ce,H),ce.prototype.toString=function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},ce.prototype.get=function(e,t){return this.has(e)?this._value:t},ce.prototype.includes=function(e){return se(this._value,e)},ce.prototype.slice=function(e,t){var a=this.size;return C(e,t,a)?this:new ce(this._value,k(t,a)-x(e,a))},ce.prototype.reverse=function(){return this},ce.prototype.indexOf=function(e){return se(this._value,e)?0:-1},ce.prototype.lastIndexOf=function(e){return se(this._value,e)?this.size:-1},ce.prototype.__iterate=function(e,t){for(var a=0;a<this.size;a++)if(!1===e(this._value,a,this))return a+1;return a},ce.prototype.__iterator=function(e,t){var a=this,n=0;return new P((function(){return n<a.size?M(e,n++,a._value):{value:void 0,done:!0}}))},ce.prototype.equals=function(e){return e instanceof ce?se(this._value,e._value):oe(e)},t(de,H),de.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},de.prototype.get=function(e,t){return this.has(e)?this._start+S(this,e)*this._step:t},de.prototype.includes=function(e){var t=(e-this._start)/this._step;return t>=0&&t<this.size&&t===Math.floor(t)},de.prototype.slice=function(e,t){return C(e,t,this.size)?this:(e=x(e,this.size),(t=k(t,this.size))<=e?new de(0,0):new de(this.get(e,this._end),this.get(t,this._end),this._step))},de.prototype.indexOf=function(e){var t=e-this._start;if(t%this._step==0){var a=t/this._step;if(a>=0&&a<this.size)return a}return-1},de.prototype.lastIndexOf=function(e){return this.indexOf(e)},de.prototype.__iterate=function(e,t){for(var a=this.size-1,n=this._step,i=t?this._start+a*n:this._start,r=0;r<=a;r++){if(!1===e(i,r,this))return r+1;i+=t?-n:n}return r},de.prototype.__iterator=function(e,t){var a=this.size-1,n=this._step,i=t?this._start+a*n:this._start,r=0;return new P((function(){var s=i;return i+=t?-n:n,r>a?{value:void 0,done:!0}:M(e,r++,s)}))},de.prototype.equals=function(e){return e instanceof de?this._start===e._start&&this._end===e._end&&this._step===e._step:oe(this,e)},t(ue,a),t(me,ue),t(he,ue),t(pe,ue),ue.Keyed=me,ue.Indexed=he,ue.Set=pe;var ge="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(e,t){var a=65535&(e|=0),n=65535&(t|=0);return a*n+((e>>>16)*n+a*(t>>>16)<<16>>>0)|0};function ve(e){return e>>>1&1073741824|3221225471&e}function fe(e){if(!1===e||null==e)return 0;if("function"==typeof e.valueOf&&(!1===(e=e.valueOf())||null==e))return 0;if(!0===e)return 1;var t=typeof e;if("number"===t){if(e!=e||e===1/0)return 0;var a=0|e;for(a!==e&&(a^=4294967295*e);e>4294967295;)a^=e/=4294967295;return ve(a)}if("string"===t)return e.length>Ce?function(e){var t=je[e];return void 0===t&&(t=be(e),ke===xe&&(ke=0,je={}),ke++,je[e]=t),t}(e):be(e);if("function"==typeof e.hashCode)return e.hashCode();if("object"===t)return function(e){var t;if(we&&void 0!==(t=ye.get(e)))return t;if(void 0!==(t=e[Oe]))return t;if(!_e){if(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[Oe]))return t;if(void 0!==(t=function(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e)))return t}if(t=++Se,1073741824&Se&&(Se=0),we)ye.set(e,t);else{if(void 0!==Ee&&!1===Ee(e))throw new Error("Non-extensible objects are not allowed as keys.");if(_e)Object.defineProperty(e,Oe,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[Oe]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[Oe]=t}}return t}(e);if("function"==typeof e.toString)return be(e.toString());throw new Error("Value type "+t+" cannot be hashed.")}function be(e){for(var t=0,a=0;a<e.length;a++)t=31*t+e.charCodeAt(a)|0;return ve(t)}var ye,Ee=Object.isExtensible,_e=function(){try{return Object.defineProperty({},"@",{}),!0}catch(e){return!1}}(),we="function"==typeof WeakMap;we&&(ye=new WeakMap);var Se=0,Oe="__immutablehash__";"function"==typeof Symbol&&(Oe=Symbol(Oe));var Ce=16,xe=255,ke=0,je={};function Re(e){le(e!==1/0,"Cannot perform this action with an infinite size.")}function Ie(e){return null==e?He():Te(e)&&!d(e)?e:He().withMutations((function(t){var a=n(e);Re(a.size),a.forEach((function(e,a){return t.set(a,e)}))}))}function Te(e){return!(!e||!e[De])}t(Ie,me),Ie.of=function(){var t=e.call(arguments,0);return He().withMutations((function(e){for(var a=0;a<t.length;a+=2){if(a+1>=t.length)throw new Error("Missing value for key: "+t[a]);e.set(t[a],t[a+1])}}))},Ie.prototype.toString=function(){return this.__toString("Map {","}")},Ie.prototype.get=function(e,t){return this._root?this._root.get(0,void 0,e,t):t},Ie.prototype.set=function(e,t){return Ge(this,e,t)},Ie.prototype.setIn=function(e,t){return this.updateIn(e,g,(function(){return t}))},Ie.prototype.remove=function(e){return Ge(this,e,g)},Ie.prototype.deleteIn=function(e){return this.updateIn(e,(function(){return g}))},Ie.prototype.update=function(e,t,a){return 1===arguments.length?e(this):this.updateIn([e],t,a)},Ie.prototype.updateIn=function(e,t,a){a||(a=t,t=void 0);var n=function e(t,a,n,i){var r=t===g,s=a.next();if(s.done){var o=r?n:t,c=i(o);return c===o?t:c}le(r||t&&t.set,"invalid keyPath");var l=s.value,d=r?g:t.get(l,g),u=e(d,a,n,i);return u===d?t:u===g?t.remove(l):(r?He():t).set(l,u)}(this,Jt(e),t,a);return n===g?void 0:n},Ie.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):He()},Ie.prototype.merge=function(){return Je(this,void 0,arguments)},Ie.prototype.mergeWith=function(t){var a=e.call(arguments,1);return Je(this,t,a)},Ie.prototype.mergeIn=function(t){var a=e.call(arguments,1);return this.updateIn(t,He(),(function(e){return"function"==typeof e.merge?e.merge.apply(e,a):a[a.length-1]}))},Ie.prototype.mergeDeep=function(){return Je(this,$e,arguments)},Ie.prototype.mergeDeepWith=function(t){var a=e.call(arguments,1);return Je(this,Qe(t),a)},Ie.prototype.mergeDeepIn=function(t){var a=e.call(arguments,1);return this.updateIn(t,He(),(function(e){return"function"==typeof e.mergeDeep?e.mergeDeep.apply(e,a):a[a.length-1]}))},Ie.prototype.sort=function(e){return _t(Ut(this,e))},Ie.prototype.sortBy=function(e,t){return _t(Ut(this,t,e))},Ie.prototype.withMutations=function(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this},Ie.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new E)},Ie.prototype.asImmutable=function(){return this.__ensureOwner()},Ie.prototype.wasAltered=function(){return this.__altered},Ie.prototype.__iterator=function(e,t){return new Be(this,e,t)},Ie.prototype.__iterate=function(e,t){var a=this,n=0;return this._root&&this._root.iterate((function(t){return n++,e(t[1],t[0],a)}),t),n},Ie.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?We(this.size,this._root,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},Ie.isMap=Te;var Ne,De="@@__IMMUTABLE_MAP__@@",Pe=Ie.prototype;function Me(e,t){this.ownerID=e,this.entries=t}function Ae(e,t,a){this.ownerID=e,this.bitmap=t,this.nodes=a}function Le(e,t,a){this.ownerID=e,this.count=t,this.nodes=a}function Ue(e,t,a){this.ownerID=e,this.keyHash=t,this.entries=a}function Fe(e,t,a){this.ownerID=e,this.keyHash=t,this.entry=a}function Be(e,t,a){this._type=t,this._reverse=a,this._stack=e._root&&ze(e._root)}function Ve(e,t){return M(e,t[0],t[1])}function ze(e,t){return{node:e,index:0,__prev:t}}function We(e,t,a,n){var i=Object.create(Pe);return i.size=e,i._root=t,i.__ownerID=a,i.__hash=n,i.__altered=!1,i}function He(){return Ne||(Ne=We(0))}function Ge(e,t,a){var n,i;if(e._root){var r=b(v),s=b(f);if(n=qe(e._root,e.__ownerID,0,void 0,t,a,r,s),!s.value)return e;i=e.size+(r.value?a===g?-1:1:0)}else{if(a===g)return e;i=1,n=new Me(e.__ownerID,[[t,a]])}return e.__ownerID?(e.size=i,e._root=n,e.__hash=void 0,e.__altered=!0,e):n?We(i,n):He()}function qe(e,t,a,n,i,r,s,o){return e?e.update(t,a,n,i,r,s,o):r===g?e:(y(o),y(s),new Fe(t,n,[i,r]))}function Ke(e){return e.constructor===Fe||e.constructor===Ue}function Ye(e,t,a,n,i){if(e.keyHash===n)return new Ue(t,n,[e.entry,i]);var r,s=31&(0===a?e.keyHash:e.keyHash>>>a),o=31&(0===a?n:n>>>a);return new Ae(t,1<<s|1<<o,s===o?[Ye(e,t,a+5,n,i)]:(r=new Fe(t,n,i),s<o?[e,r]:[r,e]))}function Je(e,t,a){for(var i=[],r=0;r<a.length;r++){var o=a[r],c=n(o);s(o)||(c=c.map((function(e){return ne(e)}))),i.push(c)}return Xe(e,t,i)}function $e(e,t,a){return e&&e.mergeDeep&&s(t)?e.mergeDeep(t):se(e,t)?e:t}function Qe(e){return function(t,a,n){if(t&&t.mergeDeepWith&&s(a))return t.mergeDeepWith(e,a);var i=e(t,a,n);return se(t,i)?t:i}}function Xe(e,t,a){return 0===(a=a.filter((function(e){return 0!==e.size}))).length?e:0!==e.size||e.__ownerID||1!==a.length?e.withMutations((function(e){for(var n=t?function(a,n){e.update(n,g,(function(e){return e===g?a:t(e,a,n)}))}:function(t,a){e.set(a,t)},i=0;i<a.length;i++)a[i].forEach(n)})):e.constructor(a[0])}function Ze(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,e+=e>>8,127&(e+=e>>16)}function et(e,t,a,n){var i=n?e:_(e);return i[t]=a,i}Pe[De]=!0,Pe.delete=Pe.remove,Pe.removeIn=Pe.deleteIn,Me.prototype.get=function(e,t,a,n){for(var i=this.entries,r=0,s=i.length;r<s;r++)if(se(a,i[r][0]))return i[r][1];return n},Me.prototype.update=function(e,t,a,n,i,r,s){for(var o=i===g,c=this.entries,l=0,d=c.length;l<d&&!se(n,c[l][0]);l++);var u=l<d;if(u?c[l][1]===i:o)return this;if(y(s),(o||!u)&&y(r),!o||1!==c.length){if(!u&&!o&&c.length>=tt)return function(e,t,a,n){e||(e=new E);for(var i=new Fe(e,fe(a),[a,n]),r=0;r<t.length;r++){var s=t[r];i=i.update(e,0,void 0,s[0],s[1])}return i}(e,c,n,i);var m=e&&e===this.ownerID,h=m?c:_(c);return u?o?l===d-1?h.pop():h[l]=h.pop():h[l]=[n,i]:h.push([n,i]),m?(this.entries=h,this):new Me(e,h)}},Ae.prototype.get=function(e,t,a,n){void 0===t&&(t=fe(a));var i=1<<(31&(0===e?t:t>>>e)),r=this.bitmap;return 0==(r&i)?n:this.nodes[Ze(r&i-1)].get(e+5,t,a,n)},Ae.prototype.update=function(e,t,a,n,i,r,s){void 0===a&&(a=fe(n));var o=31&(0===t?a:a>>>t),c=1<<o,l=this.bitmap,d=0!=(l&c);if(!d&&i===g)return this;var u=Ze(l&c-1),m=this.nodes,h=d?m[u]:void 0,p=qe(h,e,t+5,a,n,i,r,s);if(p===h)return this;if(!d&&p&&m.length>=at)return function(e,t,a,n,i){for(var r=0,s=new Array(32),o=0;0!==a;o++,a>>>=1)s[o]=1&a?t[r++]:void 0;return s[n]=i,new Le(e,r+1,s)}(e,m,l,o,p);if(d&&!p&&2===m.length&&Ke(m[1^u]))return m[1^u];if(d&&p&&1===m.length&&Ke(p))return p;var v=e&&e===this.ownerID,f=d?p?l:l^c:l|c,b=d?p?et(m,u,p,v):function(e,t,a){var n=e.length-1;if(a&&t===n)return e.pop(),e;for(var i=new Array(n),r=0,s=0;s<n;s++)s===t&&(r=1),i[s]=e[s+r];return i}(m,u,v):function(e,t,a,n){var i=e.length+1;if(n&&t+1===i)return e[t]=a,e;for(var r=new Array(i),s=0,o=0;o<i;o++)o===t?(r[o]=a,s=-1):r[o]=e[o+s];return r}(m,u,p,v);return v?(this.bitmap=f,this.nodes=b,this):new Ae(e,f,b)},Le.prototype.get=function(e,t,a,n){void 0===t&&(t=fe(a));var i=31&(0===e?t:t>>>e),r=this.nodes[i];return r?r.get(e+5,t,a,n):n},Le.prototype.update=function(e,t,a,n,i,r,s){void 0===a&&(a=fe(n));var o=31&(0===t?a:a>>>t),c=i===g,l=this.nodes,d=l[o];if(c&&!d)return this;var u=qe(d,e,t+5,a,n,i,r,s);if(u===d)return this;var m=this.count;if(d){if(!u&&--m<nt)return function(e,t,a,n){for(var i=0,r=0,s=new Array(a),o=0,c=1,l=t.length;o<l;o++,c<<=1){var d=t[o];void 0!==d&&o!==n&&(i|=c,s[r++]=d)}return new Ae(e,i,s)}(e,l,m,o)}else m++;var h=e&&e===this.ownerID,p=et(l,o,u,h);return h?(this.count=m,this.nodes=p,this):new Le(e,m,p)},Ue.prototype.get=function(e,t,a,n){for(var i=this.entries,r=0,s=i.length;r<s;r++)if(se(a,i[r][0]))return i[r][1];return n},Ue.prototype.update=function(e,t,a,n,i,r,s){void 0===a&&(a=fe(n));var o=i===g;if(a!==this.keyHash)return o?this:(y(s),y(r),Ye(this,e,t,a,[n,i]));for(var c=this.entries,l=0,d=c.length;l<d&&!se(n,c[l][0]);l++);var u=l<d;if(u?c[l][1]===i:o)return this;if(y(s),(o||!u)&&y(r),o&&2===d)return new Fe(e,this.keyHash,c[1^l]);var m=e&&e===this.ownerID,h=m?c:_(c);return u?o?l===d-1?h.pop():h[l]=h.pop():h[l]=[n,i]:h.push([n,i]),m?(this.entries=h,this):new Ue(e,this.keyHash,h)},Fe.prototype.get=function(e,t,a,n){return se(a,this.entry[0])?this.entry[1]:n},Fe.prototype.update=function(e,t,a,n,i,r,s){var o=i===g,c=se(n,this.entry[0]);return(c?i===this.entry[1]:o)?this:(y(s),o?void y(r):c?e&&e===this.ownerID?(this.entry[1]=i,this):new Fe(e,this.keyHash,[n,i]):(y(r),Ye(this,e,t,fe(n),[n,i])))},Me.prototype.iterate=Ue.prototype.iterate=function(e,t){for(var a=this.entries,n=0,i=a.length-1;n<=i;n++)if(!1===e(a[t?i-n:n]))return!1},Ae.prototype.iterate=Le.prototype.iterate=function(e,t){for(var a=this.nodes,n=0,i=a.length-1;n<=i;n++){var r=a[t?i-n:n];if(r&&!1===r.iterate(e,t))return!1}},Fe.prototype.iterate=function(e,t){return e(this.entry)},t(Be,P),Be.prototype.next=function(){for(var e=this._type,t=this._stack;t;){var a,n=t.node,i=t.index++;if(n.entry){if(0===i)return Ve(e,n.entry)}else if(n.entries){if(i<=(a=n.entries.length-1))return Ve(e,n.entries[this._reverse?a-i:i])}else if(i<=(a=n.nodes.length-1)){var r=n.nodes[this._reverse?a-i:i];if(r){if(r.entry)return Ve(e,r.entry);t=this._stack=ze(r,t)}continue}t=this._stack=this._stack.__prev}return{value:void 0,done:!0}};var tt=8,at=16,nt=8;function it(e){var t=pt();if(null==e)return t;if(rt(e))return e;var a=i(e),n=a.size;return 0===n?t:(Re(n),n>0&&n<32?ht(0,n,5,null,new ct(a.toArray())):t.withMutations((function(e){e.setSize(n),a.forEach((function(t,a){return e.set(a,t)}))})))}function rt(e){return!(!e||!e[st])}t(it,he),it.of=function(){return this(arguments)},it.prototype.toString=function(){return this.__toString("List [","]")},it.prototype.get=function(e,t){if((e=S(this,e))>=0&&e<this.size){var a=ft(this,e+=this._origin);return a&&a.array[31&e]}return t},it.prototype.set=function(e,t){return function(e,t,a){if((t=S(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations((function(e){t<0?bt(e,t).set(0,a):bt(e,0,t+1).set(t,a)}));t+=e._origin;var n=e._tail,i=e._root,r=b(f);return t>=Et(e._capacity)?n=gt(n,e.__ownerID,0,t,a,r):i=gt(i,e.__ownerID,e._level,t,a,r),r.value?e.__ownerID?(e._root=i,e._tail=n,e.__hash=void 0,e.__altered=!0,e):ht(e._origin,e._capacity,e._level,i,n):e}(this,e,t)},it.prototype.remove=function(e){return this.has(e)?0===e?this.shift():e===this.size-1?this.pop():this.splice(e,1):this},it.prototype.insert=function(e,t){return this.splice(e,0,t)},it.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=5,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):pt()},it.prototype.push=function(){var e=arguments,t=this.size;return this.withMutations((function(a){bt(a,0,t+e.length);for(var n=0;n<e.length;n++)a.set(t+n,e[n])}))},it.prototype.pop=function(){return bt(this,0,-1)},it.prototype.unshift=function(){var e=arguments;return this.withMutations((function(t){bt(t,-e.length);for(var a=0;a<e.length;a++)t.set(a,e[a])}))},it.prototype.shift=function(){return bt(this,1)},it.prototype.merge=function(){return yt(this,void 0,arguments)},it.prototype.mergeWith=function(t){var a=e.call(arguments,1);return yt(this,t,a)},it.prototype.mergeDeep=function(){return yt(this,$e,arguments)},it.prototype.mergeDeepWith=function(t){var a=e.call(arguments,1);return yt(this,Qe(t),a)},it.prototype.setSize=function(e){return bt(this,0,e)},it.prototype.slice=function(e,t){var a=this.size;return C(e,t,a)?this:bt(this,x(e,a),k(t,a))},it.prototype.__iterator=function(e,t){var a=0,n=mt(this,t);return new P((function(){var t=n();return t===ut?{value:void 0,done:!0}:M(e,a++,t)}))},it.prototype.__iterate=function(e,t){for(var a,n=0,i=mt(this,t);(a=i())!==ut&&!1!==e(a,n++,this););return n},it.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?ht(this._origin,this._capacity,this._level,this._root,this._tail,e,this.__hash):(this.__ownerID=e,this)},it.isList=rt;var st="@@__IMMUTABLE_LIST__@@",ot=it.prototype;function ct(e,t){this.array=e,this.ownerID=t}ot[st]=!0,ot.delete=ot.remove,ot.setIn=Pe.setIn,ot.deleteIn=ot.removeIn=Pe.removeIn,ot.update=Pe.update,ot.updateIn=Pe.updateIn,ot.mergeIn=Pe.mergeIn,ot.mergeDeepIn=Pe.mergeDeepIn,ot.withMutations=Pe.withMutations,ot.asMutable=Pe.asMutable,ot.asImmutable=Pe.asImmutable,ot.wasAltered=Pe.wasAltered,ct.prototype.removeBefore=function(e,t,a){if(a===t?1<<t:0===this.array.length)return this;var n=a>>>t&31;if(n>=this.array.length)return new ct([],e);var i,r=0===n;if(t>0){var s=this.array[n];if((i=s&&s.removeBefore(e,t-5,a))===s&&r)return this}if(r&&!i)return this;var o=vt(this,e);if(!r)for(var c=0;c<n;c++)o.array[c]=void 0;return i&&(o.array[n]=i),o},ct.prototype.removeAfter=function(e,t,a){if(a===(t?1<<t:0)||0===this.array.length)return this;var n,i=a-1>>>t&31;if(i>=this.array.length)return this;if(t>0){var r=this.array[i];if((n=r&&r.removeAfter(e,t-5,a))===r&&i===this.array.length-1)return this}var s=vt(this,e);return s.array.splice(i+1),n&&(s.array[i]=n),s};var lt,dt,ut={};function mt(e,t){var a=e._origin,n=e._capacity,i=Et(n),r=e._tail;return s(e._root,e._level,0);function s(e,o,c){return 0===o?function(e,s){var o=s===i?r&&r.array:e&&e.array,c=s>a?0:a-s,l=n-s;return l>32&&(l=32),function(){if(c===l)return ut;var e=t?--l:c++;return o&&o[e]}}(e,c):function(e,i,r){var o,c=e&&e.array,l=r>a?0:a-r>>i,d=1+(n-r>>i);return d>32&&(d=32),function(){for(;;){if(o){var e=o();if(e!==ut)return e;o=null}if(l===d)return ut;var a=t?--d:l++;o=s(c&&c[a],i-5,r+(a<<i))}}}(e,o,c)}}function ht(e,t,a,n,i,r,s){var o=Object.create(ot);return o.size=t-e,o._origin=e,o._capacity=t,o._level=a,o._root=n,o._tail=i,o.__ownerID=r,o.__hash=s,o.__altered=!1,o}function pt(){return lt||(lt=ht(0,0,5))}function gt(e,t,a,n,i,r){var s,o=n>>>a&31,c=e&&o<e.array.length;if(!c&&void 0===i)return e;if(a>0){var l=e&&e.array[o],d=gt(l,t,a-5,n,i,r);return d===l?e:((s=vt(e,t)).array[o]=d,s)}return c&&e.array[o]===i?e:(y(r),s=vt(e,t),void 0===i&&o===s.array.length-1?s.array.pop():s.array[o]=i,s)}function vt(e,t){return t&&e&&t===e.ownerID?e:new ct(e?e.array.slice():[],t)}function ft(e,t){if(t>=Et(e._capacity))return e._tail;if(t<1<<e._level+5){for(var a=e._root,n=e._level;a&&n>0;)a=a.array[t>>>n&31],n-=5;return a}}function bt(e,t,a){void 0!==t&&(t|=0),void 0!==a&&(a|=0);var n=e.__ownerID||new E,i=e._origin,r=e._capacity,s=i+t,o=void 0===a?r:a<0?r+a:i+a;if(s===i&&o===r)return e;if(s>=o)return e.clear();for(var c=e._level,l=e._root,d=0;s+d<0;)l=new ct(l&&l.array.length?[void 0,l]:[],n),d+=1<<(c+=5);d&&(s+=d,i+=d,o+=d,r+=d);for(var u=Et(r),m=Et(o);m>=1<<c+5;)l=new ct(l&&l.array.length?[l]:[],n),c+=5;var h=e._tail,p=m<u?ft(e,o-1):m>u?new ct([],n):h;if(h&&m>u&&s<r&&h.array.length){for(var g=l=vt(l,n),v=c;v>5;v-=5){var f=u>>>v&31;g=g.array[f]=vt(g.array[f],n)}g.array[u>>>5&31]=h}if(o<r&&(p=p&&p.removeAfter(n,0,o)),s>=m)s-=m,o-=m,c=5,l=null,p=p&&p.removeBefore(n,0,s);else if(s>i||m<u){for(d=0;l;){var b=s>>>c&31;if(b!==m>>>c&31)break;b&&(d+=(1<<c)*b),c-=5,l=l.array[b]}l&&s>i&&(l=l.removeBefore(n,c,s-d)),l&&m<u&&(l=l.removeAfter(n,c,m-d)),d&&(s-=d,o-=d)}return e.__ownerID?(e.size=o-s,e._origin=s,e._capacity=o,e._level=c,e._root=l,e._tail=p,e.__hash=void 0,e.__altered=!0,e):ht(s,o,c,l,p)}function yt(e,t,a){for(var n=[],r=0,o=0;o<a.length;o++){var c=a[o],l=i(c);l.size>r&&(r=l.size),s(c)||(l=l.map((function(e){return ne(e)}))),n.push(l)}return r>e.size&&(e=e.setSize(r)),Xe(e,t,n)}function Et(e){return e<32?0:e-1>>>5<<5}function _t(e){return null==e?Ot():wt(e)?e:Ot().withMutations((function(t){var a=n(e);Re(a.size),a.forEach((function(e,a){return t.set(a,e)}))}))}function wt(e){return Te(e)&&d(e)}function St(e,t,a,n){var i=Object.create(_t.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=a,i.__hash=n,i}function Ot(){return dt||(dt=St(He(),pt()))}function Ct(e,t,a){var n,i,r=e._map,s=e._list,o=r.get(t),c=void 0!==o;if(a===g){if(!c)return e;s.size>=32&&s.size>=2*r.size?(n=(i=s.filter((function(e,t){return void 0!==e&&o!==t}))).toKeyedSeq().map((function(e){return e[0]})).flip().toMap(),e.__ownerID&&(n.__ownerID=i.__ownerID=e.__ownerID)):(n=r.remove(t),i=o===s.size-1?s.pop():s.set(o,void 0))}else if(c){if(a===s.get(o)[1])return e;n=r,i=s.set(o,[t,a])}else n=r.set(t,s.size),i=s.set(s.size,[t,a]);return e.__ownerID?(e.size=n.size,e._map=n,e._list=i,e.__hash=void 0,e):St(n,i)}function xt(e,t){this._iter=e,this._useKeys=t,this.size=e.size}function kt(e){this._iter=e,this.size=e.size}function jt(e){this._iter=e,this.size=e.size}function Rt(e){this._iter=e,this.size=e.size}function It(e){var t=qt(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var t=e.reverse.apply(this);return t.flip=function(){return e.reverse()},t},t.has=function(t){return e.includes(t)},t.includes=function(t){return e.has(t)},t.cacheResult=Kt,t.__iterateUncached=function(t,a){var n=this;return e.__iterate((function(e,a){return!1!==t(a,e,n)}),a)},t.__iteratorUncached=function(t,a){if(2===t){var n=e.__iterator(t,a);return new P((function(){var e=n.next();if(!e.done){var t=e.value[0];e.value[0]=e.value[1],e.value[1]=t}return e}))}return e.__iterator(1===t?0:1,a)},t}function Tt(e,t,a){var n=qt(e);return n.size=e.size,n.has=function(t){return e.has(t)},n.get=function(n,i){var r=e.get(n,g);return r===g?i:t.call(a,r,n,e)},n.__iterateUncached=function(n,i){var r=this;return e.__iterate((function(e,i,s){return!1!==n(t.call(a,e,i,s),i,r)}),i)},n.__iteratorUncached=function(n,i){var r=e.__iterator(2,i);return new P((function(){var i=r.next();if(i.done)return i;var s=i.value,o=s[0];return M(n,o,t.call(a,s[1],o,e),i)}))},n}function Nt(e,t){var a=qt(e);return a._iter=e,a.size=e.size,a.reverse=function(){return e},e.flip&&(a.flip=function(){var t=It(e);return t.reverse=function(){return e.flip()},t}),a.get=function(a,n){return e.get(t?a:-1-a,n)},a.has=function(a){return e.has(t?a:-1-a)},a.includes=function(t){return e.includes(t)},a.cacheResult=Kt,a.__iterate=function(t,a){var n=this;return e.__iterate((function(e,a){return t(e,a,n)}),!a)},a.__iterator=function(t,a){return e.__iterator(t,!a)},a}function Dt(e,t,a,n){var i=qt(e);return n&&(i.has=function(n){var i=e.get(n,g);return i!==g&&!!t.call(a,i,n,e)},i.get=function(n,i){var r=e.get(n,g);return r!==g&&t.call(a,r,n,e)?r:i}),i.__iterateUncached=function(i,r){var s=this,o=0;return e.__iterate((function(e,r,c){if(t.call(a,e,r,c))return o++,i(e,n?r:o-1,s)}),r),o},i.__iteratorUncached=function(i,r){var s=e.__iterator(2,r),o=0;return new P((function(){for(;;){var r=s.next();if(r.done)return r;var c=r.value,l=c[0],d=c[1];if(t.call(a,d,l,e))return M(i,n?l:o++,d,r)}}))},i}function Pt(e,t,a,n){var i=e.size;if(void 0!==t&&(t|=0),void 0!==a&&(a===1/0?a=i:a|=0),C(t,a,i))return e;var r=x(t,i),s=k(a,i);if(r!=r||s!=s)return Pt(e.toSeq().cacheResult(),t,a,n);var o,c=s-r;c==c&&(o=c<0?0:c);var l=qt(e);return l.size=0===o?o:e.size&&o||void 0,!n&&$(e)&&o>=0&&(l.get=function(t,a){return(t=S(this,t))>=0&&t<o?e.get(t+r,a):a}),l.__iterateUncached=function(t,a){var i=this;if(0===o)return 0;if(a)return this.cacheResult().__iterate(t,a);var s=0,c=!0,l=0;return e.__iterate((function(e,a){if(!c||!(c=s++<r))return l++,!1!==t(e,n?a:l-1,i)&&l!==o})),l},l.__iteratorUncached=function(t,a){if(0!==o&&a)return this.cacheResult().__iterator(t,a);var i=0!==o&&e.__iterator(t,a),s=0,c=0;return new P((function(){for(;s++<r;)i.next();if(++c>o)return{value:void 0,done:!0};var e=i.next();return n||1===t?e:M(t,c-1,0===t?void 0:e.value[1],e)}))},l}function Mt(e,t,a,n){var i=qt(e);return i.__iterateUncached=function(i,r){var s=this;if(r)return this.cacheResult().__iterate(i,r);var o=!0,c=0;return e.__iterate((function(e,r,l){if(!o||!(o=t.call(a,e,r,l)))return c++,i(e,n?r:c-1,s)})),c},i.__iteratorUncached=function(i,r){var s=this;if(r)return this.cacheResult().__iterator(i,r);var o=e.__iterator(2,r),c=!0,l=0;return new P((function(){var e,r,d;do{if((e=o.next()).done)return n||1===i?e:M(i,l++,0===i?void 0:e.value[1],e);var u=e.value;r=u[0],d=u[1],c&&(c=t.call(a,d,r,s))}while(c);return 2===i?e:M(i,r,d,e)}))},i}function At(e,t){var a=o(e),i=[e].concat(t).map((function(e){return s(e)?a&&(e=n(e)):e=a?X(e):Z(Array.isArray(e)?e:[e]),e})).filter((function(e){return 0!==e.size}));if(0===i.length)return e;if(1===i.length){var r=i[0];if(r===e||a&&o(r)||c(e)&&c(r))return r}var l=new q(i);return a?l=l.toKeyedSeq():c(e)||(l=l.toSetSeq()),(l=l.flatten(!0)).size=i.reduce((function(e,t){if(void 0!==e){var a=t.size;if(void 0!==a)return e+a}}),0),l}function Lt(e,t,a){var n=qt(e);return n.__iterateUncached=function(n,i){var r=0,o=!1;return function e(c,l){var d=this;c.__iterate((function(i,c){return(!t||l<t)&&s(i)?e(i,l+1):!1===n(i,a?c:r++,d)&&(o=!0),!o}),i)}(e,0),r},n.__iteratorUncached=function(n,i){var r=e.__iterator(n,i),o=[],c=0;return new P((function(){for(;r;){var e=r.next();if(!1===e.done){var l=e.value;if(2===n&&(l=l[1]),t&&!(o.length<t)||!s(l))return a?e:M(n,c++,l,e);o.push(r),r=l.__iterator(n,i)}else r=o.pop()}return{value:void 0,done:!0}}))},n}function Ut(e,t,a){t||(t=Yt);var n=o(e),i=0,r=e.toSeq().map((function(t,n){return[n,t,i++,a?a(t,n,e):t]})).toArray();return r.sort((function(e,a){return t(e[3],a[3])||e[2]-a[2]})).forEach(n?function(e,t){r[t].length=2}:function(e,t){r[t]=e[1]}),n?W(r):c(e)?H(r):G(r)}function Ft(e,t,a){if(t||(t=Yt),a){var n=e.toSeq().map((function(t,n){return[t,a(t,n,e)]})).reduce((function(e,a){return Bt(t,e[1],a[1])?a:e}));return n&&n[0]}return e.reduce((function(e,a){return Bt(t,e,a)?a:e}))}function Bt(e,t,a){var n=e(a,t);return 0===n&&a!==t&&(null==a||a!=a)||n>0}function Vt(e,t,n){var i=qt(e);return i.size=new q(n).map((function(e){return e.size})).min(),i.__iterate=function(e,t){for(var a,n=this.__iterator(1,t),i=0;!(a=n.next()).done&&!1!==e(a.value,i++,this););return i},i.__iteratorUncached=function(e,i){var r=n.map((function(e){return e=a(e),F(i?e.reverse():e)})),s=0,o=!1;return new P((function(){var a;return o||(a=r.map((function(e){return e.next()})),o=a.some((function(e){return e.done}))),o?{value:void 0,done:!0}:M(e,s++,t.apply(null,a.map((function(e){return e.value}))))}))},i}function zt(e,t){return $(e)?t:e.constructor(t)}function Wt(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function Ht(e){return Re(e.size),w(e)}function Gt(e){return o(e)?n:c(e)?i:r}function qt(e){return Object.create((o(e)?W:c(e)?H:G).prototype)}function Kt(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):z.prototype.cacheResult.call(this)}function Yt(e,t){return e>t?1:e<t?-1:0}function Jt(e){var t=F(e);if(!t){if(!V(e))throw new TypeError("Expected iterable or array-like: "+e);t=F(a(e))}return t}function $t(e,t){var a,n=function(r){if(r instanceof n)return r;if(!(this instanceof n))return new n(r);if(!a){a=!0;var s=Object.keys(e);!function(e,t){try{t.forEach(ea.bind(void 0,e))}catch(e){}}(i,s),i.size=s.length,i._name=t,i._keys=s,i._defaultValues=e}this._map=Ie(r)},i=n.prototype=Object.create(Qt);return i.constructor=n,n}t(_t,Ie),_t.of=function(){return this(arguments)},_t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},_t.prototype.get=function(e,t){var a=this._map.get(e);return void 0!==a?this._list.get(a)[1]:t},_t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):Ot()},_t.prototype.set=function(e,t){return Ct(this,e,t)},_t.prototype.remove=function(e){return Ct(this,e,g)},_t.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()},_t.prototype.__iterate=function(e,t){var a=this;return this._list.__iterate((function(t){return t&&e(t[1],t[0],a)}),t)},_t.prototype.__iterator=function(e,t){return this._list.fromEntrySeq().__iterator(e,t)},_t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e),a=this._list.__ensureOwner(e);return e?St(t,a,e,this.__hash):(this.__ownerID=e,this._map=t,this._list=a,this)},_t.isOrderedMap=wt,_t.prototype[p]=!0,_t.prototype.delete=_t.prototype.remove,t(xt,W),xt.prototype.get=function(e,t){return this._iter.get(e,t)},xt.prototype.has=function(e){return this._iter.has(e)},xt.prototype.valueSeq=function(){return this._iter.valueSeq()},xt.prototype.reverse=function(){var e=this,t=Nt(this,!0);return this._useKeys||(t.valueSeq=function(){return e._iter.toSeq().reverse()}),t},xt.prototype.map=function(e,t){var a=this,n=Tt(this,e,t);return this._useKeys||(n.valueSeq=function(){return a._iter.toSeq().map(e,t)}),n},xt.prototype.__iterate=function(e,t){var a,n=this;return this._iter.__iterate(this._useKeys?function(t,a){return e(t,a,n)}:(a=t?Ht(this):0,function(i){return e(i,t?--a:a++,n)}),t)},xt.prototype.__iterator=function(e,t){if(this._useKeys)return this._iter.__iterator(e,t);var a=this._iter.__iterator(1,t),n=t?Ht(this):0;return new P((function(){var i=a.next();return i.done?i:M(e,t?--n:n++,i.value,i)}))},xt.prototype[p]=!0,t(kt,H),kt.prototype.includes=function(e){return this._iter.includes(e)},kt.prototype.__iterate=function(e,t){var a=this,n=0;return this._iter.__iterate((function(t){return e(t,n++,a)}),t)},kt.prototype.__iterator=function(e,t){var a=this._iter.__iterator(1,t),n=0;return new P((function(){var t=a.next();return t.done?t:M(e,n++,t.value,t)}))},t(jt,G),jt.prototype.has=function(e){return this._iter.includes(e)},jt.prototype.__iterate=function(e,t){var a=this;return this._iter.__iterate((function(t){return e(t,t,a)}),t)},jt.prototype.__iterator=function(e,t){var a=this._iter.__iterator(1,t);return new P((function(){var t=a.next();return t.done?t:M(e,t.value,t.value,t)}))},t(Rt,W),Rt.prototype.entrySeq=function(){return this._iter.toSeq()},Rt.prototype.__iterate=function(e,t){var a=this;return this._iter.__iterate((function(t){if(t){Wt(t);var n=s(t);return e(n?t.get(1):t[1],n?t.get(0):t[0],a)}}),t)},Rt.prototype.__iterator=function(e,t){var a=this._iter.__iterator(1,t);return new P((function(){for(;;){var t=a.next();if(t.done)return t;var n=t.value;if(n){Wt(n);var i=s(n);return M(e,i?n.get(0):n[0],i?n.get(1):n[1],t)}}}))},kt.prototype.cacheResult=xt.prototype.cacheResult=jt.prototype.cacheResult=Rt.prototype.cacheResult=Kt,t($t,me),$t.prototype.toString=function(){return this.__toString(Zt(this)+" {","}")},$t.prototype.has=function(e){return this._defaultValues.hasOwnProperty(e)},$t.prototype.get=function(e,t){if(!this.has(e))return t;var a=this._defaultValues[e];return this._map?this._map.get(e,a):a},$t.prototype.clear=function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var e=this.constructor;return e._empty||(e._empty=Xt(this,He()))},$t.prototype.set=function(e,t){if(!this.has(e))throw new Error('Cannot set unknown key "'+e+'" on '+Zt(this));if(this._map&&!this._map.has(e)&&t===this._defaultValues[e])return this;var a=this._map&&this._map.set(e,t);return this.__ownerID||a===this._map?this:Xt(this,a)},$t.prototype.remove=function(e){if(!this.has(e))return this;var t=this._map&&this._map.remove(e);return this.__ownerID||t===this._map?this:Xt(this,t)},$t.prototype.wasAltered=function(){return this._map.wasAltered()},$t.prototype.__iterator=function(e,t){var a=this;return n(this._defaultValues).map((function(e,t){return a.get(t)})).__iterator(e,t)},$t.prototype.__iterate=function(e,t){var a=this;return n(this._defaultValues).map((function(e,t){return a.get(t)})).__iterate(e,t)},$t.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map&&this._map.__ensureOwner(e);return e?Xt(this,t,e):(this.__ownerID=e,this._map=t,this)};var Qt=$t.prototype;function Xt(e,t,a){var n=Object.create(Object.getPrototypeOf(e));return n._map=t,n.__ownerID=a,n}function Zt(e){return e._name||e.constructor.name||"Record"}function ea(e,t){Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(e){le(this.__ownerID,"Cannot set on an immutable record."),this.set(t,e)}})}function ta(e){return null==e?ca():aa(e)&&!d(e)?e:ca().withMutations((function(t){var a=r(e);Re(a.size),a.forEach((function(e){return t.add(e)}))}))}function aa(e){return!(!e||!e[ia])}Qt.delete=Qt.remove,Qt.deleteIn=Qt.removeIn=Pe.removeIn,Qt.merge=Pe.merge,Qt.mergeWith=Pe.mergeWith,Qt.mergeIn=Pe.mergeIn,Qt.mergeDeep=Pe.mergeDeep,Qt.mergeDeepWith=Pe.mergeDeepWith,Qt.mergeDeepIn=Pe.mergeDeepIn,Qt.setIn=Pe.setIn,Qt.update=Pe.update,Qt.updateIn=Pe.updateIn,Qt.withMutations=Pe.withMutations,Qt.asMutable=Pe.asMutable,Qt.asImmutable=Pe.asImmutable,t(ta,pe),ta.of=function(){return this(arguments)},ta.fromKeys=function(e){return this(n(e).keySeq())},ta.prototype.toString=function(){return this.__toString("Set {","}")},ta.prototype.has=function(e){return this._map.has(e)},ta.prototype.add=function(e){return sa(this,this._map.set(e,!0))},ta.prototype.remove=function(e){return sa(this,this._map.remove(e))},ta.prototype.clear=function(){return sa(this,this._map.clear())},ta.prototype.union=function(){var t=e.call(arguments,0);return 0===(t=t.filter((function(e){return 0!==e.size}))).length?this:0!==this.size||this.__ownerID||1!==t.length?this.withMutations((function(e){for(var a=0;a<t.length;a++)r(t[a]).forEach((function(t){return e.add(t)}))})):this.constructor(t[0])},ta.prototype.intersect=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map((function(e){return r(e)}));var a=this;return this.withMutations((function(e){a.forEach((function(a){t.every((function(e){return e.includes(a)}))||e.remove(a)}))}))},ta.prototype.subtract=function(){var t=e.call(arguments,0);if(0===t.length)return this;t=t.map((function(e){return r(e)}));var a=this;return this.withMutations((function(e){a.forEach((function(a){t.some((function(e){return e.includes(a)}))&&e.remove(a)}))}))},ta.prototype.merge=function(){return this.union.apply(this,arguments)},ta.prototype.mergeWith=function(t){var a=e.call(arguments,1);return this.union.apply(this,a)},ta.prototype.sort=function(e){return la(Ut(this,e))},ta.prototype.sortBy=function(e,t){return la(Ut(this,t,e))},ta.prototype.wasAltered=function(){return this._map.wasAltered()},ta.prototype.__iterate=function(e,t){var a=this;return this._map.__iterate((function(t,n){return e(n,n,a)}),t)},ta.prototype.__iterator=function(e,t){return this._map.map((function(e,t){return t})).__iterator(e,t)},ta.prototype.__ensureOwner=function(e){if(e===this.__ownerID)return this;var t=this._map.__ensureOwner(e);return e?this.__make(t,e):(this.__ownerID=e,this._map=t,this)},ta.isSet=aa;var na,ia="@@__IMMUTABLE_SET__@@",ra=ta.prototype;function sa(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function oa(e,t){var a=Object.create(ra);return a.size=e?e.size:0,a._map=e,a.__ownerID=t,a}function ca(){return na||(na=oa(He()))}function la(e){return null==e?pa():da(e)?e:pa().withMutations((function(t){var a=r(e);Re(a.size),a.forEach((function(e){return t.add(e)}))}))}function da(e){return aa(e)&&d(e)}ra[ia]=!0,ra.delete=ra.remove,ra.mergeDeep=ra.merge,ra.mergeDeepWith=ra.mergeWith,ra.withMutations=Pe.withMutations,ra.asMutable=Pe.asMutable,ra.asImmutable=Pe.asImmutable,ra.__empty=ca,ra.__make=oa,t(la,ta),la.of=function(){return this(arguments)},la.fromKeys=function(e){return this(n(e).keySeq())},la.prototype.toString=function(){return this.__toString("OrderedSet {","}")},la.isOrderedSet=da;var ua,ma=la.prototype;function ha(e,t){var a=Object.create(ma);return a.size=e?e.size:0,a._map=e,a.__ownerID=t,a}function pa(){return ua||(ua=ha(Ot()))}function ga(e){return null==e?_a():va(e)?e:_a().unshiftAll(e)}function va(e){return!(!e||!e[ba])}ma[p]=!0,ma.__empty=pa,ma.__make=ha,t(ga,he),ga.of=function(){return this(arguments)},ga.prototype.toString=function(){return this.__toString("Stack [","]")},ga.prototype.get=function(e,t){var a=this._head;for(e=S(this,e);a&&e--;)a=a.next;return a?a.value:t},ga.prototype.peek=function(){return this._head&&this._head.value},ga.prototype.push=function(){if(0===arguments.length)return this;for(var e=this.size+arguments.length,t=this._head,a=arguments.length-1;a>=0;a--)t={value:arguments[a],next:t};return this.__ownerID?(this.size=e,this._head=t,this.__hash=void 0,this.__altered=!0,this):Ea(e,t)},ga.prototype.pushAll=function(e){if(0===(e=i(e)).size)return this;Re(e.size);var t=this.size,a=this._head;return e.reverse().forEach((function(e){t++,a={value:e,next:a}})),this.__ownerID?(this.size=t,this._head=a,this.__hash=void 0,this.__altered=!0,this):Ea(t,a)},ga.prototype.pop=function(){return this.slice(1)},ga.prototype.unshift=function(){return this.push.apply(this,arguments)},ga.prototype.unshiftAll=function(e){return this.pushAll(e)},ga.prototype.shift=function(){return this.pop.apply(this,arguments)},ga.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):_a()},ga.prototype.slice=function(e,t){if(C(e,t,this.size))return this;var a=x(e,this.size);if(k(t,this.size)!==this.size)return he.prototype.slice.call(this,e,t);for(var n=this.size-a,i=this._head;a--;)i=i.next;return this.__ownerID?(this.size=n,this._head=i,this.__hash=void 0,this.__altered=!0,this):Ea(n,i)},ga.prototype.__ensureOwner=function(e){return e===this.__ownerID?this:e?Ea(this.size,this._head,e,this.__hash):(this.__ownerID=e,this.__altered=!1,this)},ga.prototype.__iterate=function(e,t){if(t)return this.reverse().__iterate(e);for(var a=0,n=this._head;n&&!1!==e(n.value,a++,this);)n=n.next;return a},ga.prototype.__iterator=function(e,t){if(t)return this.reverse().__iterator(e);var a=0,n=this._head;return new P((function(){if(n){var t=n.value;return n=n.next,M(e,a++,t)}return{value:void 0,done:!0}}))},ga.isStack=va;var fa,ba="@@__IMMUTABLE_STACK__@@",ya=ga.prototype;function Ea(e,t,a,n){var i=Object.create(ya);return i.size=e,i._head=t,i.__ownerID=a,i.__hash=n,i.__altered=!1,i}function _a(){return fa||(fa=Ea(0))}function wa(e,t){var a=function(a){e.prototype[a]=t[a]};return Object.keys(t).forEach(a),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(a),e}ya[ba]=!0,ya.withMutations=Pe.withMutations,ya.asMutable=Pe.asMutable,ya.asImmutable=Pe.asImmutable,ya.wasAltered=Pe.wasAltered,a.Iterator=P,wa(a,{toArray:function(){Re(this.size);var e=new Array(this.size||0);return this.valueSeq().__iterate((function(t,a){e[a]=t})),e},toIndexedSeq:function(){return new kt(this)},toJS:function(){return this.toSeq().map((function(e){return e&&"function"==typeof e.toJS?e.toJS():e})).__toJS()},toJSON:function(){return this.toSeq().map((function(e){return e&&"function"==typeof e.toJSON?e.toJSON():e})).__toJS()},toKeyedSeq:function(){return new xt(this,!0)},toMap:function(){return Ie(this.toKeyedSeq())},toObject:function(){Re(this.size);var e={};return this.__iterate((function(t,a){e[a]=t})),e},toOrderedMap:function(){return _t(this.toKeyedSeq())},toOrderedSet:function(){return la(o(this)?this.valueSeq():this)},toSet:function(){return ta(o(this)?this.valueSeq():this)},toSetSeq:function(){return new jt(this)},toSeq:function(){return c(this)?this.toIndexedSeq():o(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return ga(o(this)?this.valueSeq():this)},toList:function(){return it(o(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(e,t){return 0===this.size?e+t:e+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+t},concat:function(){var t=e.call(arguments,0);return zt(this,At(this,t))},includes:function(e){return this.some((function(t){return se(t,e)}))},entries:function(){return this.__iterator(2)},every:function(e,t){Re(this.size);var a=!0;return this.__iterate((function(n,i,r){if(!e.call(t,n,i,r))return a=!1,!1})),a},filter:function(e,t){return zt(this,Dt(this,e,t,!0))},find:function(e,t,a){var n=this.findEntry(e,t);return n?n[1]:a},forEach:function(e,t){return Re(this.size),this.__iterate(t?e.bind(t):e)},join:function(e){Re(this.size),e=void 0!==e?""+e:",";var t="",a=!0;return this.__iterate((function(n){a?a=!1:t+=e,t+=null!=n?n.toString():""})),t},keys:function(){return this.__iterator(0)},map:function(e,t){return zt(this,Tt(this,e,t))},reduce:function(e,t,a){var n,i;return Re(this.size),arguments.length<2?i=!0:n=t,this.__iterate((function(t,r,s){i?(i=!1,n=t):n=e.call(a,n,t,r,s)})),n},reduceRight:function(e,t,a){var n=this.toKeyedSeq().reverse();return n.reduce.apply(n,arguments)},reverse:function(){return zt(this,Nt(this,!0))},slice:function(e,t){return zt(this,Pt(this,e,t,!0))},some:function(e,t){return!this.every(ka(e),t)},sort:function(e){return zt(this,Ut(this,e))},values:function(){return this.__iterator(1)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some((function(){return!0}))},count:function(e,t){return w(e?this.toSeq().filter(e,t):this)},countBy:function(e,t){return function(e,t,a){var n=Ie().asMutable();return e.__iterate((function(i,r){n.update(t.call(a,i,r,e),0,(function(e){return e+1}))})),n.asImmutable()}(this,e,t)},equals:function(e){return oe(this,e)},entrySeq:function(){var e=this;if(e._cache)return new q(e._cache);var t=e.toSeq().map(xa).toIndexedSeq();return t.fromEntrySeq=function(){return e.toSeq()},t},filterNot:function(e,t){return this.filter(ka(e),t)},findEntry:function(e,t,a){var n=a;return this.__iterate((function(a,i,r){if(e.call(t,a,i,r))return n=[i,a],!1})),n},findKey:function(e,t){var a=this.findEntry(e,t);return a&&a[0]},findLast:function(e,t,a){return this.toKeyedSeq().reverse().find(e,t,a)},findLastEntry:function(e,t,a){return this.toKeyedSeq().reverse().findEntry(e,t,a)},findLastKey:function(e,t){return this.toKeyedSeq().reverse().findKey(e,t)},first:function(){return this.find(O)},flatMap:function(e,t){return zt(this,function(e,t,a){var n=Gt(e);return e.toSeq().map((function(i,r){return n(t.call(a,i,r,e))})).flatten(!0)}(this,e,t))},flatten:function(e){return zt(this,Lt(this,e,!0))},fromEntrySeq:function(){return new Rt(this)},get:function(e,t){return this.find((function(t,a){return se(a,e)}),void 0,t)},getIn:function(e,t){for(var a,n=this,i=Jt(e);!(a=i.next()).done;){var r=a.value;if((n=n&&n.get?n.get(r,g):g)===g)return t}return n},groupBy:function(e,t){return function(e,t,a){var n=o(e),i=(d(e)?_t():Ie()).asMutable();e.__iterate((function(r,s){i.update(t.call(a,r,s,e),(function(e){return(e=e||[]).push(n?[s,r]:r),e}))}));var r=Gt(e);return i.map((function(t){return zt(e,r(t))}))}(this,e,t)},has:function(e){return this.get(e,g)!==g},hasIn:function(e){return this.getIn(e,g)!==g},isSubset:function(e){return e="function"==typeof e.includes?e:a(e),this.every((function(t){return e.includes(t)}))},isSuperset:function(e){return(e="function"==typeof e.isSubset?e:a(e)).isSubset(this)},keyOf:function(e){return this.findKey((function(t){return se(t,e)}))},keySeq:function(){return this.toSeq().map(Ca).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},lastKeyOf:function(e){return this.toKeyedSeq().reverse().keyOf(e)},max:function(e){return Ft(this,e)},maxBy:function(e,t){return Ft(this,t,e)},min:function(e){return Ft(this,e?ja(e):Ta)},minBy:function(e,t){return Ft(this,t?ja(t):Ta,e)},rest:function(){return this.slice(1)},skip:function(e){return this.slice(Math.max(0,e))},skipLast:function(e){return zt(this,this.toSeq().reverse().skip(e).reverse())},skipWhile:function(e,t){return zt(this,Mt(this,e,t,!0))},skipUntil:function(e,t){return this.skipWhile(ka(e),t)},sortBy:function(e,t){return zt(this,Ut(this,t,e))},take:function(e){return this.slice(0,Math.max(0,e))},takeLast:function(e){return zt(this,this.toSeq().reverse().take(e).reverse())},takeWhile:function(e,t){return zt(this,function(e,t,a){var n=qt(e);return n.__iterateUncached=function(n,i){var r=this;if(i)return this.cacheResult().__iterate(n,i);var s=0;return e.__iterate((function(e,i,o){return t.call(a,e,i,o)&&++s&&n(e,i,r)})),s},n.__iteratorUncached=function(n,i){var r=this;if(i)return this.cacheResult().__iterator(n,i);var s=e.__iterator(2,i),o=!0;return new P((function(){if(!o)return{value:void 0,done:!0};var e=s.next();if(e.done)return e;var i=e.value,c=i[0],l=i[1];return t.call(a,l,c,r)?2===n?e:M(n,c,l,e):(o=!1,{value:void 0,done:!0})}))},n}(this,e,t))},takeUntil:function(e,t){return this.takeWhile(ka(e),t)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function(e){if(e.size===1/0)return 0;var t=d(e),a=o(e),n=t?1:0;return function(e,t){return t=ge(t,3432918353),t=ge(t<<15|t>>>-15,461845907),t=ge(t<<13|t>>>-13,5),t=ge((t=(t+3864292196|0)^e)^t>>>16,2246822507),t=ve((t=ge(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(a?t?function(e,t){n=31*n+Na(fe(e),fe(t))|0}:function(e,t){n=n+Na(fe(e),fe(t))|0}:t?function(e){n=31*n+fe(e)|0}:function(e){n=n+fe(e)|0}),n)}(this))}});var Sa=a.prototype;Sa[u]=!0,Sa[D]=Sa.values,Sa.__toJS=Sa.toArray,Sa.__toStringMapper=Ra,Sa.inspect=Sa.toSource=function(){return this.toString()},Sa.chain=Sa.flatMap,Sa.contains=Sa.includes,wa(n,{flip:function(){return zt(this,It(this))},mapEntries:function(e,t){var a=this,n=0;return zt(this,this.toSeq().map((function(i,r){return e.call(t,[r,i],n++,a)})).fromEntrySeq())},mapKeys:function(e,t){var a=this;return zt(this,this.toSeq().flip().map((function(n,i){return e.call(t,n,i,a)})).flip())}});var Oa=n.prototype;function Ca(e,t){return t}function xa(e,t){return[t,e]}function ka(e){return function(){return!e.apply(this,arguments)}}function ja(e){return function(){return-e.apply(this,arguments)}}function Ra(e){return"string"==typeof e?JSON.stringify(e):String(e)}function Ia(){return _(arguments)}function Ta(e,t){return e<t?1:e>t?-1:0}function Na(e,t){return e^t+2654435769+(e<<6)+(e>>2)|0}return Oa[m]=!0,Oa[D]=Sa.entries,Oa.__toJS=Sa.toObject,Oa.__toStringMapper=function(e,t){return JSON.stringify(t)+": "+Ra(e)},wa(i,{toKeyedSeq:function(){return new xt(this,!1)},filter:function(e,t){return zt(this,Dt(this,e,t,!1))},findIndex:function(e,t){var a=this.findEntry(e,t);return a?a[0]:-1},indexOf:function(e){var t=this.keyOf(e);return void 0===t?-1:t},lastIndexOf:function(e){var t=this.lastKeyOf(e);return void 0===t?-1:t},reverse:function(){return zt(this,Nt(this,!1))},slice:function(e,t){return zt(this,Pt(this,e,t,!1))},splice:function(e,t){var a=arguments.length;if(t=Math.max(0|t,0),0===a||2===a&&!t)return this;e=x(e,e<0?this.count():this.size);var n=this.slice(0,e);return zt(this,1===a?n:n.concat(_(arguments,2),this.slice(e+t)))},findLastIndex:function(e,t){var a=this.findLastEntry(e,t);return a?a[0]:-1},first:function(){return this.get(0)},flatten:function(e){return zt(this,Lt(this,e,!1))},get:function(e,t){return(e=S(this,e))<0||this.size===1/0||void 0!==this.size&&e>this.size?t:this.find((function(t,a){return a===e}),void 0,t)},has:function(e){return(e=S(this,e))>=0&&(void 0!==this.size?this.size===1/0||e<this.size:-1!==this.indexOf(e))},interpose:function(e){return zt(this,function(e,t){var a=qt(e);return a.size=e.size&&2*e.size-1,a.__iterateUncached=function(a,n){var i=this,r=0;return e.__iterate((function(e,n){return(!r||!1!==a(t,r++,i))&&!1!==a(e,r++,i)}),n),r},a.__iteratorUncached=function(a,n){var i,r=e.__iterator(1,n),s=0;return new P((function(){return(!i||s%2)&&(i=r.next()).done?i:s%2?M(a,s++,t):M(a,s++,i.value,i)}))},a}(this,e))},interleave:function(){var e=[this].concat(_(arguments)),t=Vt(this.toSeq(),H.of,e),a=t.flatten(!0);return t.size&&(a.size=t.size*e.length),zt(this,a)},keySeq:function(){return de(0,this.size)},last:function(){return this.get(-1)},skipWhile:function(e,t){return zt(this,Mt(this,e,t,!1))},zip:function(){var e=[this].concat(_(arguments));return zt(this,Vt(this,Ia,e))},zipWith:function(e){var t=_(arguments);return t[0]=this,zt(this,Vt(this,e,t))}}),i.prototype[h]=!0,i.prototype[p]=!0,wa(r,{get:function(e,t){return this.has(e)?e:t},includes:function(e){return this.has(e)},keySeq:function(){return this.valueSeq()}}),r.prototype.has=Sa.includes,r.prototype.contains=r.prototype.includes,wa(W,n.prototype),wa(H,i.prototype),wa(G,r.prototype),wa(me,n.prototype),wa(he,i.prototype),wa(pe,r.prototype),{Iterable:a,Seq:z,Collection:ue,Map:Ie,OrderedMap:_t,List:it,Stack:ga,Set:ta,OrderedSet:la,Record:$t,Range:de,Repeat:ce,is:se,fromJS:ne}}()},1427:function(e,t,a){"use strict";var n=a(843),i=a(242);e.exports=function(e){return{getInitialState:function(){return this.constructor.calculateState||i(!1),this.constructor.calculateState(null)},componentDidMount:function(){var t=this,a=!1,i=function(){a=!0};this._fluxMixinSubscriptions=e.map((function(e){return e.addListener(i)}));this._fluxMixinStoreGroup=new n(e,(function(){a&&t.setState((function(e){return t.constructor.calculateState(t.state)})),a=!1}))},componentWillUnmount:function(){this._fluxMixinStoreGroup.release();var e=this._fluxMixinSubscriptions,t=Array.isArray(e),a=0;for(e=t?e:e[Symbol.iterator]();;){var n;if(t){if(a>=e.length)break;n=e[a++]}else{if((a=e.next()).done)break;n=a.value}n.remove()}this._fluxMixinSubscriptions=[]}}}},1428:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(107),s=a(7),o=a(100),c=a(348),l=a(94),d=a(171),u=a(95),m=a(98);function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class g extends d.a{constructor(){super(l.a,{reportedSessionIds:new Set,lastRageshakeTime:0,initialSyncCompleted:!1}),this.onDecryptionAttempt=this.onDecryptionAttempt.bind(this),this.onDeviceMessage=this.onDeviceMessage.bind(this),this.onSyncStateChange=this.onSyncStateChange.bind(this)}static get instance(){return g.internalInstance}async onAction(e){switch(e.action){case m.a.ReportKeyBackupNotEnabled:this.onReportKeyBackupNotEnabled()}}async onReady(){u.b.getValue("automaticDecryptionErrorReporting")&&this.matrixClient&&(this.matrixClient.on(r.MatrixEventEvent.Decrypted,this.onDecryptionAttempt),this.matrixClient.on(r.ClientEvent.ToDeviceEvent,this.onDeviceMessage),this.matrixClient.on(r.ClientEvent.Sync,this.onSyncStateChange))}async onNotReady(){this.matrixClient&&(this.matrixClient.removeListener(r.ClientEvent.ToDeviceEvent,this.onDeviceMessage),this.matrixClient.removeListener(r.MatrixEventEvent.Decrypted,this.onDecryptionAttempt),this.matrixClient.removeListener(r.ClientEvent.Sync,this.onSyncStateChange))}async onDecryptionAttempt(e){if(!this.state.initialSyncCompleted)return;const t=e.getWireContent(),a=t.session_id;if(e.isDecryptionFailure()&&!this.state.reportedSessionIds.has(a)){if(await Object(s.H)(5e3),!e.isDecryptionFailure())return;const n=new Set(this.state.reportedSessionIds);await this.updateState({reportedSessionIds:n.add(a)});const i=(new Date).getTime();if(i-this.state.lastRageshakeTime<6e4)return;await this.updateState({lastRageshakeTime:i});const r={event_id:e.getId(),room_id:e.getRoomId(),session_id:a,device_id:t.device_id,user_id:e.getSender(),sender_key:t.sender_key},l=await Object(c.a)(o.b.get().bug_report_endpoint_url,{userText:"Auto-reporting decryption error (recipient)",sendLogs:!0,labels:["Z-UISI","web","uisi-recipient"],customApp:o.b.get().uisi_autorageshake_app,customFields:{auto_uisi:JSON.stringify(r)}}),d=p(p({},r),{},{recipient_rageshake:l});this.matrixClient.sendToDevice("im.vector.auto_rs_request",{[d.user_id]:{[d.device_id]:d}})}}async onSyncStateChange(e,t,a){this.state.initialSyncCompleted||await this.updateState({initialSyncCompleted:!!a.nextSyncToken})}async onDeviceMessage(e){if("im.vector.auto_rs_request"!==e.getType())return;const t=e.getContent(),a=t.recipient_rageshake||"",n=(new Date).getTime();n-this.state.lastRageshakeTime>6e4&&(await this.updateState({lastRageshakeTime:n}),await Object(c.a)(o.b.get().bug_report_endpoint_url,{userText:"Auto-reporting decryption error (sender)\nRecipient rageshake: "+a,sendLogs:!0,labels:["Z-UISI","web","uisi-sender"],customApp:o.b.get().uisi_autorageshake_app,customFields:{recipient_rageshake:a,auto_uisi:JSON.stringify(t)}}))}async onReportKeyBackupNotEnabled(){u.b.getValue("automaticKeyBackNotEnabledReporting")&&await Object(c.a)(o.b.get().bug_report_endpoint_url,{userText:"Auto-reporting key backup not enabled",sendLogs:!0,labels:["web",m.a.ReportKeyBackupNotEnabled]})}}i()(g,"internalInstance",(()=>{const e=new g;return e.start(),e})()),window.mxAutoRageshakeStore=g.instance},1429:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(6),i=a.n(n),r=a(8),s=a(116);class o extends r.EventEmitter{constructor(){super(...arguments),i()(this,"_isResizing",!1),i()(this,"throttledMiddlePanel",Object(s.throttle)(()=>this.emit("middlePanelResized"),200))}get isResizing(){return this._isResizing}startResizing(){this._isResizing=!0,this.emit("isResizing",!0)}stopResizing(){this._isResizing=!1,this.emit("isResizing",!1)}noisyMiddlePanel(){this.emit("middlePanelResizedNoisy")}updateMiddlePanel(){this.throttledMiddlePanel(),this.noisyMiddlePanel()}notifyLeftHandleResized(){this.updateMiddlePanel()}notifyRightHandleResized(){this.updateMiddlePanel()}notifyTimelineHeightChanged(){this.updateMiddlePanel()}notifyWindowResized(){this.updateMiddlePanel()}}},1430:function(e,t,a){"use strict";(function(e){var n=a(101),i=a.n(n),r=a(96),s=a.n(r),o=a(116),c=a(107),l=a(7),d=a(90),u=a.n(d),m=a(401),h=a.n(m),p=a(110),g=a(139),v=a(131),f=a(98),b=a(94),y=a(1431),E=a(1432),_=a(1433),w=a(1434),S=a(142),O=a(1435),C=a(1436),x=a(121),k=a(91),j=a(92),R=a(97),I=a(166),T=a(351),N=a(199),D=a(106),P=a(95),M=a(432),A=a(184),L=a(399),U=a(130),F=a(177),B=a(149),V=a(368),z=a(133),W=a(135),H=a(648),G=a(152),q=a(153),K=a(285),Y=a(811),J=a(891),$=a(93),Q=a(842),X=a(104),Z=a(217),ee=a(105),te=a(584),ae=a(1437),ne=a(1438),ie=a(1439),re=a(608),se=a(1440),oe=a(186),ce=a(349),le=a(132);function de(e){var t,a;return!0===(null===(t=e.current)||void 0===t||null===(a=t.id)||void 0===a?void 0:a.startsWith("mx_SpotlightDialog_button_recentlyViewed_"))}function ue(e,t){const a=new Set;return e&&a.add(null),t&&a.add(c.RoomType.Space),a}var me;let he;function pe(e){switch(e){case he.People:return Object(k.a)("People");case he.PublicRooms:return Object(k.a)("Public rooms")}}!function(e){e[e.People=0]="People",e[e.Rooms=1]="Rooms",e[e.Spaces=2]="Spaces",e[e.Suggestions=3]="Suggestions",e[e.PublicRooms=4]="PublicRooms"}(me||(me={})),function(e){e[e.People=0]="People",e[e.PublicRooms=1]="PublicRooms"}(he||(he={}));const ge=e=>!(null==e||!e.room),ve=e=>!(null==e||!e.publicRoom),fe=e=>!(null==e||!e.member),be=e=>{var t,a,n,i,r;return{publicRoom:e,section:me.PublicRooms,filter:[he.PublicRooms],query:[e.room_id.toLowerCase(),null===(t=e.canonical_alias)||void 0===t?void 0:t.toLowerCase(),null===(a=e.name)||void 0===a?void 0:a.toLowerCase(),h()(null!==(n=null===(i=e.topic)||void 0===i?void 0:i.toLowerCase())&&void 0!==n?n:"",{allowedTags:[]}),...(null===(r=e.aliases)||void 0===r?void 0:r.map(e=>e.toLowerCase()))||[]].filter(Boolean)}},ye=e=>{const t=j.a.get().getUserId();if(z.a.shared().getUserIdForRoomId(e.roomId)){const a=e.getMembers().filter(e=>e.userId!==t),n=[...a.map(e=>e.name.toLowerCase()),...a.map(e=>e.userId.toLowerCase())].filter(Boolean);return{room:e,section:me.People,filter:[he.People],query:n}}return e.isSpaceRoom()?{room:e,section:me.Spaces,filter:[]}:{room:e,section:me.Rooms,filter:[]}},Ee=e=>({member:e,section:me.Suggestions,filter:[he.People],query:[e.userId.toLowerCase(),e.name.toLowerCase()].filter(Boolean)}),_e=new L.a,we=e=>e.getVisibleRooms().filter(e=>!Object(oe.a)(e)&&("join"===e.getMyMembership()||"invite"==e.getMyMembership())),Se=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Object.values(we(e).filter(e=>!t||!z.a.shared().getUserIdForRoomId(e.roomId)).reduce((e,t)=>{for(const a of t.getJoinedMembers())e[a.userId]=a;return e},{})).filter(t=>t.userId!==e.getUserId())},Oe=(e,t)=>t.hasMentions?Object(k.a)("%(count)s unread messages including mentions.",{count:t.count}):t.hasUnreadCount?Object(k.a)("%(count)s unread messages.",{count:t.count}):t.isUnread?Object(k.a)("Unread messages."):void 0,Ce=t=>{var a,n;let{initialText:r="",initialFilter:m=null,onFinished:h}=t;const L=Object(d.useRef)(),oe=Object(d.useRef)(),Ce=j.a.get(),xe=Object(d.useContext)(g.c),[ke,je]=Object(d.useState)(r),[Re,Ie]=Object(E.a)(),[Te,Ne]=Object(d.useState)(m),De=Object(d.useCallback)(e=>{var t,a,n;Ne(e),null===(t=L.current)||void 0===t||t.focus(),null===(a=oe.current)||void 0===a||null===(n=a.scrollTo)||void 0===n||n.call(a,{top:0})},[]),Pe=Object(d.useMemo)(()=>{const e=Object(H.a)(Ce),t=Object(H.b)(Ce);return Object(H.c)(e,t)},[Ce]),Me=Object(W.i)(Ce.getUserId()),[Ae,Le]=Object(d.useState)(!1),Ue=Object(d.useMemo)(()=>ke.trim(),[ke]),Fe=Object(S.a)("feature_exploring_public_spaces"),{loading:Be,publicRooms:Ve,protocols:ze,config:We,setConfig:He,search:Ge}=Object(w.a)(),[qe,Ke]=Object(d.useState)(!0),[Ye,Je]=Object(d.useState)(!1),{loading:$e,users:Qe,search:Xe}=Object(C.a)(),{loading:Ze,profile:et,search:tt}=Object(_.a)(),at=Object(d.useMemo)(()=>[{query:Ue,roomTypes:ue(qe,Ye),limit:50}],[Ue,qe,Ye]);Object(y.a)(Te===he.PublicRooms,Ge,at),Object(y.a)(Te===he.People,Xe,at),Object(y.a)(Te===he.People,tt,at);const nt=Object(d.useMemo)(()=>{const e=[],t=we(Ce).map(ye),a=t.reduce((e,t)=>{const a=z.a.shared().getUserIdForRoomId(t.room.roomId);return a?(t.room.getJoinedMemberCount()>2||e.add(a),e):e},new Set);for(const t of[...Se(Ce),...Qe])a.has(t.userId)||(a.add(t.userId),e.push(Ee(t)));return[...B.a.instance.enabledMetaSpaces.map(e=>({section:me.Spaces,filter:[],avatar:u.a.createElement("div",{className:s()("mx_SpotlightDialog_metaspaceResult","mx_SpotlightDialog_metaspaceResult_"+e)}),name:Object(F.g)(e,B.a.instance.allRoomsInHome),onClick(){B.a.instance.setActiveSpace(e)}})),...t,...e,...(et&&!a.has(et.user_id)?[new V.a(et)]:[]).map(Ee),...Ve.map(be)].filter(e=>null===Te||e.filter.includes(Te))},[Ce,Qe,et,Ve,Te]),it=Object(d.useMemo)(()=>{const e={[me.People]:[],[me.Rooms]:[],[me.Spaces]:[],[me.Suggestions]:[],[me.PublicRooms]:[]};if(Ue){const t=Ue.toLowerCase(),a=Object(l.x)(Ue);nt.forEach(n=>{var i,r,s;if(ge(n)){if(!(null!==(i=n.room.normalizedName)&&void 0!==i&&i.includes(a)||null!==(r=n.room.getCanonicalAlias())&&void 0!==r&&r.toLowerCase().includes(t)||null!==(s=n.query)&&void 0!==s&&s.some(e=>e.includes(t))))return}else if(fe(n)){var o;if(null===(o=n.query)||void 0===o||!o.some(e=>e.includes(t)))return}else if(ve(n)){var c;if(null===(c=n.query)||void 0===c||!c.some(e=>e.includes(t)))return}else{var l;if(!(n.name.toLowerCase().includes(t)||null!==(l=n.query)&&void 0!==l&&l.some(e=>e.includes(t))))return}e[n.section].push(n)})}else Te===he.PublicRooms?nt.forEach(t=>{ve(t)&&e[t.section].push(t)}):Te===he.People&&nt.forEach(t=>{fe(t)&&e[t.section].push(t)});const t=Ce.getUserId();for(const a of Object.values(e))a.sort((e,a)=>ge(e)||ge(a)?ge(a)&&ge(e)?_e.getLastTs(a.room,t)-_e.getLastTs(e.room,t):-1:fe(e)||fe(a)?fe(a)&&fe(e)?Pe(e.member,a.member):-1:void 0);return e},[Ue,Te,Ce,nt,Pe]);((e,t,a)=>{Object(d.useEffect)(()=>{if(!t)return;const n=setTimeout(()=>{I.a.instance.trackEvent({eventName:"WebSearch",viaSpotlight:a,numResults:e,queryLength:t})},1e3);return()=>{clearTimeout(n)}},[e,t,a])})(Object(o.sum)(Object.values(it).map(e=>e.length)),ke.length,!0);const rt=B.a.instance.activeSpaceRoom,[st,ot]=Object(O.a)(rt,ke);Object(d.useEffect)(()=>{e(()=>{var e,t,a;let n;xe.state.refs&&(n=xe.state.refs[0]),xe.dispatch({type:g.f.SetFocus,payload:{ref:n}}),null===(e=n)||void 0===e||null===(t=e.current)||void 0===t||null===(a=t.scrollIntoView)||void 0===a||a.call(t,{block:"nearest"})})},[it,Te]);const ct=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t){const t=new Set(P.b.getValue("SpotlightSearch.recentSearches",null).reverse());t.delete(e.roomId),t.add(e.roomId),P.b.setValue("SpotlightSearch.recentSearches",null,D.a.ACCOUNT,Array.from(t).reverse().slice(0,10))}b.a.dispatch({action:f.a.ViewRoom,metricsTrigger:"WebUnifiedSearch",metricsViaKeyboard:a,room_id:e.roomId,room_alias:e.roomAlias,auto_join:e.autoJoin,should_peek:e.shouldPeek}),h()};let lt,dt;if((Ue||Te!==he.PublicRooms)&&(lt=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_otherSearches"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_otherSearches"},Ue?Object(k.a)('Use "%(query)s" to search',{query:ke}):Object(k.a)("Search for")),u.a.createElement("div",null,Te!==he.PublicRooms&&u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_explorePublicRooms",className:"mx_SpotlightDialog_explorePublicRooms",onClick:()=>De(he.PublicRooms)},pe(he.PublicRooms)),Te!==he.People&&u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_startChat",className:"mx_SpotlightDialog_startChat",onClick:()=>De(he.People)},pe(he.People))))),Ue||null!==Te){const e=e=>{if(ge(e)){const t=A.a.instance.getRoomState(e.room),a=Oe(e.room,t),n={"aria-label":a?`${e.room.name} ${a}`:e.room.name,"aria-describedby":`mx_SpotlightDialog_button_result_${e.room.roomId}_details`};return u.a.createElement(ae.a,i()({id:"mx_SpotlightDialog_button_result_"+e.room.roomId,key:`${me[e.section]}-${e.room.roomId}`,onClick:t=>{ct({roomId:e.room.roomId},!0,"click"!==(null==t?void 0:t.type))},endAdornment:u.a.createElement(ie.a,{room:e.room})},n),u.a.createElement(K.a,{room:e.room,avatarSize:24,tooltipProps:{tabIndex:-1}}),e.room.name,u.a.createElement(Z.a,{notification:t}),u.a.createElement(re.a,{id:`mx_SpotlightDialog_button_result_${e.room.roomId}_details`,className:"mx_SpotlightDialog_result_details",room:e.room}))}if(fe(e))return u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_result_"+e.member.userId,key:`${me[e.section]}-${e.member.userId}`,onClick:()=>{Object(V.e)(Ce,[e.member]),h()},"aria-label":e.member instanceof c.RoomMember?e.member.rawDisplayName:e.member.name,"aria-describedby":`mx_SpotlightDialog_button_result_${e.member.userId}_details`},u.a.createElement(Y.a,{user:e.member,size:24}),e.member instanceof c.RoomMember?e.member.rawDisplayName:e.member.name,u.a.createElement("div",{id:`mx_SpotlightDialog_button_result_${e.member.userId}_details`,className:"mx_SpotlightDialog_result_details"},e.member.userId));if(ve(e)){const t=Ce.getRoom(e.publicRoom.room_id),a="join"===(null==t?void 0:t.getMyMembership())||e.publicRoom.world_readable||Ce.isGuest(),n=t=>{var a;const{publicRoom:n}=e;ct({roomAlias:n.canonical_alias||(null===(a=n.aliases)||void 0===a?void 0:a[0]),roomId:n.room_id,autoJoin:!e.publicRoom.world_readable&&!Ce.isGuest(),shouldPeek:e.publicRoom.world_readable||Ce.isGuest()},!0,"click"!==t.type)};return u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_result_"+e.publicRoom.room_id,className:"mx_SpotlightDialog_result_multiline",key:`${me[e.section]}-${e.publicRoom.room_id}`,onClick:n,endAdornment:u.a.createElement($.a,{kind:a?"primary_outline":"primary",onClick:n,tabIndex:-1},a?Object(k.a)("View"):Object(k.a)("Join")),"aria-labelledby":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_name`,"aria-describedby":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_alias`,"aria-details":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_details`},u.a.createElement(le.a,{className:"mx_SearchResultAvatar",oobData:{roomId:e.publicRoom.room_id,name:e.publicRoom.name,avatarUrl:e.publicRoom.avatar_url,roomType:e.publicRoom.room_type},width:24,height:24}),u.a.createElement(ne.a,{room:e.publicRoom,labelId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_name`,descriptionId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_alias`,detailsId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_details`}))}return u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_result_"+e.name,key:`${me[e.section]}-${e.name}`,onClick:e.onClick},e.avatar,e.name,e.description)};let t,a,n,r,s,l,d,m,p,g;it[me.People].length&&(t=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_people"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_people"},Object(k.a)("Recent Conversations")),u.a.createElement("div",null,it[me.People].slice(0,50).map(e)))),it[me.Suggestions].length&&Te===he.People&&(a=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_suggestions"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_suggestions"},Object(k.a)("Suggestions")),u.a.createElement("div",null,it[me.Suggestions].slice(0,50).map(e)))),it[me.Rooms].length&&(n=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_rooms"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_rooms"},Object(k.a)("Rooms")),u.a.createElement("div",null,it[me.Rooms].slice(0,50).map(e)))),it[me.Spaces].length&&(r=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_spaces"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_spaces"},Object(k.a)("Spaces you're in")),u.a.createElement("div",null,it[me.Spaces].slice(0,50).map(e)))),Te===he.PublicRooms&&(s=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_publicRooms"},u.a.createElement("div",{className:"mx_SpotlightDialog_sectionHeader"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_publicRooms"},Object(k.a)("Suggestions")),u.a.createElement("div",{className:"mx_SpotlightDialog_options"},Fe&&u.a.createElement(u.a.Fragment,null,u.a.createElement(Q.a,{label:Object(k.a)("Show rooms"),value:qe,onChange:Ke}),u.a.createElement(Q.a,{label:Object(k.a)("Show spaces"),value:Ye,onChange:Je})),u.a.createElement(J.a,{protocols:ze,config:null!=We?We:null,setConfig:He}))),u.a.createElement("div",null," ",qe||Ye?it[me.PublicRooms].slice(0,50).map(e):u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(k.a)("You cannot search for rooms that are neither a room nor a space"))," "))),st.length&&rt&&null===Te&&(l=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_spaceRooms"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_spaceRooms"},Object(k.a)("Other rooms in %(spaceName)s",{spaceName:rt.name})),u.a.createElement("div",null,st.slice(0,50).map(e=>u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_result_"+e.room_id,key:e.room_id,onClick:t=>{ct({roomId:e.room_id},!0,"click"!==(null==t?void 0:t.type))}},u.a.createElement(q.a,{name:e.name,idName:e.room_id,url:e.avatar_url?Object(v.b)(e.avatar_url).getSquareThumbnailHttp(24):null,width:24,height:24}),e.name||e.canonical_alias,e.name&&e.canonical_alias&&u.a.createElement("div",{className:"mx_SpotlightDialog_result_details"},e.canonical_alias))),ot&&u.a.createElement(X.a,null)))),!Ue.startsWith("#")||!Ue.includes(":")||Object(T.a)(Ue)&&Ce.getRoom(Object(T.a)(Ue))||(d=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group"},u.a.createElement("div",null,u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_joinRoomAlias",className:"mx_SpotlightDialog_joinRoomAlias",onClick:e=>{b.a.dispatch({action:f.a.ViewRoom,room_alias:Ue,auto_join:!0,metricsTrigger:"WebUnifiedSearch",metricsViaKeyboard:"click"!==(null==e?void 0:e.type)}),h()}},Object(k.a)("Join %(roomAddress)s",{roomAddress:Ue}))))),Te===he.People?m=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_hiddenResults",role:"group"},u.a.createElement("h4",null,Object(k.a)("Some results may be hidden for privacy")),u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(k.a)("If you can't see who you're looking for, send them your invite link.")),u.a.createElement(se.a,{id:"mx_SpotlightDialog_button_inviteLink",className:"mx_SpotlightDialog_inviteLink",onClick:()=>{Le(!0),Object(G.c)(Me)},onHideTooltip:()=>Le(!1),title:Ae?Object(k.a)("Copied!"):Object(k.a)("Copy")},u.a.createElement("span",{className:"mx_AccessibleButton mx_AccessibleButton_hasKind mx_AccessibleButton_kind_primary_outline"},Object(k.a)("Copy invite link")))):Ue&&Te===he.PublicRooms&&(m=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_hiddenResults",role:"group"},u.a.createElement("h4",null,Object(k.a)("Some results may be hidden")),u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(k.a)("If you can't find the room you're looking for, ask for an invite or create a new room.")),u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_createNewRoom",className:"mx_SpotlightDialog_createRoom",onClick:()=>b.a.dispatch({action:"view_create_room",public:!0,defaultName:Object(o.capitalize)(Ue)})},u.a.createElement("span",{className:"mx_AccessibleButton mx_AccessibleButton_hasKind mx_AccessibleButton_kind_primary_outline"},Object(k.a)("Create new room"))))),Te===he.People&&(p=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_groupChat"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_groupChat"},Object(k.a)("Other options")),u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_startGroupChat",className:"mx_SpotlightDialog_startGroupChat",onClick:()=>Object(N.f)(Ue)},Object(k.a)("Start a group chat")))),null===Te&&(g=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_messageSearch"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_messageSearch"},Object(k.a)("Other searches")),u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(k.a)("To search messages, look for this icon at the top of a room <icon/>",{},{icon:()=>u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchIcon"})})))),dt=u.a.createElement(u.a.Fragment,null,t,a,n,r,l,s,d,m,lt,p,g)}else{let e;Re.length&&(e=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_recentSearches",role:"group",tabIndex:-1,"aria-labelledby":"mx_SpotlightDialog_section_recentSearches"},u.a.createElement("h4",null,u.a.createElement("span",{id:"mx_SpotlightDialog_section_recentSearches"},Object(k.a)("Recent searches")),u.a.createElement($.a,{kind:"link",onClick:Ie},Object(k.a)("Clear"))),u.a.createElement("div",null,Re.map(e=>{const t=A.a.instance.getRoomState(e),a=Oe(0,t),n={"aria-label":a?`${e.name} ${a}`:e.name,"aria-describedby":`mx_SpotlightDialog_button_recentSearch_${e.roomId}_details`};return u.a.createElement(ae.a,i()({id:"mx_SpotlightDialog_button_recentSearch_"+e.roomId,key:e.roomId,onClick:t=>{ct({roomId:e.roomId},!0,"click"!==(null==t?void 0:t.type))},endAdornment:u.a.createElement(ie.a,{room:e})},n),u.a.createElement(K.a,{room:e,avatarSize:24,tooltipProps:{tabIndex:-1}}),e.name,u.a.createElement(Z.a,{notification:t}),u.a.createElement(re.a,{id:`mx_SpotlightDialog_button_recentSearch_${e.roomId}_details`,className:"mx_SpotlightDialog_result_details",room:e}))})))),dt=u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_recentlyViewed",role:"group","aria-labelledby":"mx_SpotlightDialog_section_recentlyViewed"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_recentlyViewed"},Object(k.a)("Recently viewed")),u.a.createElement("div",null,M.a.instance.rooms.filter(e=>e.roomId!==U.b.instance.roomViewStore.getRoomId()).map(e=>u.a.createElement(se.a,{id:"mx_SpotlightDialog_button_recentlyViewed_"+e.roomId,title:e.name,key:e.roomId,onClick:t=>{ct({roomId:e.roomId},!1,"click"!==t.type)}},u.a.createElement(K.a,{room:e,avatarSize:32,tooltipProps:{tabIndex:-1}}),e.name)))),e,lt)}const ut=Object(ce.a)()?()=>{R.a.createDialog(te.a,{feature:"spotlight"})}:null,mt=null===(a=xe.state.activeRef)||void 0===a||null===(n=a.current)||void 0===n?void 0:n.id;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{id:"mx_SpotlightDialog_keyboardPrompt"},Object(k.a)("Use <arrows/> to scroll",{},{arrows:()=>u.a.createElement(u.a.Fragment,null,u.a.createElement("kbd",null,"↓"),u.a.createElement("kbd",null,"↑"),null!==!Te&&!ke&&u.a.createElement("kbd",null,"←"),null!==!Te&&!ke&&u.a.createElement("kbd",null,"→"))})),u.a.createElement(ee.a,{className:"mx_SpotlightDialog",onFinished:h,hasCancel:!1,onKeyDown:e=>{switch(Object(x.a)().getNavigationAction(e)){case p.h.FilterRooms:e.stopPropagation(),e.preventDefault(),h()}let t;const a=Object(x.a)().getAccessibilityAction(e);switch(a){case p.h.Escape:e.stopPropagation(),e.preventDefault(),h();break;case p.h.ArrowUp:case p.h.ArrowDown:if(e.stopPropagation(),e.preventDefault(),xe.state.refs.length>0){let e=xe.state.refs;if(!ke&&null!==!Te){const t=de(xe.state.activeRef)?xe.state.activeRef:e.find(de);e=e.filter(e=>e===t||!de(e))}const n=e.indexOf(xe.state.activeRef);t=Object(g.h)(e,n+(a===p.h.ArrowUp?-1:1))}break;case p.h.ArrowLeft:case p.h.ArrowRight:if(!ke&&null!==!Te&&xe.state.refs.length>0&&de(xe.state.activeRef)){e.stopPropagation(),e.preventDefault();const n=xe.state.refs.filter(de),i=n.indexOf(xe.state.activeRef);t=Object(g.h)(n,i+(a===p.h.ArrowLeft?-1:1))}}var n;t&&(xe.dispatch({type:g.f.SetFocus,payload:{ref:t}}),null===(n=t.current)||void 0===n||n.scrollIntoView({block:"nearest"}))},screenName:"UnifiedSearch","aria-label":Object(k.a)("Search Dialog")},u.a.createElement("div",{className:"mx_SpotlightDialog_searchBox mx_textinput"},null!==Te&&u.a.createElement("div",{className:s()("mx_SpotlightDialog_filter",{mx_SpotlightDialog_filterPeople:Te===he.People,mx_SpotlightDialog_filterPublicRooms:Te===he.PublicRooms})},u.a.createElement("span",null,pe(Te)),u.a.createElement($.a,{tabIndex:-1,alt:Object(k.a)("Remove search filter for %(filter)s",{filter:pe(Te)}),className:"mx_SpotlightDialog_filter--close",onClick:()=>De(null)})),u.a.createElement("input",{ref:L,autoFocus:!0,type:"text",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:"false",placeholder:Object(k.a)("Search"),value:ke,onChange:e=>{const t=e.currentTarget.value;je(t)},onKeyDown:e=>{var t,a;switch(Object(x.a)().getAccessibilityAction(e)){case p.h.Backspace:ke||null===Te||(e.stopPropagation(),e.preventDefault(),De(null));break;case p.h.Enter:e.stopPropagation(),e.preventDefault(),null===(t=xe.state.activeRef)||void 0===t||null===(a=t.current)||void 0===a||a.click()}},"aria-owns":"mx_SpotlightDialog_content","aria-activedescendant":mt,"aria-label":Object(k.a)("Search"),"aria-describedby":"mx_SpotlightDialog_keyboardPrompt"}),(Be||$e||Ze)&&u.a.createElement(X.a,{w:24,h:24})),u.a.createElement("div",{ref:oe,id:"mx_SpotlightDialog_content",role:"listbox","aria-activedescendant":mt,"aria-describedby":"mx_SpotlightDialog_keyboardPrompt"},dt),u.a.createElement("div",{className:"mx_SpotlightDialog_footer"},ut&&Object(k.a)("Results not as expected? Please <a>give feedback</a>.",{},{a:e=>u.a.createElement($.a,{kind:"link_inline",onClick:ut},e)}),ut&&u.a.createElement($.a,{kind:"primary_outline",onClick:ut},Object(k.a)("Feedback")))))};t.a=e=>u.a.createElement(g.d,null,()=>u.a.createElement(Ce,e))}).call(this,a(192).setImmediate)},1431:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(90);function i(e,t,a){Object(n.useEffect)(()=>{let n=null;const i=()=>{n=null,t(...a)};if(!1!==e)return n=setTimeout(i,100),()=>{n&&clearTimeout(n)}},[e,t,a])}},1432:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(90),i=a(92),r=a(106),s=a(95);const o=()=>{const[e,t]=Object(n.useState)(()=>{const e=i.a.get();return s.b.getValue("SpotlightSearch.recentSearches",null).map(t=>e.getRoom(t)).filter(Boolean)});return[e,()=>{s.b.setValue("SpotlightSearch.recentSearches",null,r.a.ACCOUNT,[]),t([])}]}},1433:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(90),i=a(92),r=a(583);const s=()=>{const[e,t]=Object(n.useState)(null),[a,s]=Object(n.useState)(!1),[o,c]=Object(r.a)(t);return{ready:!0,loading:a,profile:e,search:Object(n.useCallback)(async e=>{let{query:a}=e;if(o(a),null==a||!a.length||!a.startsWith("@")||!a.includes(":"))return t(null),!0;s(!0);try{const e=await i.a.get().getProfileInfo(a);return c(a,{user_id:a,avatar_url:e.avatar_url,display_name:e.displayname}),!0}catch(e){return console.error("Could not fetch profile info for params",{term:a},e),c(a,null),!1}finally{s(!1)}},[o,c])}}},1434:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(90),i=a(92),r=a(100),s=a(95),o=a(583);let c;const l=()=>{const[e,t]=Object(n.useState)([]),[a,l]=Object(n.useState)(void 0),[d,u]=Object(n.useState)(null),[m,h]=Object(n.useState)(!1),[p,g]=Object(n.useState)(!1),[v,f]=Object(o.a)(t);const b=Object(n.useCallback)(async e=>{let{limit:t=20,query:n,roomTypes:r}=e;const s={limit:t};(null==a?void 0:a.roomServer)!=i.a.getHomeserverName()&&(s.server=null==a?void 0:a.roomServer),"ALL_ROOMS"===(null==a?void 0:a.instanceId)?s.include_all_networks=!0:null!=a&&a.instanceId&&(s.third_party_instance_id=a.instanceId),(n||r)&&(s.filter={generic_search_term:n,room_types:await i.a.get().doesServerSupportUnstableFeature("org.matrix.msc3827.stable")?Array.from(r):null}),v(s);try{g(!0);const{chunk:e}=await i.a.get().publicRooms(s);return f(s,e),!0}catch(e){return console.error("Could not fetch public rooms for params",s,e),f(s,[]),!1}finally{g(!1)}},[a,v,f]);return Object(n.useEffect)(()=>{!async function(){if(i.a.get())if(c)u(c);else{const e=await i.a.get().getThirdpartyProtocols();c=e,u(e)}else h(!0)}()},[]),Object(n.useEffect)(()=>{var e,t,a,n;if(null===d)return;const o=i.a.getHomeserverName(),c=localStorage.getItem("mx_last_room_directory_server"),u=null!==(e=localStorage.getItem("mx_last_room_directory_instance"))&&void 0!==e?e:void 0;let m=o;(null!==(t=r.b.getObject("room_directory"))&&void 0!==t&&null!==(a=t.get("servers"))&&void 0!==a&&a.includes(c)||null!==(n=s.b.getValue("room_directory_servers"))&&void 0!==n&&n.includes(c))&&(m=c);let p=void 0;m!==o||"ALL_ROOMS"!==u&&!Object.values(d).some(e=>{e.instances.some(e=>e.instance_id===u)})||(p=u),h(!0),l({roomServer:m,instanceId:p})},[d]),Object(n.useEffect)(()=>{localStorage.setItem("mx_last_room_directory_server",null==a?void 0:a.roomServer),null!=a&&a.instanceId?localStorage.setItem("mx_last_room_directory_instance",null==a?void 0:a.instanceId):localStorage.removeItem("mx_last_room_directory_instance")},[a]),{ready:m,loading:p,publicRooms:e,protocols:d,config:a,search:b,setConfig:function(e){if(!m)throw new Error("public room configuration not initialised yet");l(e)}}}},1435:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(90),i=a(107),r=a(849),s=a(7),o=a(92);const c=(e,t)=>{var a;const[c,l]=Object(n.useState)([]),[d,u]=Object(n.useState)(),m=Object(n.useCallback)(()=>{u(e?new r.a(e,50):null)},[e]);Object(n.useEffect)(m,[m]),Object(n.useEffect)(()=>{if(!e||!d)return;let t=!1;return(async()=>{for(;null!=d&&d.canLoadMore&&!t&&e===d.root;)await d.load(),d.canLoadMore&&d.load(),l(d.rooms)})(),()=>{t=!0}},[e,d]);return[Object(n.useMemo)(()=>{const e=t.trim(),a=e.toLowerCase(),n=Object(s.x)(e),r=o.a.get();return null==c?void 0:c.filter(e=>{var t;return e.room_type!==i.RoomType.Space&&"join"!==(null===(t=r.getRoom(e.room_id))||void 0===t?void 0:t.getMyMembership())&&(Object(s.x)(e.name||"").includes(n)||(e.canonical_alias||"").includes(a))})},[c,t]),null!==(a=null==d?void 0:d.loading)&&void 0!==a&&a]}},1436:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(90),i=a(92),r=a(368),s=a(583);const o=()=>{const[e,t]=Object(n.useState)([]),[a,o]=Object(n.useState)(!1),[c,l]=Object(s.a)(t);return{ready:!0,loading:a,users:e,search:Object(n.useCallback)(async e=>{let{limit:a=20,query:n}=e;const s={limit:a,term:n};if(c(s),null==n||!n.length)return t([]),!0;try{o(!0);const{results:e}=await i.a.get().searchUserDirectory(s);return l(s,e.map(e=>new r.a(e))),!0}catch(e){return console.error("Could not fetch user in user directory for params",{limit:a,term:n},e),l(s,[]),!1}finally{o(!1)}},[c,l])}}},1437:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(101),i=a.n(n),r=a(103),s=a.n(r),o=a(96),c=a.n(o),l=a(90),d=a.n(l),u=a(139),m=a(93);const h=["inputRef","children","endAdornment","className"],p=e=>{let{inputRef:t,children:a,endAdornment:n,className:r}=e,o=s()(e,h);const[l,p,g]=Object(u.i)(t);return d.a.createElement(m.a,i()({},o,{className:c()(r,"mx_SpotlightDialog_option"),onFocus:l,inputRef:g,tabIndex:-1,"aria-selected":p,role:"option"}),a,d.a.createElement("div",{className:"mx_SpotlightDialog_option--endAdornment"},d.a.createElement("kbd",{className:"mx_SpotlightDialog_enterPrompt","aria-hidden":!0},"↵"),n))}},1438:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(90),i=a.n(n),r=a(157),s=a(91),o=a(600);function c(e){var t;let{room:a,labelId:n,descriptionId:c,detailsId:l}=e,d=a.name||Object(o.b)(a)||Object(s.a)("Unnamed room");d.length>80&&(d=d.substring(0,80)+"...");let u=a.topic||"";return u.length>800&&(u=u.substring(0,800)+"..."),i.a.createElement("div",{className:"mx_SpotlightDialog_result_publicRoomDetails"},i.a.createElement("div",{className:"mx_SpotlightDialog_result_publicRoomHeader"},i.a.createElement("span",{id:n,className:"mx_SpotlightDialog_result_publicRoomName"},d),i.a.createElement("span",{id:c,className:"mx_SpotlightDialog_result_publicRoomAlias"},null!==(t=a.canonical_alias)&&void 0!==t?t:a.room_id)),i.a.createElement("div",{id:l,className:"mx_SpotlightDialog_result_publicRoomDescription"},i.a.createElement("span",{className:"mx_SpotlightDialog_result_publicRoomMemberCount"},Object(s.a)("%(count)s Members",{count:a.num_joined_members})),u&&i.a.createElement(i.a.Fragment,null," · ",i.a.createElement("span",{className:"mx_SpotlightDialog_result_publicRoomTopic",dangerouslySetInnerHTML:{__html:Object(r.f)(u)}}))))}},1439:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(101),i=a.n(n),r=a(96),s=a.n(r),o=a(90),c=a.n(o),l=a(298),d=a(746),u=a(91),m=a(246),h=a(749),p=a(745),g=a(585),v=a(414);function f(e){let{room:t}=e;const[a]=Object(d.a)(t),[n,r]=Object(o.useState)(null),[f,b]=Object(o.useState)(null);let y,E;null!==n&&(y=t.isSpaceRoom()?c.a.createElement(g.a,i()({},Object(v.a)(n),{space:t,onFinished:()=>r(null)})):c.a.createElement(h.a,i()({},Object(v.a)(n),{room:t,onFinished:()=>r(null)}))),null!==f&&(E=c.a.createElement(p.a,i()({},Object(v.a)(f),{room:t,onFinished:()=>b(null)})));const _=s()("mx_SpotlightDialog_option--notifications",{mx_RoomNotificationContextMenu_iconBell:a===m.a.AllMessages,mx_RoomNotificationContextMenu_iconBellDot:a===m.a.AllMessagesLoud,mx_RoomNotificationContextMenu_iconBellMentions:a===m.a.MentionsOnly,mx_RoomNotificationContextMenu_iconBellCrossed:a===m.a.Mute});return c.a.createElement(o.Fragment,null,c.a.createElement(l.a,{className:"mx_SpotlightDialog_option--menu",onClick:e=>{e.preventDefault(),e.stopPropagation();const t=e.target;r(t.getBoundingClientRect())},title:t.isSpaceRoom()?Object(u.a)("Space options"):Object(u.a)("Room options"),isExpanded:null!==n}),!t.isSpaceRoom()&&c.a.createElement(l.a,{className:_,onClick:e=>{e.preventDefault(),e.stopPropagation();const t=e.target;b(t.getBoundingClientRect())},title:Object(u.a)("Notification options"),isExpanded:null!==f}),y,E)}},1440:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(101),i=a.n(n),r=a(103),s=a.n(r),o=a(96),c=a.n(o),l=a(90),d=a.n(l),u=a(139),m=a(118);const h=["inputRef","className"],p=e=>{let{inputRef:t,className:a}=e,n=s()(e,h);const[r,o,l]=Object(u.i)(t);return d.a.createElement(m.a,i()({},n,{className:c()(a,"mx_SpotlightDialog_option"),onFocus:r,inputRef:l,tabIndex:-1,"aria-selected":o,role:"option"}))}},1441:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 9a6 6 0 01-6 6v-2a4 4 0 000-8V3a6 6 0 016 6zM9 5a4 4 0 100 8V5zm8 4A8 8 0 111 9a8 8 0 0116 0z",fill:"#000"})))}t.default="img/element-icons/roomlist/dark-light-mode.f72b785.svg"},1442:function(e,t,a){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var i=a(90),r=n(i),s=n(a(638)),o=n(a(101)),c=a(1443),l=a(1445),d=a(1464),u=a(1465),m=n(a(1467)),h=n(a(1468)),p=n(a(155));function g(e,t){}g.bind(null,"warn"),g.bind(null,"error");function v(){}function f(e,t,a){var n=t.map((function(t){var n=function(e,t){return o({},e,{},t)}(a,t.options);return e.addEventListener(t.eventName,t.fn,n),function(){e.removeEventListener(t.eventName,t.fn,n)}}));return function(){n.forEach((function(e){e()}))}}function b(e){this.message=e}function y(e,t){if(!e)throw new b("Invariant failed")}b.prototype.toString=function(){return this.message};var E=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=e.call.apply(e,[this].concat(n))||this).callbacks=null,t.unbind=v,t.onWindowError=function(e){var a=t.getCallbacks();a.isDragging()&&a.tryAbort(),e.error instanceof b&&e.preventDefault()},t.getCallbacks=function(){if(!t.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return t.callbacks},t.setCallbacks=function(e){t.callbacks=e},t}s(t,e);var a=t.prototype;return a.componentDidMount=function(){this.unbind=f(window,[{eventName:"error",fn:this.onWindowError}])},a.componentDidCatch=function(e){if(!(e instanceof b))throw e;this.setState({})},a.componentWillUnmount=function(){this.unbind()},a.render=function(){return this.props.children(this.setCallbacks)},t}(r.Component),_=function(e){return e+1},w=function(e,t){var a=e.droppableId===t.droppableId,n=_(e.index),i=_(t.index);return a?"\n      You have moved the item from position "+n+"\n      to position "+i+"\n    ":"\n    You have moved the item from position "+n+"\n    in list "+e.droppableId+"\n    to list "+t.droppableId+"\n    in position "+i+"\n  "},S=function(e,t,a){return t.droppableId===a.droppableId?"\n      The item "+e+"\n      has been combined with "+a.draggableId:"\n      The item "+e+"\n      in list "+t.droppableId+"\n      has been combined with "+a.draggableId+"\n      in list "+a.droppableId+"\n    "},O=function(e){return"\n  The item has returned to its starting position\n  of "+_(e.index)+"\n"},C="\n  Press space bar to start a drag.\n  When dragging you can use the arrow keys to move the item around and escape to cancel.\n  Some screen readers may require you to be in focus mode or to use your pass through key\n",x=function(e){return"\n  You have lifted an item in position "+_(e.source.index)+"\n"},k=function(e){var t=e.destination;if(t)return w(e.source,t);var a=e.combine;return a?S(e.draggableId,e.source,a):"You are over an area that cannot be dropped on"},j=function(e){if("CANCEL"===e.reason)return"\n      Movement cancelled.\n      "+O(e.source)+"\n    ";var t=e.destination,a=e.combine;return t?"\n      You have dropped the item.\n      "+w(e.source,t)+"\n    ":a?"\n      You have dropped the item.\n      "+S(e.draggableId,e.source,a)+"\n    ":"\n    The item has been dropped while not over a drop area.\n    "+O(e.source)+"\n  "},R={x:0,y:0},I=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},T=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},N=function(e,t){return e.x===t.x&&e.y===t.y},D=function(e){return{x:0!==e.x?-e.x:0,y:0!==e.y?-e.y:0}},P=function(e,t,a){var n;return void 0===a&&(a=0),(n={})[e]=t,n["x"===e?"y":"x"]=a,n},M=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},A=function(e,t){return Math.min.apply(Math,t.map((function(t){return M(e,t)})))},L=function(e){return function(t){return{x:e(t.x),y:e(t.y)}}},U=function(e,t){return{top:e.top+t.y,left:e.left+t.x,bottom:e.bottom+t.y,right:e.right+t.x}},F=function(e){return[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.left,y:e.bottom},{x:e.right,y:e.bottom}]},B=function(e,t){return t&&t.shouldClipSubject?function(e,t){var a=u.getRect({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return a.width<=0||a.height<=0?null:a}(t.pageMarginBox,e):u.getRect(e)},V=function(e){var t=e.page,a=e.withPlaceholder,n=e.axis,i=e.frame,r=function(e,t,a){var n;return a&&a.increasedBy?o({},e,((n={})[t.end]=e[t.end]+a.increasedBy[t.line],n)):e}(function(e,t){return t?U(e,t.scroll.diff.displacement):e}(t.marginBox,i),n,a);return{page:t,withPlaceholder:a,active:B(r,i)}},z=function(e,t){e.frame||y(!1);var a=e.frame,n=T(t,a.scroll.initial),i=D(n),r=o({},a,{scroll:{initial:a.scroll.initial,current:t,diff:{value:n,displacement:i},max:a.scroll.max}}),s=V({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:r});return o({},e,{frame:r,subject:s})};function W(e){return Object.values?Object.values(e):Object.keys(e).map((function(t){return e[t]}))}function H(e,t){if(e.findIndex)return e.findIndex(t);for(var a=0;a<e.length;a++)if(t(e[a]))return a;return-1}function G(e,t){if(e.find)return e.find(t);var a=H(e,t);return-1!==a?e[a]:void 0}function q(e){return Array.prototype.slice.call(e)}var K=m((function(e){return e.reduce((function(e,t){return e[t.descriptor.id]=t,e}),{})})),Y=m((function(e){return e.reduce((function(e,t){return e[t.descriptor.id]=t,e}),{})})),J=m((function(e){return W(e)})),$=m((function(e){return W(e)})),Q=m((function(e,t){return $(t).filter((function(t){return e===t.descriptor.droppableId})).sort((function(e,t){return e.descriptor.index-t.descriptor.index}))}));function X(e){return e.at&&"REORDER"===e.at.type?e.at.destination:null}function Z(e){return e.at&&"COMBINE"===e.at.type?e.at.combine:null}var ee=m((function(e,t){return t.filter((function(t){return t.descriptor.id!==e.descriptor.id}))})),te=function(e,t){return e.descriptor.droppableId===t.descriptor.id},ae={point:R,value:0},ne={invisible:{},visible:{},all:[]},ie={displaced:ne,displacedBy:ae,at:null},re=function(e,t){return function(a){return e<=a&&a<=t}},se=function(e){var t=re(e.top,e.bottom),a=re(e.left,e.right);return function(n){if(t(n.top)&&t(n.bottom)&&a(n.left)&&a(n.right))return!0;var i=t(n.top)||t(n.bottom),r=a(n.left)||a(n.right);if(i&&r)return!0;var s=n.top<e.top&&n.bottom>e.bottom,o=n.left<e.left&&n.right>e.right;return!(!s||!o)||(s&&r||o&&i)}},oe=function(e){var t=re(e.top,e.bottom),a=re(e.left,e.right);return function(e){return t(e.top)&&t(e.bottom)&&a(e.left)&&a(e.right)}},ce={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},le={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},de=function(e){var t=e.target,a=e.destination,n=e.viewport,i=e.withDroppableDisplacement,r=e.isVisibleThroughFrameFn,s=i?function(e,t){var a=t.frame?t.frame.scroll.diff.displacement:R;return U(e,a)}(t,a):t;return function(e,t,a){return!!t.subject.active&&a(t.subject.active)(e)}(s,a,r)&&function(e,t,a){return a(t)(e)}(s,n,r)},ue=function(e){return de(o({},e,{isVisibleThroughFrameFn:se}))},me=function(e){return de(o({},e,{isVisibleThroughFrameFn:oe}))};function he(e){var t=e.afterDragging,a=e.destination,n=e.displacedBy,i=e.viewport,r=e.forceShouldAnimate,s=e.last;return t.reduce((function(e,t){var o=function(e,t){var a=e.page.marginBox,n={top:t.point.y,right:0,bottom:0,left:t.point.x};return u.getRect(u.expand(a,n))}(t,n),c=t.descriptor.id;if(e.all.push(c),!ue({target:o,destination:a,viewport:i,withDroppableDisplacement:!0}))return e.invisible[t.descriptor.id]=!0,e;var l={draggableId:c,shouldAnimate:function(e,t,a){if("boolean"==typeof a)return a;if(!t)return!0;var n=t.invisible,i=t.visible;if(n[e])return!1;var r=i[e];return!r||r.shouldAnimate}(c,s,r)};return e.visible[c]=l,e}),{all:[],visible:{},invisible:{}})}function pe(e){var t=e.insideDestination,a=e.inHomeList,n=e.displacedBy,i=e.destination,r=function(e,t){if(!e.length)return 0;var a=e[e.length-1].descriptor.index;return t.inHomeList?a:a+1}(t,{inHomeList:a});return{displaced:ne,displacedBy:n,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:r}}}}function ge(e){var t=e.draggable,a=e.insideDestination,n=e.destination,i=e.viewport,r=e.displacedBy,s=e.last,o=e.index,c=e.forceShouldAnimate,l=te(t,n);if(null==o)return pe({insideDestination:a,inHomeList:l,displacedBy:r,destination:n});var d=G(a,(function(e){return e.descriptor.index===o}));if(!d)return pe({insideDestination:a,inHomeList:l,displacedBy:r,destination:n});var u=ee(t,a),m=a.indexOf(d);return{displaced:he({afterDragging:u.slice(m),destination:n,displacedBy:r,last:s,viewport:i.frame,forceShouldAnimate:c}),displacedBy:r,at:{type:"REORDER",destination:{droppableId:n.descriptor.id,index:o}}}}function ve(e,t){return Boolean(t.effected[e])}var fe=function(e){var t=e.isMovingForward,a=e.isInHomeList,n=e.draggable,i=e.draggables,r=e.destination,s=e.insideDestination,o=e.previousImpact,c=e.viewport,l=e.afterCritical,d=o.at;if(d||y(!1),"REORDER"===d.type){var u=function(e){var t=e.isMovingForward,a=e.isInHomeList,n=e.insideDestination,i=e.location;if(!n.length)return null;var r=i.index,s=t?r+1:r-1,o=n[0].descriptor.index,c=n[n.length-1].descriptor.index;return s<o||s>(a?c:c+1)?null:s}({isMovingForward:t,isInHomeList:a,location:d.destination,insideDestination:s});return null==u?null:ge({draggable:n,insideDestination:s,destination:r,viewport:c,last:o.displaced,displacedBy:o.displacedBy,index:u})}var m=function(e){var t=e.isMovingForward,a=e.destination,n=e.draggables,i=e.combine,r=e.afterCritical;if(!a.isCombineEnabled)return null;var s=i.draggableId,o=n[s].descriptor.index;return ve(s,r)?t?o:o-1:t?o+1:o}({isMovingForward:t,destination:r,displaced:o.displaced,draggables:i,combine:d.combine,afterCritical:l});return null==m?null:ge({draggable:n,insideDestination:s,destination:r,viewport:c,last:o.displaced,displacedBy:o.displacedBy,index:m})},be=function(e){var t=e.afterCritical,a=e.impact,n=e.draggables,i=Z(a);i||y(!1);var r=i.draggableId,s=n[r].page.borderBox.center,o=function(e){var t=e.displaced,a=e.afterCritical,n=e.combineWith,i=e.displacedBy,r=Boolean(t.visible[n]||t.invisible[n]);return ve(n,a)?r?R:D(i.point):r?i.point:R}({displaced:a.displaced,afterCritical:t,combineWith:r,displacedBy:a.displacedBy});return I(s,o)},ye=function(e,t){return t.margin[e.start]+t.borderBox[e.size]/2},Ee=function(e,t,a){return t[e.crossAxisStart]+a.margin[e.crossAxisStart]+a.borderBox[e.crossAxisSize]/2},_e=function(e){var t=e.axis,a=e.moveRelativeTo,n=e.isMoving;return P(t.line,a.marginBox[t.end]+ye(t,n),Ee(t,a.marginBox,n))},we=function(e){var t=e.axis,a=e.moveRelativeTo,n=e.isMoving;return P(t.line,a.marginBox[t.start]-function(e,t){return t.margin[e.end]+t.borderBox[e.size]/2}(t,n),Ee(t,a.marginBox,n))},Se=function(e){var t=e.impact,a=e.draggable,n=e.draggables,i=e.droppable,r=e.afterCritical,s=Q(i.descriptor.id,n),o=a.page,c=i.axis;if(!s.length)return function(e){var t=e.axis,a=e.moveInto,n=e.isMoving;return P(t.line,a.contentBox[t.start]+ye(t,n),Ee(t,a.contentBox,n))}({axis:c,moveInto:i.page,isMoving:o});var l=t.displaced,d=t.displacedBy,m=l.all[0];if(m){var h=n[m];if(ve(m,r))return we({axis:c,moveRelativeTo:h.page,isMoving:o});var p=u.offset(h.page,d.point);return we({axis:c,moveRelativeTo:p,isMoving:o})}var g=s[s.length-1];if(g.descriptor.id===a.descriptor.id)return o.borderBox.center;if(ve(g.descriptor.id,r)){var v=u.offset(g.page,D(r.displacedBy.point));return _e({axis:c,moveRelativeTo:v,isMoving:o})}return _e({axis:c,moveRelativeTo:g.page,isMoving:o})},Oe=function(e,t){var a=e.frame;return a?I(t,a.scroll.diff.displacement):t},Ce=function(e){var t=function(e){var t=e.impact,a=e.draggable,n=e.droppable,i=e.draggables,r=e.afterCritical,s=a.page.borderBox.center,o=t.at;return n&&o?"REORDER"===o.type?Se({impact:t,draggable:a,draggables:i,droppable:n,afterCritical:r}):be({impact:t,draggables:i,afterCritical:r}):s}(e),a=e.droppable;return a?Oe(a,t):t},xe=function(e,t){var a=T(t,e.scroll.initial),n=D(a);return{frame:u.getRect({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:a,displacement:n}}}};function ke(e,t){return e.map((function(e){return t[e]}))}var je=function(e){var t=e.pageBorderBoxCenter,a=e.draggable,n=function(e,t){return I(e.scroll.diff.displacement,t)}(e.viewport,t),i=T(n,a.page.borderBox.center);return I(a.client.borderBox.center,i)},Re=function(e){var t=e.draggable,a=e.destination,n=e.newPageBorderBoxCenter,i=e.viewport,r=e.withDroppableDisplacement,s=e.onlyOnMainAxis,c=void 0!==s&&s,l=T(n,t.page.borderBox.center),d={target:U(t.page.borderBox,l),destination:a,withDroppableDisplacement:r,viewport:i};return c?function(e){return de(o({},e,{isVisibleThroughFrameFn:(t=e.destination.axis,function(e){var a=re(e.top,e.bottom),n=re(e.left,e.right);return function(e){return t===ce?a(e.top)&&a(e.bottom):n(e.left)&&n(e.right)}})}));var t}(d):me(d)},Ie=function(e){var t=e.isMovingForward,a=e.draggable,n=e.destination,i=e.draggables,r=e.previousImpact,s=e.viewport,c=e.previousPageBorderBoxCenter,l=e.previousClientSelection,d=e.afterCritical;if(!n.isEnabled)return null;var u=Q(n.descriptor.id,i),m=te(a,n),h=function(e){var t=e.isMovingForward,a=e.draggable,n=e.destination,i=e.insideDestination,r=e.previousImpact;if(!n.isCombineEnabled)return null;if(!X(r))return null;function s(e){var t={type:"COMBINE",combine:{draggableId:e,droppableId:n.descriptor.id}};return o({},r,{at:t})}var c=r.displaced.all,l=c.length?c[0]:null;if(t)return l?s(l):null;var d=ee(a,i);if(!l)return d.length?s(d[d.length-1].descriptor.id):null;var u=H(d,(function(e){return e.descriptor.id===l}));-1===u&&y(!1);var m=u-1;return m<0?null:s(d[m].descriptor.id)}({isMovingForward:t,draggable:a,destination:n,insideDestination:u,previousImpact:r})||fe({isMovingForward:t,isInHomeList:m,draggable:a,draggables:i,destination:n,insideDestination:u,previousImpact:r,viewport:s,afterCritical:d});if(!h)return null;var p=Ce({impact:h,draggable:a,droppable:n,draggables:i,afterCritical:d});if(Re({draggable:a,destination:n,newPageBorderBoxCenter:p,viewport:s.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:je({pageBorderBoxCenter:p,draggable:a,viewport:s}),impact:h,scrollJumpRequest:null};var g=T(p,c);return{clientSelection:l,impact:function(e){var t=e.impact,a=e.viewport,n=e.destination,i=e.draggables,r=e.maxScrollChange,s=xe(a,I(a.scroll.current,r)),c=n.frame?z(n,I(n.frame.scroll.current,r)):n,l=t.displaced,d=he({afterDragging:ke(l.all,i),destination:n,displacedBy:t.displacedBy,viewport:s.frame,last:l,forceShouldAnimate:!1}),u=he({afterDragging:ke(l.all,i),destination:c,displacedBy:t.displacedBy,viewport:a.frame,last:l,forceShouldAnimate:!1}),m={},h={},p=[l,d,u];return l.all.forEach((function(e){var t=function(e,t){for(var a=0;a<t.length;a++){var n=t[a].visible[e];if(n)return n}return null}(e,p);t?h[e]=t:m[e]=!0})),o({},t,{displaced:{all:l.all,invisible:m,visible:h}})}({impact:h,viewport:s,destination:n,draggables:i,maxScrollChange:g}),scrollJumpRequest:g}},Te=function(e){var t=e.subject.active;return t||y(!1),t},Ne=function(e,t){var a=e.page.borderBox.center;return ve(e.descriptor.id,t)?T(a,t.displacedBy.point):a},De=function(e,t){var a=e.page.borderBox;return ve(e.descriptor.id,t)?U(a,D(t.displacedBy.point)):a},Pe=m((function(e,t){var a=t[e.line];return{value:a,point:P(e.line,a)}})),Me=function(e,t){return o({},e,{scroll:o({},e.scroll,{max:t})})},Ae=function(e,t,a){var n=e.frame;te(t,e)&&y(!1),e.subject.withPlaceholder&&y(!1);var i=Pe(e.axis,t.displaceBy).point,r=function(e,t,a){var n=e.axis;if("virtual"===e.descriptor.mode)return P(n.line,t[n.line]);var i=e.subject.page.contentBox[n.size],r=Q(e.descriptor.id,a).reduce((function(e,t){return e+t.client.marginBox[n.size]}),0)+t[n.line]-i;return r<=0?null:P(n.line,r)}(e,i,a),s={placeholderSize:i,increasedBy:r,oldFrameMaxScroll:e.frame?e.frame.scroll.max:null};if(!n){var c=V({page:e.subject.page,withPlaceholder:s,axis:e.axis,frame:e.frame});return o({},e,{subject:c})}var l=r?I(n.scroll.max,r):n.scroll.max,d=Me(n,l),u=V({page:e.subject.page,withPlaceholder:s,axis:e.axis,frame:d});return o({},e,{subject:u,frame:d})},Le=function(e){var t=e.isMovingForward,a=e.previousPageBorderBoxCenter,n=e.draggable,i=e.isOver,r=e.draggables,s=e.droppables,o=e.viewport,c=e.afterCritical,l=function(e){var t=e.isMovingForward,a=e.pageBorderBoxCenter,n=e.source,i=e.droppables,r=e.viewport,s=n.subject.active;if(!s)return null;var o=n.axis,c=re(s[o.start],s[o.end]),l=J(i).filter((function(e){return e!==n})).filter((function(e){return e.isEnabled})).filter((function(e){return Boolean(e.subject.active)})).filter((function(e){return se(r.frame)(Te(e))})).filter((function(e){var a=Te(e);return t?s[o.crossAxisEnd]<a[o.crossAxisEnd]:a[o.crossAxisStart]<s[o.crossAxisStart]})).filter((function(e){var t=Te(e),a=re(t[o.start],t[o.end]);return c(t[o.start])||c(t[o.end])||a(s[o.start])||a(s[o.end])})).sort((function(e,a){var n=Te(e)[o.crossAxisStart],i=Te(a)[o.crossAxisStart];return t?n-i:i-n})).filter((function(e,t,a){return Te(e)[o.crossAxisStart]===Te(a[0])[o.crossAxisStart]}));if(!l.length)return null;if(1===l.length)return l[0];var d=l.filter((function(e){return re(Te(e)[o.start],Te(e)[o.end])(a[o.line])}));return 1===d.length?d[0]:d.length>1?d.sort((function(e,t){return Te(e)[o.start]-Te(t)[o.start]}))[0]:l.sort((function(e,t){var n=A(a,F(Te(e))),i=A(a,F(Te(t)));return n!==i?n-i:Te(e)[o.start]-Te(t)[o.start]}))[0]}({isMovingForward:t,pageBorderBoxCenter:a,source:i,droppables:s,viewport:o});if(!l)return null;var d=Q(l.descriptor.id,r),u=function(e){var t=e.previousPageBorderBoxCenter,a=e.moveRelativeTo,n=e.insideDestination,i=e.draggable,r=e.draggables,s=e.destination,o=e.viewport,c=e.afterCritical;if(!a){if(n.length)return null;var l={displaced:ne,displacedBy:ae,at:{type:"REORDER",destination:{droppableId:s.descriptor.id,index:0}}},d=Ce({impact:l,draggable:i,droppable:s,draggables:r,afterCritical:c}),u=te(i,s)?s:Ae(s,i,r);return Re({draggable:i,destination:u,newPageBorderBoxCenter:d,viewport:o.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?l:null}var m,h=Boolean(t[s.axis.line]<=a.page.borderBox.center[s.axis.line]),p=(m=a.descriptor.index,a.descriptor.id===i.descriptor.id||h?m:m+1),g=Pe(s.axis,i.displaceBy);return ge({draggable:i,insideDestination:n,destination:s,viewport:o,displacedBy:g,last:ne,index:p})}({previousPageBorderBoxCenter:a,destination:l,draggable:n,draggables:r,moveRelativeTo:function(e){var t=e.pageBorderBoxCenter,a=e.viewport,n=e.destination,i=e.insideDestination,r=e.afterCritical;return i.filter((function(e){return me({target:De(e,r),destination:n,viewport:a.frame,withDroppableDisplacement:!0})})).sort((function(e,a){var i=M(t,Oe(n,Ne(e,r))),s=M(t,Oe(n,Ne(a,r)));return i<s?-1:s<i?1:e.descriptor.index-a.descriptor.index}))[0]||null}({pageBorderBoxCenter:a,viewport:o,destination:l,insideDestination:d,afterCritical:c}),insideDestination:d,viewport:o,afterCritical:c});if(!u)return null;var m=Ce({impact:u,draggable:n,droppable:l,draggables:r,afterCritical:c});return{clientSelection:je({pageBorderBoxCenter:m,draggable:n,viewport:o}),impact:u,scrollJumpRequest:null}},Ue=function(e){var t=e.at;return t?"REORDER"===t.type?t.destination.droppableId:t.combine.droppableId:null},Fe=function(e){var t=e.state,a=e.type,n=function(e,t){var a=Ue(e);return a?t[a]:null}(t.impact,t.dimensions.droppables),i=Boolean(n),r=t.dimensions.droppables[t.critical.droppable.id],s=n||r,o=s.axis.direction,c="vertical"===o&&("MOVE_UP"===a||"MOVE_DOWN"===a)||"horizontal"===o&&("MOVE_LEFT"===a||"MOVE_RIGHT"===a);if(c&&!i)return null;var l="MOVE_DOWN"===a||"MOVE_RIGHT"===a,d=t.dimensions.draggables[t.critical.draggable.id],u=t.current.page.borderBoxCenter,m=t.dimensions,h=m.draggables,p=m.droppables;return c?Ie({isMovingForward:l,previousPageBorderBoxCenter:u,draggable:d,destination:s,draggables:h,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):Le({isMovingForward:l,previousPageBorderBoxCenter:u,draggable:d,isOver:s,draggables:h,droppables:p,viewport:t.viewport,afterCritical:t.afterCritical})};function Be(e){return"DRAGGING"===e.phase||"COLLECTING"===e.phase}function Ve(e){var t=re(e.top,e.bottom),a=re(e.left,e.right);return function(e){return t(e.y)&&a(e.x)}}function ze(e){var t=e.pageBorderBox,a=e.draggable,n=e.droppables,i=J(n).filter((function(e){if(!e.isEnabled)return!1;var a,n,i=e.subject.active;if(!i)return!1;if(n=i,!((a=t).left<n.right&&a.right>n.left&&a.top<n.bottom&&a.bottom>n.top))return!1;if(Ve(i)(t.center))return!0;var r=e.axis,s=i.center[r.crossAxisLine],o=t[r.crossAxisStart],c=t[r.crossAxisEnd],l=re(i[r.crossAxisStart],i[r.crossAxisEnd]),d=l(o),u=l(c);return!d&&!u||(d?o<s:c>s)}));return i.length?1===i.length?i[0].descriptor.id:function(e){var t=e.pageBorderBox,a=e.draggable,n=e.candidates,i=a.page.borderBox.center,r=n.map((function(e){var a=e.axis,n=P(e.axis.line,t.center[a.line],e.page.borderBox.center[a.crossAxisLine]);return{id:e.descriptor.id,distance:M(i,n)}})).sort((function(e,t){return t.distance-e.distance}));return r[0]?r[0].id:null}({pageBorderBox:t,draggable:a,candidates:i}):null}var We=function(e,t){return u.getRect(U(e,t))};function He(e){var t=e.displaced,a=e.id;return Boolean(t.visible[a]||t.invisible[a])}var Ge=function(e){var t=e.pageOffset,a=e.draggable,n=e.draggables,i=e.droppables,r=e.previousImpact,s=e.viewport,o=e.afterCritical,c=We(a.page.borderBox,t),l=ze({pageBorderBox:c,draggable:a,droppables:i});if(!l)return ie;var d=i[l],u=Q(d.descriptor.id,n),m=function(e,t){var a=e.frame;return a?We(t,a.scroll.diff.value):t}(d,c);return function(e){var t=e.draggable,a=e.pageBorderBoxWithDroppableScroll,n=e.previousImpact,i=e.destination,r=e.insideDestination,s=e.afterCritical;if(!i.isCombineEnabled)return null;var o=i.axis,c=Pe(i.axis,t.displaceBy),l=c.value,d=a[o.start],u=a[o.end],m=G(ee(t,r),(function(e){var t=e.descriptor.id,a=e.page.borderBox,i=a[o.size]/4,r=ve(t,s),c=He({displaced:n.displaced,id:t});return r?c?u>a[o.start]+i&&u<a[o.end]-i:d>a[o.start]-l+i&&d<a[o.end]-l-i:c?u>a[o.start]+l+i&&u<a[o.end]+l-i:d>a[o.start]+i&&d<a[o.end]-i}));return m?{displacedBy:c,displaced:n.displaced,at:{type:"COMBINE",combine:{draggableId:m.descriptor.id,droppableId:i.descriptor.id}}}:null}({pageBorderBoxWithDroppableScroll:m,draggable:a,previousImpact:r,destination:d,insideDestination:u,afterCritical:o})||function(e){var t=e.pageBorderBoxWithDroppableScroll,a=e.draggable,n=e.destination,i=e.insideDestination,r=e.last,s=e.viewport,o=e.afterCritical,c=n.axis,l=Pe(n.axis,a.displaceBy),d=l.value,u=t[c.start],m=t[c.end],h=function(e){var t=e.draggable,a=e.closest,n=e.inHomeList;return a?n&&a.descriptor.index>t.descriptor.index?a.descriptor.index-1:a.descriptor.index:null}({draggable:a,closest:G(ee(a,i),(function(e){var t=e.descriptor.id,a=e.page.borderBox.center[c.line],n=ve(t,o),i=He({displaced:r,id:t});return n?i?m<=a:u<a-d:i?m<=a+d:u<a})),inHomeList:te(a,n)});return ge({draggable:a,insideDestination:i,destination:n,viewport:s,last:r,displacedBy:l,index:h})}({pageBorderBoxWithDroppableScroll:m,draggable:a,destination:d,insideDestination:u,last:r.displaced,viewport:s,afterCritical:o})},qe=function(e,t){var a;return o({},e,((a={})[t.descriptor.id]=t,a))},Ke=function(e){var t=e.previousImpact,a=e.impact,n=e.droppables,i=Ue(t),r=Ue(a);if(!i)return n;if(i===r)return n;var s=n[i];if(!s.subject.withPlaceholder)return n;var c=function(e){var t=e.subject.withPlaceholder;t||y(!1);var a=e.frame;if(!a){var n=V({page:e.subject.page,axis:e.axis,frame:null,withPlaceholder:null});return o({},e,{subject:n})}var i=t.oldFrameMaxScroll;i||y(!1);var r=Me(a,i),s=V({page:e.subject.page,axis:e.axis,frame:r,withPlaceholder:null});return o({},e,{subject:s,frame:r})}(s);return qe(n,c)},Ye=function(e){var t=e.state,a=e.clientSelection,n=e.dimensions,i=e.viewport,r=e.impact,s=e.scrollJumpRequest,c=i||t.viewport,l=n||t.dimensions,d=a||t.current.client.selection,u=T(d,t.initial.client.selection),m={offset:u,selection:d,borderBoxCenter:I(t.initial.client.borderBoxCenter,u)},h={selection:I(m.selection,c.scroll.current),borderBoxCenter:I(m.borderBoxCenter,c.scroll.current),offset:I(m.offset,c.scroll.diff.value)},p={client:m,page:h};if("COLLECTING"===t.phase)return o({phase:"COLLECTING"},t,{dimensions:l,viewport:c,current:p});var g=l.draggables[t.critical.draggable.id],v=r||Ge({pageOffset:h.offset,draggable:g,draggables:l.draggables,droppables:l.droppables,previousImpact:t.impact,viewport:c,afterCritical:t.afterCritical}),f=function(e){var t=e.draggable,a=e.draggables,n=e.droppables,i=e.previousImpact,r=e.impact,s=Ke({previousImpact:i,impact:r,droppables:n}),o=Ue(r);if(!o)return s;var c=n[o];if(te(t,c))return s;if(c.subject.withPlaceholder)return s;var l=Ae(c,t,a);return qe(s,l)}({draggable:g,impact:v,previousImpact:t.impact,draggables:l.draggables,droppables:l.droppables});return o({},t,{current:p,dimensions:{draggables:l.draggables,droppables:f},impact:v,viewport:c,scrollJumpRequest:s||null,forceShouldAnimate:!s&&null})};var Je=function(e){var t=e.impact,a=e.viewport,n=e.draggables,i=e.destination,r=e.forceShouldAnimate,s=t.displaced,c=he({afterDragging:function(e,t){return e.map((function(e){return t[e]}))}(s.all,n),destination:i,displacedBy:t.displacedBy,viewport:a.frame,forceShouldAnimate:r,last:s});return o({},t,{displaced:c})},$e=function(e){var t=e.impact,a=e.draggable,n=e.droppable,i=e.draggables,r=e.viewport,s=e.afterCritical,o=Ce({impact:t,draggable:a,draggables:i,droppable:n,afterCritical:s});return je({pageBorderBoxCenter:o,draggable:a,viewport:r})},Qe=function(e){var t=e.state,a=e.dimensions,n=e.viewport;"SNAP"!==t.movementMode&&y(!1);var i=t.impact,r=n||t.viewport,s=a||t.dimensions,o=s.draggables,c=s.droppables,l=o[t.critical.draggable.id],d=Ue(i);d||y(!1);var u=c[d],m=Je({impact:i,viewport:r,destination:u,draggables:o}),h=$e({impact:m,draggable:l,droppable:u,draggables:o,viewport:r,afterCritical:t.afterCritical});return Ye({impact:m,clientSelection:h,state:t,dimensions:s,viewport:r})},Xe=function(e){var t=e.draggable,a=e.home,n=e.draggables,i=e.viewport,r=Pe(a.axis,t.displaceBy),s=Q(a.descriptor.id,n),o=s.indexOf(t);-1===o&&y(!1);var c,l=s.slice(o+1),d=l.reduce((function(e,t){return e[t.descriptor.id]=!0,e}),{}),u={inVirtualList:"virtual"===a.descriptor.mode,displacedBy:r,effected:d};return{impact:{displaced:he({afterDragging:l,destination:a,displacedBy:r,last:null,viewport:i.frame,forceShouldAnimate:!1}),displacedBy:r,at:{type:"REORDER",destination:(c=t.descriptor,{index:c.index,droppableId:c.droppableId})}},afterCritical:u}},Ze=function(e){0},et=function(e){0},tt=function(e){var t=e.additions,a=e.updatedDroppables,n=e.viewport,i=n.scroll.diff.value;return t.map((function(e){var t=e.descriptor.droppableId,r=function(e){var t=e.frame;return t||y(!1),t}(a[t]).scroll.diff.value;return function(e){var t=e.draggable,a=e.offset,n=e.initialWindowScroll,i=u.offset(t.client,a),r=u.withScroll(i,n);return o({},t,{placeholder:o({},t.placeholder,{client:i}),client:i,page:r})}({draggable:e,offset:I(i,r),initialWindowScroll:n.scroll.initial})}))},at=function(e){return"SNAP"===e.movementMode},nt=function(e,t,a){var n=function(e,t){return{draggables:e.draggables,droppables:qe(e.droppables,t)}}(e.dimensions,t);return!at(e)||a?Ye({state:e,dimensions:n}):Qe({state:e,dimensions:n})};function it(e){return e.isDragging&&"SNAP"===e.movementMode?o({phase:"DRAGGING"},e,{scrollJumpRequest:null}):e}var rt={phase:"IDLE",completed:null,shouldFlush:!1},st=function(e,t){if(void 0===e&&(e=rt),"FLUSH"===t.type)return o({},rt,{shouldFlush:!0});if("INITIAL_PUBLISH"===t.type){"IDLE"!==e.phase&&y(!1);var a=t.payload,n=a.critical,i=a.clientSelection,r=a.viewport,s=a.dimensions,c=a.movementMode,l=s.draggables[n.draggable.id],d=s.droppables[n.droppable.id],u={selection:i,borderBoxCenter:l.client.borderBox.center,offset:R},m={client:u,page:{selection:I(u.selection,r.scroll.initial),borderBoxCenter:I(u.selection,r.scroll.initial),offset:I(u.selection,r.scroll.diff.value)}},h=J(s.droppables).every((function(e){return!e.isFixedOnPage})),p=Xe({draggable:l,home:d,draggables:s.draggables,viewport:r}),g=p.impact;return{phase:"DRAGGING",isDragging:!0,critical:n,movementMode:c,dimensions:s,initial:m,current:m,isWindowScrollAllowed:h,impact:g,afterCritical:p.afterCritical,onLiftImpact:g,viewport:r,scrollJumpRequest:null,forceShouldAnimate:null}}if("COLLECTION_STARTING"===t.type)return"COLLECTING"===e.phase||"DROP_PENDING"===e.phase?e:("DRAGGING"!==e.phase&&y(!1),o({phase:"COLLECTING"},e,{phase:"COLLECTING"}));if("PUBLISH_WHILE_DRAGGING"===t.type)return"COLLECTING"!==e.phase&&"DROP_PENDING"!==e.phase&&y(!1),function(e){var t=e.state,a=e.published;Ze();var n=a.modified.map((function(e){var a=t.dimensions.droppables[e.droppableId];return z(a,e.scroll)})),i=o({},t.dimensions.droppables,{},K(n)),r=Y(tt({additions:a.additions,updatedDroppables:i,viewport:t.viewport})),s=o({},t.dimensions.draggables,{},r);a.removals.forEach((function(e){delete s[e]}));var c={droppables:i,draggables:s},l=Ue(t.impact),d=l?c.droppables[l]:null,u=c.draggables[t.critical.draggable.id],m=c.droppables[t.critical.droppable.id],h=Xe({draggable:u,home:m,draggables:s,viewport:t.viewport}),p=h.impact,g=h.afterCritical,v=d&&d.isCombineEnabled?t.impact:p,f=Ge({pageOffset:t.current.page.offset,draggable:c.draggables[t.critical.draggable.id],draggables:c.draggables,droppables:c.droppables,previousImpact:v,viewport:t.viewport,afterCritical:g});et();var b=o({phase:"DRAGGING"},t,{phase:"DRAGGING",impact:f,onLiftImpact:p,dimensions:c,afterCritical:g,forceShouldAnimate:!1});return"COLLECTING"===t.phase?b:o({phase:"DROP_PENDING"},b,{phase:"DROP_PENDING",reason:t.reason,isWaiting:!1})}({state:e,published:t.payload});if("MOVE"===t.type){if("DROP_PENDING"===e.phase)return e;Be(e)||y(!1);var v=t.payload.client;return N(v,e.current.client.selection)?e:Ye({state:e,clientSelection:v,impact:at(e)?e.impact:null})}if("UPDATE_DROPPABLE_SCROLL"===t.type){if("DROP_PENDING"===e.phase)return it(e);if("COLLECTING"===e.phase)return it(e);Be(e)||y(!1);var f=t.payload,b=f.id,E=f.newScroll,_=e.dimensions.droppables[b];if(!_)return e;var w=z(_,E);return nt(e,w,!1)}if("UPDATE_DROPPABLE_IS_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;Be(e)||y(!1);var S=t.payload,O=S.id,C=S.isEnabled,x=e.dimensions.droppables[O];x||y(!1),x.isEnabled===C&&y(!1);var k=o({},x,{isEnabled:C});return nt(e,k,!0)}if("UPDATE_DROPPABLE_IS_COMBINE_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;Be(e)||y(!1);var j=t.payload,T=j.id,D=j.isCombineEnabled,P=e.dimensions.droppables[T];P||y(!1),P.isCombineEnabled===D&&y(!1);var M=o({},P,{isCombineEnabled:D});return nt(e,M,!0)}if("MOVE_BY_WINDOW_SCROLL"===t.type){if("DROP_PENDING"===e.phase||"DROP_ANIMATING"===e.phase)return e;Be(e)||y(!1),e.isWindowScrollAllowed||y(!1);var A=t.payload.newScroll;if(N(e.viewport.scroll.current,A))return it(e);var L=xe(e.viewport,A);return at(e)?Qe({state:e,viewport:L}):Ye({state:e,viewport:L})}if("UPDATE_VIEWPORT_MAX_SCROLL"===t.type){if(!Be(e))return e;var U=t.payload.maxScroll;if(N(U,e.viewport.scroll.max))return e;var F=o({},e.viewport,{scroll:o({},e.viewport.scroll,{max:U})});return o({phase:"DRAGGING"},e,{viewport:F})}if("MOVE_UP"===t.type||"MOVE_DOWN"===t.type||"MOVE_LEFT"===t.type||"MOVE_RIGHT"===t.type){if("COLLECTING"===e.phase||"DROP_PENDING"===e.phase)return e;"DRAGGING"!==e.phase&&y(!1);var B=Fe({state:e,type:t.type});return B?Ye({state:e,impact:B.impact,clientSelection:B.clientSelection,scrollJumpRequest:B.scrollJumpRequest}):e}if("DROP_PENDING"===t.type){var V=t.payload.reason;return"COLLECTING"!==e.phase&&y(!1),o({phase:"DROP_PENDING"},e,{phase:"DROP_PENDING",isWaiting:!0,reason:V})}if("DROP_ANIMATE"===t.type){var W=t.payload,H=W.completed,G=W.dropDuration,q=W.newHomeClientOffset;return"DRAGGING"!==e.phase&&"DROP_PENDING"!==e.phase&&y(!1),{phase:"DROP_ANIMATING",completed:H,dropDuration:G,newHomeClientOffset:q,dimensions:e.dimensions}}return"DROP_COMPLETE"===t.type?{phase:"IDLE",completed:t.payload.completed,shouldFlush:!1}:e},ot=function(e){return{type:"PUBLISH_WHILE_DRAGGING",payload:e}},ct=function(){return{type:"COLLECTION_STARTING",payload:null}},lt=function(e){return{type:"UPDATE_DROPPABLE_SCROLL",payload:e}},dt=function(e){return{type:"UPDATE_DROPPABLE_IS_ENABLED",payload:e}},ut=function(e){return{type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:e}},mt=function(e){return{type:"MOVE",payload:e}},ht=function(){return{type:"MOVE_UP",payload:null}},pt=function(){return{type:"MOVE_DOWN",payload:null}},gt=function(){return{type:"MOVE_RIGHT",payload:null}},vt=function(){return{type:"MOVE_LEFT",payload:null}},ft=function(e){return{type:"DROP_COMPLETE",payload:e}},bt=function(e){return{type:"DROP",payload:e}},yt=function(){return{type:"DROP_ANIMATION_FINISHED",payload:null}};var Et="cubic-bezier(.2,1,.1,1)",_t={drop:0,combining:.7},wt={drop:.75},St=.2+"s "+"cubic-bezier(0.2, 0, 0, 1)",Ot={fluid:"opacity "+St,snap:"transform "+St+", opacity "+St,drop:function(e){var t=e+"s "+Et;return"transform "+t+", opacity "+t},outOfTheWay:"transform "+St,placeholder:"height "+St+", width "+St+", margin "+St},Ct=function(e){return N(e,R)?null:"translate("+e.x+"px, "+e.y+"px)"},xt=Ct,kt=function(e,t){var a=Ct(e);return a?t?a+" scale("+wt.drop+")":a:null},jt=.33,Rt=.55,It=Rt-jt,Tt=function(e){var t=e.getState,a=e.dispatch;return function(e){return function(n){if("DROP"===n.type){var i=t(),r=n.payload.reason;if("COLLECTING"!==i.phase){if("IDLE"!==i.phase){"DROP_PENDING"===i.phase&&i.isWaiting&&y(!1),"DRAGGING"!==i.phase&&"DROP_PENDING"!==i.phase&&y(!1);var s=i.critical,c=i.dimensions,l=c.draggables[i.critical.draggable.id],d=function(e){var t=e.draggables,a=e.reason,n=e.lastImpact,i=e.home,r=e.viewport,s=e.onLiftImpact;return n.at&&"DROP"===a?"REORDER"===n.at.type?{impact:n,didDropInsideDroppable:!0}:{impact:o({},n,{displaced:ne}),didDropInsideDroppable:!0}:{impact:Je({draggables:t,impact:s,destination:i,viewport:r,forceShouldAnimate:!0}),didDropInsideDroppable:!1}}({reason:r,lastImpact:i.impact,afterCritical:i.afterCritical,onLiftImpact:i.onLiftImpact,home:i.dimensions.droppables[i.critical.droppable.id],viewport:i.viewport,draggables:i.dimensions.draggables}),u=d.impact,m=d.didDropInsideDroppable,h=m?X(u):null,p=m?Z(u):null,g={index:s.draggable.index,droppableId:s.droppable.id},v={draggableId:l.descriptor.id,type:l.descriptor.type,source:g,reason:r,mode:i.movementMode,destination:h,combine:p},f=function(e){var t=e.impact,a=e.draggable,n=e.dimensions,i=e.viewport,r=e.afterCritical,s=n.draggables,o=n.droppables,c=Ue(t),l=c?o[c]:null,d=o[a.descriptor.droppableId],u=$e({impact:t,draggable:a,draggables:s,afterCritical:r,droppable:l||d,viewport:i});return T(u,a.client.borderBox.center)}({impact:u,draggable:l,dimensions:c,viewport:i.viewport,afterCritical:i.afterCritical}),b={critical:i.critical,afterCritical:i.afterCritical,result:v,impact:u};if(!N(i.current.client.offset,f)||Boolean(v.combine)){var E=function(e){var t=e.current,a=e.destination,n=e.reason,i=M(t,a);if(i<=0)return jt;if(i>=1500)return Rt;var r=jt+It*(i/1500);return Number(("CANCEL"===n?.6*r:r).toFixed(2))}({current:i.current.client.offset,destination:f,reason:r});a(function(e){return{type:"DROP_ANIMATE",payload:e}}({newHomeClientOffset:f,dropDuration:E,completed:b}))}else a(ft({completed:b}))}}else a(function(e){return{type:"DROP_PENDING",payload:e}}({reason:r}))}else e(n)}}},Nt=function(){return{x:window.pageXOffset,y:window.pageYOffset}};function Dt(e){var t=e.onWindowScroll;var a=h((function(){t(Nt())})),n=function(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(t){t.target!==window&&t.target!==window.document||e()}}}(a),i=v;function r(){return i!==v}return{start:function(){r()&&y(!1),i=f(window,[n])},stop:function(){r()||y(!1),a.cancel(),i(),i=v},isActive:r}}var Pt=function(e){var t=Dt({onWindowScroll:function(t){e.dispatch({type:"MOVE_BY_WINDOW_SCROLL",payload:{newScroll:t}})}});return function(e){return function(a){t.isActive()||"INITIAL_PUBLISH"!==a.type||t.start(),t.isActive()&&function(e){return"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type}(a)&&t.stop(),e(a)}}},Mt=function(){var e=[];return{add:function(t){var a=setTimeout((function(){return function(t){var a=H(e,(function(e){return e.timerId===t}));-1===a&&y(!1),e.splice(a,1)[0].callback()}(a)})),n={timerId:a,callback:t};e.push(n)},flush:function(){if(e.length){var t=[].concat(e);e.length=0,t.forEach((function(e){clearTimeout(e.timerId),e.callback()}))}}}},At=function(e,t){Ze(),t(),et()},Lt=function(e,t){return{draggableId:e.draggable.id,type:e.droppable.type,source:{droppableId:e.droppable.id,index:e.draggable.index},mode:t}},Ut=function(e,t,a,n){if(e){var i=function(e){var t=!1,a=!1,n=setTimeout((function(){a=!0})),i=function(i){t||a||(t=!0,e(i),clearTimeout(n))};return i.wasCalled=function(){return t},i}(a);e(t,{announce:i}),i.wasCalled()||a(n(t))}else a(n(t))},Ft=function(e,t){var a=function(e,t){var a=Mt(),n=null,i=function(a){n||y(!1),n=null,At(0,(function(){return Ut(e().onDragEnd,a,t,j)}))};return{beforeCapture:function(t,a){n&&y(!1),At(0,(function(){var n=e().onBeforeCapture;n&&n({draggableId:t,mode:a})}))},beforeStart:function(t,a){n&&y(!1),At(0,(function(){var n=e().onBeforeDragStart;n&&n(Lt(t,a))}))},start:function(i,r){n&&y(!1);var s=Lt(i,r);n={mode:r,lastCritical:i,lastLocation:s.source,lastCombine:null},a.add((function(){At(0,(function(){return Ut(e().onDragStart,s,t,x)}))}))},update:function(i,r){var s=X(r),c=Z(r);n||y(!1);var l=!function(e,t){if(e===t)return!0;var a=e.draggable.id===t.draggable.id&&e.draggable.droppableId===t.draggable.droppableId&&e.draggable.type===t.draggable.type&&e.draggable.index===t.draggable.index,n=e.droppable.id===t.droppable.id&&e.droppable.type===t.droppable.type;return a&&n}(i,n.lastCritical);l&&(n.lastCritical=i);var d,u,m=(d=n.lastLocation,u=s,!(null==d&&null==u||null!=d&&null!=u&&d.droppableId===u.droppableId&&d.index===u.index));m&&(n.lastLocation=s);var h=!function(e,t){return null==e&&null==t||null!=e&&null!=t&&(e.draggableId===t.draggableId&&e.droppableId===t.droppableId)}(n.lastCombine,c);if(h&&(n.lastCombine=c),l||m||h){var p=o({},Lt(i,n.mode),{combine:c,destination:s});a.add((function(){At(0,(function(){return Ut(e().onDragUpdate,p,t,k)}))}))}},flush:function(){n||y(!1),a.flush()},drop:i,abort:function(){if(n){var e=o({},Lt(n.lastCritical,n.mode),{combine:null,destination:null,reason:"CANCEL"});i(e)}}}}(e,t);return function(e){return function(t){return function(n){if("BEFORE_INITIAL_CAPTURE"!==n.type){if("INITIAL_PUBLISH"===n.type){var i=n.payload.critical;return a.beforeStart(i,n.payload.movementMode),t(n),void a.start(i,n.payload.movementMode)}if("DROP_COMPLETE"===n.type){var r=n.payload.completed.result;return a.flush(),t(n),void a.drop(r)}if(t(n),"FLUSH"!==n.type){var s=e.getState();"DRAGGING"===s.phase&&a.update(s.critical,s.impact)}else a.abort()}else a.beforeCapture(n.payload.draggableId,n.payload.movementMode)}}}},Bt=function(e){return function(t){return function(a){if("DROP_ANIMATION_FINISHED"===a.type){var n=e.getState();"DROP_ANIMATING"!==n.phase&&y(!1),e.dispatch(ft({completed:n.completed}))}else t(a)}}},Vt=function(e){var t=null,a=null;return function(n){return function(i){if("FLUSH"!==i.type&&"DROP_COMPLETE"!==i.type&&"DROP_ANIMATION_FINISHED"!==i.type||(a&&(cancelAnimationFrame(a),a=null),t&&(t(),t=null)),n(i),"DROP_ANIMATE"===i.type){var r={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){"DROP_ANIMATING"===e.getState().phase&&e.dispatch({type:"DROP_ANIMATION_FINISHED",payload:null})}};a=requestAnimationFrame((function(){a=null,t=f(window,[r])}))}}}},zt=function(e){return function(t){return function(a){if(t(a),"PUBLISH_WHILE_DRAGGING"===a.type){var n=e.getState();"DROP_PENDING"===n.phase&&(n.isWaiting||e.dispatch(bt({reason:n.reason})))}}}},Wt=c.compose,Ht=function(e){var t,a=e.dimensionMarshal,n=e.focusMarshal,i=e.styleMarshal,r=e.getResponders,s=e.announce,o=e.autoScroller;return c.createStore(st,Wt(c.applyMiddleware((t=i,function(){return function(e){return function(a){"INITIAL_PUBLISH"===a.type&&t.dragging(),"DROP_ANIMATE"===a.type&&t.dropping(a.payload.completed.result.reason),"FLUSH"!==a.type&&"DROP_COMPLETE"!==a.type||t.resting(),e(a)}}}),function(e){return function(){return function(t){return function(a){"DROP_COMPLETE"!==a.type&&"FLUSH"!==a.type&&"DROP_ANIMATE"!==a.type||e.stopPublishing(),t(a)}}}}(a),function(e){return function(t){var a=t.getState,n=t.dispatch;return function(t){return function(i){if("LIFT"===i.type){var r=i.payload,s=r.id,o=r.clientSelection,c=r.movementMode,l=a();"DROP_ANIMATING"===l.phase&&n(ft({completed:l.completed})),"IDLE"!==a().phase&&y(!1),n({type:"FLUSH",payload:null}),n({type:"BEFORE_INITIAL_CAPTURE",payload:{draggableId:s,movementMode:c}});var d={draggableId:s,scrollOptions:{shouldPublishImmediately:"SNAP"===c}},u=e.startPublishing(d),m=u.critical,h=u.dimensions,p=u.viewport;n(function(e){return{type:"INITIAL_PUBLISH",payload:e}}({critical:m,dimensions:h,clientSelection:o,movementMode:c,viewport:p}))}else t(i)}}}}(a),Tt,Bt,Vt,zt,function(e){return function(t){return function(a){return function(n){if(function(e){return"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type}(n))return e.stop(),void a(n);if("INITIAL_PUBLISH"===n.type){a(n);var i=t.getState();return"DRAGGING"!==i.phase&&y(!1),void e.start(i)}a(n),e.scroll(t.getState())}}}}(o),Pt,function(e){var t=!1;return function(){return function(a){return function(n){if("INITIAL_PUBLISH"===n.type)return t=!0,e.tryRecordFocus(n.payload.critical.draggable.id),a(n),void e.tryRestoreFocusRecorded();if(a(n),t){if("FLUSH"===n.type)return t=!1,void e.tryRestoreFocusRecorded();if("DROP_COMPLETE"===n.type){t=!1;var i=n.payload.completed.result;i.combine&&e.tryShiftRecord(i.draggableId,i.combine.draggableId),e.tryRestoreFocusRecorded()}}}}}}(n),Ft(r,s))))};var Gt=function(e){var t=e.scrollHeight,a=e.scrollWidth,n=e.height,i=e.width,r=T({x:a,y:t},{x:i,y:n});return{x:Math.max(0,r.x),y:Math.max(0,r.y)}},qt=function(){var e=document.documentElement;return e||y(!1),e},Kt=function(){var e=qt();return Gt({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight})},Yt=function(e){var t=e.critical,a=e.scrollOptions,n=e.registry;Ze();var i=function(){var e=Nt(),t=Kt(),a=e.y,n=e.x,i=qt(),r=n+i.clientWidth,s=a+i.clientHeight;return{frame:u.getRect({top:a,left:n,right:r,bottom:s}),scroll:{initial:e,current:e,max:t,diff:{value:R,displacement:R}}}}(),r=i.scroll.current,s=t.droppable,o=n.droppable.getAllByType(s.type).map((function(e){return e.callbacks.getDimensionAndWatchScroll(r,a)})),c=n.draggable.getAllByType(t.draggable.type).map((function(e){return e.getDimension(r)})),l={draggables:Y(c),droppables:K(o)};return et(),{dimensions:l,critical:t,viewport:i}};function Jt(e,t,a){return a.descriptor.id!==t.id&&(a.descriptor.type===t.type&&"virtual"===e.droppable.getById(a.descriptor.droppableId).descriptor.mode)}var $t,Qt,Xt=function(e,t){var a=null,n=function(e){var t=e.registry,a=e.callbacks,n={additions:{},removals:{},modified:{}},i=null,r=function(){i||(a.collectionStarting(),i=requestAnimationFrame((function(){i=null,Ze();var e=n,r=e.additions,s=e.removals,o=e.modified,c=Object.keys(r).map((function(e){return t.draggable.getById(e).getDimension(R)})).sort((function(e,t){return e.descriptor.index-t.descriptor.index})),l=Object.keys(o).map((function(e){return{droppableId:e,scroll:t.droppable.getById(e).callbacks.getScrollWhileDragging()}})),d={additions:c,removals:Object.keys(s),modified:l};n={additions:{},removals:{},modified:{}},et(),a.publish(d)})))};return{add:function(e){var t=e.descriptor.id;n.additions[t]=e,n.modified[e.descriptor.droppableId]=!0,n.removals[t]&&delete n.removals[t],r()},remove:function(e){var t=e.descriptor;n.removals[t.id]=!0,n.modified[t.droppableId]=!0,n.additions[t.id]&&delete n.additions[t.id],r()},stop:function(){i&&(cancelAnimationFrame(i),i=null,n={additions:{},removals:{},modified:{}})}}}({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),i=function(t){a||y(!1);var i=a.critical.draggable;"ADDITION"===t.type&&Jt(e,i,t.value)&&n.add(t.value),"REMOVAL"===t.type&&Jt(e,i,t.value)&&n.remove(t.value)};return{updateDroppableIsEnabled:function(n,i){e.droppable.exists(n)||y(!1),a&&t.updateDroppableIsEnabled({id:n,isEnabled:i})},updateDroppableIsCombineEnabled:function(n,i){a&&(e.droppable.exists(n)||y(!1),t.updateDroppableIsCombineEnabled({id:n,isCombineEnabled:i}))},scrollDroppable:function(t,n){a&&e.droppable.getById(t).callbacks.scroll(n)},updateDroppableScroll:function(n,i){a&&(e.droppable.exists(n)||y(!1),t.updateDroppableScroll({id:n,newScroll:i}))},startPublishing:function(t){a&&y(!1);var n=e.draggable.getById(t.draggableId),r=e.droppable.getById(n.descriptor.droppableId),s={draggable:n.descriptor,droppable:r.descriptor},o=e.subscribe(i);return a={critical:s,unsubscribe:o},Yt({critical:s,registry:e,scrollOptions:t.scrollOptions})},stopPublishing:function(){if(a){n.stop();var t=a.critical.droppable;e.droppable.getAllByType(t.type).forEach((function(e){return e.callbacks.dragStopped()})),a.unsubscribe(),a=null}}}},Zt=function(e,t){return"IDLE"===e.phase||"DROP_ANIMATING"===e.phase&&(e.completed.result.draggableId!==t&&"DROP"===e.completed.result.reason)},ea=function(e){window.scrollBy(e.x,e.y)},ta=m((function(e){return J(e).filter((function(e){return!!e.isEnabled&&!!e.frame}))})),aa=function(e){var t=e.center,a=e.destination,n=e.droppables;if(a){var i=n[a];return i.frame?i:null}return function(e,t){return G(ta(t),(function(t){return t.frame||y(!1),Ve(t.frame.pageMarginBox)(e)}))}(t,n)},na=.25,ia=.05,ra=28,sa=function(e){return Math.pow(e,2)},oa={stopDampeningAt:1200,accelerateAt:360},ca=function(e){var t=e.startOfRange,a=e.endOfRange,n=e.current,i=a-t;return 0===i?0:(n-t)/i},la=oa.accelerateAt,da=oa.stopDampeningAt,ua=function(e){var t=e.distanceToEdge,a=e.thresholds,n=e.dragStartTime,i=e.shouldUseTimeDampening,r=function(e,t){if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return ra;if(e===t.startScrollingFrom)return 1;var a=ca({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),n=ra*sa(1-a);return Math.ceil(n)}(t,a);return 0===r?0:i?Math.max(function(e,t){var a=t,n=da,i=Date.now()-a;if(i>=da)return e;if(i<la)return 1;var r=ca({startOfRange:la,endOfRange:n,current:i}),s=e*sa(r);return Math.ceil(s)}(r,n),1):r},ma=function(e){var t=e.container,a=e.distanceToEdges,n=e.dragStartTime,i=e.axis,r=e.shouldUseTimeDampening,s=function(e,t){return{startScrollingFrom:e[t.size]*na,maxScrollValueAt:e[t.size]*ia}}(t,i);return a[i.end]<a[i.start]?ua({distanceToEdge:a[i.end],thresholds:s,dragStartTime:n,shouldUseTimeDampening:r}):-1*ua({distanceToEdge:a[i.start],thresholds:s,dragStartTime:n,shouldUseTimeDampening:r})},ha=L((function(e){return 0===e?0:e})),pa=function(e){var t=e.dragStartTime,a=e.container,n=e.subject,i=e.center,r=e.shouldUseTimeDampening,s={top:i.y-a.top,right:a.right-i.x,bottom:a.bottom-i.y,left:i.x-a.left},o=ma({container:a,distanceToEdges:s,dragStartTime:t,axis:ce,shouldUseTimeDampening:r}),c=ma({container:a,distanceToEdges:s,dragStartTime:t,axis:le,shouldUseTimeDampening:r}),l=ha({x:c,y:o});if(N(l,R))return null;var d=function(e){var t=e.container,a=e.subject,n=e.proposedScroll,i=a.height>t.height,r=a.width>t.width;return r||i?r&&i?null:{x:r?0:n.x,y:i?0:n.y}:n}({container:a,subject:n,proposedScroll:l});return d?N(d,R)?null:d:null},ga=L((function(e){return 0===e?0:e>0?1:-1})),va=($t=function(e,t){return e<0?e:e>t?e-t:0},function(e){var t=e.current,a=e.max,n=e.change,i=I(t,n),r={x:$t(i.x,a.x),y:$t(i.y,a.y)};return N(r,R)?null:r}),fa=function(e){var t=e.max,a=e.current,n=e.change,i={x:Math.max(a.x,t.x),y:Math.max(a.y,t.y)},r=ga(n),s=va({max:i,current:a,change:r});return!s||(0!==r.x&&0===s.x||0!==r.y&&0===s.y)},ba=function(e,t){return fa({current:e.scroll.current,max:e.scroll.max,change:t})},ya=function(e,t){var a=e.frame;return!!a&&fa({current:a.scroll.current,max:a.scroll.max,change:t})},Ea=function(e){var t=e.state,a=e.dragStartTime,n=e.shouldUseTimeDampening,i=e.scrollWindow,r=e.scrollDroppable,s=t.current.page.borderBoxCenter,o=t.dimensions.draggables[t.critical.draggable.id].page.marginBox;if(t.isWindowScrollAllowed){var c=function(e){var t=e.viewport,a=e.subject,n=e.center,i=e.dragStartTime,r=e.shouldUseTimeDampening,s=pa({dragStartTime:i,container:t.frame,subject:a,center:n,shouldUseTimeDampening:r});return s&&ba(t,s)?s:null}({dragStartTime:a,viewport:t.viewport,subject:o,center:s,shouldUseTimeDampening:n});if(c)return void i(c)}var l=aa({center:s,destination:Ue(t.impact),droppables:t.dimensions.droppables});if(l){var d=function(e){var t=e.droppable,a=e.subject,n=e.center,i=e.dragStartTime,r=e.shouldUseTimeDampening,s=t.frame;if(!s)return null;var o=pa({dragStartTime:i,container:s.pageMarginBox,subject:a,center:n,shouldUseTimeDampening:r});return o&&ya(t,o)?o:null}({dragStartTime:a,droppable:l,subject:o,center:s,shouldUseTimeDampening:n});d&&r(l.descriptor.id,d)}},_a=function(e){var t=e.move,a=e.scrollDroppable,n=e.scrollWindow,i=function(e,t){if(!ya(e,t))return t;var n=function(e,t){var a=e.frame;return a&&ya(e,t)?va({current:a.scroll.current,max:a.scroll.max,change:t}):null}(e,t);if(!n)return a(e.descriptor.id,t),null;var i=T(t,n);return a(e.descriptor.id,i),T(t,i)},r=function(e,t,a){if(!e)return a;if(!ba(t,a))return a;var i=function(e,t){if(!ba(e,t))return null;var a=e.scroll.max,n=e.scroll.current;return va({current:n,max:a,change:t})}(t,a);if(!i)return n(a),null;var r=T(a,i);return n(r),T(a,r)};return function(e){var a=e.scrollJumpRequest;if(a){var n=Ue(e.impact);n||y(!1);var s=i(e.dimensions.droppables[n],a);if(s){var o=e.viewport,c=r(e.isWindowScrollAllowed,o,s);c&&function(e,a){var n=I(e.current.client.selection,a);t({client:n})}(e,c)}}}},wa=function(e){var t=e.scrollDroppable,a=e.scrollWindow,n=e.move,i=function(e){var t=e.scrollWindow,a=e.scrollDroppable,n=h(t),i=h(a),r=null,s=function(e){r||y(!1);var t=r,a=t.shouldUseTimeDampening,s=t.dragStartTime;Ea({state:e,scrollWindow:n,scrollDroppable:i,dragStartTime:s,shouldUseTimeDampening:a})};return{start:function(e){Ze(),r&&y(!1);var t=Date.now(),a=!1,n=function(){a=!0};Ea({state:e,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:n,scrollDroppable:n}),r={dragStartTime:t,shouldUseTimeDampening:a},et(),a&&s(e)},stop:function(){r&&(n.cancel(),i.cancel(),r=null)},scroll:s}}({scrollWindow:a,scrollDroppable:t}),r=_a({move:n,scrollWindow:a,scrollDroppable:t});return{scroll:function(e){"DRAGGING"===e.phase&&("FLUID"!==e.movementMode?e.scrollJumpRequest&&r(e):i.scroll(e))},start:i.start,stop:i.stop}},Sa={base:Qt="data-rbd-drag-handle",draggableId:Qt+"-draggable-id",contextId:Qt+"-context-id"},Oa=function(){var e="data-rbd-draggable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),Ca=function(){var e="data-rbd-droppable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),xa={contextId:"data-rbd-scroll-container-context-id"},ka=function(e,t){return e.map((function(e){var a=e.styles[t];return a?e.selector+" { "+a+" }":""})).join(" ")},ja="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?i.useLayoutEffect:i.useEffect,Ra=function(){var e=document.querySelector("head");return e||y(!1),e},Ia=function(e){var t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.type="text/css",t};function Ta(e,t){var a=d.useMemo((function(){return function(e){var t,a,n,i=(t=e,function(e){return"["+e+'="'+t+'"]'}),r=(a="\n      cursor: -webkit-grab;\n      cursor: grab;\n    ",{selector:i(Sa.contextId),styles:{always:"\n          -webkit-touch-callout: none;\n          -webkit-tap-highlight-color: rgba(0,0,0,0);\n          touch-action: manipulation;\n        ",resting:a,dragging:"pointer-events: none;",dropAnimating:a}}),s=[(n="\n      transition: "+Ot.outOfTheWay+";\n    ",{selector:i(Oa.contextId),styles:{dragging:n,dropAnimating:n,userCancel:n}}),r,{selector:i(Ca.contextId),styles:{always:"overflow-anchor: none;"}},{selector:"body",styles:{dragging:"\n        cursor: grabbing;\n        cursor: -webkit-grabbing;\n        user-select: none;\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none;\n        overflow-anchor: none;\n      "}}];return{always:ka(s,"always"),resting:ka(s,"resting"),dragging:ka(s,"dragging"),dropAnimating:ka(s,"dropAnimating"),userCancel:ka(s,"userCancel")}}(e)}),[e]),n=i.useRef(null),r=i.useRef(null),s=d.useCallback(m((function(e){var t=r.current;t||y(!1),t.textContent=e})),[]),o=d.useCallback((function(e){var t=n.current;t||y(!1),t.textContent=e}),[]);ja((function(){(n.current||r.current)&&y(!1);var i=Ia(t),c=Ia(t);return n.current=i,r.current=c,i.setAttribute("data-rbd-always",e),c.setAttribute("data-rbd-dynamic",e),Ra().appendChild(i),Ra().appendChild(c),o(a.always),s(a.resting),function(){var e=function(e){var t=e.current;t||y(!1),Ra().removeChild(t),e.current=null};e(n),e(r)}}),[t,o,s,a.always,a.resting,e]);var c=d.useCallback((function(){return s(a.dragging)}),[s,a.dragging]),l=d.useCallback((function(e){s("DROP"!==e?a.userCancel:a.dropAnimating)}),[s,a.dropAnimating,a.userCancel]),u=d.useCallback((function(){r.current&&s(a.resting)}),[s,a.resting]);return d.useMemo((function(){return{dragging:c,dropping:l,resting:u}}),[c,l,u])}var Na=function(e){return e&&e.ownerDocument?e.ownerDocument.defaultView:window};function Da(e){return e instanceof Na(e).HTMLElement}function Pa(e,t){var a="["+Sa.contextId+'="'+e+'"]',n=q(document.querySelectorAll(a));if(!n.length)return null;var i=G(n,(function(e){return e.getAttribute(Sa.draggableId)===t}));return i&&Da(i)?i:null}function Ma(){var e={draggables:{},droppables:{}},t=[];function a(e){t.length&&t.forEach((function(t){return t(e)}))}function n(t){return e.draggables[t]||null}function i(t){return e.droppables[t]||null}return{draggable:{register:function(t){e.draggables[t.descriptor.id]=t,a({type:"ADDITION",value:t})},update:function(t,a){var n=e.draggables[a.descriptor.id];n&&n.uniqueId===t.uniqueId&&(delete e.draggables[a.descriptor.id],e.draggables[t.descriptor.id]=t)},unregister:function(t){var i=t.descriptor.id,r=n(i);r&&t.uniqueId===r.uniqueId&&(delete e.draggables[i],a({type:"REMOVAL",value:t}))},getById:function(e){var t=n(e);return t||y(!1),t},findById:n,exists:function(e){return Boolean(n(e))},getAllByType:function(t){return W(e.draggables).filter((function(e){return e.descriptor.type===t}))}},droppable:{register:function(t){e.droppables[t.descriptor.id]=t},unregister:function(t){var a=i(t.descriptor.id);a&&t.uniqueId===a.uniqueId&&delete e.droppables[t.descriptor.id]},getById:function(e){var t=i(e);return t||y(!1),t},findById:i,exists:function(e){return Boolean(i(e))},getAllByType:function(t){return W(e.droppables).filter((function(e){return e.descriptor.type===t}))}},subscribe:function(e){return t.push(e),function(){var a=t.indexOf(e);-1!==a&&t.splice(a,1)}},clean:function(){e.draggables={},e.droppables={},t.length=0}}}var Aa=r.createContext(null),La=function(){var e=document.body;return e||y(!1),e},Ua={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"};var Fa=0,Ba={separator:"::"};function Va(e,t){return void 0===t&&(t=Ba),d.useMemo((function(){return""+e+t.separator+Fa++}),[t.separator,e])}var za=r.createContext(null);function Wa(e){0}function Ha(e,t){Wa()}function Ga(){Ha()}function qa(e){var t=i.useRef(e);return i.useEffect((function(){t.current=e})),t}var Ka,Ya=((Ka={})[13]=!0,Ka[9]=!0,Ka),Ja=function(e){Ya[e.keyCode]&&e.preventDefault()},$a=function(){var e="visibilitychange";return"undefined"==typeof document?e:G([e,"ms"+e,"webkit"+e,"moz"+e,"o"+e],(function(e){return"on"+e in document}))||e}();var Qa,Xa={type:"IDLE"};function Za(e){var t=e.cancel,a=e.completed,n=e.getPhase,i=e.setPhase;return[{eventName:"mousemove",fn:function(e){var t=e.button,a=e.clientX,r=e.clientY;if(0===t){var s={x:a,y:r},o=n();if("DRAGGING"===o.type)return e.preventDefault(),void o.actions.move(s);"PENDING"!==o.type&&y(!1);var c=o.point;if(l=c,d=s,Math.abs(d.x-l.x)>=5||Math.abs(d.y-l.y)>=5){var l,d;e.preventDefault();var u=o.actions.fluidLift(s);i({type:"DRAGGING",actions:u})}}}},{eventName:"mouseup",fn:function(e){var i=n();"DRAGGING"===i.type?(e.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),a()):t()}},{eventName:"mousedown",fn:function(e){"DRAGGING"===n().type&&e.preventDefault(),t()}},{eventName:"keydown",fn:function(e){if("PENDING"!==n().type)return 27===e.keyCode?(e.preventDefault(),void t()):void Ja(e);t()}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(){"PENDING"===n().type&&t()}},{eventName:"webkitmouseforcedown",fn:function(e){var a=n();"IDLE"===a.type&&y(!1),a.actions.shouldRespectForcePress()?t():e.preventDefault()}},{eventName:$a,fn:t}]}function en(e){var t=i.useRef(Xa),a=i.useRef(v),n=d.useMemo((function(){return{eventName:"mousedown",fn:function(t){if(!t.defaultPrevented&&0===t.button&&!(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){var n=e.findClosestDraggableId(t);if(n){var i=e.tryGetLock(n,o,{sourceEvent:t});if(i){t.preventDefault();var r={x:t.clientX,y:t.clientY};a.current(),u(i,r)}}}}}}),[e]),r=d.useMemo((function(){return{eventName:"webkitmouseforcewillbegin",fn:function(t){if(!t.defaultPrevented){var a=e.findClosestDraggableId(t);if(a){var n=e.findOptionsForDraggable(a);n&&(n.shouldRespectForcePress||e.canGetLock(a)&&t.preventDefault())}}}}}),[e]),s=d.useCallback((function(){a.current=f(window,[r,n],{passive:!1,capture:!0})}),[r,n]),o=d.useCallback((function(){"IDLE"!==t.current.type&&(t.current=Xa,a.current(),s())}),[s]),c=d.useCallback((function(){var e=t.current;o(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[o]),l=d.useCallback((function(){var e=Za({cancel:c,completed:o,getPhase:function(){return t.current},setPhase:function(e){t.current=e}});a.current=f(window,e,{capture:!0,passive:!1})}),[c,o]),u=d.useCallback((function(e,a){"IDLE"!==t.current.type&&y(!1),t.current={type:"PENDING",point:a,actions:e},l()}),[l]);ja((function(){return s(),function(){a.current()}}),[s])}function tn(){}var an=((Qa={})[34]=!0,Qa[33]=!0,Qa[36]=!0,Qa[35]=!0,Qa);function nn(e,t){function a(){t(),e.cancel()}return[{eventName:"keydown",fn:function(n){return 27===n.keyCode?(n.preventDefault(),void a()):32===n.keyCode?(n.preventDefault(),t(),void e.drop()):40===n.keyCode?(n.preventDefault(),void e.moveDown()):38===n.keyCode?(n.preventDefault(),void e.moveUp()):39===n.keyCode?(n.preventDefault(),void e.moveRight()):37===n.keyCode?(n.preventDefault(),void e.moveLeft()):void(an[n.keyCode]?n.preventDefault():Ja(n))}},{eventName:"mousedown",fn:a},{eventName:"mouseup",fn:a},{eventName:"click",fn:a},{eventName:"touchstart",fn:a},{eventName:"resize",fn:a},{eventName:"wheel",fn:a,options:{passive:!0}},{eventName:$a,fn:a}]}function rn(e){var t=i.useRef(tn),a=d.useMemo((function(){return{eventName:"keydown",fn:function(a){if(!a.defaultPrevented&&32===a.keyCode){var i=e.findClosestDraggableId(a);if(i){var r=e.tryGetLock(i,c,{sourceEvent:a});if(r){a.preventDefault();var s=!0,o=r.snapLift();t.current(),t.current=f(window,nn(o,c),{capture:!0,passive:!1})}}}function c(){s||y(!1),s=!1,t.current(),n()}}}}),[e]),n=d.useCallback((function(){t.current=f(window,[a],{passive:!1,capture:!0})}),[a]);ja((function(){return n(),function(){t.current()}}),[n])}var sn={type:"IDLE"};function on(e){var t=i.useRef(sn),a=i.useRef(v),n=d.useCallback((function(){return t.current}),[]),r=d.useCallback((function(e){t.current=e}),[]),s=d.useMemo((function(){return{eventName:"touchstart",fn:function(t){if(!t.defaultPrevented){var n=e.findClosestDraggableId(t);if(n){var i=e.tryGetLock(n,c,{sourceEvent:t});if(i){var r=t.touches[0],s={x:r.clientX,y:r.clientY};a.current(),h(i,s)}}}}}}),[e]),o=d.useCallback((function(){a.current=f(window,[s],{capture:!0,passive:!1})}),[s]),c=d.useCallback((function(){var e=t.current;"IDLE"!==e.type&&("PENDING"===e.type&&clearTimeout(e.longPressTimerId),r(sn),a.current(),o())}),[o,r]),l=d.useCallback((function(){var e=t.current;c(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[c]),u=d.useCallback((function(){var e={capture:!0,passive:!1},t={cancel:l,completed:c,getPhase:n},i=f(window,function(e){var t=e.cancel,a=e.completed,n=e.getPhase;return[{eventName:"touchmove",options:{capture:!1},fn:function(e){var a=n();if("DRAGGING"===a.type){a.hasMoved=!0;var i=e.touches[0],r={x:i.clientX,y:i.clientY};e.preventDefault(),a.actions.move(r)}else t()}},{eventName:"touchend",fn:function(e){var i=n();"DRAGGING"===i.type?(e.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),a()):t()}},{eventName:"touchcancel",fn:function(e){"DRAGGING"===n().type?(e.preventDefault(),t()):t()}},{eventName:"touchforcechange",fn:function(e){var a=n();"IDLE"===a.type&&y(!1);var i=e.touches[0];if(i&&i.force>=.15){var r=a.actions.shouldRespectForcePress();if("PENDING"!==a.type)return r?a.hasMoved?void e.preventDefault():void t():void e.preventDefault();r&&t()}}},{eventName:$a,fn:t}]}(t),e),r=f(window,function(e){var t=e.cancel,a=e.getPhase;return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:function(e){e.preventDefault()}},{eventName:"keydown",fn:function(e){"DRAGGING"===a().type?(27===e.keyCode&&e.preventDefault(),t()):t()}},{eventName:$a,fn:t}]}(t),e);a.current=function(){i(),r()}}),[l,n,c]),m=d.useCallback((function(){var e=n();"PENDING"!==e.type&&y(!1);var t=e.actions.fluidLift(e.point);r({type:"DRAGGING",actions:t,hasMoved:!1})}),[n,r]),h=d.useCallback((function(e,t){"IDLE"!==n().type&&y(!1);var a=setTimeout(m,120);r({type:"PENDING",point:t,actions:e,longPressTimerId:a}),u()}),[u,n,r,m]);ja((function(){return o(),function(){a.current();var e=n();"PENDING"===e.type&&(clearTimeout(e.longPressTimerId),r(sn))}}),[n,o,r]),ja((function(){return f(window,[{eventName:"touchmove",fn:function(){},options:{capture:!1,passive:!1}}])}),[])}var cn={input:!0,button:!0,textarea:!0,select:!0,option:!0,optgroup:!0,video:!0,audio:!0};function ln(e,t){var a=t.target;return!!Da(a)&&function e(t,a){if(null==a)return!1;if(Boolean(cn[a.tagName.toLowerCase()]))return!0;var n=a.getAttribute("contenteditable");return"true"===n||""===n||a!==t&&e(t,a.parentElement)}(e,a)}var dn=function(e){return u.getRect(e.getBoundingClientRect()).center};var un="undefined"==typeof document?"matches":G(["matches","msMatchesSelector","webkitMatchesSelector"],(function(e){return e in Element.prototype}))||"matches";function mn(e,t){return e.closest?e.closest(t):function e(t,a){return null==t?null:t[un](a)?t:e(t.parentElement,a)}(e,t)}function hn(e,t){var a,n=t.target;if(!((a=n)instanceof Na(a).Element))return null;var i=mn(n,function(e){return"["+Sa.contextId+'="'+e+'"]'}(e));return i&&Da(i)?i:null}function pn(e){e.preventDefault()}function gn(e){var t=e.expected,a=e.phase,n=e.isLockActive;e.shouldWarn;return!!n()&&t===a}function vn(e){var t=e.lockAPI,a=e.store,n=e.registry,i=e.draggableId;if(t.isClaimed())return!1;var r=n.draggable.findById(i);return!!r&&(!!r.options.isEnabled&&!!Zt(a.getState(),i))}function fn(e){var t=e.lockAPI,a=e.contextId,n=e.store,i=e.registry,r=e.draggableId,s=e.forceSensorStop,c=e.sourceEvent;if(!vn({lockAPI:t,store:n,registry:i,draggableId:r}))return null;var l=i.draggable.getById(r),d=function(e,t){var a="["+Oa.contextId+'="'+e+'"]',n=G(q(document.querySelectorAll(a)),(function(e){return e.getAttribute(Oa.id)===t}));return n&&Da(n)?n:null}(a,l.descriptor.id);if(!d)return null;if(c&&!l.options.canDragInteractiveElements&&ln(d,c))return null;var u=t.claim(s||v),m="PRE_DRAG";function p(){return l.options.shouldRespectForcePress}function g(){return t.isActive(u)}var b=function(e,t){gn({expected:e,phase:m,isLockActive:g,shouldWarn:!0})&&n.dispatch(t())}.bind(null,"DRAGGING");function E(e){function a(){t.release(),m="COMPLETED"}function i(t,i){if(void 0===i&&(i={shouldBlockNextClick:!1}),e.cleanup(),i.shouldBlockNextClick){var r=f(window,[{eventName:"click",fn:pn,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(r)}a(),n.dispatch(bt({reason:t}))}return"PRE_DRAG"!==m&&(a(),"PRE_DRAG"!==m&&y(!1)),n.dispatch(function(e){return{type:"LIFT",payload:e}}(e.liftActionArgs)),m="DRAGGING",o({isActive:function(){return gn({expected:"DRAGGING",phase:m,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:p,drop:function(e){return i("DROP",e)},cancel:function(e){return i("CANCEL",e)}},e.actions)}return{isActive:function(){return gn({expected:"PRE_DRAG",phase:m,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:p,fluidLift:function(e){var t=h((function(e){b((function(){return mt({client:e})}))})),a=E({liftActionArgs:{id:r,clientSelection:e,movementMode:"FLUID"},cleanup:function(){return t.cancel()},actions:{move:t}});return o({},a,{move:t})},snapLift:function(){var e={moveUp:function(){return b(ht)},moveRight:function(){return b(gt)},moveDown:function(){return b(pt)},moveLeft:function(){return b(vt)}};return E({liftActionArgs:{id:r,clientSelection:dn(d),movementMode:"SNAP"},cleanup:v,actions:e})},abort:function(){gn({expected:"PRE_DRAG",phase:m,isLockActive:g,shouldWarn:!0})&&t.release()}}}var bn=[en,rn,on];function yn(e){var t=e.contextId,a=e.store,n=e.registry,r=e.customSensors,s=e.enableDefaultSensors,o=[].concat(s?bn:[],r||[]),c=i.useState((function(){return function(){var e=null;function t(){e||y(!1),e=null}return{isClaimed:function(){return Boolean(e)},isActive:function(t){return t===e},claim:function(t){e&&y(!1);var a={abandon:t};return e=a,a},release:t,tryAbandon:function(){e&&(e.abandon(),t())}}}()}))[0],l=d.useCallback((function(e,t){e.isDragging&&!t.isDragging&&c.tryAbandon()}),[c]);ja((function(){var e=a.getState();return a.subscribe((function(){var t=a.getState();l(e,t),e=t}))}),[c,a,l]),ja((function(){return c.tryAbandon}),[c.tryAbandon]);var u=d.useCallback((function(e){return vn({lockAPI:c,registry:n,store:a,draggableId:e})}),[c,n,a]),m=d.useCallback((function(e,i,r){return fn({lockAPI:c,registry:n,contextId:t,store:a,draggableId:e,forceSensorStop:i,sourceEvent:r&&r.sourceEvent?r.sourceEvent:null})}),[t,c,n,a]),h=d.useCallback((function(e){return function(e,t){var a=hn(e,t);return a?a.getAttribute(Sa.draggableId):null}(t,e)}),[t]),p=d.useCallback((function(e){var t=n.draggable.findById(e);return t?t.options:null}),[n.draggable]),g=d.useCallback((function(){c.isClaimed()&&(c.tryAbandon(),"IDLE"!==a.getState().phase&&a.dispatch({type:"FLUSH",payload:null}))}),[c,a]),v=d.useCallback(c.isClaimed,[c]),f=d.useMemo((function(){return{canGetLock:u,tryGetLock:m,findClosestDraggableId:h,findOptionsForDraggable:p,tryReleaseLock:g,isLockClaimed:v}}),[u,m,h,p,g,v]);Wa();for(var b=0;b<o.length;b++)o[b](f)}function En(e){return e.current||y(!1),e.current}function _n(e){var t=e.contextId,a=e.setCallbacks,n=e.sensors,s=e.nonce,u=e.dragHandleUsageInstructions,m=i.useRef(null);Ga();var h=qa(e),p=d.useCallback((function(){return function(e){return{onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDragUpdate:e.onDragUpdate}}(h.current)}),[h]),g=function(e){var t=d.useMemo((function(){return function(e){return"rbd-announcement-"+e}(e)}),[e]),a=i.useRef(null);return i.useEffect((function(){var e=document.createElement("div");return a.current=e,e.id=t,e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),o(e.style,Ua),La().appendChild(e),function(){setTimeout((function(){var t=La();t.contains(e)&&t.removeChild(e),e===a.current&&(a.current=null)}))}}),[t]),d.useCallback((function(e){var t=a.current;t&&(t.textContent=e)}),[])}(t),v=function(e){var t=e.contextId,a=e.text,n=Va("hidden-text",{separator:"-"}),r=d.useMemo((function(){return"rbd-hidden-text-"+(e={contextId:t,uniqueId:n}).contextId+"-"+e.uniqueId;var e}),[n,t]);return i.useEffect((function(){var e=document.createElement("div");return e.id=r,e.textContent=a,e.style.display="none",La().appendChild(e),function(){var t=La();t.contains(e)&&t.removeChild(e)}}),[r,a]),r}({contextId:t,text:u}),f=Ta(t,s),b=d.useCallback((function(e){En(m).dispatch(e)}),[]),y=d.useMemo((function(){return c.bindActionCreators({publishWhileDragging:ot,updateDroppableScroll:lt,updateDroppableIsEnabled:dt,updateDroppableIsCombineEnabled:ut,collectionStarting:ct},b)}),[b]),E=function(){var e=d.useMemo(Ma,[]);return i.useEffect((function(){return function(){requestAnimationFrame(e.clean)}}),[e]),e}(),_=d.useMemo((function(){return Xt(E,y)}),[E,y]),w=d.useMemo((function(){return wa(o({scrollWindow:ea,scrollDroppable:_.scrollDroppable},c.bindActionCreators({move:mt},b)))}),[_.scrollDroppable,b]),S=function(e){var t=i.useRef({}),a=i.useRef(null),n=i.useRef(null),r=i.useRef(!1),s=d.useCallback((function(e,a){var n={id:e,focus:a};return t.current[e]=n,function(){var a=t.current;a[e]!==n&&delete a[e]}}),[]),o=d.useCallback((function(t){var a=Pa(e,t);a&&a!==document.activeElement&&a.focus()}),[e]),c=d.useCallback((function(e,t){a.current===e&&(a.current=t)}),[]),l=d.useCallback((function(){n.current||r.current&&(n.current=requestAnimationFrame((function(){n.current=null;var e=a.current;e&&o(e)})))}),[o]),u=d.useCallback((function(e){a.current=null;var t=document.activeElement;t&&t.getAttribute(Sa.draggableId)===e&&(a.current=e)}),[]);return ja((function(){return r.current=!0,function(){r.current=!1;var e=n.current;e&&cancelAnimationFrame(e)}}),[]),d.useMemo((function(){return{register:s,tryRecordFocus:u,tryRestoreFocusRecorded:l,tryShiftRecord:c}}),[s,u,l,c])}(t),O=d.useMemo((function(){return Ht({announce:g,autoScroller:w,dimensionMarshal:_,focusMarshal:S,getResponders:p,styleMarshal:f})}),[g,w,_,S,p,f]);m.current=O;var C=d.useCallback((function(){var e=En(m);"IDLE"!==e.getState().phase&&e.dispatch({type:"FLUSH",payload:null})}),[]),x=d.useCallback((function(){var e=En(m).getState();return e.isDragging||"DROP_ANIMATING"===e.phase}),[]);a(d.useMemo((function(){return{isDragging:x,tryAbort:C}}),[x,C]));var k=d.useCallback((function(e){return Zt(En(m).getState(),e)}),[]),j=d.useCallback((function(){return Be(En(m).getState())}),[]),R=d.useMemo((function(){return{marshal:_,focus:S,contextId:t,canLift:k,isMovementAllowed:j,dragHandleUsageInstructionsId:v,registry:E}}),[t,_,v,S,k,j,E]);return yn({contextId:t,store:O,registry:E,customSensors:n,enableDefaultSensors:!1!==e.enableDefaultSensors}),i.useEffect((function(){return C}),[C]),r.createElement(za.Provider,{value:R},r.createElement(l.Provider,{context:Aa,store:O},e.children))}var wn=0;var Sn=function(e){return function(t){return e===t}},On=Sn("scroll"),Cn=Sn("auto"),xn=(Sn("visible"),function(e,t){return t(e.overflowX)||t(e.overflowY)}),kn=function(e){var t=window.getComputedStyle(e),a={overflowX:t.overflowX,overflowY:t.overflowY};return xn(a,On)||xn(a,Cn)},jn=function e(t){return null==t||t===document.body||t===document.documentElement?null:kn(t)?t:e(t.parentElement)},Rn=function(e){return{x:e.scrollLeft,y:e.scrollTop}},In=function(e){return{closestScrollable:jn(e),isFixedOnPage:function e(t){return!!t&&("fixed"===window.getComputedStyle(t).position||e(t.parentElement))}(e)}},Tn=function(e){var t=e.ref,a=e.descriptor,n=e.env,i=e.windowScroll,r=e.direction,s=e.isDropDisabled,o=e.isCombineEnabled,c=e.shouldClipSubject,l=n.closestScrollable,d=function(e,t){var a=u.getBox(e);if(!t)return a;if(e!==t)return a;var n=a.paddingBox.top-t.scrollTop,i=a.paddingBox.left-t.scrollLeft,r=n+t.scrollHeight,s={top:n,right:i+t.scrollWidth,bottom:r,left:i},o=u.expand(s,a.border);return u.createBox({borderBox:o,margin:a.margin,border:a.border,padding:a.padding})}(t,l),m=u.withScroll(d,i),h=function(){if(!l)return null;var e=u.getBox(l),t={scrollHeight:l.scrollHeight,scrollWidth:l.scrollWidth};return{client:e,page:u.withScroll(e,i),scroll:Rn(l),scrollSize:t,shouldClipSubject:c}}();return function(e){var t=e.descriptor,a=e.isEnabled,n=e.isCombineEnabled,i=e.isFixedOnPage,r=e.direction,s=e.client,o=e.page,c=e.closest,l=function(){if(!c)return null;var e=c.scrollSize,t=c.client,a=Gt({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,height:t.paddingBox.height,width:t.paddingBox.width});return{pageMarginBox:c.page.marginBox,frameClient:t,scrollSize:e,shouldClipSubject:c.shouldClipSubject,scroll:{initial:c.scroll,current:c.scroll,max:a,diff:{value:R,displacement:R}}}}(),d="vertical"===r?ce:le;return{descriptor:t,isCombineEnabled:n,isFixedOnPage:i,axis:d,isEnabled:a,client:s,page:o,frame:l,subject:V({page:o,withPlaceholder:null,axis:d,frame:l})}}({descriptor:a,isEnabled:!s,isCombineEnabled:o,isFixedOnPage:n.isFixedOnPage,direction:r,client:d,page:m,closest:h})},Nn={passive:!1},Dn={passive:!0},Pn=function(e){return e.shouldPublishImmediately?Nn:Dn};function Mn(e){var t=i.useContext(e);return t||y(!1),t}var An=function(e){return e&&e.env.closestScrollable||null};function Ln(){}var Un={width:0,height:0,margin:{top:0,right:0,bottom:0,left:0}},Fn=function(e){var t=e.isAnimatingOpenOnMount,a=e.placeholder,n=e.animate,i=function(e){var t=e.isAnimatingOpenOnMount,a=e.placeholder,n=e.animate;return t||"close"===n?Un:{height:a.client.borderBox.height,width:a.client.borderBox.width,margin:a.client.margin}}({isAnimatingOpenOnMount:t,placeholder:a,animate:n});return{display:a.display,boxSizing:"border-box",width:i.width,height:i.height,marginTop:i.margin.top,marginRight:i.margin.right,marginBottom:i.margin.bottom,marginLeft:i.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:"none"!==n?Ot.placeholder:null}};var Bn=r.memo((function(e){var t=i.useRef(null),a=d.useCallback((function(){t.current&&(clearTimeout(t.current),t.current=null)}),[]),n=e.animate,s=e.onTransitionEnd,o=e.onClose,c=e.contextId,l=i.useState("open"===e.animate),u=l[0],m=l[1];i.useEffect((function(){return u?"open"!==n?(a(),m(!1),Ln):t.current?Ln:(t.current=setTimeout((function(){t.current=null,m(!1)})),a):Ln}),[n,u,a]);var h=d.useCallback((function(e){"height"===e.propertyName&&(s(),"close"===n&&o())}),[n,o,s]),p=Fn({isAnimatingOpenOnMount:u,animate:e.animate,placeholder:e.placeholder});return r.createElement(e.placeholder.tagName,{style:p,"data-rbd-placeholder-context-id":c,onTransitionEnd:h,ref:e.innerRef})})),Vn=r.createContext(null);var zn=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=e.call.apply(e,[this].concat(n))||this).state={isVisible:Boolean(t.props.on),data:t.props.on,animate:t.props.shouldAnimate&&t.props.on?"open":"none"},t.onClose=function(){"close"===t.state.animate&&t.setState({isVisible:!1})},t}return s(t,e),t.getDerivedStateFromProps=function(e,t){return e.shouldAnimate?e.on?{isVisible:!0,data:e.on,animate:"open"}:t.isVisible?{isVisible:!0,data:t.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:Boolean(e.on),data:e.on,animate:"none"}},t.prototype.render=function(){if(!this.state.isVisible)return null;var e={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(e)},t}(r.PureComponent),Wn=5e3,Hn=4500,Gn=function(e,t){return t?Ot.drop(t.duration):e?Ot.snap:Ot.fluid},qn=function(e,t){return e?t?_t.drop:_t.combining:null};function Kn(e){return"DRAGGING"===e.type?(n=(a=e).dimension.client,i=a.offset,r=a.combineWith,s=a.dropping,o=Boolean(r),c=function(e){return null!=e.forceShouldAnimate?e.forceShouldAnimate:"SNAP"===e.mode}(a),l=Boolean(s),d=l?kt(i,o):xt(i),{position:"fixed",top:n.marginBox.top,left:n.marginBox.left,boxSizing:"border-box",width:n.borderBox.width,height:n.borderBox.height,transition:Gn(c,s),transform:d,opacity:qn(o,l),zIndex:l?Hn:Wn,pointerEvents:"none"}):{transform:xt((t=e).offset),transition:t.shouldAnimateDisplacement?null:"none"};var t,a,n,i,r,s,o,c,l,d}function Yn(e){var t=Va("draggable"),a=e.descriptor,n=e.registry,r=e.getDraggableRef,s=e.canDragInteractiveElements,o=e.shouldRespectForcePress,c=e.isEnabled,l=d.useMemo((function(){return{canDragInteractiveElements:s,shouldRespectForcePress:o,isEnabled:c}}),[s,c,o]),m=d.useCallback((function(e){var t=r();return t||y(!1),function(e,t,a){void 0===a&&(a=R);var n=window.getComputedStyle(t),i=t.getBoundingClientRect(),r=u.calculateBox(i,n),s=u.withScroll(r,a);return{descriptor:e,placeholder:{client:r,tagName:t.tagName.toLowerCase(),display:n.display},displaceBy:{x:r.marginBox.width,y:r.marginBox.height},client:r,page:s}}(a,t,e)}),[a,r]),h=d.useMemo((function(){return{uniqueId:t,descriptor:a,options:l,getDimension:m}}),[a,m,l,t]),p=i.useRef(h),g=i.useRef(!0);ja((function(){return n.draggable.register(p.current),function(){return n.draggable.unregister(p.current)}}),[n.draggable]),ja((function(){if(g.current)g.current=!1;else{var e=p.current;p.current=h,n.draggable.update(h,e)}}),[h,n.draggable])}function Jn(e,t,a){Ha()}function $n(e){e.preventDefault()}var Qn=function(e,t){return e===t},Xn=function(e){var t=e.combine,a=e.destination;return a?a.droppableId:t?t.droppableId:null};function Zn(e){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}var ei={mapped:{type:"SECONDARY",offset:R,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:Zn(null)}};var ti={dropAnimationFinished:yt},ai=l.connect((function(){var e,t,a,n=(e=m((function(e,t){return{x:e,y:t}})),t=m((function(e,t,a,n,i){return{isDragging:!0,isClone:t,isDropAnimating:Boolean(i),dropAnimation:i,mode:e,draggingOver:a,combineWith:n,combineTargetFor:null}})),a=m((function(e,a,n,i,r,s,o){return{mapped:{type:"DRAGGING",dropping:null,draggingOver:r,combineWith:s,mode:a,offset:e,dimension:n,forceShouldAnimate:o,snapshot:t(a,i,r,s,null)}}})),function(n,i){if(n.isDragging){if(n.critical.draggable.id!==i.draggableId)return null;var r=n.current.client.offset,s=n.dimensions.draggables[i.draggableId],o=Ue(n.impact),c=(d=n.impact).at&&"COMBINE"===d.at.type?d.at.combine.draggableId:null,l=n.forceShouldAnimate;return a(e(r.x,r.y),n.movementMode,s,i.isClone,o,c,l)}var d;if("DROP_ANIMATING"===n.phase){var u=n.completed;if(u.result.draggableId!==i.draggableId)return null;var m=i.isClone,h=n.dimensions.draggables[i.draggableId],p=u.result,g=p.mode,v=Xn(p),f=function(e){return e.combine?e.combine.draggableId:null}(p),b={duration:n.dropDuration,curve:Et,moveTo:n.newHomeClientOffset,opacity:f?_t.drop:null,scale:f?wt.drop:null};return{mapped:{type:"DRAGGING",offset:n.newHomeClientOffset,dimension:h,dropping:b,draggingOver:v,combineWith:f,mode:g,forceShouldAnimate:null,snapshot:t(g,m,v,f,b)}}}return null}),i=function(){var e=m((function(e,t){return{x:e,y:t}})),t=m(Zn),a=m((function(e,a,n){return void 0===a&&(a=null),{mapped:{type:"SECONDARY",offset:e,combineTargetFor:a,shouldAnimateDisplacement:n,snapshot:t(a)}}})),n=function(e){return e?a(R,e,!0):null},i=function(t,i,r,s){var o=r.displaced.visible[t],c=Boolean(s.inVirtualList&&s.effected[t]),l=Z(r),d=l&&l.draggableId===t?i:null;if(!o){if(!c)return n(d);if(r.displaced.invisible[t])return null;var u=D(s.displacedBy.point),m=e(u.x,u.y);return a(m,d,!0)}if(c)return n(d);var h=r.displacedBy.point,p=e(h.x,h.y);return a(p,d,o.shouldAnimate)};return function(e,t){if(e.isDragging)return e.critical.draggable.id===t.draggableId?null:i(t.draggableId,e.critical.draggable.id,e.impact,e.afterCritical);if("DROP_ANIMATING"===e.phase){var a=e.completed;return a.result.draggableId===t.draggableId?null:i(t.draggableId,a.result.draggableId,a.impact,a.afterCritical)}return null}}();return function(e,t){return n(e,t)||i(e,t)||ei}}),ti,null,{context:Aa,pure:!0,areStatePropsEqual:Qn})((function(e){var t=i.useRef(null),a=d.useCallback((function(e){t.current=e}),[]),n=d.useCallback((function(){return t.current}),[]),r=Mn(za),s=r.contextId,o=r.dragHandleUsageInstructionsId,c=r.registry,l=Mn(Vn),u=l.type,m=l.droppableId,h=d.useMemo((function(){return{id:e.draggableId,index:e.index,type:u,droppableId:m}}),[e.draggableId,e.index,u,m]),p=e.children,g=e.draggableId,v=e.isEnabled,f=e.shouldRespectForcePress,b=e.canDragInteractiveElements,y=e.isClone,E=e.mapped,_=e.dropAnimationFinished;Jn(),Wa(),y||Yn(d.useMemo((function(){return{descriptor:h,registry:c,getDraggableRef:n,canDragInteractiveElements:b,shouldRespectForcePress:f,isEnabled:v}}),[h,c,n,b,f,v]));var w=d.useMemo((function(){return v?{tabIndex:0,role:"button","aria-describedby":o,"data-rbd-drag-handle-draggable-id":g,"data-rbd-drag-handle-context-id":s,draggable:!1,onDragStart:$n}:null}),[s,o,g,v]),S=d.useCallback((function(e){"DRAGGING"===E.type&&E.dropping&&"transform"===e.propertyName&&_()}),[_,E]),O=d.useMemo((function(){var e=Kn(E),t="DRAGGING"===E.type&&E.dropping?S:null;return{innerRef:a,draggableProps:{"data-rbd-draggable-context-id":s,"data-rbd-draggable-id":g,style:e,onTransitionEnd:t},dragHandleProps:w}}),[s,w,g,E,S,a]),C=d.useMemo((function(){return{draggableId:h.id,type:h.type,source:{index:h.index,droppableId:h.droppableId}}}),[h.droppableId,h.id,h.index,h.type]);return p(O,E.snapshot,C)}));function ni(e){return Mn(Vn).isUsingCloneFor!==e.draggableId||e.isClone?r.createElement(ai,e):null}var ii=function(e,t){return e===t.droppable.type},ri=function(e,t){return t.draggables[e.draggable.id]},si={updateViewportMaxScroll:function(e){return{type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:e}}};var oi={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:function(){return document.body||y(!1),document.body}},ci=l.connect((function(){var e={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},t=o({},e,{shouldAnimatePlaceholder:!1}),a=m((function(e){return{draggableId:e.id,type:e.type,source:{index:e.index,droppableId:e.droppableId}}})),n=m((function(n,i,r,s,o,c){var l=o.descriptor.id;if(o.descriptor.droppableId===n){var d=c?{render:c,dragging:a(o.descriptor)}:null,u={isDraggingOver:r,draggingOverWith:r?l:null,draggingFromThisWith:l,isUsingPlaceholder:!0};return{placeholder:o.placeholder,shouldAnimatePlaceholder:!1,snapshot:u,useClone:d}}if(!i)return t;if(!s)return e;var m={isDraggingOver:r,draggingOverWith:l,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:o.placeholder,shouldAnimatePlaceholder:!0,snapshot:m,useClone:null}}));return function(a,i){var r=i.droppableId,s=i.type,o=!i.isDropDisabled,c=i.renderClone;if(a.isDragging){var l=a.critical;if(!ii(s,l))return t;var d=ri(l,a.dimensions),u=Ue(a.impact)===r;return n(r,o,u,u,d,c)}if("DROP_ANIMATING"===a.phase){var m=a.completed;if(!ii(s,m.critical))return t;var h=ri(m.critical,a.dimensions);return n(r,o,Xn(m.result)===r,Ue(m.impact)===r,h,c)}if("IDLE"===a.phase&&a.completed&&!a.shouldFlush){var p=a.completed;if(!ii(s,p.critical))return t;var g=Ue(p.impact)===r,v=Boolean(p.impact.at&&"COMBINE"===p.impact.at.type),f=p.critical.droppable.id===r;return g?v?e:t:f?e:t}return t}}),si,null,{context:Aa,pure:!0,areStatePropsEqual:Qn})((function(e){var t=i.useContext(za);t||y(!1);var a=t.contextId,n=t.isMovementAllowed,s=i.useRef(null),o=i.useRef(null),c=e.children,l=e.droppableId,u=e.type,g=e.mode,v=e.direction,f=e.ignoreContainerClipping,b=e.isDropDisabled,E=e.isCombineEnabled,_=e.snapshot,w=e.useClone,S=e.updateViewportMaxScroll,O=e.getContainerForClone,C=d.useCallback((function(){return s.current}),[]),x=d.useCallback((function(e){s.current=e}),[]),k=(d.useCallback((function(){return o.current}),[]),d.useCallback((function(e){o.current=e}),[]));Ha();var j=d.useCallback((function(){n()&&S({maxScroll:Kt()})}),[n,S]);!function(e){var t=i.useRef(null),a=Mn(za),n=Va("droppable"),r=a.registry,s=a.marshal,o=qa(e),c=d.useMemo((function(){return{id:e.droppableId,type:e.type,mode:e.mode}}),[e.droppableId,e.mode,e.type]),l=i.useRef(c),u=d.useMemo((function(){return m((function(e,a){t.current||y(!1);var n={x:e,y:a};s.updateDroppableScroll(c.id,n)}))}),[c.id,s]),p=d.useCallback((function(){var e=t.current;return e&&e.env.closestScrollable?Rn(e.env.closestScrollable):R}),[]),g=d.useCallback((function(){var e=p();u(e.x,e.y)}),[p,u]),v=d.useMemo((function(){return h(g)}),[g]),f=d.useCallback((function(){var e=t.current,a=An(e);e&&a||y(!1),e.scrollOptions.shouldPublishImmediately?g():v()}),[v,g]),b=d.useCallback((function(e,n){t.current&&y(!1);var i=o.current,r=i.getDroppableRef();r||y(!1);var s=In(r),l={ref:r,descriptor:c,env:s,scrollOptions:n};t.current=l;var d=Tn({ref:r,descriptor:c,env:s,windowScroll:e,direction:i.direction,isDropDisabled:i.isDropDisabled,isCombineEnabled:i.isCombineEnabled,shouldClipSubject:!i.ignoreContainerClipping}),u=s.closestScrollable;return u&&(u.setAttribute(xa.contextId,a.contextId),u.addEventListener("scroll",f,Pn(l.scrollOptions))),d}),[a.contextId,c,f,o]),E=d.useCallback((function(){var e=t.current,a=An(e);return e&&a||y(!1),Rn(a)}),[]),_=d.useCallback((function(){var e=t.current;e||y(!1);var a=An(e);t.current=null,a&&(v.cancel(),a.removeAttribute(xa.contextId),a.removeEventListener("scroll",f,Pn(e.scrollOptions)))}),[f,v]),w=d.useCallback((function(e){var a=t.current;a||y(!1);var n=An(a);n||y(!1),n.scrollTop+=e.y,n.scrollLeft+=e.x}),[]),S=d.useMemo((function(){return{getDimensionAndWatchScroll:b,getScrollWhileDragging:E,dragStopped:_,scroll:w}}),[_,b,E,w]),O=d.useMemo((function(){return{uniqueId:n,descriptor:c,callbacks:S}}),[S,c,n]);ja((function(){return l.current=O.descriptor,r.droppable.register(O),function(){t.current&&_(),r.droppable.unregister(O)}}),[S,c,_,O,s,r.droppable]),ja((function(){t.current&&s.updateDroppableIsEnabled(l.current.id,!e.isDropDisabled)}),[e.isDropDisabled,s]),ja((function(){t.current&&s.updateDroppableIsCombineEnabled(l.current.id,e.isCombineEnabled)}),[e.isCombineEnabled,s])}({droppableId:l,type:u,mode:g,direction:v,isDropDisabled:b,isCombineEnabled:E,ignoreContainerClipping:f,getDroppableRef:C});var I=r.createElement(zn,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},(function(e){var t=e.onClose,n=e.data,i=e.animate;return r.createElement(Bn,{placeholder:n,onClose:t,innerRef:k,animate:i,contextId:a,onTransitionEnd:j})})),T=d.useMemo((function(){return{innerRef:x,placeholder:I,droppableProps:{"data-rbd-droppable-id":l,"data-rbd-droppable-context-id":a}}}),[a,l,I,x]),N=w?w.dragging.draggableId:null,D=d.useMemo((function(){return{droppableId:l,type:u,isUsingCloneFor:N}}),[l,N,u]);return r.createElement(Vn.Provider,{value:D},c(T,_),function(){if(!w)return null;var e=w.dragging,t=w.render,a=r.createElement(ni,{draggableId:e.draggableId,index:e.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},(function(a,n){return t(a,n,e)}));return p.createPortal(a,O())}())}));ci.defaultProps=oi,t.DragDropContext=function(e){var t=d.useMemo((function(){return""+wn++}),[]),a=e.dragHandleUsageInstructions||C;return r.createElement(E,null,(function(n){return r.createElement(_n,{nonce:e.nonce,contextId:t,setCallbacks:n,dragHandleUsageInstructions:a,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd},e.children)}))},t.Draggable=function(e){var t="boolean"!=typeof e.isDragDisabled||!e.isDragDisabled,a=Boolean(e.disableInteractiveElementBlocking),n=Boolean(e.shouldRespectForcePress);return r.createElement(ni,o({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:a,shouldRespectForcePress:n}))},t.Droppable=ci,t.resetServerContext=function(){wn=0,Fa=0},t.useKeyboardSensor=rn,t.useMouseSensor=en,t.useTouchSensor=on},1443:function(e,t,a){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(a(1444));function r(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var s="function"==typeof Symbol&&Symbol.observable||"@@observable",o=function(){return Math.random().toString(36).substring(7).split("").join(".")},c={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function l(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function d(e,t,a){var n;if("function"==typeof t&&"function"==typeof a||"function"==typeof a&&"function"==typeof arguments[3])throw new Error(r(0));if("function"==typeof t&&void 0===a&&(a=t,t=void 0),void 0!==a){if("function"!=typeof a)throw new Error(r(1));return a(d)(e,t)}if("function"!=typeof e)throw new Error(r(2));var i=e,o=t,u=[],m=u,h=!1;function p(){m===u&&(m=u.slice())}function g(){if(h)throw new Error(r(3));return o}function v(e){if("function"!=typeof e)throw new Error(r(4));if(h)throw new Error(r(5));var t=!0;return p(),m.push(e),function(){if(t){if(h)throw new Error(r(6));t=!1,p();var a=m.indexOf(e);m.splice(a,1),u=null}}}function f(e){if(!l(e))throw new Error(r(7));if(void 0===e.type)throw new Error(r(8));if(h)throw new Error(r(9));try{h=!0,o=i(o,e)}finally{h=!1}for(var t=u=m,a=0;a<t.length;a++){(0,t[a])()}return e}function b(e){if("function"!=typeof e)throw new Error(r(10));i=e,f({type:c.REPLACE})}function y(){var e,t=v;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(r(11));function a(){e.next&&e.next(g())}return a(),{unsubscribe:t(a)}}})[s]=function(){return this},e}return f({type:c.INIT}),(n={dispatch:f,subscribe:v,getState:g,replaceReducer:b})[s]=y,n}var u=d;function m(e,t){return function(){return t(e.apply(this,arguments))}}function h(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}t.__DO_NOT_USE__ActionTypes=c,t.applyMiddleware=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return function(e){return function(){var a=e.apply(void 0,arguments),n=function(){throw new Error(r(15))},s={getState:a.getState,dispatch:function(){return n.apply(void 0,arguments)}},o=t.map((function(e){return e(s)}));return n=h.apply(void 0,o)(a.dispatch),i.default(i.default({},a),{},{dispatch:n})}}},t.bindActionCreators=function(e,t){if("function"==typeof e)return m(e,t);if("object"!=typeof e||null===e)throw new Error(r(16));var a={};for(var n in e){var i=e[n];"function"==typeof i&&(a[n]=m(i,t))}return a},t.combineReducers=function(e){for(var t=Object.keys(e),a={},n=0;n<t.length;n++){var i=t[n];0,"function"==typeof e[i]&&(a[i]=e[i])}var s,o=Object.keys(a);try{!function(e){Object.keys(e).forEach((function(t){var a=e[t];if(void 0===a(void 0,{type:c.INIT}))throw new Error(r(12));if(void 0===a(void 0,{type:c.PROBE_UNKNOWN_ACTION()}))throw new Error(r(13))}))}(a)}catch(e){s=e}return function(e,t){if(void 0===e&&(e={}),s)throw s;for(var n=!1,i={},c=0;c<o.length;c++){var l=o[c],d=a[l],u=e[l],m=d(u,t);if(void 0===m){t&&t.type;throw new Error(r(14))}i[l]=m,n=n||m!==u}return(n=n||o.length!==Object.keys(e).length)?i:e}},t.compose=h,t.createStore=d,t.legacy_createStore=u},1444:function(e,t,a){var n=a(6);function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}e.exports=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},1445:function(e,t,a){"use strict";t.__esModule=!0;var n={batch:!0},i=a(1446);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(n,e)||e in t&&t[e]===i[e]||(t[e]=i[e]))}));var r=a(1463);t.batch=r.unstable_batchedUpdates,(0,a(852).setBatch)(r.unstable_batchedUpdates)},1446:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0;var i=n(a(1447));t.Provider=i.default;var r=n(a(853));t.connectAdvanced=r.default;var s=a(281);t.ReactReduxContext=s.ReactReduxContext;var o=n(a(1453));t.connect=o.default;var c=a(1461);t.useDispatch=c.useDispatch,t.createDispatchHook=c.createDispatchHook;var l=a(1462);t.useSelector=l.useSelector,t.createSelectorHook=l.createSelectorHook;var d=a(858);t.useStore=d.useStore,t.createStoreHook=d.createStoreHook;var u=n(a(854));t.shallowEqual=u.default},1447:function(e,t,a){"use strict";var n=a(140).default,i=a(212).default;t.__esModule=!0,t.default=void 0;var r=i(a(90)),s=(n(a(175)),a(281)),o=a(587),c=a(588);var l=function(e){var t=e.store,a=e.context,n=e.children,i=(0,r.useMemo)((function(){var e=(0,o.createSubscription)(t);return{store:t,subscription:e}}),[t]),l=(0,r.useMemo)((function(){return t.getState()}),[t]);(0,c.useIsomorphicLayoutEffect)((function(){var e=i.subscription;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),l!==t.getState()&&e.notifyNestedSubs(),function(){e.tryUnsubscribe(),e.onStateChange=null}}),[i,l]);var d=a||s.ReactReduxContext;return r.default.createElement(d.Provider,{value:i},n)};t.default=l},1448:function(e,t,a){"use strict";var n=a(1449),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},s={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o={};function c(e){return n.isMemo(e)?s:o[e.$$typeof]||i}o[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},o[n.Memo]=s;var l=Object.defineProperty,d=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,m=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,a,n){if("string"!=typeof a){if(p){var i=h(a);i&&i!==p&&e(t,i,n)}var s=d(a);u&&(s=s.concat(u(a)));for(var o=c(t),g=c(a),v=0;v<s.length;++v){var f=s[v];if(!(r[f]||n&&n[f]||g&&g[f]||o&&o[f])){var b=m(a,f);try{l(t,f,b)}catch(e){}}}}return t}},1449:function(e,t,a){"use strict";e.exports=a(1450)},1450:function(e,t,a){"use strict";var n="function"==typeof Symbol&&Symbol.for,i=n?Symbol.for("react.element"):60103,r=n?Symbol.for("react.portal"):60106,s=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,c=n?Symbol.for("react.profiler"):60114,l=n?Symbol.for("react.provider"):60109,d=n?Symbol.for("react.context"):60110,u=n?Symbol.for("react.async_mode"):60111,m=n?Symbol.for("react.concurrent_mode"):60111,h=n?Symbol.for("react.forward_ref"):60112,p=n?Symbol.for("react.suspense"):60113,g=n?Symbol.for("react.suspense_list"):60120,v=n?Symbol.for("react.memo"):60115,f=n?Symbol.for("react.lazy"):60116,b=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,E=n?Symbol.for("react.responder"):60118,_=n?Symbol.for("react.scope"):60119;function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case m:case s:case c:case o:case p:return e;default:switch(e=e&&e.$$typeof){case d:case h:case f:case v:case l:return e;default:return t}}case r:return t}}}function S(e){return w(e)===m}t.AsyncMode=u,t.ConcurrentMode=m,t.ContextConsumer=d,t.ContextProvider=l,t.Element=i,t.ForwardRef=h,t.Fragment=s,t.Lazy=f,t.Memo=v,t.Portal=r,t.Profiler=c,t.StrictMode=o,t.Suspense=p,t.isAsyncMode=function(e){return S(e)||w(e)===u},t.isConcurrentMode=S,t.isContextConsumer=function(e){return w(e)===d},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return w(e)===h},t.isFragment=function(e){return w(e)===s},t.isLazy=function(e){return w(e)===f},t.isMemo=function(e){return w(e)===v},t.isPortal=function(e){return w(e)===r},t.isProfiler=function(e){return w(e)===c},t.isStrictMode=function(e){return w(e)===o},t.isSuspense=function(e){return w(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===s||e===m||e===c||e===o||e===p||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===f||e.$$typeof===v||e.$$typeof===l||e.$$typeof===d||e.$$typeof===h||e.$$typeof===y||e.$$typeof===E||e.$$typeof===_||e.$$typeof===b)},t.typeOf=w},1451:function(e,t,a){"use strict";e.exports=a(1452)},1452:function(e,t,a){"use strict";var n=60103,i=60106,r=60107,s=60108,o=60114,c=60109,l=60110,d=60112,u=60113,m=60120,h=60115,p=60116,g=60121,v=60122,f=60117,b=60129,y=60131;if("function"==typeof Symbol&&Symbol.for){var E=Symbol.for;n=E("react.element"),i=E("react.portal"),r=E("react.fragment"),s=E("react.strict_mode"),o=E("react.profiler"),c=E("react.provider"),l=E("react.context"),d=E("react.forward_ref"),u=E("react.suspense"),m=E("react.suspense_list"),h=E("react.memo"),p=E("react.lazy"),g=E("react.block"),v=E("react.server.block"),f=E("react.fundamental"),b=E("react.debug_trace_mode"),y=E("react.legacy_hidden")}function _(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case r:case o:case s:case u:case m:return e;default:switch(e=e&&e.$$typeof){case l:case d:case p:case h:case c:return e;default:return t}}case i:return t}}}var w=c,S=n,O=d,C=r,x=p,k=h,j=i,R=o,I=s,T=u;t.ContextConsumer=l,t.ContextProvider=w,t.Element=S,t.ForwardRef=O,t.Fragment=C,t.Lazy=x,t.Memo=k,t.Portal=j,t.Profiler=R,t.StrictMode=I,t.Suspense=T,t.isAsyncMode=function(){return!1},t.isConcurrentMode=function(){return!1},t.isContextConsumer=function(e){return _(e)===l},t.isContextProvider=function(e){return _(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return _(e)===d},t.isFragment=function(e){return _(e)===r},t.isLazy=function(e){return _(e)===p},t.isMemo=function(e){return _(e)===h},t.isPortal=function(e){return _(e)===i},t.isProfiler=function(e){return _(e)===o},t.isStrictMode=function(e){return _(e)===s},t.isSuspense=function(e){return _(e)===u},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===o||e===b||e===s||e===u||e===m||e===y||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===h||e.$$typeof===c||e.$$typeof===l||e.$$typeof===d||e.$$typeof===f||e.$$typeof===g||e[0]===v)},t.typeOf=_},1453:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.createConnect=g,t.default=void 0;var i=n(a(101)),r=n(a(372)),s=n(a(853)),o=n(a(854)),c=n(a(1454)),l=n(a(1457)),d=n(a(1458)),u=n(a(1459)),m=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function h(e,t,a){for(var n=t.length-1;n>=0;n--){var i=t[n](e);if(i)return i}return function(t,n){throw new Error("Invalid value of type "+typeof e+" for "+a+" argument when connecting component "+n.wrappedComponentName+".")}}function p(e,t){return e===t}function g(e){var t=void 0===e?{}:e,a=t.connectHOC,n=void 0===a?s.default:a,g=t.mapStateToPropsFactories,v=void 0===g?l.default:g,f=t.mapDispatchToPropsFactories,b=void 0===f?c.default:f,y=t.mergePropsFactories,E=void 0===y?d.default:y,_=t.selectorFactory,w=void 0===_?u.default:_;return function(e,t,a,s){void 0===s&&(s={});var c=s,l=c.pure,d=void 0===l||l,u=c.areStatesEqual,g=void 0===u?p:u,f=c.areOwnPropsEqual,y=void 0===f?o.default:f,_=c.areStatePropsEqual,S=void 0===_?o.default:_,O=c.areMergedPropsEqual,C=void 0===O?o.default:O,x=(0,r.default)(c,m),k=h(e,v,"mapStateToProps"),j=h(t,b,"mapDispatchToProps"),R=h(a,E,"mergeProps");return n(w,(0,i.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:k,initMapDispatchToProps:j,initMergeProps:R,pure:d,areStatesEqual:g,areOwnPropsEqual:y,areStatePropsEqual:S,areMergedPropsEqual:C},x))}}var v=g();t.default=v},1454:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.default=void 0,t.whenMapDispatchToPropsIsFunction=s,t.whenMapDispatchToPropsIsMissing=o,t.whenMapDispatchToPropsIsObject=c;var i=n(a(1455)),r=a(855);function s(e){return"function"==typeof e?(0,r.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function o(e){return e?void 0:(0,r.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function c(e){return e&&"object"==typeof e?(0,r.wrapMapToPropsConstant)((function(t){return(0,i.default)(e,t)})):void 0}var l=[s,o,c];t.default=l},1455:function(e,t,a){"use strict";t.__esModule=!0,t.default=function(e,t){var a={},n=function(n){var i=e[n];"function"==typeof i&&(a[n]=function(){return t(i.apply(void 0,arguments))})};for(var i in e)n(i);return a}},1456:function(e,t,a){"use strict";t.__esModule=!0,t.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var a=t;for(;null!==Object.getPrototypeOf(a);)a=Object.getPrototypeOf(a);return t===a}},1457:function(e,t,a){"use strict";t.__esModule=!0,t.default=void 0,t.whenMapStateToPropsIsFunction=i,t.whenMapStateToPropsIsMissing=r;var n=a(855);function i(e){return"function"==typeof e?(0,n.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function r(e){return e?void 0:(0,n.wrapMapToPropsConstant)((function(){return{}}))}var s=[i,r];t.default=s},1458:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.default=void 0,t.defaultMergeProps=r,t.whenMergePropsIsFunction=o,t.whenMergePropsIsOmitted=c,t.wrapMergePropsFunc=s;var i=n(a(101));n(a(856));function r(e,t,a){return(0,i.default)({},a,e,t)}function s(e){return function(t,a){a.displayName;var n,i=a.pure,r=a.areMergedPropsEqual,s=!1;return function(t,a,o){var c=e(t,a,o);return s?i&&r(c,n)||(n=c):(s=!0,n=c),n}}}function o(e){return"function"==typeof e?s(e):void 0}function c(e){return e?void 0:function(){return r}}var l=[o,c];t.default=l},1459:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.default=function(e,t){var a=t.initMapStateToProps,n=t.initMapDispatchToProps,c=t.initMergeProps,l=(0,i.default)(t,r),d=a(e,l),u=n(e,l),m=c(e,l);0;return(l.pure?o:s)(d,u,m,e,l)},t.impureFinalPropsSelectorFactory=s,t.pureFinalPropsSelectorFactory=o;var i=n(a(372)),r=(n(a(1460)),["initMapStateToProps","initMapDispatchToProps","initMergeProps"]);function s(e,t,a,n){return function(i,r){return a(e(i,r),t(n,r),r)}}function o(e,t,a,n,i){var r,s,o,c,l,d=i.areStatesEqual,u=i.areOwnPropsEqual,m=i.areStatePropsEqual,h=!1;function p(i,h){var p,g,v=!u(h,s),f=!d(i,r);return r=i,s=h,v&&f?(o=e(r,s),t.dependsOnOwnProps&&(c=t(n,s)),l=a(o,c,s)):v?(e.dependsOnOwnProps&&(o=e(r,s)),t.dependsOnOwnProps&&(c=t(n,s)),l=a(o,c,s)):f?(p=e(r,s),g=!m(p,o),o=p,g&&(l=a(o,c,s)),l):l}return function(i,d){return h?p(i,d):(o=e(r=i,s=d),c=t(n,s),l=a(o,c,s),h=!0,l)}}},1460:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.default=function(e,t,a,n){r(e,"mapStateToProps",n),r(t,"mapDispatchToProps",n),r(a,"mergeProps",n)};var i=n(a(857));function r(e,t,a){if(!e)throw new Error("Unexpected value for "+t+" in "+a+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||Object.prototype.hasOwnProperty.call(e,"dependsOnOwnProps")||(0,i.default)("The selector for "+t+" of "+a+" did not specify a value for dependsOnOwnProps.")}},1461:function(e,t,a){"use strict";t.__esModule=!0,t.createDispatchHook=r,t.useDispatch=void 0;var n=a(281),i=a(858);function r(e){void 0===e&&(e=n.ReactReduxContext);var t=e===n.ReactReduxContext?i.useStore:(0,i.createStoreHook)(e);return function(){return t().dispatch}}var s=r();t.useDispatch=s},1462:function(e,t,a){"use strict";t.__esModule=!0,t.createSelectorHook=l,t.useSelector=void 0;var n=a(90),i=a(859),r=a(587),s=a(588),o=a(281),c=function(e,t){return e===t};function l(e){void 0===e&&(e=o.ReactReduxContext);var t=e===o.ReactReduxContext?i.useReduxContext:function(){return(0,n.useContext)(e)};return function(e,a){void 0===a&&(a=c);var i=t(),o=function(e,t,a,i){var o,c=(0,n.useReducer)((function(e){return e+1}),0)[1],l=(0,n.useMemo)((function(){return(0,r.createSubscription)(a,i)}),[a,i]),d=(0,n.useRef)(),u=(0,n.useRef)(),m=(0,n.useRef)(),h=(0,n.useRef)(),p=a.getState();try{if(e!==u.current||p!==m.current||d.current){var g=e(p);o=void 0!==h.current&&t(g,h.current)?h.current:g}else o=h.current}catch(e){throw d.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+d.current.stack+"\n\n"),e}return(0,s.useIsomorphicLayoutEffect)((function(){u.current=e,m.current=p,h.current=o,d.current=void 0})),(0,s.useIsomorphicLayoutEffect)((function(){function e(){try{var e=a.getState();if(e===m.current)return;var n=u.current(e);if(t(n,h.current))return;h.current=n,m.current=e}catch(e){d.current=e}c()}return l.onStateChange=e,l.trySubscribe(),e(),function(){return l.tryUnsubscribe()}}),[a,l]),o}(e,a,i.store,i.subscription);return(0,n.useDebugValue)(o),o}}var d=l();t.useSelector=d},1463:function(e,t,a){"use strict";t.__esModule=!0,t.unstable_batchedUpdates=void 0;var n=a(155);t.unstable_batchedUpdates=n.unstable_batchedUpdates},1464:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(90);function i(e,t){var a=n.useState((function(){return{inputs:t,result:e()}}))[0],i=n.useRef(!0),r=n.useRef(a),s=i.current||Boolean(t&&r.current.inputs&&function(e,t){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}(t,r.current.inputs))?r.current:{inputs:t,result:e()};return n.useEffect((function(){i.current=!1,r.current=s}),[s]),s.result}function r(e,t){return i((function(){return e}),t)}var s=i,o=r;t.useCallback=o,t.useCallbackOne=r,t.useMemo=s,t.useMemoOne=i},1465:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=a(1466))&&"object"==typeof n&&"default"in n?n.default:n,r=function(e){var t=e.top,a=e.right,n=e.bottom,i=e.left;return{top:t,right:a,bottom:n,left:i,width:a-i,height:n-t,x:i,y:t,center:{x:(a+i)/2,y:(n+t)/2}}},s=function(e,t){return{top:e.top-t.top,left:e.left-t.left,bottom:e.bottom+t.bottom,right:e.right+t.right}},o=function(e,t){return{top:e.top+t.top,left:e.left+t.left,bottom:e.bottom-t.bottom,right:e.right-t.right}},c={top:0,right:0,bottom:0,left:0},l=function(e){var t=e.borderBox,a=e.margin,n=void 0===a?c:a,i=e.border,l=void 0===i?c:i,d=e.padding,u=void 0===d?c:d,m=r(s(t,n)),h=r(o(t,l)),p=r(o(h,u));return{marginBox:m,borderBox:r(t),paddingBox:h,contentBox:p,margin:n,border:l,padding:u}},d=function(e){var t=e.slice(0,-2);if("px"!==e.slice(-2))return 0;var a=Number(t);return isNaN(a)&&i(!1),a},u=function(e,t){var a,n,i=e.borderBox,r=e.border,s=e.margin,o=e.padding,c=(n=t,{top:(a=i).top+n.y,left:a.left+n.x,bottom:a.bottom+n.y,right:a.right+n.x});return l({borderBox:c,border:r,margin:s,padding:o})},m=function(e,t){var a={top:d(t.marginTop),right:d(t.marginRight),bottom:d(t.marginBottom),left:d(t.marginLeft)},n={top:d(t.paddingTop),right:d(t.paddingRight),bottom:d(t.paddingBottom),left:d(t.paddingLeft)},i={top:d(t.borderTopWidth),right:d(t.borderRightWidth),bottom:d(t.borderBottomWidth),left:d(t.borderLeftWidth)};return l({borderBox:e,margin:a,padding:n,border:i})};t.calculateBox=m,t.createBox=l,t.expand=s,t.getBox=function(e){var t=e.getBoundingClientRect(),a=window.getComputedStyle(e);return m(t,a)},t.getRect=r,t.offset=u,t.shrink=o,t.withScroll=function(e,t){return void 0===t&&(t={x:window.pageXOffset,y:window.pageYOffset}),u(e,t)}},1466:function(e,t,a){"use strict";var n="Invariant failed";e.exports=function(e,t){if(!e)throw new Error(n)}},1467:function(e,t,a){"use strict";var n=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function i(e,t){if(e.length!==t.length)return!1;for(var a=0;a<e.length;a++)if(i=e[a],r=t[a],!(i===r||n(i)&&n(r)))return!1;var i,r;return!0}e.exports=function(e,t){var a;void 0===t&&(t=i);var n,r=[],s=!1;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return s&&a===this&&t(i,r)||(n=e.apply(this,i),s=!0,a=this,r=i),n}}},1468:function(e,t,a){"use strict";e.exports=function(e){var t=[],a=null,n=function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];t=i,a||(a=requestAnimationFrame((function(){a=null,e.apply(void 0,t)})))};return n.cancel=function(){a&&(cancelAnimationFrame(a),a=null)},n}},1469:function(e,t){e.exports="img/user-onboarding/WorkMessaging.68a2a2e.png"},1470:function(e,t){e.exports="img/user-onboarding/CommunityMessaging.4cff83b.png"},1471:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return c}));var n,i,r,s=a(90);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function c(e){return s.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),s.createElement("g",{clipPath:"url(#default_app_svg__clip0)"},n||(n=s.createElement("rect",{width:20,height:20,rx:4,fill:"url(#default_app_svg__paint0_linear)"})),s.createElement("path",{d:"M2.496 0v20M20 2.5H0M20 10H0M20 17.5H0M10 0v20M17.496 0v20",stroke:"#fff",strokeOpacity:.5,style:{mixBlendMode:"lighten"}}),i||(i=s.createElement("circle",{opacity:.8,cx:10,cy:10,r:7.5,stroke:"#fff"}))),r||(r=s.createElement("defs",null,s.createElement("linearGradient",{id:"default_app_svg__paint0_linear",x1:10,y1:0,x2:10,y2:20,gradientUnits:"userSpaceOnUse"},s.createElement("stop",{stopColor:"#60A6FF"}),s.createElement("stop",{offset:1,stopColor:"#418DED"})),s.createElement("clipPath",{id:"default_app_svg__clip0"},s.createElement("rect",{width:20,height:20,rx:4,fill:"#fff"})))))}t.default="img/element-icons/room/default_app.2034d23.svg"},1472:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return o}));var n,i,r=a(90);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function o(e){return r.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),n||(n=r.createElement("rect",{width:20,height:20,rx:4,fill:"#5ABFF2"})),i||(i=r.createElement("path",{d:"M3 7.875C3 6.839 3.84 6 4.875 6h6.313c1.035 0 1.874.84 1.874 1.875v5c0 1.036-.839 1.875-1.874 1.875H4.875A1.875 1.875 0 013 12.875v-5zM14.375 8.446l1.746-1.336a.547.547 0 01.879.435v5.495c0 .48-.575.727-.923.396l-1.702-1.615V8.446z",fill:"#fff"})))}t.default="img/element-icons/room/default_video.66250a4.svg"},1473:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return l}));var n,i,r,s,o=a(90);function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function l(e){return o.createElement("svg",c({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),n||(n=o.createElement("rect",{width:20,height:20,rx:4,fill:"#FF5B55"})),i||(i=o.createElement("path",{d:"M2 7h16v9a2 2 0 01-2 2H4a2 2 0 01-2-2V7z",fill:"#fff"})),r||(r=o.createElement("rect",{x:3.968,y:9,width:2.997,height:3,rx:.25,fill:"#FF5B55"})),s||(s=o.createElement("rect",{x:10.961,y:13,width:2.997,height:3,rx:.25,fill:"#FF5B55"})))}t.default="img/element-icons/room/default_cal.13af0ea.svg"},1474:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return o}));var n,i,r=a(90);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function o(e){return r.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),n||(n=r.createElement("rect",{width:20,height:20,rx:4,fill:"#FCC639"})),i||(i=r.createElement("path",{d:"M2 7h16v9a2 2 0 01-2 2H4a2 2 0 01-2-2V7z",fill:"#fff"})))}t.default="img/element-icons/room/default_doc.02ee63f.svg"},1475:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return c}));var n,i,r,s=a(90);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function c(e){return s.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),n||(n=s.createElement("rect",{x:1,y:1,width:18,height:18,rx:3,fill:"#17191C",stroke:"#17191C",strokeWidth:2})),i||(i=s.createElement("path",{d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0z",fill:"#fff"})),r||(r=s.createElement("path",{d:"M10 6v3.813l2.5 1.687",stroke:"#000",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}t.default="img/element-icons/room/default_clock.e3e0f9b.svg"},1476:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return I}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(155),c=a.n(o),l=a(113),d=a(1477),u=a(99),m=a(1),h=a(590),p=a(95),g=a(131),v=a(168),f=a(596),b=a(138),y=a(135),E=a(91),_=a(229),w=a(365),S=a(455),O=a(153),C=a(102),x=a(1483),k=a(294),j=a(206),R=a(1485);class I extends h.a{constructor(e,t,a,n){super(e,t,a,n),i()(this,"avatars",void 0),i()(this,"permalinkCreator",void 0),i()(this,"totalSize",void 0),i()(this,"mediaOmitText",void 0),i()(this,"threadsEnabled",void 0),this.avatars=new Map,this.permalinkCreator=new y.a(this.room),this.totalSize=0,this.mediaOmitText=this.exportOptions.attachmentsIncluded?Object(E.a)("Media omitted - file size limit exceeded"):Object(E.a)("Media omitted"),this.threadsEnabled=p.b.getValue("feature_thread")}async getRoomAvatar(){let e;const t=_.b(this.room,32,32,"crop");if(t)try{const a=await fetch(t);e=await a.blob(),this.totalSize+=e.size,this.addFile("room.png",e)}catch(e){m.a.log("Failed to fetch room's avatar"+e)}const a=s.a.createElement(O.a,{width:32,height:32,name:this.room.name,title:this.room.name,url:e?"room.png":null,resizeMethod:"crop"});return Object(d.renderToStaticMarkup)(a)}async wrapHTML(e){var t,a,n,i,r,o,c;const l=await this.getRoomAvatar(),m=Object(b.g)(new Date),h=null===(t=this.room.currentState.getStateEvents(u.b.RoomCreate,""))||void 0===t?void 0:t.getSender(),p=(null===(a=this.room)||void 0===a||null===(n=a.getMember(h))||void 0===n?void 0:n.rawDisplayName)||h,g=this.client.getUserId(),v=null===(i=this.room)||void 0===i||null===(r=i.getMember(g))||void 0===r?void 0:r.rawDisplayName,f=(null===(o=this.room.currentState.getStateEvents(u.b.RoomTopic,""))||void 0===o||null===(c=o.getContent())||void 0===c?void 0:c.topic)||"",y=Object(E.a)("%(creatorName)s created this room.",{creatorName:p}),_=Object(d.renderToStaticMarkup)(s.a.createElement("p",null,Object(E.a)("This is the start of export of <roomName/>. Exported by <exporterDetails/> at %(exportDate)s.",{exportDate:m},{roomName:()=>s.a.createElement("b",null,this.room.name),exporterDetails:()=>s.a.createElement("a",{href:"https://matrix.to/#/"+g,target:"_blank",rel:"noopener noreferrer"},v?s.a.createElement(s.a.Fragment,null,s.a.createElement("b",null,v)," ("+g+")"):s.a.createElement("b",null,g))}))),w=f?Object(E.a)("Topic: %(topic)s",{topic:f}):"";return`\n          <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8" />\n                <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n                <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n                <link href="css/style.css" rel="stylesheet" />\n                <script src="js/script.js"><\/script>\n                <title>Exported Data</title>\n            </head>\n            <body style="height: 100vh;">\n                <section\n                id="matrixchat"\n                style="height: 100%; overflow: auto"\n                class="notranslate"\n                >\n                <div class="mx_MatrixChat_wrapper" aria-hidden="false">\n                    <div class="mx_MatrixChat">\n                    <main class="mx_RoomView">\n                        <div class="mx_RoomHeader light-panel">\n                        <div class="mx_RoomHeader_wrapper" aria-owns="mx_RightPanel">\n                            <div class="mx_RoomHeader_avatar">\n                            <div class="mx_DecoratedRoomAvatar">\n                               ${l}\n                            </div>\n                            </div>\n                            <div class="mx_RoomHeader_name">\n                            <div\n                                dir="auto"\n                                class="mx_RoomHeader_nametext"\n                                title="${this.room.name}"\n                            >\n                                ${this.room.name}\n                            </div>\n                            </div>\n                            <div class="mx_RoomHeader_topic" dir="auto"> ${f} </div>\n                        </div>\n                        </div>\n                        <div class="mx_MainSplit">\n                        <div class="mx_RoomView_body">\n                            <div\n                            class="mx_RoomView_timeline mx_RoomView_timeline_rr_enabled"\n                            >\n                            <div\n                                class="\n                                mx_AutoHideScrollbar\n                                mx_ScrollPanel\n                                mx_RoomView_messagePanel\n                                "\n                            >\n                                <div class="mx_RoomView_messageListWrapper">\n                                <ol\n                                    class="mx_RoomView_MessageList"\n                                    aria-live="polite"\n                                    role="list"\n                                >\n                                <div class="mx_NewRoomIntro">\n                                    ${l}\n                                    <h2> ${this.room.name} </h2>\n                                    <p> ${y} <br/><br/> ${_} </p>\n                                    <br/>\n                                    <p> ${w} </p>\n                                </div>\n                                ${e}\n                                </ol>\n                                </div>\n                            </div>\n                            </div>\n                            <div class="mx_RoomView_statusArea">\n                            <div class="mx_RoomView_statusAreaBox">\n                                <div class="mx_RoomView_statusAreaBox_line"></div>\n                            </div>\n                            </div>\n                        </div>\n                        </div>\n                    </main>\n                    </div>\n                </div>\n                </section>\n                <div id="snackbar"/>\n            </body>\n        </html>`}getAvatarURL(e){const t=e.sender;return t.getMxcAvatarUrl()&&Object(g.b)(t.getMxcAvatarUrl()).getThumbnailOfSourceHttp(30,30,"crop")}async saveAvatarIfNeeded(e){const t=e.sender;if(!this.avatars.has(t.userId))try{const a=this.getAvatarURL(e);this.avatars.set(t.userId,!0);const n=await fetch(a),i=await n.blob();this.addFile(`users/${t.userId.replace(/:/g,"-")}.png`,i)}catch(e){m.a.log("Failed to fetch user's avatar"+e)}}getDateSeparator(e){const t=e.getTs(),a=s.a.createElement("li",{key:t},s.a.createElement(S.a,{forExport:!0,key:t,roomId:e.getRoomId(),ts:t}));return Object(d.renderToStaticMarkup)(a)}needsDateSeparator(e,t){return null==t||Object(b.m)(t.getDate(),e.getDate())}getEventTile(e,t){return s.a.createElement("div",{className:"mx_Export_EventWrapper",id:e.getId()},s.a.createElement(C.a.Provider,{value:this.client},s.a.createElement(w.a,{mxEvent:e,continuation:t,isRedacted:e.isRedacted(),replacingEventId:e.replacingEventId(),forExport:!0,readReceipts:null,alwaysShowTimestamps:!0,readReceiptMap:null,showUrlPreview:!1,checkUnmounting:()=>!1,isTwelveHour:!1,last:!1,lastInSection:!1,permalinkCreator:this.permalinkCreator,lastSuccessful:!1,isSelectedEvent:!1,getRelationsForEvent:null,showReactions:!1,layout:v.a.Group,showReadReceipts:!1})))}async getEventTileMarkup(e,t,a){const n=!!this.getAvatarURL(e);n&&await this.saveAvatarIfNeeded(e);const i=this.getEventTile(e,t);let r;if(e.getContent().msgtype==u.d.Emote||e.getContent().msgtype==u.d.Notice||e.getContent().msgtype===u.d.Text){const e=document.createElement("div");c.a.render(i,e),r=e.innerHTML}else r=Object(d.renderToStaticMarkup)(i);if(a){var s,o;const t=null!==(s=e.getContent().url)&&void 0!==s?s:null===(o=e.getContent().file)||void 0===o?void 0:o.url;r=r.split(t).join(a)}return r=r.replace(/<span class="mx_MFileBody_info_icon".*?>.*?<\/span>/,""),n&&(r=r.replace(encodeURI(this.getAvatarURL(e)).replace(/&/g,"&amp;"),`users/${e.sender.userId.replace(/:/g,"-")}.png`)),r}createModifiedEvent(e,t){const a={msgtype:"m.text",body:""+e,format:"org.matrix.custom.html",formatted_body:""+e};(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(a.formatted_body="<em>"+a.formatted_body+"</em>",a.body="*"+a.body+"*");const n=new l.b;return n.event=t.event,n.sender=t.sender,n.event.type="m.room.message",n.event.content=a,n}async createMessageBody(e){let t,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(this.isAttachment(e))if(this.exportOptions.attachmentsIncluded)try{const n=await this.getMediaBlob(e);if(this.totalSize+n.size>this.exportOptions.maxSize)t=await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText,e),a);else{this.totalSize+=n.size;const i=this.getFilePath(e);t=await this.getEventTileMarkup(e,a,i),this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1),this.addFile(i,n)}}catch(n){m.a.log("Error while fetching file"+n),t=await this.getEventTileMarkup(this.createModifiedEvent(Object(E.a)("Error fetching file"),e),a)}else t=await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText,e),a);else t=await this.getEventTileMarkup(e,a)}catch(n){m.a.error(n),t=await this.getEventTileMarkup(this.createModifiedEvent(Object(k.b)(e),e,!1),a)}return t}async createHTML(t,a){let n="",i=null;for(let r=a;r<Math.min(a+1e3,t.length);r++){const a=t[r];if(this.updateProgress(Object(E.a)("Processing event %(number)s out of %(total)s",{number:r+1,total:t.length}),!1,!0),this.cancelled)return this.cleanUp();if(!Object(j.c)(a,!1))continue;n+=this.needsDateSeparator(a,i)?this.getDateSeparator(a):"";const s=!this.needsDateSeparator(a,i)&&Object(f.b)(i,a,!1,this.threadsEnabled),o=await this.createMessageBody(a,s);this.totalSize+=e.byteLength(o),n+=o,i=a}return this.wrapHTML(n)}async export(){this.updateProgress(Object(E.a)("Starting export..."));const e=performance.now(),t=await this.getRequiredEvents(),a=performance.now();this.updateProgress(Object(E.a)("Fetched %(count)s events in %(seconds)ss",{count:t.length,seconds:(a-e)/1e3}),!0,!1),this.updateProgress(Object(E.a)("Creating HTML..."));const n=new Set;for(let e=0;e<t.length/1e3;e++){const a=await this.createHTML(t,1e3*e);(new DOMParser).parseFromString(a,"text/html").querySelectorAll("*").forEach(e=>{e.classList.forEach(e=>n.add(e))}),this.addFile(`messages${e?e+1:""}.html`,new Blob([a]))}const i=await Object(x.a)(n);this.addFile("css/style.css",new Blob([i])),this.addFile("js/script.js",new Blob([R.a])),await this.downloadZIP();const r=performance.now();this.cancelled?m.a.info("Export cancelled successfully"):(this.updateProgress(Object(E.a)("Export successful!")),this.updateProgress(Object(E.a)("Exported %(count)s events in %(seconds)s seconds",{count:t.length,seconds:(r-e)/1e3}))),this.cleanUp()}}}).call(this,a(31).Buffer)},1477:function(e,t,a){"use strict";e.exports=a(1478)},1478:function(e,t,a){"use strict";var n=a(457),i=a(90);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=60106,o=60107,c=60108,l=60114,d=60109,u=60110,m=60112,h=60113,p=60120,g=60115,v=60116,f=60121,b=60117,y=60119,E=60129,_=60131;if("function"==typeof Symbol&&Symbol.for){var w=Symbol.for;s=w("react.portal"),o=w("react.fragment"),c=w("react.strict_mode"),l=w("react.profiler"),d=w("react.provider"),u=w("react.context"),m=w("react.forward_ref"),h=w("react.suspense"),p=w("react.suspense_list"),g=w("react.memo"),v=w("react.lazy"),f=w("react.block"),b=w("react.fundamental"),y=w("react.scope"),E=w("react.debug_trace_mode"),_=w("react.legacy_hidden")}function S(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case o:return"Fragment";case s:return"Portal";case l:return"Profiler";case c:return"StrictMode";case h:return"Suspense";case p:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case u:return(e.displayName||"Context")+".Consumer";case d:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case g:return S(e.type);case f:return S(e._render);case v:t=e._payload,e=e._init;try{return S(e(t))}catch(e){}}return null}var O=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,C={};function x(e,t){for(var a=0|e._threadCount;a<=t;a++)e[a]=e._currentValue2,e._threadCount=a+1}for(var k=new Uint16Array(16),j=0;15>j;j++)k[j]=j+1;k[15]=0;var R=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I=Object.prototype.hasOwnProperty,T={},N={};function D(e){return!!I.call(N,e)||!I.call(T,e)&&(R.test(e)?N[e]=!0:(T[e]=!0,!1))}function P(e,t,a,n,i,r,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=a,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=s}var M={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){M[e]=new P(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];M[t]=new P(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){M[e]=new P(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){M[e]=new P(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){M[e]=new P(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){M[e]=new P(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){M[e]=new P(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){M[e]=new P(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){M[e]=new P(e,5,!1,e.toLowerCase(),null,!1,!1)}));var A=/[\-:]([a-z])/g;function L(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(A,L);M[t]=new P(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(A,L);M[t]=new P(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(A,L);M[t]=new P(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){M[e]=new P(e,1,!1,e.toLowerCase(),null,!1,!1)})),M.xlinkHref=new P("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){M[e]=new P(e,1,!1,e.toLowerCase(),null,!0,!0)}));var U=/["'&<>]/;function F(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=U.exec(e);if(t){var a,n="",i=0;for(a=t.index;a<e.length;a++){switch(e.charCodeAt(a)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}i!==a&&(n+=e.substring(i,a)),i=a+1,n+=t}e=i!==a?n+e.substring(i,a):n}return e}function B(e,t){var a,n=M.hasOwnProperty(e)?M[e]:null;return(a="style"!==e)&&(a=null!==n?0===n.type:2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1])),a||function(e,t,a,n){if(null==t||function(e,t,a,n){if(null!==a&&0===a.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==a?!a.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,a,n))return!0;if(n)return!1;if(null!==a)switch(a.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(e,t,n,!1)?"":null!==n?(e=n.attributeName,3===(a=n.type)||4===a&&!0===t?e+'=""':(n.sanitizeURL&&(t=""+t),e+'="'+F(t)+'"')):D(e)?e+'="'+F(t)+'"':""}var V="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},z=null,W=null,H=null,G=!1,q=!1,K=null,Y=0;function J(){if(null===z)throw Error(r(321));return z}function $(){if(0<Y)throw Error(r(312));return{memoizedState:null,queue:null,next:null}}function Q(){return null===H?null===W?(G=!1,W=H=$()):(G=!0,H=W):null===H.next?(G=!1,H=H.next=$()):(G=!0,H=H.next),H}function X(e,t,a,n){for(;q;)q=!1,Y+=1,H=null,a=e(t,n);return Z(),a}function Z(){z=null,q=!1,W=null,Y=0,H=K=null}function ee(e,t){return"function"==typeof t?t(e):t}function te(e,t,a){if(z=J(),H=Q(),G){var n=H.queue;if(t=n.dispatch,null!==K&&void 0!==(a=K.get(n))){K.delete(n),n=H.memoizedState;do{n=e(n,a.action),a=a.next}while(null!==a);return H.memoizedState=n,[n,t]}return[H.memoizedState,t]}return e=e===ee?"function"==typeof t?t():t:void 0!==a?a(t):t,H.memoizedState=e,e=(e=H.queue={last:null,dispatch:null}).dispatch=ne.bind(null,z,e),[H.memoizedState,e]}function ae(e,t){if(z=J(),t=void 0===t?null:t,null!==(H=Q())){var a=H.memoizedState;if(null!==a&&null!==t){var n=a[1];e:if(null===n)n=!1;else{for(var i=0;i<n.length&&i<t.length;i++)if(!V(t[i],n[i])){n=!1;break e}n=!0}if(n)return a[0]}}return e=e(),H.memoizedState=[e,t],e}function ne(e,t,a){if(!(25>Y))throw Error(r(301));if(e===z)if(q=!0,e={action:a,next:null},null===K&&(K=new Map),void 0===(a=K.get(t)))K.set(t,e);else{for(t=a;null!==t.next;)t=t.next;t.next=e}}function ie(){}var re=null,se={readContext:function(e){var t=re.threadID;return x(e,t),e[t]},useContext:function(e){J();var t=re.threadID;return x(e,t),e[t]},useMemo:ae,useReducer:te,useRef:function(e){z=J();var t=(H=Q()).memoizedState;return null===t?(e={current:e},H.memoizedState=e):t},useState:function(e){return te(ee,e)},useLayoutEffect:function(){},useCallback:function(e,t){return ae((function(){return e}),t)},useImperativeHandle:ie,useEffect:ie,useDebugValue:ie,useDeferredValue:function(e){return J(),e},useTransition:function(){return J(),[function(e){e()},!1]},useOpaqueIdentifier:function(){return(re.identifierPrefix||"")+"R:"+(re.uniqueID++).toString(36)},useMutableSource:function(e,t){return J(),t(e._source)}},oe="http://www.w3.org/1999/xhtml";function ce(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}var le={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},de=n({menuitem:!0},le),ue={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];Object.keys(ue).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ue[t]=ue[e]}))}));var he=/([A-Z])/g,pe=/^ms-/,ge=i.Children.toArray,ve=O.ReactCurrentDispatcher,fe={listing:!0,pre:!0,textarea:!0},be=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,ye={},Ee={};var _e=Object.prototype.hasOwnProperty,we={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null,suppressHydrationWarning:null};function Se(e,t){if(void 0===e)throw Error(r(152,S(t)||"Component"))}function Oe(e,t,a){function s(i,s){var o=s.prototype&&s.prototype.isReactComponent,c=function(e,t,a,n){if(n&&("object"==typeof(n=e.contextType)&&null!==n))return x(n,a),n[a];if(e=e.contextTypes){for(var i in a={},e)a[i]=t[i];t=a}else t=C;return t}(s,t,a,o),l=[],d=!1,u={isMounted:function(){return!1},enqueueForceUpdate:function(){if(null===l)return null},enqueueReplaceState:function(e,t){d=!0,l=[t]},enqueueSetState:function(e,t){if(null===l)return null;l.push(t)}};if(o){if(o=new s(i.props,c,u),"function"==typeof s.getDerivedStateFromProps){var m=s.getDerivedStateFromProps.call(null,i.props,o.state);null!=m&&(o.state=n({},o.state,m))}}else if(z={},o=s(i.props,c,u),null==(o=X(s,i.props,o,c))||null==o.render)return void Se(e=o,s);if(o.props=i.props,o.context=c,o.updater=u,void 0===(u=o.state)&&(o.state=u=null),"function"==typeof o.UNSAFE_componentWillMount||"function"==typeof o.componentWillMount)if("function"==typeof o.componentWillMount&&"function"!=typeof s.getDerivedStateFromProps&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&"function"!=typeof s.getDerivedStateFromProps&&o.UNSAFE_componentWillMount(),l.length){u=l;var h=d;if(l=null,d=!1,h&&1===u.length)o.state=u[0];else{m=h?u[0]:o.state;var p=!0;for(h=h?1:0;h<u.length;h++){var g=u[h];null!=(g="function"==typeof g?g.call(o,m,i.props,c):g)&&(p?(p=!1,m=n({},m,g)):n(m,g))}o.state=m}}else l=null;if(Se(e=o.render(),s),"function"==typeof o.getChildContext&&"object"==typeof(i=s.childContextTypes)){var v=o.getChildContext();for(var f in v)if(!(f in i))throw Error(r(108,S(s)||"Unknown",f))}v&&(t=n({},t,v))}for(;i.isValidElement(e);){var o=e,c=o.type;if("function"!=typeof c)break;s(o,c)}return{child:e,context:t}}var Ce=function(){function e(e,t,a){i.isValidElement(e)?e.type!==o?e=[e]:(e=e.props.children,e=i.isValidElement(e)?[e]:ge(e)):e=ge(e),e={type:null,domNamespace:oe,children:e,childIndex:0,context:C,footer:""};var n=k[0];if(0===n){var s=k,c=2*(n=s.length);if(!(65536>=c))throw Error(r(304));var l=new Uint16Array(c);for(l.set(s),(k=l)[0]=n+1,s=n;s<c-1;s++)k[s]=s+1;k[c-1]=0}else k[0]=k[n];this.threadID=n,this.stack=[e],this.exhausted=!1,this.currentSelectValue=null,this.previousWasTextNode=!1,this.makeStaticMarkup=t,this.suspenseDepth=0,this.contextIndex=-1,this.contextStack=[],this.contextValueStack=[],this.uniqueID=0,this.identifierPrefix=a&&a.identifierPrefix||""}var t=e.prototype;return t.destroy=function(){if(!this.exhausted){this.exhausted=!0,this.clearProviders();var e=this.threadID;k[e]=k[0],k[0]=e}},t.pushProvider=function(e){var t=++this.contextIndex,a=e.type._context,n=this.threadID;x(a,n);var i=a[n];this.contextStack[t]=a,this.contextValueStack[t]=i,a[n]=e.props.value},t.popProvider=function(){var e=this.contextIndex,t=this.contextStack[e],a=this.contextValueStack[e];this.contextStack[e]=null,this.contextValueStack[e]=null,this.contextIndex--,t[this.threadID]=a},t.clearProviders=function(){for(var e=this.contextIndex;0<=e;e--)this.contextStack[e][this.threadID]=this.contextValueStack[e]},t.read=function(e){if(this.exhausted)return null;var t=re;re=this;var a=ve.current;ve.current=se;try{for(var n=[""],i=!1;n[0].length<e;){if(0===this.stack.length){this.exhausted=!0;var s=this.threadID;k[s]=k[0],k[0]=s;break}var o=this.stack[this.stack.length-1];if(i||o.childIndex>=o.children.length){var c=o.footer;if(""!==c&&(this.previousWasTextNode=!1),this.stack.pop(),"select"===o.type)this.currentSelectValue=null;else if(null!=o.type&&null!=o.type.type&&o.type.type.$$typeof===d)this.popProvider(o.type);else if(o.type===h){this.suspenseDepth--;var l=n.pop();if(i){i=!1;var u=o.fallbackFrame;if(!u)throw Error(r(303));this.stack.push(u),n[this.suspenseDepth]+="\x3c!--$!--\x3e";continue}n[this.suspenseDepth]+=l}n[this.suspenseDepth]+=c}else{var m=o.children[o.childIndex++],p="";try{p+=this.render(m,o.context,o.domNamespace)}catch(e){if(null!=e&&"function"==typeof e.then)throw Error(r(294));throw e}n.length<=this.suspenseDepth&&n.push(""),n[this.suspenseDepth]+=p}}return n[0]}finally{ve.current=a,re=t,Z()}},t.render=function(e,t,a){if("string"==typeof e||"number"==typeof e)return""===(a=""+e)?"":this.makeStaticMarkup?F(a):this.previousWasTextNode?"\x3c!-- --\x3e"+F(a):(this.previousWasTextNode=!0,F(a));if(e=(t=Oe(e,t,this.threadID)).child,t=t.context,null===e||!1===e)return"";if(!i.isValidElement(e)){if(null!=e&&null!=e.$$typeof){if((a=e.$$typeof)===s)throw Error(r(257));throw Error(r(258,a.toString()))}return e=ge(e),this.stack.push({type:null,domNamespace:a,children:e,childIndex:0,context:t,footer:""}),""}var f=e.type;if("string"==typeof f)return this.renderDOM(e,t,a);switch(f){case _:case E:case c:case l:case p:case o:return e=ge(e.props.children),this.stack.push({type:null,domNamespace:a,children:e,childIndex:0,context:t,footer:""}),"";case h:throw Error(r(294));case y:throw Error(r(343))}if("object"==typeof f&&null!==f)switch(f.$$typeof){case m:z={};var w=f.render(e.props,e.ref);return w=X(f.render,e.props,w,e.ref),w=ge(w),this.stack.push({type:null,domNamespace:a,children:w,childIndex:0,context:t,footer:""}),"";case g:return e=[i.createElement(f.type,n({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:a,children:e,childIndex:0,context:t,footer:""}),"";case d:return a={type:e,domNamespace:a,children:f=ge(e.props.children),childIndex:0,context:t,footer:""},this.pushProvider(e),this.stack.push(a),"";case u:f=e.type,w=e.props;var S=this.threadID;return x(f,S),f=ge(w.children(f[S])),this.stack.push({type:e,domNamespace:a,children:f,childIndex:0,context:t,footer:""}),"";case b:throw Error(r(338));case v:return f=(w=(f=e.type)._init)(f._payload),e=[i.createElement(f,n({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:a,children:e,childIndex:0,context:t,footer:""}),""}throw Error(r(130,null==f?f:typeof f,""))},t.renderDOM=function(e,t,a){var s=e.type.toLowerCase();if(a===oe&&ce(s),!ye.hasOwnProperty(s)){if(!be.test(s))throw Error(r(65,s));ye[s]=!0}var o=e.props;if("input"===s)o=n({type:void 0},o,{defaultChecked:void 0,defaultValue:void 0,value:null!=o.value?o.value:o.defaultValue,checked:null!=o.checked?o.checked:o.defaultChecked});else if("textarea"===s){var c=o.value;if(null==c){c=o.defaultValue;var l=o.children;if(null!=l){if(null!=c)throw Error(r(92));if(Array.isArray(l)){if(!(1>=l.length))throw Error(r(93));l=l[0]}c=""+l}null==c&&(c="")}o=n({},o,{value:void 0,children:""+c})}else if("select"===s)this.currentSelectValue=null!=o.value?o.value:o.defaultValue,o=n({},o,{value:void 0});else if("option"===s){l=this.currentSelectValue;var d=function(e){if(null==e)return e;var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(o.children);if(null!=l){var u=null!=o.value?o.value+"":d;if(c=!1,Array.isArray(l)){for(var m=0;m<l.length;m++)if(""+l[m]===u){c=!0;break}}else c=""+l===u;o=n({selected:void 0,children:void 0},o,{selected:c,children:d})}}if(c=o){if(de[s]&&(null!=c.children||null!=c.dangerouslySetInnerHTML))throw Error(r(137,s));if(null!=c.dangerouslySetInnerHTML){if(null!=c.children)throw Error(r(60));if("object"!=typeof c.dangerouslySetInnerHTML||!("__html"in c.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=c.style&&"object"!=typeof c.style)throw Error(r(62))}c=o,l=this.makeStaticMarkup,d=1===this.stack.length,u="<"+e.type;e:if(-1===s.indexOf("-"))m="string"==typeof c.is;else switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":m=!1;break e;default:m=!0}for(_ in c)if(_e.call(c,_)){var h=c[_];if(null!=h){if("style"===_){var p=void 0,g="",v="";for(p in h)if(h.hasOwnProperty(p)){var f=0===p.indexOf("--"),b=h[p];if(null!=b){if(f)var y=p;else if(y=p,Ee.hasOwnProperty(y))y=Ee[y];else{var E=y.replace(he,"-$1").toLowerCase().replace(pe,"-ms-");y=Ee[y]=E}g+=v+y+":",v=p,g+=f=null==b||"boolean"==typeof b||""===b?"":f||"number"!=typeof b||0===b||ue.hasOwnProperty(v)&&ue[v]?(""+b).trim():b+"px",v=";"}}h=g||null}p=null,m?we.hasOwnProperty(_)||(p=D(p=_)&&null!=h?p+'="'+F(h)+'"':""):p=B(_,h),p&&(u+=" "+p)}}l||d&&(u+=' data-reactroot=""');var _=u;c="",le.hasOwnProperty(s)?_+="/>":(_+=">",c="</"+e.type+">");e:{if(null!=(l=o.dangerouslySetInnerHTML)){if(null!=l.__html){l=l.__html;break e}}else if("string"==typeof(l=o.children)||"number"==typeof l){l=F(l);break e}l=null}return null!=l?(o=[],fe.hasOwnProperty(s)&&"\n"===l.charAt(0)&&(_+="\n"),_+=l):o=ge(o.children),e=e.type,a=null==a||"http://www.w3.org/1999/xhtml"===a?ce(e):"http://www.w3.org/2000/svg"===a&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":a,this.stack.push({domNamespace:a,type:s,children:o,childIndex:0,context:t,footer:c}),this.previousWasTextNode=!1,_},e}();t.renderToNodeStream=function(){throw Error(r(207))},t.renderToStaticMarkup=function(e,t){e=new Ce(e,!0,t);try{return e.read(1/0)}finally{e.destroy()}},t.renderToStaticNodeStream=function(){throw Error(r(208))},t.renderToString=function(e,t){e=new Ce(e,!1,t);try{return e.read(1/0)}finally{e.destroy()}},t.version="17.0.2"},1479:function(e,t,a){"use strict";var n=a(1480),i=/[\/\?<>\\:\*\|"]/g,r=/[\x00-\x1f\x80-\x9f]/g,s=/^\.+$/,o=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c=/[\. ]+$/;function l(e,t){if("string"!=typeof e)throw new Error("Input must be string");var a=e.replace(i,t).replace(r,t).replace(s,t).replace(o,t).replace(c,t);return n(a,255)}e.exports=function(e,t){var a=t&&t.replacement||"",n=l(e,a);return""===a?n:l(n,"")}},1480:function(e,t,a){"use strict";var n=a(1481),i=a(1482);e.exports=n.bind(null,i)},1481:function(e,t,a){"use strict";function n(e){return e>=55296&&e<=56319}function i(e){return e>=56320&&e<=57343}e.exports=function(e,t,a){if("string"!=typeof t)throw new Error("Input must be string");for(var r,s,o=t.length,c=0,l=0;l<o;l+=1){if(r=t.charCodeAt(l),s=t[l],n(r)&&i(t.charCodeAt(l+1))&&(s+=t[l+=1]),(c+=e(s))===a)return t.slice(0,l+1);if(c>a)return t.slice(0,l-s.length+1)}return t}},1482:function(e,t,a){"use strict";function n(e){return e>=55296&&e<=56319}function i(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var t=e.length,a=0,r=null,s=null,o=0;o<t;o++)i(r=e.charCodeAt(o))?null!=s&&n(s)?a+=1:a+=3:r<=127?a+=1:r>=128&&r<=2047?a+=2:r>=2048&&r<=65535&&(a+=3),s=r;return a}},1483:function(e,t,a){"use strict";var n=a(1484);const i=/\.[\w-]+/g;function r(e){return e.replace(/font-family: ?(Inter|'Inter'|"Inter")/g,"font-family: -apple-system, BlinkMacSystemFont, avenir next,\n            avenir, segoe ui, helvetica neue, helvetica, Ubuntu, roboto, noto, arial, sans-serif").replace(/font-family: ?Inconsolata/g,"font-family: Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace")}function s(e){var t;return"light"===(null===(t=e.ownerNode.dataset.mxTheme)||void 0===t?void 0:t.toLowerCase())}t.a=async e=>{const t=Array.from(document.styleSheets).filter(e=>{var t;return(null===(t=e.href)||void 0===t?void 0:t.endsWith("bundle.css"))||s(e)});if(!t.some(s)){const e=document.querySelector('link[rel="stylesheet"][href$="theme-light.css"]').href;t.push(await async function(e){const t=document.implementation.createHTMLDocument(""),a=document.createElement("style"),n=await fetch(e);return a.textContent=await n.text(),t.body.appendChild(a),a.sheet}(e))}let a="";for(const n of t)for(const t of n.cssRules){if(t instanceof CSSFontFaceRule)continue;const n=t.selectorText;null!=n&&n.split(",").every(t=>{const a=t.match(i);if(a&&!a.every(t=>e.has(t.substring(1))))return!0})||(a+=r(t.cssText)+"\n")}return a+n.a}},1485:function(e,t,a){"use strict";t.a='/*\nCopyright 2021 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the "License");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\nhttp://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n// This file is raw-imported (imported as plain text) for the export bundle, which is why this is in JS\nfunction showToastIfNeeded(replyId) {\n    const el = document.getElementById(replyId);\n    if (!el) {\n        showToast("The message you\'re looking for wasn\'t exported");\n        return;\n    }\n}\n\nfunction showToast(text) {\n    const el = document.getElementById("snackbar");\n    el.innerHTML = text;\n    el.className = "mx_show";\n    setTimeout(() => {\n        el.className = el.className.replace("mx_show", "");\n    }, 2000);\n}\n\nwindow.onload = () => {\n    document.querySelectorAll(\'.mx_reply_anchor\').forEach(element => {\n        element.addEventListener(\'click\', event => {\n            showToastIfNeeded(event.target.getAttribute("scroll-to"));\n        });\n    });\n};\n\n'},1486:function(e,t,a){"use strict";(function(e){var n=a(90),i=a.n(n),r=a(1),s=a(150),o=a(99),c=a(91),l=a(94),d=a(98),u=a(105),m=a(196),h=a(115),p=a(147);t.a=t=>{const{matrixClient:a,room:g,member:v,onFinished:f}=t,[b,y]=Object(n.useState)(!0);let E=g.getLiveTimeline(),_=[];for(;E;)_=[..._,...E.getEvents().filter(e=>e.getSender()===v.userId&&!e.isRedacted()&&!e.isRedaction()&&e.getType()!==o.b.RoomCreate&&e.getType()!==o.b.RoomServerAcl&&e.getType()!==o.b.RoomEncryption)],E=E.getNeighbouringTimeline(s.b.BACKWARDS);if(0===_.length)return i.a.createElement(m.a,{onFinished:f,title:Object(c.a)("No recent messages by %(user)s found",{user:v.name}),description:i.a.createElement("div",null,i.a.createElement("p",null,Object(c.a)("Try scrolling up in the timeline to see if there are any earlier ones.")))});{_=_.filter(e=>!(b&&e.isState()));const t=_.length,n=v.name,s=async()=>{r.a.info(`Started redacting recent ${t} messages for ${v.userId} in ${g.roomId}`),l.a.dispatch({action:d.a.BulkRedactStart,room_id:g.roomId}),await Promise.resolve(),await Promise.all(_.reverse().map(async e=>{try{await a.redactEvent(g.roomId,e.getId())}catch(t){r.a.error("Could not redact",e.getId()),r.a.error(t)}})),r.a.info(`Finished redacting recent ${t} messages for ${v.userId} in ${g.roomId}`),l.a.dispatch({action:d.a.BulkRedactEnd,room_id:g.roomId})};return i.a.createElement(u.a,{className:"mx_BulkRedactDialog",onFinished:f,title:Object(c.a)("Remove recent messages by %(user)s",{user:n}),contentId:"mx_Dialog_content"},i.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},i.a.createElement("p",null,Object(c.a)("You are about to remove %(count)s messages by %(user)s. This will remove them permanently for everyone in the conversation. Do you wish to continue?",{count:t,user:n})),i.a.createElement("p",null,Object(c.a)("For a large amount of messages, this might take some time. Please don't refresh your client in the meantime.")),i.a.createElement(p.b,{checked:b,onChange:e=>y(e.target.checked)},Object(c.a)("Preserve system messages")),i.a.createElement("div",{className:"mx_BulkRedactDialog_checkboxMicrocopy"},Object(c.a)("Uncheck if you also want to remove system messages on this user (e.g. membership change, profile change…)"))),i.a.createElement(h.a,{primaryButton:Object(c.a)("Remove %(count)s messages",{count:t}),primaryButtonClass:"danger",primaryDisabled:0===t,onPrimaryButtonClick:()=>{e(s),f(!0)},onCancel:()=>f(!1)}))}}}).call(this,a(192).setImmediate)},1487:function(e,t){e.exports="img/stickerpack-placeholder.9c54c13.png"},1488:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return p}));var n,i,r,s,o,c,l,d,u,m=a(90);function h(){return(h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function p(e){return m.createElement("svg",h({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 31 31",role:"presentation","aria-hidden":!0},e),n||(n=m.createElement("path",{fill:"none",d:"M0 0h31v31H0z"})),i||(i=m.createElement("circle",{cx:15.5,cy:15.5,r:15.5,fill:"#A2A2A2"})),r||(r=m.createElement("path",{d:"M22.855 15.5a7.355 7.355 0 11-14.71 0 7.355 7.355 0 0114.71 0zM15.5 24.25a8.75 8.75 0 100-17.5 8.75 8.75 0 000 17.5z",fill:"#fff",stroke:"#fff",strokeWidth:.5})),s||(s=m.createElement("path",{fill:"#A2A2A2",d:"M16.266 30.503h-1.5L14.76 1.1h1.5z"})),o||(o=m.createElement("path",{fill:"#A2A2A2",d:"M8.894 28.844l-1.294-.76L22.605 2.503l1.294.759z"})),c||(c=m.createElement("path",{fill:"#A2A2A2",d:"M2.88 24.495l-.786-1.278L27.71 7.46l.786 1.277z"})),l||(l=m.createElement("path",{fill:"#A2A2A2",d:"M2.163 23.341L1.49 22l26.51-13.264.671 1.341z"})),d||(d=m.createElement("path",{fill:"#A2A2A2",d:"M1.551 22.134L1 20.74 28.433 9.887l.552 1.394z"})),u||(u=m.createElement("path",{d:"M9.5 17l-2 3-2-3h4zM21.5 15l2-3 2 3h-4z",fill:"#fff",stroke:"#fff"})))}t.default="img/room_replaced.80042bb.svg"},1489:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 0C7.163 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm1.251 6.974a1.496 1.496 0 00-2.051-.129 1.495 1.495 0 00-.13.12l-6.274 6.589a1.5 1.5 0 102.173 2.069l3.688-3.873V23.06a1.5 1.5 0 103 0V11.75l3.688 3.873a1.5 1.5 0 102.173-2.07L17.25 6.975z",fill:"#0DBD8B"})))}t.default="img/upload-big.cdac3ea.svg"},1490:function(e,t,a){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.RoomViewLifecycle=void 0,t.RoomViewLifecycle=n,function(e){e.PreviewRoomNotLoggedIn="preview_not_logged_in",e.JoinFromRoomPreview="try_join_not_logged_in"}(n||(t.RoomViewLifecycle=n={}))},1492:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(6),i=a.n(n),r=a(90),s=a(93),o=a(108),c=a(571),l=a(812),d=a(154);class u extends r.PureComponent{constructor(e){super(e),i()(this,"numberEntryFieldRef",Object(r.createRef)()),i()(this,"onCancelClick",()=>{this.props.onFinished(!1)}),i()(this,"onChange",e=>{this.setState({value:e.target.value})}),i()(this,"onFormSubmit",e=>{e.preventDefault(),this.onDialPress()}),i()(this,"onDigitPress",(e,t)=>{var a;(this.setState({value:this.state.value+e}),"click"===t.type)&&(null===(a=this.numberEntryFieldRef.current)||void 0===a||a.focus())}),i()(this,"onDeletePress",e=>{var t;0!==this.state.value.length&&(this.setState({value:this.state.value.slice(0,-1)}),"click"===e.type&&(null===(t=this.numberEntryFieldRef.current)||void 0===t||t.focus()))}),i()(this,"onDialPress",async()=>{d.b.instance.dialNumber(this.state.value),this.props.onFinished(!0)}),this.state={value:""}}render(){const e=r.createElement(l.a,{onBackspacePress:this.onDeletePress});let t;return t=0!==this.state.value.length?r.createElement(o.a,{ref:this.numberEntryFieldRef,className:"mx_DialPadModal_field",id:"dialpad_number",value:this.state.value,autoFocus:!0,onChange:this.onChange,postfixComponent:e}):r.createElement(o.a,{ref:this.numberEntryFieldRef,className:"mx_DialPadModal_field",id:"dialpad_number",value:this.state.value,autoFocus:!0,onChange:this.onChange}),r.createElement("div",{className:"mx_DialPadModal"},r.createElement("div",null,r.createElement(s.a,{className:"mx_DialPadModal_cancel",onClick:this.onCancelClick})),r.createElement("div",{className:"mx_DialPadModal_header"},r.createElement("form",{onSubmit:this.onFormSubmit},t)),r.createElement("div",{className:"mx_DialPadModal_dialPad"},r.createElement(c.a,{hasDial:!0,onDigitPress:this.onDigitPress,onDeletePress:this.onDeletePress,onDialPress:this.onDialPress})))}}},1493:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(91),i=a(219),r=a(165),s=a(100);const o=()=>{window.location.href="mobile_guide/"},c=()=>{document.cookie="element_mobile_redirect_to_guide=false;path=/;max-age=14400",d()},l=()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,t=/Android/.test(navigator.userAgent),a=s.b.get().brand;(e||t)&&(document.cookie.includes("element_mobile_redirect_to_guide=false")||r.a.sharedInstance().addOrReplaceToast({key:"mobileguide",title:Object(n.a)("Use app for a better experience"),props:{description:Object(n.a)("%(brand)s is experimental on a mobile web browser. For a better experience and the latest features, use our free native app.",{brand:a}),acceptLabel:Object(n.a)("Use app"),onAccept:o,rejectLabel:Object(n.a)("Dismiss"),onReject:c},component:i.a,priority:99}))},d=()=>{r.a.sharedInstance().dismissToast("mobileguide")}},1494:function(e,t,a){var n;!function(i,r){"use strict";var s="model",o="name",c="type",l="vendor",d="version",u="mobile",m="tablet",h="smarttv",p=function(e){for(var t={},a=0;a<e.length;a++)t[e[a].toUpperCase()]=e[a];return t},g=function(e,t){return"string"==typeof e&&-1!==v(t).indexOf(v(e))},v=function(e){return e.toLowerCase()},f=function(e,t){if("string"==typeof e)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),void 0===t?e:e.substring(0,255)},b=function(e,t){for(var a,n,i,r,s,o,c=0;c<t.length&&!s;){var l=t[c],d=t[c+1];for(a=n=0;a<l.length&&!s;)if(s=l[a++].exec(e))for(i=0;i<d.length;i++)o=s[++n],"object"==typeof(r=d[i])&&r.length>0?2===r.length?"function"==typeof r[1]?this[r[0]]=r[1].call(this,o):this[r[0]]=r[1]:3===r.length?"function"!=typeof r[1]||r[1].exec&&r[1].test?this[r[0]]=o?o.replace(r[1],r[2]):void 0:this[r[0]]=o?r[1].call(this,o,r[2]):void 0:4===r.length&&(this[r[0]]=o?r[3].call(this,o.replace(r[1],r[2])):void 0):this[r]=o||void 0;c+=2}},y=function(e,t){for(var a in t)if("object"==typeof t[a]&&t[a].length>0){for(var n=0;n<t[a].length;n++)if(g(t[a][n],e))return"?"===a?void 0:a}else if(g(t[a],e))return"?"===a?void 0:a;return e},E={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},_={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d,[o,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d,[o,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[o,d],[/opios[\/ ]+([\w\.]+)/i],[d,[o,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[d,[o,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[o,d],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d,[o,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[d,[o,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[d,[o,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d,[o,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d,[o,"IE"]],[/yabrowser\/([\w\.]+)/i],[d,[o,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[o,/(.+)/,"$1 Secure Browser"],d],[/\bfocus\/([\w\.]+)/i],[d,[o,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[d,[o,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d,[o,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d,[o,"Dolphin"]],[/coast\/([\w\.]+)/i],[d,[o,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[d,[o,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[d,[o,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[o,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[o,/(.+)/,"$1 Browser"],d],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],d],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[o,d],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[o],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[o,"Facebook"],d],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[o,d],[/\bgsa\/([\w\.]+) .*safari\//i],[d,[o,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[d,[o,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[o,"Chrome WebView"],d],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[o,d],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[d,[o,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[d,o],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[o,[d,y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[o,d],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[o,"Netscape"],d],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d,[o,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[o,d]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",v]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[["architecture","arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[["architecture","armhf"]],[/windows (ce|mobile); ppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[["architecture",/ower/,"",v]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[["architecture",v]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[l,"Samsung"],[c,m]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[l,"Samsung"],[c,u]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[l,"Apple"],[c,u]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[l,"Apple"],[c,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[l,"Huawei"],[c,m]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[s,[l,"Huawei"],[c,u]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[l,"Xiaomi"],[c,u]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[l,"Xiaomi"],[c,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[l,"OPPO"],[c,u]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[l,"Vivo"],[c,u]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[l,"Realme"],[c,u]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[l,"Motorola"],[c,u]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[l,"Motorola"],[c,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[l,"LG"],[c,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[l,"LG"],[c,u]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[l,"Lenovo"],[c,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[l,"Nokia"],[c,u]],[/(pixel c)\b/i],[s,[l,"Google"],[c,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[l,"Google"],[c,u]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[l,"Sony"],[c,u]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[l,"Sony"],[c,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[l,"OnePlus"],[c,u]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[l,"Amazon"],[c,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[l,"Amazon"],[c,u]],[/(playbook);[-\w\),; ]+(rim)/i],[s,l,[c,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[l,"BlackBerry"],[c,u]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[l,"ASUS"],[c,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[l,"ASUS"],[c,u]],[/(nexus 9)/i],[s,[l,"HTC"],[c,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[l,[s,/_/g," "],[c,u]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[l,"Acer"],[c,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[l,"Meizu"],[c,u]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[l,"Sharp"],[c,u]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l,s,[c,u]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l,s,[c,m]],[/(surface duo)/i],[s,[l,"Microsoft"],[c,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[l,"Fairphone"],[c,u]],[/(u304aa)/i],[s,[l,"AT&T"],[c,u]],[/\bsie-(\w*)/i],[s,[l,"Siemens"],[c,u]],[/\b(rct\w+) b/i],[s,[l,"RCA"],[c,m]],[/\b(venue[\d ]{2,7}) b/i],[s,[l,"Dell"],[c,m]],[/\b(q(?:mv|ta)\w+) b/i],[s,[l,"Verizon"],[c,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[l,"Barnes & Noble"],[c,m]],[/\b(tm\d{3}\w+) b/i],[s,[l,"NuVision"],[c,m]],[/\b(k88) b/i],[s,[l,"ZTE"],[c,m]],[/\b(nx\d{3}j) b/i],[s,[l,"ZTE"],[c,u]],[/\b(gen\d{3}) b.+49h/i],[s,[l,"Swiss"],[c,u]],[/\b(zur\d{3}) b/i],[s,[l,"Swiss"],[c,m]],[/\b((zeki)?tb.*\b) b/i],[s,[l,"Zeki"],[c,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l,"Dragon Touch"],s,[c,m]],[/\b(ns-?\w{0,9}) b/i],[s,[l,"Insignia"],[c,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[l,"NextBook"],[c,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l,"Voice"],s,[c,u]],[/\b(lvtel\-)?(v1[12]) b/i],[[l,"LvTel"],s,[c,u]],[/\b(ph-1) /i],[s,[l,"Essential"],[c,u]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[l,"Envizen"],[c,m]],[/\b(trio[-\w\. ]+) b/i],[s,[l,"MachSpeed"],[c,m]],[/\btu_(1491) b/i],[s,[l,"Rotor"],[c,m]],[/(shield[\w ]+) b/i],[s,[l,"Nvidia"],[c,m]],[/(sprint) (\w+)/i],[l,s,[c,u]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[l,"Microsoft"],[c,u]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[l,"Zebra"],[c,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[l,"Zebra"],[c,u]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l,s,[c,"console"]],[/droid.+; (shield) bui/i],[s,[l,"Nvidia"],[c,"console"]],[/(playstation [345portablevi]+)/i],[s,[l,"Sony"],[c,"console"]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[l,"Microsoft"],[c,"console"]],[/smart-tv.+(samsung)/i],[l,[c,h]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[l,"Samsung"],[c,h]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l,"LG"],[c,h]],[/(apple) ?tv/i],[l,[s,"Apple TV"],[c,h]],[/crkey/i],[[s,"Chromecast"],[l,"Google"],[c,h]],[/droid.+aft(\w)( bui|\))/i],[s,[l,"Amazon"],[c,h]],[/\(dtv[\);].+(aquos)/i],[s,[l,"Sharp"],[c,h]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[l,f],[s,f],[c,h]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[c,h]],[/((pebble))app/i],[l,s,[c,"wearable"]],[/droid.+; (glass) \d/i],[s,[l,"Google"],[c,"wearable"]],[/droid.+; (wt63?0{2,3})\)/i],[s,[l,"Zebra"],[c,"wearable"]],[/(quest( 2)?)/i],[s,[l,"Facebook"],[c,"wearable"]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l,[c,"embedded"]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[c,u]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[c,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[c,m]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[c,u]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[l,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d,[o,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d,[o,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[o,d],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d,o]],os:[[/microsoft (windows) (vista|xp)/i],[o,d],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[o,[d,y,E]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[o,"Windows"],[d,y,E]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[d,/_/g,"."],[o,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[o,"Mac OS"],[d,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[d,o],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[o,d],[/\(bb(10);/i],[d,[o,"BlackBerry"]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[d,[o,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d,[o,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d,[o,"webOS"]],[/crkey\/([\d\.]+)/i],[d,[o,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[o,"Chromium OS"],d],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[o,d],[/(sunos) ?([\w\.\d]*)/i],[[o,"Solaris"],d],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[o,d]]},w=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof w))return new w(e,t).getResult();var a=e||(void 0!==i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),n=t?function(e,t){var a={};for(var n in e)t[n]&&t[n].length%2==0?a[n]=t[n].concat(e[n]):a[n]=e[n];return a}(_,t):_;return this.getBrowser=function(){var e,t={};return t[o]=void 0,t[d]=void 0,b.call(t,a,n.browser),t.major="string"==typeof(e=t.version)?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0,t},this.getCPU=function(){var e={architecture:void 0};return b.call(e,a,n.cpu),e},this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};return b.call(e,a,n.device),e},this.getEngine=function(){var e={name:void 0,version:void 0};return b.call(e,a,n.engine),e},this.getOS=function(){var e={name:void 0,version:void 0};return b.call(e,a,n.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return a},this.setUA=function(e){return a="string"==typeof e&&e.length>255?f(e,255):e,this},this.setUA(a),this};w.VERSION="1.0.2",w.BROWSER=p([o,d,"major"]),w.CPU=p(["architecture"]),w.DEVICE=p([s,l,c,"console",u,h,m,"wearable","embedded"]),w.ENGINE=w.OS=p([o,d]),void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=w),t.UAParser=w):a(828)?void 0===(n=function(){return w}.call(t,a,t,e))||(e.exports=n):void 0!==i&&(i.UAParser=w);var S=void 0!==i&&(i.jQuery||i.Zepto);if(S&&!S.ua){var O=new w;S.ua=O.getResult(),S.ua.get=function(){return O.getUA()},S.ua.set=function(e){O.setUA(e);var t=O.getResult();for(var a in t)S.ua[a]=t[a]}}}("object"==typeof window?window:this)},1495:function(e,t,a){"use strict";var n=a(871);a.d(t,"a",(function(){return n.a}))},1496:function(e,t,a){"use strict";var n=a(872);a.d(t,"a",(function(){return n.a}))},1497:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 14",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{d:"M17 7H1m0 0l6 6M1 7l6-6",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})))}},1498:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n,i,r=a(90);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function o(e){return r.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0},e),n||(n=r.createElement("g",{clipPath:"url(#devices_svg__clip0_721_35674)"},r.createElement("path",{d:"M5.333 9.333C5.333 8.6 5.933 8 6.667 8H28c.733 0 1.333-.6 1.333-1.334 0-.733-.6-1.333-1.333-1.333H5.333A2.675 2.675 0 002.667 8v14.666H2c-1.107 0-2 .894-2 2 0 1.107.893 2 2 2h16.667v-4H5.333V9.333zm25.334 1.333h-8c-.734 0-1.334.6-1.334 1.334v13.333c0 .734.6 1.334 1.334 1.334h8c.733 0 1.333-.6 1.333-1.334V12c0-.733-.6-1.334-1.333-1.334zm-1.334 12H24v-9.333h5.333v9.333z",fill:"currentColor"}))),i||(i=r.createElement("defs",null,r.createElement("clipPath",{id:"devices_svg__clip0_721_35674"},r.createElement("path",{fill:"#fff",d:"M0 0h32v32H0z"})))))}},1499:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 10a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm-1 3a1 1 0 110-2h1a1 1 0 011 1v3.5h.5a1 1 0 110 2H12a1 1 0 01-1-1V13z",fill:"#000"})))}},1500:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(6),i=a.n(n),r=a(97),s=a(226);function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){return async function(){for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return new Promise((a,i)=>{const o=e.bind(t.matrixClient);o(void 0,...n).then(e=>a(e)).catch(e=>{var l;if(401!==e.httpStatus||null===(l=e.data)||void 0===l||!l.flows)return i(e);r.a.createDialog(s.a,c(c({},t),{},{authData:e.data,makeRequest:e=>o(e,...n),onFinished:(e,t)=>{e?a(t):i(t)}}))})})}}},1501:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(91),s=a(100),o=a(105),c=a(115),l=a(104);t.a=e=>{let{failures:t,source:a,continuation:d,onFinished:u}=e;const[m,h]=Object(n.useState)(2),[p,g]=Object(n.useState)(!1),[v,f]=Object(n.useState)(!1),[b,y]=Object(n.useState)(!1),E=Object(n.useRef)(u),_=new Map([["_afterCrossSigningLocalKeyChange",Object(r.a)("a new master key signature")],["checkOwnCrossSigningTrust",Object(r.a)("a new cross-signing key signature")],["setDeviceVerification",Object(r.a)("a device cross-signing signature")]]),w=Object(r.a)("a key signature"),S=Object(n.useCallback)(async()=>{try{f(!0);const e=new Promise((e,t)=>{E.current=t}).finally(()=>{g(!0)});await Promise.race([d(),e]),y(!0)}catch(e){h(e=>e-1)}finally{E.current=u,f(!1)}},[d,u]);let O;if(!b&&!p&&d&&m>0){const e=_.get(a)||w,n=s.b.get().brand;O=i.a.createElement("div",null,i.a.createElement("p",null,Object(r.a)("%(brand)s encountered an error during upload of:",{brand:n})),i.a.createElement("p",null,e),v&&i.a.createElement(l.a,null),i.a.createElement("pre",null,JSON.stringify(t,null,2)),i.a.createElement(c.a,{primaryButton:"Retry",hasCancel:!0,onPrimaryButtonClick:S,onCancel:E.current,primaryDisabled:v}))}else O=i.a.createElement("div",null,b?i.a.createElement("span",null,Object(r.a)("Upload completed")):p?i.a.createElement("span",null,Object(r.a)("Cancelled signature upload")):i.a.createElement("span",null,Object(r.a)("Unable to upload")),i.a.createElement(c.a,{primaryButton:Object(r.a)("OK"),hasCancel:!1,onPrimaryButtonClick:u}));return i.a.createElement(o.a,{title:b?Object(r.a)("Signature upload success"):Object(r.a)("Signature upload failed"),fixedWidth:!1,onFinished:()=>{}},O)}},1502:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(91),c=a(576),l=a(829),d=a(93),u=a(873),m=a(284);class h extends s.a.Component{constructor(e){super(e),i()(this,"onStoreUpdate",()=>{const e=c.b.sharedInstance();this.setState({phase:e.phase,lostKeys:e.lostKeys()})}),i()(this,"onSkipClick",()=>{c.b.sharedInstance().skip()});const t=c.b.sharedInstance();t.on("update",this.onStoreUpdate),t.start(),this.state={phase:t.phase,lostKeys:t.lostKeys()}}componentWillUnmount(){const e=c.b.sharedInstance();e.off("update",this.onStoreUpdate),e.stop()}render(){const{phase:e,lostKeys:t}=this.state;let a,n,i;if(e===c.a.Loading)return null;if(e===c.a.Intro)t?(a=s.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),n=Object(o.a)("Unable to verify this device")):(a=s.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),n=Object(o.a)("Verify this device"));else if(e===c.a.Done)a=s.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_verified"}),n=Object(o.a)("Device verified");else if(e===c.a.ConfirmSkip)a=s.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),n=Object(o.a)("Are you sure?");else if(e===c.a.Busy)a=s.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),n=Object(o.a)("Verify this device");else if(e===c.a.ConfirmReset)a=s.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),n=Object(o.a)("Really reset verification keys?");else if(e!==c.a.Finished)throw new Error("Unknown phase "+e);return e!==c.a.Intro&&e!==c.a.ConfirmReset||(i=s.a.createElement(d.a,{onClick:this.onSkipClick,className:"mx_CompleteSecurity_skip","aria-label":Object(o.a)("Skip verification for now")})),s.a.createElement(m.a,null,s.a.createElement(u.a,null,s.a.createElement("h1",{className:"mx_CompleteSecurity_header"},a,n,i),s.a.createElement("div",{className:"mx_CompleteSecurity_body"},s.a.createElement(l.a,{onFinished:this.props.onFinished}))))}}},1503:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return g}));var n,i,r,s,o,c,l,d,u,m,h=a(90);function p(){return(p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function g(e){return h.createElement("svg",p({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 793.322 340.809",role:"presentation","aria-hidden":!0},e),n||(n=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M34.004 340.809H2a2 2 0 01-2-2V2a2 2 0 012-2h32.004a2 2 0 012 2v7.71a2 2 0 01-2 2h-21.13v317.386h21.13a2 2 0 012 2.001v7.712a2 2 0 01-2 2z"})),i||(i=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M10.875 9.711v321.386h23.13v7.711H1.999V2.001h32.006v7.71h-23.13zM252.402 233.711h-32.993a2 2 0 01-2-2v-68.073c0-3.949-.154-7.722-.457-11.213-.289-3.282-1.074-6.153-2.332-8.53-1.204-2.276-3.017-4.119-5.384-5.476-2.393-1.362-5.775-2.056-10.042-2.056-4.238 0-7.674.798-10.213 2.371-2.565 1.596-4.604 3.701-6.053 6.258-1.498 2.643-2.51 5.694-3.013 9.067a72.757 72.757 0 00-.793 10.741v66.91a2 2 0 01-2 2h-32.991a2 2 0 01-2-2v-67.373c0-3.435-.078-6.964-.228-10.485-.148-3.251-.767-6.278-1.841-8.995-1.018-2.571-2.667-4.584-5.047-6.153-2.372-1.552-6.029-2.341-10.865-2.341-1.372 0-3.265.328-5.629.976-2.28.624-4.536 1.826-6.705 3.577-2.152 1.732-4.036 4.306-5.605 7.655-1.569 3.356-2.367 7.877-2.367 13.438v69.701a2 2 0 01-2 2H68.857a2 2 0 01-2-2V111.594a2 2 0 012-1.999h31.13a2 2 0 012 1.999v11.007c3.834-4.499 8.248-8.152 13.173-10.896 6.396-3.559 13.799-5.362 22.002-5.362 7.846 0 15.127 1.548 21.642 4.604 5.794 2.722 10.424 7.26 13.791 13.52 3.449-4.362 7.833-8.306 13.071-11.752 6.422-4.228 14.102-6.371 22.824-6.371 6.499 0 12.625.807 18.209 2.399 5.686 1.628 10.635 4.271 14.712 7.857 4.088 3.605 7.318 8.357 9.601 14.123 2.25 5.719 3.391 12.649 3.391 20.604v80.384a2.002 2.002 0 01-2.001 2z"})),r||(r=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M99.988 111.595v16.264h.463c4.338-6.191 9.563-10.998 15.684-14.406 6.117-3.402 13.129-5.11 21.027-5.11 7.588 0 14.521 1.475 20.793 4.415 6.274 2.945 11.038 8.131 14.291 15.567 3.56-5.265 8.4-9.913 14.521-13.94 6.117-4.025 13.358-6.042 21.724-6.042 6.351 0 12.234.776 17.66 2.325 5.418 1.549 10.065 4.027 13.938 7.434 3.869 3.41 6.889 7.863 9.062 13.357 2.167 5.504 3.253 12.122 3.253 19.869v80.385H219.41v-68.074c0-4.025-.154-7.82-.465-11.385-.313-3.56-1.161-6.656-2.555-9.293-1.395-2.631-3.45-4.724-6.157-6.274-2.711-1.543-6.391-2.322-11.037-2.322s-8.403.896-11.269 2.671c-2.868 1.784-5.112 4.109-6.737 6.971-1.626 2.869-2.711 6.12-3.252 9.762a74.395 74.395 0 00-.814 11.035v66.91h-32.991v-67.375c0-3.562-.081-7.087-.23-10.57-.158-3.487-.814-6.7-1.978-9.645-1.162-2.94-3.099-5.304-5.809-7.088-2.711-1.775-6.699-2.671-11.965-2.671-1.551 0-3.603.349-6.156 1.048-2.556.697-5.036 2.016-7.435 3.949-2.404 1.938-4.454 4.726-6.158 8.363-1.705 3.642-2.556 8.402-2.556 14.287v69.701h-32.99V111.595h31.132zM304.909 236.733c-5.883 0-11.46-.729-16.574-2.163-5.192-1.464-9.806-3.774-13.713-6.871-3.944-3.117-7.068-7.111-9.282-11.871-2.205-4.733-3.324-10.412-3.324-16.876 0-7.13 1.293-13.117 3.846-17.797 2.542-4.674 5.877-8.464 9.912-11.263 3.97-2.752 8.556-4.842 13.63-6.209a142.954 142.954 0 0114.961-3.184 261.677 261.677 0 0114.754-1.872c4.679-.452 8.88-1.139 12.489-2.039 3.412-.854 6.118-2.09 8.042-3.672 1.666-1.37 2.416-3.384 2.292-6.151-.002-3.289-.502-5.816-1.492-7.595-.998-1.798-2.283-3.15-3.927-4.138-1.703-1.02-3.725-1.713-6.012-2.062-2.47-.37-5.146-.557-7.947-.557-6.034 0-10.789 1.271-14.135 3.783-3.233 2.424-5.155 6.64-5.714 12.527a2.003 2.003 0 01-1.992 1.812h-32.992a2.006 2.006 0 01-1.457-.629 2.013 2.013 0 01-.54-1.491c.485-8.073 2.55-14.894 6.142-20.272a41.725 41.725 0 0113.661-12.931c5.424-3.191 11.612-5.498 18.392-6.857a103.675 103.675 0 0120.26-2.013c6.096 0 12.365.437 18.626 1.296 6.377.88 12.285 2.622 17.562 5.177 5.376 2.604 9.845 6.29 13.282 10.951 3.498 4.744 5.271 11.048 5.271 18.731v62.494c0 5.307.306 10.462.915 15.319.576 4.64 1.572 8.116 2.963 10.338.385.616.407 1.395.055 2.031a2.002 2.002 0 01-1.75 1.03h-33.457c-.861 0-1.624-.55-1.898-1.367a49.145 49.145 0 01-1.572-5.936 49.182 49.182 0 01-.38-2.12 44.922 44.922 0 01-16.474 9.105 77.066 77.066 0 01-22.423 3.342zm37.032-60.072c-.809.409-1.676.768-2.596 1.074-2.161.72-4.511 1.326-6.988 1.807-2.442.475-5.033.872-7.699 1.186-2.631.311-5.251.697-7.784 1.146a56.995 56.995 0 00-7.051 1.792c-2.194.711-4.114 1.667-5.699 2.842-1.531 1.128-2.785 2.587-3.731 4.335-.917 1.709-1.385 3.97-1.385 6.719 0 2.598.465 4.778 1.385 6.481.928 1.722 2.142 3.035 3.716 4.018 1.644 1.026 3.601 1.757 5.816 2.17 2.344.439 4.799.663 7.297.663 6.105 0 10.836-.996 14.063-2.961 3.244-1.973 5.666-4.349 7.199-7.062 1.568-2.78 2.542-5.62 2.892-8.436.376-3.019.565-5.436.565-7.187v-8.587z"})),s||(s=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M273.544 129.255c3.405-5.113 7.744-9.215 13.012-12.316 5.264-3.097 11.186-5.303 17.771-6.621a101.17 101.17 0 0119.865-1.976c6.042 0 12.158.428 18.354 1.277 6.195.855 11.85 2.522 16.962 4.997 5.111 2.477 9.292 5.926 12.546 10.338 3.253 4.414 4.879 10.262 4.879 17.543v62.494c0 5.428.31 10.611.931 15.567.615 4.959 1.701 8.676 3.251 11.153H347.66a46.656 46.656 0 01-1.511-5.693 48.292 48.292 0 01-.813-5.923c-5.267 5.422-11.465 9.217-18.585 11.386a74.81 74.81 0 01-21.842 3.251c-5.733 0-11.077-.698-16.033-2.09-4.958-1.395-9.293-3.562-13.01-6.51-3.718-2.938-6.622-6.656-8.713-11.147s-3.138-9.84-3.138-16.033c0-6.813 1.199-12.43 3.604-16.84 2.399-4.417 5.495-7.939 9.295-10.575 3.793-2.632 8.129-4.607 13.01-5.923a140.326 140.326 0 0114.752-3.137 253.631 253.631 0 0114.638-1.857c4.801-.466 9.062-1.164 12.779-2.093 3.718-.929 6.658-2.282 8.829-4.065 2.165-1.781 3.172-4.375 3.02-7.785 0-3.56-.58-6.389-1.742-8.479-1.161-2.09-2.711-3.719-4.646-4.88-1.937-1.161-4.183-1.936-6.737-2.325-2.557-.382-5.309-.58-8.248-.58-6.506 0-11.617 1.395-15.335 4.183-3.716 2.788-5.889 7.437-6.506 13.94h-32.991c.462-7.742 2.395-14.173 5.807-19.281zm65.169 46.583a53.802 53.802 0 01-6.736 1.741c-2.402.465-4.918.853-7.551 1.161-2.635.313-5.268.698-7.899 1.163a59.302 59.302 0 00-7.317 1.857c-2.404.779-4.495 1.822-6.274 3.138-1.784 1.317-3.216 2.985-4.3 4.994-1.085 2.014-1.626 4.571-1.626 7.668 0 2.94.541 5.422 1.626 7.431 1.084 2.017 2.558 3.604 4.416 4.765s4.025 1.976 6.507 2.438c2.475.466 5.031.698 7.665.698 6.505 0 11.537-1.082 15.103-3.253 3.561-2.166 6.192-4.762 7.899-7.785 1.702-3.019 2.749-6.072 3.137-9.174.384-3.097.58-5.576.58-7.434V172.93c-1.396 1.243-3.138 2.21-5.23 2.908zM444.542 234.874c-5.187 0-10.173-.361-14.823-1.069-4.802-.732-9.104-2.183-12.779-4.313-3.789-2.185-6.821-5.341-9.006-9.375-2.163-3.986-3.26-9.232-3.26-15.59v-68.859h-17.981a2 2 0 01-2-1.999v-22.073a2 2 0 012-1.999h17.981V75.582a2 2 0 012-2h32.992a2 2 0 012 2v34.014h22.162a2 2 0 012 1.999v22.073a2 2 0 01-2 1.999h-22.162v57.479c0 6.229 1.198 8.731 2.202 9.733 1.004 1.007 3.506 2.205 9.738 2.205 1.804 0 3.542-.076 5.161-.225a44.198 44.198 0 004.669-.665 1.994 1.994 0 011.661.415c.463.379.73.946.73 1.546v25.555a2 2 0 01-1.672 1.974c-2.834.472-6.041.794-9.527.957-3.613.157-6.91.233-10.086.233z"})),o||(o=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M463.825 111.595v22.072h-24.161v59.479c0 5.573.928 9.292 2.788 11.149 1.856 1.859 5.576 2.788 11.152 2.788 1.859 0 3.638-.076 5.343-.232a45.912 45.912 0 004.878-.696v25.557c-2.788.465-5.887.773-9.293.931-3.407.149-6.737.23-9.99.23-5.111 0-9.953-.35-14.521-1.048-4.571-.695-8.597-2.047-12.081-4.063-3.486-2.011-6.236-4.88-8.248-8.597-2.016-3.714-3.021-8.595-3.021-14.639v-70.859h-19.98v-22.072h19.98V75.583h32.992v36.012h24.162zM512.613 233.711h-32.991a2 2 0 01-2-2V111.594a2 2 0 012-1.999h31.366a2 2 0 012 1.999v15.069a43.465 43.465 0 013.199-4.382 43.541 43.541 0 019.496-8.522 46.77 46.77 0 0111.415-5.462c4.056-1.298 8.327-1.954 12.691-1.954 2.341 0 4.953.418 7.766 1.243a2 2 0 011.437 1.92v30.67a2 2 0 01-2.395 1.96c-1.484-.3-3.299-.565-5.392-.787a57.416 57.416 0 00-6.062-.339c-5.706 0-10.572.95-14.467 2.823-3.862 1.86-7.012 4.428-9.361 7.629-2.389 3.263-4.115 7.12-5.127 11.47-1.043 4.479-1.574 9.409-1.574 14.647v54.132a2.002 2.002 0 01-2.001 2z"})),c||(c=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M510.988 111.595V133.9h.465c1.546-3.72 3.636-7.163 6.272-10.341a41.182 41.182 0 019.06-8.131 44.466 44.466 0 0110.923-5.228c3.868-1.237 7.898-1.859 12.081-1.859 2.168 0 4.566.39 7.202 1.163v30.67c-1.551-.312-3.41-.584-5.576-.814a58.79 58.79 0 00-6.274-.35c-6.041 0-11.152 1.01-15.332 3.021-4.182 2.014-7.55 4.761-10.107 8.247-2.555 3.487-4.379 7.55-5.462 12.198-1.083 4.645-1.625 9.682-1.625 15.102v54.133h-32.991V111.595h31.364zM603.923 233.711H570.93a2 2 0 01-2-2V111.594a2 2 0 012-1.999h32.994a2 2 0 012 1.999v120.117a2.002 2.002 0 01-2.001 2zm0-138.705H570.93a2 2 0 01-2-1.999V65.825a2 2 0 012-2h32.994a2 2 0 012 2v27.182a2.002 2.002 0 01-2.001 1.999z"})),l||(l=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M570.93 93.007V65.824h32.994v27.183H570.93zm32.994 18.588v120.117H570.93V111.595h32.994zM742.163 233.711h-37.64a1.995 1.995 0 01-1.667-.896l-23.426-35.352-23.426 35.352a1.992 1.992 0 01-1.667.896h-36.938a2.003 2.003 0 01-1.77-1.067 2.002 2.002 0 01.118-2.061l42.435-62.055-38.71-55.793a2.001 2.001 0 011.643-3.14h37.636c.665 0 1.287.33 1.658.882l19.477 28.893 19.255-28.884a2.004 2.004 0 011.665-.891h36.475c.746 0 1.43.415 1.776 1.078.343.66.289 1.46-.139 2.071l-38.69 55.082 43.578 62.744c.424.61.474 1.408.128 2.066a1.992 1.992 0 01-1.771 1.075z"})),d||(d=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M621.115 111.595h37.637l21.144 31.365 20.911-31.365h36.476l-39.496 56.226 44.377 63.892h-37.64l-25.093-37.87-25.094 37.87h-36.938l43.213-63.193-39.497-56.925zM791.322 340.809h-32.008a2 2 0 01-2-2v-7.712a2 2 0 012-2.001h21.13V11.71h-21.13a2 2 0 01-2-2V2a2 2 0 012-2h32.008a2 2 0 012 2v336.809a2 2 0 01-2 2z"})),u||(u=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M782.443 331.097V9.711h-23.13v-7.71h32.008v336.807h-32.008v-7.711h23.13z"})),m||(m=h.createElement("path",{d:"M10.875 9.711v321.386h23.13v7.711H1.999V2.001h32.006v7.71h-23.13zM99.988 111.595v16.264h.463c4.338-6.191 9.563-10.998 15.684-14.406 6.117-3.402 13.129-5.11 21.027-5.11 7.588 0 14.521 1.475 20.793 4.415 6.274 2.945 11.038 8.131 14.291 15.567 3.56-5.265 8.4-9.913 14.521-13.94 6.117-4.025 13.358-6.042 21.724-6.042 6.351 0 12.234.776 17.66 2.325 5.418 1.549 10.065 4.027 13.938 7.434 3.869 3.41 6.889 7.863 9.062 13.357 2.167 5.504 3.253 12.122 3.253 19.869v80.385H219.41v-68.074c0-4.025-.154-7.82-.465-11.385-.313-3.56-1.161-6.656-2.555-9.293-1.395-2.631-3.45-4.724-6.157-6.274-2.711-1.543-6.391-2.322-11.037-2.322s-8.403.896-11.269 2.671c-2.868 1.784-5.112 4.109-6.737 6.971-1.626 2.869-2.711 6.12-3.252 9.762a74.395 74.395 0 00-.814 11.035v66.91h-32.991v-67.375c0-3.562-.081-7.087-.23-10.57-.158-3.487-.814-6.7-1.978-9.645-1.162-2.94-3.099-5.304-5.809-7.088-2.711-1.775-6.699-2.671-11.965-2.671-1.551 0-3.603.349-6.156 1.048-2.556.697-5.036 2.016-7.435 3.949-2.404 1.938-4.454 4.726-6.158 8.363-1.705 3.642-2.556 8.402-2.556 14.287v69.701h-32.99V111.595h31.132zM273.544 129.255c3.405-5.113 7.744-9.215 13.012-12.316 5.264-3.097 11.186-5.303 17.771-6.621a101.17 101.17 0 0119.865-1.976c6.042 0 12.158.428 18.354 1.277 6.195.855 11.85 2.522 16.962 4.997 5.111 2.477 9.292 5.926 12.546 10.338 3.253 4.414 4.879 10.262 4.879 17.543v62.494c0 5.428.31 10.611.931 15.567.615 4.959 1.701 8.676 3.251 11.153H347.66a46.656 46.656 0 01-1.511-5.693 48.292 48.292 0 01-.813-5.923c-5.267 5.422-11.465 9.217-18.585 11.386a74.81 74.81 0 01-21.842 3.251c-5.733 0-11.077-.698-16.033-2.09-4.958-1.395-9.293-3.562-13.01-6.51-3.718-2.938-6.622-6.656-8.713-11.147s-3.138-9.84-3.138-16.033c0-6.813 1.199-12.43 3.604-16.84 2.399-4.417 5.495-7.939 9.295-10.575 3.793-2.632 8.129-4.607 13.01-5.923a140.326 140.326 0 0114.752-3.137 253.631 253.631 0 0114.638-1.857c4.801-.466 9.062-1.164 12.779-2.093 3.718-.929 6.658-2.282 8.829-4.065 2.165-1.781 3.172-4.375 3.02-7.785 0-3.56-.58-6.389-1.742-8.479-1.161-2.09-2.711-3.719-4.646-4.88-1.937-1.161-4.183-1.936-6.737-2.325-2.557-.382-5.309-.58-8.248-.58-6.506 0-11.617 1.395-15.335 4.183-3.716 2.788-5.889 7.437-6.506 13.94h-32.991c.462-7.742 2.395-14.173 5.807-19.281zm65.169 46.583a53.802 53.802 0 01-6.736 1.741c-2.402.465-4.918.853-7.551 1.161-2.635.313-5.268.698-7.899 1.163a59.302 59.302 0 00-7.317 1.857c-2.404.779-4.495 1.822-6.274 3.138-1.784 1.317-3.216 2.985-4.3 4.994-1.085 2.014-1.626 4.571-1.626 7.668 0 2.94.541 5.422 1.626 7.431 1.084 2.017 2.558 3.604 4.416 4.765s4.025 1.976 6.507 2.438c2.475.466 5.031.698 7.665.698 6.505 0 11.537-1.082 15.103-3.253 3.561-2.166 6.192-4.762 7.899-7.785 1.702-3.019 2.749-6.072 3.137-9.174.384-3.097.58-5.576.58-7.434V172.93c-1.396 1.243-3.138 2.21-5.23 2.908zM463.825 111.595v22.072h-24.161v59.479c0 5.573.928 9.292 2.788 11.149 1.856 1.859 5.576 2.788 11.152 2.788 1.859 0 3.638-.076 5.343-.232a45.912 45.912 0 004.878-.696v25.557c-2.788.465-5.887.773-9.293.931-3.407.149-6.737.23-9.99.23-5.111 0-9.953-.35-14.521-1.048-4.571-.695-8.597-2.047-12.081-4.063-3.486-2.011-6.236-4.88-8.248-8.597-2.016-3.714-3.021-8.595-3.021-14.639v-70.859h-19.98v-22.072h19.98V75.583h32.992v36.012h24.162zM510.988 111.595V133.9h.465c1.546-3.72 3.636-7.163 6.272-10.341a41.182 41.182 0 019.06-8.131 44.466 44.466 0 0110.923-5.228c3.868-1.237 7.898-1.859 12.081-1.859 2.168 0 4.566.39 7.202 1.163v30.67c-1.551-.312-3.41-.584-5.576-.814a58.79 58.79 0 00-6.274-.35c-6.041 0-11.152 1.01-15.332 3.021-4.182 2.014-7.55 4.761-10.107 8.247-2.555 3.487-4.379 7.55-5.462 12.198-1.083 4.645-1.625 9.682-1.625 15.102v54.133h-32.991V111.595h31.364zM570.93 93.007V65.824h32.994v27.183H570.93zm32.994 18.588v120.117H570.93V111.595h32.994zM621.115 111.595h37.637l21.144 31.365 20.911-31.365h36.476l-39.496 56.226 44.377 63.892h-37.64l-25.093-37.87-25.094 37.87h-36.938l43.213-63.193-39.497-56.925zM782.443 331.097V9.711h-23.13v-7.71h32.008v336.807h-32.008v-7.711h23.13z"})))}t.default="img/matrix.d12f502.svg"},1505:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.98 1.28a4.872 4.872 0 01-1.114 3.49 4.099 4.099 0 01-3.237 1.53 4.636 4.636 0 011.144-3.36 4.957 4.957 0 013.207-1.66zm3.974 7.428a4.949 4.949 0 00-2.357 4.152 4.782 4.782 0 002.92 4.4 10.963 10.963 0 01-1.519 3.092c-.894 1.338-1.832 2.645-3.32 2.669-.708.016-1.186-.187-1.684-.4-.52-.22-1.06-.451-1.907-.451-.899 0-1.464.238-2.01.467-.47.198-.927.39-1.57.417-1.417.053-2.5-1.428-3.427-2.753-1.853-2.707-3.296-7.628-1.362-10.976a5.315 5.315 0 014.473-2.728c.804-.017 1.576.293 2.252.565.517.208.979.393 1.357.393.332 0 .78-.178 1.304-.386.824-.326 1.832-.727 2.859-.619 1.596.05 3.075.85 3.99 2.158z",fill:"#17191C"})))}t.default="img/element-icons/brands/apple.5160971.svg"},1506:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return c}));var n,i,r,s=a(90);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function c(e){return s.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),n||(n=s.createElement("mask",{id:"facebook_svg__a",maskUnits:"userSpaceOnUse",x:2,y:1,width:22,height:22},s.createElement("path",{d:"M2.102 1.5H23.1v20.872H2.102V1.5z",fill:"#fff"}))),i||(i=s.createElement("g",{mask:"url(#facebook_svg__a)"},s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M23.1 11.999c0-5.799-4.701-10.5-10.5-10.5S2.1 6.2 2.1 11.999c0 5.24 3.84 9.585 8.86 10.373v-7.338H8.292V12h2.666V9.686c0-2.632 1.568-4.085 3.966-4.085 1.15 0 2.35.205 2.35.205V8.39h-1.323c-1.305 0-1.711.809-1.711 1.64v1.969h2.912l-.466 3.035h-2.446v7.338c5.02-.788 8.859-5.132 8.859-10.373z",fill:"#1877F2"}))),r||(r=s.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.687 15.034L17.153 12H14.24v-1.97c0-.83.406-1.64 1.71-1.64h1.325V5.807s-1.202-.205-2.35-.205c-2.4 0-3.967 1.453-3.967 4.085v2.313H8.293v3.035h2.666v7.338a10.588 10.588 0 003.282 0v-7.338h2.446z",fill:"#fff"})))}t.default="img/element-icons/brands/facebook.c3243cf.svg"},1507:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{d:"M20.842 7.106a9.707 9.707 0 00-3.548-3.548C15.8 2.686 14.169 2.25 12.4 2.25c-1.769 0-3.4.436-4.894 1.308a9.707 9.707 0 00-3.548 3.548C3.086 8.6 2.65 10.23 2.65 12c0 2.124.62 4.035 1.86 5.732 1.24 1.696 2.841 2.87 4.805 3.522.228.043.398.013.508-.088a.497.497 0 00.165-.381l-.007-.686c-.004-.431-.006-.808-.006-1.13l-.292.051a3.725 3.725 0 01-.705.045 5.354 5.354 0 01-.882-.09 1.97 1.97 0 01-.85-.38 1.611 1.611 0 01-.56-.78l-.126-.293a3.174 3.174 0 00-.4-.647c-.182-.237-.366-.398-.552-.482l-.089-.064a.928.928 0 01-.165-.152.696.696 0 01-.114-.178c-.026-.06-.005-.108.063-.146.068-.039.19-.057.368-.057l.254.038c.17.034.379.135.629.304.25.17.454.39.615.66.195.348.43.612.705.794.275.182.552.273.831.273.28 0 .52-.021.724-.063.203-.043.393-.107.571-.191.076-.567.284-1.003.622-1.308a8.696 8.696 0 01-1.301-.228 5.18 5.18 0 01-1.193-.496 3.419 3.419 0 01-1.022-.85c-.271-.339-.493-.783-.667-1.333-.173-.55-.26-1.185-.26-1.904 0-1.025.335-1.896 1.003-2.616-.313-.77-.284-1.633.089-2.59.245-.076.61-.018 1.092.172.482.19.835.354 1.06.489.224.135.404.25.54.343.787-.22 1.599-.33 2.437-.33.838 0 1.65.11 2.438.33l.482-.305c.33-.203.72-.39 1.168-.559.448-.169.791-.215 1.028-.14.381.957.415 1.82.102 2.59.668.72 1.003 1.592 1.003 2.616 0 .72-.087 1.356-.26 1.91-.174.555-.398.999-.673 1.333a3.55 3.55 0 01-1.028.845c-.411.228-.809.393-1.194.495a8.69 8.69 0 01-1.301.229c.44.38.66.981.66 1.802v2.678c0 .153.053.28.159.381.105.102.273.131.501.089 1.964-.652 3.566-1.826 4.805-3.523 1.24-1.697 1.86-3.607 1.86-5.732 0-1.768-.436-3.4-1.308-4.893z",fill:"#000"})))}t.default="img/element-icons/brands/github.bf60283.svg"},1508:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return u}));var n,i,r,s,o,c,l=a(90);function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function u(e){return l.createElement("svg",d({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),n||(n=l.createElement("path",{d:"M12 20.33l3.317-10.2H8.689l3.312 10.2z",fill:"#E24329"})),i||(i=l.createElement("path",{d:"M4.043 10.13l-1.01 3.098a.687.687 0 00.25.768L12 20.33l-7.957-10.2z",fill:"#FCA326"})),r||(r=l.createElement("path",{d:"M4.042 10.129h4.645L6.688 3.986c-.102-.315-.548-.315-.654 0l-1.992 6.143z",fill:"#E24329"})),s||(s=l.createElement("path",{d:"M19.96 10.13l1.006 3.098a.687.687 0 01-.248.768l-8.719 6.334 7.961-10.2z",fill:"#FCA326"})),o||(o=l.createElement("path",{d:"M19.962 10.129h-4.645l1.995-6.143c.102-.315.548-.315.654 0l1.996 6.143z",fill:"#E24329"})),c||(c=l.createElement("path",{d:"M12 20.33l3.315-10.2h4.645L12 20.33zM11.998 20.33l-7.956-10.2h4.645L12 20.33z",fill:"#FC6D26"})))}t.default="img/element-icons/brands/gitlab.d4ee177.svg"},1509:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return l}));var n,i,r,s,o=a(90);function c(){return(c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function l(e){return o.createElement("svg",c({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),n||(n=o.createElement("path",{d:"M22.501 12.233c0-.863-.071-1.493-.226-2.146h-10.06v3.896h5.905c-.119.969-.762 2.427-2.19 3.407l-.02.13 3.18 2.415.22.022c2.024-1.832 3.191-4.527 3.191-7.724z",fill:"#4285F4"})),i||(i=o.createElement("path",{d:"M12.215 22.5c2.893 0 5.321-.933 7.095-2.543l-3.381-2.567c-.905.618-2.12 1.05-3.714 1.05a6.438 6.438 0 01-6.096-4.363l-.125.01-3.307 2.509-.044.117c1.762 3.43 5.381 5.787 9.572 5.787z",fill:"#34A853"})),r||(r=o.createElement("path",{d:"M6.12 14.077A6.347 6.347 0 015.763 12c0-.723.131-1.423.345-2.077l-.006-.139-3.348-2.548-.11.05A10.339 10.339 0 001.501 12c0 1.692.417 3.29 1.143 4.713l3.476-2.636z",fill:"#FBBC05"})),s||(s=o.createElement("path",{d:"M12.215 5.56c2.012 0 3.369.852 4.143 1.563L19.38 4.23c-1.857-1.692-4.273-2.73-7.166-2.73-4.19 0-7.81 2.357-9.572 5.787l3.465 2.636a6.465 6.465 0 016.107-4.363z",fill:"#EB4335"})))}t.default="img/element-icons/brands/google.04f5e48.svg"},1510:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{d:"M9.042 21c-2.427 0-4.688-.706-6.592-1.923 1.616.104 4.469-.146 6.243-1.838-2.67-.123-3.873-2.17-4.03-3.045.227.088 1.308.193 1.919-.052-3.07-.77-3.541-3.464-3.436-4.286.575.402 1.552.542 1.936.507-2.86-2.047-1.832-5.126-1.326-5.79 2.053 2.843 5.13 4.44 8.936 4.53a4.398 4.398 0 01-.11-.98 4.367 4.367 0 014.361-4.373c1.259 0 2.393.535 3.189 1.39.84-.197 2.106-.659 2.725-1.058-.312 1.12-1.283 2.054-1.87 2.4.005.012-.005-.012 0 0 .516-.078 1.912-.346 2.463-.72-.273.629-1.302 1.675-2.147 2.26C21.46 14.953 16.157 21 9.042 21z",fill:"#1D9BF0"})))}t.default="img/element-icons/brands/twitter.892d1c7.svg"},1511:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(211),c=a(1),l=a(91),d=a(92),u=a(151),m=a(567),h=a(94),p=a(165),g=a(97),v=a(219),f=a(98),b=a(431),y=a(143);class E extends s.a.PureComponent{constructor(e){super(e),i()(this,"intervalHandle",void 0),i()(this,"checkRequestIsPending",()=>{const{request:e}=this.props;e.canAccept||p.a.sharedInstance().dismissToast(this.props.toastKey)}),i()(this,"cancel",()=>{p.a.sharedInstance().dismissToast(this.props.toastKey);try{this.props.request.cancel()}catch(e){c.a.error("Error while cancelling verification request",e)}}),i()(this,"accept",async()=>{p.a.sharedInstance().dismissToast(this.props.toastKey);const{request:e}=this.props,t=d.a.get();try{if(e.channel.roomId){h.a.dispatch({action:f.a.ViewRoom,room_id:e.channel.roomId,should_peek:!1,metricsTrigger:"VerificationRequest"});const a=t.getUser(e.otherUserId);y.a.instance.setCards([{phase:u.a.RoomSummary},{phase:u.a.RoomMemberInfo,state:{member:a}},{phase:u.a.EncryptionPanel,state:{verificationRequest:e,member:a}}],void 0,e.channel.roomId)}else g.a.createDialog(b.a,{verificationRequest:e,onFinished:()=>{e.cancel()}},null,!1,!0);await e.accept()}catch(e){c.a.error(e.message)}}),this.state={counter:Math.ceil(e.request.timeout/1e3)}}async componentDidMount(){const{request:e}=this.props;if(e.timeout&&e.timeout>0&&(this.intervalHandle=setInterval(()=>{let{counter:e}=this.state;e=Math.max(0,e-1),this.setState({counter:e})},1e3)),e.on(o.l.Change,this.checkRequestIsPending),this.checkRequestIsPending(),e.isSelfVerification){const t=d.a.get(),a=(await t.getDevice(e.channel.deviceId)).last_seen_ip;this.setState({device:t.getStoredDevice(t.getUserId(),e.channel.deviceId),ip:a})}}componentWillUnmount(){clearInterval(this.intervalHandle);const{request:e}=this.props;e.off(o.l.Change,this.checkRequestIsPending)}render(){const{request:e}=this.props;let t,a;if(e.isSelfVerification)this.state.device&&(t=this.state.device.getDisplayName(),a=Object(l.a)("%(deviceId)s from %(ip)s",{deviceId:this.state.device.deviceId,ip:this.state.ip}));else{const a=e.otherUserId,n=e.channel.roomId;if(t=n?Object(m.b)(a,n):a,t===a){const e=d.a.get().getUser(a);e&&e.displayName&&(t=Object(l.a)("%(name)s (%(userId)s)",{name:e.displayName,userId:a}))}}const n=0===this.state.counter?Object(l.a)("Decline"):Object(l.a)("Decline (%(counter)s)",{counter:this.state.counter});return s.a.createElement(v.a,{description:t,detail:a,acceptLabel:Object(l.a)("Accept"),onAccept:this.accept,rejectLabel:n,onReject:this.cancel})}}},1512:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(170),i=a(98),r=a(94);const s=e=>{r.a.dispatch({action:i.a.ViewUserSettings,initialTabId:e?n.a.SessionManager:n.a.Security})}},1523:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(119),c=a(96),l=a.n(c),d=a(209),u=a(122),m=a(193),h=a(388),p=a(232),g=a(832),v=a(94),f=a(95),b=a(106);var y=e=>{let{vertical:t,reverse:a,id:n,passRef:i}=e;const r=["mx_ResizeHandle"];return t?r.push("mx_ResizeHandle_vertical"):r.push("mx_ResizeHandle_horizontal"),a&&r.push("mx_ResizeHandle_reverse"),s.a.createElement("div",{ref:i,className:r.join(" "),"data-id":n},s.a.createElement("div",null))};class E{constructor(e,t,a,n){this.resizer=t,this.sizer=a,this.container=n,i()(this,"domNode",void 0),i()(this,"id",void 0),i()(this,"reverse",void 0),this.reverse=t.isReverseResizeHandle(e),this.domNode=n||(this.reverse?e.nextElementSibling:e.previousElementSibling),this.id=e.getAttribute("data-id")}copyWith(e,t,a,n){return new(0,this.constructor)(e,t,a,n)}advance(e){let t=this.reverse?this.domNode.previousElementSibling:this.domNode.nextElementSibling;const a=e!==this.reverse;do{t=a?t.nextElementSibling:t.previousElementSibling}while(t&&!this.resizer.isResizeHandle(t));if(t){const e=this.copyWith(t,this.resizer,this.sizer);return e.reverse=this.reverse,e}}next(){return this.advance(!0)}previous(){return this.advance(!1)}size(){return this.sizer.getItemSize(this.domNode)}offset(){return this.sizer.getItemOffset(this.domNode)}start(){this.sizer.start(this.domNode)}finish(){this.sizer.finish(this.domNode)}getSize(){return this.sizer.getDesiredItemSize(this.domNode)}setRawSize(e){this.sizer.setItemSize(this.domNode,e)}setSize(e){this.setRawSize(Math.round(e)+"px");const t=this.resizer.config.onResized;t&&t(e,this.id,this.domNode)}clearSize(){this.sizer.clearItemSize(this.domNode);const e=this.resizer.config.onResized;e&&e(null,this.id,this.domNode)}first(){const e=Array.from(this.domNode.parentElement.children).find(e=>this.resizer.isResizeHandle(e));if(e)return this.copyWith(e,this.resizer,this.sizer)}last(){const e=Array.from(this.domNode.parentElement.children).reverse().find(e=>this.resizer.isResizeHandle(e));if(e)return this.copyWith(e,this.resizer,this.sizer)}}class _{constructor(e,t,a){this.container=e,this.vertical=t,this.reverse=a}getItemOffset(e){const t=(this.vertical?e.offsetTop:e.offsetLeft)-this.getOffset();return this.reverse?this.getTotalSize()-(t+this.getItemSize(e)):t}getItemSize(e){return this.vertical?e.offsetHeight:e.offsetWidth}getTotalSize(){return this.vertical?this.container.offsetHeight:this.container.offsetWidth}getOffset(){return this.vertical?this.container.offsetTop:this.container.offsetLeft}getPageOffset(){let e=this.container,t=0;for(;e;){t+=this.vertical?e.offsetTop:e.offsetLeft,e=e.offsetParent}return t}getDesiredItemSize(e){return this.vertical?e.style.height:e.style.width}setItemSize(e,t){this.vertical?e.style.height=t:e.style.width=t}clearItemSize(e){this.vertical?e.style.height=null:e.style.width=null}start(e){}finish(e){}offsetFromEvent(e){const t=this.vertical?e.pageY:e.pageX;return this.reverse?this.getPageOffset()+this.getTotalSize()-t:t-this.getPageOffset()}}class w{static createItem(e,t,a){return new E(e,t,a)}static createSizer(e,t,a){return new _(e,t,a)}constructor(e){this.item=e,i()(this,"beforeOffset",void 0),this.beforeOffset=e.offset()}get size(){return this.item.getSize()}set size(e){this.item.setRawSize(e)}resize(e){this.item.setSize(e)}resizeFromContainerOffset(e){this.resize(e-this.beforeOffset)}start(){this.item.start()}finish(){this.item.finish()}}class S extends _{start(e){this.vertical?e.style.minHeight=null:e.style.minWidth=null}finish(e){const t=e.offsetParent;if(t)if(this.vertical){const a=(e.offsetHeight/t.offsetHeight*100).toFixed(2)+"%";e.style.minHeight=a,e.style.height=a}else{const a=(e.offsetWidth/t.offsetWidth*100).toFixed(2)+"%";e.style.minWidth=a,e.style.width=a}}}class O extends w{static createSizer(e,t,a){return new S(e,t,a)}}class C extends E{notifyCollapsed(e){const t=this.resizer.config.onCollapsed;t&&t(e,this.id,this.domNode)}get isCollapsed(){return(0,this.resizer.config.isItemCollapsed)(this.domNode)}}class x extends w{static createItem(e,t,a,n){return new C(e,t,a,n)}constructor(e){var t,a;super(e),i()(this,"toggleSize",void 0),i()(this,"isCollapsed",void 0),this.toggleSize=null===(t=e.resizer)||void 0===t||null===(a=t.config)||void 0===a?void 0:a.toggleSize,this.isCollapsed=e.isCollapsed}resize(e){const t=e<this.toggleSize;t!==this.isCollapsed&&(this.isCollapsed=t,this.item.notifyCollapsed(t)),t||super.resize(e)}}var k=a(116);class j{constructor(e,t,a){this.container=e,this.distributorCtor=t,this.config=a,i()(this,"classNames",void 0),i()(this,"onMouseDown",e=>{var t;const a=e.target&&e.target.closest("."+this.classNames.handle),n=null==this||null===(t=this.config)||void 0===t?void 0:t.handler;if(!a||!n&&a.parentElement!==this.container||n&&a!==n)return;var i,r;(e.preventDefault(),this.classNames.resizing)&&(null===(i=this.container)||void 0===i||null===(r=i.classList)||void 0===r||r.add(this.classNames.resizing));this.config.onResizeStart&&this.config.onResizeStart();const{sizer:s,distributor:o}=this.createSizerAndDistributor(a);o.start();const c=e=>{const t=s.offsetFromEvent(e);o.resizeFromContainerOffset(t)},l=document.body,d=()=>{var e,t;this.classNames.resizing&&(null===(e=this.container)||void 0===e||null===(t=e.classList)||void 0===t||t.remove(this.classNames.resizing));o.finish(),this.config.onResizeStop&&this.config.onResizeStop(),l.removeEventListener("mouseup",d,!1),document.removeEventListener("mouseleave",d,!1),l.removeEventListener("mousemove",c,!1)};l.addEventListener("mouseup",d,!1),document.addEventListener("mouseleave",d,!1),l.addEventListener("mousemove",c,!1)}),i()(this,"onResize",Object(k.throttle)(()=>{const e=this.getDistributors();e.forEach(e=>e.start()),e.forEach(e=>e.finish())},100,{trailing:!0,leading:!0})),i()(this,"getDistributors",()=>this.getResizeHandles().map(e=>{const{distributor:t}=this.createSizerAndDistributor(e);return t})),this.classNames={handle:"resizer-handle",reverse:"resizer-reverse",vertical:"resizer-vertical",resizing:"resizer-resizing"}}setClassNames(e){this.classNames=e}attach(){var e,t,a;(null!==(e=null==this||null===(t=this.config)||void 0===t||null===(a=t.handler)||void 0===a?void 0:a.parentElement)&&void 0!==e?e:this.container).addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("resize",this.onResize)}detach(){var e,t,a;(null!==(e=null==this||null===(t=this.config)||void 0===t||null===(a=t.handler)||void 0===a?void 0:a.parentElement)&&void 0!==e?e:this.container).removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("resize",this.onResize)}forHandleAt(e){const t=this.getResizeHandles()[e];if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}forHandleWithId(e){const t=this.getResizeHandles().find(t=>t.getAttribute("data-id")===e);if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}isReverseResizeHandle(e){return e&&e.classList.contains(this.classNames.reverse)}isResizeHandle(e){return e&&e.classList.contains(this.classNames.handle)}createSizerAndDistributor(e){const t=e.classList.contains(this.classNames.vertical),a=this.isReverseResizeHandle(e),n=this.distributorCtor,i=this.config&&this.config.handler?this.container:void 0,r=n.createSizer(this.container,t,a),s=n.createItem(e,this,r,i);return{sizer:r,distributor:new n(s)}}getResizeHandles(){var e,t;return null!=this&&null!==(e=this.config)&&void 0!==e&&e.handler?[this.config.handler]:null!==(t=this.container)&&void 0!==t&&t.children?Array.from(this.container.querySelectorAll("."+this.classNames.handle)):[]}}var R=a(102),I=a(124),T=a(156),N=a(91),D=a(219),P=a(165),M=a(346);const A=()=>{P.a.sharedInstance().dismissToast("serverlimit")};var L=a(98),U=a(892),F=a(154),B=a(742),V=a(110),z=a(97),W=a(1430),H=a(93);class G extends r.PureComponent{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",e=>{"focus_room_filter"===e.action&&this.openSpotlight()}),this.dispatcherRef=v.a.register(this.onAction)}componentWillUnmount(){v.a.unregister(this.dispatcherRef)}openSpotlight(){z.a.createDialog(W.a,{},"mx_SpotlightDialog_wrapper",!1,!0)}render(){const e=l()({mx_RoomSearch:!0,mx_RoomSearch_minimized:this.props.isMinimized},"mx_RoomSearch_spotlightTrigger"),t=r.createElement("div",{className:"mx_RoomSearch_icon"}),a=r.createElement("kbd",{className:"mx_RoomSearch_shortcutPrompt"},m.a?"⌘ K":Object(N.a)(V.a[m.b.CONTROL])+" K");return r.createElement(H.a,{onClick:this.openSpotlight,className:e},t,!this.props.isMinimized&&r.createElement("div",{className:"mx_RoomSearch_spotlightTriggerText"},Object(N.a)("Search")),a)}}var q=a(118),K=a(149),Y=a(177),J=a(121),$=a(163),Q=a(101),X=a.n(Q),Z=a(99),ee=a(114),te=a(189),ae=a(205),ne=a(111),ie=a(142),re=a(127),se=a(126),oe=a(221),ce=a(117),le=a(231),de=a(148),ue=a(585),me=a(176),he=a(237),pe=a(103),ge=a.n(pe),ve=a(1442),fe=a(532),be=a(132);const ye=(e,t)=>{let a="";if(t)for(const e of t.entries())a+=e+"/";return"mx_space_collapsed_"+(a+e)};class Ee{static get instance(){return Ee.internalInstance||(Ee.internalInstance=new Ee),Ee.internalInstance}setSpaceCollapsedState(e,t,a){localStorage.setItem(ye(e,t),a.toString())}getSpaceCollapsedState(e,t,a){const n=localStorage.getItem(ye(e,t));return n?"true"===n:a}}i()(Ee,"internalInstance",void 0);var _e=a(217),we=a(298),Se=a(303),Oe=a(164),Ce=a(139);const xe=["space","spaceKey","className","selected","label","contextMenuTooltip","notificationState","avatarSize","isNarrow","children","ContextMenuComponent"],ke=["space","activeSpaces","isNested","isPanelCollapsed","onExpand","parents","innerRef","dragHandleProps"],je=["tabIndex"],Re=Object(r.forwardRef)((e,t)=>{var a;let{space:n,spaceKey:i,className:r,selected:o,label:c,contextMenuTooltip:d,notificationState:u,avatarSize:m,isNarrow:h,children:p,ContextMenuComponent:g}=e,f=ge()(e,xe);const[b,y,E,_]=Object(ce.p)(t),[w,S]=Object(Ce.i)(y),O=S?0:-1;let C,x,k=s.a.createElement("div",{className:"mx_SpaceButton_avatarPlaceholder"},s.a.createElement("div",{className:"mx_SpaceButton_icon"}));if(n&&(k=s.a.createElement(be.a,{width:m,height:m,room:n})),u){let e=Object(N.a)("Jump to first unread room.");"invite"===(null==n?void 0:n.getMyMembership())&&(e=Object(N.a)("Jump to first invite."));const t=e=>{e.stopPropagation(),e.preventDefault(),K.a.instance.setActiveRoomInSpace(null!=i?i:n.roomId)};C=s.a.createElement("div",{className:"mx_SpacePanel_badgeContainer"},s.a.createElement(_e.a,{onClick:t,forceCount:!1,notification:u,"aria-label":e,tabIndex:O,showUnsentTooltip:!0}))}var j;b&&g&&(x=s.a.createElement(g,X()({},Object(ce.o)(null===(j=y.current)||void 0===j?void 0:j.getBoundingClientRect(),0),{space:n,onFinished:_})));const R=null!==(a=f.onClick)&&void 0!==a?a:o&&n?()=>v.a.dispatch({action:L.a.ViewRoom,room_id:n.roomId}):()=>K.a.instance.setActiveSpace(null!=i?i:n.roomId);return s.a.createElement(q.a,X()({},f,{className:l()("mx_SpaceButton",r,{mx_SpaceButton_active:o,mx_SpaceButton_hasMenuOpen:b,mx_SpaceButton_narrow:h}),title:c,onClick:R,onContextMenu:E,forceHide:!h||b,inputRef:y,tabIndex:O,onFocus:w}),p,s.a.createElement("div",{className:"mx_SpaceButton_selectionWrapper"},s.a.createElement("div",{className:"mx_SpaceButton_avatarWrapper"},k,C),!h&&s.a.createElement("span",{className:"mx_SpaceButton_name"},c),g&&s.a.createElement(we.a,{className:"mx_SpaceButton_menuButton",onClick:E,title:d,isExpanded:b}),x))});class Ie extends s.a.PureComponent{constructor(e){super(e),i()(this,"buttonRef",Object(r.createRef)()),i()(this,"onSpaceUpdate",()=>{this.setState({childSpaces:this.childSpaces})}),i()(this,"onRoomNameChange",()=>{this.setState({name:this.props.space.name})}),i()(this,"toggleCollapse",e=>{this.props.onExpand&&this.isCollapsed&&this.props.onExpand();const t=!this.isCollapsed;Ee.instance.setSpaceCollapsedState(this.props.space.roomId,this.props.parents,t),this.setState({collapsed:t}),e.stopPropagation()}),i()(this,"onKeyDown",e=>{var t;let a=!0;const n=Object(J.a)().getRoomListAction(e),i=null===(t=this.state.childSpaces)||void 0===t?void 0:t.length;switch(n){case V.h.CollapseRoomListSection:if(i&&!this.isCollapsed)this.toggleCollapse(e);else{var r,s,o;const e=null===(r=this.buttonRef)||void 0===r||null===(s=r.current)||void 0===s||null===(o=s.parentElement)||void 0===o?void 0:o.parentElement,t=null==e?void 0:e.previousElementSibling;null==t||t.focus()}break;case V.h.ExpandRoomListSection:if(i)if(this.isCollapsed)this.toggleCollapse(e);else{var c,l,d;const e=null===(c=this.buttonRef)||void 0===c||null===(l=c.current)||void 0===l?void 0:l.nextElementSibling,t=null==e?void 0:e.querySelector(".mx_SpaceItem");null==t||null===(d=t.querySelector(".mx_SpaceButton"))||void 0===d||d.focus()}break;default:a=!1}a&&(e.stopPropagation(),e.preventDefault())});const t=Ee.instance.getSpaceCollapsedState(e.space.roomId,this.props.parents,!e.isNested);this.state={name:this.props.space.name,collapsed:t,childSpaces:this.childSpaces},K.a.instance.on(this.props.space.roomId,this.onSpaceUpdate),this.props.space.on(ee.d.Name,this.onRoomNameChange)}componentWillUnmount(){K.a.instance.off(this.props.space.roomId,this.onSpaceUpdate),this.props.space.off(ee.d.Name,this.onRoomNameChange)}get childSpaces(){return K.a.instance.getChildSpaces(this.props.space.roomId).filter(e=>{var t;return!(null!==(t=this.props.parents)&&void 0!==t&&t.has(e.roomId))})}get isCollapsed(){return this.state.collapsed||this.props.isPanelCollapsed}render(){var e,t;const a=this.props,{space:n,activeSpaces:i,isNested:r,isPanelCollapsed:o,onExpand:c,parents:d,innerRef:u,dragHandleProps:m}=a,h=ge()(a,ke),p=this.isCollapsed,g=l()(this.props.className,{mx_SpaceItem:!0,mx_SpaceItem_narrow:o,collapsed:p,hasSubSpaces:null===(e=this.state.childSpaces)||void 0===e?void 0:e.length}),v="invite"===n.getMyMembership(),f=v?Se.a.forSymbol("!",Oe.a.Red):K.a.instance.getNotificationState(n.roomId),b=null===(t=this.state.childSpaces)||void 0===t?void 0:t.length;let y;b&&!p&&(y=s.a.createElement(Te,{spaces:this.state.childSpaces,activeSpaces:i,isNested:!0,parents:new Set(d).add(n.roomId)}));const E=b?s.a.createElement(H.a,{className:"mx_SpaceButton_toggleCollapse",onClick:this.toggleCollapse,tabIndex:-1,"aria-label":p?Object(N.a)("Expand"):Object(N.a)("Collapse")}):null,_=m||{},{tabIndex:w}=_,S=ge()(_,je),O=i.includes(n.roomId);return s.a.createElement("li",X()({},h,{className:g,ref:u,"aria-expanded":b?!p:void 0,"aria-selected":O,role:"treeitem"}),s.a.createElement(Re,X()({},S,{space:n,className:v?"mx_SpaceButton_invite":void 0,selected:O,label:this.state.name,contextMenuTooltip:Object(N.a)("Space options"),notificationState:f,isNarrow:o,avatarSize:r?24:32,onKeyDown:this.onKeyDown,ContextMenuComponent:"join"===this.props.space.getMyMembership()?ue.a:void 0}),E),y)}}i()(Ie,"contextType",R.a);const Te=e=>{let{spaces:t,activeSpaces:a,isNested:n,parents:i}=e;return s.a.createElement("ul",{className:"mx_SpaceTreeLevel",role:"group"},t.map(e=>s.a.createElement(Ie,{key:e.roomId,activeSpaces:a,space:e,isNested:n,parents:i})))};var Ne=a(184),De=a(147),Pe=a(850),Me=a(170),Ae=a(280),Le=a(248),Ue=a(851);var Fe,Be,Ve=e=>{let{requestClose:t}=e;const a=Object(r.useMemo)(Ae.f,[]),n=Ue.a.calculateThemeState(),i=Object(Ae.d)(n.theme),o=i||n.theme,{useSystemTheme:c}=n,l=[{id:"MATCH_SYSTEM_THEME_ID",name:Object(N.a)("Match system")},...a],d=c?"MATCH_SYSTEM_THEME_ID":o;return s.a.createElement("div",{className:"mx_QuickThemeSwitcher"},s.a.createElement("h4",{className:"mx_QuickThemeSwitcher_heading"},Object(N.a)("Theme")),s.a.createElement(Le.a,{id:"mx_QuickSettingsButton_themePickerDropdown",onOptionChange:async e=>{re.b.trackInteraction("WebQuickSettingsThemeDropdown");try{"MATCH_SYSTEM_THEME_ID"===e?await f.b.setValue("use_system_theme",null,b.a.DEVICE,!0):(v.a.dispatch({action:L.a.RecheckTheme,forceTheme:e}),await Promise.all([f.b.setValue("theme",null,b.a.DEVICE,e),f.b.setValue("use_system_theme",null,b.a.DEVICE,!1)]))}catch(e){v.a.dispatch({action:L.a.RecheckTheme})}t()},value:d,label:Object(N.a)("Space selection")},l.map(e=>s.a.createElement("div",{key:e.id},e.name))))};function ze(){return(ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function We(e){return r.createElement("svg",ze({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),Fe||(Fe=r.createElement("path",{d:"M11 18.598V15h2v3.598C13 20.5 12.238 22 12 22s-1-1.5-1-3.402zM9.5 6c-.325-.167-1.714-.8-2.883-2s-.495-2 .513-2H12v4H9.5zM14.5 6c.325-.167 1.714-.8 2.883-2s.495-2-.513-2H12v4h2.5zM9.429 6h5.142L15 10H9l.429-4z",fill:"#000"})),Be||(Be=r.createElement("path",{d:"M12 9c-3.069 0-5.676 1.693-6.621 4.048C4.967 14.073 5.895 15 7 15h10c1.105 0 2.032-.927 1.621-1.952C17.677 10.693 15.07 9 12 9z",fill:"#000"})))}var He,Ge,qe;function Ke(){return(Ke=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ye(e){return r.createElement("svg",Ke({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),He||(He=r.createElement("circle",{cx:15.5,cy:10,r:1.5,transform:"rotate(180 15.5 10)",fill:"#15191E"})),Ge||(Ge=r.createElement("circle",{cx:10,cy:10,r:1.5,transform:"rotate(180 10 10)",fill:"#15191E"})),qe||(qe=r.createElement("circle",{cx:4.5,cy:10,r:1.5,transform:"rotate(180 4.5 10)",fill:"#15191E"})))}var Je,$e,Qe;function Xe(){return(Xe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ze(e){return r.createElement("svg",Xe({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),Je||(Je=r.createElement("mask",{id:"members_svg__a",fill:"#fff"},r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.591 20.292A9.954 9.954 0 0112 22a9.956 9.956 0 01-6-2 9.985 9.985 0 01-4-8C2 6.477 6.477 2 12 2s10 4.477 10 10a9.99 9.99 0 01-4.409 8.292zM12 12.5c1.657 0 3-1.455 3-3.25S13.657 6 12 6 9 7.455 9 9.25s1.343 3.25 3 3.25zm0 7.5a7.974 7.974 0 005.563-2.251 6.002 6.002 0 00-11.126 0A7.973 7.973 0 0012 20z"}))),$e||($e=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.591 20.292A9.954 9.954 0 0112 22a9.956 9.956 0 01-6-2 9.985 9.985 0 01-4-8C2 6.477 6.477 2 12 2s10 4.477 10 10a9.99 9.99 0 01-4.409 8.292zM12 12.5c1.657 0 3-1.455 3-3.25S13.657 6 12 6 9 7.455 9 9.25s1.343 3.25 3 3.25zm0 7.5a7.974 7.974 0 005.563-2.251 6.002 6.002 0 00-11.126 0A7.973 7.973 0 0012 20z",fill:"#000"})),Qe||(Qe=r.createElement("path",{d:"M17.591 20.292l-1.12-1.657 1.12 1.657zM6 20.001L4.799 21.6 6 20zm11.563-2.252l1.391 1.437.97-.938-.507-1.25-1.854.75zm-11.126 0l-1.854-.751-.506 1.25.969.938 1.39-1.437zM12 24c2.482 0 4.794-.756 6.71-2.05l-2.239-3.315A7.954 7.954 0 0112 20v4zm-7.201-2.4A11.956 11.956 0 0012 24v-4a7.955 7.955 0 01-4.799-1.598L4.8 21.6zM0 12c0 3.927 1.889 7.414 4.799 9.6L7.2 18.402A7.985 7.985 0 014 12H0zM12 0C5.373 0 0 5.373 0 12h4a8 8 0 018-8V0zm12 12c0-6.627-5.373-12-12-12v4a8 8 0 018 8h4zm-5.29 9.95A11.99 11.99 0 0024 12h-4a7.99 7.99 0 01-3.529 6.635l2.24 3.314zM13 9.25c0 .844-.595 1.25-1 1.25v4c2.91 0 5-2.504 5-5.25h-4zM12 8c.405 0 1 .406 1 1.25h4C17 6.504 14.91 4 12 4v4zm-1 1.25c0-.844.595-1.25 1-1.25V4C9.09 4 7 6.504 7 9.25h4zm1 1.25c-.405 0-1-.406-1-1.25H7c0 2.746 2.09 5.25 5 5.25v-4zm4.172 5.812A5.974 5.974 0 0112 18v4a9.973 9.973 0 006.954-2.814l-2.782-2.874zM12 16a4.002 4.002 0 013.71 2.5l3.707-1.502A8.002 8.002 0 0012 12v4zm-3.71 2.5A4.002 4.002 0 0112 16v-4a8.002 8.002 0 00-7.417 4.998L8.29 18.5zM12 18a5.974 5.974 0 01-4.172-1.688l-2.782 2.874A9.973 9.973 0 0012 22v-4z",fill:"#000",mask:"url(#members_svg__a)"})))}var et;function tt(){return(tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function at(e){return r.createElement("svg",tt({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),et||(et=r.createElement("path",{d:"M8.414 1.432c.178-.576.994-.576 1.172 0l1.585 5.131h5.215c.586 0 .838.745.372 1.1l-4.244 3.243 1.604 5.194c.177.57-.483 1.03-.958.668L9 13.59l-4.16 3.178c-.475.363-1.135-.098-.959-.668l1.606-5.194-4.245-3.242c-.466-.356-.214-1.1.372-1.1H6.83l1.585-5.132z",fill:"#000"})))}var nt=a(598),it=a(130);var rt=e=>{let{isPanelCollapsed:t=!1}=e;const[a,n,i,r]=Object(ce.p)(),{[Y.a.Favourites]:o,[Y.a.People]:c}=Object(ie.b)("Spaces.enabledMetaSpaces");let d;return a&&(d=s.a.createElement(ce.n,X()({},Object(ce.l)(n.current.getBoundingClientRect(),ce.a.None,16),{wrapperClassName:"mx_QuickSettingsButton_ContextMenuWrapper",onFinished:r,managed:!1,focusLock:!0}),s.a.createElement("h2",null,Object(N.a)("Quick settings")),s.a.createElement(H.a,{onClick:()=>{r(),v.a.dispatch({action:L.a.ViewUserSettings})},kind:"primary_outline"},Object(N.a)("All settings")),f.b.getValue("developerMode")&&s.a.createElement(H.a,{onClick:()=>{r(),z.a.createDialog(nt.a,{roomId:it.b.instance.roomViewStore.getRoomId()},"mx_DevtoolsDialog_wrapper")},kind:"danger_outline"},Object(N.a)("Developer tools")),s.a.createElement("h4",{className:"mx_QuickSettingsButton_pinToSidebarHeading"},s.a.createElement(We,{className:"mx_QuickSettingsButton_icon"}),Object(N.a)("Pin to sidebar")),s.a.createElement(De.b,{className:"mx_QuickSettingsButton_favouritesCheckbox",checked:!!o,onChange:Object(Pe.b)(Y.a.Favourites,"WebQuickSettingsPinToSidebarCheckbox")},s.a.createElement(at,{className:"mx_QuickSettingsButton_icon"}),Object(N.a)("Favourites")),s.a.createElement(De.b,{className:"mx_QuickSettingsButton_peopleCheckbox",checked:!!c,onChange:Object(Pe.b)(Y.a.People,"WebQuickSettingsPinToSidebarCheckbox")},s.a.createElement(Ze,{className:"mx_QuickSettingsButton_icon"}),Object(N.a)("People")),s.a.createElement(H.a,{className:"mx_QuickSettingsButton_moreOptionsButton",onClick:()=>{r(),v.a.dispatch({action:L.a.ViewUserSettings,initialTabId:Me.a.Sidebar})}},s.a.createElement(Ye,{className:"mx_QuickSettingsButton_icon"}),Object(N.a)("More options")),s.a.createElement(Ve,{requestClose:r}))),s.a.createElement(s.a.Fragment,null,s.a.createElement(q.a,{className:l()("mx_QuickSettingsButton",{expanded:!t}),onClick:i,title:Object(N.a)("Quick settings"),inputRef:n,forceHide:!t},t?null:Object(N.a)("Settings")),d)},st=a(92),ot=a(584),ct=a(586),lt=a(100),dt=a(433),ut=a(220),mt=a(120),ht=a(153);class pt extends mt.a{constructor(){super(v.a,{hostSignupActive:!1})}static get instance(){return pt.internalInstance}get isHostSignupActive(){return this.state.hostSignupActive}async setHostSignupActive(e){return this.updateState({hostSignupActive:e})}onDispatch(e){}}i()(pt,"internalInstance",new pt);class gt extends s.a.PureComponent{constructor(){super(...arguments),i()(this,"openDialog",async()=>{var e,t;null===(e=(t=this.props).onClick)||void 0===e||e.call(t),await pt.instance.setHostSignupActive(!0)})}render(){const e=lt.b.getObject("host_signup");return null!=e&&e.get("brand")?s.a.createElement(de.c,null,s.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconHosting",label:Object(N.a)("Upgrade to %(hostSignupBrand)s",{hostSignupBrand:e.get("brand")}),onClick:this.openDialog})):null}}var vt=a(230);class ft extends s.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"themeWatcherRef",void 0),i()(this,"dndWatcherRef",void 0),i()(this,"buttonRef",Object(r.createRef)()),i()(this,"onProfileUpdate",async()=>{this.forceUpdate()}),i()(this,"onSelectedSpaceUpdate",async()=>{this.setState({selectedSpace:K.a.instance.activeSpaceRoom})}),i()(this,"onThemeChanged",()=>{this.setState({isDarkTheme:this.isUserOnDarkTheme(),isHighContrast:this.isUserOnHighContrastTheme()})}),i()(this,"onAction",e=>{switch(e.action){case L.a.ToggleUserMenu:this.state.contextMenuPosition?this.setState({contextMenuPosition:null}):this.buttonRef.current&&this.buttonRef.current.click()}}),i()(this,"onOpenMenuClick",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:e.currentTarget.getBoundingClientRect()})}),i()(this,"onContextMenu",e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,width:20,height:0}})}),i()(this,"onCloseMenu",()=>{this.setState({contextMenuPosition:null})}),i()(this,"onSwitchThemeClick",e=>{e.preventDefault(),e.stopPropagation(),re.b.trackInteraction("WebUserMenuThemeToggleButton",e),f.b.setValue("use_system_theme",null,b.a.DEVICE,!1);let t=this.state.isDarkTheme?"light":"dark";if(this.state.isHighContrast){const e=Object(Ae.c)(t);e&&(t=e)}f.b.setValue("theme",null,b.a.DEVICE,t)}),i()(this,"onSettingsOpen",(e,t)=>{e.preventDefault(),e.stopPropagation();const a={action:L.a.ViewUserSettings,initialTabId:t};v.a.dispatch(a),this.setState({contextMenuPosition:null})}),i()(this,"onProvideFeedback",e=>{e.preventDefault(),e.stopPropagation(),z.a.createDialog(ot.a),this.setState({contextMenuPosition:null})}),i()(this,"onSignOutClick",async e=>{var t;e.preventDefault(),e.stopPropagation();const a=st.a.get();a&&a.isCryptoEnabled()&&null!==(t=await a.exportRoomKeys())&&void 0!==t&&t.length?z.a.createDialog(ct.a):v.a.dispatch({action:"logout"}),this.setState({contextMenuPosition:null})}),i()(this,"onSignInClick",()=>{v.a.dispatch({action:"start_login"}),this.setState({contextMenuPosition:null})}),i()(this,"onRegisterClick",()=>{v.a.dispatch({action:"start_registration"}),this.setState({contextMenuPosition:null})}),i()(this,"onHomeClick",e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:L.a.ViewHomePage}),this.setState({contextMenuPosition:null})}),i()(this,"renderContextMenu",()=>{if(!this.state.contextMenuPosition)return null;let e;const t=lt.b.getObject("host_signup");if(st.a.get().isGuest())e=s.a.createElement("div",{className:"mx_UserMenu_contextMenu_header mx_UserMenu_contextMenu_guestPrompts"},Object(N.a)("Got an account? <a>Sign in</a>",{},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:this.onSignInClick},e)}),Object(N.a)("New here? <a>Create an account</a>",{},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:this.onRegisterClick},e)}));else if(null!=t&&t.get("url")){const a=t.get("domains")||[],n=st.a.get().getDomain(),i=a.filter(e=>e===n||n.endsWith("."+e));(!t.get("domains")||i.length>0)&&(e=s.a.createElement(gt,{onClick:this.onCloseMenu}))}let n,i=null;this.hasHomePage&&(i=s.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconHome",label:Object(N.a)("Home"),onClick:this.onHomeClick})),f.b.getValue(se.b.Feedback)&&(n=s.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconMessage",label:Object(N.a)("Feedback"),onClick:this.onProvideFeedback}));let r=s.a.createElement(de.c,null,i,s.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconBell",label:Object(N.a)("Notifications"),onClick:e=>this.onSettingsOpen(e,Me.a.Notifications)}),s.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconLock",label:Object(N.a)("Security & Privacy"),onClick:e=>this.onSettingsOpen(e,Me.a.Security)}),s.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(N.a)("All settings"),onClick:e=>this.onSettingsOpen(e,null)}),n,s.a.createElement(de.b,{className:"mx_IconizedContextMenu_option_red",iconClassName:"mx_UserMenu_iconSignOut",label:Object(N.a)("Sign out"),onClick:this.onSignOutClick}));st.a.get().isGuest()&&(r=s.a.createElement(de.c,null,i,s.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(N.a)("Settings"),onClick:e=>this.onSettingsOpen(e,null)}),n));const o=this.props.isPanelCollapsed?{left:(c=this.state.contextMenuPosition).width+c.left+8,top:c.top,chevronFace:ce.a.None}:(e=>({left:e.left,top:e.top+e.height,chevronFace:ce.a.None}))(this.state.contextMenuPosition);var c;return s.a.createElement(de.e,X()({},o,{onFinished:this.onCloseMenu,className:"mx_UserMenu_contextMenu"}),s.a.createElement("div",{className:"mx_UserMenu_contextMenu_header"},s.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},s.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},ut.a.instance.displayName),s.a.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},vt.a.getDisplayUserIdentifier(st.a.get().getUserId(),{withDisplayName:!0}))),s.a.createElement(Ce.b,{className:"mx_UserMenu_contextMenu_themeButton",onClick:this.onSwitchThemeClick,title:this.state.isDarkTheme?Object(N.a)("Switch to light mode"):Object(N.a)("Switch to dark mode")},s.a.createElement("img",{src:a(1441).default,alt:Object(N.a)("Switch theme"),width:16}))),e,r)}),this.state={contextMenuPosition:null,isDarkTheme:this.isUserOnDarkTheme(),isHighContrast:this.isUserOnHighContrastTheme(),selectedSpace:K.a.instance.activeSpaceRoom},ut.a.instance.on(mt.b,this.onProfileUpdate),K.a.instance.on(Y.d,this.onSelectedSpaceUpdate)}get hasHomePage(){return!!Object(dt.a)(lt.b.get())}componentDidMount(){this.dispatcherRef=v.a.register(this.onAction),this.themeWatcherRef=f.b.watchSetting("theme",null,this.onThemeChanged)}componentWillUnmount(){this.themeWatcherRef&&f.b.unwatchSetting(this.themeWatcherRef),this.dndWatcherRef&&f.b.unwatchSetting(this.dndWatcherRef),this.dispatcherRef&&v.a.unregister(this.dispatcherRef),ut.a.instance.off(mt.b,this.onProfileUpdate),K.a.instance.off(Y.d,this.onSelectedSpaceUpdate)}isUserOnDarkTheme(){if(f.b.getValue("use_system_theme"))return window.matchMedia("(prefers-color-scheme: dark)").matches;{const e=f.b.getValue("theme");return e.startsWith("custom-")?Object(Ae.e)(e.substring("custom-".length)).is_dark:"dark"===e}}isUserOnHighContrastTheme(){if(f.b.getValue("use_system_theme"))return window.matchMedia("(prefers-contrast: more)").matches;{const e=f.b.getValue("theme");return!e.startsWith("custom-")&&Object(Ae.g)(e)}}render(){const e=st.a.get().getUserId(),t=ut.a.instance.displayName||e,a=ut.a.instance.getHttpAvatarUrl(32);let n;return this.props.isPanelCollapsed||(n=s.a.createElement("div",{className:"mx_UserMenu_name"},t)),s.a.createElement("div",{className:"mx_UserMenu"},s.a.createElement(ce.b,{onClick:this.onOpenMenuClick,inputRef:this.buttonRef,label:Object(N.a)("User menu"),isExpanded:!!this.state.contextMenuPosition,onContextMenu:this.onContextMenu},s.a.createElement("div",{className:"mx_UserMenu_userAvatar"},s.a.createElement(ht.a,{idName:e,name:t,url:a,width:32,height:32,resizeMethod:"crop",className:"mx_UserMenu_userAvatar_BaseAvatar"})),n,this.renderContextMenu()),this.props.children)}}var bt=a(181);const yt=["children","trackHorizontalOverflow","verticalScrollsHorizontally"];class Et extends s.a.Component{constructor(e){super(e),i()(this,"autoHideScrollbar",Object(r.createRef)()),i()(this,"scrollElement",void 0),i()(this,"likelyTrackpadUser",null),i()(this,"checkAgainForTrackpad",0),i()(this,"collectScroller",e=>{var t,a;null===(t=(a=this.props).wrappedRef)||void 0===t||t.call(a,e),e&&!this.scrollElement&&(this.scrollElement=e,this.scrollElement.addEventListener("scroll",this.checkOverflow,{passive:!0}),this.checkOverflow())}),i()(this,"checkOverflow",()=>{const e=this.scrollElement.scrollTop>0,t=this.scrollElement.scrollHeight>this.scrollElement.scrollTop+this.scrollElement.clientHeight,a=this.scrollElement.scrollLeft>0,n=this.scrollElement.scrollWidth>this.scrollElement.scrollLeft+this.scrollElement.clientWidth;e?this.scrollElement.classList.add("mx_IndicatorScrollbar_topOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_topOverflow"),t?this.scrollElement.classList.add("mx_IndicatorScrollbar_bottomOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_bottomOverflow"),a?this.scrollElement.classList.add("mx_IndicatorScrollbar_leftOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_leftOverflow"),n?this.scrollElement.classList.add("mx_IndicatorScrollbar_rightOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_rightOverflow"),this.props.trackHorizontalOverflow&&this.setState({leftIndicatorOffset:a?this.scrollElement.scrollLeft+"px":"0",rightIndicatorOffset:n?`-${this.scrollElement.scrollLeft}px`:"0"})}),i()(this,"onMouseWheel",e=>{if(this.props.verticalScrollsHorizontally&&this.scrollElement){const t=0,a=1,n=(new Date).getTime();if(Math.abs(e.deltaX)>0?(this.likelyTrackpadUser=!0,this.checkAgainForTrackpad=n+6e4):this.likelyTrackpadUser&&n>=this.checkAgainForTrackpad&&(this.likelyTrackpadUser=!1),this.likelyTrackpadUser)return;if(Math.abs(e.deltaX)<=t){const t=e.deltaY<0?-50:50,n=Math.abs(e.deltaY)<25?e.deltaY+t:e.deltaY;this.scrollElement.scrollLeft+=n*a}}}),this.state={leftIndicatorOffset:"0",rightIndicatorOffset:"0"}}componentDidUpdate(e){s.a.Children.count(e.children)!==s.a.Children.count(this.props.children)&&this.checkOverflow()}componentDidMount(){this.checkOverflow(),$.b.instance.on($.a.Resize,this.checkOverflow)}componentWillUnmount(){var e;null===(e=this.scrollElement)||void 0===e||e.removeEventListener("scroll",this.checkOverflow),$.b.instance.off($.a.Resize,this.checkOverflow)}render(){const e=this.props,{children:t,trackHorizontalOverflow:a,verticalScrollsHorizontally:n}=e,i=ge()(e,yt),r={left:this.state.leftIndicatorOffset},o={right:this.state.rightIndicatorOffset},c=a?s.a.createElement("div",{className:"mx_IndicatorScrollbar_leftOverflowIndicator",style:r}):null,l=a?s.a.createElement("div",{className:"mx_IndicatorScrollbar_rightOverflowIndicator",style:o}):null;return s.a.createElement(bt.a,X()({},i,{ref:this.autoHideScrollbar,wrappedRef:this.collectScroller,onWheel:this.onMouseWheel}),c,t,l)}}const _t=["onFinished","hideHeader"],wt=["selected","isPanelCollapsed"],St=["children","isPanelCollapsed","setPanelCollapsed","isDraggingOver","innerRef"],Ot=e=>{let{onFinished:t,hideHeader:a}=e,n=ge()(e,_t);const i=Object(ie.b)("Spaces.allRoomsInHome");return s.a.createElement(de.e,X()({},n,{onFinished:t,className:"mx_SpacePanel_contextMenu",compact:!0}),!a&&s.a.createElement("div",{className:"mx_SpacePanel_contextMenu_header"},Object(N.a)("Home")),s.a.createElement(de.c,{first:!0},s.a.createElement(de.a,{iconClassName:"mx_SpacePanel_noIcon",label:Object(N.a)("Show all rooms"),active:i,onClick:()=>{f.b.setValue("Spaces.allRoomsInHome",null,b.a.ACCOUNT,!i)}})))},Ct=e=>{let{selected:t,isPanelCollapsed:a}=e,n=ge()(e,wt);return s.a.createElement("li",{className:l()("mx_SpaceItem",{collapsed:a}),role:"treeitem","aria-selected":t},s.a.createElement(Re,X()({},n,{selected:t,isNarrow:a})))},xt=()=>K.a.instance.allRoomsInHome?Ne.a.instance.globalState:K.a.instance.getNotificationState(Y.a.Home),kt=e=>{let{isPanelCollapsed:t,setPanelCollapsed:a}=e;const[n,i,o,c]=Object(ce.p)();Object(r.useEffect)(()=>{!t&&n&&c()},[t]);let d=null;n&&(d=s.a.createElement(fe.d,{onFinished:c}));const u=n?c:()=>{t||a(!0),o()};return s.a.createElement("li",{className:l()("mx_SpaceItem mx_SpaceItem_new",{collapsed:t}),role:"treeitem"},s.a.createElement(Re,{"data-testid":"create-space-button",className:l()("mx_SpaceButton_new",{mx_SpaceButton_newCancel:n}),label:n?Object(N.a)("Cancel"):Object(N.a)("Create a space"),onClick:u,isNarrow:t,ref:i}),d)},jt={[Y.a.Home]:e=>{let{selected:t,isPanelCollapsed:a}=e;const n=Object(ne.b)(K.a.instance,Y.b,()=>K.a.instance.allRoomsInHome),[i,o]=Object(r.useState)(xt()),c=Object(r.useCallback)(()=>{o(xt())},[]);return Object(r.useEffect)(c,[c,n]),Object(ne.a)(Ne.a.instance,Ne.b,c),s.a.createElement(Ct,{spaceKey:Y.a.Home,className:"mx_SpaceButton_home",selected:t,isPanelCollapsed:a,label:Object(Y.g)(Y.a.Home,n),notificationState:i,ContextMenuComponent:Ot,contextMenuTooltip:Object(N.a)("Options")})},[Y.a.Favourites]:e=>{let{selected:t,isPanelCollapsed:a}=e;return s.a.createElement(Ct,{spaceKey:Y.a.Favourites,className:"mx_SpaceButton_favourites",selected:t,isPanelCollapsed:a,label:Object(Y.g)(Y.a.Favourites),notificationState:K.a.instance.getNotificationState(Y.a.Favourites)})},[Y.a.People]:e=>{let{selected:t,isPanelCollapsed:a}=e;return s.a.createElement(Ct,{spaceKey:Y.a.People,className:"mx_SpaceButton_people",selected:t,isPanelCollapsed:a,label:Object(Y.g)(Y.a.People),notificationState:K.a.instance.getNotificationState(Y.a.People)})},[Y.a.Orphans]:e=>{let{selected:t,isPanelCollapsed:a}=e;return s.a.createElement(Ct,{spaceKey:Y.a.Orphans,className:"mx_SpaceButton_orphans",selected:t,isPanelCollapsed:a,label:Object(Y.g)(Y.a.Orphans),notificationState:K.a.instance.getNotificationState(Y.a.Orphans)})}},Rt=s.a.memo(e=>{let{children:t,isPanelCollapsed:a,setPanelCollapsed:n,isDraggingOver:i,innerRef:r}=e,o=ge()(e,St);const[c,l,d,u]=(()=>{const e=Object(ne.b)(K.a.instance,Y.c,()=>K.a.instance.invitedSpaces),[t,a]=Object(ne.b)(K.a.instance,Y.f,()=>[K.a.instance.enabledMetaSpaces,K.a.instance.spacePanelSpaces]);return[e,t,a,Object(ne.b)(K.a.instance,Y.d,()=>K.a.instance.activeSpace)]})(),m=u?[u]:[],h=l.map(e=>{const t=jt[e];return s.a.createElement(t,{key:e,selected:u===e,isPanelCollapsed:a})});return s.a.createElement(Et,X()({},o,{wrappedRef:r,className:"mx_SpaceTreeLevel",style:i?{pointerEvents:"none"}:void 0,element:"ul",role:"tree","aria-label":Object(N.a)("Spaces")}),h,c.map(e=>s.a.createElement(Ie,{key:e.roomId,space:e,activeSpaces:m,isPanelCollapsed:a,onExpand:()=>n(!1)})),d.map((e,t)=>s.a.createElement(ve.Draggable,{key:e.roomId,draggableId:e.roomId,index:t},(t,i)=>s.a.createElement(Ie,X()({},t.draggableProps,{dragHandleProps:t.dragHandleProps,key:e.roomId,innerRef:t.innerRef,className:i.isDragging?"mx_SpaceItem_dragging":void 0,space:e,activeSpaces:m,isPanelCollapsed:a,onExpand:()=>n(!1)})))),t,Object(te.a)(se.a.CreateSpaces)&&s.a.createElement(kt,{isPanelCollapsed:a,setPanelCollapsed:n}))});var It=()=>{const[e,t]=Object(r.useState)(!0),a=Object(r.useRef)();return Object(r.useLayoutEffect)(()=>($.b.instance.trackElementDimensions("SpacePanel",a.current),()=>$.b.instance.stopTrackingElementDimensions("SpacePanel")),[]),Object(ae.a)(v.a,a=>{a.action===L.a.ToggleSpacePanel&&t(!e)}),s.a.createElement(ve.DragDropContext,{onDragEnd:e=>{e.destination&&K.a.instance.moveRootSpace(e.source.index,e.destination.index)}},s.a.createElement(Ce.d,{handleHomeEnd:!0,handleUpDown:!0},n=>{let{onKeyDownHandler:i}=n;return s.a.createElement("div",{className:l()("mx_SpacePanel",{collapsed:e}),onKeyDown:i,ref:a},s.a.createElement(ft,{isPanelCollapsed:e},s.a.createElement(q.a,{className:l()("mx_SpacePanel_toggleCollapse",{expanded:!e}),onClick:()=>t(!e),title:e?Object(N.a)("Expand"):Object(N.a)("Collapse"),tooltip:s.a.createElement("div",null,s.a.createElement("div",{className:"mx_Tooltip_title"},e?Object(N.a)("Expand"):Object(N.a)("Collapse")),s.a.createElement("div",{className:"mx_Tooltip_sub"},m.a?"⌘ + ⇧ + D":Object(N.a)(V.a[m.b.CONTROL])+" + "+Object(N.a)(V.a[m.b.SHIFT])+" + D"))})),s.a.createElement(ve.Droppable,{droppableId:"top-level-spaces"},(a,n)=>s.a.createElement(Rt,X()({},a.droppableProps,{isPanelCollapsed:e,setPanelCollapsed:t,isDraggingOver:n.isDraggingOver,innerRef:a.innerRef}),a.placeholder)),s.a.createElement(rt,{isPanelCollapsed:e}))}))};const Tt=e=>({left:e.left+window.scrollX,top:e.bottom+window.scrollY+12,chevronFace:ce.a.None});var Nt;!function(e){e[e.JoinRoom=0]="JoinRoom",e[e.BulkRedact=1]="BulkRedact"}(Nt||(Nt={}));var Dt=e=>{var t;let{onVisibilityChange:a}=e;const n=Object(r.useContext)(R.a),[i,c,l,d]=Object(ce.p)(),[u,m,h,p]=Object(ce.p)(),[g,f]=Object(ne.b)(K.a.instance,Y.d,()=>[K.a.instance.activeSpace,K.a.instance.activeSpaceRoom]),b=Object(ne.b)(K.a.instance,Y.b,()=>K.a.instance.allRoomsInHome),y=Object(ie.a)("feature_video_rooms"),E=Object(ie.a)("feature_element_call_video_rooms"),_=(()=>{const e=Object(r.useContext)(R.a),[t,a]=Object(r.useState)(new Map),n=(e,n)=>{const i=new Set(t.get(e));i.add(n),a(new Map(t).set(e,i))},i=(e,n)=>{const i=new Set(t.get(e));i.delete(n)&&a(new Map(t).set(e,i))};return Object(ae.a)(v.a,e=>{switch(e.action){case L.a.JoinRoom:n(Nt.JoinRoom,e.roomId);break;case L.a.JoinRoomReady:case L.a.JoinRoomError:i(Nt.JoinRoom,e.roomId);break;case L.a.BulkRedactStart:n(Nt.BulkRedact,e.roomId);break;case L.a.BulkRedactEnd:i(Nt.BulkRedact,e.roomId)}}),Object(ne.c)(e,o.b.Room,e=>i(Nt.JoinRoom,e.roomId)),t})(),w=f||g===Y.a.Home;Object(r.useEffect)(()=>{i&&!w&&d()},[d,w,i]);const S=Object(ne.d)(f,ee.d.Name,()=>null==f?void 0:f.name);Object(r.useEffect)(()=>{a&&a()},[a]);const O=Object(te.a)(se.a.ExploreRooms),C=Object(te.a)(se.a.CreateRooms),x=Object(te.a)(se.a.CreateSpaces),k=null==f||null===(t=f.currentState)||void 0===t?void 0:t.maySendStateEvent(Z.b.SpaceChild,n.getUserId()),j=k&&C,I=k&&x,T=C||O||x||f;let D,P;if(i&&c.current){let e;e=f?ue.a:Ot,D=s.a.createElement(e,X()({},Tt(c.current.getBoundingClientRect()),{space:f,onFinished:d,hideHeader:!0}))}else if(u&&f){let e,t;Object(oe.c)(f)&&(e=s.a.createElement(de.b,{label:Object(N.a)("Invite"),iconClassName:"mx_RoomListHeader_iconInvite",onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(oe.i)(f),p()}})),null!=f&&f.currentState.maySendStateEvent(Z.b.RoomAvatar,n.getUserId())&&(t=s.a.createElement(s.a.Fragment,null,s.a.createElement(de.b,{iconClassName:"mx_RoomListHeader_iconNewRoom",label:Object(N.a)("New room"),onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(oe.g)(f),re.b.trackInteraction("WebRoomListHeaderPlusMenuCreateRoomItem",e),p()}}),y&&s.a.createElement(de.b,{iconClassName:"mx_RoomListHeader_iconNewVideoRoom",label:Object(N.a)("New video room"),onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(oe.g)(f,E?Z.i.UnstableCall:Z.i.ElementVideo),p()}},s.a.createElement(le.a,null)))),D=s.a.createElement(de.e,X()({},Tt(m.current.getBoundingClientRect()),{onFinished:p,compact:!0}),s.a.createElement(de.c,{first:!0},e,t,s.a.createElement(de.b,{label:Object(N.a)("Explore rooms"),iconClassName:"mx_RoomListHeader_iconExplore",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:L.a.ViewRoom,room_id:f.roomId,metricsTrigger:void 0}),p(),re.b.trackInteraction("WebRoomListHeaderPlusMenuExploreRoomsItem",e)}}),s.a.createElement(de.b,{label:Object(N.a)("Add existing room"),iconClassName:"mx_RoomListHeader_iconPlus",onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(oe.e)(f),p()},disabled:!j,tooltip:!j&&Object(N.a)("You do not have permissions to add rooms to this space")}),x&&s.a.createElement(de.b,{label:Object(N.a)("Add space"),iconClassName:"mx_RoomListHeader_iconPlus",onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(oe.h)(f),p()},disabled:!I,tooltip:!I&&Object(N.a)("You do not have permissions to add spaces to this space")},s.a.createElement(le.a,null))))}else if(u){let e,t;C&&(e=s.a.createElement(s.a.Fragment,null,s.a.createElement(de.b,{label:Object(N.a)("Start new chat"),iconClassName:"mx_RoomListHeader_iconStartChat",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"view_create_chat"}),re.b.trackInteraction("WebRoomListHeaderPlusMenuCreateChatItem",e),p()}}),s.a.createElement(de.b,{label:Object(N.a)("New room"),iconClassName:"mx_RoomListHeader_iconNewRoom",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"view_create_room"}),re.b.trackInteraction("WebRoomListHeaderPlusMenuCreateRoomItem",e),p()}}),y&&s.a.createElement(de.b,{label:Object(N.a)("New video room"),iconClassName:"mx_RoomListHeader_iconNewVideoRoom",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"view_create_room",type:E?Z.i.UnstableCall:Z.i.ElementVideo}),p()}},s.a.createElement(le.a,null)))),O&&(t=s.a.createElement(de.b,{label:Object(N.a)("Join public room"),iconClassName:"mx_RoomListHeader_iconExplore",onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:L.a.ViewRoomDirectory}),re.b.trackInteraction("WebRoomListHeaderPlusMenuExploreRoomsItem",e),p()}})),D=s.a.createElement(de.e,X()({},Tt(m.current.getBoundingClientRect()),{onFinished:p,compact:!0}),s.a.createElement(de.c,{first:!0},e,t))}P=f?S:Object(Y.g)(g,b);const M=[..._.entries()].filter(e=>{let[t,a]=e;return a.size>0}).map(e=>{let[t,a]=e;switch(t){case Nt.JoinRoom:return Object(N.a)("Currently joining %(count)s rooms",{count:a.size});case Nt.BulkRedact:return Object(N.a)("Currently removing messages in %(count)s rooms",{count:a.size})}}).join("\n");let A=s.a.createElement("div",{className:"mx_RoomListHeader_contextLessTitle"},P);return w&&(A=s.a.createElement(ce.c,{inputRef:c,onClick:l,isExpanded:i,className:"mx_RoomListHeader_contextMenuButton",title:f?Object(N.a)("%(spaceName)s menu",{spaceName:null!=S?S:f.name}):Object(N.a)("Home options")},P)),s.a.createElement("div",{className:"mx_RoomListHeader"},A,M?s.a.createElement(he.a,{label:M},s.a.createElement(me.a,null)):null,T&&s.a.createElement(ce.c,{inputRef:m,onClick:h,isExpanded:u,className:"mx_RoomListHeader_plusButton",title:Object(N.a)("Add")}),D)},Pt=a(432),Mt=a(608),At=a(155),Lt=a.n(At);function Ut(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ft(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ut(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Bt(){let e=document.getElementById("mx_InteractiveTooltip_Container");return e||(e=document.createElement("div"),e.id="mx_InteractiveTooltip_Container",document.body.appendChild(e)),e}function Vt(e,t,a){const{top:n,right:i,bottom:r,left:s}=a;return e>=s&&e<=i&&t>=n&&t<=r}function zt(e){const{top:t,right:a,bottom:n,left:i}=e;return(n-t)/(a-i)}function Wt(e,t,a){const{bottom:n,left:i}=a,r=-1*zt(a);return Vt(e,t,a)&&t<=n+r*(e-i)}function Ht(e,t,a){const{bottom:n,left:i}=a,r=-1*zt(a);return Vt(e,t,a)&&t>=n+r*(e-i)}function Gt(e,t,a){const{top:n,left:i}=a,r=1*zt(a);return Vt(e,t,a)&&t<=n+r*(e-i)}function qt(e,t,a){const{top:n,left:i}=a,r=1*zt(a);return Vt(e,t,a)&&t>=n+r*(e-i)}let Kt;!function(e){e[e.Top=0]="Top",e[e.Left=1]="Left",e[e.Bottom=2]="Bottom",e[e.Right=3]="Right"}(Kt||(Kt={}));class Yt extends s.a.Component{constructor(e,t){super(e,t),i()(this,"target",void 0),i()(this,"collectContentRect",e=>{e&&this.setState({contentRect:e.getBoundingClientRect()})}),i()(this,"collectTarget",e=>{this.target=e}),i()(this,"onMouseMove",e=>{const{clientX:t,clientY:a}=e,{contentRect:n}=this.state,i=this.target.getBoundingClientRect();let r;r=this.isOnTheSide?this.onLeftOfTarget()?Kt.Left:Kt.Right:this.aboveTarget()?Kt.Top:Kt.Bottom,function(e,t,a,n,i){if(Vt(e,t,n))return!0;switch(a){case Kt.Left:{const a={top:i.top-50,right:i.right,bottom:i.bottom+50,left:i.left-50},r={top:i.top-50,right:n.right,bottom:n.top,left:i.right},s={top:n.top,right:n.left,bottom:n.bottom,left:i.right},o={top:n.bottom,right:n.right,bottom:i.bottom+50,left:i.right};if(Vt(e,t,a)||qt(e,t,r)||Vt(e,t,s)||Wt(e,t,o))return!0;break}case Kt.Right:{const a={top:i.top-50,right:i.right+50,bottom:i.bottom+50,left:i.left},r={top:i.top-50,right:i.left,bottom:n.top,left:n.left},s={top:n.top,right:i.left,bottom:n.bottom,left:n.right},o={top:n.bottom,right:i.left,bottom:i.bottom+50,left:n.left};if(Vt(e,t,a)||Ht(e,t,r)||Vt(e,t,s)||Gt(e,t,o))return!0;break}case Kt.Top:{const a={top:i.top-50,right:i.right+50,bottom:i.bottom,left:i.left-50},r={top:i.bottom,right:n.left,bottom:n.bottom,left:i.left-50},s={top:i.bottom,right:n.right,bottom:n.top,left:n.left},o={top:i.bottom,right:i.right+50,bottom:n.bottom,left:n.right};if(Vt(e,t,a)||Gt(e,t,r)||Vt(e,t,s)||Wt(e,t,o))return!0;break}case Kt.Bottom:{const a={top:i.top,right:i.right+50,bottom:i.bottom+50,left:i.left-50},r={top:n.top,right:n.left,bottom:i.top,left:i.left-50},s={top:n.bottom,right:n.right,bottom:i.top,left:n.left},o={top:n.top,right:i.right+50,bottom:i.top,left:n.right};if(Vt(e,t,a)||Ht(e,t,r)||Vt(e,t,s)||qt(e,t,o))return!0;break}}return!1}(t,a,r,i,n)||this.hideTooltip()}),i()(this,"onTargetMouseOver",()=>{this.showTooltip()}),this.state={contentRect:null,visible:!1}}componentDidUpdate(){this.renderTooltip()}componentWillUnmount(){document.removeEventListener("mousemove",this.onMouseMove)}onLeftOfTarget(){const{contentRect:e}=this.state,t=this.target.getBoundingClientRect();if(this.props.direction===Kt.Left){const a=t.left+window.scrollX;return!e||a-e.width>20}{const a=t.right+window.scrollX,n=$.b.instance.windowWidth-a;return e&&n-e.width<20}}aboveTarget(){const{contentRect:e}=this.state,t=this.target.getBoundingClientRect();if(this.props.direction===Kt.Top){const a=t.top+window.scrollY;return!e||a-e.height>20}{const a=t.bottom+window.scrollY,n=$.b.instance.windowHeight-a;return e&&n-e.height<20}}get isOnTheSide(){return this.props.direction===Kt.Left||this.props.direction===Kt.Right}showTooltip(){var e,t;this.target&&(this.setState({visible:!0}),null===(e=(t=this.props).onVisibilityChange)||void 0===e||e.call(t,!0),document.addEventListener("mousemove",this.onMouseMove))}hideTooltip(){var e,t;this.setState({visible:!1}),null===(e=(t=this.props).onVisibilityChange)||void 0===e||e.call(t,!1),document.removeEventListener("mousemove",this.onMouseMove)}renderTooltip(){const{contentRect:e,visible:t}=this.state;if(!t)return Lt.a.unmountComponentAtNode(Bt()),null;const a=this.target.getBoundingClientRect(),n=a.left+window.scrollX,i=a.right+window.scrollX,r=a.bottom+window.scrollY,o=a.top+window.scrollY,c={};let d=null;this.isOnTheSide?(this.onLeftOfTarget()?(c.left=n,d=ce.a.Right):(c.left=i,d=ce.a.Left),c.top=o):(this.aboveTarget()?(c.bottom=$.b.instance.windowHeight-o,d=ce.a.Bottom):(c.top=r,d=ce.a.Top),c.left=n+a.width/2);const u=s.a.createElement("div",{className:"mx_InteractiveTooltip_chevron_"+d}),m=l()({mx_InteractiveTooltip:!0,mx_InteractiveTooltip_withChevron_top:d===ce.a.Top,mx_InteractiveTooltip_withChevron_left:d===ce.a.Left,mx_InteractiveTooltip_withChevron_right:d===ce.a.Right,mx_InteractiveTooltip_withChevron_bottom:d===ce.a.Bottom}),h={};e&&!this.isOnTheSide&&(h.left=`-${e.width/2}px`);const p=s.a.createElement("div",{className:"mx_InteractiveTooltip_wrapper",style:Ft({},c)},s.a.createElement("div",{className:m,style:h,ref:this.collectContentRect},u,this.props.content));Lt.a.render(p,Bt())}render(){return this.props.children({ref:this.collectTarget,onMouseOver:this.onTargetMouseOver})}}i()(Yt,"defaultProps",{side:Kt.Top});var Jt=a(285);var $t=()=>{const e=Object(r.useRef)(),t=Object(ne.b)(Pt.a.instance,mt.b,()=>Pt.a.instance.rooms),a=s.a.createElement("div",{className:"mx_RecentlyViewedButton_ContextMenu"},s.a.createElement("h4",null,Object(N.a)("Recently viewed")),s.a.createElement("div",null,t.map(t=>s.a.createElement(ce.d,{key:t.roomId,onClick:a=>{var n;v.a.dispatch({action:L.a.ViewRoom,room_id:t.roomId,metricsTrigger:"WebVerticalBreadcrumbs",metricsViaKeyboard:"click"!==a.type}),null===(n=e.current)||void 0===n||n.hideTooltip()}},t.isSpaceRoom()?s.a.createElement(be.a,{room:t,width:24,height:24}):s.a.createElement(Jt.a,{room:t,avatarSize:24,tooltipProps:{tabIndex:-1}}),s.a.createElement("span",{className:"mx_RecentlyViewedButton_entry_label"},s.a.createElement("div",null,t.name),s.a.createElement(Mt.a,{className:"mx_RecentlyViewedButton_entry_spaces",room:t}))))));return s.a.createElement(Yt,{content:a,direction:Kt.Right,ref:e},e=>{let{ref:t,onMouseOver:a}=e;return s.a.createElement("span",{className:"mx_LeftPanel_recentsButton",title:Object(N.a)("Recently viewed"),ref:t,onMouseOver:a})})},Qt=a(194),Xt=a(793),Zt=a(580);const ea=e=>{let{room:t,onClick:a}=e;const[n,i,r]=Object(Ce.i)();return s.a.createElement(q.a,{className:"mx_RoomBreadcrumbs_crumb",onClick:a,"aria-label":Object(N.a)("Room %(name)s",{name:t.name}),title:t.name,tooltipClassName:"mx_RoomBreadcrumbs_Tooltip",onFocus:n,inputRef:r,tabIndex:i?0:-1},s.a.createElement(Jt.a,{room:t,avatarSize:32,displayBadge:!0,forceCount:!0,tooltipProps:{tabIndex:i?0:-1}}))};class ta extends s.a.PureComponent{constructor(e){super(e),i()(this,"isMounted",!0),i()(this,"onBreadcrumbsUpdate",()=>{this.isMounted&&(this.setState({doAnimation:!1,skipFirst:!0}),setTimeout(()=>this.setState({doAnimation:!0,skipFirst:!1}),0))}),i()(this,"viewRoom",(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];v.a.dispatch({action:L.a.ViewRoom,room_id:e.roomId,metricsTrigger:"WebHorizontalBreadcrumbs",metricsViaKeyboard:a})})),this.state={doAnimation:!0,skipFirst:!1},Pt.a.instance.on(mt.b,this.onBreadcrumbsUpdate)}componentWillUnmount(){this.isMounted=!1,Pt.a.instance.off(mt.b,this.onBreadcrumbsUpdate)}render(){const e=Pt.a.instance.rooms.map((e,t)=>s.a.createElement(ea,{key:e.roomId,room:e,onClick:a=>this.viewRoom(e,t,"click"!==a.type)}));return e.length>0?s.a.createElement(Xt.CSSTransition,{appear:!0,in:this.state.doAnimation,timeout:640,classNames:"mx_RoomBreadcrumbs"},s.a.createElement(Zt.a,{className:"mx_RoomBreadcrumbs","aria-label":Object(N.a)("Recently visited rooms")},e.slice(this.state.skipFirst?1:0))):s.a.createElement("div",{className:"mx_RoomBreadcrumbs"},s.a.createElement("div",{className:"mx_RoomBreadcrumbs_placeholder"},Object(N.a)("No recently visited rooms")))}}var aa,na=a(146),ia=a(445);function ra(e){let{selected:t,minimized:a}=e;const n=Object(ie.b)("FTUE.useCaseSelection");return Object(ie.b)("FTUE.userOnboardingButton")&&!a&&Object(ia.b)(n)?s.a.createElement(sa,{selected:t,minimized:a}):null}function sa(e){let{selected:t,minimized:a}=e;const n=Object(r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),re.b.trackInteraction("WebRoomListUserOnboardingIgnoreButton",e),f.b.setValue("FTUE.userOnboardingButton",null,b.a.ACCOUNT,!1)},[]),i=Object(r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),re.b.trackInteraction("WebRoomListUserOnboardingButton",e),v.a.fire(L.a.ViewHomePage)},[]);return s.a.createElement(H.a,{className:l()("mx_UserOnboardingButton",{mx_UserOnboardingButton_selected:t,mx_UserOnboardingButton_minimized:a}),onClick:i},!a&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_UserOnboardingButton_content"},s.a.createElement(na.a,{size:"h4",className:"mx_Heading_h4"},Object(N.a)("Welcome")),s.a.createElement(H.a,{className:"mx_UserOnboardingButton_close",onClick:n}))))}!function(e){e[e.Disabled=0]="Disabled",e[e.Legacy=1]="Legacy",e[e.Labs=2]="Labs"}(aa||(aa={}));class oa extends r.Component{constructor(e){super(e),i()(this,"listContainerRef",Object(r.createRef)()),i()(this,"roomListRef",Object(r.createRef)()),i()(this,"focusedElement",null),i()(this,"isDoingStickyHeaders",!1),i()(this,"updateActiveSpace",e=>{this.setState({activeSpace:e})}),i()(this,"onDialPad",()=>{v.a.fire(L.a.OpenDialPad)}),i()(this,"onExplore",e=>{v.a.fire(L.a.ViewRoomDirectory),re.b.trackInteraction("WebLeftPanelExploreRoomsButton",e)}),i()(this,"refreshStickyHeaders",()=>{this.listContainerRef.current&&this.handleStickyHeaders(this.listContainerRef.current)}),i()(this,"onBreadcrumbsUpdate",()=>{const e=oa.breadcrumbsMode;if(e!==this.state.showBreadcrumbs){if(this.setState({showBreadcrumbs:e}),!this.listContainerRef.current)return;this.handleStickyHeaders(this.listContainerRef.current)}}),i()(this,"onScroll",e=>{const t=e.target;this.handleStickyHeaders(t)}),i()(this,"onFocus",e=>{this.focusedElement=e.target}),i()(this,"onBlur",()=>{this.focusedElement=null}),i()(this,"onKeyDown",(e,t)=>{if(!this.focusedElement)return;switch(Object(J.a)().getRoomListAction(e)){case V.h.NextRoom:var a;if(!t)e.stopPropagation(),e.preventDefault(),null===(a=this.roomListRef.current)||void 0===a||a.focus()}}),this.state={activeSpace:K.a.instance.activeSpace,showBreadcrumbs:oa.breadcrumbsMode},Pt.a.instance.on(mt.b,this.onBreadcrumbsUpdate),Qt.c.instance.on(Qt.b,this.onBreadcrumbsUpdate),K.a.instance.on(Y.d,this.updateActiveSpace)}static get breadcrumbsMode(){return Pt.a.instance.visible?f.b.getValue("feature_breadcrumbs_v2")?aa.Labs:aa.Legacy:aa.Disabled}componentDidMount(){var e;$.b.instance.trackElementDimensions("ListContainer",this.listContainerRef.current),$.b.instance.on("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.addEventListener("scroll",this.onScroll,{passive:!0})}componentWillUnmount(){var e;Pt.a.instance.off(mt.b,this.onBreadcrumbsUpdate),Qt.c.instance.off(Qt.b,this.onBreadcrumbsUpdate),K.a.instance.off(Y.d,this.updateActiveSpace),$.b.instance.stopTrackingElementDimensions("ListContainer"),$.b.instance.removeListener("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.removeEventListener("scroll",this.onScroll)}componentDidUpdate(e,t){t.activeSpace!==this.state.activeSpace&&this.refreshStickyHeaders()}handleStickyHeaders(e){this.isDoingStickyHeaders||(this.isDoingStickyHeaders=!0,window.requestAnimationFrame(()=>{this.doStickyHeaders(e),this.isDoingStickyHeaders=!1}))}doStickyHeaders(e){const t=e.scrollTop,a=e.offsetHeight+e.scrollTop,n=e.querySelectorAll(".mx_RoomSublist:not(.mx_RoomSublist_hidden)"),i=new Map;let r,s;for(const e of n){const o=e.querySelector(".mx_RoomSublist_stickable");o.style.removeProperty("display");const c=.4,l=e.offsetTop+c*B.a<=t,d=e.offsetTop+c*B.a>=a;l||e===n[0]?(i.set(o,{stickyTop:!0}),r&&(r.style.display="none",i.set(r,{makeInvisible:!0})),r=o):d&&!s?(i.set(o,{stickyBottom:!0}),s=o):i.set(o,{})}for(const t of i.keys()){const a=i.get(t);if(a.makeInvisible)t.style.display="none";else{if(a.stickyTop){t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")||t.classList.add("mx_RoomSublist_headerContainer_stickyTop");const a=e.parentElement.offsetTop+"px";t.style.top!==a&&(t.style.top=a)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyTop"),t.style.top&&t.style.removeProperty("top");if(a.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")||t.classList.add("mx_RoomSublist_headerContainer_stickyBottom");const a=$.b.instance.windowHeight-(e.parentElement.offsetTop+e.parentElement.offsetHeight)+"px";t.style.bottom!==a&&(t.style.bottom=a)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyBottom"),t.style.bottom&&t.style.removeProperty("bottom");if(a.stickyTop||a.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_sticky")||t.classList.add("mx_RoomSublist_headerContainer_sticky");const e=$.b.instance.getElementDimensions("ListContainer");if(e){const a=15,n=e.width-a+"px";t.style.width!==n&&(t.style.width=n)}}else a.stickyTop||a.stickyBottom||(t.classList.contains("mx_RoomSublist_headerContainer_sticky")&&t.classList.remove("mx_RoomSublist_headerContainer_sticky"),t.style.width&&t.style.removeProperty("width"))}}const o=e.parentElement;r?o.classList.add("mx_LeftPanel_roomListWrapper_stickyTop"):o.classList.remove("mx_LeftPanel_roomListWrapper_stickyTop"),s?o.classList.add("mx_LeftPanel_roomListWrapper_stickyBottom"):o.classList.remove("mx_LeftPanel_roomListWrapper_stickyBottom")}renderBreadcrumbs(){if(this.state.showBreadcrumbs===aa.Legacy&&!this.props.isMinimized)return r.createElement(Et,{className:"mx_LeftPanel_breadcrumbsContainer mx_AutoHideScrollbar",verticalScrollsHorizontally:!0},r.createElement(ta,null))}renderSearchDialExplore(){let e,t=null;return F.b.instance.getSupportsPstnProtocol()&&(t=r.createElement(q.a,{className:l()("mx_LeftPanel_dialPadButton",{}),onClick:this.onDialPad,title:Object(N.a)("Open dial pad")})),this.state.showBreadcrumbs===aa.Labs?e=r.createElement($t,null):this.state.activeSpace===Y.a.Home&&Object(te.a)(se.a.ExploreRooms)&&(e=r.createElement(q.a,{className:"mx_LeftPanel_exploreButton",onClick:this.onExplore,title:Object(N.a)("Explore rooms")})),r.createElement("div",{className:"mx_LeftPanel_filterContainer",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown},r.createElement(G,{isMinimized:this.props.isMinimized}),t,e)}render(){const e=r.createElement(U.b,{onKeyDown:this.onKeyDown,resizeNotifier:this.props.resizeNotifier,onFocus:this.onFocus,onBlur:this.onBlur,isMinimized:this.props.isMinimized,activeSpace:this.state.activeSpace,onResize:this.refreshStickyHeaders,onListCollapse:this.refreshStickyHeaders,ref:this.roomListRef}),t=l()({mx_LeftPanel:!0,mx_LeftPanel_minimized:this.props.isMinimized}),a=l()("mx_LeftPanel_actualRoomListContainer","mx_AutoHideScrollbar");return r.createElement("div",{className:t},r.createElement("div",{className:"mx_LeftPanel_roomListContainer"},this.renderSearchDialExplore(),this.renderBreadcrumbs(),!this.props.isMinimized&&r.createElement(Dt,{onVisibilityChange:this.refreshStickyHeaders}),r.createElement(ra,{selected:this.props.pageType===h.a.HomePage,minimized:this.props.isMinimized}),r.createElement("div",{className:"mx_LeftPanel_roomListWrapper"},r.createElement("div",{className:a,ref:this.listContainerRef,tabIndex:-1},e))))}}var ca=a(161),la=a(1),da=a(465),ua=a(466),ma=a(141);class ha extends s.a.PureComponent{constructor(e){super(e),i()(this,"element",void 0),i()(this,"setElementRef",e=>{var t;e?(this.element=e,e.addEventListener("resize",this.onResize)):null===(t=this.element)||void 0===t||t.removeEventListener("resize",this.onResize)}),i()(this,"onNewStream",()=>{this.setState({audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}),this.playMedia()}),i()(this,"onMuteStateChanged",()=>{this.setState({audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()})}),i()(this,"onResize",e=>{this.props.onResize&&!this.props.feed.isLocal()&&this.props.onResize(e)}),this.state={audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}}componentDidMount(){this.updateFeed(null,this.props.feed),this.playMedia()}componentWillUnmount(){this.updateFeed(this.props.feed,null)}componentDidUpdate(e,t){this.updateFeed(e.feed,this.props.feed),t.videoMuted===this.state.videoMuted&&e.feed.stream===this.props.feed.stream||this.playMedia()}static getDerivedStateFromProps(e){return{audioMuted:e.feed.isAudioMuted(),videoMuted:e.feed.isVideoMuted()}}updateFeed(e,t){e!==t&&(e&&(this.props.feed.removeListener(ua.b.NewStream,this.onNewStream),this.props.feed.removeListener(ua.b.MuteStateChanged,this.onMuteStateChanged),this.props.feed.purpose===da.b.Usermedia&&this.props.feed.measureVolumeActivity(!1),this.stopMedia()),t&&(this.props.feed.addListener(ua.b.NewStream,this.onNewStream),this.props.feed.addListener(ua.b.MuteStateChanged,this.onMuteStateChanged),this.props.feed.purpose===da.b.Usermedia&&this.props.feed.measureVolumeActivity(!0),this.playMedia()))}async playMedia(){const e=this.element;if(e){e.muted=!0,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{await e.play()}catch(e){la.a.info(`Failed to play media element with feed for userId ${this.props.feed.userId} with purpose ${this.props.feed.purpose}`,e)}}}stopMedia(){const e=this.element;e&&(e.pause(),e.src=null)}render(){const{pipMode:e,primary:t,secondary:a,feed:n}=this.props,i=l()("mx_VideoFeed",{mx_VideoFeed_primary:t,mx_VideoFeed_secondary:a,mx_VideoFeed_voice:this.state.videoMuted}),r=l()("mx_VideoFeed_mic",{mx_VideoFeed_mic_muted:this.state.audioMuted,mx_VideoFeed_mic_unmuted:!this.state.audioMuted});let o,c;if(n.purpose===da.b.Screenshare||t||e||(o=s.a.createElement("div",{className:r})),this.state.videoMuted){const a=this.props.feed.getMember();let n;e&&t?n=76:e&&!t?n=16:!e&&t&&(n=160),c=s.a.createElement(ma.a,{member:a,height:n,width:n})}else{const e=l()("mx_VideoFeed_video",{mx_VideoFeed_video_mirror:this.props.feed.isLocal()&&this.props.feed.purpose===da.b.Usermedia&&f.b.getValue("VideoView.flipVideoHorizontally")});c=s.a.createElement("video",{className:e,ref:this.setElementRef})}return s.a.createElement("div",{className:i},o,c)}}var pa=a(229),ga=a(741);class va extends s.a.Component{render(){const e=this.props.feeds.map(e=>s.a.createElement(ha,{key:e.stream.id,feed:e,call:this.props.call,primary:!1,pipMode:this.props.pipMode})),t=l()("mx_LegacyCallViewSidebar",{mx_LegacyCallViewSidebar_pipMode:this.props.pipMode});return s.a.createElement("div",{className:t},e)}}const fa=e=>{let{onExpand:t,onPin:a,onMaximize:n}=e;return s.a.createElement("div",{className:"mx_LegacyCallViewHeader_controls"},n&&s.a.createElement(q.a,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_fullscreen",onClick:n,title:Object(N.a)("Fill screen")}),a&&s.a.createElement(q.a,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_pin",onClick:a,title:Object(N.a)("Pin")}),t&&s.a.createElement(q.a,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_expand",onClick:t,title:Object(N.a)("Return to call")}))},ba=e=>{let{callRoom:t}=e;return s.a.createElement("span",{className:"mx_LegacyCallViewHeader_secondaryCallInfo"},s.a.createElement(be.a,{room:t,height:16,width:16}),s.a.createElement("span",{className:"mx_LegacyCallView_secondaryCall_roomName"},Object(N.a)("%(name)s on hold",{name:t.name})))};var ya=e=>{let{pipMode:t=!1,callRooms:a=[],onPipMouseDown:n,onExpand:i,onPin:r,onMaximize:o}=e;const[c,l]=a,d=c.name;return t?s.a.createElement("div",{className:"mx_LegacyCallViewHeader mx_LegacyCallViewHeader_pip",onMouseDown:n},s.a.createElement(be.a,{room:c,height:32,width:32}),s.a.createElement("div",{className:"mx_LegacyCallViewHeader_callInfo"},s.a.createElement("div",{className:"mx_LegacyCallViewHeader_roomName"},d),l&&s.a.createElement(ba,{callRoom:l})),s.a.createElement(fa,{onExpand:i,onPin:r,onMaximize:o})):s.a.createElement("div",{className:"mx_LegacyCallViewHeader"},s.a.createElement("div",{className:"mx_LegacyCallViewHeader_icon"}),s.a.createElement("span",{className:"mx_LegacyCallViewHeader_text"},Object(N.a)("Call")),s.a.createElement(fa,{onMaximize:o}))},Ea=a(175),_a=a.n(Ea);class wa extends s.a.Component{constructor(e){super(e),i()(this,"onHoldClick",()=>{this.props.call.setRemoteOnHold(!0),this.props.onFinished()}),i()(this,"onUnholdClick",()=>{F.b.instance.setActiveCallRoomId(this.props.call.roomId),this.props.onFinished()}),i()(this,"onTransferClick",()=>{F.b.instance.showTransferDialog(this.props.call),this.props.onFinished()})}render(){const e=this.props.call.isRemoteOnHold()?Object(N.a)("Resume"):Object(N.a)("Hold"),t=this.props.call.isRemoteOnHold()?this.onUnholdClick:this.onHoldClick;let a;return this.props.call.opponentCanBeTransferred()&&(a=s.a.createElement(ce.d,{className:"mx_LegacyCallContextMenu_item",onClick:this.onTransferClick},Object(N.a)("Transfer"))),s.a.createElement(ce.n,this.props,s.a.createElement(ce.d,{className:"mx_LegacyCallContextMenu_item",onClick:t},e),a)}}i()(wa,"propTypes",{user:_a.a.object});var Sa=a(108),Oa=a(571);class Ca extends r.Component{constructor(e){super(e),i()(this,"numberEntryFieldRef",Object(r.createRef)()),i()(this,"onDigitPress",(e,t)=>{var a;(this.props.call.sendDtmfDigit(e),this.setState({value:this.state.value+e}),"click"===t.type)&&(null===(a=this.numberEntryFieldRef.current)||void 0===a||a.focus())}),i()(this,"onCancelClick",()=>{this.props.onFinished()}),i()(this,"onKeyDown",e=>{"Backspace"!==e.code&&"Delete"!==e.code||e.preventDefault()}),i()(this,"onChange",e=>{this.setState({value:e.target.value})}),this.state={value:""}}render(){return r.createElement(ce.n,this.props,r.createElement("div",{className:"mx_DialPadContextMenuWrapper"},r.createElement("div",null,r.createElement(H.a,{className:"mx_DialPadContextMenu_cancel",onClick:this.onCancelClick})),r.createElement("div",{className:"mx_DialPadContextMenu_header"},r.createElement(Sa.a,{ref:this.numberEntryFieldRef,className:"mx_DialPadContextMenu_dialled",value:this.state.value,autoFocus:!0,onKeyDown:this.onKeyDown,onChange:this.onChange})),r.createElement("div",{className:"mx_DialPadContextMenu_dialPad"},r.createElement(Oa.a,{onDigitPress:this.onDigitPress,hasDial:!1}))))}}var xa=a(137);const ka=["deviceKinds"],ja={[p.b.AudioInput]:Object(N.c)("Input devices"),[p.b.AudioOutput]:Object(N.c)("Output devices"),[p.b.VideoInput]:Object(N.c)("Cameras")},Ra=e=>{let{label:t,selected:a,onClick:n}=e;return s.a.createElement(de.d,{iconClassName:"mx_DeviceContextMenu_device_icon",label:t,active:a,onClick:n})},Ia=e=>{let{deviceKind:t}=e;const[a,n]=Object(r.useState)([]),[i,o]=Object(r.useState)(p.c.getDevice(t));Object(r.useEffect)(()=>{(async()=>{n((await p.c.getDevices())[t])})()},[t]);return s.a.createElement(de.c,{label:Object(N.a)(ja[t])},a.map(e=>{let{label:a,deviceId:n}=e;return s.a.createElement(Ra,{key:n,label:a,selected:i===n,onClick:()=>(e=>{p.c.instance.setDevice(e,t),o(e)})(n)})}))};var Ta=e=>{let{deviceKinds:t}=e,a=ge()(e,ka);return s.a.createElement(de.e,X()({compact:!0,className:"mx_DeviceContextMenu"},a),t.map(e=>s.a.createElement(Ia,{key:e,deviceKind:e})))};const Na=["children","state","className","onLabel","offLabel"],Da=["state","deviceKinds"],Pa=e=>{let{children:t,state:a,className:n,onLabel:i,offLabel:r}=e,o=ge()(e,Na);const c=l()("mx_LegacyCallViewButtons_button",n,{mx_LegacyCallViewButtons_button_on:a,mx_LegacyCallViewButtons_button_off:!a});return s.a.createElement(q.a,X()({className:c,title:a?i:r,alignment:xa.a.Top},o),t)},Ma=e=>{var t;let{state:a,deviceKinds:n}=e,i=ge()(e,Da);const[o,c,d,u]=Object(ce.p)(),[m,h]=Object(r.useState)(!1),p=l()("mx_LegacyCallViewButtons_button","mx_LegacyCallViewButtons_dropdownButton",{mx_LegacyCallViewButtons_dropdownButton_collapsed:!o});return s.a.createElement(Pa,X()({inputRef:c,forceHide:o||m,state:a},i),s.a.createElement(Pa,{className:p,onClick:e=>{e.stopPropagation(),d()},onHover:e=>h(e),state:a}),o&&s.a.createElement(Ta,X()({},Object(ce.l)(null===(t=c.current)||void 0===t?void 0:t.getBoundingClientRect()),{onFinished:u,deviceKinds:n})))};class Aa extends s.a.Component{constructor(e){super(e),i()(this,"dialpadButton",Object(r.createRef)()),i()(this,"contextMenuButton",Object(r.createRef)()),i()(this,"controlsHideTimer",null),i()(this,"onControlsHideTimer",()=>{this.state.hoveringControls||this.state.showDialpad||this.state.showMoreMenu||(this.controlsHideTimer=null,this.setState({visible:!1}))}),i()(this,"onMouseEnter",()=>{this.setState({hoveringControls:!0})}),i()(this,"onMouseLeave",()=>{this.setState({hoveringControls:!1})}),i()(this,"onDialpadClick",()=>{this.state.showDialpad?this.setState({showDialpad:!1}):(this.setState({showDialpad:!0}),this.showControls())}),i()(this,"onMoreClick",()=>{this.setState({showMoreMenu:!0}),this.showControls()}),i()(this,"closeDialpad",()=>{this.setState({showDialpad:!1})}),i()(this,"closeContextMenu",()=>{this.setState({showMoreMenu:!1})}),this.state={showDialpad:!1,hoveringControls:!1,showMoreMenu:!1,visible:!0}}componentDidMount(){this.showControls()}showControls(){this.state.showMoreMenu||this.state.showDialpad||(this.state.visible||this.setState({visible:!0}),null!==this.controlsHideTimer&&clearTimeout(this.controlsHideTimer),this.controlsHideTimer=window.setTimeout(this.onControlsHideTimer,2e3))}render(){const e=l()("mx_LegacyCallViewButtons",{mx_LegacyCallViewButtons_hidden:!this.state.visible});let t,a;return this.state.showDialpad&&(t=s.a.createElement(Ca,X()({},Object(ce.k)(this.dialpadButton.current.getBoundingClientRect(),ce.a.None,8),{mountAsChild:!this.props.pipMode,onFinished:this.closeDialpad,call:this.props.call}))),this.state.showMoreMenu&&(a=s.a.createElement(wa,X()({},Object(ce.k)(this.contextMenuButton.current.getBoundingClientRect(),ce.a.None,8),{mountAsChild:!this.props.pipMode,onFinished:this.closeContextMenu,call:this.props.call}))),s.a.createElement("div",{className:e,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,a,this.props.buttonsVisibility.dialpad&&s.a.createElement(ce.c,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_dialpad",inputRef:this.dialpadButton,onClick:this.onDialpadClick,isExpanded:this.state.showDialpad,title:Object(N.a)("Dialpad"),alignment:xa.a.Top}),s.a.createElement(Ma,{state:!this.props.buttonsState.micMuted,className:"mx_LegacyCallViewButtons_button_mic",onLabel:Object(N.a)("Mute the microphone"),offLabel:Object(N.a)("Unmute the microphone"),onClick:this.props.handlers.onMicMuteClick,deviceKinds:[p.b.AudioInput,p.b.AudioOutput]}),this.props.buttonsVisibility.vidMute&&s.a.createElement(Ma,{state:!this.props.buttonsState.vidMuted,className:"mx_LegacyCallViewButtons_button_vid",onLabel:Object(N.a)("Stop the camera"),offLabel:Object(N.a)("Start the camera"),onClick:this.props.handlers.onVidMuteClick,deviceKinds:[p.b.VideoInput]}),this.props.buttonsVisibility.screensharing&&s.a.createElement(Pa,{state:this.props.buttonsState.screensharing,className:"mx_LegacyCallViewButtons_button_screensharing",onLabel:Object(N.a)("Stop sharing your screen"),offLabel:Object(N.a)("Start sharing your screen"),onClick:this.props.handlers.onScreenshareClick}),this.props.buttonsVisibility.sidebar&&s.a.createElement(Pa,{state:this.props.buttonsState.sidebarShown,className:"mx_LegacyCallViewButtons_button_sidebar",onLabel:Object(N.a)("Hide sidebar"),offLabel:Object(N.a)("Show sidebar"),onClick:this.props.handlers.onToggleSidebarClick}),this.props.buttonsVisibility.contextMenu&&s.a.createElement(ce.c,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_button_more",onClick:this.onMoreClick,inputRef:this.contextMenuButton,isExpanded:this.state.showMoreMenu,title:Object(N.a)("More"),alignment:xa.a.Top}),s.a.createElement(q.a,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_button_hangup",onClick:this.props.handlers.onHangupClick,title:Object(N.a)("Hangup"),alignment:xa.a.Top}))}}function La(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function Ua(){const e=document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.call(document)}class Fa extends s.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"contentWrapperRef",Object(r.createRef)()),i()(this,"buttonsRef",Object(r.createRef)()),i()(this,"onAction",e=>{switch(e.action){case"video_fullscreen":if(!this.contentWrapperRef.current)return;e.fullscreen?function(e){const t=e.requestFullscreen||e.webkitRequestFullScreen||e.msRequestFullscreen;t&&t.call(e)}(this.contentWrapperRef.current):La()&&Ua()}}),i()(this,"onCallState",e=>{this.setState({callState:e})}),i()(this,"onFeedsChanged",e=>{const{primary:t,secondary:a,sidebar:n}=Fa.getOrderedFeeds(e);this.setState({primaryFeed:t,secondaryFeed:a,sidebarFeeds:n,micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted()})}),i()(this,"onCallLocalHoldUnhold",()=>{this.setState({isLocalOnHold:this.props.call.isLocalOnHold()})}),i()(this,"onCallRemoteHoldUnhold",()=>{this.setState({isRemoteOnHold:this.props.call.isRemoteOnHold(),isLocalOnHold:this.props.call.isLocalOnHold()})}),i()(this,"onMouseMove",()=>{var e;null===(e=this.buttonsRef.current)||void 0===e||e.showControls()}),i()(this,"onMaximizeClick",()=>{v.a.dispatch({action:"video_fullscreen",fullscreen:!0})}),i()(this,"onMicMuteClick",async()=>{const e=!this.state.micMuted;this.setState({micMuted:await this.props.call.setMicrophoneMuted(e)})}),i()(this,"onVidMuteClick",async()=>{const e=!this.state.vidMuted;this.setState({vidMuted:await this.props.call.setLocalVideoMuted(e)})}),i()(this,"onScreenshareClick",async()=>{let e;if(this.state.screensharing)e=await this.props.call.setScreensharingEnabled(!1);else if(I.a.get().supportsDesktopCapturer()){const{finished:t}=z.a.createDialog(ga.a),[a]=await t;if(!a)return;e=await this.props.call.setScreensharingEnabled(!0,a)}else e=await this.props.call.setScreensharingEnabled(!0);this.setState({sidebarShown:!0,screensharing:e})}),i()(this,"onNativeKeyDown",e=>{var t,a;let n=!1;switch(Object(J.a)().getCallAction(e)){case V.h.ToggleMicInCall:this.onMicMuteClick(),null===(t=this.buttonsRef.current)||void 0===t||t.showControls(),n=!0;break;case V.h.ToggleWebcamInCall:this.onVidMuteClick(),null===(a=this.buttonsRef.current)||void 0===a||a.showControls(),n=!0}n&&(e.stopPropagation(),e.preventDefault())}),i()(this,"onCallResumeClick",()=>{const e=F.b.instance.roomIdForCall(this.props.call);F.b.instance.setActiveCallRoomId(e)}),i()(this,"onTransferClick",()=>{const e=F.b.instance.getTransfereeForCallId(this.props.call.callId);this.props.call.transferToCall(e)}),i()(this,"onHangupClick",()=>{F.b.instance.hangupOrReject(F.b.instance.roomIdForCall(this.props.call))}),i()(this,"onToggleSidebar",()=>{this.setState({sidebarShown:!this.state.sidebarShown})});const{primary:t,secondary:a,sidebar:n}=Fa.getOrderedFeeds(this.props.call.getFeeds());this.state={isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),screensharing:this.props.call.isScreensharing(),callState:this.props.call.state,primaryFeed:t,secondaryFeed:a,sidebarFeeds:n,sidebarShown:!0},this.updateCallListeners(null,this.props.call)}componentDidMount(){this.dispatcherRef=v.a.register(this.onAction),document.addEventListener("keydown",this.onNativeKeyDown)}componentWillUnmount(){La()&&Ua(),document.removeEventListener("keydown",this.onNativeKeyDown),this.updateCallListeners(this.props.call,null),v.a.unregister(this.dispatcherRef)}static getDerivedStateFromProps(e){const{primary:t,secondary:a,sidebar:n}=Fa.getOrderedFeeds(e.call.getFeeds());return{primaryFeed:t,secondaryFeed:a,sidebarFeeds:n}}componentDidUpdate(e){this.props.call!==e.call&&(this.setState({isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),callState:this.props.call.state}),this.updateCallListeners(null,this.props.call))}updateCallListeners(e,t){e!==t&&(e&&(e.removeListener(ca.c.State,this.onCallState),e.removeListener(ca.c.LocalHoldUnhold,this.onCallLocalHoldUnhold),e.removeListener(ca.c.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),e.removeListener(ca.c.FeedsChanged,this.onFeedsChanged)),t&&(t.on(ca.c.State,this.onCallState),t.on(ca.c.LocalHoldUnhold,this.onCallLocalHoldUnhold),t.on(ca.c.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),t.on(ca.c.FeedsChanged,this.onFeedsChanged)))}static getOrderedFeeds(e){if(e.length<=2)return{primary:e.find(e=>!e.isLocal()),secondary:e.find(e=>e.isLocal()),sidebar:[]};let t;const a=e.filter(e=>e.purpose===da.b.Screenshare);t=a.find(e=>!e.isLocal())||a[0],t||(t=e.find(e=>!e.isLocal()));const n=[...e];return t&&n.splice(n.indexOf(t),1),n.sort((e,t)=>e.isLocal()&&!t.isLocal()?-1:!e.isLocal()&&t.isLocal()?1:0),{primary:t,sidebar:n}}renderCallControls(){const{call:e,pipMode:t}=this.props,{callState:a,micMuted:n,vidMuted:i,screensharing:r,sidebarShown:o,secondaryFeed:c,sidebarFeeds:l}=this.state,d=e.opponentSupportsSDPStreamMetadata()||e.hasLocalUserMediaVideoTrack,u=(e.opponentSupportsSDPStreamMetadata()||e.hasLocalUserMediaVideoTrack)&&e.state===ca.e.Connected,m=c&&!c.isVideoMuted()||l.length>0,h=a===ca.e.Connected,p=a===ca.e.Connected&&e.opponentSupportsDTMF();return s.a.createElement(Aa,{ref:this.buttonsRef,call:e,pipMode:t,handlers:{onToggleSidebarClick:this.onToggleSidebar,onScreenshareClick:this.onScreenshareClick,onHangupClick:this.onHangupClick,onMicMuteClick:this.onMicMuteClick,onVidMuteClick:this.onVidMuteClick},buttonsState:{micMuted:n,vidMuted:i,sidebarShown:o,screensharing:r},buttonsVisibility:{vidMute:d,screensharing:u,sidebar:m,contextMenu:h,dialpad:p}})}renderToast(){const{call:e}=this.props;if(!e.getFeeds().some(e=>e.purpose===da.b.Screenshare))return null;const t=e.isScreensharing(),{primaryFeed:a,sidebarShown:n}=this.state,i=null==a?void 0:a.getMember().name;if(!i)return;let r=t?Object(N.a)("You are presenting"):Object(N.a)("%(sharerName)s is presenting",{sharerName:i});return n||(r+=" • "+(e.isLocalVideoMuted()?Object(N.a)("Your camera is turned off"):Object(N.a)("Your camera is still enabled"))),s.a.createElement("div",{className:"mx_LegacyCallView_toast"},r)}renderContent(){const{pipMode:e,call:t,onResize:a}=this.props,{isLocalOnHold:n,isRemoteOnHold:i,sidebarShown:r,primaryFeed:o,secondaryFeed:c,sidebarFeeds:d}=this.state,u=st.a.get().getRoom(t.roomId),m=e?76:160,h=F.b.instance.getTransfereeForCallId(t.callId),p=n||i;let g;if(r&&c&&!c.isVideoMuted()&&(g=s.a.createElement(ha,{feed:c,call:t,pipMode:e,onResize:a,secondary:!0})),h||p){const e=l()("mx_LegacyCallView_content",{mx_LegacyCallView_content_hold:p}),a=Object(pa.a)(t.getOpponentMember(),1024,1024,"crop");let r;if(h){const e=st.a.get().getRoom(F.b.instance.roomIdForCall(t)),a=e?e.name:Object(N.a)("unknown person"),n=st.a.get().getRoom(F.b.instance.roomIdForCall(h)),i=n?n.name:Object(N.a)("unknown person");r=s.a.createElement("div",{className:"mx_LegacyCallView_status"},Object(N.a)("Consulting with %(transferTarget)s. <a>Transfer to %(transferee)s</a>",{transferTarget:a,transferee:i},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:this.onTransferClick},e)}))}else{let e;i?e=Object(N.a)(F.b.instance.hasAnyUnheldCall()?Object(N.c)("You held the call <a>Switch</a>"):Object(N.c)("You held the call <a>Resume</a>"),{},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:this.onCallResumeClick},e)}):n&&(e=Object(N.a)("%(peerName)s held the call",{peerName:t.getOpponentMember().name})),r=s.a.createElement("div",{className:"mx_LegacyCallView_status"},e)}return s.a.createElement("div",{className:e,onMouseMove:this.onMouseMove},s.a.createElement("div",{className:"mx_LegacyCallView_holdBackground",style:{backgroundImage:"url("+a+")"}}),r)}return t.noIncomingFeeds()?s.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},s.a.createElement("div",{className:"mx_LegacyCallView_avatarsContainer"},s.a.createElement("div",{className:"mx_LegacyCallView_avatarContainer",style:{width:m,height:m}},s.a.createElement(be.a,{room:u,height:m,width:m}))),s.a.createElement("div",{className:"mx_LegacyCallView_status"},Object(N.a)("Connecting")),g):e?s.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},s.a.createElement(ha,{feed:o,call:t,pipMode:e,onResize:a,primary:!0})):c?s.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},s.a.createElement(ha,{feed:o,call:t,pipMode:e,onResize:a,primary:!0}),g):s.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},s.a.createElement(ha,{feed:o,call:t,pipMode:e,onResize:a,primary:!0}),r&&s.a.createElement(va,{feeds:d,call:t,pipMode:e}))}render(){const{call:e,secondaryCall:t,pipMode:a,showApps:n,onMouseDownOnHeader:i}=this.props,{sidebarShown:r,sidebarFeeds:o}=this.state,c=st.a.get(),d=F.b.instance.roomIdForCall(e),u=F.b.instance.roomIdForCall(t),m=c.getRoom(d),h=t?c.getRoom(u):null,p=l()({mx_LegacyCallView:!0,mx_LegacyCallView_pip:a,mx_LegacyCallView_large:!a,mx_LegacyCallView_sidebar:r&&0!==o.length&&!a,mx_LegacyCallView_belowWidget:n});return s.a.createElement("div",{className:p},s.a.createElement(ya,{onPipMouseDown:i,pipMode:a,callRooms:[m,h],onMaximize:this.onMaximizeClick}),s.a.createElement("div",{className:"mx_LegacyCallView_content_wrapper",ref:this.contentWrapperRef},this.renderToast(),this.renderContent(),this.renderCallControls()))}}var Ba=a(159),Va=a(225),za=a.n(Va),Wa=a(3),Ha=a(216);function Ga(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}class qa extends s.a.Component{constructor(e){super(e);const t=this.parseWidgetUrl(),a=st.a.get().getRoom(this.props.roomId);let n;a&&(n=a.getMember(this.props.creatorUserId)),this.state=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ga(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ga(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({widgetDomain:null,isWrapped:null,roomMember:n},t)}parseWidgetUrl(){const e=za.a.parse(this.props.url),t=new URLSearchParams(e.search);if(Ba.a.isScalarUrl(this.props.url)&&t&&t.get("url")){const e=za.a.parse(t.get("url"));return{widgetDomain:e.host||e.hostname,isWrapped:!0}}return{widgetDomain:e.host||e.hostname,isWrapped:!1}}render(){const e=lt.b.get().brand,t=this.state.roomMember?this.state.roomMember.name:this.props.creatorUserId,a=t===this.props.creatorUserId?null:this.props.creatorUserId,n=this.state.roomMember?s.a.createElement(ma.a,{member:this.state.roomMember,width:38,height:38}):s.a.createElement(ht.a,{name:this.props.creatorUserId,width:38,height:38}),i=s.a.createElement("div",null,Object(N.a)("Any of the following data may be shared:"),s.a.createElement("ul",null,s.a.createElement("li",null,Object(N.a)("Your display name")),s.a.createElement("li",null,Object(N.a)("Your avatar URL")),s.a.createElement("li",null,Object(N.a)("Your user ID")),s.a.createElement("li",null,Object(N.a)("Your theme")),s.a.createElement("li",null,Object(N.a)("%(brand)s URL",{brand:e})),s.a.createElement("li",null,Object(N.a)("Room ID")),s.a.createElement("li",null,Object(N.a)("Widget ID")))),r=s.a.createElement(Ha.a,{tooltip:i,tooltipClass:"mx_AppPermissionWarning_tooltip mx_Tooltip_dark"},s.a.createElement("span",{className:"mx_AppPermissionWarning_helpIcon"})),o=this.state.isWrapped?Object(N.a)("Using this widget may share data <helpIcon /> with %(widgetDomain)s & your integration manager.",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>r}):Object(N.a)("Using this widget may share data <helpIcon /> with %(widgetDomain)s.",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>r}),c=this.props.isRoomEncrypted?Object(N.a)("Widgets do not use message encryption."):null;return s.a.createElement("div",{className:"mx_AppPermissionWarning"},s.a.createElement("div",{className:"mx_AppPermissionWarning_row mx_AppPermissionWarning_bolder mx_AppPermissionWarning_smallText"},Object(N.a)("Widget added by")),s.a.createElement("div",{className:"mx_AppPermissionWarning_row"},n,s.a.createElement("h4",{className:"mx_AppPermissionWarning_bolder"},t),s.a.createElement("div",{className:"mx_AppPermissionWarning_smallText"},a)),s.a.createElement("div",{className:"mx_AppPermissionWarning_row mx_AppPermissionWarning_smallText"},o),s.a.createElement("div",{className:"mx_AppPermissionWarning_row mx_AppPermissionWarning_smallText"},Object(N.a)("This widget may use cookies.")," ",c),s.a.createElement("div",{className:"mx_AppPermissionWarning_row"},s.a.createElement(H.a,{kind:"primary_sm",onClick:this.props.onPermissionGranted},Object(N.a)("Continue"))))}}i()(qa,"defaultProps",{onPermissionGranted:()=>{}});var Ka=e=>s.a.createElement("div",{className:"mx_AppPermissionWarning"},s.a.createElement("div",{className:"mx_AppPermissionWarningImage"},s.a.createElement("img",{src:a(556).default,alt:""})),s.a.createElement("div",{className:"mx_AppPermissionWarningText"},s.a.createElement("span",{className:"mx_AppPermissionWarningTextLabel"},e.errorMsg||"Error"))),Ya=a(104),Ja=a(304),$a=a(7);function Qa(e){return document.getElementById(e)}class Xa extends s.a.Component{constructor(e){super(e),i()(this,"resizeObserver",void 0),i()(this,"dispatcherRef",void 0),i()(this,"childContainer",void 0),i()(this,"child",void 0),i()(this,"collectChildContainer",e=>{this.childContainer&&this.resizeObserver.unobserve(this.childContainer),this.childContainer=e,e&&this.resizeObserver.observe(e)}),i()(this,"collectChild",e=>{this.child=e,this.updateChild()}),i()(this,"onAction",e=>{"timeline_resize"===e.action?this.repositionChild():"logout"===e.action&&Xa.destroyElement(this.props.persistKey)}),i()(this,"repositionChild",()=>{this.updateChildPosition(this.child,this.childContainer)}),i()(this,"updateChildPosition",Object(k.throttle)((e,t)=>{if(!e||!t)return;const a=t.getBoundingClientRect();Object.assign(e.style,{zIndex:Object($a.s)(this.props.zIndex)?9:this.props.zIndex,position:"absolute",top:"0",left:"0",transform:`translateX(${a.left}px) translateY(${a.top}px)`,width:a.width+"px",height:a.height+"px"})},16,{trailing:!0,leading:!0})),this.resizeObserver=new ResizeObserver(this.repositionChild),window.addEventListener("resize",this.repositionChild),this.dispatcherRef=v.a.register(this.onAction),this.props.moveRef&&(this.props.moveRef.current=this.repositionChild)}static destroyElement(e){const t=Qa("mx_persistedElement_"+e);t&&t.remove()}static isMounted(e){return Boolean(Qa("mx_persistedElement_"+e))}componentDidMount(){this.updateChild(),this.renderApp()}componentDidUpdate(){this.updateChild(),this.renderApp()}componentWillUnmount(){this.updateChildVisibility(this.child,!1),this.resizeObserver.disconnect(),window.removeEventListener("resize",this.repositionChild),v.a.unregister(this.dispatcherRef)}updateChild(){this.updateChildPosition(this.child,this.childContainer),this.updateChildVisibility(this.child,!0)}renderApp(){const e=s.a.createElement(R.a.Provider,{value:st.a.get()},s.a.createElement("div",{ref:this.collectChild,style:this.props.style},this.props.children));Lt.a.render(e,function(e){let t=Qa(e);return t||(t=document.createElement("div"),t.id=e,document.body.appendChild(t)),t}("mx_persistedElement_"+this.props.persistKey))}updateChildVisibility(e,t){e&&(e.style.display=t?"block":"none")}render(){return s.a.createElement("div",{ref:this.collectChildContainer})}}var Za=a(182),en=a(8),tn=a(113),an=a(136),nn=a(125);var rn=a(203),sn=a(533),on=a(105),cn=a(115);class ln extends s.a.PureComponent{constructor(e){super(e),i()(this,"onAllow",()=>{this.onPermissionSelection(!0)}),i()(this,"onDeny",()=>{this.onPermissionSelection(!1)}),i()(this,"onRememberSelectionChange",e=>{this.setState({rememberSelection:e})}),this.state={rememberSelection:!1}}onPermissionSelection(e){this.state.rememberSelection&&(la.a.log(`Remembering ${this.props.widget.id} as allowed=${e} for OpenID`),it.b.instance.widgetPermissionStore.setOIDCState(this.props.widget,this.props.widgetKind,this.props.inRoomId,e?sn.a.Allowed:sn.a.Denied)),this.props.onFinished(e)}render(){return s.a.createElement(on.a,{className:"mx_WidgetOpenIDPermissionsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(N.a)("Allow this widget to verify your identity")},s.a.createElement("div",{className:"mx_WidgetOpenIDPermissionsDialog_content"},s.a.createElement("p",null,Object(N.a)("The widget will verify your user ID, but won't be able to perform actions for you:")),s.a.createElement("p",{className:"text-muted"},this.props.widget.templateUrl.split("?")[0].split("#")[0])),s.a.createElement(cn.a,{primaryButton:Object(N.a)("Continue"),onPrimaryButtonClick:this.onAllow,onCancel:this.onDeny,additive:s.a.createElement(rn.a,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this.onRememberSelectionChange,label:Object(N.a)("Remember this")})}))}}var dn=a(167);let un;!function(e){e.CanChangeViewedRoom="io.element.view_room",e.RequiresClient="io.element.requires_client"}(un||(un={}));class mn{static bylineFor(e){return e.kind===Wa.EventKind.State?e.keyStr?Object(N.a)("with state key %(stateKey)s",{stateKey:e.keyStr}):Object(N.a)("with an empty state key"):null}static for(e,t){if(mn.simpleCaps[e]){const a=mn.simpleCaps[e];if(a[t])return{primary:Object(N.a)(a[t])};if(a.generic)return{primary:Object(N.a)(a.generic)}}if(Object(Wa.isTimelineCapability)(e)){if(Object(Wa.isTimelineCapabilityFor)(e,Wa.Symbols.AnyRoom))return{primary:Object(N.a)("The above, but in any room you are joined or invited to as well")};{const t=Object(Wa.getTimelineRoomIDFromCapability)(e),a=st.a.get().getRoom(t);return{primary:Object(N.a)("The above, but in <Room /> as well",{},{Room:()=>{var e;return a?s.a.createElement(Ha.a,{tooltip:null!==(e=a.getCanonicalAlias())&&void 0!==e?e:t},s.a.createElement("b",null,a.name)):s.a.createElement("b",null,s.a.createElement("code",null,t))}})}}}const[a]=Wa.WidgetEventCapability.findEventCapabilities([e]);if(a){if(a.kind===Wa.EventKind.Event&&a.eventType===Z.b.RoomMessage)return mn.forRoomMessageCap(a,t);const e=a.kind===Wa.EventKind.State?mn.stateSendRecvCaps:mn.nonStateSendRecvCaps;if(e[a.eventType]){const n=e[a.eventType],i=n[t]||n.generic;if(i&&i[a.direction])return{primary:Object(N.a)(i[a.direction])}}return t===Wa.WidgetKind.Room?a.direction===Wa.EventDirection.Send?{primary:Object(N.a)("Send <b>%(eventType)s</b> events as you in this room",{eventType:a.eventType},{b:e=>s.a.createElement("b",null,e)}),byline:mn.bylineFor(a)}:{primary:Object(N.a)("See <b>%(eventType)s</b> events posted to this room",{eventType:a.eventType},{b:e=>s.a.createElement("b",null,e)}),byline:mn.bylineFor(a)}:a.direction===Wa.EventDirection.Send?{primary:Object(N.a)("Send <b>%(eventType)s</b> events as you in your active room",{eventType:a.eventType},{b:e=>s.a.createElement("b",null,e)}),byline:mn.bylineFor(a)}:{primary:Object(N.a)("See <b>%(eventType)s</b> events posted to your active room",{eventType:a.eventType},{b:e=>s.a.createElement("b",null,e)}),byline:mn.bylineFor(a)}}return{primary:Object(N.a)("The <b>%(capability)s</b> capability",{capability:e},{b:e=>s.a.createElement("b",null,e)})}}static forRoomMessageCap(e,t){if(!e.keyStr)return e.direction===Wa.EventDirection.Send?{primary:t===Wa.WidgetKind.Room?Object(N.a)("Send messages as you in this room"):Object(N.a)("Send messages as you in your active room")}:{primary:t===Wa.WidgetKind.Room?Object(N.a)("See messages posted to this room"):Object(N.a)("See messages posted to your active room")};switch(e.keyStr){case Z.d.Text:return e.direction===Wa.EventDirection.Send?{primary:t===Wa.WidgetKind.Room?Object(N.a)("Send text messages as you in this room"):Object(N.a)("Send text messages as you in your active room")}:{primary:t===Wa.WidgetKind.Room?Object(N.a)("See text messages posted to this room"):Object(N.a)("See text messages posted to your active room")};case Z.d.Emote:return e.direction===Wa.EventDirection.Send?{primary:t===Wa.WidgetKind.Room?Object(N.a)("Send emotes as you in this room"):Object(N.a)("Send emotes as you in your active room")}:{primary:t===Wa.WidgetKind.Room?Object(N.a)("See emotes posted to this room"):Object(N.a)("See emotes posted to your active room")};case Z.d.Image:return e.direction===Wa.EventDirection.Send?{primary:t===Wa.WidgetKind.Room?Object(N.a)("Send images as you in this room"):Object(N.a)("Send images as you in your active room")}:{primary:t===Wa.WidgetKind.Room?Object(N.a)("See images posted to this room"):Object(N.a)("See images posted to your active room")};case Z.d.Video:return e.direction===Wa.EventDirection.Send?{primary:t===Wa.WidgetKind.Room?Object(N.a)("Send videos as you in this room"):Object(N.a)("Send videos as you in your active room")}:{primary:t===Wa.WidgetKind.Room?Object(N.a)("See videos posted to this room"):Object(N.a)("See videos posted to your active room")};case Z.d.File:return e.direction===Wa.EventDirection.Send?{primary:t===Wa.WidgetKind.Room?Object(N.a)("Send general files as you in this room"):Object(N.a)("Send general files as you in your active room")}:{primary:t===Wa.WidgetKind.Room?Object(N.a)("See general files posted to this room"):Object(N.a)("See general files posted to your active room")};default:{let a;return a=e.direction===Wa.EventDirection.Send?t===Wa.WidgetKind.Room?Object(N.a)("Send <b>%(msgtype)s</b> messages as you in this room",{msgtype:e.keyStr},{b:e=>s.a.createElement("b",null,e)}):Object(N.a)("Send <b>%(msgtype)s</b> messages as you in your active room",{msgtype:e.keyStr},{b:e=>s.a.createElement("b",null,e)}):t===Wa.WidgetKind.Room?Object(N.a)("See <b>%(msgtype)s</b> messages posted to this room",{msgtype:e.keyStr},{b:e=>s.a.createElement("b",null,e)}):Object(N.a)("See <b>%(msgtype)s</b> messages posted to your active room",{msgtype:e.keyStr},{b:e=>s.a.createElement("b",null,e)}),{primary:a}}}}}i()(mn,"simpleCaps",{[Wa.MatrixCapabilities.AlwaysOnScreen]:{[Wa.WidgetKind.Room]:Object(N.c)("Remain on your screen when viewing another room, when running"),generic:Object(N.c)("Remain on your screen while running")},[Wa.MatrixCapabilities.StickerSending]:{[Wa.WidgetKind.Room]:Object(N.c)("Send stickers into this room"),generic:Object(N.c)("Send stickers into your active room")},[un.CanChangeViewedRoom]:{generic:Object(N.c)("Change which room you're viewing")},[Wa.MatrixCapabilities.MSC2931Navigate]:{generic:Object(N.c)("Change which room, message, or user you're viewing")}}),i()(mn,"stateSendRecvCaps",{[Z.b.RoomTopic]:{[Wa.WidgetKind.Room]:{[Wa.EventDirection.Send]:Object(N.c)("Change the topic of this room"),[Wa.EventDirection.Receive]:Object(N.c)("See when the topic changes in this room")},generic:{[Wa.EventDirection.Send]:Object(N.c)("Change the topic of your active room"),[Wa.EventDirection.Receive]:Object(N.c)("See when the topic changes in your active room")}},[Z.b.RoomName]:{[Wa.WidgetKind.Room]:{[Wa.EventDirection.Send]:Object(N.c)("Change the name of this room"),[Wa.EventDirection.Receive]:Object(N.c)("See when the name changes in this room")},generic:{[Wa.EventDirection.Send]:Object(N.c)("Change the name of your active room"),[Wa.EventDirection.Receive]:Object(N.c)("See when the name changes in your active room")}},[Z.b.RoomAvatar]:{[Wa.WidgetKind.Room]:{[Wa.EventDirection.Send]:Object(N.c)("Change the avatar of this room"),[Wa.EventDirection.Receive]:Object(N.c)("See when the avatar changes in this room")},generic:{[Wa.EventDirection.Send]:Object(N.c)("Change the avatar of your active room"),[Wa.EventDirection.Receive]:Object(N.c)("See when the avatar changes in your active room")}},[Z.b.RoomMember]:{[Wa.WidgetKind.Room]:{[Wa.EventDirection.Send]:Object(N.c)("Remove, ban, or invite people to this room, and make you leave"),[Wa.EventDirection.Receive]:Object(N.c)("See when people join, leave, or are invited to this room")},generic:{[Wa.EventDirection.Send]:Object(N.c)("Remove, ban, or invite people to your active room, and make you leave"),[Wa.EventDirection.Receive]:Object(N.c)("See when people join, leave, or are invited to your active room")}}}),i()(mn,"nonStateSendRecvCaps",{[Z.b.Sticker]:{[Wa.WidgetKind.Room]:{[Wa.EventDirection.Send]:Object(N.c)("Send stickers to this room as you"),[Wa.EventDirection.Receive]:Object(N.c)("See when a sticker is posted in this room")},generic:{[Wa.EventDirection.Send]:Object(N.c)("Send stickers to your active room as you"),[Wa.EventDirection.Receive]:Object(N.c)("See when anyone posts a sticker to your active room")}}});class hn extends s.a.PureComponent{constructor(e){super(e),i()(this,"eventPermissionsMap",new Map),i()(this,"onToggle",e=>{const t=Object(dn.e)(this.state.booleanStates);t[e]=!t[e],this.setState({booleanStates:t})}),i()(this,"onRememberSelectionChange",e=>{this.setState({rememberSelection:e})}),i()(this,"onSubmit",async e=>{this.closeAndTryRemember(Object.entries(this.state.booleanStates).filter(e=>{let[t,a]=e;return a}).map(e=>{let[t]=e;return t}))}),i()(this,"onReject",async e=>{this.closeAndTryRemember([])});Wa.WidgetEventCapability.findEventCapabilities(this.props.requestedCapabilities).forEach(e=>this.eventPermissionsMap.set(e.raw,e));const t={};this.props.requestedCapabilities.forEach(e=>t[e]=!0),this.state={booleanStates:t,rememberSelection:!0}}closeAndTryRemember(e){this.props.onFinished({approved:e,remember:this.state.rememberSelection})}render(){const e=Object.entries(this.state.booleanStates).sort((e,t)=>{let[a]=e,[n]=t;const i=Object(Wa.isTimelineCapability)(a),r=Object(Wa.isTimelineCapability)(n);return i||r?i&&!r?1:!i&&r?-1:i&&r?Object($a.v)(a,n):0:Object($a.v)(a,n)}).map((e,t)=>{let[a,n]=e;const i=mn.for(a,this.props.widgetKind),r=i.byline?s.a.createElement("span",{className:"mx_WidgetCapabilitiesPromptDialog_byline"},i.byline):null;return s.a.createElement("div",{className:"mx_WidgetCapabilitiesPromptDialog_cap",key:a+t},s.a.createElement(De.b,{checked:n,onChange:()=>this.onToggle(a)},i.primary),r)});return s.a.createElement(on.a,{className:"mx_WidgetCapabilitiesPromptDialog",onFinished:this.props.onFinished,title:Object(N.a)("Approve widget permissions")},s.a.createElement("form",{onSubmit:this.onSubmit},s.a.createElement("div",{className:"mx_Dialog_content"},s.a.createElement("div",{className:"text-muted"},Object(N.a)("This widget would like to:")),e,s.a.createElement(cn.a,{primaryButton:Object(N.a)("Approve"),cancelButton:Object(N.a)("Decline All"),onPrimaryButtonClick:this.onSubmit,onCancel:this.onReject,additive:s.a.createElement(rn.a,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this.onRememberSelectionChange,label:Object(N.a)("Remember my selection for this widget")})}))))}}const pn={};var gn=a(234),vn=a(312),fn=a(822);const bn=e=>{let{urls:t,username:a,credential:n}=e;return{uris:t,username:a,password:n}};class yn extends Wa.WidgetDriver{constructor(e,t,a,n,r){var s;if(super(),this.forWidget=t,this.forWidgetKind=a,this.inRoomId=r,i()(this,"allowedCapabilities",void 0),this.allowedCapabilities=new Set([...e,Wa.MatrixCapabilities.Screenshots,un.RequiresClient]),Za.a.JITSI.matches(this.forWidget.type)&&a===Wa.WidgetKind.Room)this.allowedCapabilities.add(Wa.MatrixCapabilities.AlwaysOnScreen);else if(Za.a.STICKERPICKER.matches(this.forWidget.type)&&a===Wa.WidgetKind.Account){const e=Wa.WidgetEventCapability.forRoomEvent(Wa.EventDirection.Send,Z.b.Sticker).raw;this.allowedCapabilities.add(Wa.MatrixCapabilities.StickerSending),this.allowedCapabilities.add(e),this.allowedCapabilities.add("visibility")}else if(n&&new URL(null!==(s=lt.b.get("element_call").url)&&void 0!==s?s:lt.a.element_call.url).origin===this.forWidget.origin){this.allowedCapabilities.add(Wa.MatrixCapabilities.AlwaysOnScreen),this.allowedCapabilities.add(Wa.MatrixCapabilities.MSC3846TurnServers),this.allowedCapabilities.add("org.matrix.msc2762.timeline:"+r),this.allowedCapabilities.add(Wa.WidgetEventCapability.forRoomEvent(Wa.EventDirection.Send,"org.matrix.rageshake_request").raw),this.allowedCapabilities.add(Wa.WidgetEventCapability.forRoomEvent(Wa.EventDirection.Receive,"org.matrix.rageshake_request").raw),this.allowedCapabilities.add(Wa.WidgetEventCapability.forStateEvent(Wa.EventDirection.Receive,Z.b.RoomMember).raw),this.allowedCapabilities.add(Wa.WidgetEventCapability.forStateEvent(Wa.EventDirection.Send,"org.matrix.msc3401.call").raw),this.allowedCapabilities.add(Wa.WidgetEventCapability.forStateEvent(Wa.EventDirection.Receive,"org.matrix.msc3401.call").raw),this.allowedCapabilities.add(Wa.WidgetEventCapability.forStateEvent(Wa.EventDirection.Send,"org.matrix.msc3401.call.member",st.a.get().getUserId()).raw),this.allowedCapabilities.add(Wa.WidgetEventCapability.forStateEvent(Wa.EventDirection.Receive,"org.matrix.msc3401.call.member").raw);const e=[Z.b.CallInvite,Z.b.CallCandidates,Z.b.CallAnswer,Z.b.CallHangup,Z.b.CallReject,Z.b.CallSelectAnswer,Z.b.CallNegotiate,Z.b.CallSDPStreamMetadataChanged,Z.b.CallSDPStreamMetadataChangedPrefix,Z.b.CallReplaces];for(const t of e)this.allowedCapabilities.add(Wa.WidgetEventCapability.forToDeviceEvent(Wa.EventDirection.Send,t).raw),this.allowedCapabilities.add(Wa.WidgetEventCapability.forToDeviceEvent(Wa.EventDirection.Receive,t).raw)}}async validateCapabilities(e){const t=(a=e,n=this.allowedCapabilities,Object(nn.a)(Array.from(a),Array.from(n)));var a,n;const i=new Set(t.removed),r=new Set(this.allowedCapabilities);var s;if((s=this.forWidget,JSON.parse(localStorage.getItem(`widget_${s.id}_approved_caps`)||"[]")).forEach(e=>{r.add(e),i.delete(e)}),pn.preapproveCapabilities){const t=await pn.preapproveCapabilities(this.forWidget,e);t&&t.forEach(e=>{r.add(e),i.delete(e)})}let o=!1;if(i.size>0)try{const[e]=await z.a.createDialog(hn,{requestedCapabilities:i,widget:this.forWidget,widgetKind:this.forWidgetKind}).finished;(e.approved||[]).forEach(e=>r.add(e)),o=e.remember}catch(e){la.a.error("Non-fatal error getting capabilities: ",e)}const c=new Set(function(e,t){return Object(nn.f)(Array.from(e),Array.from(t))}(r,e));return o&&function(e,t){localStorage.setItem(`widget_${e.id}_approved_caps`,JSON.stringify(t))}(this.forWidget,Array.from(c)),c}async sendEvent(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=st.a.get(),r=n||it.b.instance.roomViewStore.getRoomId();if(!i||!r)throw new Error("Not in a room or not attached to a client");let s=null;return null!==a?s=await i.sendStateEvent(r,e,t,a):e===Z.b.RoomRedaction?s=await i.redactEvent(r,t.redacts):(s=await i.sendEvent(r,e,t),e===Z.b.RoomMessage&&gn.CHAT_EFFECTS.forEach(e=>{if(Object(vn.containsEmoji)(t,e.emojis)){const a=t["m.relates_to"].rel_type!==an.d.name;f.b.getValue("feature_thread")&&!a||v.a.dispatch({action:"effects."+e.command})}})),{roomId:r,eventId:s.event_id}}async sendToDevice(e,t,a){const n=st.a.get();if(t){const e=await n.crypto.deviceList.downloadKeys(Object.keys(a),!1);await Promise.all(Object.entries(a).flatMap(t=>{let[a,i]=t;return Object.entries(i).map(async t=>{let[i,r]=t;"*"===i?await n.encryptAndSendToDevices(Object.values(e[a]).map(e=>({userId:a,deviceInfo:e})),r):await n.encryptAndSendToDevices([{userId:a,deviceInfo:e[a][i]}],r)})}))}else await n.queueToDevice({eventType:e,batch:Object.entries(a).flatMap(e=>{let[t,a]=e;return Object.entries(a).map(e=>{let[a,n]=e;return{userId:t,deviceId:a,payload:n}})})})}pickRooms(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=st.a.get();if(!t)throw new Error("Not attached to a client");return(e?e.includes(Wa.Symbols.AnyRoom)?t.getVisibleRooms():e.map(e=>t.getRoom(e)):[t.getRoom(it.b.instance.roomViewStore.getRoomId())]).filter(e=>!!e)}async readRoomEvents(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a=a>0?Math.min(a,Number.MAX_SAFE_INTEGER):Number.MAX_SAFE_INTEGER;const i=this.pickRooms(n),r=[];for(const n of i){const i=[],s=n.getLiveTimeline().getEvents();for(let n=s.length-1;n>0&&!(i.length>=a);n--){const a=s[n];a.getType()!==e||a.isState()||e===Z.b.RoomMessage&&t&&t!==a.getContent().msgtype||i.push(a)}i.forEach(e=>r.push(e.getEffectiveEvent()))}return r}async readStateEvents(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;a=a>0?Math.min(a,Number.MAX_SAFE_INTEGER):Number.MAX_SAFE_INTEGER;const i=this.pickRooms(n),r=[];for(const n of i){const i=[],s=n.currentState.events.get(e);if(s)if(""===t||t){const e=s.get(t);e&&i.push(e)}else i.push(...Array.from(s.values()));i.slice(0,a).forEach(e=>r.push(e.getEffectiveEvent()))}return r}async askOpenID(e){const t=it.b.instance.widgetPermissionStore.getOIDCState(this.forWidget,this.forWidgetKind,this.inRoomId),a=()=>st.a.get().getOpenIdToken();return t===sn.a.Denied?e.update({state:Wa.OpenIDRequestState.Blocked}):t===sn.a.Allowed?e.update({state:Wa.OpenIDRequestState.Allowed,token:await a()}):(e.update({state:Wa.OpenIDRequestState.PendingUserConfirmation}),void z.a.createDialog(ln,{widget:this.forWidget,widgetKind:this.forWidgetKind,inRoomId:this.inRoomId,onFinished:async t=>t?e.update({state:Wa.OpenIDRequestState.Allowed,token:await a()}):e.update({state:Wa.OpenIDRequestState.Blocked})}))}async navigate(e){Object(fn.a)(e)}async*getTurnServers(){const e=st.a.get();if(!e.pollingTurnServers||!e.getTurnServers().length)return;let t,a;const n=e=>{let[a]=e;return t(bn(a))},i=(e,t)=>{t&&a(e)};e.on(o.b.TurnServers,n),e.on(o.b.TurnServersError,i);try{const r=e.getTurnServers()[0];for(yield bn(r);;)yield await new Promise((e,n)=>{t=e,a=n})}finally{e.off(o.b.TurnServers,n),e.off(o.b.TurnServersError,i)}}async readEventRelations(e,t,a,n,i,r,s,o){var c,l;const d=st.a.get(),u=o;if("string"!=typeof(t=null!==(c=null!==(l=t)&&void 0!==l?l:it.b.instance.roomViewStore.getRoomId())&&void 0!==c?c:void 0))throw new Error("Error while reading the current room");const{events:m,nextBatch:h,prevBatch:p}=await d.relations(t,e,null!=a?a:null,null!=n?n:null,{from:i,to:r,limit:s,dir:u});return{chunk:m.map(e=>e.getEffectiveEvent()),nextBatch:h,prevBatch:p}}}var En=a(247),_n=a(253),wn=a(2),Sn=a(171);function On(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Cn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?On(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):On(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class xn extends r.PureComponent{constructor(e){super(e),i()(this,"widget",void 0),i()(this,"possibleButtons",void 0),i()(this,"appFrame",r.createRef()),i()(this,"state",{disabledButtonIds:(this.props.widgetDefinition.buttons||[]).filter(e=>e.disabled).map(e=>e.id)}),i()(this,"onReady",()=>{this.state.messaging.sendWidgetConfig(this.props.widgetDefinition)}),i()(this,"onLoad",()=>{this.state.messaging.once("ready",this.onReady),this.state.messaging.on("action:"+Wa.WidgetApiFromWidgetAction.CloseModalWidget,this.onWidgetClose),this.state.messaging.on("action:"+Wa.WidgetApiFromWidgetAction.SetModalButtonEnabled,this.onButtonEnableToggle)}),i()(this,"onWidgetClose",e=>{this.props.onFinished(!0,e.detail.data)}),i()(this,"onButtonEnableToggle",e=>{e.preventDefault();if(e.detail.data.button===Wa.BuiltInModalButtonID.Close||!this.possibleButtons.includes(e.detail.data.button))return this.state.messaging.transport.reply(e.detail,{error:{message:"Invalid button"}});let t;if(e.detail.data.enabled)t=Object(nn.b)(this.state.disabledButtonIds).filter(t=>t!==e.detail.data.button);else{const a=new Set(this.state.disabledButtonIds);a.add(e.detail.data.button),t=Array.from(a)}this.setState({disabledButtonIds:t}),this.state.messaging.transport.reply(e.detail,{})}),this.widget=new An(Cn(Cn({},this.props.widgetDefinition),{},{creatorUserId:st.a.get().getUserId(),id:"modal_"+this.props.sourceWidgetId})),this.possibleButtons=(this.props.widgetDefinition.buttons||[]).map(e=>e.id)}componentDidMount(){const e=new yn([],this.widget,Wa.WidgetKind.Modal,!1),t=new Wa.ClientWidgetApi(this.widget,this.appFrame.current,e);this.setState({messaging:t})}componentWillUnmount(){this.state.messaging.off("ready",this.onReady),this.state.messaging.off("action:"+Wa.WidgetApiFromWidgetAction.CloseModalWidget,this.onWidgetClose),this.state.messaging.stop()}render(){const e=this.widget.getCompleteUrl({widgetRoomId:this.props.widgetRoomId,currentUserId:st.a.get().getUserId(),userDisplayName:ut.a.instance.displayName,userHttpAvatarUrl:ut.a.instance.getHttpAvatarUrl(),clientId:"io.element.web",clientTheme:f.b.getValue("theme"),clientLanguage:Object(N.h)()}),t=new URL(e);t.searchParams.set("widgetId",this.widget.id),t.searchParams.set("parentUrl",window.location.href.split("#",2)[0]);const n=t.toString().replace(/%24/g,"$");let i;return this.props.widgetDefinition.buttons&&(i=this.props.widgetDefinition.buttons.slice(0,3).reverse().map(e=>{let t="secondary";switch(e.kind){case Wa.ModalButtonKind.Primary:t="primary";break;case Wa.ModalButtonKind.Secondary:t="primary_outline";break;case Wa.ModalButtonKind.Danger:t="danger"}const a=this.state.disabledButtonIds.includes(e.id);return r.createElement(H.a,{key:e.id,kind:t,onClick:()=>{this.state.messaging.notifyModalWidgetButtonClicked(e.id)},disabled:a},e.label)})),r.createElement(on.a,{title:this.props.widgetDefinition.name||Object(N.a)("Modal Widget"),className:"mx_ModalWidgetDialog",contentId:"mx_Dialog_content",onFinished:this.props.onFinished},r.createElement("div",{className:"mx_ModalWidgetDialog_warning"},r.createElement("img",{src:a(417).default,height:"16",width:"16",alt:""}),Object(N.a)("Data on this screen is shared with %(widgetDomain)s",{widgetDomain:t.hostname})),r.createElement("div",null,r.createElement("iframe",{title:this.widget.name,ref:this.appFrame,sandbox:"allow-forms allow-scripts allow-same-origin",src:n,onLoad:this.onLoad})),r.createElement("div",{className:"mx_ModalWidgetDialog_buttons"},i))}}function kn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function jn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kn(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class Rn extends Sn.a{constructor(){super(v.a,{}),i()(this,"modalInstance",null),i()(this,"openSourceWidgetId",null),i()(this,"openSourceWidgetRoomId",null),i()(this,"canOpenModalWidget",()=>!this.modalInstance),i()(this,"openModalWidget",(e,t,a)=>{this.modalInstance||(this.openSourceWidgetId=t.id,this.openSourceWidgetRoomId=a,this.modalInstance=z.a.createDialog(xn,{widgetDefinition:jn({},e),widgetRoomId:a,sourceWidgetId:t.id,onFinished:(e,n)=>{e?this.closeModalWidget(t,a,n):this.closeModalWidget(t,a,{"m.exited":!0}),this.openSourceWidgetId=null,this.openSourceWidgetRoomId=null,this.modalInstance=null}},null,!1,!0))}),i()(this,"closeModalWidget",(e,t,a)=>{if(this.modalInstance&&this.openSourceWidgetId===e.id&&this.openSourceWidgetRoomId===t){this.openSourceWidgetId=null,this.openSourceWidgetRoomId=null,this.modalInstance.close(),this.modalInstance=null;const n=En.a.instance.getMessaging(e,t);if(!n)return void la.a.error("No source widget messaging for modal widget");n.notifyModalWidgetClose(a)}})}static get instance(){return Rn.internalInstance}async onAction(e){}}i()(Rn,"internalInstance",(()=>{const e=new Rn;return e.start(),e})()),window.mxModalWidgetStore=Rn.instance;var In=a(427);const Tn={};var Nn=a(112),Dn=a(235);function Pn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Mn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Pn(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Pn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class An extends Wa.Widget{constructor(e){super(e),this.rawDefinition=e}get templateUrl(){var e;return Za.a.JITSI.matches(this.type)?Ba.a.getLocalJitsiWrapperUrl({forLocalRender:!0,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):super.templateUrl}get popoutTemplateUrl(){var e;return Za.a.JITSI.matches(this.type)?Ba.a.getLocalJitsiWrapperUrl({forLocalRender:!1,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):this.templateUrl}get rawData(){let e=super.rawData.conferenceId;if(void 0===e){e=new URL(super.templateUrl).searchParams.get("confId")}let t=super.rawData.domain;void 0===t&&(t="meet.element.io");let a=(new In.a).getEffectiveTheme();if(a.startsWith("custom-")){const e=Object(Ae.e)(a.slice(7));a=e.is_dark?"dark":"light"}return a=a.includes("light")?"light":"dark",Mn(Mn({},super.rawData),{},{theme:a,conferenceId:e,domain:t})}getCompleteUrl(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(Wa.runTemplate)(t?this.popoutTemplateUrl:this.templateUrl,Mn(Mn({},this.rawDefinition),{},{data:this.rawData}),e)}}class Ln extends en.EventEmitter{constructor(e){var t;super(),this.appTileProps=e,i()(this,"client",void 0),i()(this,"messaging",void 0),i()(this,"mockWidget",void 0),i()(this,"scalarToken",void 0),i()(this,"roomId",void 0),i()(this,"kind",void 0),i()(this,"virtual",void 0),i()(this,"readUpToMap",{}),i()(this,"onOpenModal",async e=>{e.preventDefault(),Rn.instance.canOpenModalWidget()?(Rn.instance.openModalWidget(e.detail.data,this.mockWidget,this.roomId),this.messaging.transport.reply(e.detail,{})):this.messaging.transport.reply(e.detail,{error:{message:"Unable to open modal at this time"}})}),i()(this,"onEvent",e=>{this.client.decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure()||this.feedEvent(e)}),i()(this,"onEventDecrypted",e=>{e.isDecryptionFailure()||this.feedEvent(e)}),i()(this,"onToDeviceEvent",async e=>{await this.client.decryptEventIfNeeded(e),e.isDecryptionFailure()||await this.messaging.feedToDevice(e.getEffectiveEvent(),e.isEncrypted())}),this.client=st.a.get();let a=e.app;a.creatorUserId||(a=Object(dn.e)(a),a.creatorUserId=this.client.getUserId()),this.mockWidget=new An(a),this.roomId=null===(t=e.room)||void 0===t?void 0:t.roomId,this.kind=e.userWidget?Wa.WidgetKind.Account:Wa.WidgetKind.Room,this.virtual=void 0===a.eventId}get eventListenerRoomId(){return this.roomId?this.roomId:it.b.instance.roomViewStore.getRoomId()}get widgetApi(){return this.messaging}get embedUrl(){return this.runUrlTemplate({asPopout:!1})}get popoutUrl(){return this.runUrlTemplate({asPopout:!0})}runUrlTemplate(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{asPopout:!1};const n=null!==(e=null==Tn||null===(t=Tn.provideVariables)||void 0===t?void 0:t.call(Tn))&&void 0!==e?e:{},i={widgetRoomId:this.roomId,currentUserId:this.client.getUserId(),userDisplayName:ut.a.instance.displayName,userHttpAvatarUrl:ut.a.instance.getHttpAvatarUrl(),clientId:"io.element.web",clientTheme:f.b.getValue("theme"),clientLanguage:Object(N.h)()},r=this.mockWidget.getCompleteUrl(Object.assign(i,n),null==a?void 0:a.asPopout),s=new URL(r);return null!=a&&a.asPopout||(s.searchParams.set("widgetId",this.mockWidget.id),s.searchParams.set("parentUrl",window.location.href.split("#",2)[0]),this.scalarToken&&s.searchParams.set("scalar_token",this.scalarToken)),s.toString().replace(/%24/g,"$")}get isManagedByManager(){return!!this.scalarToken}get started(){return!!this.messaging}startMessaging(e){if(this.started)return;const t=this.appTileProps.whitelistCapabilities||[],a=new yn(t,this.mockWidget,this.kind,this.virtual,this.roomId);this.messaging=new Wa.ClientWidgetApi(this.mockWidget,e,a),this.messaging.on("preparing",()=>this.emit("preparing")),this.messaging.on("ready",()=>{En.a.instance.storeMessaging(this.mockWidget,this.roomId,this.messaging),this.emit("ready")}),this.messaging.on("capabilitiesNotified",()=>this.emit("capabilitiesNotified")),this.messaging.on("action:"+Wa.WidgetApiFromWidgetAction.OpenModalWidget,this.onOpenModal),this.messaging.on("action:"+wn.a.JoinCall,()=>{var e;null===(e=Dn.r.instance().getCurrent())||void 0===e||e.stop()}),this.messaging.on("action:"+wn.a.ViewRoom,e=>{e.preventDefault();const t=(e.detail.data||{}).room_id;return t?this.messaging.hasCapability(un.CanChangeViewedRoom)?(v.a.dispatch({action:L.a.ViewRoom,room_id:t,metricsTrigger:"Widget"}),void this.messaging.transport.reply(e.detail,{})):this.messaging.transport.reply(e.detail,{error:{message:"This widget does not have permission for this action (denied)."}}):this.messaging.transport.reply(e.detail,{error:{message:"Room ID not supplied."}})});for(const e of this.client.getRooms()){var n;const t=(null===(n=e.getLiveTimeline())||void 0===n?void 0:n.getEvents())||[],a=t[t.length-1];a&&(this.readUpToMap[e.roomId]=a.getId())}this.client.on(o.b.Event,this.onEvent),this.client.on(tn.c.Decrypted,this.onEventDecrypted),this.client.on(o.b.ToDeviceEvent,this.onToDeviceEvent),this.messaging.on("action:"+Wa.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen,e=>{this.messaging.hasCapability(Wa.MatrixCapabilities.AlwaysOnScreen)&&(Ja.b.instance.setWidgetPersistence(this.mockWidget.id,this.roomId,e.detail.data.value),e.preventDefault(),this.messaging.transport.reply(e.detail,{}))}),this.messaging.on("action:"+Wa.WidgetApiFromWidgetAction.SendSticker,e=>{this.messaging.hasCapability(Wa.MatrixCapabilities.StickerSending)&&(e.preventDefault(),this.messaging.transport.reply(e.detail,{}),v.a.dispatch({action:"m.sticker",data:e.detail.data,widgetId:this.mockWidget.id}))}),Za.a.STICKERPICKER.matches(this.mockWidget.type)&&this.messaging.on("action:"+wn.a.OpenIntegrationManager,e=>{e.preventDefault(),this.messaging.transport.reply(e.detail,{}),v.a.dispatch({action:"stickerpicker_close"});const t=e.detail.data,a=null==t?void 0:t.integType,n=null==t?void 0:t.integId;_n.a.sharedInstance().getPrimaryManager().open(this.client.getRoom(it.b.instance.roomViewStore.getRoomId()),"type_"+a,n)}),Za.a.JITSI.matches(this.mockWidget.type)&&this.messaging.on("action:"+wn.a.HangupCall,e=>{var t;e.preventDefault(),null!==(t=e.detail.data)&&void 0!==t&&t.errorMessage&&z.a.createDialog(Nn.a,{title:Object(N.a)("Connection lost"),description:Object(N.a)("You were disconnected from the call. (Error: %(message)s)",{message:e.detail.data.errorMessage})}),this.messaging.transport.reply(e.detail,{})})}async prepare(){var e,t;if(await(null!==(e=null==Tn||null===(t=Tn.isReady)||void 0===t?void 0:t.call(Tn))&&void 0!==e?e:Promise.resolve()),this.scalarToken)return;const a=En.a.instance.getMessaging(this.mockWidget,this.roomId);a&&(this.messaging=a);try{if(Ba.a.isScalarUrl(this.mockWidget.templateUrl)){const e=_n.a.sharedInstance();if(e.hasManager()){const t=e.getPrimaryManager();if(Ba.a.isScalarUrl(t.apiUrl)){const e=t.getScalarClient();this.scalarToken=await e.getScalarToken()}}}}catch(e){la.a.error("Error preparing widget communications: ",e)}}stopMessaging(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{forceDestroy:!1};null!=e&&e.forceDestroy||!Ja.b.instance.getWidgetPersistence(this.mockWidget.id,this.roomId)?this.started&&(En.a.instance.stopMessaging(this.mockWidget,this.roomId),this.messaging=null,this.client.off(o.b.Event,this.onEvent),this.client.off(tn.c.Decrypted,this.onEventDecrypted),this.client.off(o.b.ToDeviceEvent,this.onToDeviceEvent)):la.a.log("Skipping destroy - persistent widget")}feedEvent(e){if(!this.messaging)return;const t=this.readUpToMap[e.getRoomId()];if(t){if(t===e.getId())return;let a=!0;const n=this.client.getRoom(e.getRoomId()).getLiveTimeline(),i=Object(nn.b)(n.getEvents()).reverse().slice(0,100);for(const n of i){if(n.getId()===t)break;if(n.getId()===e.getId()){a=!1;break}}if(a)return}this.readUpToMap[e.getRoomId()]=e.getId();const a=e.getEffectiveEvent();this.messaging.feedEvent(a,this.eventListenerRoomId).catch(e=>{la.a.error("Error sending event to widget: ",e)})}}var Un=a(109),Fn=a(123),Bn=a(183);function Vn(){return lt.b.get("audio_stream_url")}async function zn(e,t){const a=await async function(e){const t=await st.a.get().getOpenIdToken(),a=Vn()+"/createStream",n=await window.fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:e,openid_token:t})});return(await n.json()).stream_id}(t);await e.transport.send(wn.a.StartLiveStream,{rtmpStreamKey:"rtmp://audiostream.dummy/"+a})}const Wn=["onFinished","app","userWidget","onDeleteClick","onEditClick","showUnpin"];var Hn=e=>{var t;let{onFinished:a,app:n,userWidget:i,onDeleteClick:o,onEditClick:c,showUnpin:l}=e,d=ge()(e,Wn);const u=Object(r.useContext)(R.a),{room:m,roomId:h}=Object(r.useContext)(Un.b),p=En.a.instance.getMessagingForUid(Ba.a.getWidgetUid(n)),g=i||Ba.a.canUserModifyWidgets(h);let b;if(Vn()&&Za.a.JITSI.matches(n.type)){const e=async()=>{try{await zn(p,h)}catch(e){la.a.error("Failed to start livestream",e);const t=e.message||Object(N.a)("Unable to start audio streaming.");z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to start livestream"),description:t})}a()};b=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Start audio stream")})}const y=Bn.d.instance.getContainerWidgets(m,Bn.a.Top),E=y.findIndex(e=>e.id===n.id);let _,w;if(g&&Ba.a.isManagedByManager(n)){const e=()=>{c?c():Ba.a.editWidget(m,n),a()};_=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Edit")})}if(f.b.getValue("enableWidgetScreenshots")&&null!=p&&p.hasCapability(Wa.MatrixCapabilities.Screenshots)){const e=()=>{null==p||p.takeScreenshot().then(e=>{v.a.dispatch({action:"picture_snapshot",file:e.screenshot})}).catch(e=>{la.a.error("Failed to take screenshot: ",e)}),a()};w=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Take a picture")})}let S;if(o||g){const e=()=>{o?o():z.a.createDialog(Fn.a,{title:Object(N.a)("Delete Widget"),description:Object(N.a)("Deleting a widget removes it for all users in this room. Are you sure you want to delete this widget?"),button:Object(N.a)("Delete widget"),onFinished:e=>{e&&Ba.a.setRoomWidget(h,n.id)}}),a()};S=s.a.createElement(de.b,{onClick:e,label:i?Object(N.a)("Remove"):Object(N.a)("Remove for everyone")})}const O=void 0!==n.eventId&&null!==(t=f.b.getValue("allowedWidgets",h)[n.eventId])&&void 0!==t&&t||n.creatorUserId===u.getUserId(),C=Za.a.JITSI.matches(n.type);let x,k,j;if(!i&&!C&&O){const e=()=>{la.a.info("Revoking permission for widget to load: "+n.eventId);const e=f.b.getValue("allowedWidgets",h);void 0!==n.eventId&&(e[n.eventId]=!1);const t=f.b.firstSupportedLevel("allowedWidgets");f.b.setValue("allowedWidgets",h,t,e).catch(e=>{la.a.error(e)}),a()};x=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Revoke permissions")})}if(l&&E>0){const e=()=>{Bn.d.instance.moveWithinContainer(m,Bn.a.Top,n,-1),a()};k=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Move left")})}if(l&&E<y.length-1){const e=()=>{Bn.d.instance.moveWithinContainer(m,Bn.a.Top,n,1),a()};j=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Move right")})}return s.a.createElement(de.e,X()({},d,{chevronFace:ce.a.None,onFinished:a}),s.a.createElement(de.c,null,b,_,x,S,w,k,j))},Gn=a(131);const qn=["app","className","width","height"];var Kn=e=>{let{app:t,className:n,width:i=20,height:r=20}=e,o=ge()(e,qn),c=[a(1471).default];return t.type.includes("jitsi")?c=[a(1472).default]:t.type.includes("meeting")||t.type.includes("calendar")?c=[a(1473).default]:t.type.includes("pad")||t.type.includes("doc")||t.type.includes("calc")?c=[a(1474).default]:t.type.includes("clock")&&(c=[a(1475).default]),s.a.createElement(ht.a,X()({},o,{name:t.id,className:l()("mx_WidgetAvatar",n),url:t.avatar_url?Object(Gn.b)(t.avatar_url).getSquareThumbnailHttp(20):void 0,urls:c,width:i,height:r}))};function Yn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Jn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Yn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class $n extends s.a.Component{constructor(e){super(e),i()(this,"context",void 0),i()(this,"contextMenuButton",Object(r.createRef)()),i()(this,"iframe",void 0),i()(this,"allowedWidgetsWatchRef",void 0),i()(this,"persistKey",void 0),i()(this,"sgWidget",void 0),i()(this,"dispatcherRef",void 0),i()(this,"unmounted",void 0),i()(this,"watchUserReady",()=>{ut.a.instance.isProfileInfoFetched||ut.a.instance.once(mt.b,this.onUserReady)}),i()(this,"onUserReady",()=>{this.setState({isUserProfileReady:!0})}),i()(this,"hasPermissionToLoad",e=>{var t;if(this.usingLocalWidget())return!0;if(!e.room)return!0;const a=f.b.getValue("allowedWidgets",e.room.roomId);return void 0!==e.app.eventId&&null!==(t=a[e.app.eventId])&&void 0!==t&&t||e.userId===e.creatorUserId}),i()(this,"onMyMembership",(e,t)=>{var a;"leave"!==t&&"ban"!==t||e.roomId!==(null===(a=this.props.room)||void 0===a?void 0:a.roomId)||this.onUserLeftRoom()}),i()(this,"onAllowedWidgetsChange",()=>{const e=this.hasPermissionToLoad(this.props);var t;this.state.hasPermissionToLoad&&!e&&(Ja.b.instance.destroyPersistentWidget(this.props.app.id,this.props.app.roomId),Xa.destroyElement(this.persistKey),null===(t=this.sgWidget)||void 0===t||t.stopMessaging());this.setState({hasPermissionToLoad:e})}),i()(this,"iframeRefChange",e=>{this.iframe=e,this.unmounted||(e?this.startMessaging():this.resetWidget(this.props))}),i()(this,"onWidgetPreparing",()=>{this.setState({loading:!1})}),i()(this,"onWidgetCapabilitiesNotified",()=>{this.setState({requiresClient:this.sgWidget.widgetApi.hasCapability(un.RequiresClient)})}),i()(this,"onAction",e=>{var t;switch(e.action){case"m.sticker":e.widgetId===this.props.app.id&&this.sgWidget.widgetApi.hasCapability(Wa.MatrixCapabilities.StickerSending)?(v.a.dispatch({action:"post_sticker_message",data:Jn(Jn({},e.data),{},{threadId:this.props.threadId})}),v.a.dispatch({action:"stickerpicker_close"})):la.a.warn("Ignoring sticker message. Invalid capability");break;case L.a.AfterLeaveRoom:e.room_id===(null===(t=this.props.room)||void 0===t?void 0:t.roomId)&&this.onUserLeftRoom()}}),i()(this,"grantWidgetPermission",()=>{var e;const t=null===(e=this.props.room)||void 0===e?void 0:e.roomId;la.a.info("Granting permission for widget to load: "+this.props.app.eventId);const a=f.b.getValue("allowedWidgets",t);void 0!==this.props.app.eventId&&(a[this.props.app.eventId]=!0);const n=f.b.firstSupportedLevel("allowedWidgets");f.b.setValue("allowedWidgets",t,n,a).then(()=>{this.setState({hasPermissionToLoad:!0}),this.startWidget()}).catch(e=>{la.a.error(e)})}),i()(this,"onPopoutWidgetClick",()=>{Za.a.JITSI.matches(this.props.app.type)&&this.reload(),Object.assign(document.createElement("a"),{target:"_blank",href:this.sgWidget.popoutUrl,rel:"noreferrer noopener"}).click()}),i()(this,"onToggleMaximisedClick",()=>{if(!this.props.room)return;const e=Bn.d.instance.isInContainer(this.props.room,this.props.app,Bn.a.Center)?Bn.a.Top:Bn.a.Center;Bn.d.instance.moveToContainer(this.props.room,this.props.app,e)}),i()(this,"onMinimiseClicked",()=>{this.props.room&&Bn.d.instance.moveToContainer(this.props.room,this.props.app,Bn.a.Right)}),i()(this,"onContextMenuClick",()=>{this.setState({menuDisplayed:!0})}),i()(this,"closeContextMenu",()=>{this.setState({menuDisplayed:!1})}),this.props.miniMode||Ja.b.instance.dockWidget(this.props.app.id,this.props.app.roomId),this.persistKey="widget_"+Ba.a.getWidgetUid(this.props.app);try{this.sgWidget=new Ln(this.props),this.setupSgListeners()}catch(e){la.a.log("Failed to construct widget",e),this.sgWidget=null}this.state=this.getNewState(e)}onUserLeftRoom(){Ja.b.instance.getWidgetPersistence(this.props.app.id,this.props.app.roomId)&&(this.props.room&&it.b.instance.roomViewStore.getRoomId()!==this.props.room.roomId?this.endWidgetActions():Za.a.JITSI.matches(this.props.app.type)?this.reload():Ja.b.instance.destroyPersistentWidget(this.props.app.id,this.props.app.roomId))}determineInitialRequiresClientState(){try{const e=new An(this.props.app),t=En.a.instance.getMessaging(e,this.props.room.roomId);if(t)return t.hasCapability(un.RequiresClient)}catch{}return!0}getNewState(e){return{initialising:!0,loading:this.props.waitForIframeLoad&&!Xa.isMounted(this.persistKey),hasPermissionToLoad:this.hasPermissionToLoad(e),isUserProfileReady:ut.a.instance.isProfileInfoFetched,error:null,menuDisplayed:!1,widgetPageTitle:this.props.widgetPageTitle,requiresClient:this.determineInitialRequiresClientState()}}isMixedContent(){const e=window.location.protocol,t=za.a.parse(this.props.app.url).protocol;return"https:"===e&&"https:"!==t&&(la.a.warn("Refusing to load mixed-content app:",e,t,window.location,this.props.app.url),!0)}componentDidMount(){this.sgWidget&&this.state.hasPermissionToLoad&&this.startWidget(),this.watchUserReady(),this.props.room&&this.context.on(ee.d.MyMembership,this.onMyMembership),this.allowedWidgetsWatchRef=f.b.watchSetting("allowedWidgets",null,this.onAllowedWidgetsChange),this.dispatcherRef=v.a.register(this.onAction)}componentWillUnmount(){this.unmounted=!0,this.props.miniMode||Ja.b.instance.undockWidget(this.props.app.id,this.props.app.roomId),Ja.b.instance.isLive(this.props.app.id,this.props.app.roomId)||this.endWidgetActions(),this.dispatcherRef&&v.a.unregister(this.dispatcherRef),this.props.room&&this.context.off(ee.d.MyMembership,this.onMyMembership),f.b.unwatchSetting(this.allowedWidgetsWatchRef),ut.a.instance.removeListener(mt.b,this.onUserReady)}setupSgListeners(){this.sgWidget.on("preparing",this.onWidgetPreparing),this.sgWidget.on("capabilitiesNotified",this.onWidgetCapabilitiesNotified)}stopSgListeners(){this.sgWidget&&(this.sgWidget.off("preparing",this.onWidgetPreparing),this.sgWidget.off("capabilitiesNotified",this.onWidgetCapabilitiesNotified))}resetWidget(e){var t;null===(t=this.sgWidget)||void 0===t||t.stopMessaging(),this.stopSgListeners();try{this.sgWidget=new Ln(e),this.setupSgListeners(),this.startWidget()}catch(e){la.a.error("Failed to construct widget",e),this.sgWidget=null}}startWidget(){this.sgWidget.prepare().then(()=>{this.unmounted||this.setState({initialising:!1})})}startMessaging(){try{var e;null===(e=this.sgWidget)||void 0===e||e.startMessaging(this.iframe)}catch(e){la.a.error("Failed to start widget",e)}}UNSAFE_componentWillReceiveProps(e){e.app.url!==this.props.app.url&&(this.getNewState(e),this.state.hasPermissionToLoad&&this.resetWidget(e)),e.widgetPageTitle!==this.props.widgetPageTitle&&this.setState({widgetPageTitle:e.widgetPageTitle})}async endWidgetActions(){var e;this.iframe&&(this.iframe.src="about:blank"),Za.a.JITSI.matches(this.props.app.type)&&this.props.room&&F.b.instance.hangupCallApp(this.props.room.roomId),Xa.destroyElement(this.persistKey),Ja.b.instance.destroyPersistentWidget(this.props.app.id,this.props.app.roomId),null===(e=this.sgWidget)||void 0===e||e.stopMessaging({forceDestroy:!0})}formatAppTileName(){let e="No name";return this.props.app.name&&this.props.app.name.trim()&&(e=this.props.app.name.trim()),e}usingLocalWidget(){return Za.a.JITSI.matches(this.props.app.type)}getTileTitle(){const e=this.formatAppTileName(),t=s.a.createElement("span",null," - ");let a="";return this.state.widgetPageTitle&&this.state.widgetPageTitle!==this.formatAppTileName()&&(a=this.state.widgetPageTitle),s.a.createElement("span",null,s.a.createElement(Kn,{app:this.props.app}),s.a.createElement("b",null,e),s.a.createElement("span",null,a?t:"",a))}reload(){this.endWidgetActions().then(()=>{this.resetWidget(this.props),this.startMessaging(),this.iframe&&(this.iframe.src=this.sgWidget.embedUrl)})}render(){let e;const t="mx_AppTileBody"+(this.props.miniMode?"_mini  ":" "),a={};this.props.pointerEvents&&(a.pointerEvents=this.props.pointerEvents);const n=s.a.createElement("div",{className:"mx_AppLoading_spinner_fadeIn"},s.a.createElement(Ya.a,{message:Object(N.a)("Loading...")})),i=Ba.a.getWidgetName(this.props.app);if(null===this.sgWidget)e=s.a.createElement("div",{className:t,style:a},s.a.createElement(Ka,{errorMsg:Object(N.a)("Error loading Widget")}));else if(this.state.hasPermissionToLoad){if(this.state.initialising||!this.state.isUserProfileReady)e=s.a.createElement("div",{className:t+(this.state.loading?"mx_AppLoading":""),style:a},n);else if(this.isMixedContent())e=s.a.createElement("div",{className:t,style:a},s.a.createElement(Ka,{errorMsg:Object(N.a)("Error - Mixed content")}));else if(e=s.a.createElement("div",{className:t+(this.state.loading?"mx_AppLoading":""),style:a},this.state.loading&&n,s.a.createElement("iframe",{title:i,allow:"microphone; camera; encrypted-media; autoplay; display-capture; clipboard-write; clipboard-read;",ref:this.iframeRefChange,src:this.sgWidget.embedUrl,allowFullScreen:!0,sandbox:"allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-presentation allow-downloads"})),!this.props.userWidget){const t=101;e=s.a.createElement("div",{className:"mx_AppTile_persistedWrapper"},s.a.createElement(Xa,{zIndex:this.props.miniMode?t:9,persistKey:this.persistKey,moveRef:this.props.movePersistedElement},e))}}else{const n=this.context.isRoomEncrypted(this.props.room.roomId);e=s.a.createElement("div",{className:t,style:a},s.a.createElement(qa,{roomId:this.props.room.roomId,creatorUserId:this.props.creatorUserId,url:this.sgWidget.embedUrl,isRoomEncrypted:n,onPermissionGranted:this.grantWidgetPermission}))}let r,o;r=this.props.miniMode?{mx_AppTile_mini:!0}:this.props.fullWidth?{mx_AppTileFullWidth:!0}:{mx_AppTile:!0},r=l()(r),this.state.menuDisplayed&&(o=s.a.createElement(Hn,X()({},Object(ce.i)(this.contextMenuButton.current.getBoundingClientRect(),null),{app:this.props.app,onFinished:this.closeContextMenu,showUnpin:!this.props.userWidget,userWidget:this.props.userWidget,onEditClick:this.props.onEditClick,onDeleteClick:this.props.onDeleteClick})));const c=[];if(this.props.showLayoutButtons){const e=Bn.d.instance.isInContainer(this.props.room,this.props.app,Bn.a.Center),t=l()({mx_AppTileMenuBar_iconButton:!0,mx_AppTileMenuBar_iconButton_collapse:e,mx_AppTileMenuBar_iconButton_maximise:!e});c.push(s.a.createElement(H.a,{key:"toggleMaximised",className:t,title:e?Object(N.a)("Un-maximise"):Object(N.a)("Maximise"),onClick:this.onToggleMaximisedClick})),c.push(s.a.createElement(H.a,{key:"minimise",className:"mx_AppTileMenuBar_iconButton mx_AppTileMenuBar_iconButton_minimise",title:Object(N.a)("Minimise"),onClick:this.onMinimiseClicked}))}return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:r,id:this.props.app.id},this.props.showMenubar&&s.a.createElement("div",{className:"mx_AppTileMenuBar"},s.a.createElement("span",{className:"mx_AppTileMenuBarTitle",style:{pointerEvents:this.props.handleMinimisePointerEvents?"all":"none"}},this.props.showTitle&&this.getTileTitle()),s.a.createElement("span",{className:"mx_AppTileMenuBarWidgets"},c,this.props.showPopout&&!this.state.requiresClient&&s.a.createElement(H.a,{className:"mx_AppTileMenuBar_iconButton mx_AppTileMenuBar_iconButton_popout",title:Object(N.a)("Popout widget"),onClick:this.onPopoutWidgetClick}),s.a.createElement(ce.b,{className:"mx_AppTileMenuBar_iconButton mx_AppTileMenuBar_iconButton_menu",label:Object(N.a)("Options"),isExpanded:this.state.menuDisplayed,inputRef:this.contextMenuButton,onClick:this.onContextMenuClick}))),e),o)}}i()($n,"contextType",R.a),i()($n,"defaultProps",{waitForIframeLoad:!0,showMenubar:!0,showTitle:!0,showPopout:!0,handleMinimisePointerEvents:!1,userWidget:!1,miniMode:!1,threadId:null,showLayoutButtons:!0});var Qn=a(202);class Xn extends s.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"room",void 0),this.room=t.getRoom(this.props.persistentRoomId)}render(){const e=Qn.a.instance.get(this.props.persistentWidgetId,this.props.persistentRoomId);return e?s.a.createElement($n,{key:e.id,app:e,fullWidth:!0,room:this.room,userId:this.context.credentials.userId,creatorUserId:e.creatorUserId,widgetPageTitle:Ba.a.getWidgetDataTitle(e),waitForIframeLoad:e.waitForIframeLoad,miniMode:!0,showMenubar:!1,pointerEvents:this.props.pointerEvents,movePersistedElement:this.props.movePersistedElement}):null}}function Zn(e,t,a){return(1-(a=Object(k.clamp)(a,0,1)))*e+a*t}i()(Xn,"contextType",R.a);var ei=a(361);const ti=58,ai=58,ni=76,ii=8;class ri extends s.a.Component{constructor(){var e;super(...arguments),e=this,i()(this,"callViewWrapper",Object(r.createRef)()),i()(this,"initX",0),i()(this,"initY",0),i()(this,"desiredTranslationX",$.b.instance.windowWidth-ii-336),i()(this,"desiredTranslationY",$.b.instance.windowHeight-ai-232),i()(this,"translationX",this.desiredTranslationX),i()(this,"translationY",this.desiredTranslationY),i()(this,"moving",!1),i()(this,"scheduledUpdate",new ei.a(()=>this.animationCallback(),()=>requestAnimationFrame(()=>this.scheduledUpdate.trigger()))),i()(this,"animationCallback",()=>{var e,t;if(!this.moving&&Math.abs(this.translationX-this.desiredTranslationX)<=1&&Math.abs(this.translationY-this.desiredTranslationY)<=1)this.translationX=this.desiredTranslationX,this.translationY=this.desiredTranslationY,this.setStyle();else{const e=this.moving?.2:.1;this.translationX=Zn(this.translationX,this.desiredTranslationX,e),this.translationY=Zn(this.translationY,this.desiredTranslationY,e),this.setStyle(),this.scheduledUpdate.mark()}null===(e=(t=this.props).onMove)||void 0===e||e.call(t)}),i()(this,"setStyle",()=>{this.callViewWrapper.current&&(this.callViewWrapper.current.style.transform=`translateX(${this.translationX}px) translateY(${this.translationY}px)`)}),i()(this,"onResize",()=>{this.snap(!1)}),i()(this,"snap",(function(){var t,a;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const i=e.desiredTranslationX,r=e.desiredTranslationY,s=$.b.instance.windowWidth-((null===(t=e.callViewWrapper.current)||void 0===t?void 0:t.clientWidth)||336),o=$.b.instance.windowHeight-((null===(a=e.callViewWrapper.current)||void 0===a?void 0:a.clientHeight)||232);i>=s/2&&r>=o/2?(e.desiredTranslationX=s-ii,e.desiredTranslationY=o-ai):i>=s/2&&r<=o/2?(e.desiredTranslationX=s-ii,e.desiredTranslationY=ti):i<=s/2&&r>=o/2?(e.desiredTranslationX=ni,e.desiredTranslationY=o-ai):(e.desiredTranslationX=ni,e.desiredTranslationY=ti),n||(e.translationX=e.desiredTranslationX,e.translationY=e.desiredTranslationY),e.scheduledUpdate.mark()})),i()(this,"onStartMoving",e=>{e.preventDefault(),e.stopPropagation(),this.moving=!0,this.initX=e.pageX-this.desiredTranslationX,this.initY=e.pageY-this.desiredTranslationY,this.scheduledUpdate.mark()}),i()(this,"onMoving",e=>{this.moving&&(e.preventDefault(),e.stopPropagation(),this.setTranslation(e.pageX-this.initX,e.pageY-this.initY))}),i()(this,"onEndMoving",()=>{this.moving=!1,this.snap(!0)})}componentDidMount(){document.addEventListener("mousemove",this.onMoving),document.addEventListener("mouseup",this.onEndMoving),$.b.instance.on($.a.Resize,this.onResize)}componentWillUnmount(){document.removeEventListener("mousemove",this.onMoving),document.removeEventListener("mouseup",this.onEndMoving),$.b.instance.off($.a.Resize,this.onResize)}setTranslation(e,t){var a,n;const i=(null===(a=this.callViewWrapper.current)||void 0===a?void 0:a.clientWidth)||336,r=(null===(n=this.callViewWrapper.current)||void 0===n?void 0:n.clientHeight)||232;e+i>=$.b.instance.windowWidth?this.desiredTranslationX=$.b.instance.windowWidth-i:this.desiredTranslationX=e<=0?0:e,t+r>=$.b.instance.windowHeight?this.desiredTranslationY=$.b.instance.windowHeight-r:this.desiredTranslationY=t<=0?0:t}render(){const e={transform:`translateX(${this.translationX}px) translateY(${this.translationY}px)`};return s.a.createElement("aside",{className:this.props.className,style:e,ref:this.callViewWrapper,onDoubleClick:this.props.onDoubleClick},this.props.children({onStartMoving:this.onStartMoving,onResize:this.onResize}))}}var si=a(249);const oi=[ca.e.Connected,ca.e.InviteSent,ca.e.Connecting,ca.e.CreateAnswer,ca.e.CreateOffer,ca.e.WaitLocalMedia],ci=(e,t)=>{if(!e)return;if(!t)return;return[st.a.get().getRoom(t),Qn.a.instance.getApps(t).find(t=>t.id===e)]};function li(e){const t=F.b.instance.getAllActiveCallsForPip(e);let a=null,n=[];for(const e of t)oi.includes(e.state)&&(e.isRemoteOnHold()||null!==a?n.push(e):a=e);return null===a&&n.length>0&&(a=n[0],n=n.slice(1)),n.length>1&&la.a.log("Found more than 1 secondary call! Other calls will not be shown."),[a,n]}class di extends s.a.Component{constructor(e){super(e),i()(this,"movePersistedElement",Object(r.createRef)()),i()(this,"onMove",()=>{var e,t;return null===(e=(t=this.movePersistedElement).current)||void 0===e?void 0:e.call(t)}),i()(this,"onRoomViewStoreUpdate",()=>{var e,t;const a=it.b.instance.roomViewStore.getRoomId(),n=this.state.viewedRoomId;if(a===n)return;const i=null===(e=st.a.get())||void 0===e?void 0:e.getRoom(n);i&&Bn.d.instance.off(Bn.d.emissionForRoom(i),this.updateCalls);const r=null===(t=st.a.get())||void 0===t?void 0:t.getRoom(a);if(r&&Bn.d.instance.on(Bn.d.emissionForRoom(r),this.updateCalls),!a)return;const[s,o]=li(a);this.setState({viewedRoomId:a,primaryCall:s,secondaryCall:o[0]}),this.updateShowWidgetInPip()}),i()(this,"onWidgetPersistence",()=>{this.updateShowWidgetInPip(Ja.b.instance.getPersistentWidgetId(),Ja.b.instance.getPersistentRoomId())}),i()(this,"onWidgetDockChanges",()=>{this.updateShowWidgetInPip()}),i()(this,"updateCalls",()=>{if(!this.state.viewedRoomId)return;const[e,t]=li(this.state.viewedRoomId);this.setState({primaryCall:e,secondaryCall:t[0]}),this.updateShowWidgetInPip()}),i()(this,"onCallRemoteHold",()=>{if(!this.state.viewedRoomId)return;const[e,t]=li(this.state.viewedRoomId);this.setState({primaryCall:e,secondaryCall:t[0]})}),i()(this,"onDoubleClick",()=>{var e;const t=null===(e=this.state.primaryCall)||void 0===e?void 0:e.roomId;(null!=t?t:this.state.persistentRoomId)&&v.a.dispatch({action:L.a.ViewRoom,room_id:null!=t?t:this.state.persistentRoomId,metricsTrigger:"WebFloatingCallWindow"})}),i()(this,"onMaximize",()=>{const e=this.state.persistentWidgetId,t=this.state.persistentRoomId;if(this.state.showWidgetInPip&&e&&t){const[a,n]=ci(e,t);Bn.d.instance.moveToContainer(a,n,Bn.a.Center)}else v.a.dispatch({action:"video_fullscreen",fullscreen:!0})}),i()(this,"onPin",()=>{if(!this.state.showWidgetInPip)return;const[e,t]=ci(this.state.persistentWidgetId,this.state.persistentRoomId);Bn.d.instance.moveToContainer(e,t,Bn.a.Top)}),i()(this,"onExpand",()=>{this.state.persistentWidgetId&&this.state.showWidgetInPip&&v.a.dispatch({action:L.a.ViewRoom,room_id:this.state.persistentRoomId})}),i()(this,"onViewCall",()=>v.a.dispatch({action:L.a.ViewRoom,room_id:this.state.persistentRoomId,view_call:!0,metricsTrigger:void 0}));const t=it.b.instance.roomViewStore.getRoomId(),[a,n]=li(t);this.state={moving:!1,viewedRoomId:t,primaryCall:a,secondaryCall:n[0],persistentWidgetId:Ja.b.instance.getPersistentWidgetId(),persistentRoomId:Ja.b.instance.getPersistentRoomId(),showWidgetInPip:!1}}componentDidMount(){var e;F.b.instance.addListener(F.a.CallChangeRoom,this.updateCalls),F.b.instance.addListener(F.a.CallState,this.updateCalls),it.b.instance.roomViewStore.addListener(mt.b,this.onRoomViewStoreUpdate),st.a.get().on(ca.c.RemoteHoldUnhold,this.onCallRemoteHold);const t=null===(e=st.a.get())||void 0===e?void 0:e.getRoom(this.state.viewedRoomId);t&&Bn.d.instance.on(Bn.d.emissionForRoom(t),this.updateCalls),Ja.b.instance.on(Ja.a.Persistence,this.onWidgetPersistence),Ja.b.instance.on(Ja.a.Dock,this.onWidgetDockChanges),Ja.b.instance.on(Ja.a.Undock,this.onWidgetDockChanges),document.addEventListener("mouseup",this.onEndMoving.bind(this))}componentWillUnmount(){F.b.instance.removeListener(F.a.CallChangeRoom,this.updateCalls),F.b.instance.removeListener(F.a.CallState,this.updateCalls);const e=st.a.get();null==e||e.removeListener(ca.c.RemoteHoldUnhold,this.onCallRemoteHold),it.b.instance.roomViewStore.removeListener(mt.b,this.onRoomViewStoreUpdate);const t=null==e?void 0:e.getRoom(this.state.viewedRoomId);t&&Bn.d.instance.off(Bn.d.emissionForRoom(t),this.updateCalls),Ja.b.instance.off(Ja.a.Persistence,this.onWidgetPersistence),Ja.b.instance.off(Ja.a.Dock,this.onWidgetDockChanges),Ja.b.instance.off(Ja.a.Undock,this.onWidgetDockChanges),document.removeEventListener("mouseup",this.onEndMoving.bind(this))}onStartMoving(){this.setState({moving:!0})}onEndMoving(){this.setState({moving:!1})}updateShowWidgetInPip(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.persistentWidgetId,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.persistentRoomId,a=!1,n=!1;e&&st.a.get().getRoom(t)&&(n=!Ja.b.instance.isDocked(e,t),a=this.state.viewedRoomId!==t);const i=a||n;this.setState({showWidgetInPip:i,persistentWidgetId:e,persistentRoomId:t})}render(){let e;if(this.state.primaryCall&&(e=e=>{let{onStartMoving:t,onResize:a}=e;return s.a.createElement(Fa,{onMouseDownOnHeader:t,call:this.state.primaryCall,secondaryCall:this.state.secondaryCall,pipMode:!0,onResize:a})}),this.state.showWidgetInPip){const t=l()({mx_LegacyCallView:!0,mx_LegacyCallView_pip:!0,mx_LegacyCallView_large:!1}),a=this.state.persistentRoomId,n=st.a.get().getRoom(a),i=this.state.viewedRoomId===a,r=null!==si.a.instance.getActiveCall(a);e=e=>{let{onStartMoving:o}=e;return s.a.createElement("div",{className:t},s.a.createElement(ya,{onPipMouseDown:e=>{o(e),this.onStartMoving.bind(this)()},pipMode:!0,callRooms:[n],onExpand:r||i?void 0:this.onExpand,onPin:!r&&i?this.onPin:void 0,onMaximize:r?this.onViewCall:i?this.onMaximize:void 0}),s.a.createElement(Xn,{persistentWidgetId:this.state.persistentWidgetId,persistentRoomId:a,pointerEvents:this.state.moving?"none":void 0,movePersistedElement:this.movePersistedElement}))}}return this.props.voiceBroadcastRecording&&(e=e=>{let{onStartMoving:t}=e;return s.a.createElement("div",{onMouseDown:t},s.a.createElement(Dn.q,{recording:this.props.voiceBroadcastRecording}))}),e?s.a.createElement(ri,{className:"mx_LegacyCallPreview",draggable:!0,onDoubleClick:this.onDoubleClick,onMove:this.onMove},e):null}}var ui=e=>{const t=Dn.r.instance(),[a,n]=Object(r.useState)(t.getCurrent());return Object(ne.c)(t,Dn.s.CurrentChanged,e=>{n(e)}),s.a.createElement(di,X()({voiceBroadcastRecording:a},e))};class mi extends s.a.PureComponent{render(){return s.a.createElement("div",{className:"mx_PiPContainer"},s.a.createElement(ui,null))}}var hi=a(748);class pi extends r.PureComponent{constructor(e,t){super(e,t),i()(this,"onUpdateToasts",()=>{this.setState({toasts:hi.a.instance.components})}),this.state={toasts:hi.a.instance.components},hi.a.instance.on(mt.b,this.onUpdateToasts)}componentWillUnmount(){hi.a.instance.off(mt.b,this.onUpdateToasts)}render(){const e=this.state.toasts.map((e,t)=>r.createElement("div",{className:"mx_NonUrgentToastContainer_toast",key:"toast-"+t},r.createElement(e,{})));return r.createElement("div",{className:"mx_NonUrgentToastContainer",role:"alert"},e)}}let gi;!function(e){e.CloseDialog="close_dialog",e.HostSignupAccountDetails="host_signup_account_details",e.HostSignupAccountDetailsRequest="host_signup_account_details_request",e.Minimize="host_signup_minimize",e.Maximize="host_signup_maximize",e.SetupComplete="setup_complete"}(gi||(gi={}));class vi extends s.a.PureComponent{constructor(e){super(e),i()(this,"iframeRef",s.a.createRef()),i()(this,"config",void 0),i()(this,"messageHandler",async e=>{if(this.config.get("url").startsWith(e.origin))switch(e.data.action){case gi.HostSignupAccountDetailsRequest:this.onAccountDetailsRequest();break;case gi.Maximize:this.setState({minimized:!1});break;case gi.Minimize:this.setState({minimized:!0});break;case gi.SetupComplete:this.setState({completed:!0});break;case gi.CloseDialog:return this.closeDialog()}}),i()(this,"maximizeDialog",()=>{this.setState({minimized:!1}),this.sendMessage({action:gi.Maximize})}),i()(this,"minimizeDialog",()=>{this.setState({minimized:!0}),this.sendMessage({action:gi.Minimize})}),i()(this,"closeDialog",async()=>(window.removeEventListener("message",this.messageHandler),pt.instance.setHostSignupActive(!1))),i()(this,"onCloseClick",async()=>{if(this.state.completed)return this.closeDialog();z.a.createDialog(Fn.a,{title:Object(N.a)("Confirm abort of host creation"),description:Object(N.a)("Are you sure you wish to abort creation of the host? The process cannot be continued."),button:Object(N.a)("Abort"),onFinished:e=>{if(e)return this.closeDialog()}})}),i()(this,"sendMessage",e=>{this.iframeRef.current.contentWindow.postMessage(e,this.config.get("url"))}),i()(this,"onAccountDetailsDialogFinished",async e=>e?this.sendAccountDetails():this.closeDialog()),i()(this,"onAccountDetailsRequest",()=>{const e=this.config.get("cookie_policy_url"),t=this.config.get("privacy_policy_url"),a=this.config.get("terms_of_service_url"),n=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(N.a)("Continuing temporarily allows the %(hostSignupBrand)s setup process to access your account to fetch verified email addresses. This data is not stored.",{hostSignupBrand:this.config.get("brand")})),s.a.createElement("p",null,Object(N.a)("Learn more in our <privacyPolicyLink />, <termsOfServiceLink /> and <cookiePolicyLink />.",{},{cookiePolicyLink:()=>s.a.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},Object(N.a)("Cookie Policy")),privacyPolicyLink:()=>s.a.createElement("a",{href:t,target:"_blank",rel:"noreferrer noopener"},Object(N.a)("Privacy Policy")),termsOfServiceLink:()=>s.a.createElement("a",{href:a,target:"_blank",rel:"noreferrer noopener"},Object(N.a)("Terms of Service"))})));z.a.createDialog(Fn.a,{title:Object(N.a)("You should know"),description:n,button:Object(N.a)("Continue"),onFinished:this.onAccountDetailsDialogFinished})}),this.state={completed:!1,error:null,minimized:!1},this.config=lt.b.getObject("host_signup")}async sendAccountDetails(){const e=await st.a.get().getOpenIdToken();if(!e||!e.access_token)return la.a.warn("Failed to connect to homeserver for OpenID token."),void this.setState({completed:!0,error:Object(N.a)("Failed to connect to your homeserver. Please close this dialog and try again.")});this.sendMessage({action:gi.HostSignupAccountDetails,account:{accessToken:await st.a.get().getAccessToken(),name:ut.a.instance.displayName,openIdToken:e.access_token,serverName:await st.a.get().getDomain(),userLocalpart:await st.a.get().getUserIdLocalpart(),termsAccepted:!0}})}componentDidMount(){window.addEventListener("message",this.messageHandler)}componentWillUnmount(){if(pt.instance.isHostSignupActive)return this.closeDialog()}render(){return s.a.createElement("div",{className:l()({mx_Dialog_wrapper:!this.state.minimized})},s.a.createElement("div",{className:l()("mx_Dialog",{mx_HostSignupDialog_minimized:this.state.minimized,mx_HostSignupDialog:!this.state.minimized})},this.state.minimized&&s.a.createElement("div",{className:"mx_Dialog_header mx_Dialog_headerWithButton"},s.a.createElement("div",{className:"mx_Dialog_title"},Object(N.a)("%(hostSignupBrand)s Setup",{hostSignupBrand:this.config.get("brand")})),s.a.createElement(H.a,{className:"mx_HostSignup_maximize_button",onClick:this.maximizeDialog,"aria-label":Object(N.a)("Maximise dialog"),title:Object(N.a)("Maximise dialog")})),!this.state.minimized&&s.a.createElement("div",{className:"mx_Dialog_header mx_Dialog_headerWithCancel"},s.a.createElement(H.a,{onClick:this.minimizeDialog,className:"mx_HostSignup_minimize_button","aria-label":Object(N.a)("Minimise dialog"),title:Object(N.a)("Minimise dialog")}),s.a.createElement(H.a,{onClick:this.onCloseClick,className:"mx_Dialog_cancelButton","aria-label":Object(N.a)("Close dialog"),title:Object(N.a)("Close dialog")})),this.state.error&&s.a.createElement("div",null,this.state.error),!this.state.error&&s.a.createElement("iframe",{title:Object(N.a)("Upgrade to %(hostSignupBrand)s",{hostSignupBrand:this.config.get("brand")}),src:this.config.get("url"),ref:this.iframeRef,sandbox:"allow-forms allow-scripts allow-same-origin allow-popups"})))}}var fi=()=>{const[e,t]=Object(r.useState)(pt.instance.isHostSignupActive);return Object(ne.a)(pt.instance,mt.b,()=>{t(pt.instance.isHostSignupActive)}),s.a.createElement("div",{className:"mx_HostSignupContainer"},e&&s.a.createElement(vi,null))};class bi extends s.a.Component{constructor(e){super(e),i()(this,"element",Object(r.createRef)()),i()(this,"onAudioOutputChanged",e=>{const t=this.element.current;if(e)try{t.setSinkId(e)}catch(e){la.a.error("Couldn't set requested audio output device: using default",e),la.a.warn("Couldn't set requested audio output device: using default",e)}}),i()(this,"onNewStream",()=>{this.setState({audioMuted:this.props.feed.isAudioMuted()}),this.playMedia()}),this.state={audioMuted:this.props.feed.isAudioMuted()}}componentDidMount(){p.c.instance.addListener(p.a.AudioOutputChanged,this.onAudioOutputChanged),this.props.feed.addListener(ua.b.NewStream,this.onNewStream),this.playMedia()}componentWillUnmount(){p.c.instance.removeListener(p.a.AudioOutputChanged,this.onAudioOutputChanged),this.props.feed.removeListener(ua.b.NewStream,this.onNewStream),this.stopMedia()}async playMedia(){const e=this.element.current;if(e){this.onAudioOutputChanged(p.c.getAudioOutput()),e.muted=!1,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{await e.load()}catch(e){la.a.info(`Failed to play media element with feed for userId ${this.props.feed.userId} with purpose ${this.props.feed.purpose}`,e)}}}stopMedia(){const e=this.element.current;e&&(e.pause(),e.src=null)}render(){return this.state.audioMuted?null:s.a.createElement("audio",{ref:this.element})}}class yi extends s.a.Component{constructor(e){super(e),i()(this,"onFeedsChanged",()=>{this.setState({feeds:this.props.call.getRemoteFeeds()})}),this.state={feeds:this.props.call.getRemoteFeeds()}}componentDidMount(){this.props.call.addListener(ca.c.FeedsChanged,this.onFeedsChanged)}componentWillUnmount(){this.props.call.removeListener(ca.c.FeedsChanged,this.onFeedsChanged)}render(){return this.state.feeds.map((e,t)=>s.a.createElement(bi,{feed:e,key:t}))}}var Ei=a(145),_i=a(128),wi=a(339),Si=a(135),Oi=a(254),Ci=a(255),xi=a(385),ki=a(283);async function ji(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=st.a.get(),n={limit:10};void 0!==t&&(n.rooms=[t]);const i={search_categories:{room_events:{search_term:e,filter:n,order_by:xi.a.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}},r=await a.search({body:i});return{response:r,query:i}}async function Ri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=st.a.get(),n=await ji(e,t),i={_query:n.query,results:[],highlights:[]};return a.processRoomEventsSearch(i,n.response)}function Ii(e,t){const a=e.result,n=t.result;return a.origin_server_ts>n.origin_server_ts?-1:a.origin_server_ts<n.origin_server_ts?1:0}async function Ti(e){const t=st.a.get(),a=ji(e),n=Ni(e);await Promise.all([a,n]);const i=await n,r=await a,s=r.query,o=r.response,c=i.query,l=i.response,d={seshatQuery:c,_query:s,serverSideNextBatch:o.search_categories.room_events.next_batch,cachedEvents:[],oldestEventFrom:"server",results:[],highlights:[]},u={search_categories:{room_events:Li(d,l,o.search_categories.room_events)}},m=t.processRoomEventsSearch(d,u);return Ui(m.results),m}async function Ni(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=ki.a.get(),n={search_term:e,before_limit:1,after_limit:1,limit:10,order_by_recency:!0,room_id:void 0};void 0!==t&&(n.room_id=t);const i=await a.search(n);n.next_batch=i.next_batch;const r={response:i,query:n};return r}async function Di(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a={results:[],highlights:[]};if(""===e)return a;const n=await Ni(e,t);a.seshatQuery=n.query;const i={search_categories:{room_events:n.response}},r=st.a.get().processRoomEventsSearch(a,i);return Ui(r.results),r}function Pi(e,t){try{const a=e[e.length-1].result,n=t[t.length-1].result;return a.origin_server_ts<=n.origin_server_ts?-1:1}catch{return 0}}function Mi(e,t,a,n){const i=a.concat(n).sort(Ii);t.results=i.slice(0,10),e.cachedEvents=i.slice(10)}function Ai(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const n={},i=e.cachedEvents;let r=e.oldestEventFrom;return n.highlights=e.highlights,t&&a&&a.results?(Pi(t.results,a.results)<0&&(r="local"),Mi(e,n,t.results,a.results),n.highlights=t.highlights.concat(a.highlights)):t?(Pi(t.results,i)<0&&(r="local"),Mi(e,n,t.results,i)):a&&a.results?(Pi(a.results,i)<0&&(r="server"),Mi(e,n,a.results,i)):(n.results=i,e.cachedEvents=[]),e.oldestEventFrom=r,n}function Li(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const n=Ai(e,t,a);return e.count?n.count=e.count:n.count=t.count+a.count,t&&(e.seshatQuery.next_batch=t.next_batch),a&&(e.serverSideNextBatch=a.next_batch),e.seshatQuery.next_batch?n.next_batch=e.seshatQuery.next_batch:e.serverSideNextBatch&&(n.next_batch=e.serverSideNextBatch),!n.next_batch&&e.cachedEvents.length>0&&(n.next_batch="cached"),n}function Ui(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(let t=0;t<e.length;t++){const a=e[t].context.getTimeline();for(let e=0;e<a.length;e++){const t=a[e],n=t.event;n.curve25519Key&&(t.makeEncrypted(Z.b.RoomMessageEncrypted,{algorithm:n.algorithm},n.curve25519Key,n.ed25519Key),t.forwardingCurve25519KeyChain=n.forwardingCurve25519KeyChain,delete n.curve25519Key,delete n.ed25519Key,delete n.algorithm,delete n.forwardingCurve25519KeyChain)}}}function Fi(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return t=void 0!==a?st.a.get().isRoomEncrypted(a)?Di(e,a):Ri(e,a):Ti(e),t}function Bi(e){const t=st.a.get(),a=e.seshatQuery,n=e._query;if(a){if(n){const t=async function(e){const t=ki.a.get(),a=st.a.get(),n=e.seshatQuery,i=e.oldestEventFrom;let r,s,o;if(!n.next_batch||e.serverSideNextBatch&&"server"!==i||(r=await t.search(n)),e.serverSideNextBatch&&("local"===i||!n.next_batch)){const t={body:e._query,next_batch:e.serverSideNextBatch};s=await a.search(t)}s&&(o=s.search_categories.room_events);const c={search_categories:{room_events:Li(e,r,o)}},l=e.results?e.results.length:0,d=a.processRoomEventsSearch(e,c),u=d.results.length-l;return Ui(d.results.slice(Math.max(d.results.length-u,0))),e.pendingRequest=null,d}(e);return e.pendingRequest=t,t}{const t=async function(e){const t=ki.a.get(),a=e.seshatQuery,n=await t.search(a);e.seshatQuery.next_batch=n.next_batch;const i=n.results.length,r={search_categories:{room_events:n}},s=st.a.get().processRoomEventsSearch(e,r);return Ui(s.results.slice(Math.max(s.results.length-i,0))),e.pendingRequest=null,s}(e);return e.pendingRequest=t,t}}return t.backPaginateRoomEventsSearch(e)}var Vi=a(418);class zi extends s.a.Component{constructor(){super(...arguments),i()(this,"onResizeStart",()=>{this.props.resizeNotifier.startResizing()}),i()(this,"onResize",()=>{this.props.resizeNotifier.notifyRightHandleResized()}),i()(this,"onResizeStop",(e,t,a,n)=>{this.props.resizeNotifier.stopResizing(),window.localStorage.setItem("mx_rhs_size",(this.loadSidePanelSize().width+n.width).toString())})}loadSidePanelSize(){let e=parseInt(window.localStorage.getItem("mx_rhs_size"),10);return isNaN(e)&&(e=350),{height:"100%",width:e}}render(){const e=s.a.Children.only(this.props.children),t=this.props.panel;let a;return!this.props.collapsedRhs&&t&&(a=s.a.createElement(Vi.Resizable,{defaultSize:this.loadSidePanelSize(),minWidth:264,maxWidth:"50%",enable:{top:!1,right:!1,bottom:!1,left:!0,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,className:"mx_RightPanel_ResizeWrapper",handleClasses:{left:"mx_ResizeHandle_horizontal"}},t)),s.a.createElement("div",{className:"mx_MainSplit"},e,a)}}var Wi=a(160),Hi=a(151),Gi=a(143);function qi(e,t){const[a,n]=Object(r.useState)(t?e.isRoomEncrypted(t.roomId):void 0),i=Object(r.useCallback)(a=>{t&&a.getType()===Z.b.RoomEncryption&&n(e.isRoomEncrypted(t.roomId))},[e,t]);return Object(ne.c)(null==t?void 0:t.currentState,u.b.Events,i),a}var Ki=a(343);const Yi=e=>{let{className:t,title:a,children:n}=e;return s.a.createElement("div",{className:l()("mx_BaseCard_Group",t)},s.a.createElement("h1",null,a),n)};var Ji=Object(r.forwardRef)((e,t)=>{let a,{closeLabel:n,onClose:i,onBack:r,className:o,header:c,footer:d,withoutScrollContainer:u,children:m,onKeyDown:h}=e;const p=Gi.a.instance.roomPhaseHistory;if(p.length>1){var g;const e=p[p.length-2],t=e=>{null==r||r(e),Gi.a.instance.popCard()},n=null!==(g=Object(Hi.b)(e.phase))&&void 0!==g?g:Object(N.a)("Back");a=s.a.createElement(H.a,{className:"mx_BaseCard_back",onClick:t,title:n})}let v;return i&&(v=s.a.createElement(H.a,{"data-test-id":"base-card-close-button",className:"mx_BaseCard_close",onClick:i,title:n||Object(N.a)("Close")})),u||(m=s.a.createElement(bt.a,null,m)),s.a.createElement(Ki.a.Provider,{value:{isCard:!0}},s.a.createElement("div",{className:l()("mx_BaseCard",o),ref:t,onKeyDown:h},s.a.createElement("div",{className:"mx_BaseCard_header"},a,v,c),m,d&&s.a.createElement("div",{className:"mx_BaseCard_footer"},d)))}),$i=a(520),Qi=a(133);let Xi;!function(e){e.Warning="warning",e.Verified="verified",e.Normal="normal"}(Xi||(Xi={}));const Zi=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;const[a,n]=Object(r.useState)(e.getJoinedMemberCount());return Object(ne.c)(e.currentState,u.b.Update,Object(k.throttle)(()=>{n(e.getJoinedMemberCount())},t,{leading:!0,trailing:!0})),a},er=e=>{const[t,a]=Object(r.useState)(e.getMyMembership());return Object(ne.c)(e,ee.d.MyMembership,()=>{a(e.getMyMembership())}),t};var tr=a(579),ar=a(837),nr=a(838),ir=a(144);class rr{static isPinnable(e){return!!e&&(!!this.pinnableEventTypes.includes(e.getType())&&!e.isRedacted())}}i()(rr,"pinnableEventTypes",[Z.b.RoomMessage,ir.M_POLL_START.name,ir.M_POLL_START.altName]);var sr=a(218),or=a(292),cr=a(880),lr=a(138),dr=a(180);class ur extends s.a.Component{constructor(){super(...arguments),i()(this,"onTileClicked",()=>{v.a.dispatch({action:L.a.ViewRoom,event_id:this.props.event.getId(),highlighted:!0,room_id:this.props.event.getRoomId(),metricsTrigger:void 0})}),i()(this,"relations",new Map),i()(this,"getRelationsForEvent",(e,t,a)=>{var n;if(e===this.props.event.getId())return null===(n=this.relations.get(t))||void 0===n?void 0:n.get(a)})}async componentDidMount(){if(ir.M_POLL_START.matches(this.props.event.getType())){const e=this.props.event.getId(),t=this.props.event.getRoomId(),a=this.context.getRoom(t);try{await Promise.all([ir.M_POLL_RESPONSE.name,ir.M_POLL_RESPONSE.altName,ir.M_POLL_END.name,ir.M_POLL_END.altName].map(async n=>{const i=new or.a(Z.g.Reference,n,a);let r;i.setTargetEvent(this.props.event),this.relations.has(Z.g.Reference)||this.relations.set(Z.g.Reference,new Map),this.relations.get(Z.g.Reference).set(n,i);do{const a=await this.context.relations(t,e,Z.g.Reference,n,{from:r});r=a.nextBatch,a.events.forEach(e=>i.addEvent(e))}while(r)}))}catch(a){la.a.error(`Error fetching responses to pinned poll ${e} in room ${t}`),la.a.error(a)}}}render(){var e;const t=this.props.event.getSender();let a=null;return this.props.onUnpinClicked&&(a=s.a.createElement(q.a,{onClick:this.props.onUnpinClicked,className:"mx_PinnedEventTile_unpinButton",title:Object(N.a)("Unpin")})),s.a.createElement("div",{className:"mx_PinnedEventTile"},s.a.createElement(ma.a,{className:"mx_PinnedEventTile_senderAvatar",member:this.props.event.sender,width:24,height:24,fallbackUserId:t}),s.a.createElement("span",{className:"mx_PinnedEventTile_sender "+Object(dr.f)(t)},(null===(e=this.props.event.sender)||void 0===e?void 0:e.name)||t),a,s.a.createElement("div",{className:"mx_PinnedEventTile_message"},s.a.createElement(cr.a,{mxEvent:this.props.event,getRelationsForEvent:this.getRelationsForEvent,className:"mx_PinnedEventTile_body",maxImageHeight:150,onHeightChanged:()=>{},permalinkCreator:this.props.permalinkCreator,replacingEventId:this.props.event.replacingEventId()})),s.a.createElement("div",{className:"mx_PinnedEventTile_footer"},s.a.createElement("span",{className:"mx_MessageTimestamp mx_PinnedEventTile_timestamp"},Object(lr.b)(new Date(this.props.event.getTs()))),s.a.createElement(H.a,{onClick:this.onTileClicked,kind:"link"},Object(N.a)("View message"))))}}i()(ur,"contextType",R.a);var mr=a(316),hr=a(708);function pr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function gr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):pr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const vr=e=>{const[t,a]=Object(r.useState)([]),n=Object(r.useCallback)(t=>{var n,i;e&&(t&&t.getType()!==Z.b.RoomPinnedEvents||a((null===(n=e.currentState.getStateEvents(Z.b.RoomPinnedEvents,""))||void 0===n||null===(i=n.getContent())||void 0===i?void 0:i.pinned)||[]))},[e]);return Object(ne.c)(null==e?void 0:e.currentState,u.b.Events,n),Object(r.useEffect)(()=>(n(),()=>{a([])}),[n]),t},fr=e=>{const[t,a]=Object(r.useState)(new Set),n=Object(r.useCallback)(t=>{var n,i;if(!e)return;if(t&&t.getType()!==hr.a)return;const r=null===(n=e.getAccountData(hr.a))||void 0===n||null===(i=n.getContent())||void 0===i?void 0:i.event_ids;a(new Set(r||[]))},[e]);return Object(ne.c)(e,ee.d.AccountData,n),Object(r.useEffect)(()=>(n(),()=>{a(new Set)}),[n]),t};var br=e=>{let{room:t,onClose:a,permalinkCreator:n}=e;const i=Object(r.useContext)(R.a),o=Object(r.useContext)(Un.b),c=Object(mr.a)(t,e=>e.mayClientSendStateEvent(Z.b.RoomPinnedEvents,i)),l=vr(t),d=fr(t);Object(r.useEffect)(()=>{l.filter(e=>!d.has(e)).length>0&&i.setRoomAccountData(t.roomId,hr.a,{event_ids:l})},[i,t.roomId,l,d]);const u=Object(sr.a)(()=>{const e=l.map(async e=>{var a;const n=t.getUnfilteredTimelineSet(),r=null==n||null===(a=n.getTimelineForEvent(e))||void 0===a?void 0:a.getEvents().find(t=>t.getId()===e);if(r)return rr.isPinnable(r)?r:null;try{const[a,{events:[n]}]=await Promise.all([i.fetchRoomEvent(t.roomId,e),i.relations(t.roomId,e,Z.g.Replace,null,{limit:1})]),r=new tn.b(a);if(r.isEncrypted()&&await i.decryptEventIfNeeded(r),r&&rr.isPinnable(r))return r.sender=t.getMember(r.getSender()),n&&r.makeReplaced(n),r}catch(a){la.a.error("Error looking up pinned event "+e+" in room "+t.roomId),la.a.error(a)}return null});return Promise.all(e)},[i,t,l],null);let m;if(u)if(u.length>0){const e=async e=>{var a;const n=t.currentState.getStateEvents(Z.b.RoomPinnedEvents,"");if(null!=n&&null!==(a=n.getContent())&&void 0!==a&&a.pinned){const a=n.getContent().pinned,r=a.indexOf(e.getId());-1!==r&&(a.splice(r,1),await i.sendStateEvent(t.roomId,Z.b.RoomPinnedEvents,{pinned:a},""))}};m=u.filter(Boolean).reverse().map(t=>s.a.createElement(ur,{key:t.getId(),event:t,onUnpinClicked:c?()=>e(t):void 0,permalinkCreator:n}))}else m=s.a.createElement("div",{className:"mx_PinnedMessagesCard_empty_wrapper"},s.a.createElement("div",{className:"mx_PinnedMessagesCard_empty"},s.a.createElement("div",{className:"mx_MessageActionBar mx_PinnedMessagesCard_MessageActionBar"},s.a.createElement("div",{className:"mx_MessageActionBar_iconButton"},s.a.createElement(ar.a,null)),s.a.createElement("div",{className:"mx_MessageActionBar_iconButton"},s.a.createElement(nr.a,null)),s.a.createElement("div",{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_optionsButton"},s.a.createElement(tr.a,null))),s.a.createElement(na.a,{size:"h4",className:"mx_PinnedMessagesCard_empty_header"},Object(N.a)("Nothing pinned, yet")),Object(N.a)("If you have permissions, open the menu on any message and select <b>Pin</b> to stick them here.",{},{b:e=>s.a.createElement("b",null,e)})));else m=s.a.createElement(Ya.a,null);return s.a.createElement(Ji,{header:s.a.createElement("div",{className:"mx_BaseCard_header_title"},s.a.createElement(na.a,{size:"h4",className:"mx_BaseCard_header_title_heading"},Object(N.a)("Pinned messages"))),className:"mx_PinnedMessagesCard",onClose:a},s.a.createElement(Un.b.Provider,{value:gr(gr({},o),{},{timelineRenderingType:Un.a.Pinned})},m))},yr=a(252),Er=a(311),_r=a(862),wr=a(169),Sr=a(1476),Or=a(590),Cr=a(206);class xr extends Or.a{constructor(e,t,a,n){super(e,t,a,n),i()(this,"totalSize",0),i()(this,"messages",[])}get destinationFileName(){return this.makeFileNameNoExtension()+".json"}createJSONString(){var e,t,a,n,i,r,s;const o=Object(lr.g)(new Date),c=null===(e=this.room.currentState.getStateEvents(Z.b.RoomCreate,""))||void 0===e?void 0:e.getSender(),l=(null===(t=this.room)||void 0===t||null===(a=t.getMember(c))||void 0===a?void 0:a.rawDisplayName)||c,d=(null===(n=this.room.currentState.getStateEvents(Z.b.RoomTopic,""))||void 0===n||null===(i=n.getContent())||void 0===i?void 0:i.topic)||"",u=this.client.getUserId(),m=(null===(r=this.room)||void 0===r||null===(s=r.getMember(u))||void 0===s?void 0:s.rawDisplayName)||u,h={room_name:this.room.name,room_creator:l,topic:d,export_date:o,exported_by:m,messages:this.messages};return JSON.stringify(h,null,2)}async getJSONString(e){if(this.exportOptions.attachmentsIncluded&&this.isAttachment(e))try{const t=await this.getMediaBlob(e);if(this.totalSize+t.size<this.exportOptions.maxSize){this.totalSize+=t.size;const a=this.getFilePath(e);this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1),this.addFile(a,t)}}catch(e){la.a.log("Error fetching file: "+e)}const t=e.toJSON();return e.isEncrypted()?t.decrypted:t}async createOutput(e){for(let t=0;t<e.length;t++){const a=e[t];if(this.updateProgress(Object(N.a)("Processing event %(number)s out of %(total)s",{number:t+1,total:e.length}),!1,!0),this.cancelled)return this.cleanUp();Object(Cr.c)(a,!1)&&this.messages.push(await this.getJSONString(a))}return this.createJSONString()}async export(){la.a.info("Starting export process..."),la.a.info("Fetching events...");const e=performance.now(),t=await this.getRequiredEvents(),a=performance.now();la.a.log(`Fetched ${t.length} events in ${(a-e)/1e3}s`),la.a.info("Creating output...");const n=await this.createOutput(t);if(this.files.length)this.addFile("export.json",new Blob([n])),await this.downloadZIP();else{const e=this.destinationFileName;this.downloadPlainText(e,n)}const i=performance.now();this.cancelled?la.a.info("Export cancelled successfully"):(la.a.info("Export successful!"),la.a.log(`Exported ${t.length} events in ${(i-e)/1e3} seconds`)),this.cleanUp()}}var kr=a(294);class jr extends Or.a{constructor(e,t,a,n){super(e,t,a,n),i()(this,"totalSize",void 0),i()(this,"mediaOmitText",void 0),i()(this,"textForReplyEvent",e=>{const t=/> <(.*?)>(.*?)\n\n(.*)/s.exec(e.body);if(!t)return e.body;let a;const n=t[1],i=t[3];a=t[2].substring(1);const r=a.split("\n").filter(e=>!/^\s*$/.test(e));return r.length>0?(a=r[0].substring(0,32),r[0].length>32&&(a+="..."),a=` "${a}"`):a="",`<${n}${a}> ${i}`}),i()(this,"plainTextForEvent",async e=>{const t=e.sender&&e.sender.name?e.sender.name:e.getSender();let a="";if(this.isAttachment(e))if(this.exportOptions.attachmentsIncluded)try{const t=await this.getMediaBlob(e);if(this.totalSize+t.size>this.exportOptions.maxSize)a=` (${this.mediaOmitText})`;else{this.totalSize+=t.size;const n=this.getFilePath(e);a=" ("+Object(N.a)("File Attached")+")",this.addFile(n,t),this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1)}}catch(e){a=" ("+Object(N.a)("Error fetching file")+")",la.a.log("Error fetching file "+e)}else a=` (${this.mediaOmitText})`;return this.isReply(e)?t+": "+this.textForReplyEvent(e.getContent())+a:Object(kr.b)(e)+a}),this.totalSize=0,this.mediaOmitText=this.exportOptions.attachmentsIncluded?Object(N.a)("Media omitted - file size limit exceeded"):Object(N.a)("Media omitted")}get destinationFileName(){return this.makeFileNameNoExtension()+".txt"}async createOutput(e){let t="";for(let a=0;a<e.length;a++){const n=e[a];if(this.updateProgress(Object(N.a)("Processing event %(number)s out of %(total)s",{number:a+1,total:e.length}),!1,!0),this.cancelled)return this.cleanUp();if(!Object(Cr.c)(n,!1))continue;const i=await this.plainTextForEvent(n);t+=i&&`${new Date(n.getTs()).toLocaleString()} - ${i}\n`}return t}async export(){this.updateProgress(Object(N.a)("Starting export process...")),this.updateProgress(Object(N.a)("Fetching events..."));const e=performance.now(),t=await this.getRequiredEvents(),a=performance.now();la.a.log(`Fetched ${t.length} events in ${(a-e)/1e3}s`),this.updateProgress(Object(N.a)("Creating output..."));const n=await this.createOutput(t);if(this.files.length)this.addFile("export.txt",new Blob([n])),await this.downloadZIP();else{const e=this.destinationFileName;this.downloadPlainText(e,n)}const i=performance.now();this.cancelled?la.a.info("Export cancelled successfully"):(la.a.info("Export successful!"),la.a.log(`Exported ${t.length} events in ${(i-e)/1e3} seconds`)),this.cleanUp()}}var Rr=a(196);var Ir=()=>({});const Tr=(e,t)=>a=>"number"==typeof a&&!(isNaN(a)||e>a||a>t);var Nr=e=>{let{room:t,onFinished:a}=e;const{exportFormat:n,exportType:i,includeAttachments:o,numberOfMessages:c,sizeLimit:l,setExportFormat:d,setExportType:u,setNumberOfMessages:m,setSizeLimit:h,setAttachments:p}=(()=>{var e,t,a,n,i;const s=Ir(),[o,c]=Object(r.useState)(null!==(e=s.format)&&void 0!==e?e:_r.a.Html),[l,d]=Object(r.useState)(null!==(t=s.range)&&void 0!==t?t:_r.b.Timeline),[u,m]=Object(r.useState)(null!==(a=s.includeAttachments)&&void 0!==a&&a),[h,p]=Object(r.useState)(null!==(n=s.numberOfMessages)&&void 0!==n?n:100),[g,v]=Object(r.useState)(null!==(i=s.sizeMb)&&void 0!==i?i:8);return{exportFormat:o,exportType:l,includeAttachments:u,numberOfMessages:h,sizeLimit:g,setExportFormat:s.format?void 0:c,setExportType:s.range?void 0:d,setNumberOfMessages:s.numberOfMessages?void 0:p,setSizeLimit:s.sizeMb?void 0:v,setAttachments:void 0===s.includeAttachments?m:void 0}})(),[g,v]=Object(r.useState)(!1),f=Object(r.useRef)(),b=Object(r.useRef)(),[y,E]=Object(r.useState)(Object(N.a)("Processing...")),[_,w]=Object(r.useState)(!1),[S,O]=Object(r.useState)(!1),[C,x]=Object(r.useState)(!1),[k,j]=((e,t)=>{const[a,n]=Object(r.useState)(e);return[a,e=>{n(e),t(e)}]})(null,async e=>{await(null==e?void 0:e.export().then(()=>{S||x(!0)}))}),R=async()=>{if(!h||await f.current.validate({focused:!1})){if(i===_r.b.LastNMessages){if(!await b.current.validate({focused:!1}))return void b.current.validate({focused:!0})}v(!0),await(async()=>{const e={numberOfMessages:c,attachmentsIncluded:o,maxSize:1024*l*1024};switch(n){case _r.a.Html:j(new Sr.a(t,_r.b[i],e,E));break;case _r.a.Json:j(new xr(t,_r.b[i],e,E));break;case _r.a.PlainText:j(new jr(t,_r.b[i],e,E));break;default:return void la.a.error("Unknown export format")}})()}else f.current.validate({focused:!0})},I=Object(wr.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(N.a)("Enter a number between %(min)s and %(max)s",{min:1,max:2e3})},{key:"number",test:e=>{let{value:t}=e;const a=parseInt(t,10);return Tr(1,2e3)(a)},invalid:()=>Object(N.a)("Size can only be a number between %(min)s MB and %(max)s MB",{min:1,max:2e3})}]}),T=async e=>await I(e),D=Object(wr.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(N.a)("Enter a number between %(min)s and %(max)s",{min:1,max:10**8})},{key:"number",test:e=>{let{value:t}=e;const a=parseInt(t,10);return Tr(1,10**8)(a)},invalid:()=>Object(N.a)("Number of messages can only be a number between %(min)s and %(max)s",{min:1,max:10**8})}]}),P=async e=>await D(e),M=async()=>{g?w(!0):a(!1)},A=async()=>{await(null==k?void 0:k.cancelExport()),O(!0),v(!1),j(null)},L=Object.keys(_r.a).map(e=>({value:_r.a[e],label:Object(_r.c)(_r.a[e])})),U=Object.keys(_r.b).map(e=>s.a.createElement("option",{key:e,value:_r.b[e]},Object(_r.d)(_r.b[e])));let F=null;i===_r.b.LastNMessages&&m&&(F=s.a.createElement(Sa.a,{id:"message-count",element:"input",type:"number",value:c.toString(),ref:b,onValidate:P,label:Object(N.a)("Number of messages"),onChange:e=>{m(parseInt(e.target.value))}}));const B=s.a.createElement("span",null,Object(N.a)("MB"));return S?s.a.createElement(Rr.a,{title:Object(N.a)("Export Cancelled"),description:Object(N.a)("The export was cancelled successfully"),hasCloseButton:!0,onFinished:a}):C?s.a.createElement(Rr.a,{title:Object(N.a)("Export Successful"),description:Object(N.a)("Your export was successful. Find it in your Downloads folder."),hasCloseButton:!0,onFinished:a}):_?s.a.createElement(on.a,{title:Object(N.a)("Warning"),className:"mx_ExportDialog",contentId:"mx_Dialog_content",onFinished:a,fixedWidth:!0},s.a.createElement("p",null,Object(N.a)("Are you sure you want to stop exporting your data? If you do, you'll need to start over.")),s.a.createElement(cn.a,{primaryButton:Object(N.a)("Stop"),primaryButtonClass:"danger",hasCancel:!0,cancelButton:Object(N.a)("Continue"),onCancel:()=>w(!1),onPrimaryButtonClick:A})):s.a.createElement(on.a,{title:g?Object(N.a)("Exporting your data"):Object(N.a)("Export Chat"),className:"mx_ExportDialog "+(g&&"mx_ExportDialog_Exporting"),contentId:"mx_Dialog_content",hasCancel:!0,onFinished:a,fixedWidth:!0},g?null:s.a.createElement("p",null,Object(N.a)("Select from the options below to export chats from your timeline")),s.a.createElement("div",{className:"mx_ExportDialog_options"},!!d&&s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{className:"mx_ExportDialog_subheading"},Object(N.a)("Format")),s.a.createElement(Er.a,{name:"exportFormat",value:n,onChange:e=>d(_r.a[e]),definitions:L})),!!u&&s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{className:"mx_ExportDialog_subheading"},Object(N.a)("Messages")),s.a.createElement(Sa.a,{id:"export-type",element:"select",value:i,onChange:e=>{u(_r.b[e.target.value])}},U),F),h&&s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{className:"mx_ExportDialog_subheading"},Object(N.a)("Size Limit")),s.a.createElement(Sa.a,{id:"size-limit",type:"number",autoComplete:"off",onValidate:T,element:"input",ref:f,value:l.toString(),postfixComponent:B,onChange:e=>h(parseInt(e.target.value))})),p&&s.a.createElement(s.a.Fragment,null,s.a.createElement(De.b,{className:"mx_ExportDialog_attachments-checkbox",id:"include-attachments",checked:o,onChange:e=>p(e.target.checked)},Object(N.a)("Include Attachments")))),g?s.a.createElement("div",{"data-test-id":"export-progress",className:"mx_ExportDialog_progress"},s.a.createElement(Ya.a,{w:24,h:24}),s.a.createElement("p",null,y),s.a.createElement(cn.a,{primaryButton:Object(N.a)("Cancel"),primaryButtonClass:"danger",hasCancel:!1,onPrimaryButtonClick:M})):s.a.createElement(cn.a,{primaryButton:Object(N.a)("Export"),onPrimaryButtonClick:R,onCancel:()=>a(!1)}))};const Dr=e=>{let{children:t,className:a,onClick:n}=e;return s.a.createElement(H.a,{className:l()("mx_BaseCard_Button mx_RoomSummaryCard_Button",a),onClick:n},t)},Pr=e=>{const[t,a]=Object(r.useState)(()=>Qn.a.instance.getApps(e.roomId)),n=Object(r.useCallback)(()=>{a([...Qn.a.instance.getApps(e.roomId)])},[e]);return Object(r.useEffect)(n,[e,n]),Object(ne.a)(Qn.a.instance,e.roomId,n),Object(ne.a)(Bn.d.instance,Bn.d.emissionForRoom(e),n),t},Mr=e=>{let{app:t,room:a}=e;const n=Ba.a.getWidgetName(t),i=Ba.a.getWidgetDataTitle(t),o=i&&" - "+i,[c,d]=Object(r.useState)();Object(r.useEffect)(()=>{d(Ba.a.canUserModifyWidgets(a.roomId))},[a.roomId]);const u=Bn.d.instance.isInContainer(a,t,Bn.a.Top),m=u?()=>{Bn.d.instance.moveToContainer(a,t,Bn.a.Right)}:()=>{Bn.d.instance.moveToContainer(a,t,Bn.a.Top)},[h,p,g,v]=Object(ce.p)();let f;if(h){const e=p.current.getBoundingClientRect();f=s.a.createElement(Hn,{chevronFace:ce.a.None,right:$.b.instance.windowWidth-e.right,bottom:$.b.instance.windowHeight-e.top,onFinished:v,app:t})}const b=!u&&!Bn.d.instance.canAddToContainer(a,Bn.a.Top);let y;y=b?Object(N.a)("You can only pin up to %(count)s widgets",{count:Bn.b}):u?Object(N.a)("Unpin"):Object(N.a)("Pin");const E=Bn.d.instance.isInContainer(a,t,Bn.a.Center),_=E?()=>{Bn.d.instance.moveToContainer(a,t,Bn.a.Right)}:()=>{Bn.d.instance.moveToContainer(a,t,Bn.a.Center)},w=E?Object(N.a)("Close"):Object(N.a)("Maximise");let S="";u?S=Object(N.a)("Unpin this widget to view it in this panel"):E&&(S=Object(N.a)("Close this widget to view it in this panel"));const O=l()("mx_BaseCard_Button mx_RoomSummaryCard_Button",{mx_RoomSummaryCard_Button_pinned:u,mx_RoomSummaryCard_Button_maximised:E});return s.a.createElement("div",{className:O,ref:p},s.a.createElement(q.a,{className:"mx_RoomSummaryCard_icon_app",onClick:()=>{Gi.a.instance.pushCard({phase:Hi.a.Widget,state:{widgetId:t.id}})},title:S,forceHide:!(u||E),disabled:u||E},s.a.createElement(Kn,{app:t}),s.a.createElement("span",null,n),o),c&&s.a.createElement(ce.c,{className:"mx_RoomSummaryCard_app_options",isExpanded:h,onClick:g,title:Object(N.a)("Options")}),s.a.createElement(q.a,{className:"mx_RoomSummaryCard_app_pinToggle",onClick:m,title:y,disabled:b}),s.a.createElement(q.a,{className:"mx_RoomSummaryCard_app_maximiseToggle",onClick:_,title:w}),f)},Ar=e=>{let{room:t}=e;const a=Pr(t),n=Object(r.useMemo)(()=>a.filter(e=>void 0!==e.eventId),[a]);let i=null;return n.length>0&&Bn.d.instance.canCopyLayoutToRoom(t)&&(i=s.a.createElement(H.a,{kind:"link",onClick:()=>Bn.d.instance.copyLayoutToRoom(t)},Object(N.a)("Set my room layout for everyone"))),s.a.createElement(Yi,{className:"mx_RoomSummaryCard_appsGroup",title:Object(N.a)("Widgets")},n.map(e=>s.a.createElement(Mr,{key:e.id,app:e,room:t})),i,s.a.createElement(H.a,{kind:"link",onClick:()=>{const e=_n.a.sharedInstance();e.hasManager()?e.getPrimaryManager().open(t):e.openNoManagerDialog()}},n.length>0?Object(N.a)("Edit widgets, bridges & bots"):Object(N.a)("Add widgets, bridges & bots")))},Lr=e=>{Gi.a.instance.pushCard({phase:Hi.a.RoomMemberList},!0),re.b.trackInteraction("WebRightPanelRoomInfoPeopleButton",e)},Ur=()=>{Gi.a.instance.pushCard({phase:Hi.a.FilePanel},!0)},Fr=()=>{Gi.a.instance.pushCard({phase:Hi.a.PinnedMessages},!0)},Br=e=>{v.a.dispatch({action:"open_room_settings"}),re.b.trackInteraction("WebRightPanelRoomInfoSettingsButton",e)};var Vr=e=>{var t;let{room:a,onClose:n}=e;const i=qi(Object(r.useContext)(R.a),a),o=Object(r.useContext)(Un.b).e2eStatus,c=Object(ie.a)("feature_video_rooms"),d=Object(ie.a)("feature_element_call_video_rooms"),u=c&&(a.isElementVideoRoom()||d&&a.isCallRoom()),m=a.getCanonicalAlias()||a.getAltAliases()[0]||"",h=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_RoomSummaryCard_avatar",role:"presentation"},s.a.createElement(be.a,{room:a,height:54,width:54,viewAvatarOnClick:!0}),s.a.createElement(Ha.a,{tooltip:i?Object(N.a)("Encrypted"):Object(N.a)("Not encrypted"),class:l()("mx_RoomSummaryCard_e2ee",{mx_RoomSummaryCard_e2ee_normal:i,mx_RoomSummaryCard_e2ee_warning:i&&o===Xi.Warning,mx_RoomSummaryCard_e2ee_verified:i&&o===Xi.Verified})})),s.a.createElement(yr.a,{room:a},e=>s.a.createElement("h2",{title:e},e)),s.a.createElement("div",{className:"mx_RoomSummaryCard_alias",title:m},m)),p=Zi(a),g=Object(ie.a)("feature_pinning"),v=null===(t=vr(g&&a))||void 0===t?void 0:t.length;return s.a.createElement(Ji,{header:h,className:"mx_RoomSummaryCard",onClose:n},s.a.createElement(Yi,{title:Object(N.a)("About"),className:"mx_RoomSummaryCard_aboutGroup"},s.a.createElement(Dr,{className:"mx_RoomSummaryCard_icon_people",onClick:Lr},Object(N.a)("People"),s.a.createElement("span",{className:"mx_BaseCard_Button_sublabel"},p)),!u&&s.a.createElement(Dr,{className:"mx_RoomSummaryCard_icon_files",onClick:Ur},Object(N.a)("Files")),g&&!u&&s.a.createElement(Dr,{className:"mx_RoomSummaryCard_icon_pins",onClick:Fr},Object(N.a)("Pinned"),v>0&&s.a.createElement("span",{className:"mx_BaseCard_Button_sublabel"},v)),!u&&s.a.createElement(Dr,{className:"mx_RoomSummaryCard_icon_export",onClick:async()=>{z.a.createDialog(Nr,{room:a})}},Object(N.a)("Export chat")),s.a.createElement(Dr,{className:"mx_RoomSummaryCard_icon_share",onClick:()=>{z.a.createDialog($i.a,{target:a})}},Object(N.a)("Share room")),s.a.createElement(Dr,{className:"mx_RoomSummaryCard_icon_settings",onClick:Br},Object(N.a)("Room settings"))),f.b.getValue(se.b.Widgets)&&!u&&Object(te.a)(se.a.AddIntegrations)&&s.a.createElement(Ar,{room:a}))};var zr=e=>{let{room:t,widgetId:a,onClose:n}=e;const i=Object(r.useContext)(R.a),o=Pr(t).find(e=>e.id===a),c=o&&Bn.d.instance.isInContainer(t,o,Bn.a.Right),[l,d,u,m]=Object(ce.p)();if(Object(r.useEffect)(()=>{o&&c||Gi.a.instance.popCard()},[o,c]),!o||!c)return null;let h;if(l){const e=d.current.getBoundingClientRect();h=s.a.createElement(Hn,{chevronFace:ce.a.None,right:$.b.instance.windowWidth-e.right-12,top:e.bottom+12,onFinished:m,app:o})}const p=s.a.createElement("div",{className:"mx_BaseCard_header_title"},s.a.createElement(na.a,{size:"h4",className:"mx_BaseCard_header_title_heading"},Ba.a.getWidgetName(o)),s.a.createElement(ce.b,{className:"mx_BaseCard_header_title_button--option",inputRef:d,onClick:u,isExpanded:l,label:Object(N.a)("Options")}),h);return s.a.createElement(Ji,{header:p,className:"mx_WidgetCard",onClose:n,withoutScrollContainer:!0},s.a.createElement($n,{app:o,fullWidth:!0,showMenubar:!1,room:t,userId:i.getUserId(),creatorUserId:o.creatorUserId,widgetPageTitle:Ba.a.getWidgetDataTitle(o),waitForIframeLoad:o.waitForIframeLoad}))},Wr=a(207),Hr=a(199),Gr=a(518),qr=a(306),Kr=a(581),Yr=a(836);class Jr extends s.a.Component{constructor(e){super(e),i()(this,"userLastModifiedTime",void 0),i()(this,"memberLastModifiedTime",void 0),i()(this,"onRoomStateEvents",e=>{if(e.getType()!==Z.b.RoomEncryption)return;const{roomId:t}=this.props.member;if(e.getRoomId()!==t)return;st.a.get().removeListener(u.b.Events,this.onRoomStateEvents),this.setState({isRoomEncrypted:!0}),this.updateE2EStatus()}),i()(this,"onUserTrustStatusChanged",(e,t)=>{e===this.props.member.userId&&this.updateE2EStatus()}),i()(this,"onDeviceVerificationChanged",(e,t,a)=>{e===this.props.member.userId&&this.updateE2EStatus()}),i()(this,"onClick",()=>{v.a.dispatch({action:L.a.ViewUser,member:this.props.member,push:!0})}),this.state={isRoomEncrypted:!1,e2eStatus:null}}componentDidMount(){const e=st.a.get(),{roomId:t}=this.props.member;if(t){const a=e.isRoomEncrypted(t);this.setState({isRoomEncrypted:a}),a?(e.on(Ei.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),e.on(Ei.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.updateE2EStatus()):e.on(u.b.Events,this.onRoomStateEvents)}}componentWillUnmount(){const e=st.a.get();e&&(e.removeListener(u.b.Events,this.onRoomStateEvents),e.removeListener(Ei.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),e.removeListener(Ei.b.DeviceVerificationChanged,this.onDeviceVerificationChanged))}async updateE2EStatus(){const e=st.a.get(),{userId:t}=this.props.member,a=t===e.getUserId(),n=e.checkUserTrust(t);if(!n.isCrossSigningVerified())return void this.setState({e2eStatus:n.wasCrossSigningVerified()?"warning":"normal"});const i=e.getStoredDevicesForUser(t).some(n=>{const{deviceId:i}=n,r=e.checkDeviceTrust(t,i);return a?!r.isCrossSigningVerified():!r.isVerified()});this.setState({e2eStatus:i?"warning":"verified"})}shouldComponentUpdate(e,t){return void 0===this.memberLastModifiedTime||this.memberLastModifiedTime<e.member.getLastModifiedTime()||(!(!e.member.user||!(void 0===this.userLastModifiedTime||this.userLastModifiedTime<e.member.user.getLastModifiedTime()))||(t.isRoomEncrypted!==this.state.isRoomEncrypted||t.e2eStatus!==this.state.e2eStatus))}getDisplayName(){return this.props.member.name}getPowerLabel(){return Object(N.a)("%(userName)s (power %(powerLevelNumber)s)",{userName:vt.a.getDisplayUserIdentifier(this.props.member.userId,{roomId:this.props.member.roomId}),powerLevelNumber:this.props.member.powerLevel}).trim()}render(){const e=this.props.member,t=this.getDisplayName(),a=e.user?e.user.presence:null,n=s.a.createElement(ma.a,{member:e,width:36,height:36,"aria-hidden":"true"});e.user&&(this.userLastModifiedTime=e.user.getLastModifiedTime()),this.memberLastModifiedTime=e.getLastModifiedTime();const i=new Map([[100,Kr.a.Admin],[50,Kr.a.Moderator]]);let r=this.props.member.powerLevel;for(const[e]of i)if(this.props.member.powerLevel>=e){r=e;break}const o=i.get(r);let c;this.state.isRoomEncrypted&&(c=this.state.e2eStatus);const l=s.a.createElement(Yr.a,{member:e,fallbackName:t||""});return s.a.createElement(Kr.b,X()({},this.props,{presenceState:a,presenceLastActiveAgo:e.user?e.user.lastActiveAgo:0,presenceLastTs:e.user?e.user.lastPresenceTs:0,presenceCurrentlyActive:!!e.user&&e.user.currentlyActive,avatarJsx:n,title:this.getPowerLabel(),name:t,nameJSX:l,powerStatus:o,showPresence:this.props.showPresence,e2eStatus:c,onClick:this.onClick}))}}i()(Jr,"defaultProps",{showPresence:!0});const $r=/[\x21-\x2F\x3A-\x40\x5B-\x60\x7B-\x7E]+/g;class Qr extends s.a.Component{constructor(e){var t;super(e),i()(this,"showPresence",!0),i()(this,"mounted",!1),i()(this,"collator",void 0),i()(this,"sortNames",new Map),i()(this,"onUserPresenceChange",(e,t)=>{this.refs[t.userId]&&this.updateList()}),i()(this,"onRoom",e=>{e.roomId===this.props.roomId&&this.showMembersAccordingToMembershipWithLL()}),i()(this,"onMyMembership",(e,t,a)=>{e.roomId===this.props.roomId&&"join"===t&&this.showMembersAccordingToMembershipWithLL()}),i()(this,"onRoomStateUpdate",e=>{e.roomId===this.props.roomId&&this.updateList()}),i()(this,"onRoomMemberName",(e,t)=>{t.roomId===this.props.roomId&&this.updateList()}),i()(this,"onRoomStateEvent",e=>{e.getRoomId()===this.props.roomId&&e.getType()===Z.b.RoomThirdPartyInvite&&this.updateList(),this.canInvite!==this.state.canInvite&&this.setState({canInvite:this.canInvite})}),i()(this,"updateList",Object(k.throttle)(()=>{this.updateListNow()},500,{leading:!0,trailing:!0})),i()(this,"createOverflowTileJoined",(e,t)=>this.createOverflowTile(e,t,this.showMoreJoinedMemberList)),i()(this,"createOverflowTileInvited",(e,t)=>this.createOverflowTile(e,t,this.showMoreInvitedMemberList)),i()(this,"createOverflowTile",(e,t,n)=>{const i=Object(N.a)("and %(count)s others...",{count:e});return s.a.createElement(Kr.b,{className:"mx_EntityTile_ellipsis",avatarJsx:s.a.createElement(ht.a,{url:a(841).default,name:"...",width:36,height:36}),name:i,presenceState:"online",suppressOnHover:!0,onClick:n})}),i()(this,"showMoreJoinedMemberList",()=>{this.setState({truncateAtJoined:this.state.truncateAtJoined+100})}),i()(this,"showMoreInvitedMemberList",()=>{this.setState({truncateAtInvited:this.state.truncateAtInvited+100})}),i()(this,"memberSort",(e,t)=>{const a=e.user,n=t.user;if(!a&&!n)return 0;if(a&&!n)return-1;if(!a&&n)return 1;if(this.showPresence){const e=e=>"unavailable"===e?"online":e,t=t=>{const a=["active","online","offline"],n=a.indexOf(e(t));return-1===n?a.length:n},i=t(a.currentlyActive?"active":a.presence),r=t(n.currentlyActive?"active":n.presence);if(i!==r)return i-r}return e.powerLevel!==t.powerLevel?t.powerLevel-e.powerLevel:this.showPresence&&a.getLastActiveTs()!==n.getLastActiveTs()?n.getLastActiveTs()-a.getLastActiveTs():this.collator.compare(this.sortNames.get(e),this.sortNames.get(t))}),i()(this,"onSearchQueryChanged",e=>{this.props.onSearchQueryChanged(e),this.setState({filteredJoinedMembers:this.filterMembers(this.state.members,"join",e),filteredInvitedMembers:this.filterMembers(this.state.members,"invite",e)})}),i()(this,"onPending3pidInviteClick",e=>{v.a.dispatch({action:"view_3pid_invite",event:e})}),i()(this,"getChildrenJoined",(e,t)=>this.makeMemberTiles(this.state.filteredJoinedMembers.slice(e,t))),i()(this,"getChildCountJoined",()=>this.state.filteredJoinedMembers.length),i()(this,"getChildrenInvited",(e,t)=>{let a=this.state.filteredInvitedMembers;return t>this.state.filteredInvitedMembers.length&&(a=a.concat(this.getPending3PidInvites())),this.makeMemberTiles(a.slice(e,t))}),i()(this,"getChildCountInvited",()=>this.state.filteredInvitedMembers.length+(this.getPending3PidInvites()||[]).length),i()(this,"onInviteButtonClick",e=>{re.b.trackInteraction("WebRightPanelMemberListInviteButton",e),st.a.get().isGuest()?v.a.dispatch({action:"require_registration"}):v.a.dispatch({action:"view_invite",roomId:this.props.roomId})});const n=st.a.get();n.hasLazyLoadMembersEnabled()?this.state=this.getMembersState([]):this.state=this.getMembersState(this.roomMembers()),n.on(o.b.Room,this.onRoom);const r=lt.b.get("enable_presence_by_hs_url"),c=st.a.get().baseUrl;this.showPresence=null===(t=null==r?void 0:r[c])||void 0===t||t}UNSAFE_componentWillMount(){const e=st.a.get();this.mounted=!0,e.hasLazyLoadMembersEnabled()?(this.showMembersAccordingToMembershipWithLL(),e.on(ee.d.MyMembership,this.onMyMembership)):this.listenForMembersChanges()}listenForMembersChanges(){const e=st.a.get();e.on(u.b.Update,this.onRoomStateUpdate),e.on(Wi.b.Name,this.onRoomMemberName),e.on(u.b.Events,this.onRoomStateEvent),e.on(Wr.b.LastPresenceTs,this.onUserPresenceChange),e.on(Wr.b.Presence,this.onUserPresenceChange),e.on(Wr.b.CurrentlyActive,this.onUserPresenceChange)}componentWillUnmount(){this.mounted=!1;const e=st.a.get();e&&(e.removeListener(u.b.Update,this.onRoomStateUpdate),e.removeListener(Wi.b.Name,this.onRoomMemberName),e.removeListener(ee.d.MyMembership,this.onMyMembership),e.removeListener(u.b.Events,this.onRoomStateEvent),e.removeListener(o.b.Room,this.onRoom),e.removeListener(Wr.b.LastPresenceTs,this.onUserPresenceChange),e.removeListener(Wr.b.Presence,this.onUserPresenceChange),e.removeListener(Wr.b.CurrentlyActive,this.onUserPresenceChange)),this.updateList.cancel()}async showMembersAccordingToMembershipWithLL(){if(st.a.get().hasLazyLoadMembersEnabled()){const e=st.a.get().getRoom(this.props.roomId);if("join"===(e&&e.getMyMembership())){this.setState({loading:!0});try{await e.loadMembersIfNeeded()}catch(e){}this.mounted&&(this.setState(this.getMembersState(this.roomMembers())),this.listenForMembersChanges())}else this.setState(this.getMembersState(this.roomMembers()))}}get canInvite(){const e=st.a.get(),t=e.getRoom(this.props.roomId);return(null==t?void 0:t.canInvite(e.getUserId()))||(null==t?void 0:t.isSpaceRoom())&&t.getJoinRule()===_i.c.Public}getMembersState(e){return{loading:!1,members:e,filteredJoinedMembers:this.filterMembers(e,"join",this.props.searchQuery),filteredInvitedMembers:this.filterMembers(e,"invite",this.props.searchQuery),canInvite:this.canInvite,truncateAtJoined:30,truncateAtInvited:5}}updateListNow(){const e=this.roomMembers();this.setState({loading:!1,members:e,filteredJoinedMembers:this.filterMembers(e,"join",this.props.searchQuery),filteredInvitedMembers:this.filterMembers(e,"invite",this.props.searchQuery)})}getMembersWithUser(){if(!this.props.roomId)return[];const e=st.a.get(),t=e.getRoom(this.props.roomId);if(!t)return[];const a=Object.values(t.currentState.members);return a.forEach(t=>{t.user||(t.user=e.getUser(t.userId)),this.sortNames.set(t,("@"===t.name[0]?t.name.slice(1):t.name).replace($r,""))}),a}roomMembers(){const e=this.getMembersWithUser().filter(e=>"join"===e.membership||"invite"===e.membership),t=f.b.getValue("language");return this.collator=new Intl.Collator(t,{sensitivity:"base",ignorePunctuation:!1}),e.sort(this.memberSort),e}memberString(e){if(e){const t=e.user;return"("+e.name+", "+e.powerLevel+", "+(t?t.lastActiveAgo:"<null>")+", "+(t?t.getLastActiveTs():"<null>")+", "+(t?t.currentlyActive:"<null>")+", "+(t?t.presence:"<null>")+")"}return"(null)"}filterMembers(e,t,a){return e.filter(e=>{if(a){a=a.toLowerCase();const t=-1!==e.name.toLowerCase().indexOf(a),n=-1!==e.userId.toLowerCase().indexOf(a);if(!t&&!n)return!1}return e.membership===t})}getPending3PidInvites(){const e=st.a.get().getRoom(this.props.roomId);if(e)return e.currentState.getStateEvents("m.room.third_party_invite").filter((function(t){if(!Object(Hr.c)(t))return!1;return!e.currentState.getInviteForThreePidToken(t.getStateKey())}))}makeMemberTiles(e){return e.map(e=>e instanceof Wi.a?s.a.createElement(Jr,{key:e.userId,member:e,ref:e.userId,showPresence:this.showPresence}):s.a.createElement(Kr.b,{key:e.getStateKey(),name:e.getContent().display_name,suppressOnHover:!0,onClick:()=>this.onPending3pidInviteClick(e)}))}render(){if(this.state.loading)return s.a.createElement(Ji,{className:"mx_MemberList",onClose:this.props.onClose},s.a.createElement(Ya.a,null));const e=st.a.get().getRoom(this.props.roomId);let t,a,n;if("join"===(null==e?void 0:e.getMyMembership())&&Object(te.a)(se.a.InviteUsers)){let a=Object(N.a)("Invite to this room");e.isSpaceRoom()&&(a=Object(N.a)("Invite to this space")),t=s.a.createElement(H.a,{className:"mx_MemberList_invite",onClick:this.onInviteButtonClick,disabled:!this.state.canInvite},s.a.createElement("span",null,a))}this.getChildCountInvited()>0&&(a=s.a.createElement("h2",null,Object(N.a)("Invited")),n=s.a.createElement(Gr.a,{className:"mx_MemberList_section mx_MemberList_invited",truncateAt:this.state.truncateAtInvited,createOverflowElement:this.createOverflowTileInvited,getChildren:this.getChildrenInvited,getChildCount:this.getChildCountInvited}));const i=s.a.createElement(qr.a,{className:"mx_MemberList_query mx_textinput_icon mx_textinput_search",placeholder:Object(N.a)("Filter room members"),onSearch:this.onSearchQueryChanged,initialValue:this.props.searchQuery});let r;return null!=e&&e.isSpaceRoom()&&(r=s.a.createElement("div",{className:"mx_RightPanel_scopeHeader"},s.a.createElement(be.a,{room:e,height:32,width:32}),s.a.createElement(yr.a,{room:e}))),s.a.createElement(Ji,{className:"mx_MemberList",header:s.a.createElement(s.a.Fragment,null,r,t),footer:i,onClose:this.props.onClose},s.a.createElement("div",{className:"mx_MemberList_wrapper"},s.a.createElement(Gr.a,{className:"mx_MemberList_section mx_MemberList_joined",truncateAt:this.state.truncateAtJoined,createOverflowElement:this.createOverflowTileJoined,getChildren:this.getChildrenJoined,getChildCount:this.getChildCountJoined}),a,n))}}var Xr=a(603),Zr=a(274),es=a(480),ts=a(601),as=a(887),ns=a(369),is=a(816),rs=a(840),ss=a(1486);class os extends s.a.Component{constructor(e){super(e),i()(this,"onOk",e=>{e.preventDefault(),this.props.onFinished(!0,this.state.reason)}),i()(this,"onCancel",()=>{this.props.onFinished(!1)}),i()(this,"onReasonChange",e=>{this.setState({reason:e.target.value})}),this.state={reason:""}}render(){const e=this.props.danger?"danger":"";let t;this.props.askReason&&(t=s.a.createElement("form",{onSubmit:this.onOk},s.a.createElement(Sa.a,{type:"text",onChange:this.onReasonChange,value:this.state.reason,className:"mx_ConfirmUserActionDialog_reasonField",label:Object(N.a)("Reason"),autoFocus:!0})));const a=s.a.createElement(ma.a,{member:this.props.member,width:48,height:48}),n=this.props.member.name,i=this.props.member.userId,r=vt.a.getDisplayUserIdentifier(i,{roomId:this.props.roomId,withDisplayName:!0});return s.a.createElement(on.a,{className:l()("mx_ConfirmUserActionDialog",this.props.className),onFinished:this.props.onFinished,title:this.props.title,contentId:"mx_Dialog_content"},s.a.createElement("div",{id:"mx_Dialog_content",className:"mx_Dialog_content"},s.a.createElement("div",{className:"mx_ConfirmUserActionDialog_user"},s.a.createElement("div",{className:"mx_ConfirmUserActionDialog_avatar"},a),s.a.createElement("div",{className:"mx_ConfirmUserActionDialog_name"},n),s.a.createElement("div",{className:"mx_ConfirmUserActionDialog_userId"},r)),t,this.props.children),s.a.createElement(cn.a,{primaryButton:this.props.action,onPrimaryButtonClick:this.onOk,primaryButtonClass:e,focus:!this.props.askReason,onCancel:this.onCancel}))}}i()(os,"defaultProps",{danger:!1,askReason:!1});var cs=a(779);const ls=["space","spaceChildFilter","allLabel","specificLabel","noneLabel","warningMessage","onFinished"];var ds=e=>{let{space:t,spaceChildFilter:a,allLabel:n,specificLabel:i,noneLabel:o,warningMessage:c,onFinished:l}=e,d=ge()(e,ls);const u=Object(r.useMemo)(()=>{const e=K.a.instance.getChildren(t.roomId);return a?e.filter(a):e},[t.roomId,a]),[m,h]=Object(r.useState)([]),p=Object(r.useMemo)(()=>new Set(m),[m]);let g;return c&&(g=s.a.createElement("div",{className:"mx_ConfirmSpaceUserActionDialog_warning"},c)),s.a.createElement(os,X()({},d,{onFinished:(e,t)=>{l(e,t,m)},className:"mx_ConfirmSpaceUserActionDialog",roomId:t.roomId}),g,s.a.createElement(cs.a,{space:t,spaceChildren:u,selected:p,allLabel:n,specificLabel:i,noneLabel:o,onChange:h}))},us=a(368);const ms=["user","room","onClose","phase"];function hs(e){var t;let{userId:a,device:n}=e;const i=Object(r.useContext)(R.a),o=a===i.getUserId(),c=i.checkDeviceTrust(a,n.deviceId),d=i.checkUserTrust(a),u=o?c.isCrossSigningVerified():c.isVerified(),m=l()("mx_UserInfo_device",{mx_UserInfo_device_verified:u,mx_UserInfo_device_unverified:!u}),h=l()("mx_E2EIcon",{mx_E2EIcon_normal:!d.isVerified(),mx_E2EIcon_verified:u,mx_E2EIcon_warning:d.isVerified()&&!u}),p=()=>{Object(as.c)(i.getUser(a),n)};let g;g=null!==(t=n.getDisplayName())&&void 0!==t&&t.trim()?n.ambiguous?n.getDisplayName()+" ("+n.deviceId+")":n.getDisplayName():n.deviceId;let v=null;return d.isVerified()&&(v=u?Object(N.a)("Trusted"):Object(N.a)("Not trusted")),u?s.a.createElement("div",{className:m,title:n.deviceId},s.a.createElement("div",{className:h}),s.a.createElement("div",{className:"mx_UserInfo_device_name"},g),s.a.createElement("div",{className:"mx_UserInfo_device_trusted"},v)):s.a.createElement(H.a,{className:m,title:n.deviceId,onClick:p},s.a.createElement("div",{className:h}),s.a.createElement("div",{className:"mx_UserInfo_device_name"},g),s.a.createElement("div",{className:"mx_UserInfo_device_trusted"},v))}function ps(e){let{devices:t,userId:a,loading:n}=e;const i=Object(r.useContext)(R.a),o=i.checkUserTrust(a),[c,l]=Object(r.useState)(!1);if(n)return s.a.createElement(Ya.a,null);if(null===t)return s.a.createElement("p",null,Object(N.a)("Unable to load session list"));const d=a===i.getUserId(),u=t.map(e=>i.checkDeviceTrust(a,e.deviceId));let m=[];const h=[];let p,g,v,f="mx_E2EIcon";if(o.isVerified()){for(let e=0;e<t.length;++e){const a=t[e],n=u[e];(d?n.isCrossSigningVerified():n.isVerified())?m.push(a):h.push(a)}p=Object(N.a)("%(count)s verified sessions",{count:m.length}),g=Object(N.a)("Hide verified sessions"),f+=" mx_E2EIcon_verified"}else m=t,p=Object(N.a)("%(count)s sessions",{count:t.length}),g=Object(N.a)("Hide sessions"),f+=" mx_E2EIcon_normal";m.length&&(v=c?s.a.createElement(H.a,{kind:"link",className:"mx_UserInfo_expand",onClick:()=>l(!1)},s.a.createElement("div",null,g)):s.a.createElement(H.a,{kind:"link",className:"mx_UserInfo_expand",onClick:()=>l(!0)},s.a.createElement("div",{className:f}),s.a.createElement("div",null,p)));let b=h.map((e,t)=>s.a.createElement(hs,{key:t,userId:a,device:e}));if(c){const e=h.length;b=b.concat(m.map((t,n)=>s.a.createElement(hs,{key:n+e,userId:a,device:t})))}return s.a.createElement("div",{className:"mx_UserInfo_devices"},s.a.createElement("div",null,b),s.a.createElement("div",null,v))}const gs=e=>{let{member:t}=e;const a=Object(r.useContext)(R.a),[n,i]=Object(r.useState)(!1);return s.a.createElement(H.a,{kind:"link",onClick:async()=>{n||(i(!0),await async function(e,t){const a=new us.a({user_id:t.userId,display_name:t.rawDisplayName,avatar_url:t.getMxcAvatarUrl()});Object(us.e)(e,[a])}(a,t),i(!1))},className:"mx_UserInfo_field",disabled:n},Object(N.a)("Message"))},vs=e=>{let{member:t,isIgnored:a,canInvite:n,isSpace:i}=e;const o=Object(r.useContext)(R.a);let c=null,d=null,u=null,m=null;const h=t.userId===o.getUserId();if(!h){var p;const e=()=>{const e=o.getIgnoredUsers();if(a){const a=e.indexOf(t.userId);-1!==a&&e.splice(a,1)}else e.push(t.userId);o.setIgnoredUsers(e)};if(c=s.a.createElement(H.a,{kind:"link",onClick:e,className:l()("mx_UserInfo_field",{mx_UserInfo_destructive:!a})},a?Object(N.a)("Unignore"):Object(N.a)("Ignore")),t.roomId&&!i){const e=function(){const e=o.getRoom(t.roomId);v.a.dispatch({action:L.a.ViewRoom,highlighted:!0,event_id:e.getEventReadUpTo(t.userId),room_id:t.roomId,metricsTrigger:void 0})},a=function(){v.a.dispatch({action:L.a.ComposerInsert,userId:t.userId,timelineRenderingType:Un.a.Room})},n=o.getRoom(t.roomId);null!=n&&n.getEventReadUpTo(t.userId)&&(m=s.a.createElement(H.a,{kind:"link",onClick:e,className:"mx_UserInfo_field"},Object(N.a)("Jump to read receipt"))),d=s.a.createElement(H.a,{kind:"link",onClick:a,className:"mx_UserInfo_field"},Object(N.a)("Mention"))}if(n&&"leave"===(null!==(p=null==t?void 0:t.membership)&&void 0!==p?p:"leave")&&Object(te.a)(se.a.InviteUsers)){const e=t&&t.roomId?t.roomId:it.b.instance.roomViewStore.getRoomId(),a=async a=>{try{const a=new Xr.a(e);await a.invite([t.userId]).then(()=>{if("invited"!==a.getCompletionState(t.userId))throw new Error(a.getErrorText(t.userId))})}catch(e){z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to invite"),description:e&&e.message?e.message:Object(N.a)("Operation failed")})}re.b.trackInteraction("WebRightPanelRoomUserInfoInviteButton",a)};u=s.a.createElement(H.a,{kind:"link",onClick:a,className:"mx_UserInfo_field"},Object(N.a)("Invite"))}}const g=s.a.createElement(H.a,{kind:"link",onClick:()=>{z.a.createDialog($i.a,{target:t})},className:"mx_UserInfo_field"},Object(N.a)("Share Link to User"));let f;return h||(f=s.a.createElement(gs,{member:t})),s.a.createElement("div",{className:"mx_UserInfo_container"},s.a.createElement("h3",null,Object(N.a)("Options")),s.a.createElement("div",null,f,m,g,d,u,c))},fs=async e=>{const{finished:t}=z.a.createDialog(Fn.a,{title:Object(N.a)("Demote yourself?"),description:s.a.createElement("div",null,e?Object(N.a)("You will not be able to undo this change as you are demoting yourself, if you are the last privileged user in the space it will be impossible to regain privileges."):Object(N.a)("You will not be able to undo this change as you are demoting yourself, if you are the last privileged user in the room it will be impossible to regain privileges.")),button:Object(N.a)("Demote")}),[a]=await t;return a},bs=e=>{let{children:t}=e;return s.a.createElement("div",{className:"mx_UserInfo_container"},s.a.createElement("h3",null,Object(N.a)("Admin Tools")),s.a.createElement("div",{className:"mx_UserInfo_buttons"},t))},ys=e=>{var t,a;return(null==e||null===(t=e.currentState)||void 0===t||null===(a=t.getStateEvents(Z.b.RoomPowerLevels,""))||void 0===a?void 0:a.getContent())||{}},Es=e=>{let{room:t,member:a,startUpdating:n,stopUpdating:i}=e;const o=Object(r.useContext)(R.a);if("invite"!==a.membership&&"join"!==a.membership)return null;const c=t.isSpaceRoom()?"invite"===a.membership?Object(N.a)("Disinvite from space"):Object(N.a)("Remove from space"):"invite"===a.membership?Object(N.a)("Disinvite from room"):Object(N.a)("Remove from room");return s.a.createElement(H.a,{kind:"link",className:"mx_UserInfo_field mx_UserInfo_destructive",onClick:async()=>{const{finished:e}=z.a.createDialog(t.isSpaceRoom()?ds:os,{member:a,action:t.isSpaceRoom()?"invite"===a.membership?Object(N.a)("Disinvite from space"):Object(N.a)("Remove from space"):"invite"===a.membership?Object(N.a)("Disinvite from room"):Object(N.a)("Remove from room"),title:"invite"===a.membership?Object(N.a)("Disinvite from %(roomName)s",{roomName:t.name}):Object(N.a)("Remove from %(roomName)s",{roomName:t.name}),askReason:"join"===a.membership,danger:!0,space:t,spaceChildFilter:e=>{const t=e.getMember(o.credentials.userId),n=e.getMember(a.userId);return t&&n&&n.membership===a.membership&&t.powerLevel>n.powerLevel&&e.currentState.hasSufficientPowerLevelFor("kick",t.powerLevel)},allLabel:Object(N.a)("Remove them from everything I'm able to"),specificLabel:Object(N.a)("Remove them from specific things I'm able to"),warningMessage:Object(N.a)("They'll still be able to access whatever you're not an admin of.")},t.isSpaceRoom()?"mx_ConfirmSpaceUserActionDialog_wrapper":void 0),[r,s,c=[]]=await e;r&&(n(),Object(oe.a)(t,c,e=>o.kick(e.roomId,a.userId,s||void 0)).then(()=>{la.a.log("Kick success")},(function(e){la.a.error("Kick error: "+e),z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to remove user"),description:e&&e.message?e.message:"Operation failed"})})).finally(()=>{i()}))}},c)},_s=e=>{let{member:t}=e;const a=Object(r.useContext)(R.a);return s.a.createElement(H.a,{kind:"link",className:"mx_UserInfo_field mx_UserInfo_destructive",onClick:()=>{const e=a.getRoom(t.roomId);e&&z.a.createDialog(ss.a,{matrixClient:a,room:e,member:t})}},Object(N.a)("Remove recent messages"))},ws=e=>{let{room:t,member:a,startUpdating:n,stopUpdating:i}=e;const o=Object(r.useContext)(R.a),c="ban"===a.membership;let d=t.isSpaceRoom()?Object(N.a)("Ban from space"):Object(N.a)("Ban from room");c&&(d=t.isSpaceRoom()?Object(N.a)("Unban from space"):Object(N.a)("Unban from room"));const u=l()("mx_UserInfo_field",{mx_UserInfo_destructive:!c});return s.a.createElement(H.a,{kind:"link",className:u,onClick:async()=>{const{finished:e}=z.a.createDialog(t.isSpaceRoom()?ds:os,{member:a,action:t.isSpaceRoom()?c?Object(N.a)("Unban from space"):Object(N.a)("Ban from space"):c?Object(N.a)("Unban from room"):Object(N.a)("Ban from room"),title:c?Object(N.a)("Unban from %(roomName)s",{roomName:t.name}):Object(N.a)("Ban from %(roomName)s",{roomName:t.name}),askReason:!c,danger:!c,space:t,spaceChildFilter:c?e=>{const t=e.getMember(o.credentials.userId),n=e.getMember(a.userId);return t&&n&&"ban"===n.membership&&t.powerLevel>n.powerLevel&&e.currentState.hasSufficientPowerLevelFor("ban",t.powerLevel)}:e=>{const t=e.getMember(o.credentials.userId),n=e.getMember(a.userId);return t&&n&&"ban"!==n.membership&&t.powerLevel>n.powerLevel&&e.currentState.hasSufficientPowerLevelFor("ban",t.powerLevel)},allLabel:c?Object(N.a)("Unban them from everything I'm able to"):Object(N.a)("Ban them from everything I'm able to"),specificLabel:c?Object(N.a)("Unban them from specific things I'm able to"):Object(N.a)("Ban them from specific things I'm able to"),warningMessage:c?Object(N.a)("They won't be able to access whatever you're not an admin of."):Object(N.a)("They'll still be able to access whatever you're not an admin of.")},t.isSpaceRoom()?"mx_ConfirmSpaceUserActionDialog_wrapper":void 0),[r,s,l=[]]=await e;if(!r)return;n();Object(oe.a)(t,l,e=>{return t=e.roomId,c?o.unban(t,a.userId):o.ban(t,a.userId,s||void 0);var t}).then(()=>{la.a.log("Ban success")},(function(e){la.a.error("Ban error: "+e),z.a.createDialog(Nn.a,{title:Object(N.a)("Error"),description:Object(N.a)("Failed to ban user")})})).finally(()=>{i()})}},d)},Ss=e=>{let{member:t,room:a,powerLevels:n,startUpdating:i,stopUpdating:o}=e;const c=Object(r.useContext)(R.a);if("join"!==t.membership)return null;const d=((e,t)=>{if(!t||!e)return!1;const a=(t.events?t.events["m.room.message"]:null)||t.events_default;return e.powerLevel<a})(t,n),u=l()("mx_UserInfo_field",{mx_UserInfo_destructive:!d}),m=d?Object(N.a)("Unmute"):Object(N.a)("Mute");return s.a.createElement(H.a,{kind:"link",className:u,onClick:async()=>{const e=t.roomId,n=t.userId;if(n===c.getUserId())try{if(!await fs(null==a?void 0:a.isSpaceRoom()))return}catch(e){return void la.a.error("Failed to warn about self demotion: ",e)}const r=a.currentState.getStateEvents("m.room.power_levels","");if(!r)return;const s=r.getContent(),l=(s.events?s.events["m.room.message"]:null)||s.events_default;let u;u=d?l:l-1,u=parseInt(u),isNaN(u)||(i(),c.setPowerLevel(e,n,u,r).then(()=>{la.a.log("Mute toggle success")},(function(e){la.a.error("Mute error: "+e),z.a.createDialog(Nn.a,{title:Object(N.a)("Error"),description:Object(N.a)("Failed to mute user")})})).finally(()=>{o()}))}},m)},Os=e=>{let{room:t,children:a,member:n,startUpdating:i,stopUpdating:o,powerLevels:c}=e;const l=Object(r.useContext)(R.a);let d,u,m,h;const p=(c.events?c.events["m.room.power_levels"]:null)||c.state_default,{ban:g=50,kick:v=50,redact:f=50}=c,b=t.getMember(l.getUserId());if(!b)return s.a.createElement("div",null);const y=b.userId===n.userId,E=n.powerLevel<b.powerLevel||y;return!y&&E&&b.powerLevel>=v&&(d=s.a.createElement(Es,{room:t,member:n,startUpdating:i,stopUpdating:o})),b.powerLevel>=f&&!t.isSpaceRoom()&&(h=s.a.createElement(_s,{member:n,startUpdating:i,stopUpdating:o})),!y&&E&&b.powerLevel>=g&&(u=s.a.createElement(ws,{room:t,member:n,startUpdating:i,stopUpdating:o})),!y&&E&&b.powerLevel>=p&&!t.isSpaceRoom()&&(m=s.a.createElement(Ss,{member:n,room:t,powerLevels:c,startUpdating:i,stopUpdating:o})),d||u||m||h||a?s.a.createElement(bs,null,m,d,u,h,a):s.a.createElement("div",null)};const Cs=e=>{let{user:t,room:a,roomPermissions:n,powerLevels:i}=e;if(n.canEdit)return s.a.createElement(xs,{user:t,room:a,roomPermissions:n});{const e=i.users_default||0,a=t.powerLevel,n=Object(es.b)(a,e);return s.a.createElement("div",{className:"mx_UserInfo_profileField"},s.a.createElement("div",{className:"mx_UserInfo_roleDescription"},n))}},xs=e=>{let{user:t,room:a,roomPermissions:n}=e;const i=Object(r.useContext)(R.a),[o,c]=Object(r.useState)(t.powerLevel);Object(r.useEffect)(()=>{c(t.powerLevel)},[t]);const l=Object(r.useCallback)(async e=>{c(e);const n=t.roomId,r=t.userId,o=a.currentState.getStateEvents("m.room.power_levels","");if(!o)return;const l=i.getUserId(),d=o.getContent().users[l];if(d&&parseInt(d)<=e&&l!==r){const{finished:e}=z.a.createDialog(Fn.a,{title:Object(N.a)("Warning!"),description:s.a.createElement("div",null,Object(N.a)("You will not be able to undo this change as you are promoting the user to have the same power level as yourself."),s.a.createElement("br",null),Object(N.a)("Are you sure?")),button:Object(N.a)("Continue")}),[t]=await e;if(!t)return}else if(l===r&&d&&parseInt(d)>e)try{if(!await fs(null==a?void 0:a.isSpaceRoom()))return}catch(e){la.a.error("Failed to warn about self demotion: ",e)}await((e,t,a,n)=>i.setPowerLevel(e,t,parseInt(a),n).then((function(){la.a.log("Power change success")}),(function(e){la.a.error("Failed to change power level "+e),z.a.createDialog(Nn.a,{title:Object(N.a)("Error"),description:Object(N.a)("Failed to change power level")})})))(n,r,e,o)},[t.roomId,t.userId,i,a]),d=a.currentState.getStateEvents("m.room.power_levels",""),u=d?d.getContent().users_default:0;return s.a.createElement("div",{className:"mx_UserInfo_profileField"},s.a.createElement(is.a,{label:null,value:o,maxValue:n.modifyLevelMax,usersDefault:u,onChange:l}))},ks=e=>{const t=Object(r.useContext)(R.a),[a,n]=Object(r.useState)(void 0);return Object(r.useEffect)(()=>{n(void 0);let a=!1;return async function(){try{await t.downloadKeys([e],!0);const i=t.getStoredDevicesForUser(e);if(a)return;(e=>{const t=Object.create(null);for(let a=0;a<e.length;a++){const n=e[a].getDisplayName(),i=t[n]||[];i.push(a),t[n]=i}for(const a in t)t[a].length>1&&t[a].forEach(t=>{e[t].ambiguous=!0})})(i),n(i)}catch(e){n(null)}}(),()=>{a=!0}},[t,e]),Object(r.useEffect)(()=>{let a=!1;const i=async()=>{const i=t.getStoredDevicesForUser(e);a||n(i)},r=t=>{t.includes(e)&&i()},s=(t,a)=>{t===e&&i()},o=(t,a)=>{t===e&&i()};return t.on(Ei.b.DevicesUpdated,r),t.on(Ei.b.DeviceVerificationChanged,s),t.on(Ei.b.UserTrustStatusChanged,o),()=>{a=!0,t.removeListener(Ei.b.DevicesUpdated,r),t.removeListener(Ei.b.DeviceVerificationChanged,s),t.removeListener(Ei.b.UserTrustStatusChanged,o)}},[t,e]),a},js=e=>{let{room:t,member:a,devices:n,isRoomEncrypted:i}=e;const c=Object(r.useContext)(R.a),l=((e,t)=>{const[a,n]=Object(r.useState)(ys(t)),i=Object(r.useCallback)(e=>{t&&(e&&e.getType()!==Z.b.RoomPowerLevels||n(ys(t)))},[t]);return Object(ne.c)(e,u.b.Events,i),Object(r.useEffect)(()=>(i(),()=>{n({})}),[i]),a})(c,t),d=(e=>{const[t,a]=Object(r.useState)(!1);return Object(r.useEffect)(()=>{e.isSynapseAdministrator().then(e=>{a(e)},()=>{a(!1)})},[e]),t})(c),[m,h]=Object(r.useState)(c.isUserIgnored(a.userId));Object(r.useEffect)(()=>{h(c.isUserIgnored(a.userId))},[c,a.userId]);const p=Object(r.useCallback)(e=>{"m.ignored_user_list"===e.getType()&&h(c.isUserIgnored(a.userId))},[c,a.userId]);Object(ne.c)(c,o.b.AccountData,p);const[g,f]=Object(r.useState)(0),b=Object(r.useCallback)(()=>{f(g+1)},[g]),y=Object(r.useCallback)(()=>{f(g-1)},[g]),E=function(e,t,a){const[n,i]=Object(r.useState)({modifyLevelMax:-1,canEdit:!1,canInvite:!1}),s=Object(r.useCallback)(()=>{var n,r;const s=null==t||null===(n=t.currentState.getStateEvents(Z.b.RoomPowerLevels,""))||void 0===n?void 0:n.getContent();if(!s)return;const o=t.getMember(e.getUserId());if(!o)return;const c=a,l=o.userId===c.userId;let d=-1;if(c.powerLevel<o.powerLevel||l){var u,m,h;const e=null!==(u=null!==(m=null===(h=s.events)||void 0===h?void 0:h[Z.b.RoomPowerLevels])&&void 0!==m?m:s.state_default)&&void 0!==u?u:50;o.powerLevel>=e&&(d=o.powerLevel)}i({canInvite:o.powerLevel>=(null!==(r=s.invite)&&void 0!==r?r:0),canEdit:d>=0,modifyLevelMax:d})},[e,a,t]);return Object(ne.c)(e,u.b.Update,s),Object(r.useEffect)(()=>(s(),()=>{i({modifyLevelMax:-1,canEdit:!1,canInvite:!1})}),[s]),n}(c,t,a),_=Object(r.useCallback)(async()=>{const{finished:e}=z.a.createDialog(Fn.a,{title:Object(N.a)("Deactivate user?"),description:s.a.createElement("div",null,Object(N.a)("Deactivating this user will log them out and prevent them from logging back in. Additionally, they will leave all the rooms they are in. This action cannot be reversed. Are you sure you want to deactivate this user?")),button:Object(N.a)("Deactivate user"),danger:!0}),[t]=await e;if(t)try{await c.deactivateSynapseUser(a.userId)}catch(e){la.a.error("Failed to deactivate user"),la.a.error(e),z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to deactivate user"),description:e&&e.message?e.message:Object(N.a)("Operation failed")})}},[c,a.userId]);let w,S,O,C;d&&a.userId.endsWith(":"+st.a.getHomeserverName())&&(w=s.a.createElement(H.a,{kind:"link",className:"mx_UserInfo_field mx_UserInfo_destructive",onClick:_},Object(N.a)("Deactivate user"))),t&&a.roomId?(Qi.a.shared().getUserIdForRoomId(a.roomId)||(O=s.a.createElement("div",{className:"mx_UserInfo_container"},s.a.createElement("h3",null,Object(N.a)("Role in <RoomName/>",{},{RoomName:()=>s.a.createElement("b",null,t.name)})),s.a.createElement(Cs,{powerLevels:l,user:a,room:t,roomPermissions:E}))),C=s.a.createElement(Os,{powerLevels:l,member:a,room:t,startUpdating:b,stopUpdating:y},w)):w&&(C=s.a.createElement(bs,null,w)),g>0&&(S=s.a.createElement(Ya.a,null));const x=c.isCryptoEnabled();let k,j;i?t.isSpaceRoom()||(k=Object(N.a)("Messages in this room are end-to-end encrypted.")):x?t&&!t.isSpaceRoom()&&(k=Object(N.a)("Messages in this room are not end-to-end encrypted.")):k=Object(N.a)("This client does not support end-to-end encryption.");const I=(e=>Object(sr.a)(async()=>e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"),[e],!1))(c),T=x&&c.checkUserTrust(a.userId),D=x&&T.isCrossSigningVerified(),P=a.userId===c.getUserId(),M=x&&I&&!D&&!P&&n&&n.length>0,A=function(e,t,a,n){return Object(sr.a)(async()=>{if(a){n(!0);try{await e.downloadKeys([t.userId]);const a=e.getStoredCrossSigningForUser(t.userId);return!!(a&&a.getId())}finally{n(!1)}}},[e,t,a],void 0)}(c,a,M,e=>{f(t=>t+(e?1:-1))}),U=void 0===n;let F;M&&(void 0!==A?j=s.a.createElement("div",{className:"mx_UserInfo_container_verifyButton"},s.a.createElement(H.a,{kind:"link",className:"mx_UserInfo_field mx_UserInfo_verifyButton",onClick:()=>{A?Object(as.d)(a):Object(as.a)(a)}},Object(N.a)("Verify"))):U||(j=s.a.createElement(Ya.a,null))),a.userId==c.getUserId()&&(F=s.a.createElement("div",null,s.a.createElement(H.a,{kind:"link",className:"mx_UserInfo_field",onClick:()=>{v.a.dispatch({action:L.a.ViewUserDeviceSettings})}},Object(N.a)("Edit devices"))));const B=s.a.createElement("div",{className:"mx_UserInfo_container"},s.a.createElement("h3",null,Object(N.a)("Security")),s.a.createElement("p",null,k),j,x&&s.a.createElement(ps,{loading:U,devices:n,userId:a.userId}),F);return s.a.createElement(s.a.Fragment,null,O,B,s.a.createElement(vs,{canInvite:E.canInvite,isIgnored:m,member:a,isSpace:null==t?void 0:t.isSpaceRoom()}),C,S)},Rs=e=>{let{member:t,e2eStatus:a,roomId:n}=e;const i=Object(r.useContext)(R.a),o=Object(r.useCallback)(()=>{const e=t.getMxcAvatarUrl?t.getMxcAvatarUrl():t.avatarUrl;if(!e)return;const a={src:Object(Gn.b)(e).srcHttp,name:t.name||t.displayName};z.a.createDialog(ns.a,a,"mx_Dialog_lightbox",null,!0)},[t]),c=s.a.createElement("div",{className:"mx_UserInfo_avatar"},s.a.createElement("div",{className:"mx_UserInfo_avatar_transition"},s.a.createElement("div",{className:"mx_UserInfo_avatar_transition_child"},s.a.createElement(ma.a,{key:t.userId,member:t,width:.6*$.b.instance.windowHeight,height:.6*$.b.instance.windowHeight,resizeMethod:"scale",fallbackUserId:t.userId,onClick:o,urls:t.avatarUrl?[t.avatarUrl]:void 0}))));let l,d,u;t instanceof Wi.a&&t.user&&(l=t.user.presence,d=t.user.lastActiveAgo,u=t.user.currentlyActive);const m=lt.b.get("enable_presence_by_hs_url");let h=!0;m&&void 0!==m[i.baseUrl]&&(h=m[i.baseUrl]);let p,g=null;h&&(g=s.a.createElement(rs.a,{activeAgo:d,currentlyActive:u,presenceState:l})),a&&(p=s.a.createElement(Zr.b,{size:18,status:a,isUser:!0}));const v=t.rawDisplayName;return s.a.createElement(s.a.Fragment,null,c,s.a.createElement("div",{className:"mx_UserInfo_container mx_UserInfo_separator"},s.a.createElement("div",{className:"mx_UserInfo_profile"},s.a.createElement("div",null,s.a.createElement("h2",null,p,s.a.createElement("span",{title:v,"aria-label":v,dir:"auto"},v))),s.a.createElement("div",{className:"mx_UserInfo_profile_mxid"},vt.a.getDisplayUserIdentifier(t.userId,{roomId:n,withDisplayName:!0})),s.a.createElement("div",{className:"mx_UserInfo_profileStatus"},g))))};var Is=e=>{let{user:t,room:a,onClose:n,phase:i=Hi.a.RoomMemberInfo}=e,o=ge()(e,ms);const c=Object(r.useContext)(R.a),l=Object(r.useMemo)(()=>a&&a.getMember(t.userId)||t,[a,t]),d=qi(c,a),u=ks(t.userId);let m;d&&u&&(m=((e,t,a)=>{const n=t===e.getUserId(),i=e.checkUserTrust(t);if(!i.isCrossSigningVerified())return i.wasCrossSigningVerified()?Xi.Warning:Xi.Normal;return a.some(a=>{const{deviceId:i}=a,r=e.checkDeviceTrust(t,i);return n?!r.isCrossSigningVerified():!r.isVerified()})?Xi.Warning:Xi.Verified})(c,t.userId,u));const h=["mx_UserInfo"];let p;a&&i===Hi.a.EncryptionPanel?p={member:l}:null!=a&&a.isSpaceRoom()&&(p={spaceId:a.roomId});const g=()=>{Gi.a.instance.popCard()};let v;switch(i){case Hi.a.RoomMemberInfo:case Hi.a.SpaceMemberInfo:v=s.a.createElement(js,{room:a,member:l,devices:u,isRoomEncrypted:d});break;case Hi.a.EncryptionPanel:h.push("mx_UserInfo_smallAvatar"),v=s.a.createElement(ts.a,X()({},o,{member:l,onClose:g,isRoomEncrypted:d}))}let f,b=void 0;if(i===Hi.a.EncryptionPanel){const e=o.verificationRequest;e&&e.pending&&(b=Object(N.a)("Cancel"))}null!=a&&a.isSpaceRoom()&&(f=s.a.createElement("div",{"data-test-id":"space-header",className:"mx_RightPanel_scopeHeader"},s.a.createElement(be.a,{room:a,height:32,width:32}),s.a.createElement(yr.a,{room:a})));const y=s.a.createElement(s.a.Fragment,null,f,s.a.createElement(Rs,{member:l,e2eStatus:m,roomId:null==a?void 0:a.roomId}));return s.a.createElement(Ji,{className:h.join(" "),header:y,onClose:n,closeLabel:b,cardState:p,onBack:e=>{Gi.a.instance.previousCard.phase===Hi.a.RoomMemberList&&re.b.trackInteraction("WebRightPanelRoomUserInfoBackButton",e)}},v)};class Ts extends s.a.Component{constructor(e){super(e),i()(this,"room",void 0),i()(this,"onRoomStateEvents",e=>{if(e.getType()===Z.b.RoomThirdPartyInvite&&e.getStateKey()===this.state.stateKey){const t=e.getContent().display_name,a={invited:Object(Hr.c)(e)};t&&(a.displayName=t),this.setState(a)}}),i()(this,"onCancel",()=>{v.a.dispatch({action:"view_3pid_invite",event:null})}),i()(this,"onKickClick",()=>{st.a.get().sendStateEvent(this.state.roomId,"m.room.third_party_invite",{},this.state.stateKey).catch(e=>{la.a.error(e),this.setState({invited:!0}),z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to revoke invite"),description:Object(N.a)("Could not revoke the invite. The server may be experiencing a temporary problem or you do not have sufficient permissions to revoke the invite.")})}),this.setState({invited:!1})}),this.room=st.a.get().getRoom(this.props.event.getRoomId());const t=this.room.getMember(st.a.get().getUserId()),a=this.room.currentState.getStateEvents("m.room.power_levels","");let n=a?a.getContent().kick:50;"number"!=typeof n&&(n=50);const r=this.room.getMember(this.props.event.getSender());this.state={stateKey:this.props.event.getStateKey(),roomId:this.props.event.getRoomId(),displayName:this.props.event.getContent().display_name,invited:!0,canKick:!!t&&t.powerLevel>n,senderName:r?r.name:this.props.event.getSender()}}componentDidMount(){st.a.get().on(u.b.Events,this.onRoomStateEvents)}componentWillUnmount(){const e=st.a.get();e&&e.removeListener(u.b.Events,this.onRoomStateEvents)}render(){let e,t=null;return this.state.canKick&&this.state.invited&&(t=s.a.createElement("div",{className:"mx_MemberInfo_container"},s.a.createElement("h3",null,Object(N.a)("Admin Tools")),s.a.createElement("div",{className:"mx_MemberInfo_buttons"},s.a.createElement(H.a,{className:"mx_MemberInfo_field",onClick:this.onKickClick},Object(N.a)("Revoke invite"))))),this.room.isSpaceRoom()&&(e=s.a.createElement("div",{className:"mx_RightPanel_scopeHeader"},s.a.createElement(be.a,{room:this.room,height:32,width:32}),s.a.createElement(yr.a,{room:this.room}))),s.a.createElement("div",{className:"mx_MemberInfo",role:"tabpanel"},e,s.a.createElement("div",{className:"mx_MemberInfo_name"},s.a.createElement(H.a,{className:"mx_MemberInfo_cancel",onClick:this.onCancel,title:Object(N.a)("Close")}),s.a.createElement("h2",null,this.state.displayName)),s.a.createElement("div",{className:"mx_MemberInfo_container"},s.a.createElement("div",{className:"mx_MemberInfo_profile"},s.a.createElement("div",{className:"mx_MemberInfo_profileField"},Object(N.a)("Invited by %(sender)s",{sender:this.state.senderName})))),t)}}var Ns=a(321);let Ds;function Ps(e){let{isRoomEncrypted:t,kind:a}=e;if(!t)return null;if(ki.a.get())return null;if(ki.a.error)return s.a.createElement("div",{className:"mx_SearchWarning"},Object(N.a)("Message search initialisation failed, check <a>your settings</a> for more information",{},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:e=>{e.preventDefault(),v.a.dispatch({action:L.a.ViewUserSettings,initialTabId:Me.a.Security})}},e)}));const n=lt.b.get("brand"),i=lt.b.getObject("desktop_builds");let r=null,o=null;if(i.get("available")){o=s.a.createElement("img",{src:i.get("logo")});const e=i.get("url");switch(a){case Ds.Files:r=Object(N.a)("Use the <a>Desktop app</a> to see all encrypted files",{},{a:t=>s.a.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},t)});break;case Ds.Search:r=Object(N.a)("Use the <a>Desktop app</a> to search encrypted messages",{},{a:t=>s.a.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},t)})}}else switch(a){case Ds.Files:r=Object(N.a)("This version of %(brand)s does not support viewing some encrypted files",{brand:n});break;case Ds.Search:r=Object(N.a)("This version of %(brand)s does not support searching encrypted messages",{brand:n})}return r?s.a.createElement("div",{className:"mx_SearchWarning"},o,s.a.createElement("span",null,r)):(la.a.warn("Unknown desktop builds warning kind: ",a),null)}!function(e){e[e.Files=0]="Files",e[e.Search=1]="Search"}(Ds||(Ds={}));var Ms=a(150),As=a(472),Ls=a(17),Us=a(573),Fs=a(302),Bs=a(596),Vs=a(568);const zs=function(){if(f.b.getValue("debug_timeline_panel")){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];la.a.log.call(console,"TimelinePanel debuglog:",...t)}};class Ws extends s.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"lastRRSentEventId",void 0),i()(this,"lastRMSentEventId",void 0),i()(this,"messagePanel",Object(r.createRef)()),i()(this,"dispatcherRef",void 0),i()(this,"timelineWindow",void 0),i()(this,"unmounted",!1),i()(this,"readReceiptActivityTimer",void 0),i()(this,"readMarkerActivityTimer",void 0),i()(this,"callEventGroupers",new Map),i()(this,"onDumpDebugLogs",()=>{var e,t,a,n,i;const r=null===(e=this.props.timelineSet)||void 0===e?void 0:e.room,s=null===(t=this.state)||void 0===t||null===(a=t.events)||void 0===a?void 0:a.map(e=>e.getId());let o,c,l;try{const e=this.messagePanel.current;if(e){const t=Lt.a.findDOMNode(e);if(t){o=[...t.querySelectorAll("[data-event-id]")].map(e=>e.getAttribute("data-event-id"))}}}catch(e){la.a.error("onDumpDebugLogs: Failed to get the actual event ID's in the DOM",e)}const d={};if(r){const e=r.getTimelineSets(),t=r.threadsTimelineSets;try{c=Hs(e),l=Hs(t)}catch(e){la.a.error("onDumpDebugLogs: Failed to serialize event IDs from timelinesets",e)}try{r.getThreads().forEach(e=>{var t,a;d[e.id]={events:e.events.map(e=>e.getId()),numTimelines:e.timelineSet.getTimelines().length,liveTimeline:e.timelineSet.getLiveTimeline().getEvents().length,prevTimeline:null===(t=e.timelineSet.getLiveTimeline().getNeighbouringTimeline(Ms.a.Backward))||void 0===t?void 0:t.getEvents().length,nextTimeline:null===(a=e.timelineSet.getLiveTimeline().getNeighbouringTimeline(Ms.a.Forward))||void 0===a?void 0:a.getEvents().length}})}catch(e){la.a.error("onDumpDebugLogs: Failed to serialize event IDs from the threads",e)}}let u,m;try{u=this.timelineWindow.getEvents().map(e=>e.getId())}catch(e){la.a.error("onDumpDebugLogs: Failed to get event IDs from the timelineWindow",e)}try{m=this.props.timelineSet.getPendingEvents().map(e=>e.getId())}catch(e){la.a.error("onDumpDebugLogs: Failed to get pending event IDs",e)}la.a.debug(`TimelinePanel(${this.context.timelineRenderingType}): Debugging info for ${null==r?void 0:r.roomId}\n\tevents(${s.length})=${JSON.stringify(s)}\n\trenderedEventIds(${null!==(n=null===(i=o)||void 0===i?void 0:i.length)&&void 0!==n?n:0})=`+JSON.stringify(o)+"\n"+`\tserializedEventIdsFromTimelineSets=${JSON.stringify(c)}\n\tserializedEventIdsFromThreadsTimelineSets=`+JSON.stringify(l)+"\n"+`\tserializedThreadsMap=${JSON.stringify(d)}\n`+`\ttimelineWindowEventIds(${u.length})=${JSON.stringify(u)}\n`+`\tpendingEventIds(${m.length})=${JSON.stringify(m)}`)}),i()(this,"onMessageListUnfillRequest",(e,t)=>{const a=e?Ms.b.BACKWARDS:Ms.b.FORWARDS;zs("unpaginating events in direction",a);const n=t,i=this.state.events.findIndex(e=>e.getId()===n),r=e?i+1:this.state.events.length-i;if(r>0){zs("Unpaginating",r,"in direction",a),this.timelineWindow.unpaginate(r,e);const{events:t,liveEvents:n,firstVisibleEventIndex:i}=this.getEvents();this.buildLegacyCallEventGroupers(t);const s={events:t,liveEvents:n,firstVisibleEventIndex:i};e?s.canBackPaginate=!0:s.canForwardPaginate=!0,this.setState(s)}}),i()(this,"onPaginationRequest",(e,t,a)=>this.props.onPaginationRequest?this.props.onPaginationRequest(e,t,a):e.paginate(t,a)),i()(this,"onMessageListFillRequest",e=>{if(!this.shouldPaginate())return Promise.resolve(!1);const t=e?Ms.b.BACKWARDS:Ms.b.FORWARDS,a=e?"canBackPaginate":"canForwardPaginate",n=e?"backPaginating":"forwardPaginating";return this.state[a]?this.timelineWindow.canPaginate(t)?e&&0!==this.state.firstVisibleEventIndex?(zs("won't",t,"paginate past first visible event"),Promise.resolve(!1)):(zs("Initiating paginate; backwards:"+e),this.setState({[n]:!0}),this.onPaginationRequest(this.timelineWindow,t,20).then(t=>{if(this.unmounted)return;zs("paginate complete backwards:"+e+"; success:"+t);const{events:i,liveEvents:r,firstVisibleEventIndex:s}=this.getEvents();this.buildLegacyCallEventGroupers(i);const o={[n]:!1,[a]:t,events:i,liveEvents:r,firstVisibleEventIndex:s},c=e?Ms.b.FORWARDS:Ms.b.BACKWARDS,l=e?"canForwardPaginate":"canBackPaginate";return!this.state[l]&&this.timelineWindow.canPaginate(c)&&(zs("can now",c,"paginate again"),o[l]=!0),new Promise(a=>{this.setState(o,()=>{a(t&&(!e||0===s))})})})):(zs("can't",t,"paginate any further"),this.setState({[a]:!1}),Promise.resolve(!1)):(zs("have given up",t,"paginating this timeline"),Promise.resolve(!1))}),i()(this,"onMessageListScroll",e=>{var t,a;null===(t=(a=this.props).onScroll)||void 0===t||t.call(a,e),this.props.manageReadMarkers&&this.doManageReadMarkers()}),i()(this,"doManageReadMarkers",Object(k.debounce)(()=>{var e;const t=this.getReadMarkerPosition();t<0&&this.setState({readMarkerVisible:!0});const a=this.readMarkerTimeout(t);null===(e=this.readMarkerActivityTimer)||void 0===e||e.changeTimeout(a)},100,{leading:!1,trailing:!0})),i()(this,"onAction",e=>{switch(e.action){case"ignore_state_changed":this.forceUpdate();break;case L.a.DumpDebugLogs:this.onDumpDebugLogs()}}),i()(this,"onRoomTimeline",(e,t,a,n,i)=>{var r;i.timeline.getTimelineSet()===this.props.timelineSet&&(an.e.hasServerSideSupport||this.context.timelineRenderingType!==Un.a.Thread||(a&&!this.state.canBackPaginate&&this.setState({canBackPaginate:!0}),a||this.state.canForwardPaginate||this.setState({canForwardPaginate:!0})),!a&&i&&i.liveEvent&&null!==(r=this.messagePanel.current)&&void 0!==r&&r.getScrollState()&&(this.messagePanel.current.getScrollState().stuckAtBottom?this.timelineWindow.paginate(Ms.b.FORWARDS,1,!1).then(()=>{if(this.unmounted)return;const{events:t,liveEvents:a,firstVisibleEventIndex:n}=this.getEvents();this.buildLegacyCallEventGroupers(t);const i=a[a.length-1],r={events:t,liveEvents:a,firstVisibleEventIndex:n};let s;if(this.props.manageReadMarkers){const t=st.a.get().credentials.userId;s=!1,e.getSender()===t||Us.a.sharedInstance().userActiveRecently()?i&&0===this.getReadMarkerPosition()&&(this.setReadMarker(i.getId(),i.getTs(),!0),r.readMarkerVisible=!1,r.readMarkerEventId=i.getId(),s=!0):r.readMarkerVisible=!0}this.setState(r,()=>{var e,t,a;(null===(e=this.messagePanel.current)||void 0===e||e.updateTimelineMinHeight(),s)&&(null===(t=(a=this.props).onReadMarkerUpdated)||void 0===t||t.call(a))})}):this.setState({canForwardPaginate:!0})))}),i()(this,"onRoomTimelineReset",(e,t)=>{t===this.props.timelineSet&&this.messagePanel.current&&this.messagePanel.current.isAtBottom()&&this.loadTimeline()}),i()(this,"canResetTimeline",()=>{var e;return null===(e=this.messagePanel)||void 0===e?void 0:e.current.isAtBottom()}),i()(this,"onRoomRedaction",(e,t)=>{this.unmounted||t===this.props.timelineSet.room&&this.forceUpdate()}),i()(this,"onEventVisibilityChange",e=>{var t,a;if(this.unmounted)return;if(e.getRoomId()!==(null===(t=this.props.timelineSet.room)||void 0===t?void 0:t.roomId))return;const n=null===(a=this.messagePanel.current)||void 0===a?void 0:a.getTileForEventId(e.getId());n&&n.forceUpdate()}),i()(this,"onVisibilityPowerLevelChange",(e,t)=>{var a,n;if(!this.unmounted&&t.roomId===(null===(a=this.props.timelineSet.room)||void 0===a?void 0:a.roomId)&&t.userId==(null===(n=st.a.get().credentials)||void 0===n?void 0:n.userId)){for(const e of this.state.events){var i;const t=null===(i=this.messagePanel.current)||void 0===i?void 0:i.getTileForEventId(e.getId());t&&t.forceUpdate()}this.forceUpdate()}}),i()(this,"onEventReplaced",e=>{this.unmounted||e.getRoomId()===this.props.timelineSet.room.roomId&&this.forceUpdate()}),i()(this,"onRoomReceipt",(e,t)=>{this.unmounted||t===this.props.timelineSet.room&&this.forceUpdate()}),i()(this,"onLocalEchoUpdated",(e,t,a)=>{this.unmounted||t===this.props.timelineSet.room&&this.reloadEvents()}),i()(this,"onAccountData",(e,t)=>{this.unmounted||t===this.props.timelineSet.room&&e.getType()===Z.b.FullyRead&&this.setState({readMarkerEventId:e.getContent().event_id},this.props.onReadMarkerUpdated)}),i()(this,"onEventDecrypted",e=>{this.props.timelineSet.room&&e.getRoomId()===this.props.timelineSet.room.roomId&&this.state.events.includes(e)&&(this.recheckFirstVisibleEventIndex(),this.buildLegacyCallEventGroupers(this.state.events),this.forceUpdate())}),i()(this,"onSync",(e,t,a)=>{this.unmounted||this.setState({clientSyncState:e})}),i()(this,"recheckFirstVisibleEventIndex",Object(k.throttle)(()=>{const e=this.checkForPreJoinUISI(this.state.events);e!==this.state.firstVisibleEventIndex&&this.setState({firstVisibleEventIndex:e})},500,{leading:!0,trailing:!0})),i()(this,"sendReadReceipt",()=>{var e;if(f.b.getValue("lowBandwidth"))return;if(!this.messagePanel.current)return;if(!this.props.manageReadReceipts)return;const t=st.a.get();if(!t||t.isGuest())return;let a=!0;const n=this.getCurrentReadReceipt(!0),i=this.indexForEventId(n);n&&null===i&&this.timelineWindow.canPaginate(Ms.b.FORWARDS)&&(a=!1);const r=this.getLastDisplayedEventIndex({ignoreOwn:!0});null===r&&(a=!1);let s=this.state.events[null!=r?r:0];a=a&&r>i&&this.lastRRSentEventId!==(null===(e=s)||void 0===e?void 0:e.getId());const o=this.lastRMSentEventId!=this.state.readMarkerEventId;if(a||o){var c,l,d;if(a)this.lastRRSentEventId=null===(d=s)||void 0===d?void 0:d.getId();else s=null;this.lastRMSentEventId=this.state.readMarkerEventId;const e=this.props.timelineSet.room.roomId,n=f.b.getValue("sendReadReceipts",e);var u,m,h;if(zs(`Sending Read Markers for ${this.props.timelineSet.room.roomId}: `,`rm=${this.state.readMarkerEventId} `,`rr=${n?null===(c=s)||void 0===c?void 0:c.getId():null} `,"prr="+(null===(l=s)||void 0===l?void 0:l.getId())),this.props.timelineSet.thread&&n&&s)t.sendReadReceipt(s,n?Ls.a.Read:Ls.a.ReadPrivate);else t.setRoomReadMarkers(e,null!==(u=this.state.readMarkerEventId)&&void 0!==u?u:"",n&&null!==(m=s)&&void 0!==m?m:void 0,null!==(h=s)&&void 0!==h?h:void 0).catch(async e=>{if("M_UNRECOGNIZED"===e.errcode&&s){if(!n&&!await t.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")&&!await t.isVersionSupported("v1.4"))return;try{return await t.sendReadReceipt(s,n?Ls.a.Read:Ls.a.ReadPrivate)}catch(t){la.a.error(e),this.lastRRSentEventId=void 0}}else la.a.error(e);this.lastRRSentEventId=void 0,this.lastRMSentEventId=void 0}),this.isAtEndOfLiveTimeline()&&(this.props.timelineSet.room.setUnreadNotificationCount(ee.b.Total,0),this.props.timelineSet.room.setUnreadNotificationCount(ee.b.Highlight,0),v.a.dispatch({action:"on_room_read",roomId:this.props.timelineSet.room.roomId}))}}),i()(this,"updateReadMarker",()=>{if(!this.props.manageReadMarkers)return;if(1===this.getReadMarkerPosition())return;const e=this.getLastDisplayedEventIndex({allowPartial:!0});if(null===e)return;const t=this.state.events[e];this.setReadMarker(t.getId(),t.getTs()),this.state.readMarkerVisible&&this.setState({readMarkerVisible:!1}),this.sendReadReceipt()}),i()(this,"jumpToLiveTimeline",()=>{var e;this.timelineWindow.canPaginate(Ms.b.FORWARDS)?this.loadTimeline():null===(e=this.messagePanel.current)||void 0===e||e.scrollToBottom()}),i()(this,"scrollToEventIfNeeded",e=>{var t;null===(t=this.messagePanel.current)||void 0===t||t.scrollToEventIfNeeded(e)}),i()(this,"jumpToReadMarker",()=>{if(!this.props.manageReadMarkers)return;if(!this.messagePanel.current)return;if(!this.state.readMarkerEventId)return;null===this.messagePanel.current.getReadMarkerPosition()?this.loadTimeline(this.state.readMarkerEventId,0,1/3):this.messagePanel.current.scrollToEvent(this.state.readMarkerEventId,0,1/3)}),i()(this,"forgetReadMarker",()=>{if(!this.props.manageReadMarkers)return;const e=this.getCurrentReadReceipt(),t=this.props.timelineSet.getTimelineForEvent(null!=e?e:"");let a;if(t){const n=t.getEvents().find(t=>t.getId()==e);n&&(a=n.getTs())}this.setReadMarker(e,a),this.sendReadReceipt()}),i()(this,"isAtEndOfLiveTimeline",()=>{var e;return(null===(e=this.messagePanel.current)||void 0===e?void 0:e.isAtBottom())&&this.timelineWindow&&!this.timelineWindow.canPaginate(Ms.b.FORWARDS)}),i()(this,"getScrollState",()=>this.messagePanel.current?this.messagePanel.current.getScrollState():null),i()(this,"getReadMarkerPosition",()=>{if(!this.props.manageReadMarkers)return null;if(!this.messagePanel.current)return null;const e=this.messagePanel.current.getReadMarkerPosition();if(null!==e)return e;const t=Ws.roomReadMarkerTsMap[this.props.timelineSet.room.roomId];return t&&this.state.events.length>0?t<this.state.events[0].getTs()?-1:1:null}),i()(this,"canJumpToReadMarker",()=>{const e=this.getReadMarkerPosition();return null!==this.state.readMarkerEventId&&(e<0||null===e)}),i()(this,"handleScrollKey",e=>{if(!this.messagePanel.current)return;Object(J.a)().getRoomAction(e)===V.h.JumpToLatestMessage?this.jumpToLiveTimeline():this.messagePanel.current.handleScrollKey(e)}),i()(this,"getRelationsForEvent",(e,t,a)=>{var n;return null===(n=this.props.timelineSet.relations)||void 0===n?void 0:n.getChildEventsForEvent(e,t,a)}),this.context=t,zs("mounting");let a=null;if(this.props.manageReadMarkers){const e=this.props.timelineSet.room.getAccountData("m.fully_read");a=e?e.getContent().event_id:this.getCurrentReadReceipt()}this.state={events:[],liveEvents:[],timelineLoading:!0,firstVisibleEventIndex:0,canBackPaginate:!1,canForwardPaginate:!1,readMarkerVisible:!0,readMarkerEventId:a,backPaginating:!1,forwardPaginating:!1,clientSyncState:st.a.get().getSyncState(),isTwelveHour:f.b.getValue("showTwelveHourTimestamps"),alwaysShowTimestamps:f.b.getValue("alwaysShowTimestamps"),readMarkerInViewThresholdMs:f.b.getValue("readMarkerInViewThresholdMs"),readMarkerOutOfViewThresholdMs:f.b.getValue("readMarkerOutOfViewThresholdMs")},this.dispatcherRef=v.a.register(this.onAction);const n=st.a.get();n.on(ee.d.Timeline,this.onRoomTimeline),n.on(ee.d.TimelineReset,this.onRoomTimelineReset),n.on(ee.d.Redaction,this.onRoomRedaction),f.b.getValue("feature_msc3531_hide_messages_pending_moderation")&&(n.on(tn.c.VisibilityChange,this.onEventVisibilityChange),n.on(Wi.b.PowerLevel,this.onVisibilityPowerLevelChange)),n.on(ee.d.RedactionCancelled,this.onRoomRedaction),n.on(ee.d.Receipt,this.onRoomReceipt),n.on(ee.d.LocalEchoUpdated,this.onLocalEchoUpdated),n.on(ee.d.AccountData,this.onAccountData),n.on(tn.c.Decrypted,this.onEventDecrypted),n.on(tn.c.Replaced,this.onEventReplaced),n.on(o.b.Sync,this.onSync)}UNSAFE_componentWillMount(){this.props.manageReadReceipts&&this.updateReadReceiptOnUserActivity(),this.props.manageReadMarkers&&this.updateReadMarkerOnUserActivity(),this.initTimeline(this.props)}UNSAFE_componentWillReceiveProps(e){e.timelineSet!==this.props.timelineSet&&la.a.warn("Replacing timelineSet on a TimelinePanel - confusion may ensue");const t=e.eventId!=this.props.eventId,a=e.highlightedEventId!=this.props.highlightedEventId,n=e.eventScrollIntoView&&!this.props.eventScrollIntoView;if(t||a||n)return la.a.log("TimelinePanel switching to eventId "+e.eventId+" (was "+this.props.eventId+"), scrollIntoView: "+e.eventScrollIntoView+" (was "+this.props.eventScrollIntoView+")"),this.initTimeline(e)}componentWillUnmount(){this.unmounted=!0,this.readReceiptActivityTimer&&(this.readReceiptActivityTimer.abort(),this.readReceiptActivityTimer=null),this.readMarkerActivityTimer&&(this.readMarkerActivityTimer.abort(),this.readMarkerActivityTimer=null),v.a.unregister(this.dispatcherRef);const e=st.a.get();e&&(e.removeListener(ee.d.Timeline,this.onRoomTimeline),e.removeListener(ee.d.TimelineReset,this.onRoomTimelineReset),e.removeListener(ee.d.Redaction,this.onRoomRedaction),e.removeListener(ee.d.RedactionCancelled,this.onRoomRedaction),e.removeListener(ee.d.Receipt,this.onRoomReceipt),e.removeListener(ee.d.LocalEchoUpdated,this.onLocalEchoUpdated),e.removeListener(ee.d.AccountData,this.onAccountData),e.removeListener(Wi.b.PowerLevel,this.onVisibilityPowerLevelChange),e.removeListener(tn.c.Decrypted,this.onEventDecrypted),e.removeListener(tn.c.Replaced,this.onEventReplaced),e.removeListener(tn.c.VisibilityChange,this.onEventVisibilityChange),e.removeListener(o.b.Sync,this.onSync))}readMarkerTimeout(e){var t,a,n,i;return 0===e?null!==(t=null===(a=this.context)||void 0===a?void 0:a.readMarkerInViewThresholdMs)&&void 0!==t?t:this.state.readMarkerInViewThresholdMs:null!==(n=null===(i=this.context)||void 0===i?void 0:i.readMarkerOutOfViewThresholdMs)&&void 0!==n?n:this.state.readMarkerOutOfViewThresholdMs}async updateReadMarkerOnUserActivity(){const e=this.readMarkerTimeout(this.getReadMarkerPosition());for(this.readMarkerActivityTimer=new Fs.a(e);this.readMarkerActivityTimer;){Us.a.sharedInstance().timeWhileActiveRecently(this.readMarkerActivityTimer);try{await this.readMarkerActivityTimer.finished()}catch(e){continue}this.updateReadMarker()}}async updateReadReceiptOnUserActivity(){for(this.readReceiptActivityTimer=new Fs.a(500);this.readReceiptActivityTimer;){Us.a.sharedInstance().timeWhileActiveNow(this.readReceiptActivityTimer);try{await this.readReceiptActivityTimer.finished()}catch(e){continue}this.sendReadReceipt()}}advanceReadMarkerPastMyEvents(){if(!this.props.manageReadMarkers)return;const e=this.timelineWindow.getEvents();let t;for(t=0;t<e.length&&e[t].getId()!=this.state.readMarkerEventId;t++);if(t>=e.length)return;const a=st.a.get().credentials.userId;for(t++;t<e.length;t++){if(e[t].getSender()!==a)break}t--;const n=e[t];this.setReadMarker(n.getId(),n.getTs())}initTimeline(e){const t=e.eventId,a=e.eventPixelOffset;let n=1;return null==a&&(n=.5),this.loadTimeline(t,a,n,e.eventScrollIntoView)}scrollIntoView(e,t,a){var n,i;const r=()=>{this.messagePanel.current&&(e?(zs("TimelinePanel scrolling to eventId "+e+" at position "+100*a+"% + "+t),this.messagePanel.current.scrollToEvent(e,t,a)):(zs("TimelinePanel scrolling to bottom"),this.messagePanel.current.scrollToBottom()))};zs("TimelinePanel scheduling scroll to event"),null===(n=(i=this.props).onEventScrolledIntoView)||void 0===n||n.call(i,e),r(),window.requestAnimationFrame(()=>{r()})}loadTimeline(e,t,a){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=st.a.get();this.timelineWindow=new As.b(i,this.props.timelineSet,{windowLimit:this.props.timelineCap});const r=()=>{var i;this.unmounted||(null===(i=this.messagePanel.current)||void 0===i||i.onTimelineReset(),this.reloadEvents(),this.advanceReadMarkerPastMyEvents(),this.setState({canBackPaginate:this.timelineWindow.canPaginate(Ms.b.BACKWARDS),canForwardPaginate:this.timelineWindow.canPaginate(Ms.b.FORWARDS),timelineLoading:!1},()=>{this.messagePanel.current?(n&&this.scrollIntoView(e,t,a),this.props.sendReadReceiptOnLoad&&this.sendReadReceipt()):la.a.log("can't initialise scroll state because messagePanel didn't load")}))};if(this.props.timelineSet.getTimelineForEvent(e))return this.timelineWindow.load(e,20),void r();const s=this.timelineWindow.load(e,20);this.buildLegacyCallEventGroupers(),this.setState({events:[],liveEvents:[],canBackPaginate:!1,canForwardPaginate:!1,timelineLoading:!0}),s.then(r,t=>{var a;if(this.unmounted)return;let n,i;this.setState({timelineLoading:!1}),la.a.error(`Error loading timeline panel at ${null===(a=this.props.timelineSet.room)||void 0===a?void 0:a.roomId}/${e}`,t),e&&(n=()=>{v.a.dispatch({action:L.a.ViewRoom,room_id:this.props.timelineSet.room.roomId,metricsTrigger:void 0})}),i="M_FORBIDDEN"==t.errcode?Object(N.a)("Tried to load a specific point in this room's timeline, but you do not have permission to view the message in question."):Object(N.a)("Tried to load a specific point in this room's timeline, but was unable to find it."),z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to load timeline position"),description:i,onFinished:n})})}reloadEvents(){if(this.unmounted)return;const e=this.getEvents();this.buildLegacyCallEventGroupers(e.events),this.setState(e)}refreshTimeline(e){this.loadTimeline(e,void 0,void 0,!1),this.reloadEvents()}getEvents(){const e=this.timelineWindow.getEvents();Object(nn.b)(e).reverse().forEach(e=>{st.a.get().decryptEventIfNeeded(e)});const t=this.checkForPreJoinUISI(e),a=[...e];if(!this.timelineWindow.canPaginate(Ms.b.FORWARDS)){const t=this.props.timelineSet.getPendingEvents();e.push(...t.filter(e=>{const{shouldLiveInRoom:a,threadId:n}=this.props.timelineSet.room.eventShouldLiveIn(e,t);return this.context.timelineRenderingType===Un.a.Thread?n===this.context.threadId:a}))}return{events:e,liveEvents:a,firstVisibleEventIndex:t}}checkForPreJoinUISI(e){const t=st.a.get(),a=this.props.timelineSet.room,n=[Un.a.Thread,Un.a.ThreadsList].includes(this.context.timelineRenderingType);if(0===e.length||!a||!t.isRoomEncrypted(a.roomId)||n)return la.a.info("checkForPreJoinUISI: showing all messages, skipping check"),0;const i=t.credentials.userId;let r=e.length-1,s="leave";for(;r>=0;r--){var o,c;const t=a.getTimelineForEvent(e[r].getId());if(!t){la.a.warn(`Event ${e[r].getId()} in room ${a.roomId} is live, but it does not have a timeline`);continue}s=null!==(o=null===(c=t.getState(Ms.b.FORWARDS).getMember(i))||void 0===c?void 0:c.membership)&&void 0!==o?o:"leave";const n=t.getEvents();for(let t=n.length-1;t>=0;t--){const a=n[t];if(a.getId()===e[r].getId())break;a.getStateKey()===i&&a.getType()===Z.b.RoomMember&&(s=a.getPrevContent().membership||"leave")}break}for(;r>=0;r--){const t=e[r];if(t.getStateKey()===i&&t.getType()===Z.b.RoomMember)s=t.getPrevContent().membership||"leave";else if("leave"===s&&(t.isDecryptionFailure()||t.isBeingDecrypted()))return la.a.info("checkForPreJoinUISI: reached a pre-join UISI at index ",r),r+1}return la.a.info("checkForPreJoinUISI: did not find pre-join UISI"),0}indexForEventId(e){if(null===e)return null;const t=this.context.timelineRenderingType===Un.a.Thread;if(f.b.getValue("feature_thread")&&t)return 0;const a=this.state.events.findIndex(t=>t.getId()===e);return a>-1?a:null}getLastDisplayedEventIndex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=e.ignoreOwn||!1,a=e.allowPartial||!1,n=this.messagePanel.current;if(!n)return null;const i=Lt.a.findDOMNode(n);if(!i)return null;const r=i.getBoundingClientRect(),s=st.a.get().credentials.userId,o=e=>{if(e){const t=e.getBoundingClientRect();if(a&&t.top<=r.bottom||!a&&t.bottom<=r.bottom)return!0}return!1};let c=0;for(let e=this.state.liveEvents.length-1;e>=0;--e){var l;const a=this.state.liveEvents[e],i=n.getNodeForEventId(a.getId()),r=o(i);if(r&&0!==c)return e+c;i&&!r&&(c=0);const d=!!a.status||t&&a.getSender()===s;if(!(!Object(Cr.c)(a,null===(l=this.context)||void 0===l?void 0:l.showHiddenEvents)||Object(wi.a)(a,this.context))&&i){if(!d&&r)return e}else(!d||d&&0!==c)&&++c}return null}getCurrentReadReceipt(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=st.a.get();if(null==a)return null;const n=a.credentials.userId,i=null!==(e=this.props.timelineSet.thread)&&void 0!==e?e:this.props.timelineSet.room;return null==i?void 0:i.getEventReadUpTo(n,t)}setReadMarker(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=null===(a=this.props.timelineSet.room)||void 0===a?void 0:a.roomId;e!==this.state.readMarkerEventId&&null!==e&&(Ws.roomReadMarkerTsMap[null!=i?i:""]=t,n||this.setState({readMarkerEventId:e},this.props.onReadMarkerUpdated))}shouldPaginate(){return!this.state.events.some(e=>e.isBeingDecrypted())}buildLegacyCallEventGroupers(e){this.callEventGroupers=Object(Vs.c)(this.callEventGroupers,e)}render(){var e,t,a,n,i;if(this.state.timelineLoading)return s.a.createElement("div",{className:"mx_RoomView_messagePanelSpinner"},s.a.createElement(Ya.a,null));if(0==this.state.events.length&&!this.state.canBackPaginate&&this.props.empty)return s.a.createElement("div",{className:this.props.className+" mx_RoomView_messageListWrapper"},s.a.createElement("div",{className:"mx_RoomView_empty"},this.props.empty));const r=!this.timelineWindow.canPaginate(Ms.b.FORWARDS),o=this.state.forwardPaginating||["PREPARED","CATCHUP"].includes(this.state.clientSyncState),c=this.state.firstVisibleEventIndex?this.state.events.slice(this.state.firstVisibleEventIndex):this.state.events;return s.a.createElement(Bs.a,{ref:this.messagePanel,room:this.props.timelineSet.room,permalinkCreator:this.props.permalinkCreator,hidden:this.props.hidden,backPaginating:this.state.backPaginating,forwardPaginating:o,events:c,highlightedEventId:this.props.highlightedEventId,readMarkerEventId:this.state.readMarkerEventId,readMarkerVisible:this.state.readMarkerVisible,canBackPaginate:this.state.canBackPaginate&&0===this.state.firstVisibleEventIndex,showUrlPreview:this.props.showUrlPreview,showReadReceipts:this.props.showReadReceipts,ourUserId:st.a.get().credentials.userId,stickyBottom:r,onScroll:this.onMessageListScroll,onFillRequest:this.onMessageListFillRequest,onUnfillRequest:this.onMessageListUnfillRequest,isTwelveHour:null!==(e=null===(t=this.context)||void 0===t?void 0:t.showTwelveHourTimestamps)&&void 0!==e?e:this.state.isTwelveHour,alwaysShowTimestamps:null!==(a=null!==(n=this.props.alwaysShowTimestamps)&&void 0!==n?n:null===(i=this.context)||void 0===i?void 0:i.alwaysShowTimestamps)&&void 0!==a?a:this.state.alwaysShowTimestamps,className:this.props.className,resizeNotifier:this.props.resizeNotifier,getRelationsForEvent:this.getRelationsForEvent,editState:this.props.editState,showReactions:this.props.showReactions,layout:this.props.layout,hideThreadedMessages:this.props.hideThreadedMessages,disableGrouping:this.props.disableGrouping,callEventGroupers:this.callEventGroupers})}}function Hs(e){return e.map(e=>{const t={},a=e.getTimelines(),n=e.getLiveTimeline();return a.forEach((e,a)=>{t[e===n?"liveTimeline":""+a]=e.getEvents().map(e=>e.getId())}),t})}i()(Ws,"contextType",Un.b),i()(Ws,"roomReadMarkerTsMap",{}),i()(Ws,"defaultProps",{timelineCap:Number.MAX_VALUE,className:"mx_RoomView_messagePanel",sendReadReceiptOnLoad:!0,hideThreadedMessages:!0,disableGrouping:!1});var Gs=Ws,qs=a(168);class Ks extends s.a.PureComponent{constructor(e){super(e),i()(this,"instanceId",void 0),i()(this,"onResize",(e,t)=>{e===$.a.Resize&&this.props.onMeasurement(t.contentRect.width<=this.props.breakpoint)}),this.instanceId=Ks.instanceCount++}componentDidMount(){$.b.instance.on("Measured"+this.instanceId,this.onResize)}componentDidUpdate(e){const t=e.sensor,a=this.props.sensor;t!==a&&(t&&$.b.instance.stopTrackingElementDimensions("Measured"+this.instanceId),a&&$.b.instance.trackElementDimensions("Measured"+this.instanceId,this.props.sensor))}componentWillUnmount(){$.b.instance.off("Measured"+this.instanceId,this.onResize),$.b.instance.stopTrackingElementDimensions("Measured"+this.instanceId)}render(){return null}}function Ys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Js(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ys(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ys(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}i()(Ks,"instanceCount",0),i()(Ks,"defaultProps",{breakpoint:500});class $s extends s.a.Component{constructor(){super(...arguments),i()(this,"decryptingEvents",new Set),i()(this,"noRoom",void 0),i()(this,"card",Object(r.createRef)()),i()(this,"state",{timelineSet:null,narrow:!1}),i()(this,"onRoomTimeline",(e,t,a,n,i)=>{var r;if((null==t?void 0:t.roomId)!==(null===(r=this.props)||void 0===r?void 0:r.roomId))return;if(a||!i||!i.liveEvent||e.isRedacted())return;st.a.get().decryptEventIfNeeded(e),e.isBeingDecrypted()?this.decryptingEvents.add(e.getId()):this.addEncryptedLiveEvent(e)}),i()(this,"onEventDecrypted",(e,t)=>{if(e.getRoomId()!==this.props.roomId)return;const a=e.getId();this.decryptingEvents.delete(a)&&(t||this.addEncryptedLiveEvent(e))}),i()(this,"onPaginationRequest",(e,t,a)=>{const n=st.a.get(),i=ki.a.get(),r=this.props.roomId,s=n.getRoom(r);return n.isRoomEncrypted(r)&&null!==i?i.paginateTimelineWindow(s,e,t,a):e.paginate(t,a)}),i()(this,"onMeasurement",e=>{this.setState({narrow:e})})}addEncryptedLiveEvent(e){if(!this.state.timelineSet)return;const t=this.state.timelineSet.getLiveTimeline();"m.room.message"===e.getType()&&-1!=["m.file","m.image","m.video","m.audio"].indexOf(e.getContent().msgtype)&&(this.state.timelineSet.eventIdToTimeline(e.getId())||this.state.timelineSet.addEventToTimeline(e,t,!1))}async componentDidMount(){const e=st.a.get();await this.updateTimelineSet(this.props.roomId),st.a.get().isRoomEncrypted(this.props.roomId)&&null!==ki.a.get()&&(e.on(ee.d.Timeline,this.onRoomTimeline),e.on(tn.c.Decrypted,this.onEventDecrypted))}componentWillUnmount(){const e=st.a.get();null!==e&&st.a.get().isRoomEncrypted(this.props.roomId)&&null!==ki.a.get()&&(e.removeListener(ee.d.Timeline,this.onRoomTimeline),e.removeListener(tn.c.Decrypted,this.onEventDecrypted))}async fetchFileEventsServer(e){const t=st.a.get(),a=new Ns.a(t.credentials.userId);a.setDefinition({room:{timeline:{contains_url:!0,types:["m.room.message"]}}});const n=await t.getOrCreateFilter("FILTER_FILES_"+t.credentials.userId,a);a.filterId=n;return e.getOrCreateFilteredTimelineSet(a)}async updateTimelineSet(e){const t=st.a.get(),a=t.getRoom(e),n=ki.a.get();if(this.noRoom=!a,a){let i;try{if(i=await this.fetchFileEventsServer(a),t.isRoomEncrypted(e)&&null!==n){const e=i.getLiveTimeline();await n.populateFileTimeline(i,e,a,10)}this.setState({timelineSet:i})}catch(e){la.a.error("Failed to get or create file panel filter",e)}}else la.a.error("Failed to add filtered timelineSet for FilePanel as no room!")}render(){if(st.a.get().isGuest())return s.a.createElement(Ji,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose},s.a.createElement("div",{className:"mx_RoomView_empty"},Object(N.a)("You must <a>register</a> to use this functionality",{},{a:e=>s.a.createElement("a",{href:"#/register",key:"sub"},e)})));if(this.noRoom)return s.a.createElement(Ji,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose},s.a.createElement("div",{className:"mx_RoomView_empty"},Object(N.a)("You must join the room to see its files")));const e=s.a.createElement("div",{className:"mx_RightPanel_empty mx_FilePanel_empty"},s.a.createElement("h2",null,Object(N.a)("No files visible in this room")),s.a.createElement("p",null,Object(N.a)("Attach files from chat or just drag and drop them anywhere in a room."))),t=!this.noRoom&&st.a.get().isRoomEncrypted(this.props.roomId);return this.state.timelineSet?s.a.createElement(Un.b.Provider,{value:Js(Js({},this.context),{},{timelineRenderingType:Un.a.File,narrow:this.state.narrow})},s.a.createElement(Ji,{className:"mx_FilePanel",onClose:this.props.onClose,withoutScrollContainer:!0,ref:this.card},s.a.createElement(Ks,{sensor:this.card.current,onMeasurement:this.onMeasurement}),s.a.createElement(Ps,{isRoomEncrypted:t,kind:Ds.Files}),s.a.createElement(Gs,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:this.state.timelineSet,showUrlPreview:!1,onPaginationRequest:this.onPaginationRequest,resizeNotifier:this.props.resizeNotifier,empty:e,layout:qs.a.Group}))):s.a.createElement(Un.b.Provider,{value:Js(Js({},this.context),{},{timelineRenderingType:Un.a.File})},s.a.createElement(Ji,{className:"mx_FilePanel",onClose:this.props.onClose},s.a.createElement(Ya.a,null)))}}i()($s,"contextType",Un.b);var Qs=$s;class Xs extends s.a.Component{constructor(e){super(e),i()(this,"resize",()=>{this.props.onResize&&this.props.onResize()})}componentDidMount(){window.addEventListener("resize",this.resize)}componentWillUnmount(){window.removeEventListener("resize",this.resize)}render(){return s.a.createElement("div",null,this.props.element)}}class Zs extends s.a.PureComponent{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"prevSentVisibility",void 0),i()(this,"popoverWidth",300),i()(this,"popoverHeight",300),i()(this,"scalarClient",null),i()(this,"removeStickerpickerWidgets",async()=>{const e=await this.acquireScalarClient();la.a.log("Removing Stickerpicker widgets"),this.state.widgetId?e?e.disableWidgetAssets(Za.a.STICKERPICKER,this.state.widgetId).then(()=>{la.a.log("Assets disabled")}).catch(()=>{la.a.error("Failed to disable assets")}):la.a.error("Cannot disable assets: no scalar client"):la.a.warn("No widget ID specified, not disabling assets"),this.props.setStickerPickerOpen(!1),Ba.a.removeStickerpickerWidgets().then(()=>{this.forceUpdate()}).catch(e=>{la.a.error("Failed to remove sticker picker widget",e)})}),i()(this,"updateWidget",()=>{const e=Ba.a.getStickerpickerWidgets()[0];if(!e)return Zs.currentWidget=null,void this.setState({stickerpickerWidget:null,widgetId:null});const t=Zs.currentWidget;let a=null;t&&t.content&&t.content.url&&(a=t.content.url);let n=null;e&&e.content&&e.content.url&&(n=e.content.url),n!==a&&Xa.destroyElement("stickerPicker"),Zs.currentWidget=e,this.setState({stickerpickerWidget:e,widgetId:e?e.id:null})}),i()(this,"onAction",e=>{switch(e.action){case"user_widget_updated":this.forceUpdate();break;case"stickerpicker_close":this.props.setStickerPickerOpen(!1);break;case"show_left_panel":case"hide_left_panel":this.props.setStickerPickerOpen(!1)}}),i()(this,"onRightPanelStoreUpdate",()=>{this.props.setStickerPickerOpen(!1)}),i()(this,"onResize",()=>{this.props.isStickerPickerOpen&&this.props.setStickerPickerOpen(!1)}),i()(this,"onFinished",()=>{this.props.isStickerPickerOpen&&this.props.setStickerPickerOpen(!1)}),i()(this,"launchManageIntegrations",()=>{_n.a.sharedInstance().getPrimaryManager().open(this.props.room,"type_"+Za.a.STICKERPICKER.preferred,this.state.widgetId)}),this.state={imError:null,stickerpickerWidget:null,widgetId:null}}acquireScalarClient(){return this.scalarClient?Promise.resolve(this.scalarClient):_n.a.sharedInstance().hasManager()?(this.scalarClient=_n.a.sharedInstance().getPrimaryManager().getScalarClient(),this.scalarClient.connect().then(()=>(this.forceUpdate(),this.scalarClient)).catch(e=>{this.imError(Object(N.c)("Failed to connect to integration manager"),e)})):void _n.a.sharedInstance().openNoManagerDialog()}componentDidMount(){window.addEventListener("resize",this.onResize),this.dispatcherRef=v.a.register(this.onAction),st.a.get().on(ee.d.AccountData,this.updateWidget),Gi.a.instance.on(mt.b,this.onRightPanelStoreUpdate),this.updateWidget()}componentWillUnmount(){const e=st.a.get();e&&e.removeListener(ee.d.AccountData,this.updateWidget),Gi.a.instance.off(mt.b,this.onRightPanelStoreUpdate),window.removeEventListener("resize",this.onResize),this.dispatcherRef&&v.a.unregister(this.dispatcherRef)}componentDidUpdate(){this.sendVisibilityToWidget(this.props.isStickerPickerOpen)}imError(e,t){la.a.error(e,t),this.setState({imError:Object(N.a)(e)}),this.props.setStickerPickerOpen(!1)}defaultStickerpickerContent(){return s.a.createElement(H.a,{onClick:this.launchManageIntegrations,className:"mx_Stickers_contentPlaceholder"},s.a.createElement("p",null,Object(N.a)("You don't currently have any stickerpacks enabled")),s.a.createElement("p",{className:"mx_Stickers_addLink"},Object(N.a)("Add some now")),s.a.createElement("img",{src:a(1487),alt:""}))}errorStickerpickerContent(){return s.a.createElement("div",{style:{textAlign:"center"},className:"error"},s.a.createElement("p",null," ",this.state.imError," "))}sendVisibilityToWidget(e){if(!this.state.stickerpickerWidget)return;const t=En.a.instance.getMessagingForUid(Ba.a.calcWidgetUid(this.state.stickerpickerWidget.id,null));t&&e!==this.prevSentVisibility&&(t.updateVisibility(e).catch(e=>{la.a.error("Error updating widget visibility: ",e)}),this.prevSentVisibility=e)}getStickerpickerContent(){if(this.state.imError)return this.errorStickerpickerContent();const e=this.state.stickerpickerWidget;let t;if(e&&e.content&&e.content.url){e.content.name=e.content.name||Object(N.a)("Stickerpack");const a={id:e.id,url:e.content.url,name:e.content.name,type:e.content.type,data:e.content.data,roomId:e.content.roomId,eventId:e.content.eventId,avatar_url:e.content.avatar_url,creatorUserId:e.content.creatorUserId};t=s.a.createElement("div",{className:"mx_Stickers_content_container"},s.a.createElement("div",{id:"stickersContent",className:"mx_Stickers_content",style:{border:"none",height:this.popoverHeight,width:this.popoverWidth}},s.a.createElement(Xa,{persistKey:"stickerPicker",zIndex:3500},s.a.createElement($n,{app:a,room:this.props.room,threadId:this.props.threadId,fullWidth:!0,userId:st.a.get().credentials.userId,creatorUserId:e.sender||st.a.get().credentials.userId,waitForIframeLoad:!0,showMenubar:!0,onEditClick:this.launchManageIntegrations,onDeleteClick:this.removeStickerpickerWidgets,showTitle:!1,showPopout:!1,handleMinimisePointerEvents:!0,userWidget:!0,showLayoutButtons:!1}))))}else t=this.defaultStickerpickerContent();return t}render(){return this.props.isStickerPickerOpen?s.a.createElement(ce.n,X()({chevronFace:ce.a.Bottom,menuWidth:this.popoverWidth,menuHeight:this.popoverHeight,onFinished:this.onFinished,menuPaddingTop:0,menuPaddingLeft:0,menuPaddingRight:0,zIndex:3500},this.props.menuPosition),s.a.createElement(Xs,{element:this.getStickerpickerContent(),onResize:this.onFinished})):null}}i()(Zs,"defaultProps",{threadId:null}),i()(Zs,"currentWidget",void 0);var eo=a(898);class to extends s.a.Component{render(){return this.props.replyToEvent?s.a.createElement("div",{className:"mx_ReplyPreview"},s.a.createElement("div",{className:"mx_ReplyPreview_section"},s.a.createElement("div",{className:"mx_ReplyPreview_header"},s.a.createElement("span",null,Object(N.a)("Replying")),s.a.createElement(H.a,{className:"mx_ReplyPreview_header_cancel",onClick:()=>{return e=this.context.timelineRenderingType,void v.a.dispatch({action:"reply_to_event",event:null,context:e});var e}})),s.a.createElement(eo.a,{mxEvent:this.props.replyToEvent,permalinkCreator:this.props.permalinkCreator}))):null}}i()(to,"contextType",Un.b);var ao=a(319),no=a(803);class io extends s.a.PureComponent{constructor(e){super(e),i()(this,"waveform",[]),i()(this,"scheduledUpdate",new ei.a(()=>this.updateWaveform(),()=>requestAnimationFrame(()=>this.scheduledUpdate.trigger()))),this.state={waveform:Object(nn.h)(0,ao.a)}}componentDidMount(){this.props.recorder.liveData.onUpdate(e=>{this.waveform=Object(nn.c)(Array.from(e.waveform),ao.a),this.scheduledUpdate.mark()})}updateWaveform(){this.setState({waveform:this.waveform})}render(){return s.a.createElement(no.a,{relHeights:this.state.waveform})}}i()(io,"defaultProps",{progress:1});var ro=a(360);class so extends s.a.PureComponent{constructor(e){super(e),i()(this,"seconds",0),i()(this,"scheduledUpdate",new ei.a(()=>this.updateClock(),()=>requestAnimationFrame(()=>this.scheduledUpdate.trigger()))),this.state={seconds:0}}componentDidMount(){this.props.recorder.liveData.onUpdate(e=>{this.seconds=e.timeSeconds,this.scheduledUpdate.mark()})}updateClock(){this.setState({seconds:this.seconds})}render(){return s.a.createElement(ro.a,{seconds:this.state.seconds,"aria-live":"off"})}}var oo=a(559),co=a(239);class lo{constructor(e,t){this.matrixClient=e,this.voiceRecording=t,i()(this,"lastUpload",void 0),i()(this,"buffer",new Uint8Array(0)),i()(this,"playback",void 0),i()(this,"onDataAvailable",e=>{const t=new Uint8Array(e);this.buffer=Object(nn.l)(this.buffer,t)}),this.voiceRecording.onDataAvailable=this.onDataAvailable}async start(){if(this.lastUpload||this.hasRecording)throw new Error("Recording already prepared");return this.voiceRecording.start()}async stop(){return await this.voiceRecording.stop(),this.audioBuffer}on(e,t){return this.voiceRecording.on(e,t),this}off(e,t){return this.voiceRecording.off(e,t),this}emit(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return this.voiceRecording.emit(e,...a)}get hasRecording(){return this.buffer.length>0}get isRecording(){return this.voiceRecording.isRecording}getPlayback(){return this.playback=oo.a.for(this,"playback").do(()=>new co.c(this.audioBuffer.buffer,this.voiceRecording.amplitudes)),this.playback}async upload(e){if(!this.hasRecording)throw new Error("No recording available to upload");if(this.lastUpload)return this.lastUpload;try{this.emit(ao.b.Uploading);const{url:t,file:a}=await Object(Oi.b)(this.matrixClient,e,new Blob([this.audioBuffer],{type:this.contentType}));this.lastUpload={mxc:t,encrypted:a},this.emit(ao.b.Uploaded)}catch(e){throw this.emit(ao.b.Ended),e}return this.lastUpload}get durationSeconds(){return this.voiceRecording.durationSeconds}get contentType(){return this.voiceRecording.contentType}get contentLength(){return this.buffer.length}get liveData(){return this.voiceRecording.liveData}get isSupported(){return this.voiceRecording.isSupported}destroy(){var e;null===(e=this.playback)||void 0===e||e.destroy(),this.voiceRecording.destroy()}get audioBuffer(){return this.buffer.slice(0)}}function uo(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function mo(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ho(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?mo(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):mo(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class po extends Sn.a{constructor(){super(v.a,{})}static get instance(){return this.internalInstance||(this.internalInstance=new po,this.internalInstance.start()),this.internalInstance}async onAction(e){}static getVoiceRecordingId(e,t){return"io.element.thread"===(null==t?void 0:t.rel_type)||(null==t?void 0:t.rel_type)===Z.g.Thread?e.roomId+"|"+t.event_id:e.roomId}getActiveRecording(e){return this.state[e]}startRecording(e){if(!this.matrixClient)throw new Error("Cannot start a recording without a MatrixClient");if(!e)throw new Error("Recording must be associated with a room");if(this.state[e])throw new Error("A recording is already in progress");const t=(a=this.matrixClient,new lo(a,new ao.d));var a;return this.updateState(ho(ho({},this.state),{},{[e]:t})),t}disposeRecording(e){var t;null===(t=this.state[e])||void 0===t||t.destroy();const a=this.state,{[e]:n}=a,i=ge()(a,[e].map(uo));return this.reset(i)}}i()(po,"internalInstance",void 0),window.mxVoiceRecordingStore=po.instance;var go=a(897),vo=a(453),fo=a(256),bo=a(565),yo=a(201),Eo=a(807);class _o extends s.a.PureComponent{constructor(e){super(e),i()(this,"context",void 0),i()(this,"voiceRecordingId",void 0),i()(this,"onCancel",async()=>{await this.disposeRecording()}),i()(this,"onRecordStartEndClick",async()=>{if(this.state.recorder)return void await this.state.recorder.stop();const e=()=>{z.a.createDialog(Nn.a,{title:Object(N.a)("Unable to access your microphone"),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(N.a)("We were unable to access your microphone. Please check your browser settings and try again.")))})};try{var t;const e=await p.c.getDevices();if(null==e||null===(t=e[p.b.AudioInput])||void 0===t||!t.length)return void z.a.createDialog(Nn.a,{title:Object(N.a)("No microphone found"),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(N.a)("We didn't find a microphone on your device. Please check your settings and try again.")))})}catch(t){return la.a.error("Error getting devices: ",t),void e()}try{vo.a.instance.pauseAllExcept(null);const e=po.instance.startRecording(this.voiceRecordingId);await e.start(),this.bindNewRecorder(e),this.setState({recorder:e,recordingPhase:ao.b.Started})}catch(t){la.a.error("Error starting recording: ",t),e(),po.instance.disposeRecording(this.voiceRecordingId)}}),i()(this,"onRecordingUpdate",e=>{e!==ao.b.EndingSoon&&this.setState({recordingPhase:e})}),this.state={recorder:null},this.voiceRecordingId=po.getVoiceRecordingId(this.props.room,this.props.relation)}componentDidMount(){const e=po.instance.getActiveRecording(this.voiceRecordingId);e&&(!e.isRecording&&e.hasRecording||la.a.warn("Cached recording hasn't ended yet and might cause issues"),this.bindNewRecorder(e),this.setState({recorder:e,recordingPhase:ao.b.Ended}))}async componentWillUnmount(){const e=po.instance.getActiveRecording(this.voiceRecordingId);await(null==e?void 0:e.stop()),this.bindNewRecorder(null)}async send(){if(!this.state.recorder)throw new Error("No recording started - cannot send anything");const{replyToEvent:e,relation:t,permalinkCreator:a}=this.props;let n;await this.state.recorder.stop();try{n=await this.state.recorder.upload(this.voiceRecordingId)}catch(e){return la.a.error("Error uploading voice message:",e),void this.setState({didUploadFail:!0})}try{const i=Object(Eo.a)(n.mxc,this.state.recorder.contentType,Math.round(1e3*this.state.recorder.durationSeconds),this.state.recorder.contentLength,n.encrypted,this.state.recorder.getPlayback().thumbnailWaveform.map(e=>Math.round(1024*e)));Object(bo.a)(i,t),e&&(Object(yo.a)(i,e,{permalinkCreator:a,includeLegacyFallback:!0}),v.a.dispatch({action:"reply_to_event",event:null,context:this.context.timelineRenderingType})),Object(fo.a)(this.props.room.roomId,e=>st.a.get().sendMessage(e,i))}catch(e){la.a.error("Error sending voice message:",e)}await this.disposeRecording()}async disposeRecording(){await po.instance.disposeRecording(this.voiceRecordingId),this.setState({recorder:null,recordingPhase:null,didUploadFail:!1})}bindNewRecorder(e){this.state.recorder&&this.state.recorder.off(mt.b,this.onRecordingUpdate),e&&e.on(mt.b,this.onRecordingUpdate)}renderWaveformArea(){return this.state.recorder?this.state.recordingPhase!==ao.b.Started?s.a.createElement(go.b,{playback:this.state.recorder.getPlayback(),layout:go.a.Composer}):s.a.createElement("div",{className:"mx_MediaBody mx_VoiceMessagePrimaryContainer mx_VoiceRecordComposerTile_recording"},s.a.createElement(so,{recorder:this.state.recorder}),s.a.createElement(io,{recorder:this.state.recorder})):null}render(){if(!this.state.recordingPhase)return null;let e,t,a;if(this.state.recordingPhase===ao.b.Started){var n;let t=Object(N.a)("Send voice message");this.state.recorder&&(t=Object(N.a)("Stop recording")),e=s.a.createElement(q.a,{className:"mx_VoiceRecordComposerTile_stop",onClick:this.onRecordStartEndClick,title:t}),!this.state.recorder||null!==(n=this.state.recorder)&&void 0!==n&&n.isRecording||(e=null)}return this.state.recorder&&this.state.recordingPhase!==ao.b.Uploading&&(t=s.a.createElement(q.a,{className:"mx_VoiceRecordComposerTile_delete",title:Object(N.a)("Delete"),onClick:this.onCancel})),this.state.recordingPhase===ao.b.Uploading?a=s.a.createElement("span",{className:"mx_VoiceRecordComposerTile_uploadingState"},s.a.createElement(me.a,{w:16,h:16})):this.state.didUploadFail&&this.state.recordingPhase===ao.b.Ended&&(a=s.a.createElement("span",{className:"mx_VoiceRecordComposerTile_failedState"},s.a.createElement("span",{className:"mx_VoiceRecordComposerTile_uploadState_badge"},s.a.createElement(_e.a,{notification:Se.a.forSymbol("!",Oe.a.Red)})),s.a.createElement("span",{className:"text-warning"},Object(N.a)("Failed to send")))),s.a.createElement(s.a.Fragment,null,a,t,e,this.renderWaveformArea())}}i()(_o,"contextType",Un.b);const wo=["title","children","className","iconClassName"],So=e=>{let{title:t,children:a,className:n,iconClassName:i}=e,o=ge()(e,wo);return!!Object(r.useContext)(oc)?s.a.createElement(de.b,X()({},o,{iconClassName:i,label:t})):s.a.createElement(q.a,X()({},o,{title:t,className:l()(n,i)}),a)};var Oo=a(883),Co=a(495),xo=a.n(Co),ko=a(213),jo=a(236),Ro=a(198),Io=a(564);const To={fifteenMins:9e5,oneHour:36e5,eightHours:288e5},No=To.fifteenMins,Do=e=>Object(N.a)("Share for %(duration)s",{duration:Object(lr.c)(e)});var Po=e=>{let{timeout:t,onChange:a}=e;const n=Object.values(To).map(e=>({key:e.toString(),duration:e,label:Do(e)}));Object.values(To).includes(t)||n.push({key:t.toString(),duration:t,label:Do(t)});return s.a.createElement(Le.a,{id:"live-duration","data-test-id":"live-duration-dropdown",label:Do(t),value:t.toString(),onOptionChange:e=>{a(+e)},className:"mx_LiveDurationDropdown"},n.map(e=>{let{key:t,label:a}=e;return s.a.createElement("div",{"data-test-id":"live-duration-option-"+t,key:t},a)}))},Mo=a(238),Ao=a(18),Lo=a(314);let Uo;!function(e){e.Own="Own",e.Pin="Pin",e.Live="Live"}(Uo||(Uo={}));const Fo=(e,t,a)=>{const{modalParams:n,errorMessage:i}="M_FORBIDDEN"===e.errcode?(e=>{const t=e===Uo.Live?"Insufficient permissions to start sharing your live location":"Insufficient permissions to send your location";return{modalParams:{title:Object(N.a)("You don't have permission to share locations"),description:Object(N.a)("You need to have the right permissions in order to share locations in this room."),button:Object(N.a)("OK"),hasCancelButton:!1,onFinished:()=>{}},errorMessage:t}})(a):((e,t)=>{const a=e===Uo.Live?"We couldn't start sharing your live location":"We couldn't send your location";return{modalParams:{title:Object(N.a)("We couldn't send your location"),description:Object(N.a)("%(brand)s could not send your location. Please try again later.",{brand:lt.b.get().brand}),button:Object(N.a)("Try again"),cancelButton:Object(N.a)("Cancel"),onFinished:e=>{e&&t()}},errorMessage:a}})(a,t);la.a.error(i,e),z.a.createDialog(Fn.a,n)};var Bo=a(804);const Vo=e=>e===Uo.Own||e===Uo.Live;class zo extends s.a.Component{constructor(e){super(e),i()(this,"context",void 0),i()(this,"map",null),i()(this,"geolocate",null),i()(this,"marker",null),i()(this,"getMarkerId",()=>"mx_MLocationPicker_marker"),i()(this,"addMarkerToMap",()=>{this.marker=new xo.a.Marker({element:document.getElementById(this.getMarkerId()),anchor:"bottom",offset:[0,-1]}).setLngLat(new xo.a.LngLat(0,0)).addTo(this.map)}),i()(this,"updateStyleUrl",e=>{var t;const a=null===(t=Object(ko.h)(e))||void 0===t?void 0:t.map_style_url;var n;a&&(null===(n=this.map)||void 0===n||n.setStyle(a))}),i()(this,"onGeolocate",e=>{var t;this.marker||this.addMarkerToMap(),this.setState({position:Object(jo.b)(e)}),null===(t=this.marker)||void 0===t||t.setLngLat(new xo.a.LngLat(e.coords.longitude,e.coords.latitude))}),i()(this,"onClick",e=>{var t;this.marker||this.addMarkerToMap(),null===(t=this.marker)||void 0===t||t.setLngLat(e.lngLat),this.setState({position:{timestamp:Date.now(),latitude:e.lngLat.lat,longitude:e.lngLat.lng}})}),i()(this,"onGeolocateError",e=>{var t;(la.a.error("Could not fetch location",e),Vo(this.props.shareType)&&(this.props.onFinished(),z.a.createDialog(Nn.a,{title:Object(N.a)("Could not fetch location"),description:Go(e.code)})),this.geolocate)&&(null===(t=this.map)||void 0===t||t.removeControl(this.geolocate))}),i()(this,"onTimeoutChange",e=>{this.setState({timeout:e})}),i()(this,"onOk",()=>{const{timeout:e,position:t}=this.state;this.props.onChoose(t?{uri:Object(jo.f)(t),timestamp:t.timestamp,timeout:e}:{timeout:e}),this.props.onFinished()}),this.state={position:void 0,timeout:No,error:void 0}}componentDidMount(){this.context.on(o.b.ClientWellKnown,this.updateStyleUrl);try{if(this.map=new xo.a.Map({container:"mx_LocationPicker_map",style:Object(Ro.d)(),center:[0,0],zoom:1}),this.geolocate=new xo.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1}),this.map.addControl(this.geolocate),this.map.on("error",e=>{la.a.error("Failed to load map: check map_style_url in config.json has a valid URL and API key",e.error),this.setState({error:Ro.a.MapStyleUrlNotReachable})}),this.map.on("load",()=>{this.geolocate.trigger()}),this.geolocate.on("error",this.onGeolocateError),Vo(this.props.shareType)&&this.geolocate.on("geolocate",this.onGeolocate),this.props.shareType===Uo.Pin){const e=new xo.a.NavigationControl({showCompass:!1,showZoom:!0});this.map.addControl(e,"bottom-right"),this.map.on("click",this.onClick)}}catch(e){la.a.error("Failed to render map",e);const t=(null==e?void 0:e.message)===Ro.a.MapStyleUrlNotConfigured?Ro.a.MapStyleUrlNotConfigured:Ro.a.Default;this.setState({error:t})}}componentWillUnmount(){var e,t,a;null===(e=this.geolocate)||void 0===e||e.off("error",this.onGeolocateError),null===(t=this.geolocate)||void 0===t||t.off("geolocate",this.onGeolocate),null===(a=this.map)||void 0===a||a.off("click",this.onClick),this.context.off(o.b.ClientWellKnown,this.updateStyleUrl)}render(){return this.state.error?s.a.createElement("div",{className:"mx_LocationPicker mx_LocationPicker_hasError"},s.a.createElement(Io.a,{error:this.state.error,onFinished:this.props.onFinished})):s.a.createElement("div",{className:"mx_LocationPicker"},s.a.createElement("div",{id:"mx_LocationPicker_map"}),this.props.shareType===Uo.Pin&&s.a.createElement("div",{className:"mx_LocationPicker_pinText"},s.a.createElement("span",null,this.state.position?Object(N.a)("Click to move the pin"):Object(N.a)("Click to drop a pin"))),s.a.createElement("div",{className:"mx_LocationPicker_footer"},s.a.createElement("form",{onSubmit:this.onOk},this.props.shareType===Uo.Live&&s.a.createElement(Po,{onChange:this.onTimeoutChange,timeout:this.state.timeout}),s.a.createElement(H.a,{"data-test-id":"location-picker-submit-button",type:"submit",element:"button",kind:"primary",className:"mx_LocationPicker_submitButton",disabled:!this.state.position,onClick:this.onOk},Object(N.a)("Share location")))),s.a.createElement("div",{id:this.getMarkerId()},!!this.marker&&s.a.createElement(Bo.a,{roomMember:Vo(this.props.shareType)?this.props.sender:void 0,useMemberColor:this.props.shareType===Uo.Live})))}}i()(zo,"contextType",R.a);var Wo,Ho=zo;function Go(e){const t=lt.b.get().brand;switch(e){case 1:return Object(N.a)("%(brand)s was denied permission to fetch your location. Please allow location access in your browser settings.",{brand:t});case 2:return Object(N.a)("Failed to fetch your location. Please try again later.");case 3:return Object(N.a)("Timed out trying to fetch your location. Please try again later.");case 4:return Object(N.a)("Unknown error fetching location. Please try again later.")}}function qo(){return(qo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ko(e){return r.createElement("svg",qo({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 14",role:"presentation","aria-hidden":!0},e),Wo||(Wo=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.637.707c.39.39.391 1.025.002 1.417L2.705 7.089l4.95 4.95c.39.39.392 1.025.002 1.417a.996.996 0 01-1.412.002L.59 7.8a1.004 1.004 0 01-.003-1.416L6.225.709A.996.996 0 017.637.707z",fill:"currentColor"})))}var Yo=a(864);var Jo=e=>{let{onBack:t,onCancel:a,displayBack:n}=e;return s.a.createElement("div",{className:"mx_ShareDialogButtons"},n&&s.a.createElement(H.a,{className:"mx_ShareDialogButtons_button left","data-test-id":"share-dialog-buttons-back",onClick:t,element:"button"},s.a.createElement(Ko,{className:"mx_ShareDialogButtons_button-icon"})),s.a.createElement(H.a,{className:"mx_ShareDialogButtons_button right","data-test-id":"share-dialog-buttons-cancel",onClick:a,element:"button"},s.a.createElement(Yo.a,{className:"mx_ShareDialogButtons_button-icon"})))},$o=a(560),Qo=a(315);const Xo=["onClick","label","shareType"],Zo=()=>{const e=Object(r.useContext)(R.a).getUserId(),t=ut.a.instance.displayName,a=ut.a.instance.getHttpAvatarUrl(36);return s.a.createElement("div",{className:"mx_ShareType_option-icon "+Uo.Own},s.a.createElement(ht.a,{idName:e,name:t,url:a,width:36,height:36,resizeMethod:"crop",className:"mx_UserMenu_userAvatar_BaseAvatar"}))},ec=e=>{let{onClick:t,label:a,shareType:n}=e,i=ge()(e,Xo);return s.a.createElement(H.a,X()({element:"button",className:"mx_ShareType_option",onClick:t},i),n===Uo.Own&&s.a.createElement(Zo,null),n===Uo.Pin&&s.a.createElement($o.a,{className:"mx_ShareType_option-icon "+Uo.Pin}),n===Uo.Live&&s.a.createElement(Qo.a,{className:"mx_ShareType_option-icon "+Uo.Live}),a)};var tc=e=>{let{setShareType:t,enabledShareTypes:a}=e;const n={[Uo.Own]:Object(N.a)("My current location"),[Uo.Live]:Object(N.a)("My live location"),[Uo.Pin]:Object(N.a)("Drop a Pin")};return s.a.createElement("div",{className:"mx_ShareType"},s.a.createElement($o.a,{className:"mx_ShareType_badge"}),s.a.createElement(na.a,{className:"mx_ShareType_heading",size:"h3"},Object(N.a)("What location type do you want to share?")),s.a.createElement("div",{className:"mx_ShareType_wrapper_options"},a.map(e=>s.a.createElement(ec,{key:e,onClick:()=>t(e),label:n[e],shareType:e,"data-test-id":"share-location-option-"+e}))))};const ac=e=>{let{onSubmit:t}=e;const[a,n]=Object(r.useState)(!1);return s.a.createElement("div",{"data-test-id":"location-picker-enable-live-share",className:"mx_EnableLiveShare"},s.a.createElement(Qo.a,{className:"mx_EnableLiveShare_icon"}),s.a.createElement(na.a,{className:"mx_EnableLiveShare_heading",size:"h3"},Object(N.a)("Live location sharing")),s.a.createElement("p",{className:"mx_EnableLiveShare_description"},Object(N.a)("Please note: this is a labs feature using a temporary implementation. This means you will not be able to delete your location history, and advanced users will be able to see your location history even after you stop sharing your live location with this room.")),s.a.createElement(rn.a,{"data-test-id":"enable-live-share-toggle",value:a,onChange:n,label:Object(N.a)("Enable live location sharing")}),s.a.createElement(H.a,{"data-test-id":"enable-live-share-submit",className:"mx_EnableLiveShare_button",element:"button",kind:"primary",onClick:t,disabled:!a},Object(N.a)("OK")))};var nc=e=>{let{menuPosition:t,onFinished:a,sender:n,roomId:i,openMenu:o,relation:c}=e;const l=Object(r.useContext)(R.a),d=(e=>{const t=[Uo.Own];return e||t.push(Uo.Live),t.push(Uo.Pin),t})(c),u=Object(ie.a)("feature_location_share_live"),m=d.length>1,[h,p]=Object(r.useState)(m?void 0:Uo.Own),g=ut.a.instance.displayName,v=h===Uo.Live?((e,t,a,n)=>async e=>{let{timeout:i}=e;const r=Object(N.a)("%(displayName)s's live location",{displayName:a});try{await Lo.a.instance.createLiveBeacon(t,Object(Mo.makeBeaconInfoContent)(null!=i?i:3e5,!0,r,Ao.a.Self))}catch(e){Fo(e,n,Uo.Live)}})(0,i,g,o):((e,t,a,n,i)=>async r=>{let{uri:s,timestamp:o}=r;if(s)try{const i=(null==n?void 0:n.rel_type)===an.d.name?n.event_id:null,r=a===Uo.Pin?Ao.a.Pin:Ao.a.Self,c=Object(Mo.makeLocationContent)(void 0,s,o,void 0,r);await Object(fo.a)(t,t=>e.sendMessage(t,i,c),e)}catch(e){Fo(e,i,a)}})(l,i,h,c,o),y=h===Uo.Live&&!u;return s.a.createElement(ce.n,X()({},t,{onFinished:a,managed:!1}),s.a.createElement("div",{className:"mx_LocationShareMenu"},y&&s.a.createElement(ac,{onSubmit:()=>{f.b.setValue("feature_location_share_live",void 0,b.a.DEVICE,!0)}}),!y&&!!h&&s.a.createElement(Ho,{sender:n,shareType:h,onChoose:v,onFinished:a}),!h&&s.a.createElement(tc,{setShareType:p,enabledShareTypes:d}),s.a.createElement(Jo,{displayBack:!!h&&m,onBack:()=>p(void 0),onCancel:a})))};var ic=e=>{let{roomId:t,sender:a,menuPosition:n,relation:i}=e;const o=Object(r.useContext)(oc),[c,d,u,m]=Object(ce.p)(),h=e=>{m(e),null==o||o()};let p;if(c){const e=null!=n?n:Object(ce.i)(d.current.getBoundingClientRect());p=s.a.createElement(nc,{menuPosition:e,onFinished:h,sender:a,roomId:t,openMenu:u,relation:i})}const g=l()("mx_MessageComposer_button",{mx_MessageComposer_button_highlight:c});return s.a.createElement(s.a.Fragment,null,s.a.createElement(So,{className:g,iconClassName:"mx_MessageComposer_location",onClick:u,title:Object(N.a)("Location"),inputRef:d}),p)},rc=a(706),sc=a(265);const oc=Object(r.createContext)(null);function cc(e){return s.a.createElement(lc,{key:"emoji_button",addEmoji:e.addEmoji,menuPosition:e.menuPosition})}const lc=e=>{let{addEmoji:t,menuPosition:a}=e;const n=Object(r.useContext)(oc),[i,o,c,d]=Object(ce.p)();let u=null;if(i){const e=null!=a?a:Object(ce.i)(o.current.getBoundingClientRect());u=s.a.createElement(ce.n,X()({},e,{onFinished:()=>{d(),null==n||n()},managed:!1}),s.a.createElement(Oo.d,{onChoose:t,showQuickReactions:!0}))}const m=l()("mx_MessageComposer_button",{mx_MessageComposer_button_highlight:i});return s.a.createElement(s.a.Fragment,null,s.a.createElement(So,{className:m,iconClassName:"mx_MessageComposer_emoji",onClick:c,title:Object(N.a)("Emoji"),inputRef:o}),u)};function dc(){return s.a.createElement(hc,{key:"controls_upload"})}const uc=Object(r.createContext)(null),mc=e=>{let{roomId:t,relation:a,children:n}=e;const i=Object(r.useContext)(R.a),o=Object(r.useContext)(Un.b),c=Object(r.useRef)(),l=()=>{var e;i.isGuest()?v.a.dispatch({action:"require_registration"}):null===(e=c.current)||void 0===e||e.click()};Object(ae.a)(v.a,e=>{o.timelineRenderingType===e.context&&"upload_file"===e.action&&l()});return s.a.createElement(uc.Provider,{value:l},n,s.a.createElement("input",{ref:c,type:"file",style:{display:"none"},multiple:!0,onClick:sc.a,onChange:e=>{0!==e.target.files.length&&(Oi.a.sharedInstance().sendContentListToRoom(Array.from(e.target.files),t,a,i,o.timelineRenderingType),e.target.value="")}}))},hc=()=>{const e=Object(r.useContext)(oc),t=Object(r.useContext)(uc);return s.a.createElement(So,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_upload",onClick:()=>{null==t||t(),null==e||e()},title:Object(N.a)("Attachment")})};function pc(e){return e.showStickersButton?s.a.createElement(So,{id:"stickersButton",key:"controls_stickers",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_stickers",onClick:()=>e.setStickerPickerOpen(!e.isStickerPickerOpen),title:e.isStickerPickerOpen?Object(N.a)("Hide stickers"):Object(N.a)("Sticker")}):null}const gc=e=>e.showVoiceBroadcastButton?s.a.createElement(So,{key:"start_voice_broadcast",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceBroadcast",onClick:e.onStartVoiceBroadcastClick,title:Object(N.a)("Voice broadcast")}):null;function vc(e,t){return t?null:s.a.createElement(So,{key:"voice_message_send",className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_voiceMessage",onClick:e.onRecordStartEndClick,title:Object(N.a)("Voice Message")})}function fc(e,t){return s.a.createElement(bc,{key:"polls",room:e,relation:t})}class bc extends s.a.PureComponent{constructor(){super(...arguments),i()(this,"context",void 0),i()(this,"onCreateClick",()=>{var e;null===(e=this.context)||void 0===e||e.call(this);if(this.props.room.currentState.maySendEvent(ir.M_POLL_START.name,st.a.get().getUserId())){var t;const e=(null===(t=this.props.relation)||void 0===t?void 0:t.rel_type)===an.d.name?this.props.relation.event_id:null;z.a.createDialog(rc.a,{room:this.props.room,threadId:e},"mx_CompoundDialog",!1,!0)}else z.a.createDialog(Nn.a,{title:Object(N.a)("Permission Required"),description:Object(N.a)("You do not have permission to start polls in this room.")})})}render(){var e;return(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===an.d.name?null:s.a.createElement(So,{className:"mx_MessageComposer_button",iconClassName:"mx_MessageComposer_poll",onClick:this.onCreateClick,title:Object(N.a)("Poll")})}}function yc(e,t,a,n){const i=t.getMember(n.getUserId());return e.showLocationButton&&i?s.a.createElement(ic,{key:"location",roomId:a,relation:e.relation,sender:i,menuPosition:e.menuPosition}):null}function Ec(e){let{isRichTextEnabled:t,onClick:a}=e;const n=t?Object(N.a)("Show plain text"):Object(N.a)("Show formatting");return s.a.createElement(So,{className:"mx_MessageComposer_button",iconClassName:l()({mx_MessageComposer_plain_text:t,mx_MessageComposer_rich_text:!t}),onClick:a,title:n})}i()(bc,"contextType",oc);var _c=e=>{const t=Object(r.useContext)(R.a),{room:a,roomId:n,narrow:i}=Object(r.useContext)(Un.b);if(e.haveRecording)return null;let o,c;i?(o=[cc(e)],c=[dc(),pc(e),vc(e,i),gc(e),e.showPollsButton?fc(a,e.relation):null,yc(e,a,n,t)]):(o=[cc(e),e.showComposerModeButton&&s.a.createElement(Ec,{key:"composerModeButton",isRichTextEnabled:e.isRichTextEnabled,onClick:e.onComposerModeClick}),dc()],c=[pc(e),vc(e,i),gc(e),e.showPollsButton?fc(a,e.relation):null,yc(e,a,n,t)]),o=o.filter(e=>e),c=c.filter(e=>e);const d=l()({mx_MessageComposer_button:!0,mx_MessageComposer_buttonMenu:!0,mx_MessageComposer_closeButtonMenu:e.isMenuOpen});return s.a.createElement(mc,{roomId:n,relation:e.relation},o,c.length>0&&s.a.createElement(q.a,{className:d,onClick:e.toggleButtonMenu,title:Object(N.a)("More options")}),e.isMenuOpen&&s.a.createElement(de.e,X()({onFinished:e.toggleButtonMenu},e.menuPosition,{wrapperClassName:"mx_MessageComposer_Menu",compact:!0}),s.a.createElement(oc.Provider,{value:e.toggleButtonMenu},s.a.createElement(de.c,null,c))))},wc=a(186),Sc=a(366),Oc=a(881),Cc=a(785);let xc=0;function kc(e){var t;return s.a.createElement(q.a,{className:"mx_MessageComposer_sendMessage",onClick:e.onClick,title:null!==(t=e.title)&&void 0!==t?t:Object(N.a)("Send message"),"data-testid":"sendmessagebtn"})}class jc extends s.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"messageComposerInput",Object(r.createRef)()),i()(this,"voiceRecordingButton",Object(r.createRef)()),i()(this,"ref",Object(r.createRef)()),i()(this,"instanceId",void 0),i()(this,"_voiceRecording",void 0),i()(this,"context",void 0),i()(this,"onResize",(e,t)=>{if(e===$.a.Resize){const{narrow:e}=this.context;this.setState({isMenuOpen:!!e&&this.state.isMenuOpen,isStickerPickerOpen:!1})}}),i()(this,"onAction",e=>{switch(e.action){case"reply_to_event":e.context===this.context.timelineRenderingType&&setTimeout(()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()},100);break;case L.a.SettingUpdated:{const t=e;switch(t.settingName){case"MessageComposerInput.showStickersButton":{const e=f.b.getValue("MessageComposerInput.showStickersButton");this.state.showStickersButton!==e&&this.setState({showStickersButton:e});break}case"MessageComposerInput.showPollsButton":{const e=f.b.getValue("MessageComposerInput.showPollsButton");this.state.showPollsButton!==e&&this.setState({showPollsButton:e});break}case Sc.a.VoiceBroadcast:this.state.showVoiceBroadcastButton!==t.newValue&&this.setState({showVoiceBroadcastButton:!!t.newValue});break;case"feature_wysiwyg_composer":this.state.isWysiwygLabEnabled!==t.newValue&&this.setState({isWysiwygLabEnabled:Boolean(t.newValue)})}}}}),i()(this,"onTombstoneClick",e=>{e.preventDefault();const t=this.context.tombstone.getContent().replacement_room,a=st.a.get().getRoom(t);let n=null;if(a){const e=a.currentState.getStateEvents(Z.b.RoomCreate,"");e&&e.getId()&&(n=e.getId())}const i=[this.context.tombstone.getSender().split(":").slice(1).join(":")];v.a.dispatch({action:L.a.ViewRoom,highlighted:!0,event_id:n,room_id:t,auto_join:!0,via_servers:i,metricsTrigger:"Tombstone",metricsViaKeyboard:"click"!==e.type})}),i()(this,"renderPlaceholderText",()=>{if(this.props.replyToEvent){var e;const t=(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===an.d.name;return t&&this.props.e2eStatus?Object(N.a)("Reply to encrypted thread…"):t?Object(N.a)("Reply to thread…"):this.props.e2eStatus?Object(N.a)("Send an encrypted reply…"):Object(N.a)("Send a reply…")}return this.props.e2eStatus?Object(N.a)("Send an encrypted message…"):Object(N.a)("Send a message…")}),i()(this,"addEmoji",e=>(v.a.dispatch({action:L.a.ComposerInsert,text:e,timelineRenderingType:this.context.timelineRenderingType}),!0)),i()(this,"sendMessage",async()=>{var e,t;if(this.state.haveRecording&&this.voiceRecordingButton.current)await(null===(t=this.voiceRecordingButton.current)||void 0===t?void 0:t.send());else if(null===(e=this.messageComposerInput.current)||void 0===e||e.sendMessage(),this.state.isWysiwygLabEnabled){const{permalinkCreator:e,relation:t,replyToEvent:a}=this.props;Object(Oc.c)(this.state.composerContent,this.state.isRichTextEnabled,{mxClient:this.props.mxClient,roomContext:this.context,permalinkCreator:e,relation:t,replyToEvent:a}),v.a.dispatch({action:L.a.ClearAndFocusSendMessageComposer}),this.setState({composerContent:"",initialComposerContent:""})}}),i()(this,"onChange",e=>{this.setState({isComposerEmpty:e.isEmpty})}),i()(this,"onWysiwygChange",e=>{this.setState({composerContent:e,isComposerEmpty:0===(null==e?void 0:e.length)})}),i()(this,"onRichTextToggle",()=>{this.setState(e=>({isRichTextEnabled:!e.isRichTextEnabled,initialComposerContent:e.isRichTextEnabled?Object(Cc.a)(e.composerContent):e.composerContent}))}),i()(this,"onVoiceStoreUpdate",()=>{this.updateRecordingState()}),i()(this,"onRecordingStarted",()=>{const e=po.getVoiceRecordingId(this.props.room,this.props.relation);this.voiceRecording=po.instance.getActiveRecording(e),this.setState({haveRecording:!!this.voiceRecording})}),i()(this,"onRecordingEndingSoon",e=>{let{secondsLeft:t}=e;this.setState({recordingTimeLeftSeconds:t}),setTimeout(()=>this.setState({recordingTimeLeftSeconds:null}),3e3)}),i()(this,"setStickerPickerOpen",e=>{this.setState({isStickerPickerOpen:e,isMenuOpen:!1})}),i()(this,"toggleStickerPickerOpen",()=>{this.setStickerPickerOpen(!this.state.isStickerPickerOpen)}),i()(this,"toggleButtonMenu",()=>{this.setState({isMenuOpen:!this.state.isMenuOpen})}),po.instance.on(mt.b,this.onVoiceStoreUpdate),this.state={isComposerEmpty:!0,composerContent:"",haveRecording:!1,recordingTimeLeftSeconds:void 0,isMenuOpen:!1,isStickerPickerOpen:!1,showStickersButton:f.b.getValue("MessageComposerInput.showStickersButton"),showPollsButton:f.b.getValue("MessageComposerInput.showPollsButton"),showVoiceBroadcastButton:f.b.getValue(Sc.a.VoiceBroadcast),isWysiwygLabEnabled:f.b.getValue("feature_wysiwyg_composer"),isRichTextEnabled:!0,initialComposerContent:""},this.instanceId=xc++,f.b.monitorSetting("MessageComposerInput.showStickersButton",null),f.b.monitorSetting("MessageComposerInput.showPollsButton",null),f.b.monitorSetting(Sc.a.VoiceBroadcast,null),f.b.monitorSetting("feature_wysiwyg_composer",null)}get voiceRecording(){return this._voiceRecording}set voiceRecording(e){this._voiceRecording&&(this._voiceRecording.off(ao.b.Started,this.onRecordingStarted),this._voiceRecording.off(ao.b.EndingSoon,this.onRecordingEndingSoon)),this._voiceRecording=e,e&&(e.on(ao.b.Started,this.onRecordingStarted),e.on(ao.b.EndingSoon,this.onRecordingEndingSoon))}componentDidMount(){this.dispatcherRef=v.a.register(this.onAction),this.waitForOwnMember(),$.b.instance.trackElementDimensions("MessageComposer"+this.instanceId,this.ref.current),$.b.instance.on("MessageComposer"+this.instanceId,this.onResize),this.updateRecordingState()}waitForOwnMember(){const e=this.props.room.getMember(st.a.get().getUserId());e?this.setState({me:e}):this.props.room.loadMembersIfNeeded().then(()=>{const e=this.props.room.getMember(st.a.get().getUserId());this.setState({me:e})})}componentWillUnmount(){po.instance.off(mt.b,this.onVoiceStoreUpdate),v.a.unregister(this.dispatcherRef),$.b.instance.stopTrackingElementDimensions("MessageComposer"+this.instanceId),$.b.instance.removeListener("MessageComposer"+this.instanceId,this.onResize),this.voiceRecording=null}updateRecordingState(){const e=po.getVoiceRecordingId(this.props.room,this.props.relation);this.voiceRecording=po.instance.getActiveRecording(e),this.voiceRecording?this.voiceRecording.hasRecording&&!this.voiceRecording.isRecording&&this.setState({haveRecording:!0}):this.setState({haveRecording:!1})}get showStickersButton(){return this.state.showStickersButton&&!Object(wc.a)(this.props.room)}render(){var e;const t=[this.props.e2eStatus?s.a.createElement(Zr.b,{key:"e2eIcon",status:this.props.e2eStatus,className:"mx_MessageComposer_e2eIcon"}):null];let n;if(this.ref.current){const e=this.ref.current.getBoundingClientRect();n=Object(ce.i)(e)}const i=this.context.canSendMessages&&!this.context.tombstone;if(i)this.state.isWysiwygLabEnabled?t.push(s.a.createElement(Oc.b,{key:"controls_input",disabled:this.state.haveRecording,onChange:this.onWysiwygChange,onSend:this.sendMessage,isRichTextEnabled:this.state.isRichTextEnabled,initialContent:this.state.initialComposerContent})):t.push(s.a.createElement(bo.b,{ref:this.messageComposerInput,key:"controls_input",room:this.props.room,placeholder:this.renderPlaceholderText(),permalinkCreator:this.props.permalinkCreator,relation:this.props.relation,replyToEvent:this.props.replyToEvent,onChange:this.onChange,disabled:this.state.haveRecording,toggleStickerPickerOpen:this.toggleStickerPickerOpen})),t.push(s.a.createElement(_o,{key:"controls_voice_record",ref:this.voiceRecordingButton,room:this.props.room,permalinkCreator:this.props.permalinkCreator,relation:this.props.relation,replyToEvent:this.props.replyToEvent}));else if(this.context.tombstone){const e=this.context.tombstone.getContent().replacement_room,n=e?s.a.createElement("a",{href:Object(Si.h)(e),className:"mx_MessageComposer_roomReplaced_link",onClick:this.onTombstoneClick},Object(N.a)("The conversation continues here.")):"";t.push(s.a.createElement("div",{className:"mx_MessageComposer_replaced_wrapper",key:"room_replaced"},s.a.createElement("div",{className:"mx_MessageComposer_replaced_valign"},s.a.createElement("img",{className:"mx_MessageComposer_roomReplaced_icon",src:a(1488).default}),s.a.createElement("span",{className:"mx_MessageComposer_roomReplaced_header"},Object(N.a)("This room has been replaced and is no longer active.")),s.a.createElement("br",null),n)))}else t.push(s.a.createElement("div",{key:"controls_error",className:"mx_MessageComposer_noperm_error"},Object(N.a)("You do not have permission to post to this room")));let r;if(this.state.recordingTimeLeftSeconds){const e=Math.round(this.state.recordingTimeLeftSeconds);r=s.a.createElement(xa.b,{label:Object(N.a)("%(seconds)ss left",{seconds:e}),alignment:xa.a.Top})}const o=(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===an.d.name?this.props.relation.event_id:null;t.push(s.a.createElement(Zs,{room:this.props.room,threadId:o,isStickerPickerOpen:this.state.isStickerPickerOpen,setStickerPickerOpen:this.setStickerPickerOpen,menuPosition:n,key:"stickers"}));const c=!this.state.isComposerEmpty||this.state.haveRecording,d=l()({mx_MessageComposer:!0,"mx_MessageComposer--compact":this.props.compact,mx_MessageComposer_e2eStatus:null!=this.props.e2eStatus,mx_MessageComposer_wysiwyg:this.state.isWysiwygLabEnabled&&this.state.isRichTextEnabled});return s.a.createElement("div",{className:d,ref:this.ref},r,s.a.createElement("div",{className:"mx_MessageComposer_wrapper"},s.a.createElement(to,{replyToEvent:this.props.replyToEvent,permalinkCreator:this.props.permalinkCreator}),s.a.createElement("div",{className:"mx_MessageComposer_row"},t,i&&s.a.createElement(_c,{addEmoji:this.addEmoji,haveRecording:this.state.haveRecording,isMenuOpen:this.state.isMenuOpen,isStickerPickerOpen:this.state.isStickerPickerOpen,menuPosition:n,relation:this.props.relation,onRecordStartEndClick:()=>{var e;null===(e=this.voiceRecordingButton.current)||void 0===e||e.onRecordStartEndClick(),this.context.narrow&&this.toggleButtonMenu()},setStickerPickerOpen:this.setStickerPickerOpen,showLocationButton:!window.electron,showPollsButton:this.state.showPollsButton,showStickersButton:this.showStickersButton,showComposerModeButton:this.state.isWysiwygLabEnabled,isRichTextEnabled:this.state.isRichTextEnabled,onComposerModeClick:this.onRichTextToggle,toggleButtonMenu:this.toggleButtonMenu,showVoiceBroadcastButton:this.state.showVoiceBroadcastButton,onStartVoiceBroadcastClick:()=>{Object(Dn.y)(this.props.room,st.a.get(),Dn.r.instance()),this.toggleButtonMenu()}}),c&&s.a.createElement(kc,{key:"controls_send",onClick:this.sendMessage,title:this.state.haveRecording?Object(N.a)("Send voice message"):void 0}))))}}i()(jc,"contextType",Un.b),i()(jc,"defaultProps",{compact:!1,showVoiceBroadcastButton:!1,isRichTextEnabled:!0});var Rc=Object(R.c)(jc);class Ic{constructor(e){this.event=e,i()(this,"serializedParts",null),i()(this,"caret",null)}setEditorState(e,t){this.caret=e,this.serializedParts=t}hasEditorState(){return!!this.serializedParts}getSerializedParts(){return this.serializedParts}getCaret(){return this.caret}getEvent(){return this.event}}var Tc=a(344),Nc=a.n(Tc),Dc=a(449);class Pc extends s.a.PureComponent{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"mounted",!1),i()(this,"onAction",e=>{this.mounted&&function(e){return[L.a.UploadStarted,L.a.UploadProgress,L.a.UploadFailed,L.a.UploadFinished,L.a.UploadCanceled].includes(e.action)}(e)&&this.setState(this.calculateState())}),i()(this,"onCancelClick",e=>{e.preventDefault(),Oi.a.sharedInstance().cancelUpload(this.state.currentUpload)}),this.state=this.calculateState()}componentDidMount(){this.dispatcherRef=v.a.register(this.onAction),this.mounted=!0}componentWillUnmount(){this.mounted=!1,v.a.unregister(this.dispatcherRef)}getUploadsInRoom(){return Oi.a.sharedInstance().getCurrentUploads(this.props.relation).filter(e=>e.roomId===this.props.room.roomId)}calculateState(){const[e,...t]=this.getUploadsInRoom();return{currentUpload:e,currentFile:null==e?void 0:e.fileName,currentLoaded:null==e?void 0:e.loaded,currentTotal:null==e?void 0:e.total,countFiles:t.length+1}}render(){if(!this.state.currentFile)return null;const e=Object(N.a)("Uploading %(filename)s and %(count)s others",{filename:this.state.currentFile,count:this.state.countFiles-1}),t=Nc()(this.state.currentTotal);return s.a.createElement("div",{className:"mx_UploadBar"},s.a.createElement("div",{className:"mx_UploadBar_filename"},e," (",t,")"),s.a.createElement(H.a,{onClick:this.onCancelClick,className:"mx_UploadBar_cancel"}),s.a.createElement(Dc.a,{value:this.state.currentLoaded,max:this.state.currentTotal}))}}var Mc=a(152);const Ac=["mxEvent","permalinkCreator","onMenuToggle"];var Lc=e=>{let{mxEvent:t,permalinkCreator:a,onMenuToggle:n}=e,i=ge()(e,Ac);const[o,c,l,d]=Object(ce.p)(),u=Object(r.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:L.a.ViewRoom,event_id:t.getId(),highlighted:!0,room_id:t.getRoomId(),metricsTrigger:void 0}),d()},[t,d]),m=Object(r.useCallback)(async e=>{if(a){null==e||e.preventDefault(),null==e||e.stopPropagation();const n=a.forEvent(t.getId());await Object(Mc.c)(n),d()}},[t,d,a]);Object(r.useEffect)(()=>{null==n||n(o)},[o,n]);const h=!Bn.d.instance.hasMaximisedWidget(st.a.get().getRoom(t.getRoomId()));return s.a.createElement(s.a.Fragment,null,s.a.createElement(ce.c,X()({},i,{className:"mx_BaseCard_header_title_button--option",onClick:l,title:Object(N.a)("Thread options"),isExpanded:o,inputRef:c,"data-testid":"threadlist-dropdown-button"})),o&&s.a.createElement(de.e,X()({onFinished:d,className:"mx_RoomTile_contextMenu",compact:!0,rightAligned:!0},{left:(p=c.current.getBoundingClientRect()).left+window.scrollX+p.width,top:p.bottom+window.scrollY,chevronFace:ce.a.None}),s.a.createElement(de.c,null,h&&s.a.createElement(de.b,{onClick:e=>u(e),label:Object(N.a)("View in room"),iconClassName:"mx_ThreadPanel_viewInRoom"}),a&&s.a.createElement(de.b,{"data-testid":"copy-thread-link",onClick:e=>m(e),label:Object(N.a)("Copy link to thread"),iconClassName:"mx_ThreadPanel_copyLinkToThread"}))));var p};var Uc=e=>{let{parent:t,onFileDrop:n}=e;const[i,o]=Object(r.useState)({dragging:!1,counter:0});return Object(r.useEffect)(()=>{if(!t||t.ondrop)return;const e=e=>{e.stopPropagation(),e.preventDefault(),o(t=>({counter:t.counter+1,dragging:!(!e.dataTransfer.types.includes("Files")&&!e.dataTransfer.types.includes("application/x-moz-file"))||t.dragging}))},a=e=>{e.stopPropagation(),e.preventDefault(),o(e=>({counter:e.counter-1,dragging:!(e.counter<=1)&&e.dragging}))},i=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="none",(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&(e.dataTransfer.dropEffect="copy")},r=e=>{e.stopPropagation(),e.preventDefault(),n(e.dataTransfer),o(e=>({dragging:!1,counter:e.counter-1}))};return null==t||t.addEventListener("drop",r),null==t||t.addEventListener("dragover",i),null==t||t.addEventListener("dragenter",e),null==t||t.addEventListener("dragleave",a),()=>{null==t||t.removeEventListener("drop",r),null==t||t.removeEventListener("dragover",i),null==t||t.removeEventListener("dragenter",e),null==t||t.removeEventListener("dragleave",a)}},[t,n]),i.dragging?s.a.createElement("div",{className:"mx_FileDropTarget"},s.a.createElement("img",{src:a(1489).default,className:"mx_FileDropTarget_image",alt:""}),Object(N.a)("Drop file here to upload")):null},Fc=a(424);function Bc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Vc(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Bc(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Bc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class zc extends s.a.Component{constructor(e){var t;super(e),t=this,i()(this,"context",void 0),i()(this,"dispatcherRef",void 0),i()(this,"layoutWatcherRef",void 0),i()(this,"timelinePanel",Object(r.createRef)()),i()(this,"card",Object(r.createRef)()),i()(this,"onAction",e=>{switch(e.phase==Hi.a.ThreadView&&e.event&&this.setupThread(e.event),e.action){case L.a.ComposerInsert:if(e.composerType)break;if(e.timelineRenderingType!==Un.a.Thread)break;v.a.dispatch(Vc(Vc({},e),{},{composerType:this.state.editState?Fc.a.Edit:Fc.a.Send}));break;case L.a.EditEvent:if(e.timelineRenderingType!==Un.a.Thread)return;if(e.event&&!e.event.getThread())return;this.setState({editState:e.event?new Ic(e.event):null},()=>{var t;e.event&&(null===(t=this.timelinePanel.current)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))});break;case"reply_to_event":e.context===Un.a.Thread&&this.setState({replyToEvent:e.event})}}),i()(this,"setupThread",e=>{let t=this.props.room.getThread(e.getId());t||(t=this.props.room.createThread(e.getId(),e,[e],!0)),this.updateThread(t)}),i()(this,"onNewThread",e=>{e.id===this.props.mxEvent.getId()&&this.setupThread(this.props.mxEvent)}),i()(this,"updateThreadRelation",()=>{this.setState({lastReply:this.threadLastReply})}),i()(this,"updateThread",e=>{this.state.thread!==e&&(this.setupThreadListeners(e,this.state.thread),e&&this.setState({thread:e,lastReply:this.threadLastReply},async()=>this.postThreadUpdate(e)))}),i()(this,"resetJumpToEvent",e=>{var t,a;this.props.initialEvent&&this.props.initialEventScrollIntoView&&e===(null===(t=this.props.initialEvent)||void 0===t?void 0:t.getId())&&v.a.dispatch({action:L.a.ViewRoom,room_id:this.props.room.roomId,event_id:null===(a=this.props.initialEvent)||void 0===a?void 0:a.getId(),highlighted:this.props.isInitialEventHighlighted,scroll_into_view:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0})}),i()(this,"onMeasurement",e=>{this.setState({narrow:e})}),i()(this,"onKeyDown",e=>{let t=!1;switch(Object(J.a)().getRoomAction(e)){case V.h.UploadFile:v.a.dispatch({action:"upload_file",context:Un.a.Thread},!0),t=!0}t&&(e.stopPropagation(),e.preventDefault())}),i()(this,"onFileDrop",e=>{const t=this.props.mxEvent.getRoomId();t?Oi.a.sharedInstance().sendContentListToRoom(Array.from(e.files),t,this.threadRelation,st.a.get(),Un.a.Thread):console.warn("Unknwon roomId for event",this.props.mxEvent)}),i()(this,"renderThreadViewHeader",()=>s.a.createElement("div",{className:"mx_BaseCard_header_title"},s.a.createElement(na.a,{size:"h4",className:"mx_BaseCard_header_title_heading"},Object(N.a)("Thread")),s.a.createElement(Lc,{mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator})));const a=this.props.room.getThread(this.props.mxEvent.getId());this.setupThreadListeners(a),this.state={layout:f.b.getValue("layout"),narrow:!1,thread:a,lastReply:null==a?void 0:a.lastReply(e=>e.isRelation(an.d.name)&&!e.status)},this.layoutWatcherRef=f.b.watchSetting("layout",null,(function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];let[,,,i]=a;return t.setState({layout:i})}))}componentDidMount(){this.state.thread&&this.postThreadUpdate(this.state.thread),this.setupThread(this.props.mxEvent),this.dispatcherRef=v.a.register(this.onAction);st.a.get().getRoom(this.props.mxEvent.getRoomId()).on(an.f.New,this.onNewThread)}componentWillUnmount(){this.dispatcherRef&&v.a.unregister(this.dispatcherRef);const e=this.props.mxEvent.getRoomId();st.a.get().getRoom(e).removeListener(an.f.New,this.onNewThread),f.b.unwatchSetting(this.layoutWatcherRef);const t=it.b.instance.roomViewStore.getRoomId()!==e;this.props.isInitialEventHighlighted&&!t&&v.a.dispatch({action:L.a.ViewRoom,room_id:this.props.room.roomId,metricsTrigger:void 0}),v.a.dispatch({action:L.a.ViewThread,thread_id:null})}componentDidUpdate(e){e.mxEvent!==this.props.mxEvent&&this.setupThread(this.props.mxEvent),e.room!==this.props.room&&Gi.a.instance.setCard({phase:Hi.a.RoomSummary})}get threadLastReply(){var e;return null===(e=this.state.thread)||void 0===e?void 0:e.lastReply(e=>e.isRelation(an.d.name)&&!e.status)}async postThreadUpdate(e){var t,a;v.a.dispatch({action:L.a.ViewThread,thread_id:e.id}),e.emit(an.f.ViewThread),this.updateThreadRelation(),null===(t=this.timelinePanel.current)||void 0===t||t.refreshTimeline(null===(a=this.props.initialEvent)||void 0===a?void 0:a.getId())}setupThreadListeners(e,t){t&&(this.state.thread.off(an.f.NewReply,this.updateThreadRelation),this.props.room.off(ee.d.LocalEchoUpdated,this.updateThreadRelation)),e&&(e.on(an.f.NewReply,this.updateThreadRelation),this.props.room.on(ee.d.LocalEchoUpdated,this.updateThreadRelation))}get threadRelation(){var e,t,a,n;const i={rel_type:an.d.name,event_id:null===(e=this.state.thread)||void 0===e?void 0:e.id,is_falling_back:!0},r=null!==(t=null===(a=this.state.lastReply)||void 0===a?void 0:a.getId())&&void 0!==t?t:null===(n=this.state.thread)||void 0===n?void 0:n.id;return r&&(i["m.in_reply_to"]={event_id:r}),i}render(){var e,t,a,n,i,r;const o=this.props.isInitialEventHighlighted?null===(e=this.props.initialEvent)||void 0===e?void 0:e.getId():null,c=this.threadRelation;let d;var u;this.state.thread?(this.props.initialEvent&&this.props.initialEvent.getRoomId()!==this.state.thread.roomId&&la.a.warn("ThreadView attempting to render TimelinePanel with mismatched initialEvent",this.state.thread.roomId,this.props.initialEvent.getRoomId(),this.props.initialEvent.getId()),d=s.a.createElement(s.a.Fragment,null,s.a.createElement(Uc,{parent:this.card.current,onFileDrop:this.onFileDrop}),s.a.createElement(Gs,{key:this.state.thread.id,ref:this.timelinePanel,showReadReceipts:!0,manageReadReceipts:!0,manageReadMarkers:!0,sendReadReceiptOnLoad:!0,timelineSet:this.state.thread.timelineSet,showUrlPreview:this.context.showUrlPreview,layout:this.state.layout===qs.a.Bubble?qs.a.Bubble:qs.a.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!0,className:"mx_RoomView_messagePanel",permalinkCreator:this.props.permalinkCreator,membersLoaded:!0,editState:this.state.editState,eventId:null===(u=this.props.initialEvent)||void 0===u?void 0:u.getId(),highlightedEventId:o,eventScrollIntoView:this.props.initialEventScrollIntoView,onEventScrolledIntoView:this.resetJumpToEvent}))):d=s.a.createElement("div",{className:"mx_RoomView_messagePanelSpinner"},s.a.createElement(Ya.a,null));return s.a.createElement(Un.b.Provider,{value:Vc(Vc({},this.context),{},{timelineRenderingType:Un.a.Thread,threadId:null===(t=this.state.thread)||void 0===t?void 0:t.id,liveTimeline:null===(a=this.state)||void 0===a||null===(n=a.thread)||void 0===n||null===(i=n.timelineSet)||void 0===i?void 0:i.getLiveTimeline(),narrow:this.state.narrow})},s.a.createElement(Ji,{className:l()("mx_ThreadView mx_ThreadPanel",{mx_ThreadView_narrow:this.state.narrow}),onClose:this.props.onClose,withoutScrollContainer:!0,header:this.renderThreadViewHeader(),ref:this.card,onKeyDown:this.onKeyDown,onBack:e=>{re.b.trackInteraction("WebThreadViewBackButton",e)}},s.a.createElement(Ks,{sensor:this.card.current,onMeasurement:this.onMeasurement}),s.a.createElement("div",{className:"mx_ThreadView_timelinePanelWrapper"},d),Oi.a.sharedInstance().getCurrentUploads(c).length>0&&s.a.createElement(Pc,{room:this.props.room,relation:c}),(null===(r=this.state.thread)||void 0===r?void 0:r.timelineSet)&&s.a.createElement(Rc,{room:this.props.room,resizeNotifier:this.props.resizeNotifier,relation:c,replyToEvent:this.state.replyToEvent,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus,compact:!0})))}}i()(zc,"contextType",Un.b);var Wc=a(510),Hc=a(731),Gc=a(349);function qc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Kc(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qc(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let Yc;!function(e){e[e.My=0]="My",e[e.All=1]="All"}(Yc||(Yc={}));const Jc=e=>{let{label:t,description:a,onClick:n,isSelected:i}=e;return s.a.createElement(ce.f,{active:i,className:"mx_ThreadPanel_Header_FilterOptionItem",onClick:n},s.a.createElement("span",null,t),s.a.createElement("span",null,a))},$c=e=>{let{filterOption:t,setFilterOption:a,empty:n}=e;const[i,r,o,c]=Object(ce.p)(),l=[{label:Object(N.a)("All threads"),description:Object(N.a)("Shows all threads from current room"),key:Yc.All},{label:Object(N.a)("My threads"),description:Object(N.a)("Shows all threads you've participated in"),key:Yc.My}],d=l.find(e=>e.key===t),u=l.map(e=>s.a.createElement(Jc,{key:e.key,label:e.label,description:e.description,onClick:()=>{a(e.key),c()},isSelected:e===d})),m=i?s.a.createElement(ce.n,{top:108,right:33,onFinished:c,chevronFace:ce.a.Top,wrapperClassName:"mx_BaseCard_header_title"},u):null;return s.a.createElement("div",{className:"mx_BaseCard_header_title"},s.a.createElement(na.a,{size:"h4",className:"mx_BaseCard_header_title_heading"},Object(N.a)("Threads")),!n&&s.a.createElement(s.a.Fragment,null,s.a.createElement(Wc.a,{className:"mx_ThreadPanel_dropdown",inputRef:r,isExpanded:i,onClick:e=>{o(),re.b.trackInteraction("WebRightPanelThreadPanelFilterDropdown",e)}},`${Object(N.a)("Show:")} ${d.label}`),m))},Qc=e=>{let t,{hasThreads:a,filterOption:n,showAllThreadsCallback:i}=e;return t=a?s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(N.a)("Reply to an ongoing thread or use “%(replyInThread)s” when hovering over a message to start a new one.",{replyInThread:Object(N.a)("Reply in thread")})),s.a.createElement("p",null,n===Yc.My?s.a.createElement("button",{onClick:i},Object(N.a)("Show all threads")):s.a.createElement(s.a.Fragment,null," "))):s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(N.a)("Threads help keep your conversations on-topic and easy to track.")),s.a.createElement("p",{className:"mx_ThreadPanel_empty_tip"},Object(N.a)("<b>Tip:</b> Use “%(replyInThread)s” when hovering over a message.",{replyInThread:Object(N.a)("Reply in thread")},{b:e=>s.a.createElement("b",null,e)}))),s.a.createElement("aside",{className:"mx_ThreadPanel_empty"},s.a.createElement("div",{className:"mx_ThreadPanel_largeIcon"}),s.a.createElement("h2",null,Object(N.a)("Keep discussions organised with threads")),t)};var Xc=e=>{var t,a,n,i,o;let{roomId:c,onClose:l,permalinkCreator:d}=e;const u=Object(r.useContext)(R.a),m=Object(r.useContext)(Un.b),h=Object(r.useRef)(),p=Object(r.useRef)(),[g,f]=Object(r.useState)(Yc.All),[b,y]=Object(r.useState)(null),[E,_]=Object(r.useState)(null),[w,S]=Object(r.useState)(!1);Object(r.useEffect)(()=>{const e=u.getRoom(c);e.createThreadsTimelineSets().then(()=>e.fetchRoomThreads()).then(()=>{f(Yc.All),y(e)})},[u,c]),Object(r.useEffect)(()=>{function e(){null==h||h.current.refreshTimeline()}return null==b||b.on(an.f.Update,e),()=>{null==b||b.removeListener(an.f.Update,e)}},[b,u,E]),Object(r.useEffect)(()=>{b&&(g===Yc.My?_(b.threadsTimelineSets[1]):_(b.threadsTimelineSets[0]))},[b,g]),Object(r.useEffect)(()=>{E&&!an.e.hasServerSideSupport&&h.current.refreshTimeline()},[E,h]);const O=Object(Gc.a)()?()=>{z.a.createDialog(Hc.a,{featureId:"feature_thread"})}:null;return s.a.createElement(Un.b.Provider,{value:Kc(Kc({},m),{},{timelineRenderingType:Un.a.ThreadsList,showHiddenEvents:!0,narrow:w})},s.a.createElement(Ji,{header:s.a.createElement($c,{filterOption:g,setFilterOption:f,empty:!(null!=E&&null!==(t=E.getLiveTimeline())&&void 0!==t&&t.getEvents().length)}),footer:s.a.createElement(s.a.Fragment,null,s.a.createElement(le.a,{tooltipTitle:Object(N.a)("Threads are a beta feature"),tooltipCaption:Object(N.a)("Click for more info"),onClick:()=>{v.a.dispatch({action:L.a.ViewUserSettings,initialTabId:Me.a.Labs})}}),O&&Object(N.a)("<a>Give feedback</a>",{},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:O},e)})),className:"mx_ThreadPanel",onClose:l,withoutScrollContainer:!0,ref:p},s.a.createElement(Ks,{sensor:p.current,onMeasurement:S}),E?s.a.createElement(Gs,{key:null!==(a=null===(n=E.getFilter())||void 0===n?void 0:n.filterId)&&void 0!==a?a:c+":"+g,ref:h,showReadReceipts:!1,manageReadReceipts:!1,manageReadMarkers:!1,sendReadReceiptOnLoad:!1,timelineSet:E,showUrlPreview:!1,empty:s.a.createElement(Qc,{hasThreads:(null===(i=b.threadsTimelineSets)||void 0===i||null===(o=i[0])||void 0===o?void 0:o.getLiveTimeline().getEvents().length)>0,filterOption:g,showAllThreadsCallback:()=>f(Yc.All)}),alwaysShowTimestamps:!0,layout:qs.a.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!1,className:"mx_RoomView_messagePanel",membersLoaded:!0,permalinkCreator:d,disableGrouping:!0}):s.a.createElement("div",{className:"mx_AutoHideScrollbar"},s.a.createElement(Ya.a,null))))};function Zc(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function el(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Zc(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Zc(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class tl extends s.a.PureComponent{constructor(e){super(e),i()(this,"card",s.a.createRef()),i()(this,"onMeasurement",e=>{this.setState({narrow:e})}),this.state={narrow:!1}}render(){const e=s.a.createElement("div",{className:"mx_RightPanel_empty mx_NotificationPanel_empty"},s.a.createElement("h2",null,Object(N.a)("You're all caught up")),s.a.createElement("p",null,Object(N.a)("You have no visible notifications.")));let t;const a=st.a.get().getNotifTimelineSet();return a?t=s.a.createElement(Gs,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:a,showUrlPreview:!1,empty:e,alwaysShowTimestamps:!0,layout:qs.a.Group}):(la.a.error("No notifTimelineSet available!"),t=s.a.createElement(Ya.a,null)),s.a.createElement(Un.b.Provider,{value:el(el({},this.context),{},{timelineRenderingType:Un.a.Notification,narrow:this.state.narrow})},s.a.createElement(Ji,{className:"mx_NotificationPanel",onClose:this.props.onClose,withoutScrollContainer:!0},s.a.createElement(Ks,{sensor:this.card.current,onMeasurement:this.onMeasurement}),t))}}i()(tl,"contextType",Un.b);var al=e=>{const t=l()({mx_JumpToBottomButton:!0,mx_JumpToBottomButton_highlight:e.highlight});let a;return e.numUnreadMessages&&(a=s.a.createElement("div",{className:"mx_JumpToBottomButton_badge"},e.numUnreadMessages)),s.a.createElement("div",{className:t},s.a.createElement(H.a,{className:"mx_JumpToBottomButton_scrollDown",title:Object(N.a)("Scroll to most recent messages"),onClick:e.onScrollToBottomClick}),a)};function nl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function il(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?nl(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):nl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class rl extends s.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"layoutWatcherRef",void 0),i()(this,"timelinePanel",s.a.createRef()),i()(this,"card",s.a.createRef()),i()(this,"readReceiptsSettingWatcher",void 0),i()(this,"onRoomViewStoreUpdate",async e=>{const t={initialEventId:it.b.instance.roomViewStore.getInitialEventId(),isInitialEventHighlighted:it.b.instance.roomViewStore.isInitialEventHighlighted(),replyToEvent:it.b.instance.roomViewStore.getQuotingEvent()};this.setState(t)}),i()(this,"onAction",e=>{switch(e.action){case L.a.EditEvent:this.setState({editState:e.event?new Ic(e.event):null},()=>{var t;e.event&&(null===(t=this.timelinePanel.current)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))})}}),i()(this,"onScroll",()=>{const e=this.timelinePanel.current;e&&(e.isAtEndOfLiveTimeline()?this.setState({atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.state.initialEventId&&this.state.isInitialEventHighlighted&&v.a.dispatch({action:L.a.ViewRoom,room_id:this.props.room.roomId,event_id:this.state.initialEventId,highlighted:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0}))}),i()(this,"onMeasurement",e=>{this.setState({narrow:e})}),i()(this,"jumpToLiveTimeline",()=>{var e;this.state.initialEventId&&this.state.isInitialEventHighlighted?v.a.dispatch({action:L.a.ViewRoom,room_id:this.props.room.roomId}):(null===(e=this.timelinePanel.current)||void 0===e||e.jumpToLiveTimeline(),v.a.fire(L.a.FocusSendMessageComposer))}),i()(this,"renderTimelineCardHeader",()=>s.a.createElement("div",{className:"mx_BaseCard_header_title"},s.a.createElement(na.a,{size:"h4",className:"mx_BaseCard_header_title_heading"},Object(N.a)("Chat")))),this.state={showReadReceipts:f.b.getValue("showReadReceipts",e.room.roomId),layout:f.b.getValue("layout"),atEndOfLiveTimeline:!0,narrow:!1},this.readReceiptsSettingWatcher=null}componentDidMount(){var e=this;it.b.instance.roomViewStore.addListener(mt.b,this.onRoomViewStoreUpdate),this.dispatcherRef=v.a.register(this.onAction),this.readReceiptsSettingWatcher=f.b.watchSetting("showReadReceipts",null,(function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];let[,,,i]=a;return e.setState({showReadReceipts:i})})),this.layoutWatcherRef=f.b.watchSetting("layout",null,(function(){for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];let[,,,i]=a;return e.setState({layout:i})}))}componentWillUnmount(){it.b.instance.roomViewStore.removeListener(mt.b,this.onRoomViewStoreUpdate),this.readReceiptsSettingWatcher&&f.b.unwatchSetting(this.readReceiptsSettingWatcher),this.layoutWatcherRef&&f.b.unwatchSetting(this.layoutWatcherRef),v.a.unregister(this.dispatcherRef)}render(){var e;const t=this.state.isInitialEventHighlighted?this.state.initialEventId:null;let a;this.state.atEndOfLiveTimeline||(a=s.a.createElement(al,{highlight:this.props.room.getUnreadNotificationCount(ee.b.Highlight)>0,onScrollToBottomClick:this.jumpToLiveTimeline}));const n=Oi.a.sharedInstance().getCurrentUploads(this.props.composerRelation).length>0,i="join"===this.props.room.getMyMembership();return s.a.createElement(Un.b.Provider,{value:il(il({},this.context),{},{timelineRenderingType:null!==(e=this.props.timelineRenderingType)&&void 0!==e?e:this.context.timelineRenderingType,liveTimeline:this.props.timelineSet.getLiveTimeline(),narrow:this.state.narrow})},s.a.createElement(Ji,{className:this.props.classNames,onClose:this.props.onClose,withoutScrollContainer:!0,header:this.renderTimelineCardHeader(),ref:this.card},s.a.createElement(Ks,{sensor:this.card.current,onMeasurement:this.onMeasurement}),s.a.createElement("div",{className:"mx_TimelineCard_timeline"},a,s.a.createElement(Gs,{ref:this.timelinePanel,showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!0,manageReadMarkers:!1,sendReadReceiptOnLoad:!0,timelineSet:this.props.timelineSet,showUrlPreview:this.context.showUrlPreview,layout:this.state.layout===qs.a.Bubble?qs.a.Bubble:qs.a.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!0,className:"mx_RoomView_messagePanel",permalinkCreator:this.props.permalinkCreator,membersLoaded:!0,editState:this.state.editState,eventId:this.state.initialEventId,resizeNotifier:this.props.resizeNotifier,highlightedEventId:t,onScroll:this.onScroll})),n&&s.a.createElement(Pc,{room:this.props.room,relation:this.props.composerRelation}),i&&s.a.createElement(Rc,{room:this.props.room,relation:this.props.composerRelation,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus,compact:!0})))}}function sl(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}i()(rl,"contextType",Un.b);class ol extends s.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"delayedUpdate",Object(k.throttle)(()=>{this.forceUpdate()},500,{leading:!0,trailing:!0})),i()(this,"onRoomStateMember",(e,t,a)=>{this.props.room&&a.roomId===this.props.room.roomId&&(this.state.phase===Hi.a.RoomMemberList&&a.roomId===this.props.room.roomId||this.state.phase===Hi.a.RoomMemberInfo&&a.roomId===this.props.room.roomId&&a.userId===this.state.cardState.member.userId)&&this.delayedUpdate()}),i()(this,"onRightPanelStoreUpdate",()=>{this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?sl(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sl(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},ol.getDerivedStateFromProps(this.props)))}),i()(this,"onClose",()=>{var e,t,a;if(null!==(e=this.props.overwriteCard)&&void 0!==e&&null!==(t=e.state)&&void 0!==t&&t.member)v.a.dispatch({action:L.a.ViewHomePage});else if(this.state.phase===Hi.a.EncryptionPanel&&null!==(a=this.state.cardState.verificationRequest)&&void 0!==a&&a.pending)this.state.cardState.verificationRequest.cancel();else{var n;Gi.a.instance.togglePanel(null===(n=this.props.room)||void 0===n?void 0:n.roomId)}}),i()(this,"onSearchQueryChanged",e=>{this.setState({searchQuery:e})}),this.state={searchQuery:""}}componentDidMount(){this.context.on(u.b.Members,this.onRoomStateMember),Gi.a.instance.on(mt.b,this.onRightPanelStoreUpdate)}componentWillUnmount(){var e;null===(e=this.context)||void 0===e||e.removeListener(u.b.Members,this.onRoomStateMember),Gi.a.instance.off(mt.b,this.onRightPanelStoreUpdate)}static getDerivedStateFromProps(e){var t,a;let n;return e.room&&(n=Gi.a.instance.currentCardForRoom(e.room.roomId)),{cardState:null===(t=n)||void 0===t?void 0:t.state,phase:null===(a=n)||void 0===a?void 0:a.phase}}render(){var e,t,a,n,i;let r=s.a.createElement("div",null);const o=null===(e=this.props.room)||void 0===e?void 0:e.roomId,c=null!==(t=null===(a=this.props.overwriteCard)||void 0===a?void 0:a.phase)&&void 0!==t?t:this.state.phase,l=null!==(n=null===(i=this.props.overwriteCard)||void 0===i?void 0:i.state)&&void 0!==n?n:this.state.cardState;switch(c){case Hi.a.RoomMemberList:o&&(r=s.a.createElement(Qr,{roomId:o,key:o,onClose:this.onClose,searchQuery:this.state.searchQuery,onSearchQueryChanged:this.onSearchQueryChanged}));break;case Hi.a.SpaceMemberList:r=s.a.createElement(Qr,{roomId:l.spaceId?l.spaceId:o,key:l.spaceId?l.spaceId:o,onClose:this.onClose,searchQuery:this.state.searchQuery,onSearchQueryChanged:this.onSearchQueryChanged});break;case Hi.a.RoomMemberInfo:case Hi.a.SpaceMemberInfo:case Hi.a.EncryptionPanel:{var d;const e=l.member instanceof Wi.a?l.member:void 0;r=s.a.createElement(Is,{user:l.member,room:null!==(d=this.context.getRoom(null==e?void 0:e.roomId))&&void 0!==d?d:this.props.room,key:o||l.member.userId,onClose:this.onClose,phase:c,verificationRequest:l.verificationRequest,verificationRequestPromise:l.verificationRequestPromise});break}case Hi.a.Room3pidMemberInfo:case Hi.a.Space3pidMemberInfo:r=s.a.createElement(Ts,{event:l.memberInfoEvent,key:o});break;case Hi.a.NotificationPanel:r=s.a.createElement(tl,{onClose:this.onClose});break;case Hi.a.PinnedMessages:f.b.getValue("feature_pinning")&&(r=s.a.createElement(br,{room:this.props.room,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator}));break;case Hi.a.Timeline:r=s.a.createElement(rl,{classNames:"mx_ThreadPanel mx_TimelineCard",room:this.props.room,timelineSet:this.props.room.getUnfilteredTimelineSet(),resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus});break;case Hi.a.FilePanel:r=s.a.createElement(Qs,{roomId:o,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose});break;case Hi.a.ThreadView:r=s.a.createElement(zc,{room:this.props.room,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,mxEvent:l.threadHeadEvent,initialEvent:l.initialEvent,isInitialEventHighlighted:l.isInitialEventHighlighted,initialEventScrollIntoView:l.initialEventScrollIntoView,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus});break;case Hi.a.ThreadPanel:r=s.a.createElement(Xc,{roomId:o,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator});break;case Hi.a.RoomSummary:r=s.a.createElement(Vr,{room:this.props.room,onClose:this.onClose});break;case Hi.a.Widget:r=s.a.createElement(zr,{room:this.props.room,widgetId:l.widgetId,onClose:this.onClose})}return s.a.createElement("aside",{className:"mx_RightPanel dark-panel",id:"mx_RightPanel"},r)}}i()(ol,"contextType",R.a);class cl{constructor(){i()(this,"scrollStateMap",new Map)}getScrollState(e){return this.scrollStateMap.get(e)}setScrollState(e,t){this.scrollStateMap.set(e,t)}}void 0===window.mxRoomScrollStateStore&&(window.mxRoomScrollStateStore=new cl);var ll=window.mxRoomScrollStateStore,dl=a(345),ul=a(413),ml=a(435),hl=a(1490),pl=a(263),gl=a(157);class vl extends s.a.PureComponent{constructor(e){super(e),i()(this,"onViewClick",()=>{this.setState({hidden:!1})}),this.state={hidden:!0}}render(){const e=l()({mx_InviteReason:!0,mx_InviteReason_hidden:this.state.hidden});return s.a.createElement("div",{className:e},s.a.createElement("div",{className:"mx_InviteReason_reason"},this.props.htmlReason?Object(gl.h)(this.props.htmlReason):this.props.reason),s.a.createElement("div",{className:"mx_InviteReason_view",onClick:this.onViewClick},Object(N.a)("View message")))}}var fl=a(599);var bl;!function(e){e.NotLoggedIn="NotLoggedIn",e.Joining="Joining",e.Loading="Loading",e.Rejecting="Rejecting",e.Kicked="Kicked",e.Banned="Banned",e.OtherThreePIDError="OtherThreePIDError",e.InvitedEmailNotFoundInAccount="InvitedEmailNotFoundInAccount",e.InvitedEmailNoIdentityServer="InvitedEmailNoIdentityServer",e.InvitedEmailMismatch="InvitedEmailMismatch",e.Invite="Invite",e.ViewingRoom="ViewingRoom",e.RoomNotFound="RoomNotFound",e.OtherError="OtherError"}(bl||(bl={}));class yl extends s.a.Component{constructor(e){super(e),i()(this,"onLoginClick",()=>{v.a.dispatch({action:"start_login",screenAfterLogin:this.makeScreenAfterLogin()})}),i()(this,"onRegisterClick",()=>{v.a.dispatch({action:"start_registration",screenAfterLogin:this.makeScreenAfterLogin()})}),this.state={busy:!1}}componentDidMount(){this.checkInvitedEmail()}componentDidUpdate(e,t){this.props.invitedEmail===e.invitedEmail&&this.props.inviterName===e.inviterName||this.checkInvitedEmail()}async checkInvitedEmail(){if(this.props.inviterName&&this.props.invitedEmail){this.setState({busy:!0});try{const e=await st.a.get().getThreePids();if(this.setState({accountEmails:e.threepids.filter(e=>"email"===e.medium).map(e=>e.address)}),!st.a.get().getIdentityServerUrl())return void this.setState({busy:!1});const t=new pl.a,a=await t.getAccessToken(),n=await st.a.get().lookupThreePid("email",this.props.invitedEmail,a);this.setState({invitedEmailMxid:n.mxid})}catch(e){this.setState({threePidFetchError:e})}this.setState({busy:!1})}}getMessageCase(){if(st.a.get().isGuest())return bl.NotLoggedIn;const e=this.getMyMember();if(e){if(e.isKicked())return bl.Kicked;if("ban"===e.membership)return bl.Banned}if(this.props.joining)return bl.Joining;if(this.props.rejecting)return bl.Rejecting;if(this.props.loading||this.state.busy)return bl.Loading;if(this.props.inviterName){if(this.props.invitedEmail){if(this.state.threePidFetchError)return bl.OtherThreePIDError;if(this.state.accountEmails&&!this.state.accountEmails.includes(this.props.invitedEmail))return bl.InvitedEmailNotFoundInAccount;if(!st.a.get().getIdentityServerUrl())return bl.InvitedEmailNoIdentityServer;if(this.state.invitedEmailMxid!=st.a.get().getUserId())return bl.InvitedEmailMismatch}return bl.Invite}return this.props.error?"M_NOT_FOUND"==this.props.error.errcode?bl.RoomNotFound:bl.OtherError:bl.ViewingRoom}getKickOrBanInfo(){const e=this.getMyMember();if(!e)return{};const t=this.props.room.currentState.getMember(e.events.member.getSender());return{memberName:t?t.name:e.events.member.getSender(),reason:e.events.member.getContent().reason}}joinRule(){var e,t;return null===(e=this.props.room)||void 0===e||null===(t=e.currentState.getStateEvents(Z.b.RoomJoinRules,""))||void 0===t?void 0:t.getContent().join_rule}getMyMember(){var e;return null===(e=this.props.room)||void 0===e?void 0:e.getMember(st.a.get().getUserId())}getInviteMember(){const{room:e}=this.props;if(!e)return;const t=st.a.get().getUserId(),a=e.currentState.getMember(t);if(!a)return;const n=a.events.member.getSender();return e.currentState.getMember(n)}isDMInvite(){const e=this.getMyMember();if(!e)return!1;const t=e.events.member.getContent();return"invite"===t.membership&&t.is_direct}makeScreenAfterLogin(){var e,t,a,n,i,r;return{screen:"room",params:{email:this.props.invitedEmail,signurl:this.props.signUrl,room_name:null!==(e=null===(t=this.props.oobData)||void 0===t?void 0:t.name)&&void 0!==e?e:null,room_avatar_url:null!==(a=null===(n=this.props.oobData)||void 0===n?void 0:n.avatarUrl)&&void 0!==a?a:null,inviter_name:null!==(i=null===(r=this.props.oobData)||void 0===r?void 0:r.inviterName)&&void 0!==i?i:null}}}render(){var e,t,a,n,i,r;const o=lt.b.get().brand,c=null!==(e=null!==(t=null===(a=this.props.room)||void 0===a?void 0:a.name)&&void 0!==t?t:this.props.roomAlias)&&void 0!==e?e:"",d=null!==(n=null===(i=this.props.room)||void 0===i?void 0:i.isSpaceRoom())&&void 0!==n?n:(null===(r=this.props.oobData)||void 0===r?void 0:r.roomType)===Z.i.Space;let u,m,h,p,g,v,b,y,E=!1;const _=[],w=this.getMessageCase();switch(w){case bl.Joining:var S;u=null!==(S=this.props.oobData)&&void 0!==S&&S.roomType||d?d?Object(N.a)("Joining space …"):Object(N.a)("Joining room …"):Object(N.a)("Joining …"),E=!0;break;case bl.Loading:u=Object(N.a)("Loading …"),E=!0;break;case bl.Rejecting:u=Object(N.a)("Rejecting invite …"),E=!0;break;case bl.NotLoggedIn:{var O;const e={canJoin:!1};null!==(O=this.props.room)&&void 0!==O&&O.roomId&&fl.a.instance.invoke(hl.RoomViewLifecycle.PreviewRoomNotLoggedIn,e,this.props.room.roomId),e.canJoin?(u=Object(N.a)("Join the room to participate"),g=Object(N.a)("Join"),p=()=>{fl.a.instance.invoke(hl.RoomViewLifecycle.JoinFromRoomPreview,this.props.room.roomId)}):(u=Object(N.a)("Join the conversation with an account"),f.b.getValue(se.b.Registration)&&(g=Object(N.a)("Sign Up"),p=this.onRegisterClick),b=Object(N.a)("Sign In"),v=this.onLoginClick),this.props.previewLoading&&(y=s.a.createElement("div",null,s.a.createElement(Ya.a,{w:20,h:20}),Object(N.a)("Loading preview")));break}case bl.Kicked:{const{memberName:e,reason:t}=this.getKickOrBanInfo();u=c?Object(N.a)("You were removed from %(roomName)s by %(memberName)s",{memberName:e,roomName:c}):Object(N.a)("You were removed by %(memberName)s",{memberName:e}),m=t?Object(N.a)("Reason: %(reason)s",{reason:t}):null,g=d?Object(N.a)("Forget this space"):Object(N.a)("Forget this room"),p=this.props.onForgetClick,this.joinRule()!==_i.c.Invite&&(b=g,v=p,g=Object(N.a)("Re-join"),p=this.props.onJoinClick);break}case bl.Banned:{const{memberName:e,reason:t}=this.getKickOrBanInfo();u=c?Object(N.a)("You were banned from %(roomName)s by %(memberName)s",{memberName:e,roomName:c}):Object(N.a)("You were banned by %(memberName)s",{memberName:e}),m=t?Object(N.a)("Reason: %(reason)s",{reason:t}):null,g=d?Object(N.a)("Forget this space"):Object(N.a)("Forget this room"),p=this.props.onForgetClick;break}case bl.OtherThreePIDError:{u=c?Object(N.a)("Something went wrong with your invite to %(roomName)s",{roomName:c}):Object(N.a)("Something went wrong with your invite.");const e=this.joinRule(),t=Object(N.a)("An error (%(errcode)s) was returned while trying to validate your invite. You could try to pass this information on to the person who invited you.",{errcode:this.state.threePidFetchError.errcode||Object(N.a)("unknown error code")});switch(e){case"invite":m=[Object(N.a)("You can only join it with a working invite."),t],g=Object(N.a)("Try to join anyway"),p=this.props.onJoinClick;break;case"public":m=Object(N.a)("You can still join here."),g=Object(N.a)("Join the discussion"),p=this.props.onJoinClick;break;default:m=t,g=Object(N.a)("Try to join anyway"),p=this.props.onJoinClick}break}case bl.InvitedEmailNotFoundInAccount:u=c?Object(N.a)("This invite to %(roomName)s was sent to %(email)s which is not associated with your account",{roomName:c,email:this.props.invitedEmail}):Object(N.a)("This invite was sent to %(email)s which is not associated with your account",{email:this.props.invitedEmail}),m=Object(N.a)("Link this email with your account in Settings to receive invites directly in %(brand)s.",{brand:o}),g=Object(N.a)("Join the discussion"),p=this.props.onJoinClick;break;case bl.InvitedEmailNoIdentityServer:u=c?Object(N.a)("This invite to %(roomName)s was sent to %(email)s",{roomName:c,email:this.props.invitedEmail}):Object(N.a)("This invite was sent to %(email)s",{email:this.props.invitedEmail}),m=Object(N.a)("Use an identity server in Settings to receive invites directly in %(brand)s.",{brand:o}),g=Object(N.a)("Join the discussion"),p=this.props.onJoinClick;break;case bl.InvitedEmailMismatch:u=c?Object(N.a)("This invite to %(roomName)s was sent to %(email)s",{roomName:c,email:this.props.invitedEmail}):Object(N.a)("This invite was sent to %(email)s",{email:this.props.invitedEmail}),m=Object(N.a)("Share this email in Settings to receive invites directly in %(brand)s.",{brand:o}),g=Object(N.a)("Join the discussion"),p=this.props.onJoinClick;break;case bl.Invite:{const e=s.a.createElement(be.a,{room:this.props.room,oobData:this.props.oobData}),t=this.getInviteMember();let a;a=t?s.a.createElement("span",null,s.a.createElement("span",{className:"mx_RoomPreviewBar_inviter"},t.rawDisplayName)," (",t.userId,")"):s.a.createElement("span",{className:"mx_RoomPreviewBar_inviter"},this.props.inviterName);this.isDMInvite()?(u=Object(N.a)("Do you want to chat with %(user)s?",{user:t.name}),m=[e,Object(N.a)("<userName/> wants to chat",{},{userName:()=>a})],g=Object(N.a)("Start chatting")):(u=Object(N.a)("Do you want to join %(roomName)s?",{roomName:c}),m=[e,Object(N.a)("<userName/> invited you",{},{userName:()=>a})],g=Object(N.a)("Accept"));const n=st.a.get().getUserId(),i=this.props.room.currentState.getMember(n).events.member.getContent();i.reason&&(h=s.a.createElement(vl,{reason:i.reason,htmlReason:i["io.element.html_reason"]})),p=this.props.onJoinClick,b=Object(N.a)("Reject"),v=this.props.onRejectClick,this.props.onRejectAndIgnoreClick&&_.push(s.a.createElement(H.a,{kind:"secondary",onClick:this.props.onRejectAndIgnoreClick,key:"ignore"},Object(N.a)("Reject & Ignore user")));break}case bl.ViewingRoom:u=this.props.canPreview?Object(N.a)("You're previewing %(roomName)s. Want to join it?",{roomName:c}):c?Object(N.a)("%(roomName)s can't be previewed. Do you want to join it?",{roomName:c}):Object(N.a)("There's no preview, would you like to join?"),g=Object(N.a)("Join the discussion"),p=this.props.onJoinClick;break;case bl.RoomNotFound:u=c?Object(N.a)("%(roomName)s does not exist.",{roomName:c}):Object(N.a)("This room or space does not exist."),m=Object(N.a)("Are you sure you're at the right place?");break;case bl.OtherError:u=c?Object(N.a)("%(roomName)s is not accessible at this time.",{roomName:c}):Object(N.a)("This room or space is not accessible at this time."),m=[Object(N.a)("Try again later, or ask a room or space admin to check if you have access."),Object(N.a)("%(errcode)s was returned while trying to access the room or space. If you think you're seeing this message in error, please <issueLink>submit a bug report</issueLink>.",{errcode:this.props.error.errcode},{issueLink:e=>s.a.createElement("a",{href:"https://github.com/vector-im/element-web/issues/new/choose",target:"_blank",rel:"noreferrer noopener"},e)})]}let C,x,k,j;m&&(Array.isArray(m)||(m=[m]),C=m.map((e,t)=>s.a.createElement("p",{key:"subTitle"+t},e))),x=E?s.a.createElement("h3",{className:"mx_RoomPreviewBar_spinnerTitle"},s.a.createElement(Ya.a,null),u):s.a.createElement("h3",null,u),p&&(k=s.a.createElement(H.a,{kind:"primary",onClick:p},g)),v&&(j=s.a.createElement(H.a,{kind:"secondary",onClick:v},b));const R=this.props.canPreview,I=l()("mx_RoomPreviewBar","dark-panel","mx_RoomPreviewBar_"+w,{mx_RoomPreviewBar_panel:R,mx_RoomPreviewBar_dialog:!R}),T=R?s.a.createElement(s.a.Fragment,null,j,_,k):s.a.createElement(s.a.Fragment,null,k,_,j);return s.a.createElement("div",{className:I},s.a.createElement("div",{className:"mx_RoomPreviewBar_message"},x,C),h,s.a.createElement("div",{className:"mx_RoomPreviewBar_actions"},T),s.a.createElement("div",{className:"mx_RoomPreviewBar_footer"},y))}}i()(yl,"defaultProps",{onJoinClick(){}});var El=a(200),_l=a(582);function wl(e){let{as:t="div",children:a,onClick:n}=e;const i=Object(r.useRef)();return Object(r.useLayoutEffect)(()=>{Object(gl.g)(i.current)},[a]),s.a.createElement(t,{children:a,ref:i,onClick:n})}const Sl=["room"];function Ol(e){let{room:t}=e,a=ge()(e,Sl);const n=Object(r.useContext)(R.a),i=Object(r.useRef)(),o=Object(_l.b)(t),c=Object(gl.i)(null==o?void 0:o.text,null==o?void 0:o.html,i),d=Object(r.useCallback)(e=>{var t;null===(t=a.onClick)||void 0===t||t.call(a,e);"A"!==e.target.tagName.toUpperCase()&&v.a.fire(L.a.ShowRoomTopic)},[a]);Object(ae.a)(v.a,e=>{if(e.action===L.a.ShowRoomTopic){const e=t.currentState.maySendStateEvent(Z.b.RoomTopic,n.getUserId()),a=Object(gl.i)(null==o?void 0:o.text,null==o?void 0:o.html,i,!0),r=z.a.createDialog(Rr.a,{title:t.name,description:s.a.createElement("div",null,s.a.createElement(wl,{as:"p",onClick:e=>{"A"===e.target.tagName.toUpperCase()&&r.close()}},a),e&&s.a.createElement(H.a,{kind:"primary_outline",onClick:()=>{r.close(),v.a.dispatch({action:"open_room_settings"})}},Object(N.a)("Edit topic"))),hasCloseButton:!0,button:!1})}});const u=l()(a.className,"mx_RoomTopic");return s.a.createElement("div",X()({},a,{ref:i,onClick:d,dir:"auto",className:u}),s.a.createElement(he.a,{label:Object(N.a)("Click to read topic"),alignment:xa.a.Bottom,ignoreHover:e=>"A"===e.target.tagName.toUpperCase()},s.a.createElement(wl,null,c)))}var Cl=a(569);const xl=["room","onlyKnownUsers","numShown"],kl=5,jl=e=>{var t;return!(null===(t=Qi.a.shared().getDMRoomsForUserId(e.userId))||void 0===t||!t.length)};var Rl=e=>{let{room:t,onlyKnownUsers:a=!0,numShown:n=kl}=e,i=ge()(e,xl);const o=Object(r.useContext)(R.a),c="join"===t.getMyMembership();let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250;const[a,n]=Object(r.useState)(e.getJoinedMembers());return Object(ne.c)(e.currentState,u.b.Update,Object(k.throttle)(()=>{n(e.getJoinedMembers())},t,{leading:!0,trailing:!0})),a}(t);const d=l.length,m=[e=>e.getMxcAvatarUrl()?0:1];a?l=l.filter(jl):m.unshift(e=>jl(e)?0:1);const h=Object(k.sortBy)(l.filter(e=>e.userId!==o.getUserId()),m).slice(0,n);if(h.length<1)return null;const p=h.map(e=>e.name).reverse().join(", "),g=s.a.createElement("div",null,s.a.createElement("div",{className:"mx_Tooltip_title"},i.onClick?Object(N.a)("View all %(count)s members",{count:d}):Object(N.a)("%(count)s members",{count:d})),s.a.createElement("div",{className:"mx_Tooltip_sub"},c?Object(N.a)("Including you, %(commaSeparatedMembers)s",{commaSeparatedMembers:p}):Object(N.a)("Including %(commaSeparatedMembers)s",{commaSeparatedMembers:p})));return s.a.createElement(Cl.a,X()({members:h,faceSize:28,overflow:l.length>n,tooltip:g},i),a&&s.a.createElement("span",{className:"mx_FacePile_summary"},Object(N.a)("%(count)s people you know have already joined",{count:l.length})))};var Il=e=>{let{room:t}=e;const a=Object(sr.a)(async()=>{if("invite"!==t.getMyMembership())return null;try{return t.client.getRoomSummary(t.roomId)}catch(e){return null}},[t]),n=Object(mr.a)(t,e=>e.getJoinRule()),i=er(t),r=Zi(t),o=Object(ie.a)("feature_element_call_video_rooms");let c,l,d;if(t.isElementVideoRoom()||o&&t.isCallRoom()?(c="mx_RoomInfoLine_video",l=Object(N.a)("Video room")):n===_i.c.Public?(c="mx_RoomInfoLine_public",l=t.isSpaceRoom()?Object(N.a)("Public space"):Object(N.a)("Public room")):(c="mx_RoomInfoLine_private",l=t.isSpaceRoom()?Object(N.a)("Private space"):Object(N.a)("Private room")),"invite"===i&&a)d=s.a.createElement("span",{className:"mx_RoomInfoLine_members"},Object(N.a)("%(count)s members",{count:a.num_joined_members}));else if(r&&void 0!==a){const e=()=>Gi.a.instance.setCard({phase:t.isSpaceRoom()?Hi.a.SpaceMemberList:Hi.a.RoomMemberList});d=s.a.createElement(H.a,{kind:"link",className:"mx_RoomInfoLine_members",onClick:e},Object(N.a)("%(count)s members",{count:r}))}return s.a.createElement("div",{className:"mx_RoomInfoLine "+c},l,d)};var Tl=e=>{let{room:t,onJoinButtonClicked:a,onRejectButtonClicked:n}=e;const i=Object(r.useContext)(R.a),o=Object(ie.a)("feature_video_rooms"),c=Object(ie.a)("feature_element_call_video_rooms"),l=t.isElementVideoRoom()||c&&t.isCallRoom(),d=er(t);Object(ae.a)(v.a,e=>{e.action===L.a.JoinRoomError&&e.roomId===t.roomId&&m(!1)});const[u,m]=Object(r.useState)(!1),h=Object(mr.a)(t,e=>e.getJoinRule()),p=Object(El.b)(d)===El.a.Leave&&h!==_i.c.Public,g=()=>v.a.dispatch({action:L.a.ViewUserSettings,initialTabId:Me.a.Labs});let f,b,y=null;if("join"===d)f=s.a.createElement(H.a,{kind:"danger_outline",onClick:()=>{v.a.dispatch({action:"leave_room",room_id:t.roomId})}},Object(N.a)("Leave"));else if("invite"===d){var E,_;const e=null===(E=t.getMember(i.getUserId()))||void 0===E||null===(_=E.events.member)||void 0===_?void 0:_.getSender();if(e){const a=t.getMember(e);y=s.a.createElement("div",{className:"mx_RoomPreviewCard_inviter"},s.a.createElement(ma.a,{member:a,fallbackUserId:e,width:32,height:32}),s.a.createElement("div",null,s.a.createElement("div",{className:"mx_RoomPreviewCard_inviter_name"},Object(N.a)("<inviter/> invites you",{},{inviter:()=>s.a.createElement("b",null,(null==a?void 0:a.name)||e)})),a?s.a.createElement("div",{className:"mx_RoomPreviewCard_inviter_mxid"},e):null))}f=s.a.createElement(s.a.Fragment,null,s.a.createElement(H.a,{kind:"secondary",onClick:()=>{m(!0),n()}},Object(N.a)("Reject")),s.a.createElement(H.a,{kind:"primary",onClick:()=>{m(!0),a()}},Object(N.a)("Accept")))}else f=s.a.createElement(H.a,{kind:"primary",onClick:()=>{a(),i.isGuest()||m(!0)},disabled:p},Object(N.a)("Join"));u&&(f=s.a.createElement(me.a,null)),b=l?s.a.createElement(s.a.Fragment,null,s.a.createElement(be.a,{room:t,height:50,width:50,viewAvatarOnClick:!0}),s.a.createElement("div",{className:"mx_RoomPreviewCard_video"}),s.a.createElement(le.a,{onClick:g,tooltipTitle:Object(N.a)("Video rooms are a beta feature")})):t.isSpaceRoom()?s.a.createElement(be.a,{room:t,height:80,width:80,viewAvatarOnClick:!0}):s.a.createElement(be.a,{room:t,height:50,width:50,viewAvatarOnClick:!0});let w=null;return p?w=Object(N.a)("To view %(roomName)s, you need an invite",{roomName:t.name}):l&&!o&&(w="join"===d?Object(N.a)("To view, please enable video rooms in Labs first"):Object(N.a)("To join, please enable video rooms in Labs first"),f=s.a.createElement(H.a,{kind:"primary",onClick:g},Object(N.a)("Show Labs settings"))),s.a.createElement("div",{className:"mx_RoomPreviewCard"},y,s.a.createElement("div",{className:"mx_RoomPreviewCard_avatar"},b),s.a.createElement("h1",{className:"mx_RoomPreviewCard_name"},s.a.createElement(yr.a,{room:t})),s.a.createElement(Il,{room:t}),s.a.createElement(Ol,{room:t,className:"mx_RoomPreviewCard_topic"}),"public"===t.getJoinRule()&&s.a.createElement(Rl,{room:t}),w?s.a.createElement("div",{className:"mx_RoomPreviewCard_notice"},w):null,s.a.createElement("div",{className:"mx_RoomPreviewCard_joinButtons"},f))};let Nl;!function(e){e.Room="Room",e.All="All"}(Nl||(Nl={}));class Dl extends s.a.Component{constructor(e){super(e),i()(this,"searchTerm",Object(r.createRef)()),i()(this,"onThisRoomClick",()=>{this.setState({scope:Nl.Room},()=>this.searchIfQuery())}),i()(this,"onAllRoomsClick",()=>{this.setState({scope:Nl.All},()=>this.searchIfQuery())}),i()(this,"onSearchChange",e=>{switch(Object(J.a)().getAccessibilityAction(e)){case V.h.Enter:this.onSearch();break;case V.h.Escape:this.props.onCancelClick()}}),i()(this,"onSearch",()=>{this.searchTerm.current.value.trim()&&this.props.onSearch(this.searchTerm.current.value,this.state.scope)}),this.state={scope:Nl.Room}}searchIfQuery(){this.searchTerm.current.value&&this.onSearch()}render(){const e=l()("mx_SearchBar_searchButton",{mx_SearchBar_searching:this.props.searchInProgress}),t=l()("mx_SearchBar_button",{mx_SearchBar_unselected:this.state.scope!==Nl.Room}),a=l()("mx_SearchBar_button",{mx_SearchBar_unselected:this.state.scope!==Nl.All});return s.a.createElement(s.a.Fragment,null,s.a.createElement(re.a,{screenName:"RoomSearch"}),s.a.createElement("div",{className:"mx_SearchBar"},s.a.createElement("div",{className:"mx_SearchBar_buttons",role:"radiogroup"},s.a.createElement(H.a,{className:t,onClick:this.onThisRoomClick,"aria-checked":this.state.scope===Nl.Room,role:"radio"},Object(N.a)("This Room")),s.a.createElement(H.a,{className:a,onClick:this.onAllRoomsClick,"aria-checked":this.state.scope===Nl.All,role:"radio"},Object(N.a)("All Rooms"))),s.a.createElement("div",{className:"mx_SearchBar_input mx_textinput"},s.a.createElement("input",{ref:this.searchTerm,type:"text",autoFocus:!0,placeholder:Object(N.a)("Search…"),onKeyDown:this.onSearchChange}),s.a.createElement(H.a,{className:e,onClick:this.onSearch})),s.a.createElement(H.a,{className:"mx_SearchBar_cancel",onClick:this.props.onCancelClick})),s.a.createElement(Ps,{isRoomEncrypted:this.props.isRoomEncrypted,kind:Ds.Search}))}}var Pl,Ml=a(814);class Al extends s.a.PureComponent{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"onStateEvents",e=>{if(!this.props.room||e.getRoomId()!==this.props.room.roomId)return;if("m.room.tombstone"!==e.getType())return;const t=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.setState({upgraded:t&&t.getContent().replacement_room})}),i()(this,"onUpgradeClick",()=>{z.a.createDialog(Ml.a,{room:this.props.room})});const a=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.state={upgraded:null==a?void 0:a.getContent().replacement_room}}componentDidMount(){this.context.on(u.b.Events,this.onStateEvents)}componentWillUnmount(){this.context.removeListener(u.b.Events,this.onStateEvents)}render(){let e=s.a.createElement("div",null,s.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},s.a.createElement("p",null,Object(N.a)("Upgrading this room will shut down the current instance of the room and create an upgraded room with the same name.")),s.a.createElement("p",null,Object(N.a)("<b>Warning</b>: Upgrading a room will <i>not automatically migrate room members to the new version of the room.</i> We'll post a link to the new room in the old version of the room - room members will have to click this link to join the new room.",{},{b:e=>s.a.createElement("b",null,e),i:e=>s.a.createElement("i",null,e)}))),s.a.createElement("p",{className:"mx_RoomUpgradeWarningBar_upgradelink"},s.a.createElement(H.a,{onClick:this.onUpgradeClick},Object(N.a)("Upgrade this room to the recommended room version"))));return this.state.upgraded&&(e=s.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},s.a.createElement("p",null,Object(N.a)("This room has already been upgraded.")))),s.a.createElement("div",{className:"mx_RoomUpgradeWarningBar"},s.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_wrapped"},s.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_header"},Object(N.a)("This room is running room version <roomVersion />, which this homeserver has marked as <i>unstable</i>.",{},{roomVersion:()=>s.a.createElement("code",null,this.props.room.getVersion()),i:e=>s.a.createElement("i",null,e)})),e,s.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_small"},Object(N.a)("Only room administrators will see this warning"))))}}function Ll(e,t){const a=Object(dn.a)(e.data);a.response=t,e.source.postMessage(a,e.origin)}function Ul(e,t,a){la.a.error("Action:"+e.data.action+" failed with message: "+t);const n=Object(dn.a)(e.data);n.response={error:{message:t}},a&&(n.response.error._error=a),e.source.postMessage(n,e.origin)}function Fl(e,t){const a=e.data.widget_id;let n=e.data.type;const i=e.data.url,r=e.data.name,s=e.data.data,o=e.data.avatar_url,c=e.data.userWidget;if(a&&void 0!==i){if(null!==i){if(void 0!==r&&"string"!=typeof r)return void Ul(e,Object(N.a)("Unable to create widget."),new Error("Optional field 'name' must be a string."));if(void 0!==s&&!(s instanceof Object))return void Ul(e,Object(N.a)("Unable to create widget."),new Error("Optional field 'data' must be an Object."));if(void 0!==o&&"string"!=typeof o)return void Ul(e,Object(N.a)("Unable to create widget."),new Error("Optional field 'avatar_url' must be a string."));if("string"!=typeof n)return void Ul(e,Object(N.a)("Unable to create widget."),new Error("Field 'type' must be a string."));if("string"!=typeof i)return void Ul(e,Object(N.a)("Unable to create widget."),new Error("Field 'url' must be a string or null."))}n=Za.a.fromString(n),c?Ba.a.setUserWidget(a,n,i,r,s).then(()=>{Ll(e,{success:!0}),v.a.dispatch({action:"user_widget_updated"})}).catch(t=>{Ul(e,Object(N.a)("Unable to create widget."),t)}):(t||Ul(e,Object(N.a)("Missing roomId."),null),Ba.a.setRoomWidget(t,a,n,i,r,s,o).then(()=>{Ll(e,{success:!0})},t=>{Ul(e,Object(N.a)("Failed to send request."),t)}))}else Ul(e,Object(N.a)("Unable to create widget."),new Error("Missing required widget fields."))}function Bl(e,t){const a=st.a.get();if(!a)return void Ul(e,Object(N.a)("You need to be logged in."));let n=[];if(t){const i=a.getRoom(t);if(!i)return void Ul(e,Object(N.a)("This room is not recognised."));n=Ba.a.getRoomWidgets(i).map(e=>e.event)}const i=Ba.a.getUserWidgetsArray();n=n.concat(i),Ll(e,n)}function Vl(e,t,a,n){const i=st.a.get();if(!i)return void Ul(e,Object(N.a)("You need to be logged in."));const r=i.getRoom(t);if(!r)return void Ul(e,Object(N.a)("This room is not recognised."));const s=r.currentState.getStateEvents(a,n);Ll(e,s?s.getContent():null)}i()(Al,"contextType",R.a),function(e){e.CloseScalar="close_scalar",e.GetWidgets="get_widgets",e.SetWidget="set_widget",e.JoinRulesState="join_rules_state",e.SetPlumbingState="set_plumbing_state",e.GetMembershipCount="get_membership_count",e.GetRoomEncryptionState="get_room_enc_state",e.CanSendEvent="can_send_event",e.MembershipState="membership_state",e.invite="invite",e.Kick="kick",e.BotOptions="bot_options",e.SetBotOptions="set_bot_options",e.SetBotPower="set_bot_power",e.GetOpenIdToken="get_open_id_token"}(Pl||(Pl={}));const zl=function(e){let t,a;e.origin||(e.origin=e.originalEvent.origin);try{Hl||(Hl=_n.a.sharedInstance().getPrimaryManager().uiUrl),t=new URL(Hl)}catch(e){return}try{a=new URL(e.origin)}catch(e){return}if(t.origin!==a.origin||!e.data.action||e.data.api)return;if(e.data.action===Pl.CloseScalar)return v.a.dispatch({action:Pl.CloseScalar}),void Ll(e,null);const n=e.data.room_id,i=e.data.user_id;if(!n)return e.data.action===Pl.GetWidgets?void Bl(e,null):e.data.action===Pl.SetWidget?void Fl(e,null):void Ul(e,Object(N.a)("Missing room_id in request"));if(n===it.b.instance.roomViewStore.getRoomId())if(e.data.action!==Pl.GetWidgets)if(e.data.action!==Pl.SetWidget)if(e.data.action!==Pl.JoinRulesState)if(e.data.action!==Pl.SetPlumbingState)if(e.data.action!==Pl.GetMembershipCount)if(e.data.action!==Pl.GetRoomEncryptionState)if(e.data.action!==Pl.CanSendEvent)if(i)switch(e.data.action){case Pl.MembershipState:!function(e,t,a){la.a.log(`membership_state of ${a} in room ${t} requested.`),Vl(e,t,"m.room.member",a)}(e,n,i);break;case Pl.invite:!function(e,t,a){la.a.log(`Received request to invite ${a} into room ${t}`);const n=st.a.get();if(!n)return void Ul(e,Object(N.a)("You need to be logged in."));const i=n.getRoom(t);if(i){const t=i.getMember(a);if(t&&["join","invite"].includes(t.membership))return void Ll(e,{success:!0})}n.invite(t,a).then((function(){Ll(e,{success:!0})}),(function(t){Ul(e,Object(N.a)("You need to be able to invite users to do that."),t)}))}(e,n,i);break;case Pl.Kick:!function(e,t,a){la.a.log(`Received request to kick ${a} from room ${t}`);const n=st.a.get();if(!n)return void Ul(e,Object(N.a)("You need to be logged in."));const i=n.getRoom(t);if(i){const t=i.getMember(a);if(!t||Object(El.b)(t.membership)===El.a.Leave)return void Ll(e,{success:!0})}const r=e.data.reason;n.kick(t,a,r).then(()=>{Ll(e,{success:!0})}).catch(t=>{Ul(e,Object(N.a)("You need to be able to kick users to do that."),t)})}(e,n,i);break;case Pl.BotOptions:!function(e,t,a){la.a.log(`bot_options of ${a} in room ${t} requested.`),Vl(e,t,"m.room.bot.options","_"+a)}(e,n,i);break;case Pl.SetBotOptions:!function(e,t,a){la.a.log(`Received request to set options for bot ${a} in room ${t}`);const n=st.a.get();n?n.sendStateEvent(t,"m.room.bot.options",e.data.content,"_"+a).then(()=>{Ll(e,{success:!0})},t=>{Ul(e,t.message?t.message:Object(N.a)("Failed to send request."),t)}):Ul(e,Object(N.a)("You need to be logged in."))}(e,n,i);break;case Pl.SetBotPower:!async function(e,t,a,n,i){if(!(Number.isInteger(n)&&n>=0))return void Ul(e,Object(N.a)("Power level must be positive integer."));la.a.log(`Received request to set power level to ${n} for bot ${a} in room ${t}.`);const r=st.a.get();if(r)try{const l=await r.getStateEvent(t,"m.room.power_levels","");if(!0===i){var s,o,c;if((null!==(s=null!==(o=null===(c=l.users)||void 0===c?void 0:c[a])&&void 0!==o?o:l.users_default)&&void 0!==s?s:0)>=n)return Ll(e,{success:!0})}await r.setPowerLevel(t,a,n,new tn.b({type:"m.room.power_levels",content:l})),Ll(e,{success:!0})}catch(t){Ul(e,t.message?t.message:Object(N.a)("Failed to send request."),t)}else Ul(e,Object(N.a)("You need to be logged in."))}(e,n,i,e.data.level,e.data.ignoreIfGreater);break;case Pl.GetOpenIdToken:!async function(e){try{Ll(e,st.a.get().getOpenIdToken())}catch(t){la.a.warn("Unable to fetch openId token.",t),Ul(e,"Unable to fetch openId token.")}}(e);break;default:la.a.warn("Unhandled postMessage event with action '"+e.data.action+"'")}else Ul(e,Object(N.a)("Missing user_id in request"));else!function(e,t){const a=""+e.data.event_type,n=Boolean(e.data.is_state),i=st.a.get();if(!i)return void Ul(e,Object(N.a)("You need to be logged in."));const r=i.getRoom(t);if(!r)return void Ul(e,Object(N.a)("This room is not recognised."));if("join"!==r.getMyMembership())return void Ul(e,Object(N.a)("You are not in this room."));const s=i.credentials.userId;let o=!1;o=n?r.currentState.maySendStateEvent(a,s):r.currentState.maySendEvent(a,s),o?Ll(e,!0):Ul(e,Object(N.a)("You do not have permission to do that in this room."))}(e,n);else!function(e,t){const a=st.a.get();if(!a)return void Ul(e,Object(N.a)("You need to be logged in."));if(!a.getRoom(t))return void Ul(e,Object(N.a)("This room is not recognised."));Ll(e,st.a.get().isRoomEncrypted(t))}(e,n);else!function(e,t){const a=st.a.get();if(!a)return void Ul(e,Object(N.a)("You need to be logged in."));const n=a.getRoom(t);if(!n)return void Ul(e,Object(N.a)("This room is not recognised."));Ll(e,n.getJoinedMemberCount())}(e,n);else!function(e,t,a){if("string"!=typeof a)throw new Error("Plumbing state status should be a string");la.a.log(`Received request to set plumbing state to status "${a}" in room ${t}`);const n=st.a.get();n?n.sendStateEvent(t,"m.room.plumbing",{status:a}).then(()=>{Ll(e,{success:!0})},t=>{Ul(e,t.message?t.message:Object(N.a)("Failed to send request."),t)}):Ul(e,Object(N.a)("You need to be logged in."))}(e,n,e.data.status);else!function(e,t){la.a.log(`join_rules of ${t} requested.`),Vl(e,t,"m.room.join_rules","")}(e,n);else Fl(e,n);else Bl(e,n);else Ul(e,Object(N.a)("Room %(roomId)s not visible",{roomId:n}))};let Wl=0,Hl=null;var Gl=a(264);class ql extends s.a.Component{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"resizeContainer",void 0),i()(this,"resizer",void 0),i()(this,"dispatcherRef",void 0),i()(this,"onIsResizing",e=>{this.setState({resizingVertical:e}),e||this.relaxResizer()}),i()(this,"collectResizer",e=>{this.resizeContainer&&this.resizer.detach(),e&&(this.resizer.container=e,this.resizer.attach()),this.resizeContainer=e,this.loadResizerPreferences()}),i()(this,"getAppsHash",e=>e.map(e=>e.id).join("~")),i()(this,"relaxResizer",()=>{const e=this.resizer.getDistributors();e.forEach(e=>e.start()),e.forEach(e=>e.finish())}),i()(this,"loadResizerPreferences",()=>{const e=Bn.d.instance.getResizerDistributions(this.props.room,Bn.a.Top);if(this.state.apps&&this.topApps().length-1===e.length)e.forEach((e,t)=>{const a=this.resizer.forHandleAt(t);a&&(a.size=e,a.finish())});else if(this.state.apps){const e=this.resizer.getDistributors();e.forEach(e=>e.item.clearSize()),e.forEach(e=>e.start()),e.forEach(e=>e.finish())}}),i()(this,"onAction",e=>{const t=this.props.room.roomId+"_hide_widget_drawer";switch(e.action){case"appsDrawer":e.show?localStorage.setItem(t,"false"):localStorage.setItem(t,"true")}}),i()(this,"getApps",()=>{const e={};return e[Bn.a.Top]=Bn.d.instance.getContainerWidgets(this.props.room,Bn.a.Top),e[Bn.a.Center]=Bn.d.instance.getContainerWidgets(this.props.room,Bn.a.Center),e}),i()(this,"topApps",()=>this.state.apps[Bn.a.Top]),i()(this,"centerApps",()=>this.state.apps[Bn.a.Center]),i()(this,"updateApps",()=>{this.unmounted||this.setState({apps:this.getApps()})}),this.state={apps:this.getApps(),resizingVertical:!1,resizingHorizontal:!1,resizing:!1},this.resizer=this.createResizer(),this.props.resizeNotifier.on("isResizing",this.onIsResizing)}componentDidMount(){0===Wl&&window.addEventListener("message",zl,!1),Wl+=1,Bn.d.instance.on(Bn.d.emissionForRoom(this.props.room),this.updateApps),this.dispatcherRef=v.a.register(this.onAction)}componentWillUnmount(){this.unmounted=!0,function(){if(Wl-=1,0===Wl&&window.removeEventListener("message",zl),Wl<0){const e=new Error("ScalarMessaging: mismatched startListening / stopListening detected. Negative count");la.a.error(e)}}(),Bn.d.instance.off(Bn.d.emissionForRoom(this.props.room),this.updateApps),this.dispatcherRef&&v.a.unregister(this.dispatcherRef),this.resizeContainer&&this.resizer.detach(),this.props.resizeNotifier.off("isResizing",this.onIsResizing)}createResizer(){const e=new j(null,O,{onResizeStart:()=>{this.resizeContainer.classList.add("mx_AppsDrawer_resizing"),this.setState({resizingHorizontal:!0})},onResizeStop:()=>{this.resizeContainer.classList.remove("mx_AppsDrawer_resizing"),Bn.d.instance.setResizerDistributions(this.props.room,Bn.a.Top,this.topApps().slice(1).map((e,t)=>this.resizer.forHandleAt(t).size)),this.setState({resizingHorizontal:!1})}});return e.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle_vertical",reverse:"mx_ResizeHandle_reverse"}),e}componentDidUpdate(e,t){e.userId!==this.props.userId||e.room!==this.props.room?this.updateApps():this.getAppsHash(this.topApps())!==this.getAppsHash(t.apps[Bn.a.Top])&&this.loadResizerPreferences()}isResizing(){return this.state.resizingVertical||this.state.resizingHorizontal}render(){if(!this.props.showApps)return s.a.createElement("div",null);const e=this.centerApps().length>0,t=(e?this.centerApps():this.topApps()).map((e,t,a)=>s.a.createElement($n,{key:e.id,app:e,fullWidth:a.length<2,room:this.props.room,userId:this.props.userId,creatorUserId:e.creatorUserId,widgetPageTitle:Ba.a.getWidgetDataTitle(e),waitForIframeLoad:e.waitForIframeLoad,pointerEvents:this.isResizing()?"none":void 0}));if(0===t.length)return s.a.createElement("div",null);let a;0===t.length&&dl.a.roomHasPendingWidgets(this.props.room.roomId,Ba.a.getRoomWidgets(this.props.room))&&(a=s.a.createElement(Ya.a,null));const n=l()({mx_AppsDrawer:!0,mx_AppsDrawer_maximise:e,mx_AppsDrawer_fullWidth:t.length<2,mx_AppsDrawer_resizing:this.state.resizing,mx_AppsDrawer_2apps:2===t.length,mx_AppsDrawer_3apps:3===t.length}),i=s.a.createElement("div",{className:"mx_AppsContainer",ref:this.collectResizer},t.map((e,a)=>a<1?e:s.a.createElement(s.a.Fragment,{key:e.key},s.a.createElement(y,{reverse:a>t.length/2}),e)));let r;return r=e?i:s.a.createElement(Kl,{room:this.props.room,minHeight:100,maxHeight:this.props.maxHeight-50,handleClass:"mx_AppsContainer_resizerHandle",handleWrapperClass:"mx_AppsContainer_resizerHandleContainer",className:"mx_AppsContainer_resizer",resizeNotifier:this.props.resizeNotifier},i),s.a.createElement("div",{className:n},r,a)}}i()(ql,"defaultProps",{showApps:!0});const Kl=e=>{let{room:t,minHeight:a,maxHeight:n,className:i,handleWrapperClass:r,handleClass:o,resizeNotifier:c,children:l}=e,d=Bn.d.instance.getContainerHeight(t,Bn.a.Top);return a||(a=100),n||(n=$.b.instance.windowHeight/4*3),d?(d=Object(Gl.a)(d,0,100),d=Object(Gl.d)(d/100,a,n)):d=280,s.a.createElement(Vi.Resizable,{size:{height:Math.min(d,n),width:void 0},minHeight:a,maxHeight:n,onResizeStart:()=>{c.startResizing()},onResize:()=>{c.notifyTimelineHeightChanged()},onResizeStop:(e,i,r,s)=>{let o=d+s.height;o=100*Object(Gl.c)(o,a,n),Bn.d.instance.setContainerHeight(t,Bn.a.Top,o),c.stopResizing()},handleWrapperClass:r,handleClasses:{bottom:o},className:i,enable:{bottom:!0}},l)};class Yl extends s.a.Component{constructor(e){super(e),i()(this,"updateCall",()=>{const e=this.getCall();e!==this.state.call&&this.setState({call:e})}),i()(this,"onResizeStart",()=>{this.props.resizeNotifier.startResizing()}),i()(this,"onResize",()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()}),i()(this,"onResizeStop",()=>{this.props.resizeNotifier.stopResizing()}),this.state={call:this.getCall()}}componentDidMount(){F.b.instance.addListener(F.a.CallState,this.updateCall),F.b.instance.addListener(F.a.CallChangeRoom,this.updateCall)}componentWillUnmount(){F.b.instance.removeListener(F.a.CallState,this.updateCall),F.b.instance.removeListener(F.a.CallChangeRoom,this.updateCall)}getCall(){const e=F.b.instance.getCallForRoom(this.props.roomId);return e&&[ca.e.Ended,ca.e.Ringing].includes(e.state)?null:e}render(){return this.state.call?s.a.createElement("div",{className:"mx_LegacyCallViewForRoom"},s.a.createElement(Vi.Resizable,{minHeight:380,maxHeight:"80vh",enable:{top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,className:"mx_LegacyCallViewForRoom_ResizeWrapper",handleClasses:{bottom:"mx_LegacyCallViewForRoom_ResizeHandle"}},s.a.createElement(Fa,{call:this.state.call,pipMode:!1,showApps:this.props.showApps}))):null}}class Jl extends s.a.Component{constructor(e){super(e),i()(this,"onRoomStateEvents",e=>{"re.jki.counter"===e.getType()&&this.updateCounters()}),i()(this,"updateCounters",Object(k.throttle)(()=>{this.setState({counters:this.computeCounters()})},500,{leading:!0,trailing:!0})),this.state={counters:this.computeCounters()}}componentDidMount(){const e=st.a.get();f.b.getValue("feature_state_counters")&&e.on(u.b.Events,this.onRoomStateEvents)}componentWillUnmount(){var e;f.b.getValue("feature_state_counters")&&(null===(e=st.a.get())||void 0===e||e.removeListener(u.b.Events,this.onRoomStateEvents))}shouldComponentUpdate(e,t){return Object(dn.c)(this.props,e)||Object(dn.c)(this.state,t)}computeCounters(){const e=[];if(this.props.room&&f.b.getValue("feature_state_counters")){const t=this.props.room.currentState.getStateEvents("re.jki.counter");t.sort((e,t)=>Object($a.v)(e.getStateKey(),t.getStateKey()));for(const a of t){const t=a.getContent().title,n=a.getContent().value,i=a.getContent().link,r=a.getContent().severity||"normal",s=a.getStateKey();t&&void 0!==n&&e.push({title:t,value:n,link:i,severity:r,stateKey:s})}}return e}render(){const e=s.a.createElement(Yl,{roomId:this.props.room.roomId,resizeNotifier:this.props.resizeNotifier,showApps:this.props.showApps});let t;f.b.getValue(se.b.Widgets)&&(t=s.a.createElement(ql,{room:this.props.room,userId:this.props.userId,showApps:this.props.showApps,resizeNotifier:this.props.resizeNotifier}));let a=null;if(this.state.counters&&f.b.getValue("feature_state_counters")){const e=[];this.state.counters.forEach((t,a)=>{const n=t.title,i=t.value,r=t.link,o=t.severity,c=t.stateKey;let l=s.a.createElement("span",null,n,": ",i);r&&(l=s.a.createElement("a",{href:r,target:"_blank",rel:"noreferrer noopener"},l)),l=s.a.createElement("span",{className:"m_RoomView_auxPanel_stateViews_span","data-severity":o,key:"x-"+c},l),e.push(l),e.push(s.a.createElement("span",{className:"m_RoomView_auxPanel_stateViews_delim",key:"delim"+a}," ─ "))}),e.length>0&&(e.pop(),a=s.a.createElement("div",{className:"m_RoomView_auxPanel_stateViews"},e))}return s.a.createElement(bt.a,{className:"mx_RoomView_auxPanel"},a,this.props.children,t,e)}}i()(Jl,"defaultProps",{showApps:!0});var $l=a(240);const Ql=["isHighlighted","isUnread","onClick","name","title"];class Xl extends s.a.Component{render(){const e=this.props,{isHighlighted:t,isUnread:a=!1,onClick:n,name:i,title:r}=e,o=ge()(e,Ql),c=l()({mx_RightPanel_headerButton:!0,mx_RightPanel_headerButton_highlight:t,mx_RightPanel_headerButton_unread:a,["mx_RightPanel_"+i]:!0});return s.a.createElement(q.a,X()({},o,{"aria-selected":t,role:"tab",title:r,alignment:xa.a.Bottom,className:c,onClick:n}))}}let Zl;!function(e){e.Room="room"}(Zl||(Zl={}));class ed extends s.a.Component{constructor(e,t){super(e),i()(this,"unmounted",!1),i()(this,"dispatcherRef",void 0),i()(this,"onRightPanelStoreUpdate",()=>{this.unmounted||this.setState({phase:Gi.a.instance.currentCard.phase})});const a=Gi.a.instance;this.state={headerKind:t,phase:a.currentCard.phase,threadNotificationColor:Oe.a.None,globalNotificationColor:Oe.a.None}}componentDidMount(){Gi.a.instance.on(mt.b,this.onRightPanelStoreUpdate),this.dispatcherRef=v.a.register(this.onAction.bind(this))}componentWillUnmount(){this.unmounted=!0,Gi.a.instance.off(mt.b,this.onRightPanelStoreUpdate),this.dispatcherRef&&v.a.unregister(this.dispatcherRef)}setPhase(e,t){const a=Gi.a.instance;a.currentCard.phase==e&&!t&&a.isOpen?a.togglePanel(null):(Gi.a.instance.setCard({phase:e,state:t}),a.isOpen||a.togglePanel(null))}isPhase(e){return!!Gi.a.instance.isOpen&&(Array.isArray(e)?e.includes(this.state.phase):e===this.state.phase)}render(){return s.a.createElement("div",{className:"mx_HeaderButtons",role:"tablist"},this.renderButtons())}}var td=a(195);const ad=[Hi.a.RoomSummary,Hi.a.Widget,Hi.a.FilePanel,Hi.a.RoomMemberList,Hi.a.RoomMemberInfo,Hi.a.EncryptionPanel,Hi.a.Room3pidMemberInfo],nd=e=>{let{color:t}=e;if(t===Oe.a.None)return null;const a=l()({mx_Indicator:!0,mx_RightPanel_headerButton_unreadIndicator:!0,mx_Indicator_bold:t===Oe.a.Bold,mx_Indicator_gray:t===Oe.a.Grey,mx_Indicator_red:t===Oe.a.Red});return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_RightPanel_headerButton_unreadIndicator_bg"}),s.a.createElement("div",{className:a}))},id=e=>{let{room:t,isHighlighted:a,onClick:n}=e;const i=Object(ie.b)("feature_pinning"),r=vr(i&&t),o=fr(i&&t);if(null==r||!r.length)return null;let c;return r.some(e=>!o.has(e))&&(c=s.a.createElement(nd,null)),s.a.createElement(Xl,{name:"pinnedMessagesButton",title:Object(N.a)("Pinned messages"),isHighlighted:a,isUnread:!!c,onClick:n},c)},rd=e=>{let t,{room:a,isHighlighted:n,onClick:i}=e;const r=Ne.a.instance.getRoomState(a).color;switch(r){case Oe.a.Bold:case Oe.a.Grey:case Oe.a.Red:t=s.a.createElement(nd,{color:r})}return s.a.createElement(Xl,{name:"timelineCardButton",title:Object(N.a)("Chat"),isHighlighted:n,onClick:i},t)};class sd extends ed{get supportsThreadNotifications(){return st.a.get().canSupport.get($l.a.ThreadUnreadNotifications)!==$l.b.Unsupported}constructor(e){super(e,Zl.Room),i()(this,"threadNotificationState",void 0),i()(this,"globalNotificationState",void 0),i()(this,"onNotificationUpdate",()=>{let e;e=this.supportsThreadNotifications?this.notificationColor:this.threadNotificationState.color,this.setState({threadNotificationColor:e})}),i()(this,"onUpdateStatus",e=>{this.globalNotificationState=e,this.setState({globalNotificationColor:e.color})}),i()(this,"onRoomSummaryClicked",()=>{const e=Gi.a.instance.currentCard.phase;ad.includes(e)?this.state.phase===e?this.setPhase(e):this.setPhase(e,Gi.a.instance.currentCard.state):this.setPhase(Hi.a.RoomSummary)}),i()(this,"onNotificationsClicked",()=>{this.setPhase(Hi.a.NotificationPanel)}),i()(this,"onPinnedMessagesClicked",()=>{this.setPhase(Hi.a.PinnedMessages)}),i()(this,"onTimelineCardClicked",()=>{this.setPhase(Hi.a.Timeline)}),i()(this,"onThreadsPanelClicked",e=>{var t;sd.THREAD_PHASES.includes(this.state.phase)?Gi.a.instance.togglePanel(null===(t=this.props.room)||void 0===t?void 0:t.roomId):(Gi.a.instance.setCard({phase:Hi.a.ThreadPanel}),re.b.trackInteraction("WebRoomHeaderButtonsThreadsButton",e))}),this.supportsThreadNotifications||(this.threadNotificationState=Ne.a.instance.getThreadsRoomState(this.props.room)),this.globalNotificationState=Ne.a.instance.globalState}componentDidMount(){var e,t;(super.componentDidMount(),this.supportsThreadNotifications)?null===(e=this.props.room)||void 0===e||e.on(ee.d.UnreadNotifications,this.onNotificationUpdate):null===(t=this.threadNotificationState)||void 0===t||t.on(td.b.Update,this.onNotificationUpdate);this.onNotificationUpdate(),Ne.a.instance.on(Ne.b,this.onUpdateStatus)}componentWillUnmount(){var e,t;(super.componentWillUnmount(),this.supportsThreadNotifications)?null===(e=this.props.room)||void 0===e||e.off(ee.d.UnreadNotifications,this.onNotificationUpdate):null===(t=this.threadNotificationState)||void 0===t||t.off(td.b.Update,this.onNotificationUpdate);Ne.a.instance.off(Ne.b,this.onUpdateStatus)}get notificationColor(){switch(this.props.room.threadsAggregateNotificationType){case ee.b.Highlight:return Oe.a.Red;case ee.b.Total:return Oe.a.Grey;default:return Oe.a.None}}onAction(e){e.action===L.a.ViewUser?e.member?e.push?Gi.a.instance.pushCard({phase:Hi.a.RoomMemberInfo,state:{member:e.member}}):Gi.a.instance.setCards([{phase:Hi.a.RoomSummary},{phase:Hi.a.RoomMemberList},{phase:Hi.a.RoomMemberInfo,state:{member:e.member}}]):this.setPhase(Hi.a.RoomMemberList):"view_3pid_invite"===e.action&&(e.event?this.setPhase(Hi.a.Room3pidMemberInfo,{memberInfoEvent:e.event}):this.setPhase(Hi.a.RoomMemberList))}renderButtons(){const e=new Map;return e.set(Hi.a.PinnedMessages,s.a.createElement(id,{key:"pinnedMessagesButton",room:this.props.room,isHighlighted:this.isPhase(Hi.a.PinnedMessages),onClick:this.onPinnedMessagesClicked})),e.set(Hi.a.Timeline,s.a.createElement(rd,{key:"timelineButton",room:this.props.room,isHighlighted:this.isPhase(Hi.a.Timeline),onClick:this.onTimelineCardClicked})),e.set(Hi.a.ThreadPanel,f.b.getValue("feature_thread")?s.a.createElement(Xl,{key:Hi.a.ThreadPanel,name:"threadsButton","data-testid":"threadsButton",title:Object(N.a)("Threads"),onClick:this.onThreadsPanelClicked,isHighlighted:this.isPhase(sd.THREAD_PHASES),isUnread:this.state.threadNotificationColor>0},s.a.createElement(nd,{color:this.state.threadNotificationColor})):null),e.set(Hi.a.NotificationPanel,s.a.createElement(Xl,{key:"notifsButton",name:"notifsButton",title:Object(N.a)("Notifications"),isHighlighted:this.isPhase(Hi.a.NotificationPanel),onClick:this.onNotificationsClicked,isUnread:this.globalNotificationState.color===Oe.a.Red},this.globalNotificationState.color===Oe.a.Red?s.a.createElement(nd,{color:this.globalNotificationState.color}):null)),e.set(Hi.a.RoomSummary,s.a.createElement(Xl,{key:"roomSummaryButton",name:"roomSummaryButton",title:Object(N.a)("Room info"),isHighlighted:this.isPhase(ad),onClick:this.onRoomSummaryClicked})),s.a.createElement(s.a.Fragment,null,Array.from(e.keys()).map(t=>{var a;return null!==(a=this.props.excludedRightPanelPhaseButtons)&&void 0!==a&&a.includes(t)?null:e.get(t)}))}}i()(sd,"THREAD_PHASES",[Hi.a.ThreadPanel,Hi.a.ThreadView]);var od=a(895),cd=a(446),ld=a(246),dd=a(367);const ud=["room","onFinished"];var md=e=>{var t;let{room:a,onFinished:n}=e,i=ge()(e,ud);const o=Object(r.useContext)(R.a),c=Object(ne.b)(Qt.c.instance,Qt.b,()=>Qt.c.instance.getTagsForRoom(a));let l;if(c.includes(T.a.Archived)){const e=e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"forget_room",room_id:a.roomId}),n()};l=s.a.createElement(de.b,{iconClassName:"mx_RoomTile_iconSignOut",label:Object(N.a)("Forget"),className:"mx_IconizedContextMenu_option_red",onClick:e})}else{const e=e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"leave_room",room_id:a.roomId}),n(),re.b.trackInteraction("WebRoomHeaderContextMenuLeaveItem",e)};l=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Leave"),className:"mx_IconizedContextMenu_option_red",iconClassName:"mx_RoomTile_iconSignOut"})}const d=Qi.a.shared().getUserIdForRoomId(a.roomId),u=Object(ie.a)("feature_video_rooms"),m=Object(ie.a)("feature_element_call_video_rooms"),h=u&&(a.isElementVideoRoom()||m&&a.isCallRoom());let p,g,b,y,E,_,w;if(a.canInvite(o.getUserId())&&!d){const e=e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"view_invite",roomId:a.roomId}),n(),re.b.trackInteraction("WebRoomHeaderContextMenuInviteItem",e)};p=s.a.createElement(de.b,{onClick:e,label:Object(N.a)("Invite"),iconClassName:"mx_RoomTile_iconInvite"})}if("join"===a.getMyMembership()){const e=c.includes(T.a.Favourite);g=s.a.createElement(de.a,{onClick:e=>{j(e,T.a.Favourite),re.b.trackInteraction("WebRoomHeaderContextMenuFavouriteToggle",e)},active:e,label:e?Object(N.a)("Favourited"):Object(N.a)("Favourite"),iconClassName:"mx_RoomTile_iconStar"});const t=c.includes(T.a.LowPriority);b=s.a.createElement(de.a,{onClick:e=>j(e,T.a.LowPriority),active:t,label:Object(N.a)("Low priority"),iconClassName:"mx_RoomTile_iconArrowDown"});let i,r;switch(cd.a.forRoom(a).notificationVolume){case ld.a.AllMessages:i=Object(N.a)("Default"),r="mx_RoomTile_iconNotificationsDefault";break;case ld.a.AllMessagesLoud:i=Object(N.a)("All messages"),r="mx_RoomTile_iconNotificationsAllMessages";break;case ld.a.MentionsOnly:i=Object(N.a)("Mentions only"),r="mx_RoomTile_iconNotificationsMentionsKeywords";break;case ld.a.Mute:i=Object(N.a)("Mute"),r="mx_RoomTile_iconNotificationsNone"}y=s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"open_room_settings",room_id:a.roomId,initial_tab_id:dd.a}),n(),re.b.trackInteraction("WebRoomHeaderContextMenuNotificationsItem",e)},label:Object(N.a)("Notifications"),iconClassName:r},s.a.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},i))}d||(E=s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),I(e),Gi.a.instance.pushCard({phase:Hi.a.RoomMemberList},!1),n(),re.b.trackInteraction("WebRoomHeaderContextMenuPeopleItem",e)},label:Object(N.a)("People"),iconClassName:"mx_RoomTile_iconPeople"},s.a.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},a.getJoinedMemberCount())),_=s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"copy_room",room_id:a.roomId}),n()},label:Object(N.a)("Copy room link"),iconClassName:"mx_RoomTile_iconCopyLink"})),h||(w=s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),I(e),Gi.a.instance.pushCard({phase:Hi.a.FilePanel},!1),n()},label:Object(N.a)("Files"),iconClassName:"mx_RoomTile_iconFiles"}));const S=Object(ie.a)("feature_pinning"),O=null===(t=vr(S&&a))||void 0===t?void 0:t.length;let C,x,k;S&&!h&&(C=s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),I(e),Gi.a.instance.pushCard({phase:Hi.a.PinnedMessages},!1),n()},label:Object(N.a)("Pinned"),iconClassName:"mx_RoomTile_iconPins"},O>0&&s.a.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},O))),h||(x=s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),I(e),Gi.a.instance.setCard({phase:Hi.a.RoomSummary},!1),n()},label:Object(N.a)("Widgets"),iconClassName:"mx_RoomTile_iconWidgets"})),h||(k=s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),z.a.createDialog(Nr,{room:a}),n()},label:Object(N.a)("Export chat"),iconClassName:"mx_RoomTile_iconExport"}));const j=(e,t)=>{if(e.preventDefault(),e.stopPropagation(),t===T.a.Favourite||t===T.a.LowPriority){const e=t===T.a.Favourite?T.a.LowPriority:T.a.Favourite,n=Qt.c.instance.getTagsForRoom(a).includes(t),i=n?t:e,r=n?null:t;v.a.dispatch(od.a.tagRoom(o,a,i,r,void 0,0))}else la.a.warn(`Unexpected tag ${t} applied to ${a.roomId}`);switch(Object(J.a)().getAccessibilityAction(e)){case V.h.Enter:n()}},I=e=>{it.b.instance.roomViewStore.getRoomId()!==a.roomId&&v.a.dispatch({action:L.a.ViewRoom,room_id:a.roomId,metricsTrigger:"RoomList",metricsViaKeyboard:"click"!==e.type},!0)};return s.a.createElement(de.e,X()({},i,{onFinished:n,className:"mx_RoomTile_contextMenu",compact:!0}),s.a.createElement(de.c,null,p,y,g,E,w,C,x,b,_,s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"open_room_settings",room_id:a.roomId}),n(),re.b.trackInteraction("WebRoomHeaderContextMenuSettingsItem",e)},label:Object(N.a)("Settings"),iconClassName:"mx_RoomTile_iconSettings"}),k,f.b.getValue("developerMode")&&s.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),z.a.createDialog(nt.a,{roomId:it.b.instance.roomViewStore.getRoomId()},"mx_DevtoolsDialog_wrapper"),n()},label:Object(N.a)("Developer tools"),iconClassName:"mx_RoomTile_iconDeveloperTools"}),l))},hd=a(414),pd=a(806),gd=a(805);const vd=e=>{let{liveBeaconIds:t,roomId:a}=e;const{onStopSharing:n,onResetLocationPublishError:i,beacon:r,stoppingInProgress:o,hasStopSharingError:c,hasLocationPublishError:l}=Object(jo.k)(t);if(!r)return null;const d=c||l,u=e=>t=>{null==t||t.stopPropagation(),e()};return s.a.createElement("div",{className:"mx_RoomLiveShareWarning",onClick:()=>{v.a.dispatch({action:L.a.ViewRoom,room_id:r.roomId,metricsTrigger:void 0,event_id:r.beaconInfoId,scroll_into_view:!0,highlighted:!0})}},s.a.createElement(Qo.a,{className:"mx_RoomLiveShareWarning_icon",withError:d}),s.a.createElement("span",{className:"mx_RoomLiveShareWarning_label"},((e,t)=>e?Object(N.a)("An error occurred whilst sharing your live location, please try again"):t?Object(N.a)("An error occurred while stopping your live location, please try again"):Object(N.a)("You are sharing your live location"))(l,c)),o&&s.a.createElement("span",{className:"mx_RoomLiveShareWarning_spinner"},s.a.createElement(Ya.a,{h:16,w:16})),!o&&!d&&s.a.createElement(gd.a,{beacon:r}),s.a.createElement(H.a,{className:"mx_RoomLiveShareWarning_stopButton","data-test-id":"room-live-share-primary-button",onClick:u(()=>{l?i():n()}),kind:"danger",element:"button",disabled:o},d?Object(N.a)("Retry"):Object(N.a)("Stop")),l&&s.a.createElement(H.a,{"data-test-id":"room-live-share-wire-error-close-button",title:Object(N.a)("Stop and close"),element:"button",className:"mx_RoomLiveShareWarning_closeButton",onClick:u(n)},s.a.createElement(pd.a,{className:"mx_RoomLiveShareWarning_closeButtonIcon"})))};var fd=e=>{let{roomId:t}=e;const a=Object(ne.b)(Lo.a.instance,Lo.b.MonitoringLivePosition,()=>Lo.a.instance.isMonitoringLiveLocation),n=Object(ne.b)(Lo.a.instance,Lo.b.LivenessChange,()=>Lo.a.instance.getLiveBeaconIds(t));return a&&n.length?s.a.createElement(vd,{liveBeaconIds:n,roomId:t}):null};const bd=e=>e.isElementVideoRoom()||f.b.getValue("feature_element_call_video_rooms")&&e.isCallRoom();var yd=a(275),Ed=a(744),_d=a(172),wd=a(570);const Sd=e=>{let{roomId:t,call:a}=e;const n=null==a?void 0:a.groupCall,i=Object(r.useCallback)(e=>{e.preventDefault(),v.b.dispatch({action:L.a.ViewRoom,room_id:t,view_call:!0,metricsTrigger:void 0})},[t]),o=Object(r.useCallback)(()=>{v.a.dispatch({action:L.a.ViewRoom,room_id:t,metricsTrigger:void 0,event_id:n.getId(),scroll_into_view:!0,highlighted:!0})},[n,t]);return s.a.createElement("div",{className:"mx_RoomCallBanner",onClick:o},s.a.createElement("div",{className:"mx_RoomCallBanner_text"},s.a.createElement("span",{className:"mx_RoomCallBanner_label"},Object(N.a)("Video call")),s.a.createElement(wd.b,{mxEvent:n})),s.a.createElement(H.a,{onClick:i,kind:"primary",element:"button",disabled:!1},Object(N.a)("Join")))};var Od=e=>{let{roomId:t}=e;const a=Object(yd.a)(t),n=Object(ne.b)(Lo.a.instance,Lo.b.MonitoringLivePosition,()=>Lo.a.instance.isMonitoringLiveLocation),i=Object(ne.b)(Lo.a.instance,Lo.b.LivenessChange,()=>Lo.a.instance.getLiveBeaconIds(t));return n&&i.length||it.b.instance.roomViewStore.isViewingCall()?null:a?a.connectionState!==_d.c.Disconnected?null:s.a.createElement(Sd,{call:a,roomId:t}):null};class Cd{constructor(e){this.reason=e}}const xd=e=>{let{room:t,busy:a,setBusy:n,behavior:i}=e;const{onClick:o,tooltip:c,disabled:l}=Object(r.useMemo)(()=>i instanceof Cd?{onClick:()=>{},tooltip:i.reason,disabled:!0}:{onClick:async e=>{e.preventDefault(),n(!0),await F.b.instance.placeCall(t.roomId,ca.f.Voice),n(!1)},disabled:!1},[i,t,n]);return s.a.createElement(q.a,{className:"mx_RoomHeader_button mx_RoomHeader_voiceCallButton",onClick:o,title:Object(N.a)("Voice call"),tooltip:null!=c?c:Object(N.a)("Voice call"),alignment:xa.a.Bottom,disabled:l||a})},kd=e=>{let{room:t,busy:a,setBusy:n,behavior:i}=e;const[o,c,l,d]=Object(ce.p)(),u=Object(r.useCallback)(async()=>{n(!0),await F.b.instance.placeCall(t.roomId,ca.f.Video),n(!1)},[n,t]),m=Object(r.useCallback)(()=>{n(!0),v.a.dispatch({action:L.a.ViewRoom,room_id:t.roomId,view_call:!0,metricsTrigger:void 0}),n(!1)},[n,t]),{onClick:h,tooltip:p,disabled:g}=Object(r.useMemo)(()=>i instanceof Cd?{onClick:()=>{},tooltip:i.reason,disabled:!0}:"legacy_or_jitsi"===i?{onClick:async e=>{e.preventDefault(),await u()},disabled:!1}:"element"===i?{onClick:async e=>{e.preventDefault(),m()},disabled:!1}:{onClick:async e=>{e.preventDefault(),l()},disabled:!1},[i,u,m,l]),f=Object(r.useCallback)(async e=>{e.preventDefault(),d(),await u()},[d,u]),b=Object(r.useCallback)(e=>{e.preventDefault(),d(),m()},[d,m]);let y=null;if(o){var E;const e=c.current.getBoundingClientRect(),t=null!==(E=lt.b.get("element_call").brand)&&void 0!==E?E:lt.a.element_call.brand;y=s.a.createElement(de.e,X()({},Object(ce.i)(e),{onFinished:d}),s.a.createElement(de.c,null,s.a.createElement(de.b,{label:Object(N.a)("Video call (Jitsi)"),onClick:f}),s.a.createElement(de.b,{label:Object(N.a)("Video call (%(brand)s)",{brand:t}),onClick:b})))}return s.a.createElement(s.a.Fragment,null,s.a.createElement(q.a,{inputRef:c,className:"mx_RoomHeader_button mx_RoomHeader_videoCallButton",onClick:h,title:Object(N.a)("Video call"),tooltip:null!=p?p:Object(N.a)("Video call"),alignment:xa.a.Bottom,disabled:g||a}),y)},jd=e=>{let{room:t}=e;const[a,n]=Object(r.useState)(!1),i=Object(ie.b)("showCallButtonsInComposer"),o=Object(ie.a)("feature_group_calls"),c=Object(ie.a)("feature_video_rooms"),l=Object(r.useMemo)(()=>c&&bd(t),[c,t]),d=Object(r.useMemo)(()=>{var e;return null!==(e=lt.b.get("element_call").use_exclusively)&&void 0!==e?e:lt.a.element_call.use_exclusively},[]),m=Object(ne.b)(F.b.instance,F.a.CallsChanged,Object(r.useCallback)(()=>null!==F.b.instance.getCallForRoom(t.roomId),[t])),h=Pr(t),p=Object(r.useMemo)(()=>h.some(e=>Za.a.JITSI.matches(e.type)),[h]),g=null!==Object(yd.a)(t.roomId),[v,f,b]=Object(ne.d)(t,u.b.Update,Object(r.useCallback)(()=>[Object(Ed.a)(t),t.currentState.mayClientSendStateEvent("im.vector.modular.widgets",t.client),t.currentState.mayClientSendStateEvent(_d.d.CALL_EVENT_TYPE.name,t.client)],[t])),y=e=>s.a.createElement(xd,{room:t,busy:a,setBusy:n,behavior:e}),E=e=>s.a.createElement(kd,{room:t,busy:a,setBusy:n,behavior:e});if(l||!i)return null;if(o){if(d)return E(g?new Cd(Object(N.a)("Ongoing call")):b?"element":new Cd(Object(N.a)("You do not have permission to start video calls")));if(m||p||g)return s.a.createElement(s.a.Fragment,null,y(new Cd(Object(N.a)("Ongoing call"))),E(new Cd(Object(N.a)("Ongoing call"))));if(v.length<=1)return s.a.createElement(s.a.Fragment,null,y(new Cd(Object(N.a)("There's no one here to call"))),E(new Cd(Object(N.a)("There's no one here to call"))));if(2===v.length)return s.a.createElement(s.a.Fragment,null,y("legacy_or_jitsi"),E("legacy_or_jitsi"));if(f)return s.a.createElement(s.a.Fragment,null,y("legacy_or_jitsi"),E(b?"jitsi_or_element":"legacy_or_jitsi"));{const e=b?"element":new Cd(Object(N.a)("You do not have permission to start video calls"));return s.a.createElement(s.a.Fragment,null,y(new Cd(Object(N.a)("You do not have permission to start voice calls"))),E(e))}}return m||p?s.a.createElement(s.a.Fragment,null,y(new Cd(Object(N.a)("Ongoing call"))),E(new Cd(Object(N.a)("Ongoing call")))):v.length<=1?s.a.createElement(s.a.Fragment,null,y(new Cd(Object(N.a)("There's no one here to call"))),E(new Cd(Object(N.a)("There's no one here to call")))):2===v.length||f?s.a.createElement(s.a.Fragment,null,y("legacy_or_jitsi"),E("legacy_or_jitsi")):s.a.createElement(s.a.Fragment,null,y(new Cd(Object(N.a)("You do not have permission to start voice calls"))),E(new Cd(Object(N.a)("You do not have permission to start video calls"))))},Rd=e=>{let{call:t}=e;const a=Object(yd.e)(t),[n,i,o,c]=Object(ce.p)(),d=Object(r.useCallback)(e=>{e.preventDefault(),o()},[o]),u=Object(r.useCallback)(e=>{e.preventDefault(),c(),t.setLayout(_d.f.Tile)},[c,t]),m=Object(r.useCallback)(e=>{e.preventDefault(),c(),t.setLayout(_d.f.Spotlight)},[c,t]);let h=null;if(n){const e=i.current.getBoundingClientRect();h=s.a.createElement(de.e,X()({className:"mx_RoomHeader_layoutMenu"},Object(ce.i)(e),{onFinished:c}),s.a.createElement(de.c,null,s.a.createElement(de.d,{iconClassName:"mx_RoomHeader_freedomIcon",label:Object(N.a)("Freedom"),active:a===_d.f.Tile,onClick:u}),s.a.createElement(de.d,{iconClassName:"mx_RoomHeader_spotlightIcon",label:Object(N.a)("Spotlight"),active:a===_d.f.Spotlight,onClick:m})))}return s.a.createElement(s.a.Fragment,null,s.a.createElement(q.a,{inputRef:i,className:l()("mx_RoomHeader_button",{"mx_RoomHeader_layoutButton--freedom":a===_d.f.Tile,"mx_RoomHeader_layoutButton--spotlight":a===_d.f.Spotlight}),onClick:d,title:Object(N.a)("Layout type"),alignment:xa.a.Bottom,key:"layout"}),h)};class Id extends s.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"client",this.props.room.client),i()(this,"onRightPanelStoreUpdate",()=>{this.setState({rightPanelOpen:Gi.a.instance.isOpen})}),i()(this,"onRoomStateEvents",e=>{this.props.room&&e.getRoomId()===this.props.room.roomId&&this.rateLimitedUpdate()}),i()(this,"onNotificationUpdate",()=>{this.forceUpdate()}),i()(this,"rateLimitedUpdate",Object(k.throttle)(()=>{this.forceUpdate()},500,{leading:!0,trailing:!0})),i()(this,"onContextMenuOpenClick",e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})}),i()(this,"onContextMenuCloseClick",()=>{this.setState({contextMenuPosition:void 0})}),i()(this,"onHideCallClick",e=>{e.preventDefault(),v.a.dispatch({action:L.a.ViewRoom,room_id:this.props.room.roomId,view_call:!1,metricsTrigger:void 0})});Ne.a.instance.getRoomState(e.room).on(td.b.Update,this.onNotificationUpdate),this.state={rightPanelOpen:Gi.a.instance.isOpen}}componentDidMount(){this.client.on(u.b.Events,this.onRoomStateEvents),Gi.a.instance.on(mt.b,this.onRightPanelStoreUpdate)}componentWillUnmount(){this.client.removeListener(u.b.Events,this.onRoomStateEvents);Ne.a.instance.getRoomState(this.props.room).removeListener(td.b.Update,this.onNotificationUpdate),Gi.a.instance.off(mt.b,this.onRightPanelStoreUpdate)}renderButtons(e){const t=[];this.props.viewingCall||!this.props.inRoom||this.context.tombstone||t.push(s.a.createElement(jd,{key:"calls",room:this.props.room})),this.props.viewingCall&&this.props.activeCall instanceof _d.d&&t.push(s.a.createElement(Rd,{call:this.props.activeCall})),!this.props.viewingCall&&this.props.onForgetClick&&t.push(s.a.createElement(q.a,{className:"mx_RoomHeader_button mx_RoomHeader_forgetButton",onClick:this.props.onForgetClick,title:Object(N.a)("Forget room"),alignment:xa.a.Bottom,key:"forget"})),!this.props.viewingCall&&this.props.onAppsClick&&t.push(s.a.createElement(q.a,{className:l()("mx_RoomHeader_button mx_RoomHeader_appsButton",{mx_RoomHeader_appsButton_highlight:this.props.appsShown}),onClick:this.props.onAppsClick,title:this.props.appsShown?Object(N.a)("Hide Widgets"):Object(N.a)("Show Widgets"),alignment:xa.a.Bottom,key:"apps"})),!this.props.viewingCall&&this.props.onSearchClick&&this.props.inRoom&&t.push(s.a.createElement(q.a,{className:"mx_RoomHeader_button mx_RoomHeader_searchButton",onClick:this.props.onSearchClick,title:Object(N.a)("Search"),alignment:xa.a.Bottom,key:"search"})),this.props.onInviteClick&&(!this.props.viewingCall||e)&&this.props.inRoom&&t.push(s.a.createElement(q.a,{className:"mx_RoomHeader_button mx_RoomHeader_inviteButton",onClick:this.props.onInviteClick,title:Object(N.a)("Invite"),alignment:xa.a.Bottom,key:"invite"}));const a=[];return this.props.viewingCall&&!e&&(null===this.props.activeCall?a.push(s.a.createElement(H.a,{className:"mx_RoomHeader_button mx_RoomHeader_closeButton",onClick:this.onHideCallClick,title:Object(N.a)("Close call"),key:"close"})):a.push(s.a.createElement(q.a,{className:"mx_RoomHeader_button mx_RoomHeader_minimiseButton",onClick:this.onHideCallClick,title:Object(N.a)("View chat timeline"),alignment:xa.a.Bottom,key:"minimise"}))),s.a.createElement(s.a.Fragment,null,t,s.a.createElement(sd,{room:this.props.room,excludedRightPanelPhaseButtons:this.props.excludedRightPanelPhaseButtons}),a)}renderName(e){let t=null;this.state.contextMenuPosition&&this.props.room&&(t=s.a.createElement(md,X()({},Object(hd.a)(this.state.contextMenuPosition),{room:this.props.room,onFinished:this.onContextMenuCloseClick})));let a=!1;const n=this.props.room?this.props.room.getJoinedMembers():void 0;if(n&&1===n.length&&n[0].userId===this.client.credentials.userId){const e=this.props.room.currentState.getStateEvents("m.room.name","");e&&e.getContent().name||(a=!0)}const i=l()("mx_RoomHeader_nametext",{mx_RoomHeader_settingsHint:a}),r=s.a.createElement(yr.a,{room:this.props.room},t=>{const a=t||e;return s.a.createElement("div",{dir:"auto",className:i,title:a,role:"heading","aria-level":1},a)});return this.props.enableRoomOptionsMenu?s.a.createElement(ce.c,{className:"mx_RoomHeader_name",onClick:this.onContextMenuOpenClick,isExpanded:!!this.state.contextMenuPosition,title:Object(N.a)("Room options"),alignment:xa.a.Bottom},r,this.props.room&&s.a.createElement("div",{className:"mx_RoomHeader_chevron"}),t):s.a.createElement("div",{className:"mx_RoomHeader_name mx_RoomHeader_name--textonly"},r)}render(){const e=f.b.getValue("feature_video_rooms")&&bd(this.props.room);let t=null;this.props.room&&(t=s.a.createElement(Jt.a,{room:this.props.room,avatarSize:24,oobData:this.props.oobData,viewAvatarOnClick:!0}));const a=this.props.viewingCall?s.a.createElement("div",{className:"mx_RoomHeader_icon mx_RoomHeader_icon_video"}):this.props.e2eStatus?s.a.createElement(Zr.b,{className:"mx_RoomHeader_icon",status:this.props.e2eStatus,tooltipAlignment:xa.a.Bottom}):this.client.isRoomEncrypted(this.props.room.roomId)&&this.client.isCryptoEnabled()?s.a.createElement("div",{className:"mx_RoomHeader_icon"}):null,n=this.props.showButtons?this.renderButtons(e):null;if(this.props.viewingCall&&!e)return s.a.createElement("header",{className:"mx_RoomHeader light-panel"},s.a.createElement("div",{className:"mx_RoomHeader_wrapper","aria-owns":this.state.rightPanelOpen?"mx_RightPanel":void 0},s.a.createElement("div",{className:"mx_RoomHeader_avatar"},t),a,s.a.createElement("div",{className:"mx_RoomHeader_name mx_RoomHeader_name--textonly mx_RoomHeader_name--small"},Object(N.a)("Video call")),this.props.activeCall instanceof _d.d&&s.a.createElement(wd.b,{mxEvent:this.props.activeCall.groupCall}),s.a.createElement("div",{className:"mx_RoomHeader_topic"}),n));let i=null;this.props.searchInfo&&void 0!==this.props.searchInfo.searchCount&&null!==this.props.searchInfo.searchCount&&(i=s.a.createElement("div",{className:"mx_RoomHeader_searchStatus"}," ",Object(N.a)("(~%(count)s results)",{count:this.props.searchInfo.searchCount})));let r=Object(N.a)("Join Room");this.props.oobData&&this.props.oobData.name&&(r=this.props.oobData.name);const o=this.renderName(r),c=s.a.createElement(Ol,{room:this.props.room,className:"mx_RoomHeader_topic"}),l=e?s.a.createElement(le.a,{onClick:()=>v.a.dispatch({action:L.a.ViewUserSettings,initialTabId:Me.a.Labs}),tooltipTitle:Object(N.a)("Video rooms are a beta feature")}):null;return s.a.createElement("header",{className:"mx_RoomHeader light-panel"},s.a.createElement("div",{className:"mx_RoomHeader_wrapper","aria-owns":this.state.rightPanelOpen?"mx_RightPanel":void 0},s.a.createElement("div",{className:"mx_RoomHeader_avatar"},t),a,o,i,c,l,n),!e&&s.a.createElement(Od,{roomId:this.props.room.roomId}),s.a.createElement(fd,{roomId:this.props.room.roomId}))}}i()(Id,"defaultProps",{editing:!1,inRoom:!1,excludedRightPanelPhaseButtons:[],showButtons:!0,enableRoomOptionsMenu:!0}),i()(Id,"contextType",Un.b);var Td=e=>{let{roomWidth:t}=e;const n=Object(r.useRef)(null),i=Object(r.useRef)(new Map);return Object(r.useEffect)(()=>{const e=()=>{var e;n.current&&(null===(e=n.current)||void 0===e?void 0:e.height)!==$.b.instance.windowHeight&&(n.current.height=$.b.instance.windowHeight)},t=v.a.register(e=>{if(0===e.action.indexOf("effects.")){(async e=>{if(!e)return null;let t=i.current[e]||null;if(null===t){var n;const r=null===(n=gn.CHAT_EFFECTS.find(t=>t.command===e))||void 0===n?void 0:n.options;try{const{default:n}=await a(1491)("./"+e);t=new n(r),i.current[e]=t}catch(t){la.a.warn(`Unable to load effect module at '../../../effects/${e}.`,t)}}return t})(e.action.slice("effects.".length)).then(e=>null==e?void 0:e.start(n.current))}});return n.current.height=$.b.instance.windowHeight,$.b.instance.on($.a.Resize,e),()=>{v.a.unregister(t),$.b.instance.off($.a.Resize,e);const a=i.current;for(const e in a){const t=a[e];t&&t.isRunning&&t.stop()}}},[]),s.a.createElement("canvas",{ref:n,width:t,style:{display:"block",zIndex:999999,pointerEvents:"none",position:"fixed",top:0,right:0}})};const Nd=e=>{let{kind:t,devices:a,setDevice:n,deviceListLabel:i,muted:o,disabled:c,toggle:d,unmutedTitle:u,mutedTitle:m}=e;const[h,p,g,v]=Object(ce.p)(),f=Object(r.useCallback)(e=>{n(e),v()},[n,v]);let b=null;if(h){const e=p.current.getBoundingClientRect();b=s.a.createElement(de.e,X()({},Object(ce.i)(e),{onFinished:v}),s.a.createElement(de.c,null,a.map(e=>s.a.createElement(de.b,{key:e.deviceId,label:e.label,onClick:()=>f(e)}))))}return a.length?s.a.createElement("div",{className:l()("mx_CallView_deviceButtonWrapper",{mx_CallView_deviceButtonWrapper_muted:o})},s.a.createElement(q.a,{className:"mx_CallView_deviceButton mx_CallView_deviceButton_"+t,title:o?m:u,alignment:xa.a.Top,onClick:d,disabled:c}),a.length>1?s.a.createElement(ce.b,{className:"mx_CallView_deviceListButton",inputRef:p,onClick:g,isExpanded:h,label:i,disabled:c}):null,b):null},Dd=e=>{let{room:t,joinCallButtonDisabled:a,joinCallButtonTooltip:n,connect:i,children:o}=e;const[c,l]=Object(r.useState)(!1),d=Object(r.useMemo)(()=>t.getMember(t.myUserId),[t]),u=Object(r.useRef)(null),[m,h]=Object(r.useState)(()=>p.c.getVideoInput()),[g,v]=Object(r.useState)(()=>p.c.startWithAudioMuted),[f,b]=Object(r.useState)(()=>p.c.startWithVideoMuted),y=Object(r.useCallback)(()=>{p.c.startWithAudioMuted=!g,v(!g)},[g,v]),E=Object(r.useCallback)(()=>{p.c.startWithVideoMuted=!f,b(!f)},[f,b]),[_,w,S]=Object(sr.a)(async()=>{let e=await p.c.getDevices(),t=null;try{e.audioinput.length>0?t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!f&&e.videoinput.length>0&&{deviceId:m}}):e.videoinput.length>0&&(t=await navigator.mediaDevices.getUserMedia({video:{deviceId:m}}))}catch(e){la.a.error("Failed to get stream for device "+m,e)}var a;(null!==t&&(e=await p.c.getDevices()),f)&&(null===(a=t)||void 0===a||a.getTracks().forEach(e=>e.stop()),t=null);return[t,e.audioinput,e.videoinput]},[m,f],[null,[],[]]),O=Object(r.useCallback)(e=>{p.c.instance.setAudioInput(e.deviceId)},[]),C=Object(r.useCallback)(e=>{p.c.instance.setVideoInput(e.deviceId),h(e.deviceId)},[]);Object(r.useEffect)(()=>{if(_){const e=u.current;return e.srcObject=_,e.play(),()=>{_.getTracks().forEach(e=>e.stop()),e.srcObject=null}}},[_]);const x=Object(r.useCallback)(async e=>{e.preventDefault(),l(!0);try{await i()}catch(e){la.a.error(e),l(!1)}},[i,l]);return s.a.createElement("div",{className:"mx_CallView_lobby"},o,s.a.createElement("div",{className:"mx_CallView_preview"},s.a.createElement(ma.a,{key:d.userId,member:d,width:200,height:200,resizeMethod:"scale"}),s.a.createElement("video",{ref:u,style:{visibility:f?"hidden":void 0},muted:!0,playsInline:!0,disablePictureInPicture:!0}),s.a.createElement("div",{className:"mx_CallView_controls"},s.a.createElement(Nd,{kind:"audio",devices:w,setDevice:O,deviceListLabel:Object(N.a)("Audio devices"),muted:g,disabled:c,toggle:y,unmutedTitle:Object(N.a)("Mute microphone"),mutedTitle:Object(N.a)("Unmute microphone")}),s.a.createElement(Nd,{kind:"video",devices:S,setDevice:C,deviceListLabel:Object(N.a)("Video devices"),muted:f,disabled:c,toggle:E,unmutedTitle:Object(N.a)("Turn off camera"),mutedTitle:Object(N.a)("Turn on camera")}))),s.a.createElement(q.a,{className:"mx_CallView_connectButton",kind:"primary",disabled:c||a,onClick:x,label:Object(N.a)("Join"),tooltip:c?Object(N.a)("Connecting"):n,alignment:xa.a.Bottom}))},Pd=e=>{let{room:t,resizing:a,call:n,setStartingCall:i}=e;const o=Object(r.useContext)(R.a),c=Object(r.useRef)();void 0===c.current&&(c.current=Object($a.l)());const l=c.current,[d,u]=Object(r.useState)(()=>null!==n&&Object(_d.g)(n.connectionState));Object(r.useEffect)(()=>{if(null!==n){const e=e=>u(Object(_d.g)(e));return n.on(_d.b.ConnectionState,e),()=>{n.off(_d.b.ConnectionState,e)}}},[n]);const m=Object(r.useCallback)(async()=>{i(!0),await _d.d.create(t),await l.promise},[t,i,l]);return Object(r.useEffect)(()=>{(async()=>{if(null!==n)try{await Promise.all([...si.a.instance.activeCalls].map(e=>e.disconnect())),await n.connect(),l.resolve()}catch(e){l.reject(e)}})()},[n,l]),s.a.createElement("div",{className:"mx_CallView"},d?null:s.a.createElement(Dd,{room:t,connect:m}),null!==n&&s.a.createElement($n,{app:n.widget,room:t,userId:o.credentials.userId,creatorUserId:n.widget.creatorUserId,waitForIframeLoad:n.widget.waitForIframeLoad,showMenubar:!1,pointerEvents:a?"none":void 0}))},Md=e=>{let{room:t,resizing:a,call:n}=e;const i=Object(r.useContext)(R.a),o=Object(_d.g)(Object(yd.b)(n)),c=Object(yd.f)(n),l=Object(yd.d)(n),d=Object(yd.c)(n),u=Object(r.useCallback)(async()=>{await Promise.all([...si.a.instance.activeCalls].map(e=>e.disconnect())),await n.connect()},[n]);Object(r.useEffect)(()=>{n.clean()},[n]);let m=null;if(!o){let e=null;if(c.size){const t=[...c].slice(0,8),a=c.size>t.length;e=s.a.createElement("div",{className:"mx_CallView_participants"},Object(N.a)("%(count)s people joined",{count:c.size}),s.a.createElement(Cl.a,{members:t,faceSize:24,overflow:a}))}m=s.a.createElement(Dd,{room:t,connect:u,joinCallButtonTooltip:null!=l?l:void 0,joinCallButtonDisabled:d},e)}return s.a.createElement("div",{className:"mx_CallView"},m,s.a.createElement($n,{app:n.widget,room:t,userId:i.credentials.userId,creatorUserId:n.widget.creatorUserId,waitForIframeLoad:n.widget.waitForIframeLoad,showMenubar:!1,pointerEvents:a?"none":void 0}))},Ad=e=>{let{room:t,resizing:a,waitForCall:n}=e;const i=Object(yd.a)(t.roomId),[o,c]=Object(r.useState)(!1);return null===i||o?n?null:s.a.createElement(Pd,{room:t,resizing:a,call:i,setStartingCall:c}):s.a.createElement(Md,{room:t,resizing:a,call:i})};var Ld=a(243),Ud=a(572),Fd=a(187),Bd=a(295);const Vd=(e,t)=>{const[a,n]=Object(r.useState)(()=>Array.isArray(t)?t:new Array(e).fill(t));return[a,(e,t)=>n(a=>{const n=[...a];return n[e]=t,n})]};var zd=a(350),Wd=a(730),Hd=a(849),Gd=a(808),qd=a(359),Kd=a(600),Yd=a(353);function Jd(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function $d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Jd(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Jd(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const Qd=e=>{var t;let{room:a,suggested:n,selected:i,hasPermissions:o,onToggleClick:c,onViewRoomClick:d,onJoinRoomClick:u,numChildRooms:m,children:h}=e;const p=Object(r.useContext)(R.a),[g,v]=Object(r.useState)(()=>{const e=p.getRoom(a.room_id);return"join"===(null==e?void 0:e.getMyMembership())?e:null}),f=Object(ne.d)(g,ee.d.Name,e=>null==e?void 0:e.name)||a.name||a.canonical_alias||(null===(t=a.aliases)||void 0===t?void 0:t[0])||(a.room_type===Z.i.Space?Object(N.a)("Unnamed Space"):Object(N.a)("Unnamed Room")),[b,y]=Object(qd.a)(!0),[E,_,w]=Object(Ce.i)(),[S,O]=Object(r.useState)(!1),C=e=>{e.preventDefault(),e.stopPropagation(),d()},x=async e=>{O(!0),e.preventDefault(),e.stopPropagation(),u().then(()=>Object(Yd.a)(p,a.room_id)).then(v).finally(()=>{O(!1)})};let k,j,I;k=S?s.a.createElement(q.a,{disabled:!0,onClick:x,kind:"primary_outline",onFocus:E,tabIndex:_?0:-1,title:Object(N.a)("Joining")},s.a.createElement(Ya.a,{w:24,h:24})):g?s.a.createElement(H.a,{onClick:C,kind:"primary_outline",onFocus:E,tabIndex:_?0:-1},Object(N.a)("View")):s.a.createElement(H.a,{onClick:x,kind:"primary",onFocus:E,tabIndex:_?0:-1},Object(N.a)("Join")),c&&(j=o?s.a.createElement(De.b,{checked:!!i,onChange:c,tabIndex:_?0:-1}):s.a.createElement(Ha.a,{tooltip:Object(N.a)("You don't have permission"),onClick:e=>{e.stopPropagation()}},s.a.createElement(De.b,{disabled:!0,tabIndex:_?0:-1}))),I=g?s.a.createElement(be.a,{room:g,width:20,height:20}):s.a.createElement(ht.a,{name:f,idName:a.room_id,url:a.avatar_url?Object(Gn.b)(a.avatar_url).getSquareThumbnailHttp(20):null,width:20,height:20});let T,D,P,M=Object(N.a)("%(count)s members",{count:a.num_joined_members});if(void 0!==m&&(M+=" · "+Object(N.a)("%(count)s rooms",{count:m})),g){const e=Object(_l.a)(g);T=Object(gl.i)(null==e?void 0:e.text,null==e?void 0:e.html)}else T=a.topic;g&&(D=s.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_joined"},Object(N.a)("Joined"))),!n||g&&!o||(P=s.a.createElement(Gd.b,{tooltip:Object(N.a)("This room is suggested as a good one to join")},Object(N.a)("Suggested")));const A=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_item"},s.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_avatar"},I),s.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_name"},f,D,P),s.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_info",ref:e=>e&&Object(gl.g)(e),onClick:e=>{"A"===e.target.tagName&&e.stopPropagation()}},M,T&&" · ",T)),s.a.createElement("div",{className:"mx_SpaceHierarchy_actions"},k,j));let L,U,F;if(h){if(L=s.a.createElement("div",{className:l()("mx_SpaceHierarchy_subspace_toggle",{mx_SpaceHierarchy_subspace_toggle_shown:b}),onClick:e=>{e.stopPropagation(),y()}}),b){const e=e=>{var t;switch(Object(J.a)().getAccessibilityAction(e)){case V.h.ArrowLeft:e.preventDefault(),e.stopPropagation(),null===(t=w.current)||void 0===t||t.focus()}};U=s.a.createElement("div",{className:"mx_SpaceHierarchy_subspace_children",onKeyDown:e,role:"group"},h)}F=e=>{let t=!1;switch(Object(J.a)().getAccessibilityAction(e)){case V.h.ArrowLeft:b&&(t=!0,y());break;case V.h.ArrowRight:if(t=!0,b){var a,n;const e=null===(a=w.current)||void 0===a?void 0:a.nextElementSibling;null==e||null===(n=e.querySelector(".mx_SpaceHierarchy_roomTile"))||void 0===n||n.focus()}else y()}t&&(e.preventDefault(),e.stopPropagation())}}return s.a.createElement("li",{className:"mx_SpaceHierarchy_roomTileWrapper",role:"treeitem","aria-expanded":h?b:void 0},s.a.createElement(H.a,{className:l()("mx_SpaceHierarchy_roomTile",{mx_SpaceHierarchy_subspace:a.room_type===Z.i.Space,mx_SpaceHierarchy_joining:S}),onClick:o&&c?c:C,onKeyDown:F,inputRef:w,onFocus:E,tabIndex:_?0:-1},A,L),U)},Xd=(e,t,a,n)=>{const i=t.roomMap.get(a);if(e.isGuest()&&!i.world_readable&&!i.guest_can_join)return void v.a.dispatch({action:"require_registration"});const r=Object(Kd.b)(i)||void 0;v.a.dispatch({action:L.a.ViewRoom,should_peek:!0,room_alias:r,room_id:i.room_id,via_servers:Array.from(t.viaMap.get(a)||[]),oob_data:{avatarUrl:i.avatar_url,name:i.name||r||Object(N.a)("Unnamed room"),roomType:n},metricsTrigger:"RoomDirectory"})},Zd=e=>{let{root:t,roomSet:a,hierarchy:n,parents:i,selectedMap:o,onViewRoomClick:c,onJoinRoomClick:l,onToggleClick:d}=e;const u=Object(r.useContext)(R.a),m=u.getRoom(t.room_id),h=null==m?void 0:m.currentState.maySendStateEvent(Z.b.SpaceChild,u.getUserId()),p=Object(k.sortBy)(t.children_state,e=>Object(K.b)(e.content.order,e.origin_server_ts,e.state_key)),[g,v]=p.reduce((e,t)=>{const i=n.roomMap.get(t.state_key);return i&&a.has(i)&&e[i.room_type===Z.i.Space?0:1].push(((e,t)=>{const a=e.getRoomUpgradeHistory(t.room_id,!0),n=a[a.length-1];var i,r,s;return n?$d($d({},t),{},{room_id:n.roomId,room_type:n.getType(),name:n.name,topic:null===(i=n.currentState.getStateEvents(Z.b.RoomTopic,""))||void 0===i?void 0:i.getContent().topic,avatar_url:n.getMxcAvatarUrl(),canonical_alias:n.getCanonicalAlias(),aliases:n.getAltAliases(),world_readable:(null===(r=n.currentState.getStateEvents(Z.b.RoomHistoryVisibility,""))||void 0===r?void 0:r.getContent().history_visibility)===_i.b.WorldReadable,guest_can_join:(null===(s=n.currentState.getStateEvents(Z.b.RoomGuestAccess,""))||void 0===s?void 0:s.getContent().guest_access)===_i.a.CanJoin,num_joined_members:n.getJoinedMemberCount()}):t})(u,i)),e},[[],[]]),f=new Set(i).add(t.room_id);return s.a.createElement(s.a.Fragment,null,Object(k.uniqBy)(v,"room_id").map(e=>{var a;return s.a.createElement(Qd,{key:e.room_id,room:e,suggested:n.isSuggested(t.room_id,e.room_id),selected:null==o||null===(a=o.get(t.room_id))||void 0===a?void 0:a.has(e.room_id),onViewRoomClick:()=>c(e.room_id,e.room_type),onJoinRoomClick:()=>l(e.room_id),hasPermissions:h,onToggleClick:d?()=>d(t.room_id,e.room_id):void 0})}),g.filter(e=>!f.has(e.room_id)).map(e=>{var i;return s.a.createElement(Qd,{key:e.room_id,room:e,numChildRooms:e.children_state.filter(e=>{const t=n.roomMap.get(e.state_key);return t&&a.has(t)&&!t.room_type}).length,suggested:n.isSuggested(t.room_id,e.room_id),selected:null==o||null===(i=o.get(t.room_id))||void 0===i?void 0:i.has(e.room_id),onViewRoomClick:()=>c(e.room_id,Z.i.Space),onJoinRoomClick:()=>l(e.room_id),hasPermissions:h,onToggleClick:d?()=>d(t.room_id,e.room_id):void 0},s.a.createElement(Zd,{root:e,roomSet:a,hierarchy:n,parents:f,selectedMap:o,onViewRoomClick:c,onJoinRoomClick:l,onToggleClick:d}))}))},eu=e=>{let{hierarchy:t,selected:a,setSelected:n,setError:i}=e;const o=Object(r.useContext)(R.a),[c,l]=Object(r.useState)(!1),[d,u]=Object(r.useState)(!1),m=Array.from(a.keys()).flatMap(e=>[...a.get(e).values()].map(t=>[e,t])),h=m.every(e=>{let[a,n]=e;return t.isSuggested(a,n)}),p=!m.length||c||d;let g=H.a,v={};return m.length||(g=q.a,v={tooltip:Object(N.a)("Select a room below first"),alignment:xa.a.Top}),s.a.createElement(s.a.Fragment,null,s.a.createElement(g,X()({},v,{onClick:async()=>{l(!0);try{const e=o.getUserId();for(const[a,n]of m){await o.sendStateEvent(a,Z.b.SpaceChild,{},n);const i=o.getRoom(n),r=null==i?void 0:i.currentState.getStateEvents(Z.b.SpaceParent,a);null!=i&&i.currentState.maySendStateEvent(Z.b.SpaceParent,e)&&Array.isArray(null==r?void 0:r.getContent().via)&&await o.sendStateEvent(n,Z.b.SpaceParent,{},a),t.removeRelation(a,n)}}catch(e){i(Object(N.a)("Failed to remove some rooms. Try again later"))}l(!1),n(new Map)},kind:"danger_outline",disabled:p}),c?Object(N.a)("Removing..."):Object(N.a)("Remove")),s.a.createElement(g,X()({},v,{onClick:async()=>{u(!0);try{for(const[a,n]of m){var e;const i=!h,r=null===(e=t.getRelation(a,n))||void 0===e?void 0:e.content;if(!r||r.suggested===i)continue;const s=$d($d({},r),{},{suggested:!h});await o.sendStateEvent(a,Z.b.SpaceChild,s,n),r.suggested=s.suggested}}catch(e){i("Failed to update some suggestions. Try again later")}u(!1),n(new Map)},kind:"primary_outline",disabled:p}),d?Object(N.a)("Saving..."):h?Object(N.a)("Mark as not suggested"):Object(N.a)("Mark as suggested")))};var tu,au=e=>{let{space:t,initialText:a="",showRoom:n,additionalButtons:i}=e;const o=Object(r.useContext)(R.a),[c,l]=Object(r.useState)(a),[d,u]=Object(r.useState)(new Map),{loading:m,rooms:h,hierarchy:p,loadMore:g,error:f}=(e=>{const[t,a]=Object(r.useState)([]),[n,i]=Object(r.useState)(),[s,o]=Object(r.useState)(),c=Object(r.useCallback)(()=>{o(void 0);const t=new Hd.a(e,20);t.load().then(()=>{e===t.root&&a(t.rooms)},o),i(t)},[e]);Object(r.useEffect)(c,[c]),Object(ae.a)(v.a,e=>{e.action===L.a.UpdateSpaceHierarchy&&(a([]),c())});const l=Object(r.useCallback)(async e=>{n.loading||!n.canLoadMore||n.noSupport||s||(await n.load(e).catch(o),a(n.rooms))},[s,n]);return(null==n?void 0:n.root)!==e?{loading:!0,loadMore:l}:{loading:n.loading,rooms:t,hierarchy:n,loadMore:l,error:s}})(t),b=Object(r.useMemo)(()=>{if(null==h||!h.length||!p)return new Set;const e=c.toLowerCase().trim();if(!e)return new Set(h);const t=h.filter(t=>{var a,n;return(null===(a=t.name)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(n=t.topic)||void 0===n?void 0:n.toLowerCase().includes(e))}),a=new Set,n=[...t.map(e=>e.room_id)];for(;n.length;){var i;const e=n.pop();a.add(e),null===(i=p.backRefs.get(e))||void 0===i||i.forEach(e=>{a.has(e)||n.push(e)})}return new Set(h.filter(e=>a.has(e.room_id)))},[h,p,c]),[y,E]=Object(r.useState)("");let _=y;!y&&f&&(_=Object(N.a)("Failed to load list of rooms."));const w=(e=>{const t=t=>{t[0].isIntersecting&&e()},a=Object(r.useRef)();return e=>{a.current?a.current.disconnect():e&&(a.current=new IntersectionObserver(t,{root:e.parentElement,rootMargin:"0px 0px 600px 0px"})),a.current&&e&&a.current.observe(e)}})(g);if(!m&&p.noSupport)return s.a.createElement("p",null,Object(N.a)("Your server does not support showing space hierarchies."));const S=(e,t)=>{if(E(""),!d.has(e))return void u(new Map(d.set(e,new Set([t]))));const a=d.get(e);a.has(t)?(a.delete(t),u(new Map(d.set(e,new Set(a))))):u(new Map(d.set(e,new Set([...a,t]))))};return s.a.createElement(Ce.d,{onKeyDown:(e,t)=>{var a,n;Object(J.a)().getAccessibilityAction(e)===V.h.ArrowDown&&e.currentTarget.classList.contains("mx_SpaceHierarchy_search")&&(null===(a=t.refs[0])||void 0===a||null===(n=a.current)||void 0===n||n.focus())},handleHomeEnd:!0,handleUpDown:!0},e=>{let r,{onKeyDownHandler:g}=e;if(p&&(!m||null!=h&&h.length)){const e="join"===(null==t?void 0:t.getMyMembership())&&t.currentState.maySendStateEvent(Z.b.SpaceChild,o.getUserId());let a,l;b.size?a=s.a.createElement(s.a.Fragment,null,s.a.createElement(Zd,{root:p.roomMap.get(t.roomId),roomSet:b,hierarchy:p,parents:new Set,selectedMap:d,onToggleClick:e?S:void 0,onViewRoomClick:(e,t)=>n(o,p,e,t),onJoinRoomClick:e=>((e,t,a)=>{if(e.isGuest())return void v.a.dispatch({action:"require_registration"});const n=e.joinRoom(a,{viaServers:Array.from(t.viaMap.get(a)||[])});return n.then(()=>{v.a.dispatch({action:L.a.JoinRoomReady,roomId:a,metricsTrigger:"SpaceHierarchy"})},e=>{it.b.instance.roomViewStore.showJoinRoomError(e,a)}),n})(o,p,e)})):p.canLoadMore||(a=s.a.createElement("div",{className:"mx_SpaceHierarchy_noResults"},s.a.createElement("h3",null,Object(N.a)("No results found")),s.a.createElement("div",null,Object(N.a)("You may want to try a different search or check for typos.")))),p.canLoadMore&&(l=s.a.createElement("div",{ref:w},s.a.createElement(Ya.a,null))),r=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SpaceHierarchy_listHeader"},s.a.createElement("h4",{className:"mx_SpaceHierarchy_listHeader_header"},c.trim()?Object(N.a)("Results"):Object(N.a)("Rooms and spaces")),s.a.createElement("div",{className:"mx_SpaceHierarchy_listHeader_buttons"},i,e&&s.a.createElement(eu,{hierarchy:p,selected:d,setSelected:u,setError:E}))),_&&s.a.createElement("div",{className:"mx_SpaceHierarchy_error"},_),s.a.createElement("ul",{className:"mx_SpaceHierarchy_list",onKeyDown:g,role:"tree","aria-label":Object(N.a)("Space")},a),l)}else r=s.a.createElement(Ya.a,null);return s.a.createElement(s.a.Fragment,null,s.a.createElement(qr.a,{className:"mx_SpaceHierarchy_search mx_textinput_icon mx_textinput_search",placeholder:Object(N.a)("Search names and descriptions"),onSearch:l,autoFocus:!0,initialValue:a,onKeyDown:g}),r)})};!function(e){e[e.Landing=0]="Landing",e[e.PublicCreateRooms=1]="PublicCreateRooms",e[e.PublicShare=2]="PublicShare",e[e.PrivateScope=3]="PrivateScope",e[e.PrivateInvite=4]="PrivateInvite",e[e.PrivateCreateRooms=5]="PrivateCreateRooms",e[e.PrivateExistingRooms=6]="PrivateExistingRooms"}(tu||(tu={}));const nu=e=>{let{space:t}=e;const[a,n,i,r]=Object(ce.p)(),o=Object(te.a)(se.a.CreateRooms),c=Object(te.a)(se.a.CreateSpaces),l=Object(ie.a)("feature_video_rooms"),d=Object(ie.a)("feature_element_call_video_rooms");let u=null;if(a){const e=n.current.getBoundingClientRect();u=s.a.createElement(de.e,{left:e.left+window.scrollX+0,top:e.bottom+window.scrollY+8,chevronFace:ce.a.None,onFinished:r,className:"mx_RoomTile_contextMenu",compact:!0},s.a.createElement(de.c,{first:!0},o&&s.a.createElement(s.a.Fragment,null,s.a.createElement(de.b,{label:Object(N.a)("New room"),iconClassName:"mx_RoomList_iconNewRoom",onClick:async e=>{e.preventDefault(),e.stopPropagation(),r(),re.b.trackInteraction("WebSpaceHomeCreateRoomButton",e),await Object(oe.g)(t)&&v.a.fire(L.a.UpdateSpaceHierarchy)}}),l&&s.a.createElement(de.b,{label:Object(N.a)("New video room"),iconClassName:"mx_RoomList_iconNewVideoRoom",onClick:async e=>{e.preventDefault(),e.stopPropagation(),r(),await Object(oe.g)(t,d?Z.i.UnstableCall:Z.i.ElementVideo)&&v.a.fire(L.a.UpdateSpaceHierarchy)}},s.a.createElement(le.a,null))),s.a.createElement(de.b,{label:Object(N.a)("Add existing room"),iconClassName:"mx_RoomList_iconAddExistingRoom",onClick:e=>{e.preventDefault(),e.stopPropagation(),r(),Object(oe.e)(t)}}),c&&s.a.createElement(de.b,{label:Object(N.a)("Add space"),iconClassName:"mx_RoomList_iconPlus",onClick:e=>{e.preventDefault(),e.stopPropagation(),r(),Object(oe.h)(t)}},s.a.createElement(le.a,null))))}return s.a.createElement(s.a.Fragment,null,s.a.createElement(ce.b,{kind:"primary",inputRef:n,onClick:i,isExpanded:a,label:Object(N.a)("Add")},Object(N.a)("Add")),u)},iu=e=>{let{space:t}=e;const a=Object(r.useContext)(R.a),n=er(t),i=a.getUserId(),o=Object(r.useCallback)(()=>{var e;return Gi.a.instance.isOpenForRoom(t.roomId)&&(null===(e=Gi.a.instance.currentCardForRoom(t.roomId))||void 0===e?void 0:e.phase)===Hi.a.SpaceMemberList},[t.roomId]),c=Object(ne.b)(Gi.a.instance,mt.b,o);let l;Object(oe.c)(t)&&Object(te.a)(se.a.InviteUsers)&&(l=s.a.createElement(H.a,{kind:"primary",className:"mx_SpaceRoomView_landing_inviteButton",onClick:()=>{Object(oe.i)(t)}},Object(N.a)("Invite")));let d,u;"join"===n&&t.currentState.maySendStateEvent(Z.b.SpaceChild,i)&&(d=s.a.createElement(nu,{space:t})),Object(oe.d)(t)&&(u=s.a.createElement(q.a,{className:"mx_SpaceRoomView_landing_settingsButton",onClick:()=>{Object(oe.k)(t)},title:Object(N.a)("Settings")}));return s.a.createElement("div",{className:"mx_SpaceRoomView_landing"},s.a.createElement("div",{className:"mx_SpaceRoomView_landing_header"},s.a.createElement(be.a,{room:t,height:80,width:80,viewAvatarOnClick:!0}),s.a.createElement(fe.b,null)),s.a.createElement("div",{className:"mx_SpaceRoomView_landing_name"},s.a.createElement(yr.a,{room:t},e=>{const t={name:()=>s.a.createElement("h1",null,e)};return Object(N.a)("Welcome to <name/>",{},t)})),s.a.createElement("div",{className:"mx_SpaceRoomView_landing_infoBar"},s.a.createElement(Il,{room:t}),s.a.createElement("div",{className:"mx_SpaceRoomView_landing_infoBar_interactive"},s.a.createElement(Rl,{room:t,onlyKnownUsers:!1,numShown:7,onClick:c?void 0:()=>{Gi.a.instance.setCard({phase:Hi.a.SpaceMemberList})}}),l,u)),s.a.createElement(Ol,{room:t,className:"mx_SpaceRoomView_landing_topic"}),s.a.createElement(au,{space:t,showRoom:Xd,additionalButtons:d}))},ru=e=>{let{space:t,title:a,description:n,onFinished:i}=e;const[o,c]=Object(r.useState)(!1),[l,d]=Object(r.useState)(""),u=[Object(N.a)("General"),Object(N.a)("Random"),Object(N.a)("Support")],[m,h]=Vd(3,[Object(N.a)("General"),Object(N.a)("Random"),""]),p=new Array(3).fill(0).map((e,t)=>{const a="roomName"+t;return s.a.createElement(Sa.a,{key:a,name:a,type:"text",label:Object(N.a)("Room name"),placeholder:u[t],value:m[t],onChange:e=>h(t,e.target.value),autoFocus:2===t,disabled:o,autoComplete:"off"})}),g=async e=>{if(e.preventDefault(),!o){d(""),c(!0);try{const e=t.getJoinRule()===_i.c.Public,a=m.map(e=>e.trim()).filter(Boolean),n=await Promise.all(a.map(a=>Object(Fd.b)({createOpts:{preset:e?_i.d.PublicChat:_i.d.PrivateChat,name:a},spinner:!1,encryption:!1,andView:!1,inlineErrors:!0,parentSpace:t,joinRule:e?void 0:_i.c.Restricted,suggested:!0})));i(n[0])}catch(e){la.a.error("Failed to create initial space rooms",e),d(Object(N.a)("Failed to create initial space rooms"))}c(!1)}};let v=e=>{e.preventDefault(),i()},f=Object(N.a)("Skip for now");return m.some(e=>e.trim())&&(v=g,f=o?Object(N.a)("Creating rooms..."):Object(N.a)("Continue")),s.a.createElement("div",null,s.a.createElement("h1",null,a),s.a.createElement("div",{className:"mx_SpaceRoomView_description"},n),l&&s.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},l),s.a.createElement("form",{onSubmit:v,id:"mx_SpaceSetupFirstRooms"},p),s.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},s.a.createElement(H.a,{kind:"primary",disabled:o,onClick:v,element:"input",type:"submit",form:"mx_SpaceSetupFirstRooms",value:f})))},su=e=>{let{space:t,onFinished:a}=e;return s.a.createElement("div",null,s.a.createElement("h1",null,Object(N.a)("What do you want to organise?")),s.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.a)("Pick rooms or conversations to add. This is just a space for you, no one will be informed. You can add more later.")),s.a.createElement(zd.a,{space:t,emptySelectionButton:s.a.createElement(H.a,{kind:"primary",onClick:a},Object(N.a)("Skip for now")),filterPlaceholder:Object(N.a)("Search for rooms or spaces"),onFinished:a,roomsRenderer:zd.f,dmsRenderer:zd.e}))},ou=e=>{var t;let{justCreatedOpts:a,space:n,onFinished:i,firstRoomId:r}=e;return s.a.createElement("div",{className:"mx_SpaceRoomView_publicShare"},s.a.createElement("h1",null,Object(N.a)("Share %(name)s",{name:(null==a||null===(t=a.createOpts)||void 0===t?void 0:t.name)||n.name})),s.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.a)("It's just you at the moment, it will be even better with others.")),s.a.createElement(Wd.a,{space:n}),s.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},s.a.createElement(H.a,{kind:"primary",onClick:i},r?Object(N.a)("Go to my first room"):Object(N.a)("Go to my space"))))},cu=e=>{var t;let{space:a,justCreatedOpts:n,onFinished:i}=e;return s.a.createElement("div",{className:"mx_SpaceRoomView_privateScope"},s.a.createElement("h1",null,Object(N.a)("Who are you working with?")),s.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.a)("Make sure the right people have access to %(name)s",{name:(null==n||null===(t=n.createOpts)||void 0===t?void 0:t.name)||a.name})),s.a.createElement(H.a,{className:"mx_SpaceRoomView_privateScope_justMeButton",onClick:()=>{i(!1)}},s.a.createElement("h3",null,Object(N.a)("Just me")),s.a.createElement("div",null,Object(N.a)("A private space to organise your rooms"))),s.a.createElement(H.a,{className:"mx_SpaceRoomView_privateScope_meAndMyTeammatesButton",onClick:()=>{i(!0)}},s.a.createElement("h3",null,Object(N.a)("Me and my teammates")),s.a.createElement("div",null,Object(N.a)("A private space for you and your teammates"))))},lu=Object(wr.a)({rules:[{key:"email",test:e=>{let{value:t}=e;return!t||Bd.a(t)},invalid:()=>Object(N.a)("Doesn't look like a valid email address")}]}),du=e=>{let{space:t,onFinished:a}=e;const[n,i]=Object(r.useState)(!1),[o,c]=Object(r.useState)(""),l=[Object(r.useRef)(),Object(r.useRef)(),Object(r.useRef)()],[d,u]=Vd(3,""),m=new Array(3).fill(0).map((e,t)=>{const a="emailAddress"+t;return s.a.createElement(Sa.a,{key:a,name:a,type:"text",label:Object(N.a)("Email address"),placeholder:Object(N.a)("Email"),value:d[t],onChange:e=>u(t,e.target.value),ref:l[t],onValidate:lu,autoFocus:0===t,disabled:n})}),h=async e=>{if(e.preventDefault(),n)return;c("");for(let e=0;e<l.length;e++){const t=l[e];if(!1===await t.current.validate({allowEmpty:!0}))return t.current.focus(),void t.current.validate({allowEmpty:!0,focused:!0})}i(!0);const r=d.map(e=>e.trim()).filter(Boolean);try{const e=await Object(Hr.a)(t.roomId,r),n=Object.keys(e.states).filter(t=>"error"===e.states[t]);n.length>0?(la.a.log("Failed to invite users to space: ",e),c(Object(N.a)("Failed to invite the following users to your space: %(csvUsers)s",{csvUsers:n.join(", ")}))):a()}catch(e){la.a.error("Failed to invite users to space: ",e),c(Object(N.a)("We couldn't invite those users. Please check the users you want to invite and try again."))}i(!1)};let p=e=>{e.preventDefault(),a()},g=Object(N.a)("Skip for now");return d.some(e=>e.trim())&&(p=h,g=n?Object(N.a)("Inviting..."):Object(N.a)("Continue")),s.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates"},s.a.createElement("h1",null,Object(N.a)("Invite your teammates")),s.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.a)("Make sure the right people have access. You can invite more later.")),s.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates_betaDisclaimer"},Object(N.a)("<b>This is an experimental feature.</b> For now, new users receiving an invite will have to open the invite on <link/> to actually join.",{},{b:e=>s.a.createElement("b",null,e),link:()=>s.a.createElement("a",{href:"https://app.element.io/",rel:"noreferrer noopener",target:"_blank"},"app.element.io")})),o&&s.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},o),s.a.createElement("form",{onSubmit:p,id:"mx_SpaceSetupPrivateInvite"},m),s.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates_buttons"},s.a.createElement(H.a,{className:"mx_SpaceRoomView_inviteTeammates_inviteDialogButton",onClick:()=>Object(Hr.e)(t.roomId)},Object(N.a)("Invite by username"))),s.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},s.a.createElement(H.a,{kind:"primary",disabled:n,onClick:p,element:"input",type:"submit",form:"mx_SpaceSetupPrivateInvite",value:g})))};class uu extends s.a.PureComponent{constructor(e,t){var a;super(e,t),i()(this,"context",void 0),i()(this,"creator",void 0),i()(this,"dispatcherRef",void 0),i()(this,"onMyMembership",(e,t)=>{e.roomId===this.props.space.roomId&&this.setState({myMembership:t})}),i()(this,"onRightPanelStoreUpdate",()=>{this.setState({showRightPanel:Gi.a.instance.isOpenForRoom(this.props.space.roomId)})}),i()(this,"onAction",e=>{if(e.action!==L.a.ViewRoom||e.room_id!==this.props.space.roomId){if(e.action===L.a.ViewUser||"view_3pid_invite"===e.action)if(e.action===L.a.ViewUser&&e.member){const t={phase:Hi.a.SpaceMemberInfo,state:{spaceId:this.props.space.roomId,member:e.member}};e.push?Gi.a.instance.pushCard(t):Gi.a.instance.setCards([{phase:Hi.a.SpaceMemberList,state:{spaceId:this.props.space.roomId}},t])}else"view_3pid_invite"===e.action&&e.event?Gi.a.instance.setCard({phase:Hi.a.Space3pidMemberInfo,state:{spaceId:this.props.space.roomId,memberInfoEvent:e.event}}):Gi.a.instance.setCard({phase:Hi.a.SpaceMemberList,state:{spaceId:this.props.space.roomId}})}else this.setState({phase:tu.Landing})}),i()(this,"goToFirstRoom",async()=>{this.state.firstRoomId?v.a.dispatch({action:L.a.ViewRoom,room_id:this.state.firstRoomId,metricsTrigger:void 0}):this.setState({phase:tu.Landing})});let n=tu.Landing;this.creator=null===(a=this.props.space.currentState.getStateEvents(Z.b.RoomCreate,""))||void 0===a?void 0:a.getSender();this.props.justCreatedOpts&&t.getUserId()===this.creator&&(n=this.props.justCreatedOpts.createOpts.preset===_i.d.PublicChat?tu.PublicCreateRooms:tu.PrivateScope),this.state={phase:n,showRightPanel:Gi.a.instance.isOpenForRoom(this.props.space.roomId),myMembership:this.props.space.getMyMembership()},this.dispatcherRef=v.a.register(this.onAction),Gi.a.instance.on(mt.b,this.onRightPanelStoreUpdate)}componentDidMount(){this.context.on(ee.d.MyMembership,this.onMyMembership)}componentWillUnmount(){v.a.unregister(this.dispatcherRef),Gi.a.instance.off(mt.b,this.onRightPanelStoreUpdate),this.context.off(ee.d.MyMembership,this.onMyMembership)}renderBody(){var e,t;switch(this.state.phase){case tu.Landing:return"join"===this.state.myMembership?s.a.createElement(iu,{space:this.props.space}):s.a.createElement(Tl,{room:this.props.space,onJoinButtonClicked:this.props.onJoinButtonClicked,onRejectButtonClicked:this.props.onRejectButtonClicked});case tu.PublicCreateRooms:return s.a.createElement(ru,{space:this.props.space,title:Object(N.a)("What are some things you want to discuss in %(spaceName)s?",{spaceName:(null===(e=this.props.justCreatedOpts)||void 0===e||null===(t=e.createOpts)||void 0===t?void 0:t.name)||this.props.space.name}),description:s.a.createElement(s.a.Fragment,null,Object(N.a)("Let's create a room for each of them."),s.a.createElement("br",null),Object(N.a)("You can add more later too, including already existing ones.")),onFinished:e=>this.setState({phase:tu.PublicShare,firstRoomId:e})});case tu.PublicShare:return s.a.createElement(ou,{justCreatedOpts:this.props.justCreatedOpts,space:this.props.space,onFinished:this.goToFirstRoom,firstRoomId:this.state.firstRoomId});case tu.PrivateScope:return s.a.createElement(cu,{space:this.props.space,justCreatedOpts:this.props.justCreatedOpts,onFinished:e=>{this.setState({phase:e?tu.PrivateCreateRooms:tu.PrivateExistingRooms})}});case tu.PrivateInvite:return s.a.createElement(du,{space:this.props.space,onFinished:()=>this.setState({phase:tu.Landing})});case tu.PrivateCreateRooms:return s.a.createElement(ru,{space:this.props.space,title:Object(N.a)("What projects are your team working on?"),description:s.a.createElement(s.a.Fragment,null,Object(N.a)("We'll create rooms for each of them."),s.a.createElement("br",null),Object(N.a)("You can add more later too, including already existing ones.")),onFinished:e=>this.setState({phase:tu.PrivateInvite,firstRoomId:e})});case tu.PrivateExistingRooms:return s.a.createElement(su,{space:this.props.space,onFinished:()=>this.setState({phase:tu.Landing})})}}render(){const e=this.state.showRightPanel&&this.state.phase===tu.Landing?s.a.createElement(ol,{room:this.props.space,resizeNotifier:this.props.resizeNotifier}):null;return s.a.createElement("main",{className:"mx_SpaceRoomView"},s.a.createElement(ml.a,null,s.a.createElement(zi,{panel:e,resizeNotifier:this.props.resizeNotifier},this.renderBody())))}}i()(uu,"contextType",R.a);var mu=a(455),hu=a(365);class pu extends s.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"callEventGroupers",new Map),this.buildLegacyCallEventGroupers(this.props.searchResult.context.getTimeline())}buildLegacyCallEventGroupers(e){this.callEventGroupers=Object(Vs.c)(this.callEventGroupers,e)}render(){const e=this.props.searchResult,t=e.context.getEvent(),a=t.getId(),n=t.getTs(),i=[s.a.createElement(mu.a,{key:n+"-search",roomId:t.getRoomId(),ts:n})],r=f.b.getValue("layout"),o=f.b.getValue("showTwelveHourTimestamps"),c=f.b.getValue("alwaysShowTimestamps"),l=f.b.getValue("feature_thread"),d=e.context.getTimeline();for(let t=0;t<d.length;t++){var u;const n=d[t];let p;const g=t!=e.context.getOurEventIndex();if(g||(p=this.props.searchHighlights),Object(Cr.c)(n,null===(u=this.context)||void 0===u?void 0:u.showHiddenEvents)){var m;const e=d[t-1],u=e&&!Object(lr.m)(e.getDate(),n.getDate())&&Object(Bs.b)(e,n,null===(m=this.context)||void 0===m?void 0:m.showHiddenEvents,l,Un.a.Search);let v=!0;const f=d[t+1];if(f){var h;v=Object(lr.m)(n.getDate(),f.getDate())||n.getSender()!==f.getSender()||!Object(Bs.b)(n,f,null===(h=this.context)||void 0===h?void 0:h.showHiddenEvents,l,Un.a.Search)}i.push(s.a.createElement(hu.a,{key:`${a}+${t}`,mxEvent:n,layout:r,contextual:g,highlights:p,permalinkCreator:this.props.permalinkCreator,highlightLink:this.props.resultLink,onHeightChanged:this.props.onHeightChanged,isTwelveHour:o,alwaysShowTimestamps:c,lastInSection:v,continuation:u,callEventGrouper:this.callEventGroupers.get(n.getContent().call_id)}))}}return s.a.createElement("li",{"data-scroll-tokens":a},s.a.createElement("ol",null,i))}}i()(pu,"contextType",Un.b);var gu=a(527);class vu extends s.a.PureComponent{render(){return s.a.createElement("div",{className:"mx_TopUnreadMessagesBar"},s.a.createElement(H.a,{className:"mx_TopUnreadMessagesBar_scrollUp",title:Object(N.a)("Jump to first unread message."),onClick:this.props.onScrollUpClick}),s.a.createElement(H.a,{className:"mx_TopUnreadMessagesBar_markAsRead",title:Object(N.a)("Mark all as read"),onClick:this.props.onCloseClick}))}}var fu=a(158),bu=a(299),yu=a(863),Eu=a(809),_u=a(722);const wu=e=>{let{text:t}=e;return s.a.createElement("div",{className:"mx_LargeLoader"},s.a.createElement(Ya.a,{w:45,h:45}),s.a.createElement("div",{className:"mx_LargeLoader_text"},t))},Su=["upgradeRecommendation"],Ou=["upgradeRecommendation"];function Cu(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function xu(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Cu(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cu(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}let ku=function(e){};const ju="sandbox"in document.createElement("iframe");var Ru;function Iu(e){const t=Object(r.useContext)(Un.b),a=t.room,n=t.room.currentState.getStateEvents(Z.b.RoomEncryption)[0];let i;n&&(i=s.a.createElement(Eu.a,{mxEvent:n}));const o=()=>{a.state=bu.c.NEW,v.b.dispatch({action:"local_room_event",roomId:a.roomId})};let c,l;if(a.isError){const e=s.a.createElement(H.a,{onClick:o,className:"mx_RoomStatusBar_unsentRetry"},Object(N.a)("Retry"));c=s.a.createElement(_u.a,{title:Object(N.a)("Some of your messages have not been sent"),notificationState:Se.a.RED_EXCLAMATION,buttons:e})}else l=s.a.createElement(Rc,{room:t.room,resizeNotifier:e.resizeNotifier,permalinkCreator:e.permalinkCreator});return s.a.createElement("div",{className:"mx_RoomView mx_RoomView--local"},s.a.createElement(ml.a,null,s.a.createElement(Id,{room:t.room,searchInfo:null,inRoom:!0,onSearchClick:null,onInviteClick:null,onForgetClick:null,e2eStatus:Xi.Normal,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),s.a.createElement("main",{className:"mx_RoomView_body",ref:e.roomView},s.a.createElement(Uc,{parent:e.roomView.current,onFileDrop:e.onFileDrop}),s.a.createElement("div",{className:"mx_RoomView_timeline"},s.a.createElement(ul.a,{className:"mx_RoomView_messagePanel",resizeNotifier:e.resizeNotifier},i,s.a.createElement(yu.a,null))),c,l)))}function Tu(e){const t=Object(r.useContext)(Un.b),a=Object(N.a)("We're creating a room with %(names)s",{names:e.names});return s.a.createElement("div",{className:"mx_RoomView mx_RoomView--local"},s.a.createElement(ml.a,null,s.a.createElement(Id,{room:t.room,searchInfo:null,inRoom:!0,onSearchClick:null,onInviteClick:null,onForgetClick:null,e2eStatus:Xi.Normal,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),s.a.createElement("div",{className:"mx_RoomView_body"},s.a.createElement(wu,{text:a}))))}(function(e){e[e.Timeline=0]="Timeline",e[e.MaximisedWidget=1]="MaximisedWidget",e[e.Call=2]="Call"})(Ru||(Ru={}));class Nu extends s.a.Component{constructor(e,t){var a,n;super(e,t),a=this,i()(this,"dispatcherRef",void 0),i()(this,"settingWatchers",void 0),i()(this,"unmounted",!1),i()(this,"permalinkCreators",{}),i()(this,"searchId",void 0),i()(this,"roomView",Object(r.createRef)()),i()(this,"searchResultsPanel",Object(r.createRef)()),i()(this,"messagePanel",void 0),i()(this,"roomViewBody",Object(r.createRef)()),i()(this,"context",void 0),i()(this,"onIsResizing",e=>{this.setState({resizing:e})}),i()(this,"onWidgetStoreUpdate",()=>{this.state.room&&this.checkWidgets(this.state.room)}),i()(this,"onWidgetEchoStoreUpdate",()=>{this.state.room&&this.checkWidgets(this.state.room)}),i()(this,"onWidgetLayoutChange",()=>{this.state.room&&(v.a.dispatch({action:"appsDrawer",show:!0}),this.context.widgetLayoutStore.hasMaximisedWidget(this.state.room)&&this.context.rightPanelStore.setCard({phase:Hi.a.Timeline}),this.checkWidgets(this.state.room))}),i()(this,"checkWidgets",e=>{this.setState({hasPinnedWidgets:this.context.widgetLayoutStore.hasPinnedWidgets(e),mainSplitContentType:this.getMainSplitContentType(e),showApps:this.shouldShowApps(e)})}),i()(this,"getMainSplitContentType",e=>f.b.getValue("feature_group_calls")&&this.context.roomViewStore.isViewingCall()||bd(e)?Ru.Call:this.context.widgetLayoutStore.hasMaximisedWidget(e)?Ru.MaximisedWidget:Ru.Timeline),i()(this,"onRoomViewStoreUpdate",async e=>{if(this.unmounted)return;if(!e&&this.state.roomId!==this.context.roomViewStore.getRoomId())return;const t=this.context.roomViewStore.getRoomId(),n=this.context.client.getRoom(t),i={roomId:t,roomAlias:this.context.roomViewStore.getRoomAlias(),roomLoading:this.context.roomViewStore.isRoomLoading(),roomLoadError:this.context.roomViewStore.getRoomLoadError(),joining:this.context.roomViewStore.isJoining(),replyToEvent:this.context.roomViewStore.getQuotingEvent(),shouldPeek:this.state.matrixClientIsReady&&this.context.roomViewStore.shouldPeek(),showReadReceipts:f.b.getValue("showReadReceipts",t),showRedactions:f.b.getValue("showRedactions",t),showJoinLeaves:f.b.getValue("showJoinLeaves",t),showAvatarChanges:f.b.getValue("showAvatarChanges",t),showDisplaynameChanges:f.b.getValue("showDisplaynameChanges",t),wasContextSwitch:this.context.roomViewStore.getWasContextSwitch(),mainSplitContentType:null===n?void 0:this.getMainSplitContentType(n),initialEventId:null,showRightPanel:this.context.rightPanelStore.isOpenForRoom(t),activeCall:si.a.instance.getActiveCall(t)};var r;this.state.mainSplitContentType!==Ru.Timeline&&i.mainSplitContentType===Ru.Timeline&&this.context.rightPanelStore.isOpen&&this.context.rightPanelStore.currentCard.phase===Hi.a.Timeline&&this.context.rightPanelStore.roomPhaseHistory.some(e=>e.phase===Hi.a.Timeline)&&(this.context.rightPanelStore.setCard({phase:Hi.a.RoomSummary}),this.context.rightPanelStore.togglePanel(null!==(r=this.state.roomId)&&void 0!==r?r:null),i.showRightPanel=!1);const s=this.context.roomViewStore.getInitialEventId();if(s){var o,c;let e=null==n?void 0:n.findEventById(s);e||(e=await Object(fu.f)(this.context.client,t,s)),i.initialEventPixelOffset=null;const a=null===(o=e)||void 0===o?void 0:o.getThread();var l;if(!a||null!==(c=e)&&void 0!==c&&c.isThreadRoot)i.initialEventId=s,i.isInitialEventHighlighted=this.context.roomViewStore.isInitialEventHighlighted(),i.initialEventScrollIntoView=this.context.roomViewStore.initialEventScrollIntoView(),a&&null!==(l=e)&&void 0!==l&&l.isThreadRoot&&v.a.dispatch({action:L.a.ShowThread,rootEvent:a.rootEvent,initialEvent:e,highlighted:this.context.roomViewStore.isInitialEventHighlighted(),scroll_into_view:this.context.roomViewStore.initialEventScrollIntoView()});else v.a.dispatch({action:L.a.ShowThread,rootEvent:a.rootEvent,initialEvent:e,highlighted:this.context.roomViewStore.isInitialEventHighlighted(),scroll_into_view:this.context.roomViewStore.initialEventScrollIntoView()})}if(this.settingWatchers=this.settingWatchers.concat([f.b.watchSetting("showReadReceipts",t,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({showReadReceipts:i})})),f.b.watchSetting("showRedactions",t,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({showRedactions:i})})),f.b.watchSetting("showJoinLeaves",t,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({showJoinLeaves:i})})),f.b.watchSetting("showAvatarChanges",t,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({showAvatarChanges:i})})),f.b.watchSetting("showDisplaynameChanges",t,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({showDisplaynameChanges:i})}))]),e||!this.state.shouldPeek||i.shouldPeek||this.context.client.stopPeeking(),la.a.log("RVS update:",i.roomId,i.roomAlias,"loading?",i.roomLoading,"joining?",i.joining,"initial?",e,"shouldPeek?",i.shouldPeek),e&&(i.room=this.context.client.getRoom(i.roomId),i.room&&(i.showApps=this.shouldShowApps(i.room),this.onRoomLoaded(i.room))),null===this.state.roomId&&null!==i.roomId&&!i.initialEventId){const e=ll.getScrollState(i.roomId);e&&(i.initialEventId=e.focussedEvent,i.initialEventPixelOffset=e.pixelOffset)}this.state.initialEventId!==i.initialEventId&&(i.searchResults=null),this.setState(i),e&&this.setupRoom(i.room,i.roomId,i.joining,i.shouldPeek)}),i()(this,"onActiveCalls",()=>{if(void 0===this.state.roomId)return;const e=si.a.instance.getActiveCall(this.state.roomId);null===e&&v.a.dispatch({action:L.a.ViewRoom,room_id:this.state.roomId,view_call:!1,metricsTrigger:void 0},!0),this.setState({activeCall:e})}),i()(this,"getRoomId",()=>this.state.room?this.state.room.roomId:this.state.roomId),i()(this,"onRightPanelStoreUpdate",()=>{this.setState({showRightPanel:this.context.rightPanelStore.isOpenForRoom(this.state.roomId)})}),i()(this,"onPageUnload",e=>Oi.a.sharedInstance().getCurrentUploads().length>0?e.returnValue=Object(N.a)("You seem to be uploading files, are you sure you want to quit?"):this.getCallForRoom()&&"ended"!==this.state.callState?e.returnValue=Object(N.a)("You seem to be in a call, are you sure you want to quit?"):void 0),i()(this,"onReactKeyDown",e=>{let t=!1;switch(Object(J.a)().getRoomAction(e)){case V.h.DismissReadMarker:this.messagePanel.forgetReadMarker(),this.jumpToLiveTimeline(),t=!0;break;case V.h.JumpToOldestUnread:this.jumpToReadMarker(),t=!0;break;case V.h.UploadFile:v.a.dispatch({action:"upload_file",context:Un.a.Room},!0),t=!0}t&&(e.stopPropagation(),e.preventDefault())}),i()(this,"onCallState",e=>{if(!e)return;const t=this.getCallForRoom();this.setState({callState:t?t.state:null})}),i()(this,"onAction",async e=>{var t;switch(e.action){case"message_sent":this.checkDesktopNotifications();break;case"post_sticker_message":this.injectSticker(e.data.content.url,e.data.content.info,e.data.description||e.data.name,e.data.threadId);break;case"picture_snapshot":Oi.a.sharedInstance().sendContentListToRoom([e.file],this.state.room.roomId,null,this.context.client);break;case"notifier_enabled":case L.a.UploadStarted:case L.a.UploadFinished:case L.a.UploadCanceled:this.forceUpdate();break;case"appsDrawer":this.setState({showApps:e.show});break;case"reply_to_event":!this.unmounted&&this.state.searchResults&&(null===(t=e.event)||void 0===t?void 0:t.getRoomId())===this.state.roomId&&e.context===Un.a.Search&&this.onCancelSearchClick();break;case"MatrixActions.sync":var a;if(!this.state.matrixClientIsReady)this.setState({matrixClientIsReady:null===(a=this.context.client)||void 0===a?void 0:a.isInitialSyncComplete()},()=>{this.onRoomViewStoreUpdate(!0)});break;case"focus_search":this.onSearchClick();break;case"local_room_event":this.onLocalRoomEvent(e.roomId);break;case L.a.EditEvent:{if(e.timelineRenderingType!==this.state.timelineRenderingType)return;const t=e.event?new Ic(e.event):null;this.setState({editState:t},()=>{var t;e.event&&(null===(t=this.messagePanel)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))});break}case L.a.ComposerInsert:{if(e.composerType)break;let t=e.timelineRenderingType;if(t===Un.a.Thread)break;this.state.timelineRenderingType===Un.a.Search&&e.timelineRenderingType===Un.a.Search&&(await this.onCancelSearchClick(),t=Un.a.Room),v.a.dispatch(xu(xu({},e),{},{timelineRenderingType:t,composerType:this.state.editState?Fc.a.Edit:Fc.a.Send}));break}case L.a.FocusAComposer:v.a.dispatch(xu(xu({},e),{},{action:this.state.editState?L.a.FocusEditMessageComposer:L.a.FocusSendMessageComposer}));break;case"scroll_to_bottom":var n;if(e.timelineRenderingType===Un.a.Room)null===(n=this.messagePanel)||void 0===n||n.jumpToLiveTimeline()}}),i()(this,"onRoomTimeline",(e,t,a,n,i)=>{var r;this.unmounted||t&&t.roomId===(null===(r=this.state.room)||void 0===r?void 0:r.roomId)&&i.timeline.getTimelineSet()===t.getUnfilteredTimelineSet()&&("org.matrix.room.preview_urls"===e.getType()&&this.updatePreviewUrlVisibility(t),"m.room.encryption"===e.getType()&&(this.updateE2EStatus(t),this.updatePreviewUrlVisibility(t)),!a&&i&&i.liveEvent&&(this.state.joining||(e.isBeingDecrypted()||e.isDecryptionFailure()||this.handleEffects(e),e.getSender()!==this.context.client.credentials.userId&&(!this.state.searchResults&&this.state.atEndOfLiveTimeline||Object(wi.a)(e,this.state)||this.setState((e,t)=>({numUnreadMessages:e.numUnreadMessages+1}))))))}),i()(this,"onEventDecrypted",e=>{this.state.room&&this.state.matrixClientIsReady&&e.getRoomId()===this.state.room.roomId&&(e.isDecryptionFailure()||this.handleEffects(e))}),i()(this,"handleEffects",e=>{this.context.roomNotificationStateStore.getRoomState(this.state.room).isUnread&&gn.CHAT_EFFECTS.forEach(t=>{(Object(vn.containsEmoji)(e.getContent(),t.emojis)||e.getContent().msgtype===t.msgType)&&(f.b.getValue("feature_thread")&&e.isRelation(an.d.name)||v.a.dispatch({action:"effects."+t.command}))})}),i()(this,"onRoomName",e=>{this.state.room&&e.roomId==this.state.room.roomId&&this.forceUpdate()}),i()(this,"onKeyBackupStatus",()=>{this.forceUpdate()}),i()(this,"canResetTimeline",()=>!this.messagePanel||this.messagePanel.canResetTimeline()),i()(this,"onRoomLoaded",e=>{this.unmounted||(this.context.widgetLayoutStore.on(Bn.d.emissionForRoom(e),this.onWidgetLayoutChange),this.calculatePeekRules(e),this.updatePreviewUrlVisibility(e),this.loadMembersIfJoined(e),this.calculateRecommendedVersion(e),this.updateE2EStatus(e),this.updatePermissions(e),this.checkWidgets(e),this.getMainSplitContentType(e)!==Ru.Timeline&&this.context.roomNotificationStateStore.getRoomState(e).isUnread&&this.context.rightPanelStore.setCard({phase:Hi.a.Timeline},!0,e.roomId),this.setState({tombstone:this.getRoomTombstone(e),liveTimeline:e.getLiveTimeline()}))}),i()(this,"onRoomTimelineReset",(e,t)=>{var a;e&&e.roomId===(null===(a=this.state.room)||void 0===a?void 0:a.roomId)&&(la.a.log(`Live timeline of ${e.roomId} was reset`),this.setState({liveTimeline:t.getLiveTimeline()}))}),i()(this,"onRoom",e=>{e&&e.roomId===this.state.roomId&&(this.state.room&&this.context.widgetLayoutStore.off(Bn.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.setState({room:e},()=>{this.onRoomLoaded(e)}))}),i()(this,"onDeviceVerificationChanged",e=>{const t=this.state.room;t.currentState.getMember(e)&&this.updateE2EStatus(t)}),i()(this,"onUserVerificationChanged",e=>{const t=this.state.room;t&&t.currentState.getMember(e)&&this.updateE2EStatus(t)}),i()(this,"onCrossSigningKeysChanged",()=>{const e=this.state.room;e&&this.updateE2EStatus(e)}),i()(this,"onUrlPreviewsEnabledChange",()=>{this.state.room&&this.updatePreviewUrlVisibility(this.state.room)}),i()(this,"onRoomStateEvents",(e,t)=>{if(this.state.room&&this.state.room.roomId===t.roomId)switch(e.getType()){case Z.b.RoomTombstone:this.setState({tombstone:this.getRoomTombstone()});break;default:this.updatePermissions(this.state.room)}}),i()(this,"onRoomStateUpdate",e=>{var t;e.roomId===(null===(t=this.state.room)||void 0===t?void 0:t.roomId)&&this.updateRoomMembers()}),i()(this,"onMyMembership",(e,t,a)=>{e.roomId===this.state.roomId&&(this.forceUpdate(),this.loadMembersIfJoined(e),this.updatePermissions(e))}),i()(this,"updateRoomMembers",Object(k.throttle)(()=>{this.updateDMState(),this.updateE2EStatus(this.state.room)},500,{leading:!0,trailing:!0})),i()(this,"onSearchResultsFillRequest",e=>{if(!e)return Promise.resolve(!1);if(this.state.searchResults.next_batch){ku("requesting more search results");const e=function(e){const t=ki.a.get(),a=st.a.get();return e.pendingRequest?e.pendingRequest:null===t?a.backPaginateRoomEventsSearch(e):Bi(e)}(this.state.searchResults);return this.handleSearchResult(e)}return ku("no more search results"),Promise.resolve(!1)}),i()(this,"onInviteClick",()=>{v.a.dispatch({action:"view_invite",roomId:this.state.room.roomId})}),i()(this,"onJoinButtonClicked",()=>{var e;null!==(e=this.context.client)&&void 0!==e&&e.isGuest()?(v.a.dispatch({action:L.a.DoAfterSyncPrepared,deferred_action:{action:L.a.ViewRoom,room_id:this.getRoomId(),metricsTrigger:void 0}}),v.a.dispatch({action:"require_registration"})):Promise.resolve().then(()=>{var e,t;const a=null===(e=this.props.threepidInvite)||void 0===e?void 0:e.signUrl;return v.a.dispatch({action:L.a.JoinRoom,roomId:this.getRoomId(),opts:{inviteSignUrl:a},metricsTrigger:"invite"===(null===(t=this.state.room)||void 0===t?void 0:t.getMyMembership())?"Invite":"RoomPreview"}),Promise.resolve()})}),i()(this,"onMessageListScroll",e=>{this.messagePanel.isAtEndOfLiveTimeline()?this.setState({numUnreadMessages:0,atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.updateTopUnreadMessagesBar()}),i()(this,"resetJumpToEvent",e=>{this.state.initialEventId&&this.state.initialEventScrollIntoView&&this.state.initialEventId===e&&(ku("Removing scroll_into_view flag from initial event"),v.a.dispatch({action:L.a.ViewRoom,room_id:this.state.room.roomId,event_id:this.state.initialEventId,highlighted:this.state.isInitialEventHighlighted,scroll_into_view:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0}))}),i()(this,"onSearch",(e,t)=>{let a;this.setState({searchTerm:e,searchScope:t,searchResults:{},searchHighlights:[]}),this.searchResultsPanel.current&&this.searchResultsPanel.current.resetScrollState(),this.searchId=(new Date).getTime(),t===Nl.Room&&(a=this.state.room.roomId),ku("sending search request");const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;const a=ki.a.get();return null===a?Ri(e,t):Fi(e,t)}(e,a);this.handleSearchResult(n)}),i()(this,"onAppsClick",()=>{v.a.dispatch({action:"appsDrawer",show:!this.state.showApps})}),i()(this,"onForgetClick",()=>{v.a.dispatch({action:"forget_room",room_id:this.state.room.roomId})}),i()(this,"onRejectButtonClicked",()=>{this.setState({rejecting:!0}),this.context.client.leave(this.state.roomId).then(()=>{v.a.dispatch({action:L.a.ViewHomePage}),this.setState({rejecting:!1})},e=>{la.a.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e);z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})})}),i()(this,"onRejectAndIgnoreClick",async()=>{this.setState({rejecting:!0});try{const e=this.state.room.getMember(this.context.client.getUserId()).events.member,t=this.context.client.getIgnoredUsers();t.push(e.getSender()),await this.context.client.setIgnoredUsers(t),await this.context.client.leave(this.state.roomId),v.a.dispatch({action:L.a.ViewHomePage}),this.setState({rejecting:!1})}catch(e){la.a.error("Failed to reject invite: %s",e);const t=e.message?e.message:JSON.stringify(e);z.a.createDialog(Nn.a,{title:Object(N.a)("Failed to reject invite"),description:t}),this.setState({rejecting:!1,rejectError:e})}}),i()(this,"onRejectThreepidInviteButtonClicked",()=>{v.a.fire(L.a.ViewRoomDirectory)}),i()(this,"onSearchClick",()=>{this.setState({timelineRenderingType:this.state.timelineRenderingType===Un.a.Search?Un.a.Room:Un.a.Search})}),i()(this,"onCancelSearchClick",()=>new Promise(e=>{this.setState({timelineRenderingType:Un.a.Room,searchResults:null},e)})),i()(this,"jumpToLiveTimeline",()=>{this.state.initialEventId&&this.state.isInitialEventHighlighted?v.a.dispatch({action:L.a.ViewRoom,room_id:this.state.room.roomId,metricsTrigger:void 0}):(this.messagePanel.jumpToLiveTimeline(),v.a.fire(L.a.FocusSendMessageComposer))}),i()(this,"jumpToReadMarker",()=>{this.messagePanel.jumpToReadMarker()}),i()(this,"forgetReadMarker",e=>{e.stopPropagation(),this.messagePanel.forgetReadMarker()}),i()(this,"updateTopUnreadMessagesBar",()=>{if(!this.messagePanel)return;const e=this.messagePanel.canJumpToReadMarker();this.state.showTopUnreadMessagesBar!=e&&this.setState({showTopUnreadMessagesBar:e})}),i()(this,"onStatusBarVisible",()=>{this.unmounted||this.state.statusBarVisible||this.setState({statusBarVisible:!0})}),i()(this,"onStatusBarHidden",()=>{!this.unmounted&&this.state.statusBarVisible&&this.setState({statusBarVisible:!1})}),i()(this,"handleScrollKey",e=>{let t;this.searchResultsPanel.current?t=this.searchResultsPanel.current:this.messagePanel&&(t=this.messagePanel),t&&t.handleScrollKey(e)}),i()(this,"gatherTimelinePanelRef",e=>{this.messagePanel=e}),i()(this,"onHiddenHighlightsClick",()=>{const e=this.getOldRoom();e&&v.a.dispatch({action:L.a.ViewRoom,room_id:e.roomId,metricsTrigger:"Predecessor"})}),i()(this,"onFileDrop",e=>{var t,a;return Oi.a.sharedInstance().sendContentListToRoom(Array.from(e.files),null!==(t=null===(a=this.state.room)||void 0===a?void 0:a.roomId)&&void 0!==t?t:this.state.roomId,null,this.context.client,Un.a.Room)}),i()(this,"onMeasurement",e=>{this.setState({narrow:e})});const s=t.client.hasLazyLoadMembersEnabled();this.state={roomId:null,roomLoading:!0,peekLoading:!1,shouldPeek:!0,membersLoaded:!s,numUnreadMessages:0,searchResults:null,callState:null,activeCall:null,canPeek:!1,canSelfRedact:!1,showApps:!1,isPeeking:!1,showRightPanel:!1,joining:!1,showTopUnreadMessagesBar:!1,statusBarVisible:!1,canReact:!1,canSendMessages:!1,resizing:!1,layout:f.b.getValue("layout"),lowBandwidth:f.b.getValue("lowBandwidth"),alwaysShowTimestamps:f.b.getValue("alwaysShowTimestamps"),showTwelveHourTimestamps:f.b.getValue("showTwelveHourTimestamps"),readMarkerInViewThresholdMs:f.b.getValue("readMarkerInViewThresholdMs"),readMarkerOutOfViewThresholdMs:f.b.getValue("readMarkerOutOfViewThresholdMs"),showHiddenEvents:f.b.getValue("showHiddenEventsInTimeline"),showReadReceipts:!0,showRedactions:!0,showJoinLeaves:!0,showAvatarChanges:!0,showDisplaynameChanges:!0,matrixClientIsReady:null===(n=t.client)||void 0===n?void 0:n.isInitialSyncComplete(),mainSplitContentType:Ru.Timeline,timelineRenderingType:Un.a.Room,liveTimeline:void 0,narrow:!1},this.dispatcherRef=v.a.register(this.onAction),t.client.on(o.b.Room,this.onRoom),t.client.on(ee.d.Timeline,this.onRoomTimeline),t.client.on(ee.d.TimelineReset,this.onRoomTimelineReset),t.client.on(ee.d.Name,this.onRoomName),t.client.on(u.b.Events,this.onRoomStateEvents),t.client.on(u.b.Update,this.onRoomStateUpdate),t.client.on(ee.d.MyMembership,this.onMyMembership),t.client.on(Ei.b.KeyBackupStatus,this.onKeyBackupStatus),t.client.on(Ei.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),t.client.on(Ei.b.UserTrustStatusChanged,this.onUserVerificationChanged),t.client.on(Ei.b.KeysChanged,this.onCrossSigningKeysChanged),t.client.on(tn.c.Decrypted,this.onEventDecrypted),t.roomViewStore.on(mt.b,this.onRoomViewStoreUpdate),t.rightPanelStore.on(mt.b,this.onRightPanelStoreUpdate),dl.a.on(mt.b,this.onWidgetEchoStoreUpdate),t.widgetStore.on(mt.b,this.onWidgetStoreUpdate),si.a.instance.on(si.b.ActiveCalls,this.onActiveCalls),this.props.resizeNotifier.on("isResizing",this.onIsResizing),this.settingWatchers=[f.b.watchSetting("layout",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({layout:i})})),f.b.watchSetting("lowBandwidth",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({lowBandwidth:i})})),f.b.watchSetting("alwaysShowTimestamps",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({alwaysShowTimestamps:i})})),f.b.watchSetting("showTwelveHourTimestamps",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({showTwelveHourTimestamps:i})})),f.b.watchSetting("readMarkerInViewThresholdMs",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({readMarkerInViewThresholdMs:i})})),f.b.watchSetting("readMarkerOutOfViewThresholdMs",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({readMarkerOutOfViewThresholdMs:i})})),f.b.watchSetting("showHiddenEventsInTimeline",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,i]=t;return a.setState({showHiddenEvents:i})})),f.b.watchSetting("urlPreviewsEnabled",null,this.onUrlPreviewsEnabledChange),f.b.watchSetting("urlPreviewsEnabled_e2ee",null,this.onUrlPreviewsEnabledChange)]}getPermalinkCreatorForRoom(e){return this.permalinkCreators[e.roomId]||(this.permalinkCreators[e.roomId]=new Si.a(e),this.state.room&&e.roomId===this.state.room.roomId?this.permalinkCreators[e.roomId].start():this.permalinkCreators[e.roomId].load()),this.permalinkCreators[e.roomId]}stopAllPermalinkCreators(){if(this.permalinkCreators)for(const e of Object.keys(this.permalinkCreators))this.permalinkCreators[e].stop()}setupRoom(e,t,a,n){!a&&t&&(!e&&n?(la.a.info("Attempting to peek into room %s",t),this.setState({peekLoading:!0,isPeeking:!0}),this.context.client.peekInRoom(t).then(e=>{this.unmounted||(this.setState({room:e,peekLoading:!1}),this.onRoomLoaded(e))}).catch(e=>{if(!this.unmounted){if(this.setState({isPeeking:!1}),"M_GUEST_ACCESS_FORBIDDEN"!==e.errcode&&"M_FORBIDDEN"!==e.errcode)throw e;this.setState({peekLoading:!1})}})):e&&(this.context.client.stopPeeking(),this.setState({isPeeking:!1})))}shouldShowApps(e){if(!ju||!e)return!1;const t=e.roomId+"_hide_widget_drawer",a=localStorage.getItem(t),n=!a||"false"===a,i=this.context.widgetLayoutStore.getContainerWidgets(e,Bn.a.Top);return n&&i.length>0}componentDidMount(){this.onRoomViewStoreUpdate(!0);const e=this.getCallForRoom(),t=e?e.state:null;this.setState({callState:t}),this.context.legacyCallHandler.on(F.a.CallState,this.onCallState),window.addEventListener("beforeunload",this.onPageUnload)}shouldComponentUpdate(e,t){const a=Object(dn.c)(this.props,e),n=this.state,{upgradeRecommendation:i}=n,r=ge()(n,Su),{upgradeRecommendation:s}=t,o=ge()(t,Ou),c=(null==s?void 0:s.needsUpgrade)!==(null==i?void 0:i.needsUpgrade)||Object(dn.c)(r,o);return a||c}componentDidUpdate(){this.messagePanel&&void 0===this.state.atEndOfLiveTimeline&&this.setState({atEndOfLiveTimeline:this.messagePanel.isAtEndOfLiveTimeline()})}componentWillUnmount(){this.unmounted=!0,this.context.legacyCallHandler.removeListener(F.a.CallState,this.onCallState),this.state.roomId&&ll.setScrollState(this.state.roomId,this.getScrollState()),this.state.shouldPeek&&this.context.client.stopPeeking(),this.stopAllPermalinkCreators(),v.a.unregister(this.dispatcherRef),this.context.client&&(this.context.client.removeListener(o.b.Room,this.onRoom),this.context.client.removeListener(ee.d.Timeline,this.onRoomTimeline),this.context.client.removeListener(ee.d.TimelineReset,this.onRoomTimelineReset),this.context.client.removeListener(ee.d.Name,this.onRoomName),this.context.client.removeListener(u.b.Events,this.onRoomStateEvents),this.context.client.removeListener(ee.d.MyMembership,this.onMyMembership),this.context.client.removeListener(u.b.Update,this.onRoomStateUpdate),this.context.client.removeListener(Ei.b.KeyBackupStatus,this.onKeyBackupStatus),this.context.client.removeListener(Ei.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.context.client.removeListener(Ei.b.UserTrustStatusChanged,this.onUserVerificationChanged),this.context.client.removeListener(Ei.b.KeysChanged,this.onCrossSigningKeysChanged),this.context.client.removeListener(tn.c.Decrypted,this.onEventDecrypted)),window.removeEventListener("beforeunload",this.onPageUnload),this.context.roomViewStore.off(mt.b,this.onRoomViewStoreUpdate),this.context.rightPanelStore.off(mt.b,this.onRightPanelStoreUpdate),dl.a.removeListener(mt.b,this.onWidgetEchoStoreUpdate),this.context.widgetStore.removeListener(mt.b,this.onWidgetStoreUpdate),this.props.resizeNotifier.off("isResizing",this.onIsResizing),this.state.room&&this.context.widgetLayoutStore.off(Bn.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),si.a.instance.off(si.b.ActiveCalls,this.onActiveCalls),this.context.legacyCallHandler.off(F.a.CallState,this.onCallState),this.updateRoomMembers.cancel();for(const e of this.settingWatchers)f.b.unwatchSetting(e);this.viewsLocalRoom&&this.context.client.store.removeRoom(this.state.room.roomId)}onLocalRoomEvent(e){e===this.state.room.roomId&&Object(us.c)(this.context.client,this.state.room)}getRoomTombstone(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.room;return null==e?void 0:e.currentState.getStateEvents(Z.b.RoomTombstone,"")}async calculateRecommendedVersion(e){const t=await e.getRecommendedVersion();this.unmounted||this.setState({upgradeRecommendation:t})}async loadMembersIfJoined(e){if(this.context.client.hasLazyLoadMembersEnabled()&&e&&"join"===e.getMyMembership())try{await e.loadMembersIfNeeded(),this.unmounted||this.setState({membersLoaded:!0})}catch(t){const a=`Fetching room members for ${e.roomId} failed. Room members will appear incomplete.`;la.a.error(a),la.a.error(t)}}calculatePeekRules(e){const t=e.currentState.getStateEvents(Z.b.RoomHistoryVisibility,"");this.setState({canPeek:(null==t?void 0:t.getContent().history_visibility)===_i.b.WorldReadable})}updatePreviewUrlVisibility(e){let{roomId:t}=e;const a=this.context.client.isRoomEncrypted(t)?"urlPreviewsEnabled_e2ee":"urlPreviewsEnabled";this.setState({showUrlPreview:f.b.getValue(a,t)})}async updateE2EStatus(e){if(!this.context.client.isRoomEncrypted(e.roomId))return;let t=Xi.Warning;this.context.client.isCryptoEnabled()&&(t=await async function(e,t){const a=(await t.getEncryptionTargetMembers()).map(e=>{let{userId:t}=e;return t}),n=!!Qi.a.shared().getUserIdForRoomId(t.roomId),i=[],r=[];a.filter(t=>t!==e.getUserId()).forEach(t=>{(e.checkUserTrust(t).isCrossSigningVerified()?i:r).push(t)});for(const t of r)if(e.checkUserTrust(t).wasCrossSigningVerified())return Xi.Warning;const s=i.length>0&&!n&&2!==a.length||1===a.length?[...i,e.getUserId()]:i;for(const t of s){if(e.getStoredDevicesForUser(t).some(a=>{let{deviceId:n}=a;return!e.checkDeviceTrust(t,n).isVerified()}))return Xi.Warning}return 0===r.length?Xi.Verified:Xi.Normal}(this.context.client,e)),this.unmounted||this.setState({e2eStatus:t})}updatePermissions(e){if(e){const t=this.context.client.getUserId(),a="join"===e.getMyMembership()&&e.currentState.maySendEvent(Z.b.Reaction,t),n=e.maySendMessage(),i=e.currentState.maySendEvent(Z.b.RoomRedaction,t);this.setState({canReact:a,canSendMessages:n,canSelfRedact:i})}}checkDesktopNotifications(){this.state.room.getJoinedMemberCount()+this.state.room.getInvitedMemberCount()>1&&Ld.default.shouldShowPrompt()&&Object(Ud.b)(!0)}updateDMState(){const e=this.state.room;if("join"!=e.getMyMembership())return;const t=e.getDMInviter();t&&Ci.d(e.roomId,t)}injectSticker(e,t,a,n){this.context.client.isGuest()?v.a.dispatch({action:"require_registration"}):Oi.a.sharedInstance().sendStickerContentToRoom(e,this.state.room.roomId,n,t,a,this.context.client).then(void 0,e=>{e.name})}handleSearchResult(e){const t=this.searchId;return this.setState({searchInProgress:!0}),e.then(async e=>{if(ku("search complete"),this.unmounted||this.state.timelineRenderingType!==Un.a.Search||this.searchId!=t)return la.a.error("Discarding stale search results"),!1;let a=e.highlights;if(a.indexOf(this.state.searchTerm)<0&&(a=a.concat(this.state.searchTerm)),a=a.sort((function(e,t){return t.length-e.length})),this.context.client.supportsExperimentalThreads())for(const t of e.results)for(const e of t.context.getTimeline()){if(!e.getServerAggregatedRelation(an.d.name)||e.getThread())continue;const t=this.context.client.getRoom(e.getRoomId()),a=t.findThreadForEvent(e);a?e.setThread(a):t.createThread(e.getId(),e,[],!0)}this.setState({searchHighlights:a,searchResults:e})},e=>(la.a.error("Search failed",e),z.a.createDialog(Nn.a,{title:Object(N.a)("Search failed"),description:e&&e.message?e.message:Object(N.a)("Server may be unavailable, overloaded, or search timed out :(")}),!1)).finally(()=>{this.setState({searchInProgress:!1})})}getSearchResultTiles(){const e=[];var t,a;(this.state.searchInProgress&&e.push(s.a.createElement("li",{key:"search-spinner"},s.a.createElement(Ya.a,null))),this.state.searchResults.next_batch)||(null!==(t=this.state.searchResults)&&void 0!==t&&null!==(a=t.results)&&void 0!==a&&a.length?e.push(s.a.createElement("li",{key:"search-top-marker"},s.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(N.a)("No more results")))):e.push(s.a.createElement("li",{key:"search-top-marker"},s.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(N.a)("No results")))));const n=()=>{const e=this.searchResultsPanel.current;e&&e.checkScroll()};let i;for(let t=((null===(r=this.state.searchResults)||void 0===r||null===(o=r.results)||void 0===o?void 0:o.length)||0)-1;t>=0;t--){var r,o;const a=this.state.searchResults.results[t],c=a.context.getEvent(),l=c.getRoomId(),d=this.context.client.getRoom(l);if(!d){la.a.log("Hiding search result from an unknown room",l);continue}if(!Object(Cr.c)(c,this.state.showHiddenEvents))continue;"All"===this.state.searchScope&&l!==i&&(e.push(s.a.createElement("li",{key:c.getId()+"-room"},s.a.createElement("h2",null,Object(N.a)("Room"),": ",d.name))),i=l);const u="#/room/"+l+"/"+c.getId();e.push(s.a.createElement(pu,{key:c.getId(),searchResult:a,searchHighlights:this.state.searchHighlights,resultLink:u,permalinkCreator:this.permalinkCreator,onHeightChanged:n}))}return e}getScrollState(){const e=this.messagePanel;if(!e)return null;if(this.state.atEndOfLiveTimeline)return null;const t=e.getScrollState();return!t||t.stuckAtBottom?null:{focussedEvent:t.trackedScrollToken,pixelOffset:t.pixelOffset}}getCallForRoom(){return this.state.room?this.context.legacyCallHandler.getCallForRoom(this.state.room.roomId):null}getOldRoom(){const e=this.state.room.currentState.getStateEvents(Z.b.RoomCreate,"");return e&&e.getContent().predecessor?this.context.client.getRoom(e.getContent().predecessor.room_id):null}getHiddenHighlightCount(){const e=this.getOldRoom();return e?e.getUnreadNotificationCount(ee.b.Highlight):0}get messagePanelClassNames(){return l()("mx_RoomView_messagePanel",{mx_IRCLayout:this.state.layout===qs.a.IRC})}get viewsLocalRoom(){return Object(wc.a)(this.state.room)}get permalinkCreator(){return this.getPermalinkCreatorForRoom(this.state.room)}renderLocalRoomCreateLoader(){const e=this.state.room.getDefaultRoomName(this.context.client.getUserId());return s.a.createElement(Un.b.Provider,{value:this.state},s.a.createElement(Tu,{names:e,resizeNotifier:this.props.resizeNotifier}))}renderLocalRoomView(){return s.a.createElement(Un.b.Provider,{value:this.state},s.a.createElement(Iu,{resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,roomView:this.roomView,onFileDrop:this.onFileDrop}))}render(){var e;if(this.state.room instanceof bu.b)return this.state.room.state===bu.c.CREATING?this.renderLocalRoomCreateLoader():this.renderLocalRoomView();if(!this.state.room){const e=!this.state.matrixClientIsReady||this.state.roomLoading||this.state.peekLoading;if(e){const t=!this.state.matrixClientIsReady||!this.state.roomId||this.state.peekLoading;return s.a.createElement("div",{className:"mx_RoomView"},s.a.createElement(ml.a,null,s.a.createElement(yl,{canPreview:!1,previewLoading:t&&!this.state.roomLoadError,error:this.state.roomLoadError,loading:e,joining:this.state.joining,oobData:this.props.oobData})))}{var t,a;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const n=null===(t=this.props.threepidInvite)||void 0===t?void 0:t.toEmail,i=this.state.roomAlias;return s.a.createElement("div",{className:"mx_RoomView"},s.a.createElement(ml.a,null,s.a.createElement(yl,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,canPreview:!1,error:this.state.roomLoadError,roomAlias:i,joining:this.state.joining,inviterName:e,invitedEmail:n,oobData:this.props.oobData,signUrl:null===(a=this.props.threepidInvite)||void 0===a?void 0:a.signUrl,room:this.state.room})))}}const n=this.state.room.getMyMembership();if(bd(this.state.room)&&(!f.b.getValue("feature_video_rooms")||"join"!==n))return s.a.createElement(ml.a,null,s.a.createElement("div",{className:"mx_MainSplit"},s.a.createElement(Tl,{room:this.state.room,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.onRejectButtonClicked})),";");if("invite"===n&&!this.state.room.isSpaceRoom()){if(this.state.joining||this.state.rejecting)return s.a.createElement(ml.a,null,s.a.createElement(yl,{canPreview:!1,error:this.state.roomLoadError,joining:this.state.joining,rejecting:this.state.rejecting}));{const e=this.context.client.credentials.userId,t=this.state.room.getMember(e),a=t?t.events.member:null;let n=Object(N.a)("Unknown");return a&&(n=a.sender?a.sender.name:a.getSender()),s.a.createElement("div",{className:"mx_RoomView"},s.a.createElement(ml.a,null,s.a.createElement(yl,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectButtonClicked,onRejectAndIgnoreClick:this.onRejectAndIgnoreClick,inviterName:n,canPreview:!1,joining:this.state.joining,room:this.state.room})))}}let i=null;{const e=this.getCallForRoom();e&&"ended"!==this.state.callState&&"ringing"!==this.state.callState&&(i=e)}const r=l()({mx_RoomView_scrollheader:!0});let o,c=!0;Oi.a.sharedInstance().getCurrentUploads().length>0?o=s.a.createElement(Pc,{room:this.state.room}):this.state.searchResults||(c=this.state.statusBarVisible,o=s.a.createElement(gu.a,{room:this.state.room,isPeeking:"join"!==n,onInviteClick:this.onInviteClick,onVisible:this.onStatusBarVisible,onHidden:this.onStatusBarHidden}));const d=l()("mx_RoomView_statusArea",{mx_RoomView_statusArea_expanded:c}),u=o&&s.a.createElement("div",{className:d},s.a.createElement("div",{className:"mx_RoomView_statusAreaBox"},s.a.createElement("div",{className:"mx_RoomView_statusAreaBox_line"}),o)),m=this.state.upgradeRecommendation,h=m&&m.needsUpgrade&&this.state.room.userMayUpgradeRoom(this.context.client.credentials.userId),p=this.getHiddenHighlightCount();let g,v=null;if(this.state.timelineRenderingType===Un.a.Search)v=s.a.createElement(Dl,{searchInProgress:this.state.searchInProgress,onCancelClick:this.onCancelSearchClick,onSearch:this.onSearch,isRoomEncrypted:this.context.client.isRoomEncrypted(this.state.room.roomId)});else if(h)v=s.a.createElement(Al,{room:this.state.room});else if("join"!==n){var b,y;let e=void 0;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(b=this.props.threepidInvite)||void 0===b?void 0:b.toEmail;if(g=s.a.createElement(yl,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,canPreview:this.state.canPeek,room:this.state.room}),!(this.state.canPeek||null!==(y=this.state.room)&&void 0!==y&&y.isSpaceRoom()))return s.a.createElement("div",{className:"mx_RoomView"},g)}else p>0&&(v=s.a.createElement(H.a,{element:"div",className:"mx_RoomView_auxPanel_hiddenHighlights",onClick:this.onHiddenHighlightsClick},Object(N.a)("You have %(count)s unread notifications in a prior version of this room.",{count:p})));if(null!==(e=this.state.room)&&void 0!==e&&e.isSpaceRoom()&&!this.props.forceTimeline)return s.a.createElement(uu,{space:this.state.room,justCreatedOpts:this.props.justCreatedOpts,resizeNotifier:this.props.resizeNotifier,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.props.threepidInvite?this.onRejectThreepidInviteButtonClicked:this.onRejectButtonClicked});const E=s.a.createElement(Jl,{room:this.state.room,userId:this.context.client.credentials.userId,showApps:this.state.showApps,resizeNotifier:this.props.resizeNotifier},v);let _,w;let S;"join"===n&&!this.state.searchResults&&(_=s.a.createElement(Rc,{room:this.state.room,e2eStatus:this.state.e2eStatus,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.permalinkCreator})),this.state.searchResults&&(w={searchTerm:this.state.searchTerm,searchScope:this.state.searchScope,searchCount:this.state.searchResults.count});let O=!1;this.state.searchResults&&(S=void 0===this.state.searchResults.count?s.a.createElement("div",{className:"mx_RoomView_messagePanel mx_RoomView_messagePanelSearchSpinner"}):s.a.createElement(ul.a,{ref:this.searchResultsPanel,className:"mx_RoomView_searchResultsPanel "+this.messagePanelClassNames,onFillRequest:this.onSearchResultsFillRequest,resizeNotifier:this.props.resizeNotifier},s.a.createElement("li",{className:r}),this.getSearchResultTiles()),O=!0);let C=null;this.state.isInitialEventHighlighted&&(C=this.state.initialEventId);const x=s.a.createElement(Gs,{ref:this.gatherTimelinePanelRef,timelineSet:this.state.room.getUnfilteredTimelineSet(),showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!this.state.isPeeking,sendReadReceiptOnLoad:!this.state.wasContextSwitch,manageReadMarkers:!this.state.isPeeking,hidden:O,highlightedEventId:C,eventId:this.state.initialEventId,eventScrollIntoView:this.state.initialEventScrollIntoView,eventPixelOffset:this.state.initialEventPixelOffset,onScroll:this.onMessageListScroll,onEventScrolledIntoView:this.resetJumpToEvent,onReadMarkerUpdated:this.updateTopUnreadMessagesBar,showUrlPreview:this.state.showUrlPreview,className:this.messagePanelClassNames,membersLoaded:this.state.membersLoaded,permalinkCreator:this.permalinkCreator,resizeNotifier:this.props.resizeNotifier,showReactions:!0,layout:this.state.layout,editState:this.state.editState});let k,j=null;this.state.showTopUnreadMessagesBar&&!this.state.searchResults&&(j=s.a.createElement(vu,{onScrollUpClick:this.jumpToReadMarker,onCloseClick:this.forgetReadMarker})),!1!==this.state.atEndOfLiveTimeline||this.state.searchResults||(k=s.a.createElement(al,{highlight:this.state.room.getUnreadNotificationCount(ee.b.Highlight)>0,numUnreadMessages:this.state.numUnreadMessages,onScrollToBottomClick:this.jumpToLiveTimeline}));const R=this.state.room&&this.state.showRightPanel?s.a.createElement(ol,{room:this.state.room,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,e2eStatus:this.state.e2eStatus}):null,I=l()("mx_RoomView_timeline",{mx_RoomView_timeline_rr_enabled:this.state.showReadReceipts}),T=l()("mx_RoomView",{mx_RoomView_inCall:Boolean(i),mx_RoomView_immersive:this.state.mainSplitContentType!==Ru.Timeline}),D=f.b.getValue("showChatEffects");let P,M;switch(this.state.mainSplitContentType){case Ru.Timeline:M="mx_MainSplit_timeline",P=s.a.createElement(s.a.Fragment,null,s.a.createElement(Ks,{sensor:this.roomViewBody.current,onMeasurement:this.onMeasurement}),E,s.a.createElement("div",{className:I},s.a.createElement(Uc,{parent:this.roomView.current,onFileDrop:this.onFileDrop}),j,k,x,S),u,g,_);break;case Ru.MaximisedWidget:M="mx_MainSplit_maximisedWidget",P=s.a.createElement(s.a.Fragment,null,s.a.createElement(ql,{room:this.state.room,userId:this.context.client.credentials.userId,resizeNotifier:this.props.resizeNotifier,showApps:!0}),g);break;case Ru.Call:M="mx_MainSplit_call",P=s.a.createElement(s.a.Fragment,null,s.a.createElement(Ad,{room:this.state.room,resizing:this.state.resizing,waitForCall:bd(this.state.room)}),g)}const A=l()("mx_RoomView_body",M);let L=[Hi.a.Timeline],U=this.onAppsClick,F=this.onForgetClick,B=this.onSearchClick,V=null,z=!1;switch(this.state.mainSplitContentType){case Ru.MaximisedWidget:L=[Hi.a.ThreadPanel,Hi.a.PinnedMessages],U=null,F=null,B=null;break;case Ru.Call:L=[Hi.a.ThreadPanel,Hi.a.PinnedMessages,Hi.a.NotificationPanel],bd(this.state.room)||(L.push(Hi.a.RoomSummary),null===this.state.activeCall&&L.push(Hi.a.Timeline)),U=null,F=null,B=null,this.state.room.canInvite(this.context.client.credentials.userId)&&(V=this.onInviteClick),z=!0}return s.a.createElement(Un.b.Provider,{value:this.state},s.a.createElement("main",{className:T,ref:this.roomView,onKeyDown:this.onReactKeyDown},D&&this.roomView.current&&s.a.createElement(Td,{roomWidth:this.roomView.current.offsetWidth}),s.a.createElement(ml.a,null,s.a.createElement(Id,{room:this.state.room,searchInfo:w,oobData:this.props.oobData,inRoom:"join"===n,onSearchClick:B,onInviteClick:V,onForgetClick:"leave"===n?F:null,e2eStatus:this.state.e2eStatus,onAppsClick:this.state.hasPinnedWidgets?U:null,appsShown:this.state.showApps,excludedRightPanelPhaseButtons:L,showButtons:!this.viewsLocalRoom,enableRoomOptionsMenu:!this.viewsLocalRoom,viewingCall:z,activeCall:this.state.activeCall}),s.a.createElement(zi,{panel:R,resizeNotifier:this.props.resizeNotifier},s.a.createElement("div",{className:A,ref:this.roomViewBody,"data-layout":this.state.layout},P)))))}}i()(Nu,"contextType",it.a);var Du=Nu;class Pu extends r.Component{constructor(e,t){super(e,t),i()(this,"onToastStoreUpdate",()=>{this.setState({toasts:P.a.sharedInstance().getToasts(),countSeen:P.a.sharedInstance().getCountSeen()})}),this.state={toasts:P.a.sharedInstance().getToasts(),countSeen:P.a.sharedInstance().getCountSeen()},P.a.sharedInstance().on("update",this.onToastStoreUpdate)}componentWillUnmount(){P.a.sharedInstance().removeListener("update",this.onToastStoreUpdate)}render(){const e=this.state.toasts.length,t=e>1;let a,n;if(0!==e){const i=this.state.toasts[0],{title:s,icon:o,key:c,component:d,className:u,bodyClassName:m,props:h}=i,p=l()("mx_Toast_body",m),g=l()("mx_Toast_toast",u,{mx_Toast_hasIcon:o,["mx_Toast_icon_"+o]:o}),v=Object.assign({},h,{key:c,toastKey:c}),f=r.createElement(d,v);let b,y;(s&&t||this.state.countSeen>0)&&(b=` (${this.state.countSeen+1}/${this.state.countSeen+e})`),s&&(y=r.createElement("div",{className:"mx_Toast_title"},r.createElement("h2",null,s),r.createElement("span",{className:"mx_Toast_title_countIndicator"},b))),a=r.createElement("div",{className:g},y,r.createElement("div",{className:p},f)),n=l()("mx_ToastContainer",{mx_ToastContainer_stacked:t})}return a?r.createElement("div",{className:n,role:"alert"},a):null}}class Mu extends s.a.Component{constructor(e){super(e),this.state={loading:!0}}componentDidMount(){this.props.userId&&this.loadProfileInfo()}componentDidUpdate(e){e.userId!==this.props.userId&&this.props.userId&&this.loadProfileInfo()}async loadProfileInfo(){const e=st.a.get();let t;this.setState({loading:!0});try{t=await e.getProfileInfo(this.props.userId)}catch(e){return z.a.createDialog(Nn.a,{title:Object(N.a)("Could not load user profile"),description:e&&e.message?e.message:Object(N.a)("Operation failed")}),void this.setState({loading:!1})}const a=new tn.b({type:"m.room.member",content:t}),n=new Wi.a(null,this.props.userId);n.setMembershipEvent(a),this.setState({member:n,loading:!1})}render(){if(this.state.loading)return s.a.createElement(Ya.a,null);if(this.state.member){const e=s.a.createElement(ol,{overwriteCard:{phase:Hi.a.RoomMemberInfo,state:{member:this.state.member}},resizeNotifier:this.props.resizeNotifier});return s.a.createElement(zi,{panel:e,resizeNotifier:this.props.resizeNotifier},s.a.createElement(ia.a,null))}return s.a.createElement("div",null)}}var Au=e=>{let{backgroundImage:t,blurMultiplier:a}=e;if(!t)return null;const n={};if(a){const e=getComputedStyle(document.documentElement).getPropertyValue("--lp-background-blur").replace("px",""),t=parseInt(e,10);isNaN(t)||(n.filter=`blur(${t*a}px)`)}return s.a.createElement("div",{className:"mx_BackdropPanel"},s.a.createElement("img",{role:"presentation",alt:"",style:n,className:"mx_BackdropPanel--image",src:t}))},Lu=a(561);var Uu=e=>{let{isMinimized:t}=e;const a=Object(ne.b)(Lo.a.instance,Lo.b.MonitoringLivePosition,()=>Lo.a.instance.isMonitoringLiveLocation),n=Object(ne.b)(Lo.a.instance,Lo.b.LocationPublishError,()=>Lo.a.instance.getLiveBeaconIdsWithLocationPublishError()),i=Object(ne.b)(Lo.a.instance,Lo.b.BeaconUpdateError,()=>Lo.a.instance.getLiveBeaconIds().filter(e=>Lo.a.instance.beaconUpdateErrors.has(e))),o=Object(ne.b)(Lo.a.instance,Lo.b.LivenessChange,()=>Lo.a.instance.getLiveBeaconIds()),c=!!n.length,d=!!i.length;if(((e,t)=>{Object(r.useEffect)(()=>{const a=()=>{"visible"===document.visibilityState&&e.forEach(e=>{var a;return null===(a=t.get(e))||void 0===a?void 0:a.monitorLiveness()})};return e.length&&document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a)}},[e,t])})(o,Lo.a.instance.beacons),!a)return null;const u=((e,t,a)=>{var n,i;const r=null!==(n=null!==(i=null==t?void 0:t[0])&&void 0!==i?i:null==a?void 0:a[0])&&void 0!==n?n:null==e?void 0:e[0];if(!r)return;return Lo.a.instance.getBeaconById(r)})(o,i,n),m=u?()=>{v.a.dispatch({action:L.a.ViewRoom,room_id:u.roomId,metricsTrigger:void 0,event_id:u.beaconInfoId,scroll_into_view:!0,highlighted:!0})}:void 0,h=((e,t)=>e?Object(N.a)("An error occurred while stopping your live location"):t?Object(N.a)("An error occurred whilst sharing your live location"):Object(N.a)("You are sharing your live location"))(d,c);return s.a.createElement(H.a,{className:l()("mx_LeftPanelLiveShareWarning",{mx_LeftPanelLiveShareWarning__minimized:t,mx_LeftPanelLiveShareWarning__error:c||d}),title:t?h:void 0,onClick:m},t?s.a.createElement(Lu.a,{height:10}):h)};function Fu(e){return e.closest("input, textarea, select, [contenteditable=true]")}class Bu extends s.a.Component{constructor(e,t){super(e,t),i()(this,"_matrixClient",void 0),i()(this,"_roomView",void 0),i()(this,"_resizeContainer",void 0),i()(this,"resizeHandler",void 0),i()(this,"layoutWatcherRef",void 0),i()(this,"compactLayoutWatcherRef",void 0),i()(this,"backgroundImageWatcherRef",void 0),i()(this,"resizer",void 0),i()(this,"onCallState",()=>{const e=F.b.instance.getAllActiveCalls();e!==this.state.activeCalls&&this.setState({activeCalls:e})}),i()(this,"refreshBackgroundImage",async()=>{let e=f.b.getValue("RoomList.backgroundImage");e=e?Object(Gn.b)(e).srcHttp:ut.a.instance.getHttpAvatarUrl(),this.setState({backgroundImage:e})}),i()(this,"canResetTimelineInRoom",e=>!this._roomView.current||this._roomView.current.canResetTimeline()),i()(this,"onAccountData",e=>{"m.ignored_user_list"===e.getType()&&v.a.dispatch({action:"ignore_state_changed"})}),i()(this,"onCompactLayoutChanged",()=>{this.setState({useCompactLayout:f.b.getValue("useCompactLayout")})}),i()(this,"onSync",(e,t,a)=>{var n,i,r;const s=null===(n=this.state.syncErrorData)||void 0===n||null===(i=n.error)||void 0===i?void 0:i.errcode,o=null==a||null===(r=a.error)||void 0===r?void 0:r.errcode;e===t&&s===o||(this.setState({syncErrorData:e===d.b.Error?a:null}),t===d.b.Prepared&&e===d.b.Syncing?this.updateServerNoticeEvents():this.calculateServerLimitToast(this.state.syncErrorData,this.state.usageLimitEventContent))}),i()(this,"onRoomStateEvents",e=>{const t=Qt.c.instance.orderedLists[T.a.ServerNotice];null!=t&&t.some(t=>t.roomId===e.getRoomId())&&this.updateServerNoticeEvents()}),i()(this,"onUsageLimitDismissed",()=>{this.setState({usageLimitDismissed:!0})}),i()(this,"updateServerNoticeEvents",async()=>{const e=Qt.c.instance.orderedLists[T.a.ServerNotice];if(!e)return[];const t=[];let a=0;for(const n of e){const e=n.currentState.getStateEvents("m.room.pinned_events","");if(!e||!e.getContent().pinned)continue;a=e.getTs();const i=e.getContent().pinned.slice(0,2);for(const e of i){const a=(await this._matrixClient.getEventTimeline(n.getUnfilteredTimelineSet(),e)).getEvents().find(t=>t.getId()===e);a&&t.push(a)}}if(a&&this.state.usageLimitEventTs>a)return;const n=t.find(e=>e&&"m.room.message"===e.getType()&&"m.server_notice.usage_limit_reached"===e.getContent().server_notice_type),i=n&&n.getContent();this.calculateServerLimitToast(this.state.syncErrorData,i),this.setState({usageLimitEventContent:i,usageLimitEventTs:a,usageLimitDismissed:!1})}),i()(this,"onPaste",e=>{const t=Fu(e.target);if(t!==document.activeElement)if(null!=t&&t.focus)t.focus();else{const e=!!document.activeElement.closest(".mx_ThreadView");v.a.dispatch({action:L.a.FocusSendMessageComposer,context:e?Un.a.Thread:Un.a.Room},!0)}}),i()(this,"onReactKeyDown",e=>{this.onKeyDown(e)}),i()(this,"onNativeKeyDown",e=>{e.target===document.body&&this.onKeyDown(e)}),i()(this,"onKeyDown",e=>{let t=!1;switch(Object(J.a)().getRoomAction(e)){case V.h.ScrollUp:case V.h.ScrollDown:case V.h.JumpToFirstMessage:case V.h.JumpToLatestMessage:this.onScrollKeyPressed(e),t=!0;break;case V.h.SearchInRoom:v.a.dispatch({action:"focus_search"}),t=!0}if(t)return e.stopPropagation(),void e.preventDefault();switch(Object(J.a)().getNavigationAction(e)){case V.h.FilterRooms:v.a.dispatch({action:"focus_room_filter"}),t=!0;break;case V.h.ToggleUserMenu:v.a.fire(L.a.ToggleUserMenu),t=!0;break;case V.h.ShowKeyboardSettings:v.a.dispatch({action:L.a.ViewUserSettings,initialTabId:Me.a.Keyboard}),t=!0;break;case V.h.GoToHome:v.a.dispatch({action:L.a.ViewHomePage}),z.a.closeCurrentModal("homeKeyboardShortcut"),t=!0;break;case V.h.ToggleSpacePanel:v.a.fire(L.a.ToggleSpacePanel),t=!0;break;case V.h.ToggleRoomSidePanel:"room_view"===this.props.page_type&&(Gi.a.instance.togglePanel(null),t=!0);break;case V.h.SelectPrevRoom:v.a.dispatch({action:L.a.ViewRoomDelta,delta:-1,unread:!1}),t=!0;break;case V.h.SelectNextRoom:v.a.dispatch({action:L.a.ViewRoomDelta,delta:1,unread:!1}),t=!0;break;case V.h.SelectPrevUnreadRoom:v.a.dispatch({action:L.a.ViewRoomDelta,delta:-1,unread:!0});break;case V.h.SelectNextUnreadRoom:v.a.dispatch({action:L.a.ViewRoomDelta,delta:1,unread:!0});break;case V.h.PreviousVisitedRoomOrSpace:I.a.get().navigateForwardBack(!0),t=!0;break;case V.h.NextVisitedRoomOrSpace:I.a.get().navigateForwardBack(!1),t=!0}if(!t){switch(Object(J.a)().getLabsAction(e)){case V.h.ToggleHiddenEventVisibility:{const e=f.b.getValueAt(b.a.DEVICE,"showHiddenEventsInTimeline",void 0,!1);f.b.setValue("showHiddenEventsInTimeline",void 0,b.a.DEVICE,!e),t=!0;break}}}if(!t&&I.a.get().overrideBrowserShortcuts()&&e.code.startsWith("Digit")&&"Digit0"!==e.code&&Object(m.c)(e)&&(v.a.dispatch({action:L.a.SwitchSpace,num:e.code.slice(5)}),t=!0),t)return e.stopPropagation(),void e.preventDefault();if(!(e.key===m.b.ALT||e.key===m.b.CONTROL||e.key===m.b.META||e.key===m.b.SHIFT)&&!e.ctrlKey&&!e.metaKey){const t=e.target!==document.body&&(e.key===m.b.SPACE||e.key===m.b.ENTER),a=1===e.key.length||"Dead"===e.key;if(!t&&a&&!Fu(e.target)){const t=!!document.activeElement.closest(".mx_ThreadView");v.a.dispatch({action:L.a.FocusSendMessageComposer,context:t?Un.a.Thread:Un.a.Room},!0),e.stopPropagation()}}}),i()(this,"onScrollKeyPressed",e=>{this._roomView.current&&this._roomView.current.handleScrollKey(e)}),this.state={syncErrorData:void 0,useCompactLayout:f.b.getValue("useCompactLayout"),usageLimitDismissed:!1,activeCalls:F.b.instance.getAllActiveCalls()},this._matrixClient=this.props.matrixClient,p.c.loadDevices(),Object(g.a)(),this._roomView=s.a.createRef(),this._resizeContainer=s.a.createRef(),this.resizeHandler=s.a.createRef()}componentDidMount(){document.addEventListener("keydown",this.onNativeKeyDown,!1),F.b.instance.addListener(F.a.CallState,this.onCallState),this.updateServerNoticeEvents(),this._matrixClient.on(o.b.AccountData,this.onAccountData),this._matrixClient.on(o.b.Sync,this.onSync),this.onSync(this._matrixClient.getSyncState(),null,this._matrixClient.getSyncStateData()),this._matrixClient.on(u.b.Events,this.onRoomStateEvents),this.layoutWatcherRef=f.b.watchSetting("layout",null,this.onCompactLayoutChanged),this.compactLayoutWatcherRef=f.b.watchSetting("useCompactLayout",null,this.onCompactLayoutChanged),this.backgroundImageWatcherRef=f.b.watchSetting("RoomList.backgroundImage",null,this.refreshBackgroundImage),this.resizer=this.createResizer(),this.resizer.attach(),ut.a.instance.on(mt.b,this.refreshBackgroundImage),this.loadResizerPreferences(),this.refreshBackgroundImage()}componentWillUnmount(){document.removeEventListener("keydown",this.onNativeKeyDown,!1),F.b.instance.removeListener(F.a.CallState,this.onCallState),this._matrixClient.removeListener(o.b.AccountData,this.onAccountData),this._matrixClient.removeListener(o.b.Sync,this.onSync),this._matrixClient.removeListener(u.b.Events,this.onRoomStateEvents),ut.a.instance.off(mt.b,this.refreshBackgroundImage),f.b.unwatchSetting(this.layoutWatcherRef),f.b.unwatchSetting(this.compactLayoutWatcherRef),f.b.unwatchSetting(this.backgroundImageWatcherRef),this.resizer.detach()}createResizer(){let e,t;const a={toggleSize:156,onCollapsed:e=>{t=e,e?(v.a.dispatch({action:"hide_left_panel"}),window.localStorage.setItem("mx_lhs_size","0")):v.a.dispatch({action:"show_left_panel"})},onResized:t=>{e=t,this.props.resizeNotifier.notifyLeftHandleResized()},onResizeStart:()=>{this.props.resizeNotifier.startResizing()},onResizeStop:()=>{t||window.localStorage.setItem("mx_lhs_size",""+e),this.props.resizeNotifier.stopResizing()},isItemCollapsed:e=>e.classList.contains("mx_LeftPanel_minimized"),handler:this.resizeHandler.current},n=new j(this._resizeContainer.current,x,a);return n.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle_vertical",reverse:"mx_ResizeHandle_reverse"}),n}loadResizerPreferences(){let e=parseInt(window.localStorage.getItem("mx_lhs_size"),10);isNaN(e)&&(e=350),this.resizer.forHandleWithId("lp-resizer").resize(e)}calculateServerLimitToast(e,t){var a;const n="M_RESOURCE_LIMIT_EXCEEDED"===(null==e||null===(a=e.error)||void 0===a?void 0:a.errcode);n&&(t=(null==e?void 0:e.error).data),t&&this.state.usageLimitDismissed?((e,t,a,n)=>{const i=Object(M.a)(e,a,{monthly_active_user:Object(N.c)("Your homeserver has exceeded its user limit."),hs_blocked:Object(N.c)("This homeserver has been blocked by its administrator."),"":Object(N.c)("Your homeserver has exceeded one of its resource limits.")}),r=Object(M.a)(e,a,{"":Object(N.c)("Contact your <a>server admin</a>.")});P.a.sharedInstance().addOrReplaceToast({key:"serverlimit",title:Object(N.a)("Warning"),props:{description:s.a.createElement(s.a.Fragment,null,i," ",r),acceptLabel:Object(N.a)("Ok"),onAccept:()=>{A(),t&&t()}},component:D.a,priority:70})})(t.limit_type,this.onUsageLimitDismissed,t.admin_contact):A()}render(){let e;switch(this.props.page_type){case h.a.RoomView:e=s.a.createElement(Du,{ref:this._roomView,onRegistered:this.props.onRegistered,threepidInvite:this.props.threepidInvite,oobData:this.props.roomOobData,key:this.props.currentRoomId||"roomview",resizeNotifier:this.props.resizeNotifier,justCreatedOpts:this.props.roomJustCreatedOpts,forceTimeline:this.props.forceTimeline});break;case h.a.HomePage:e=s.a.createElement(ia.a,{justRegistered:this.props.justRegistered});break;case h.a.UserView:e=s.a.createElement(Mu,{userId:this.props.currentUserId,resizeNotifier:this.props.resizeNotifier})}const t=l()({mx_MatrixChat_wrapper:!0,mx_MatrixChat_useCompactLayout:this.state.useCompactLayout}),a=l()({mx_MatrixChat:!0,"mx_MatrixChat--with-avatar":this.state.backgroundImage}),n=this.state.activeCalls.map(e=>s.a.createElement(yi,{call:e,key:e.callId}));return s.a.createElement(R.a.Provider,{value:this._matrixClient},s.a.createElement("div",{onPaste:this.onPaste,onKeyDown:this.onReactKeyDown,className:t,"aria-hidden":this.props.hideToSRUsers},s.a.createElement(Pu,null),s.a.createElement("div",{className:a},s.a.createElement("div",{className:"mx_LeftPanel_outerWrapper"},s.a.createElement(Uu,{isMinimized:this.props.collapseLhs||!1}),s.a.createElement("nav",{className:"mx_LeftPanel_wrapper"},s.a.createElement(Au,{blurMultiplier:.5,backgroundImage:this.state.backgroundImage}),s.a.createElement(It,null),s.a.createElement(Au,{backgroundImage:this.state.backgroundImage}),s.a.createElement("div",{className:"mx_LeftPanel_wrapper--user",ref:this._resizeContainer,"data-collapsed":!!this.props.collapseLhs||void 0},s.a.createElement(oa,{pageType:this.props.page_type,isMinimized:this.props.collapseLhs||!1,resizeNotifier:this.props.resizeNotifier})))),s.a.createElement(y,{passRef:this.resizeHandler,id:"lp-resizer"}),s.a.createElement("div",{className:"mx_RoomView_wrapper"},e))),s.a.createElement(mi,null),s.a.createElement(pi,null),s.a.createElement(fi,null),n)}}i()(Bu,"displayName","LoggedInView");t.a=Bu},1524:function(e,t,a){"use strict";a.d(t,"a",(function(){return Ci}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(308),c=a(91),l=a(241),d=a(1),u=a(92),m=a(108),h=a(100);var p=a(220),g=a(97),v=a(112),f=a(131),b=a(93),y=a(817),E=a(819),_=a(230),w=a(265),S=a(127);class O extends s.a.Component{constructor(e){super(e),i()(this,"avatarUpload",Object(r.createRef)()),i()(this,"uploadAvatar",()=>{this.avatarUpload.current.click()}),i()(this,"removeAvatar",()=>{this.avatarUpload.current.value="",this.setState({avatarUrl:null,avatarFile:null,enableProfileSave:!0})}),i()(this,"cancelProfileChanges",async e=>{e.stopPropagation(),e.preventDefault(),this.state.enableProfileSave&&this.setState({enableProfileSave:!1,displayName:this.state.originalDisplayName,avatarUrl:this.state.originalAvatarUrl,avatarFile:null})}),i()(this,"saveProfile",async e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.enableProfileSave)return;this.setState({enableProfileSave:!1});const t=u.a.get(),a={},n=this.state.displayName.trim();try{if(this.state.originalDisplayName!==this.state.displayName&&(await t.setDisplayName(n),a.originalDisplayName=n,a.displayName=n),this.state.avatarFile){d.a.log(`Uploading new avatar, ${this.state.avatarFile.name} of type ${this.state.avatarFile.type}, (${this.state.avatarFile.size}) bytes`);const{content_uri:e}=await t.uploadContent(this.state.avatarFile);await t.setAvatarUrl(e),a.avatarUrl=Object(f.b)(e).getSquareThumbnailHttp(96),a.originalAvatarUrl=a.avatarUrl,a.avatarFile=null}else this.state.originalAvatarUrl!==this.state.avatarUrl&&await t.setAvatarUrl("")}catch(e){d.a.log("Failed to save profile",e),g.a.createDialog(v.a,{title:Object(c.a)("Failed to save your profile"),description:e&&e.message?e.message:Object(c.a)("The operation could not be completed")})}this.setState(a)}),i()(this,"onDisplayNameChanged",e=>{this.setState({displayName:e.target.value,enableProfileSave:!0})}),i()(this,"onAvatarChanged",e=>{if(!e.target.files||!e.target.files.length)return void this.setState({avatarUrl:this.state.originalAvatarUrl,avatarFile:null,enableProfileSave:!1});const t=e.target.files[0],a=new FileReader;a.onload=e=>{this.setState({avatarUrl:e.target.result,avatarFile:t,enableProfileSave:!0})},a.readAsDataURL(t)});const t=u.a.get();let a=p.a.instance.avatarMxc;a&&(a=Object(f.b)(a).getSquareThumbnailHttp(96)),this.state={userId:t.getUserId(),originalDisplayName:p.a.instance.displayName,displayName:p.a.instance.displayName,originalAvatarUrl:a,avatarUrl:a,avatarFile:null,enableProfileSave:!1}}render(){var e;const t=function(e){const t=h.b.get().hosting_signup_link;if(!t)return null;if(!e)return t;if("matrix.org"!==u.a.get().getDomain())return null;try{const a=new URL(t);return a.searchParams.set("utm_campaign",e),a.toString()}catch(e){return t}}("user-settings");let a=null;t&&(a=s.a.createElement("span",null,Object(c.a)("<a>Upgrade</a> to your own domain",{},{a:e=>s.a.createElement(E.a,{href:t,target:"_blank",rel:"noreferrer noopener"},e)})));const n=_.a.getDisplayUserIdentifier(this.state.userId,{withDisplayName:!0});return s.a.createElement("form",{onSubmit:this.saveProfile,autoComplete:"off",noValidate:!0,className:"mx_ProfileSettings"},s.a.createElement("input",{type:"file",ref:this.avatarUpload,className:"mx_ProfileSettings_avatarUpload",onClick:e=>{Object(w.a)(e),S.b.trackInteraction("WebProfileSettingsAvatarUploadButton",e)},onChange:this.onAvatarChanged,accept:"image/*"}),s.a.createElement("div",{className:"mx_ProfileSettings_profile"},s.a.createElement("div",{className:"mx_ProfileSettings_profile_controls"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Profile")),s.a.createElement(m.a,{label:Object(c.a)("Display Name"),type:"text",value:this.state.displayName,autoComplete:"off",onChange:this.onDisplayNameChanged}),s.a.createElement("p",null,n&&s.a.createElement("span",{className:"mx_ProfileSettings_profile_controls_userId"},n),a)),s.a.createElement(y.a,{avatarUrl:null===(e=this.state.avatarUrl)||void 0===e?void 0:e.toString(),avatarName:this.state.displayName||this.state.userId,avatarAltText:Object(c.a)("Profile picture"),uploadAvatar:this.uploadAvatar,removeAvatar:this.removeAvatar})),s.a.createElement("div",{className:"mx_ProfileSettings_buttons"},s.a.createElement(b.a,{onClick:this.cancelProfileChanges,kind:"link",disabled:!this.state.enableProfileSave},Object(c.a)("Cancel")),s.a.createElement(b.a,{onClick:this.saveProfile,kind:"primary",disabled:!this.state.enableProfileSave},Object(c.a)("Save"))))}}var C=a(95),x=a(867),k=a(248),j=a(124),R=a(104);class I extends s.a.Component{constructor(e){super(e),this.onSearchChange=this.onSearchChange.bind(this),this.state={searchQuery:"",languages:null}}componentDidMount(){const e=j.a.get();e&&e.getAvailableSpellCheckLanguages().then(e=>{e.sort((function(e,t){return e<t?-1:e>t?1:0}));const t=[];e.forEach(e=>{t.push({label:e,value:e})}),this.setState({languages:t})}).catch(e=>{this.setState({languages:["en"]})})}onSearchChange(e){this.setState({searchQuery:e})}render(){if(null===this.state.languages)return s.a.createElement(R.a,null);let e;e=this.state.searchQuery?this.state.languages.filter(e=>function(e,t){return!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e)):this.state.languages;const t=e.map(e=>s.a.createElement("div",{key:e.value},e.label));let a=C.b.getValue("language",null,!0),n=null;return a||(a=navigator.language||navigator.userLanguage),n=this.props.value||a,s.a.createElement(k.a,{id:"mx_LanguageDropdown",className:this.props.className,onOptionChange:this.props.onOptionChange,onSearchChange:this.onSearchChange,searchEnabled:!0,value:n,label:Object(c.a)("Language Dropdown"),placeholder:Object(c.a)("Choose a locale")},t)}}class T extends s.a.Component{constructor(){super(...arguments),i()(this,"onRemove",e=>(e.stopPropagation(),e.preventDefault(),this.props.onRemoved(this.props.language)))}render(){return s.a.createElement("div",{className:"mx_ExistingSpellCheckLanguage"},s.a.createElement("span",{className:"mx_ExistingSpellCheckLanguage_language"},this.props.language),s.a.createElement(b.a,{onClick:this.onRemove,kind:"danger_sm"},Object(c.a)("Remove")))}}class N extends s.a.Component{constructor(e){super(e),i()(this,"onRemoved",e=>{const t=this.props.languages.filter(t=>t!==e);this.props.onLanguagesChange(t)}),i()(this,"onAddClick",e=>{e.stopPropagation(),e.preventDefault();const t=this.state.newLanguage;this.setState({newLanguage:""}),t&&(this.props.languages.includes(t)||(this.props.languages.push(t),this.props.onLanguagesChange(this.props.languages)))}),i()(this,"onNewLanguageChange",e=>{this.state.newLanguage!==e&&this.setState({newLanguage:e})}),this.state={newLanguage:""}}render(){const e=this.props.languages.map(e=>s.a.createElement(T,{language:e,onRemoved:this.onRemoved,key:e})),t=s.a.createElement(b.a,{onClick:this.onAddClick,kind:"primary"},Object(c.a)("Add"));return s.a.createElement("div",{className:"mx_SpellCheckLanguages"},e,s.a.createElement("form",{onSubmit:this.onAddClick,noValidate:!0},s.a.createElement(I,{className:"mx_GeneralUserSettingsTab_spellCheckLanguageInput",value:this.state.newLanguage,onOptionChange:this.onNewLanguageChange}),t))}}var D=a(476),P=a(282),M=a(147),A=a(105),L=a(94),U=a(98);class F extends s.a.Component{constructor(e){super(e),i()(this,"onStagePhaseChange",(e,t)=>{const a={[P.c.PHASE_PREAUTH]:{body:Object(c.a)("Confirm your account deactivation by using Single Sign On to prove your identity."),continueText:Object(c.a)("Single Sign On"),continueKind:"danger"},[P.c.PHASE_POSTAUTH]:{body:Object(c.a)("Are you sure you want to deactivate your account? This is irreversible."),continueText:Object(c.a)("Confirm account deactivation"),continueKind:"danger"}},n={[P.c.LOGIN_TYPE]:a,[P.c.UNSTABLE_LOGIN_TYPE]:a,[P.b.LOGIN_TYPE]:{[P.a]:{body:Object(c.a)("To continue, please enter your account password:")}}}[e];let i=null,r=null,s=null;if(n){const e=n[t];e&&e.body&&(i=e.body),e&&e.continueText&&(r=e.continueText),e&&e.continueKind&&(s=e.continueKind)}this.setState({bodyText:i,continueText:r,continueKind:s})}),i()(this,"onUIAuthFinished",(e,t)=>{e||(t!==D.a?(d.a.error("Error during UI Auth:",{result:t}),this.setState({errStr:Object(c.a)("There was a problem communicating with the server. Please try again.")})):this.onCancel())}),i()(this,"onUIAuthComplete",e=>{u.a.get().deactivateAccount(e,this.state.shouldErase).then(e=>{L.a.fire(U.a.TriggerLogout),this.props.onFinished(!0)}).catch(e=>{d.a.error(e),this.setState({errStr:Object(c.a)("There was a problem communicating with the server. Please try again.")})})}),i()(this,"onEraseFieldChange",e=>{this.setState({shouldErase:e.currentTarget.checked,authEnabled:!1}),this.initAuth(e.currentTarget.checked)}),this.state={shouldErase:!1,errStr:null,authData:null,authEnabled:!0,bodyText:null,continueText:null,continueKind:null},this.initAuth(!1)}onCancel(){this.props.onFinished(!1)}initAuth(e){u.a.get().deactivateAccount(null,e).then(e=>{d.a.warn("User's account got deactivated without confirmation: Server had no auth"),this.setState({errStr:Object(c.a)("Server did not require any authentication")})}).catch(e=>{e&&401===e.httpStatus&&e.data?this.setState({authData:e.data,authEnabled:!0}):this.setState({errStr:Object(c.a)("Server did not return valid authentication information.")})})}render(){let e=null;this.state.errStr&&(e=s.a.createElement("div",{className:"error"},this.state.errStr));let t=s.a.createElement("div",null,Object(c.a)("Loading..."));return this.state.authData&&this.state.authEnabled&&(t=s.a.createElement("div",null,this.state.bodyText,s.a.createElement(D.b,{matrixClient:u.a.get(),authData:this.state.authData,makeRequest:this.onUIAuthComplete,onAuthFinished:this.onUIAuthFinished,onStagePhaseChange:this.onStagePhaseChange,continueText:this.state.continueText,continueKind:this.state.continueKind}))),s.a.createElement(A.a,{className:"mx_DeactivateAccountDialog",onFinished:this.props.onFinished,titleClass:"danger",title:Object(c.a)("Deactivate Account"),screenName:"DeactivateAccount"},s.a.createElement("div",{className:"mx_Dialog_content"},s.a.createElement("p",null,Object(c.a)("Confirm that you would like to deactivate your account. If you proceed:")),s.a.createElement("ul",null,s.a.createElement("li",null,Object(c.a)("You will not be able to reactivate your account")),s.a.createElement("li",null,Object(c.a)("You will no longer be able to log in")),s.a.createElement("li",null,Object(c.a)("No one will be able to reuse your username (MXID), including you: this username will remain unavailable")),s.a.createElement("li",null,Object(c.a)("You will leave all rooms and DMs that you are in")),s.a.createElement("li",null,Object(c.a)("You will be removed from the identity server: your friends will no longer be able to find you with your email or phone number"))),s.a.createElement("p",null,Object(c.a)("Your old messages will still be visible to people who received them, just like emails you sent in the past. Would you like to hide your sent messages from people who join rooms in the future?")),s.a.createElement("div",{className:"mx_DeactivateAccountDialog_input_section"},s.a.createElement("p",null,s.a.createElement(M.b,{checked:this.state.shouldErase,onChange:this.onEraseFieldChange},Object(c.a)("Hide my messages from new joiners"))),e,t)))}}var B=a(451),V=a(263),z=a(336);async function W(e,t){const a=e.getUserId();let{threepids:n}=await e.getThreePids();if(t&&(n=n.filter(e=>e.medium===t)),n.length>0&&e.getIdentityServerUrl())try{const i=new V.a,r=await i.getAccessToken({check:!1}),s=n.map(e=>{let{medium:t,address:a}=e;return[t,a]}),o=await e.bulkLookupThreePids(s,r);for(const[e,i,r]of o.threepids){if(r!==a)continue;if(t&&e!==t)continue;const s=n.find(t=>t.medium===e&&t.address===i);s&&(s.bound=!0)}}catch(e){if("M_TERMS_NOT_SIGNED"!==e.errcode)throw e}return n}var H=a(106),G=a(126);let q;!function(e){e.Email="email",e.Phone="msisdn"}(q||(q={}));var K=a(226);function Y(){return u.a.get().idBaseUrl.split("://")[1]}class J{constructor(){i()(this,"sessionId",void 0),i()(this,"submitUrl",void 0),i()(this,"clientSecret",void 0),i()(this,"bind",void 0),i()(this,"makeAddThreepidOnlyRequest",e=>u.a.get().addThreePidOnly({sid:this.sessionId,client_secret:this.clientSecret,auth:e})),this.clientSecret=u.a.get().generateClientSecret()}addEmailAddress(e){return u.a.get().requestAdd3pidEmailToken(e,this.clientSecret,1).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(c.a)("This email address is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}async bindEmailAddress(e){if(this.bind=!0,await u.a.get().doesServerSupportSeparateAddAndBind()){const t=new V.a,a=await t.getAccessToken();return u.a.get().requestEmailToken(e,this.clientSecret,1,void 0,a).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(c.a)("This email address is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}return this.addEmailAddress(e)}addMsisdn(e,t){return u.a.get().requestAdd3pidMsisdnToken(e,t,this.clientSecret,1).then(e=>(this.sessionId=e.sid,this.submitUrl=e.submit_url,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(c.a)("This phone number is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}async bindMsisdn(e,t){if(this.bind=!0,await u.a.get().doesServerSupportSeparateAddAndBind()){const a=new V.a,n=await a.getAccessToken();return u.a.get().requestMsisdnToken(e,t,this.clientSecret,1,void 0,n).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_IN_USE"===e.errcode?e.message=Object(c.a)("This phone number is already in use"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}return this.addMsisdn(e,t)}async checkEmailLinkClicked(){try{if(await u.a.get().doesServerSupportSeparateAddAndBind())if(this.bind){const e=new V.a,t=await e.getAccessToken();await u.a.get().bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:Y(),id_access_token:t})}else try{return void await this.makeAddThreepidOnlyRequest()}catch(e){if(401!==e.httpStatus||!e.data||!e.data.flows)throw e;const t={[P.c.PHASE_PREAUTH]:{title:Object(c.a)("Use Single Sign On to continue"),body:Object(c.a)("Confirm adding this email address by using Single Sign On to prove your identity."),continueText:Object(c.a)("Single Sign On"),continueKind:"primary"},[P.c.PHASE_POSTAUTH]:{title:Object(c.a)("Confirm adding email"),body:Object(c.a)("Click the button below to confirm adding this email address."),continueText:Object(c.a)("Confirm"),continueKind:"primary"}},{finished:a}=g.a.createDialog(K.a,{title:Object(c.a)("Add Email Address"),matrixClient:u.a.get(),authData:e.data,makeRequest:this.makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[P.c.LOGIN_TYPE]:t,[P.c.UNSTABLE_LOGIN_TYPE]:t}});return a}else await u.a.get().addThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:Y()},this.bind)}catch(e){throw 401===e.httpStatus?e.message=Object(c.a)("Failed to verify email address: make sure you clicked the link in the email"):e.httpStatus&&(e.message+=` (Status ${e.httpStatus})`),e}}async haveMsisdnToken(e){const t=new V.a,a=await u.a.get().doesServerSupportSeparateAddAndBind();let n;if(this.submitUrl)n=await u.a.get().submitMsisdnTokenOtherUrl(this.submitUrl,this.sessionId,this.clientSecret,e);else{if(!this.bind&&a)throw new Error("The add / bind with MSISDN flow is misconfigured");n=await u.a.get().submitMsisdnToken(this.sessionId,this.clientSecret,e,await t.getAccessToken())}if(n.errcode)throw n;if(a)if(this.bind)await u.a.get().bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:Y(),id_access_token:await t.getAccessToken()});else try{return void await this.makeAddThreepidOnlyRequest()}catch(e){if(401!==e.httpStatus||!e.data||!e.data.flows)throw e;const t={[P.c.PHASE_PREAUTH]:{title:Object(c.a)("Use Single Sign On to continue"),body:Object(c.a)("Confirm adding this phone number by using Single Sign On to prove your identity."),continueText:Object(c.a)("Single Sign On"),continueKind:"primary"},[P.c.PHASE_POSTAUTH]:{title:Object(c.a)("Confirm adding phone number"),body:Object(c.a)("Click the button below to confirm adding this phone number."),continueText:Object(c.a)("Confirm"),continueKind:"primary"}},{finished:a}=g.a.createDialog(K.a,{title:Object(c.a)("Add Phone Number"),matrixClient:u.a.get(),authData:e.data,makeRequest:this.makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[P.c.LOGIN_TYPE]:t,[P.c.UNSTABLE_LOGIN_TYPE]:t}});return a}else await u.a.get().addThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:Y()},this.bind)}}var $=a(591);class Q extends s.a.Component{constructor(e){super(e),i()(this,"onRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!0})}),i()(this,"onDontRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!1})}),i()(this,"onActuallyRemove",e=>{e.stopPropagation(),e.preventDefault(),u.a.get().deleteThreePid(this.props.msisdn.medium,this.props.msisdn.address).then(()=>this.props.onRemoved(this.props.msisdn)).catch(e=>{d.a.error("Unable to remove contact information: "+e),g.a.createDialog(v.a,{title:Object(c.a)("Unable to remove contact information"),description:e&&e.message?e.message:Object(c.a)("Operation failed")})})}),this.state={verifyRemove:!1}}render(){return this.state.verifyRemove?s.a.createElement("div",{className:"mx_ExistingPhoneNumber"},s.a.createElement("span",{className:"mx_ExistingPhoneNumber_promptText"},Object(c.a)("Remove %(phone)s?",{phone:this.props.msisdn.address})),s.a.createElement(b.a,{onClick:this.onActuallyRemove,kind:"danger_sm",className:"mx_ExistingPhoneNumber_confirmBtn"},Object(c.a)("Remove")),s.a.createElement(b.a,{onClick:this.onDontRemove,kind:"link_sm",className:"mx_ExistingPhoneNumber_confirmBtn"},Object(c.a)("Cancel"))):s.a.createElement("div",{className:"mx_ExistingPhoneNumber"},s.a.createElement("span",{className:"mx_ExistingPhoneNumber_address"},"+",this.props.msisdn.address),s.a.createElement(b.a,{onClick:this.onRemove,kind:"danger_sm"},Object(c.a)("Remove")))}}class X extends s.a.Component{constructor(e){super(e),i()(this,"onRemoved",e=>{const t=this.props.msisdns.filter(t=>t!==e);this.props.onMsisdnsChange(t)}),i()(this,"onChangeNewPhoneNumber",e=>{this.setState({newPhoneNumber:e.target.value})}),i()(this,"onChangeNewPhoneNumberCode",e=>{this.setState({newPhoneNumberCode:e.target.value})}),i()(this,"onAddClick",e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.newPhoneNumber)return;const t=this.state.newPhoneNumber,a=this.state.phoneCountry,n=new J;this.setState({verifying:!0,continueDisabled:!0,addTask:n}),n.addMsisdn(a,t).then(e=>{this.setState({continueDisabled:!1,verifyMsisdn:e.msisdn})}).catch(e=>{d.a.error("Unable to add phone number "+t+" "+e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),g.a.createDialog(v.a,{title:Object(c.a)("Error"),description:e&&e.message?e.message:Object(c.a)("Operation failed")})})}),i()(this,"onContinueClick",e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});const t=this.state.newPhoneNumberCode,a=this.state.verifyMsisdn;this.state.addTask.haveMsisdnToken(t).then(e=>{let[t]=e,n=this.state.newPhoneNumber;if(t){const e=[...this.props.msisdns,{address:a,medium:q.Phone}];this.props.onMsisdnsChange(e),n=""}this.setState({addTask:null,continueDisabled:!1,verifying:!1,verifyMsisdn:"",verifyError:null,newPhoneNumber:n,newPhoneNumberCode:""})}).catch(e=>{this.setState({continueDisabled:!1}),"M_THREEPID_AUTH_FAILED"!==e.errcode?(d.a.error("Unable to verify phone number: "+e),g.a.createDialog(v.a,{title:Object(c.a)("Unable to verify phone number."),description:e&&e.message?e.message:Object(c.a)("Operation failed")})):this.setState({verifyError:Object(c.a)("Incorrect verification code")})})}),i()(this,"onCountryChanged",e=>{this.setState({phoneCountry:e.iso2})}),this.state={verifying:!1,verifyError:null,verifyMsisdn:"",addTask:null,continueDisabled:!1,phoneCountry:"",newPhoneNumber:"",newPhoneNumberCode:""}}render(){const e=this.props.msisdns.map(e=>s.a.createElement(Q,{msisdn:e,onRemoved:this.onRemoved,key:e.address}));let t=s.a.createElement(b.a,{onClick:this.onAddClick,kind:"primary"},Object(c.a)("Add"));if(this.state.verifying){const e=this.state.verifyMsisdn;t=s.a.createElement("div",null,s.a.createElement("div",null,Object(c.a)("A text message has been sent to +%(msisdn)s. Please enter the verification code it contains.",{msisdn:e}),s.a.createElement("br",null),this.state.verifyError),s.a.createElement("form",{onSubmit:this.onContinueClick,autoComplete:"off",noValidate:!0},s.a.createElement(m.a,{type:"text",label:Object(c.a)("Verification code"),autoComplete:"off",disabled:this.state.continueDisabled,value:this.state.newPhoneNumberCode,onChange:this.onChangeNewPhoneNumberCode}),s.a.createElement(b.a,{onClick:this.onContinueClick,kind:"primary",disabled:this.state.continueDisabled||0===this.state.newPhoneNumberCode.length},Object(c.a)("Continue"))))}const a=s.a.createElement($.a,{onOptionChange:this.onCountryChanged,className:"mx_PhoneNumbers_country",value:this.state.phoneCountry,disabled:this.state.verifying,isSmall:!0,showPrefix:!0});return s.a.createElement("div",{className:"mx_PhoneNumbers"},e,s.a.createElement("form",{onSubmit:this.onAddClick,autoComplete:"off",noValidate:!0,className:"mx_PhoneNumbers_new"},s.a.createElement("div",{className:"mx_PhoneNumbers_input"},s.a.createElement(m.a,{type:"text",label:Object(c.a)("Phone Number"),autoComplete:"off",disabled:this.state.verifying,prefixComponent:a,value:this.state.newPhoneNumber,onChange:this.onChangeNewPhoneNumber}))),t)}}var Z=a(295);class ee extends s.a.Component{constructor(e){super(e),i()(this,"onRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!0})}),i()(this,"onDontRemove",e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!1})}),i()(this,"onActuallyRemove",e=>{e.stopPropagation(),e.preventDefault(),u.a.get().deleteThreePid(this.props.email.medium,this.props.email.address).then(()=>this.props.onRemoved(this.props.email)).catch(e=>{d.a.error("Unable to remove contact information: "+e),g.a.createDialog(v.a,{title:Object(c.a)("Unable to remove contact information"),description:e&&e.message?e.message:Object(c.a)("Operation failed")})})}),this.state={verifyRemove:!1}}render(){return this.state.verifyRemove?s.a.createElement("div",{className:"mx_ExistingEmailAddress"},s.a.createElement("span",{className:"mx_ExistingEmailAddress_promptText"},Object(c.a)("Remove %(email)s?",{email:this.props.email.address})),s.a.createElement(b.a,{onClick:this.onActuallyRemove,kind:"danger_sm",className:"mx_ExistingEmailAddress_confirmBtn"},Object(c.a)("Remove")),s.a.createElement(b.a,{onClick:this.onDontRemove,kind:"link_sm",className:"mx_ExistingEmailAddress_confirmBtn"},Object(c.a)("Cancel"))):s.a.createElement("div",{className:"mx_ExistingEmailAddress"},s.a.createElement("span",{className:"mx_ExistingEmailAddress_email"},this.props.email.address),s.a.createElement(b.a,{onClick:this.onRemove,kind:"danger_sm"},Object(c.a)("Remove")))}}class te extends s.a.Component{constructor(e){super(e),i()(this,"onRemoved",e=>{const t=this.props.emails.filter(t=>t!==e);this.props.onEmailsChange(t)}),i()(this,"onChangeNewEmailAddress",e=>{this.setState({newEmailAddress:e.target.value})}),i()(this,"onAddClick",e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.newEmailAddress)return;const t=this.state.newEmailAddress;if(!Z.a(t))return void g.a.createDialog(v.a,{title:Object(c.a)("Invalid Email Address"),description:Object(c.a)("This doesn't appear to be a valid email address")});const a=new J;this.setState({verifying:!0,continueDisabled:!0,addTask:a}),a.addEmailAddress(t).then(()=>{this.setState({continueDisabled:!1})}).catch(e=>{d.a.error("Unable to add email address "+t+" "+e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),g.a.createDialog(v.a,{title:Object(c.a)("Unable to add email address"),description:e&&e.message?e.message:Object(c.a)("Operation failed")})})}),i()(this,"onContinueClick",e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0}),this.state.addTask.checkEmailLinkClicked().then(e=>{let[t]=e,a=this.state.newEmailAddress;if(t){const e=this.state.newEmailAddress,t=[...this.props.emails,{address:e,medium:q.Email}];this.props.onEmailsChange(t),a=""}this.setState({addTask:null,continueDisabled:!1,verifying:!1,newEmailAddress:a})}).catch(e=>{this.setState({continueDisabled:!1}),"M_THREEPID_AUTH_FAILED"===e.errcode?g.a.createDialog(v.a,{title:Object(c.a)("Your email address hasn't been verified yet"),description:Object(c.a)("Click the link in the email you received to verify and then click continue again.")}):(d.a.error("Unable to verify email address: ",e),g.a.createDialog(v.a,{title:Object(c.a)("Unable to verify email address."),description:e&&e.message?e.message:Object(c.a)("Operation failed")}))})}),this.state={verifying:!1,addTask:null,continueDisabled:!1,newEmailAddress:""}}render(){const e=this.props.emails.map(e=>s.a.createElement(ee,{email:e,onRemoved:this.onRemoved,key:e.address}));let t=s.a.createElement(b.a,{onClick:this.onAddClick,kind:"primary"},Object(c.a)("Add"));return this.state.verifying&&(t=s.a.createElement("div",null,s.a.createElement("div",null,Object(c.a)("We've sent you an email to verify your address. Please follow the instructions there and then click the button below.")),s.a.createElement(b.a,{onClick:this.onContinueClick,kind:"primary",disabled:this.state.continueDisabled},Object(c.a)("Continue")))),s.a.createElement("div",{className:"mx_EmailAddresses"},e,s.a.createElement("form",{onSubmit:this.onAddClick,autoComplete:"off",noValidate:!0,className:"mx_EmailAddresses_new"},s.a.createElement(m.a,{type:"text",label:Object(c.a)("Email Address"),autoComplete:"off",disabled:this.state.verifying,value:this.state.newEmailAddress,onChange:this.onChangeNewEmailAddress}),t))}}class ae extends s.a.Component{constructor(e){super(e),i()(this,"onRevokeClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!1,label:"revoke",errorTitle:Object(c.a)("Unable to revoke sharing for email address")})}),i()(this,"onShareClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!0,label:"share",errorTitle:Object(c.a)("Unable to share email address")})}),i()(this,"onContinueClick",async e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});try{await this.state.addTask.checkEmailLinkClicked(),this.setState({addTask:null,continueDisabled:!1,verifying:!1})}catch(e){this.setState({continueDisabled:!1}),"M_THREEPID_AUTH_FAILED"===e.errcode?g.a.createDialog(v.a,{title:Object(c.a)("Your email address hasn't been verified yet"),description:Object(c.a)("Click the link in the email you received to verify and then click continue again.")}):(d.a.error("Unable to verify email address: "+e),g.a.createDialog(v.a,{title:Object(c.a)("Unable to verify email address."),description:e&&e.message?e.message:Object(c.a)("Operation failed")}))}});const{bound:t}=e.email;this.state={verifying:!1,addTask:null,continueDisabled:!1,bound:t}}UNSAFE_componentWillReceiveProps(e){const{bound:t}=e.email;this.setState({bound:t})}async changeBinding(e){let{bind:t,label:a,errorTitle:n}=e;if(!await u.a.get().doesServerSupportSeparateAddAndBind())return this.changeBindingTangledAddBind({bind:t,label:a,errorTitle:n});const{medium:i,address:r}=this.props.email;try{if(t){const e=new J;this.setState({verifying:!0,continueDisabled:!0,addTask:e}),await e.bindEmailAddress(r),this.setState({continueDisabled:!1})}else await u.a.get().unbindThreePid(i,r);this.setState({bound:t})}catch(e){d.a.error(`Unable to ${a} email address ${r} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),g.a.createDialog(v.a,{title:n,description:e&&e.message?e.message:Object(c.a)("Operation failed")})}}async changeBindingTangledAddBind(e){let{bind:t,label:a,errorTitle:n}=e;const{medium:i,address:r}=this.props.email,s=new J;this.setState({verifying:!0,continueDisabled:!0,addTask:s});try{await u.a.get().deleteThreePid(i,r),t?await s.bindEmailAddress(r):await s.addEmailAddress(r),this.setState({continueDisabled:!1,bound:t})}catch(e){d.a.error(`Unable to ${a} email address ${r} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),g.a.createDialog(v.a,{title:n,description:e&&e.message?e.message:Object(c.a)("Operation failed")})}}render(){const{address:e}=this.props.email,{verifying:t,bound:a}=this.state;let n;return n=t?s.a.createElement("span",null,Object(c.a)("Verify the link in your inbox"),s.a.createElement(b.a,{className:"mx_ExistingEmailAddress_confirmBtn",kind:"primary_sm",onClick:this.onContinueClick,disabled:this.state.continueDisabled},Object(c.a)("Complete"))):a?s.a.createElement(b.a,{className:"mx_ExistingEmailAddress_confirmBtn",kind:"danger_sm",onClick:this.onRevokeClick},Object(c.a)("Revoke")):s.a.createElement(b.a,{className:"mx_ExistingEmailAddress_confirmBtn",kind:"primary_sm",onClick:this.onShareClick},Object(c.a)("Share")),s.a.createElement("div",{className:"mx_ExistingEmailAddress"},s.a.createElement("span",{className:"mx_ExistingEmailAddress_email"},e),n)}}class ne extends s.a.Component{render(){let e;return e=this.props.emails.length>0?this.props.emails.map(e=>s.a.createElement(ae,{email:e,key:e.address})):s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Discovery options will appear once you have added an email above.")),s.a.createElement("div",{className:"mx_EmailAddresses"},e)}}class ie extends s.a.Component{constructor(e){super(e),i()(this,"onRevokeClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!1,label:"revoke",errorTitle:Object(c.a)("Unable to revoke sharing for phone number")})}),i()(this,"onShareClick",e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!0,label:"share",errorTitle:Object(c.a)("Unable to share phone number")})}),i()(this,"onVerificationCodeChange",e=>{this.setState({verificationCode:e.target.value})}),i()(this,"onContinueClick",async e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});const t=this.state.verificationCode;try{await this.state.addTask.haveMsisdnToken(t),this.setState({addTask:null,continueDisabled:!1,verifying:!1,verifyError:null,verificationCode:""})}catch(e){this.setState({continueDisabled:!1}),"M_THREEPID_AUTH_FAILED"!==e.errcode?(d.a.error("Unable to verify phone number: "+e),g.a.createDialog(v.a,{title:Object(c.a)("Unable to verify phone number."),description:e&&e.message?e.message:Object(c.a)("Operation failed")})):this.setState({verifyError:Object(c.a)("Incorrect verification code")})}});const{bound:t}=e.msisdn;this.state={verifying:!1,verificationCode:"",addTask:null,continueDisabled:!1,bound:t,verifyError:null}}UNSAFE_componentWillReceiveProps(e){const{bound:t}=e.msisdn;this.setState({bound:t})}async changeBinding(e){let{bind:t,label:a,errorTitle:n}=e;if(!await u.a.get().doesServerSupportSeparateAddAndBind())return this.changeBindingTangledAddBind({bind:t,label:a,errorTitle:n});const{medium:i,address:r}=this.props.msisdn;try{if(t){const e=new J;this.setState({verifying:!0,continueDisabled:!0,addTask:e}),await e.bindMsisdn(null,"+"+r),this.setState({continueDisabled:!1})}else await u.a.get().unbindThreePid(i,r);this.setState({bound:t})}catch(e){d.a.error(`Unable to ${a} phone number ${r} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),g.a.createDialog(v.a,{title:n,description:e&&e.message?e.message:Object(c.a)("Operation failed")})}}async changeBindingTangledAddBind(e){let{bind:t,label:a,errorTitle:n}=e;const{medium:i,address:r}=this.props.msisdn,s=new J;this.setState({verifying:!0,continueDisabled:!0,addTask:s});try{await u.a.get().deleteThreePid(i,r),t?await s.bindMsisdn(null,"+"+r):await s.addMsisdn(null,"+"+r),this.setState({continueDisabled:!1,bound:t})}catch(e){d.a.error(`Unable to ${a} phone number ${r} ${e}`),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),g.a.createDialog(v.a,{title:n,description:e&&e.message?e.message:Object(c.a)("Operation failed")})}}render(){const{address:e}=this.props.msisdn,{verifying:t,bound:a}=this.state;let n;return n=t?s.a.createElement("span",{className:"mx_ExistingPhoneNumber_verification"},s.a.createElement("span",null,Object(c.a)("Please enter verification code sent via text."),s.a.createElement("br",null),this.state.verifyError),s.a.createElement("form",{onSubmit:this.onContinueClick,autoComplete:"off",noValidate:!0},s.a.createElement(m.a,{type:"text",label:Object(c.a)("Verification code"),autoComplete:"off",disabled:this.state.continueDisabled,value:this.state.verificationCode,onChange:this.onVerificationCodeChange}))):a?s.a.createElement(b.a,{className:"mx_ExistingPhoneNumber_confirmBtn",kind:"danger_sm",onClick:this.onRevokeClick},Object(c.a)("Revoke")):s.a.createElement(b.a,{className:"mx_ExistingPhoneNumber_confirmBtn",kind:"primary_sm",onClick:this.onShareClick},Object(c.a)("Share")),s.a.createElement("div",{className:"mx_ExistingPhoneNumber"},s.a.createElement("span",{className:"mx_ExistingPhoneNumber_address"},"+",e),n)}}class re extends s.a.Component{render(){let e;return e=this.props.msisdns.length>0?this.props.msisdns.map(e=>s.a.createElement(ie,{msisdn:e,key:e.address})):s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Discovery options will appear once you have added a phone number above.")),s.a.createElement("div",{className:"mx_PhoneNumbers"},e)}}var se,oe=a(169),ce=a(318),le=a(605),de=a(123),ue=a(110),me=a(121);!function(e){e.Display="display",e.Edit="edit"}(se||(se={}));class he extends s.a.Component{constructor(e){super(e),i()(this,"value",""),i()(this,"placeholder",!1),i()(this,"editableDiv",Object(r.createRef)()),i()(this,"showPlaceholder",e=>{e?(this.editableDiv.current.textContent=this.props.placeholder,this.editableDiv.current.setAttribute("class",this.props.className+" "+this.props.placeholderClassName),this.placeholder=!0,this.value=""):(this.editableDiv.current.textContent=this.value,this.editableDiv.current.setAttribute("class",this.props.className),this.placeholder=!1)}),i()(this,"cancelEdit",()=>{this.setState({phase:se.Display}),this.value=this.props.initialValue,this.showPlaceholder(!this.value),this.onValueChanged(!1),this.editableDiv.current.blur()}),i()(this,"onValueChanged",e=>{this.props.onValueChanged(this.value,e)}),i()(this,"onKeyDown",e=>{this.placeholder&&this.showPlaceholder(!1);switch(Object(me.a)().getAccessibilityAction(e)){case ue.h.Enter:e.stopPropagation(),e.preventDefault()}}),i()(this,"onKeyUp",e=>{e.target.textContent?this.placeholder||(this.value=e.target.textContent):this.showPlaceholder(!0);switch(Object(me.a)().getAccessibilityAction(e)){case ue.h.Escape:this.cancelEdit();break;case ue.h.Enter:this.onFinish(e)}}),i()(this,"onClickDiv",()=>{this.props.editable&&this.setState({phase:se.Edit})}),i()(this,"onFocus",e=>{const t=e.target.childNodes[0];if(t){const a=document.createRange();a.setStart(t,0),a.setEnd(t,e.target.childNodes.length);const n=window.getSelection();n.removeAllRanges(),n.addRange(a)}}),i()(this,"onFinish",(e,t)=>{const a=this,n=Object(me.a)().getAccessibilityAction(e)===ue.h.Enter||t;this.setState({phase:se.Display},()=>{this.value!==this.props.initialValue&&a.onValueChanged(n)})}),i()(this,"onBlur",e=>{window.getSelection().removeAllRanges(),this.props.blurToCancel?this.cancelEdit():this.onFinish(e,this.props.blurToSubmit),this.showPlaceholder(!this.value)}),this.state={phase:se.Display}}UNSAFE_componentWillReceiveProps(e){e.initialValue!==this.props.initialValue&&(this.value=e.initialValue,this.editableDiv.current&&this.showPlaceholder(!this.value))}componentDidMount(){this.value=this.props.initialValue,this.editableDiv.current&&this.showPlaceholder(!this.value)}render(){const{className:e,editable:t,initialValue:a,label:n,labelClassName:i}=this.props;let r;return r=!t||this.state.phase===se.Display&&(n||i)&&!this.value?s.a.createElement("div",{className:e+" "+i,onClick:this.onClickDiv},n||a):s.a.createElement("div",{ref:this.editableDiv,contentEditable:!0,className:e,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onFocus:this.onFocus,onBlur:this.onBlur}),r}}i()(he,"defaultProps",{onValueChanged(){},initialValue:"",label:"",placeholder:"",editable:!0,className:"mx_EditableText",placeholderClassName:"mx_EditableText_placeholder",blurToSubmit:!1});class pe extends s.a.Component{constructor(e){super(e),i()(this,"addThreepid",void 0),i()(this,"onEmailAddressChanged",e=>{this.setState({emailAddress:e})}),i()(this,"onSubmit",()=>{const e=this.state.emailAddress;Z.a(e)?(this.addThreepid=new J,this.addThreepid.addEmailAddress(e).then(()=>{g.a.createDialog(de.a,{title:Object(c.a)("Verification Pending"),description:Object(c.a)("Please check your email and click on the link it contains. Once this is done, click continue."),button:Object(c.a)("Continue"),onFinished:this.onEmailDialogFinished})},t=>{this.setState({emailBusy:!1}),d.a.error("Unable to add email address "+e+" "+t),g.a.createDialog(v.a,{title:Object(c.a)("Unable to add email address"),description:t&&t.message?t.message:Object(c.a)("Operation failed")})}),this.setState({emailBusy:!0})):g.a.createDialog(v.a,{title:Object(c.a)("Invalid Email Address"),description:Object(c.a)("This doesn't appear to be a valid email address")})}),i()(this,"onCancelled",()=>{this.props.onFinished(!1)}),i()(this,"onEmailDialogFinished",e=>{e?this.verifyEmailAddress():this.setState({emailBusy:!1})}),this.state={emailAddress:"",emailBusy:!1}}verifyEmailAddress(){this.addThreepid.checkEmailLinkClicked().then(()=>{this.props.onFinished(!0)},e=>{if(this.setState({emailBusy:!1}),"M_THREEPID_AUTH_FAILED"==e.errcode){const e=Object(c.a)("Unable to verify email address.")+" "+Object(c.a)("Please check your email and click on the link it contains. Once this is done, click continue.");g.a.createDialog(de.a,{title:Object(c.a)("Verification Pending"),description:e,button:Object(c.a)("Continue"),onFinished:this.onEmailDialogFinished})}else d.a.error("Unable to verify email address: "+e),g.a.createDialog(v.a,{title:Object(c.a)("Unable to verify email address."),description:e&&e.message?e.message:Object(c.a)("Operation failed")})})}render(){const e=this.state.emailBusy?s.a.createElement(R.a,null):s.a.createElement(he,{initialValue:this.state.emailAddress,className:"mx_SetEmailDialog_email_input",placeholder:Object(c.a)("Email address"),placeholderClassName:"mx_SetEmailDialog_email_input_placeholder",blurToCancel:!1,onValueChanged:this.onEmailAddressChanged});return s.a.createElement(A.a,{className:"mx_SetEmailDialog",onFinished:this.onCancelled,title:this.props.title,contentId:"mx_Dialog_content"},s.a.createElement("div",{className:"mx_Dialog_content"},s.a.createElement("p",{id:"mx_Dialog_content"},Object(c.a)("This will allow you to reset your password and receive notifications.")),e),s.a.createElement("div",{className:"mx_Dialog_buttons"},s.a.createElement("input",{className:"mx_Dialog_primary",type:"submit",value:Object(c.a)("Continue"),onClick:this.onSubmit}),s.a.createElement("input",{type:"submit",value:Object(c.a)("Skip"),onClick:this.onCancelled})))}}var ge;!function(e){e.Edit="edit",e.Uploading="uploading",e.Error="error"}(ge||(ge={}));class ve extends s.a.Component{constructor(e){super(e),i()(this,"onExportE2eKeysClicked",()=>{g.a.createDialogAsync(a.e(6).then(a.bind(null,1515)),{matrixClient:u.a.get()})}),i()(this,"onChangeOldPassword",e=>{this.setState({oldPassword:e.target.value})}),i()(this,"onOldPasswordValidate",async e=>{const t=await this.validateOldPasswordRules(e);return this.markFieldValid("field_old_password",t.valid),t}),i()(this,"validateOldPasswordRules",Object(oe.a)({rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(c.a)("Passwords can't be empty")}]})),i()(this,"onChangeNewPassword",e=>{this.setState({newPassword:e.target.value})}),i()(this,"onNewPasswordValidate",e=>{this.markFieldValid("field_new_password",e.valid)}),i()(this,"onChangeNewPasswordConfirm",e=>{this.setState({newPasswordConfirm:e.target.value})}),i()(this,"onNewPasswordConfirmValidate",async e=>{const t=await this.validatePasswordConfirmRules(e);return this.markFieldValid("field_new_password_confirm",t.valid),t}),i()(this,"validatePasswordConfirmRules",Object(oe.a)({rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(c.a)("Confirm password")},{key:"match",test(e){let{value:t}=e;return!t||t===this.state.newPassword},invalid:()=>Object(c.a)("Passwords don't match")}]})),i()(this,"onClickChange",async e=>{e.preventDefault();if(!await this.verifyFieldsBeforeSubmit())return;const t=this.state.oldPassword,a=this.state.newPassword,n=this.state.newPasswordConfirm,i=this.checkPassword(t,a,n);if(!i)return this.onChangePassword(t,a);this.props.onError(i)}),this.state={fieldValid:{},phase:ge.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""}}async onChangePassword(e,t){const a=u.a.get(),n=await a.doesServerSupportLogoutDevices(),i=(await a.getDevices()).devices.length>1;if(i&&!n&&this.props.confirm){const{finished:e}=g.a.createDialog(de.a,{title:Object(c.a)("Warning!"),description:s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("Changing your password on this homeserver will cause all of your other devices to be signed out. This will delete the message encryption keys stored on them, and may make encrypted chat history unreadable.")),s.a.createElement("p",null,Object(c.a)("If you want to retain access to your chat history in encrypted rooms you should first export your room keys and re-import them afterwards.")),s.a.createElement("p",null,Object(c.a)("You can also ask your homeserver admin to upgrade the server to change this behaviour."))),button:Object(c.a)("Continue"),extraButtons:[s.a.createElement("button",{key:"exportRoomKeys",className:"mx_Dialog_primary",onClick:this.onExportE2eKeysClicked},Object(c.a)("Export E2E room keys"))]}),[t]=await e;if(!t)return}this.changePassword(a,e,t,n,i)}changePassword(e,t,a,n,i){const r={type:"m.login.password",identifier:{type:"m.id.user",user:e.credentials.userId},user:e.credentials.userId,password:t};this.setState({phase:ge.Uploading});const s=!n&&void 0,o=!n&&i;e.setPassword(r,a,s).then(()=>{if(this.props.shouldAskForEmail)return this.optionallySetEmail().then(e=>{this.props.onFinished({didSetEmail:e,didLogoutOutOtherDevices:o})});this.props.onFinished({didLogoutOutOtherDevices:o})},e=>{this.props.onError(e)}).finally(()=>{this.setState({phase:ge.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""})})}checkPassword(e,t,a){return t!==a?{error:Object(c.a)("New passwords don't match")}:t&&0!==t.length?void 0:{error:Object(c.a)("Passwords can't be empty")}}optionallySetEmail(){return g.a.createDialog(pe,{title:Object(c.a)("Do you want to set an email address?")}).finished.then(e=>{let[t]=e;return t})}markFieldValid(e,t){const{fieldValid:a}=this.state;a[e]=t,this.setState({fieldValid:a})}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=["field_old_password","field_new_password","field_new_password_confirm"];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise(e=>this.setState({},e)),this.allFieldsValid())return!0;const a=this.findFirstInvalidField(t);return!a||(a.focus(),a.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){const e=Object.keys(this.state.fieldValid);for(let t=0;t<e.length;++t)if(!this.state.fieldValid[e[t]])return!1;return!0}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}render(){const e=this.props.rowClassName,t=this.props.buttonClassName;switch(this.state.phase){case ge.Edit:return s.a.createElement("form",{className:this.props.className,onSubmit:this.onClickChange},s.a.createElement("div",{className:e},s.a.createElement(m.a,{ref:e=>this.field_old_password=e,type:"password",label:Object(c.a)("Current password"),value:this.state.oldPassword,onChange:this.onChangeOldPassword,onValidate:this.onOldPasswordValidate})),s.a.createElement("div",{className:e},s.a.createElement(ce.a,{fieldRef:e=>this.field_new_password=e,type:"password",label:Object(c.c)("New Password"),minScore:le.a,value:this.state.newPassword,autoFocus:this.props.autoFocusNewPasswordInput,onChange:this.onChangeNewPassword,onValidate:this.onNewPasswordValidate,autoComplete:"new-password"})),s.a.createElement("div",{className:e},s.a.createElement(m.a,{ref:e=>this.field_new_password_confirm=e,type:"password",label:Object(c.a)("Confirm password"),value:this.state.newPasswordConfirm,onChange:this.onChangeNewPasswordConfirm,onValidate:this.onNewPasswordConfirmValidate,autoComplete:"new-password"})),s.a.createElement(b.a,{className:t,kind:this.props.buttonKind,onClick:this.onClickChange},this.props.buttonLabel||Object(c.a)("Change Password")));case ge.Uploading:return s.a.createElement("div",{className:"mx_Dialog_content"},s.a.createElement(R.a,null))}}}i()(ve,"defaultProps",{onFinished(){},onError(){},confirm:!0});var fe=a(167);class be extends s.a.Component{constructor(e){super(e),i()(this,"togglePolicy",e=>{const t=Object(fe.a)(this.state.policies);t[e].checked=!t[e].checked,this.setState({policies:t})}),i()(this,"onContinue",()=>{!!this.state.policies.some(e=>!e.checked)||(this.setState({busy:!0}),this.props.onFinished(this.state.policies.map(e=>e.url)))}),this.state={policies:[],busy:!1}}componentDidMount(){const e=[];for(const t of this.props.policiesAndServicePairs){const a=Object.values(t.policies);for(const t of a){const a=Object(c.j)(Object.keys(t).filter(e=>"version"!==e)),n={checked:!1,url:t[a].url,name:t[a].name};e.push(n)}}this.setState({policies:e})}renderCheckboxes(){const e=[];for(let t=0;t<this.state.policies.length;t++){const a=this.state.policies[t],n=Object(c.a)("Accept <policyLink /> to continue:",{},{policyLink:()=>s.a.createElement("a",{href:a.url,rel:"noreferrer noopener",target:"_blank"},a.name,s.a.createElement("span",{className:"mx_InlineTermsAgreement_link"}))});e.push(s.a.createElement("div",{key:t,className:"mx_InlineTermsAgreement_cbContainer"},s.a.createElement("div",null,n),s.a.createElement("div",{className:"mx_InlineTermsAgreement_checkbox"},s.a.createElement(M.b,{onChange:()=>this.togglePolicy(t),checked:a.checked},Object(c.a)("Accept")))))}return e}render(){const e=!!this.state.policies.some(e=>!e.checked);return s.a.createElement("div",null,this.props.introElement,this.renderCheckboxes(),s.a.createElement(b.a,{onClick:this.onContinue,disabled:e||this.state.busy,kind:"primary_sm"},Object(c.a)("Continue")))}}var ye=a(225),Ee=a.n(ye),_e=a(396),we=a(352),Se=a(176);class Oe extends s.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",e=>{"id_server_changed"===e.action&&this.setState({currentClientIdServer:u.a.get().getIdentityServerUrl()})}),i()(this,"onIdentityServerChanged",e=>{const t=e.target.value;this.setState({idServer:t})}),i()(this,"getTooltip",()=>this.state.checking?s.a.createElement("div",null,s.a.createElement(Se.a,null),Object(c.a)("Checking server")):this.state.error?s.a.createElement("span",{className:"warning"},this.state.error):null),i()(this,"idServerChangeEnabled",()=>!!this.state.idServer&&!this.state.busy),i()(this,"saveIdServer",e=>{u.a.get().setAccountData("m.identity_server",{base_url:e}),this.setState({busy:!1,error:null,currentClientIdServer:e,idServer:""})}),i()(this,"checkIdServer",async e=>{e.preventDefault();const{idServer:t,currentClientIdServer:a}=this.state;this.setState({busy:!0,checking:!0,error:null});const n=Object(z.b)(t);let i=await async function(e){if("https:"!==Ee.a.parse(e).protocol)return Object(c.a)("Identity server URL must be HTTPS");try{const t=await fetch(e+"/_matrix/identity/api/v1");return t.ok?null:t.status<200||t.status>=300?Object(c.a)("Not a valid identity server (status code %(code)s)",{code:t.status}):Object(c.a)("Could not connect to identity server")}catch(e){return Object(c.a)("Could not connect to identity server")}}(n);if(!i)try{this.setState({checking:!1});const e=new V.a(n);await e.getAccessToken();let i=!0;if(!await Object(_e.b)(n)){const[e]=await this.showNoTermsWarning(n);i=e}if(i&&a&&n!==a){const[e]=await this.showServerChangeWarning({title:Object(c.a)("Change identity server"),unboundMessage:Object(c.a)("Disconnect from the identity server <current /> and connect to <new /> instead?",{},{current:e=>s.a.createElement("b",null,Object(z.a)(a)),new:e=>s.a.createElement("b",null,Object(z.a)(t))}),button:Object(c.a)("Continue")});i=e}i&&this.saveIdServer(n)}catch(e){d.a.error(e),i=Object(c.a)("Terms of service not accepted or the identity server is invalid.")}this.setState({busy:!1,checking:!1,error:i,currentClientIdServer:u.a.get().getIdentityServerUrl()})}),i()(this,"onDisconnectClicked",async()=>{this.setState({disconnectBusy:!0});try{const[e]=await this.showServerChangeWarning({title:Object(c.a)("Disconnect identity server"),unboundMessage:Object(c.a)("Disconnect from the identity server <idserver />?",{},{idserver:e=>s.a.createElement("b",null,Object(z.a)(this.state.currentClientIdServer))}),button:Object(c.a)("Disconnect")});e&&this.disconnectIdServer()}finally{this.setState({disconnectBusy:!1})}}),i()(this,"disconnectIdServer",()=>{u.a.get().setAccountData("m.identity_server",{base_url:null});let e="";Object(_e.c)()&&(e=Object(z.a)(Object(_e.c)())),this.setState({busy:!1,error:null,currentClientIdServer:u.a.get().getIdentityServerUrl(),idServer:e})});let t="";!u.a.get().getIdentityServerUrl()&&Object(_e.c)()&&(t=Object(z.a)(Object(_e.c)())),this.state={defaultIdServer:t,currentClientIdServer:u.a.get().getIdentityServerUrl(),idServer:"",error:null,busy:!1,disconnectBusy:!1,checking:!1}}componentDidMount(){this.dispatcherRef=L.a.register(this.onAction)}componentWillUnmount(){L.a.unregister(this.dispatcherRef)}showNoTermsWarning(e){const{finished:t}=g.a.createDialog(de.a,{title:Object(c.a)("Identity server has no terms of service"),description:s.a.createElement("div",null,s.a.createElement("span",{className:"warning"},Object(c.a)("The identity server you have chosen does not have any terms of service.")),s.a.createElement("span",null," ",Object(c.a)("Only continue if you trust the owner of the server."))),button:Object(c.a)("Continue")});return t}async showServerChangeWarning(e){let{title:t,unboundMessage:a,button:n}=e;const{currentClientIdServer:i}=this.state;let r=[],o=!0;try{r=await Object(we.b)(W(u.a.get()),Promise.reject(new Error("Timeout attempting to reach identity server")),1e4)}catch(e){o=!1,d.a.warn(`Unable to reach identity server at ${i} to check for 3PIDs during IS change flow`),d.a.warn(e)}const l=r.filter(e=>e.bound);let m,h=!1;const p={idserver:e=>s.a.createElement("b",null,Object(z.a)(i)),b:e=>s.a.createElement("b",null,e)};o?l.length?(m=s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("You are still <b>sharing your personal data</b> on the identity server <idserver />.",{},p)),s.a.createElement("p",null,Object(c.a)("We recommend that you remove your email addresses and phone numbers from the identity server before disconnecting."))),h=!0,n=Object(c.a)("Disconnect anyway")):m=a:(m=s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("You should <b>remove your personal data</b> from identity server <idserver /> before disconnecting. Unfortunately, identity server <idserver /> is currently offline or cannot be reached.",{},p)),s.a.createElement("p",null,Object(c.a)("You should:")),s.a.createElement("ul",null,s.a.createElement("li",null,Object(c.a)("check your browser plugins for anything that might block the identity server (such as Privacy Badger)")),s.a.createElement("li",null,Object(c.a)("contact the administrators of identity server <idserver />",{},{idserver:p.idserver})),s.a.createElement("li",null,Object(c.a)("wait and try again later")))),h=!0,n=Object(c.a)("Disconnect anyway"));const{finished:v}=g.a.createDialog(de.a,{title:t,description:m,button:n,cancelButton:Object(c.a)("Go back"),danger:h});return v}render(){const e=this.state.currentClientIdServer;let t,a,n;if(e?(t=Object(c.a)("Identity server (%(server)s)",{server:Object(z.a)(e)}),a=Object(c.a)("You are currently using <server></server> to discover and be discoverable by existing contacts you know. You can change your identity server below.",{},{server:t=>s.a.createElement("b",null,Object(z.a)(e))}),this.props.missingTerms&&(a=Object(c.a)("If you don't want to use <server /> to discover and be discoverable by existing contacts you know, enter another identity server below.",{},{server:t=>s.a.createElement("b",null,Object(z.a)(e))}))):(t=Object(c.a)("Identity server"),a=Object(c.a)("You are not currently using an identity server. To discover and be discoverable by existing contacts you know, add one below.")),e){let e=Object(c.a)("Disconnect"),t=Object(c.a)("Disconnecting from your identity server will mean you won't be discoverable by other users and you won't be able to invite others by email or phone.");this.props.missingTerms&&(t=Object(c.a)("Using an identity server is optional. If you choose not to use an identity server, you won't be discoverable by other users and you won't be able to invite others by email or phone."),e=Object(c.a)("Do not use an identity server")),this.state.disconnectBusy&&(e=s.a.createElement(Se.a,null)),n=s.a.createElement("div",null,s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},t),s.a.createElement(b.a,{onClick:this.onDisconnectClicked,kind:"danger_sm"},e))}return s.a.createElement("form",{className:"mx_SetIdServer",onSubmit:this.checkIdServer},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},t),s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},a),s.a.createElement(m.a,{label:Object(c.a)("Enter a new identity server"),type:"text",autoComplete:"off",placeholder:this.state.defaultIdServer,value:this.state.idServer,onChange:this.onIdentityServerChanged,tooltipContent:this.getTooltip(),tooltipClassName:"mx_SetIdServer_tooltip",disabled:this.state.busy,forceValidity:!this.state.error&&null}),s.a.createElement(b.a,{type:"submit",kind:"primary_sm",onClick:this.checkIdServer,disabled:!this.idServerChangeEnabled()},Object(c.a)("Change")),n)}}var Ce=a(253),xe=a(347);class ke extends s.a.Component{constructor(e){super(e),i()(this,"onProvisioningToggled",()=>{const e=this.state.provisioningEnabled;C.b.setValue("integrationProvisioning",null,H.a.ACCOUNT,!e).catch(t=>{d.a.error("Error changing integration manager provisioning"),d.a.error(t),this.setState({provisioningEnabled:e})}),this.setState({provisioningEnabled:!e})});const t=Ce.a.sharedInstance().getPrimaryManager();this.state={currentManager:t,provisioningEnabled:C.b.getValue("integrationProvisioning")}}render(){const e=this.state.currentManager;let t,a;return e?(t=`(${e.name})`,a=Object(c.a)("Use an integration manager <b>(%(serverName)s)</b> to manage bots, widgets, and sticker packs.",{serverName:e.name},{b:e=>s.a.createElement("b",null,e)})):a=Object(c.a)("Use an integration manager to manage bots, widgets, and sticker packs."),s.a.createElement("div",{className:"mx_SetIntegrationManager"},s.a.createElement("div",{className:"mx_SettingsFlag"},s.a.createElement("div",{className:"mx_SetIntegrationManager_heading_manager"},s.a.createElement("span",{className:"mx_SettingsTab_heading"},Object(c.a)("Manage integrations")),s.a.createElement("span",{className:"mx_SettingsTab_subheading"},t)),s.a.createElement(xe.a,{checked:this.state.provisioningEnabled,disabled:!1,onChange:this.onProvisioningToggled})),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},a),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Integration managers receive configuration data, and can modify widgets, send room invites, and set power levels on your behalf.")))}}var je=a(193);function Re(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ie(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Re(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class Te extends s.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",e=>{"id_server_changed"===e.action&&(this.setState({haveIdServer:Boolean(u.a.get().getIdentityServerUrl())}),this.getThreepidState())}),i()(this,"onEmailsChange",e=>{this.setState({emails:e})}),i()(this,"onMsisdnsChange",e=>{this.setState({msisdns:e})}),i()(this,"onLanguageChange",e=>{if(this.state.language===e)return;C.b.setValue("language",null,H.a.DEVICE,e),this.setState({language:e});const t=j.a.get();t&&(t.setLanguage([e]),t.reload())}),i()(this,"onSpellCheckLanguagesChange",e=>{var t;this.setState({spellCheckLanguages:e}),null===(t=j.a.get())||void 0===t||t.setSpellCheckLanguages(e)}),i()(this,"onSpellCheckEnabledChange",e=>{var t;this.setState({spellCheckEnabled:e}),null===(t=j.a.get())||void 0===t||t.setSpellCheckEnabled(e)}),i()(this,"onPasswordChangeError",e=>{let t=e.error||e.message||"";403===e.httpStatus?t=Object(c.a)("Failed to change password. Is your password correct?"):t||(t+=` (HTTP status ${e.httpStatus})`),d.a.error("Failed to change password: "+t),g.a.createDialog(v.a,{title:Object(c.a)("Error"),description:t})}),i()(this,"onPasswordChanged",e=>{let{didLogoutOutOtherDevices:t}=e,a=Object(c.a)("Your password was successfully changed.");t&&(a+=" "+Object(c.a)("You will not receive push notifications on other devices until you sign back in to them.")),g.a.createDialog(v.a,{title:Object(c.a)("Success"),description:a})}),i()(this,"onDeactivateClicked",()=>{g.a.createDialog(F,{onFinished:e=>{e&&this.props.closeSettingsFn()}})}),this.state={language:c.e(),spellCheckEnabled:!1,spellCheckLanguages:[],haveIdServer:Boolean(u.a.get().getIdentityServerUrl()),serverSupportsSeparateAddAndBind:null,idServerHasUnsignedTerms:!1,requiredPolicyInfo:{hasTerms:!1,policiesAndServices:null,agreedUrls:null,resolve:null},emails:[],msisdns:[],loading3pids:!0,canChangePassword:!1,idServerName:null},this.dispatcherRef=L.a.register(this.onAction)}async UNSAFE_componentWillMount(){const e=u.a.get(),t=await e.doesServerSupportSeparateAddAndBind(),a=(await e.getCapabilities())["m.change_password"],n=!a||!1!==a.enabled;this.setState({serverSupportsSeparateAddAndBind:t,canChangePassword:n}),this.getThreepidState()}async componentDidMount(){const e=j.a.get(),[t,a]=await Promise.all([e.getSpellCheckEnabled(),e.getSpellCheckLanguages()]);a&&this.setState({spellCheckEnabled:t,spellCheckLanguages:a})}componentWillUnmount(){L.a.unregister(this.dispatcherRef)}async getThreepidState(){const e=u.a.get();this.checkTerms();let t=[];try{t=await W(e)}catch(e){const t=u.a.get().getIdentityServerUrl();d.a.warn(`Unable to reach identity server at ${t} to check for 3PIDs bindings in Settings`),d.a.warn(e)}this.setState({emails:t.filter(e=>"email"===e.medium),msisdns:t.filter(e=>"msisdn"===e.medium),loading3pids:!1})}async checkTerms(){if(!this.state.haveIdServer)return void this.setState({idServerHasUnsignedTerms:!1});const e=u.a.get().getIdentityServerUrl(),t=new V.a;try{const a=await t.getAccessToken({check:!1});await Object(B.d)([new B.a(l.a.IS,e,a)],(t,a,n)=>new Promise((n,i)=>{this.setState({idServerName:Object(z.a)(e),requiredPolicyInfo:{hasTerms:!0,policiesAndServices:t,agreedUrls:a,resolve:n}})})),this.setState({requiredPolicyInfo:Ie(Ie({},this.state.requiredPolicyInfo),{},{hasTerms:!1})})}catch(t){d.a.warn(`Unable to reach identity server at ${e} to check for terms in Settings`),d.a.warn(t)}}renderProfileSection(){return s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement(O,null))}renderAccountSection(){let e=s.a.createElement(ve,{className:"mx_GeneralUserSettingsTab_changePassword",rowClassName:"",buttonKind:"primary",onError:this.onPasswordChangeError,onFinished:this.onPasswordChanged}),t=null;if(C.b.getValue(G.b.ThirdPartyID)&&(this.state.haveIdServer||!0===this.state.serverSupportsSeparateAddAndBind)){const e=this.state.loading3pids?s.a.createElement(R.a,null):s.a.createElement(te,{emails:this.state.emails,onEmailsChange:this.onEmailsChange}),a=this.state.loading3pids?s.a.createElement(R.a,null):s.a.createElement(X,{msisdns:this.state.msisdns,onMsisdnsChange:this.onMsisdnsChange});t=s.a.createElement("div",null,s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Email addresses")),e,s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Phone numbers")),a)}else null===this.state.serverSupportsSeparateAddAndBind&&(t=s.a.createElement(R.a,null));let a=Object(c.a)("Set a new account password...");return this.state.canChangePassword||(a=null,e=null),s.a.createElement("div",{className:"mx_SettingsTab_section mx_GeneralUserSettingsTab_accountSection"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Account")),s.a.createElement("p",{className:"mx_SettingsTab_subsectionText"},a),e,t)}renderLanguageSection(){return s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Language and region")),s.a.createElement(x.a,{className:"mx_GeneralUserSettingsTab_languageInput",onOptionChange:this.onLanguageChange,value:this.state.language}))}renderSpellCheckSection(){return s.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_section_spellcheck"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Spell check"),s.a.createElement(xe.a,{checked:this.state.spellCheckEnabled,onChange:this.onSpellCheckEnabledChange})),this.state.spellCheckEnabled&&!je.a&&s.a.createElement(N,{languages:this.state.spellCheckLanguages,onLanguagesChange:this.onSpellCheckLanguagesChange}))}renderDiscoverySection(){if(this.state.requiredPolicyInfo.hasTerms){const e=s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Agree to the identity server (%(serverName)s) Terms of Service to allow yourself to be discoverable by email address or phone number.",{serverName:this.state.idServerName}));return s.a.createElement("div",null,s.a.createElement(be,{policiesAndServicePairs:this.state.requiredPolicyInfo.policiesAndServices,agreedUrls:this.state.requiredPolicyInfo.agreedUrls,onFinished:this.state.requiredPolicyInfo.resolve,introElement:e}),s.a.createElement(Oe,{missingTerms:!0}))}const e=this.state.loading3pids?s.a.createElement(R.a,null):s.a.createElement(ne,{emails:this.state.emails}),t=this.state.loading3pids?s.a.createElement(R.a,null):s.a.createElement(re,{msisdns:this.state.msisdns}),a=this.state.haveIdServer?s.a.createElement("div",{className:"mx_GeneralUserSettingsTab_discovery"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Email addresses")),e,s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Phone numbers")),t):null;return s.a.createElement("div",{className:"mx_SettingsTab_section"},a,s.a.createElement(Oe,{missingTerms:!1}))}renderManagementSection(){return s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Account management")),s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Deactivating your account is a permanent action — be careful!")),s.a.createElement(b.a,{onClick:this.onDeactivateClicked,kind:"danger"},Object(c.a)("Deactivate Account")))}renderIntegrationManagerSection(){return C.b.getValue(G.b.Widgets)?s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement(ke,null)):null}render(){const e=j.a.get().supportsSpellCheckSettings(),t=this.state.requiredPolicyInfo.hasTerms?s.a.createElement("img",{className:"mx_GeneralUserSettingsTab_warningIcon",src:a(723).default,width:"18",height:"18",alt:Object(c.a)("Warning")}):null;let n,i;return C.b.getValue(G.b.Deactivate)&&(n=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Deactivate account")),this.renderManagementSection())),C.b.getValue(G.b.IdentityServer)&&(i=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SettingsTab_heading"},t," ",Object(c.a)("Discovery")),this.renderDiscoverySection())),s.a.createElement("div",{className:"mx_SettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("General")),this.renderProfileSection(),this.renderAccountSection(),this.renderLanguageSection(),e?this.renderSpellCheckSection():null,i,this.renderIntegrationManagerSection(),n)}}var Ne=a(116),De=a(203),Pe=a(231),Me=a(197),Ae=a(366),Le=a(415);class Ue extends s.a.Component{constructor(){super(...arguments),i()(this,"onChange",async e=>{await C.b.setValue(this.props.featureId,null,H.a.DEVICE,e),this.forceUpdate()})}render(){const e=C.b.getDisplayName(this.props.featureId),t=C.b.getValue(this.props.featureId),a=C.b.canSetValue(this.props.featureId,null,H.a.DEVICE);return s.a.createElement(De.a,{value:t,label:e,onChange:this.onChange,disabled:!a})}}class Fe extends s.a.Component{constructor(e){super(e);const t=u.a.get();t.doesServerSupportUnstableFeature("org.matrix.msc3030").then(e=>{this.setState({showJumpToDate:e})}),t.doesServerSupportUnstableFeature("org.matrix.msc3827.stable").then(e=>{this.setState({showExploringPublicSpaces:e})}),this.state={showJumpToDate:!1,showExploringPublicSpaces:!1}}render(){const e=C.b.getFeatureSettingNames(),[t,a]=e.reduce((e,t)=>(e[C.b.getBetaInfo(t)?1:0].push(t),e),[[],[]]);let n,i;if(a.length&&(n=s.a.createElement("div",{"data-testid":"labs-beta-section",className:"mx_SettingsTab_section"},a.map(e=>s.a.createElement(Pe.b,{key:e,featureId:e})))),h.b.get("show_labs_settings")){const e=new Le.a;t.forEach(t=>{e.getOrCreate(C.b.getLabGroup(t),[]).push(s.a.createElement(Ue,{featureId:t,key:t}))}),e.getOrCreate(Ae.b.Experimental,[]).push(s.a.createElement(Me.a,{key:"lowBandwidth",name:"lowBandwidth",level:H.a.DEVICE})),e.getOrCreate(Ae.b.Analytics,[]).push(s.a.createElement(Me.a,{key:"automaticErrorReporting",name:"automaticErrorReporting",level:H.a.DEVICE}),s.a.createElement(Me.a,{key:"automaticDecryptionErrorReporting",name:"automaticDecryptionErrorReporting",level:H.a.DEVICE})),this.state.showJumpToDate&&e.getOrCreate(Ae.b.Messaging,[]).push(s.a.createElement(Me.a,{key:"feature_jump_to_date",name:"feature_jump_to_date",level:H.a.DEVICE})),this.state.showExploringPublicSpaces&&e.getOrCreate(Ae.b.Spaces,[]).push(s.a.createElement(Me.a,{key:"feature_exploring_public_spaces",name:"feature_exploring_public_spaces",level:H.a.DEVICE})),i=s.a.createElement(s.a.Fragment,null,Object(Ne.sortBy)(Array.from(e.entries()),"0").map(e=>{let[t,a]=e;return s.a.createElement("div",{className:"mx_SettingsTab_section",key:t,"data-testid":"labs-group-"+t},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)(Ae.d[t])),a)}))}return s.a.createElement("div",{className:"mx_SettingsTab mx_LabsUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Labs")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Feeling experimental? Labs are the best way to get things early, test out new features and help shape them before they actually launch. <a>Learn more</a>.",{},{a:e=>s.a.createElement("a",{href:"https://github.com/vector-im/element-web/blob/develop/docs/labs.md",rel:"noreferrer noopener",target:"_blank"},e)})),n,i)}}var Be=a(96),Ve=a.n(Be),ze=a(113),We=a(229),He=a(365),Ge=a(168);class qe extends s.a.Component{constructor(e){super(e),this.state={message:e.message}}fakeEvent(e){var t=this;let{message:a}=e;const n={type:"m.room.message",sender:this.props.userId,content:{"m.new_content":{msgtype:"m.text",body:a,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},msgtype:"m.text",body:a,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},unsigned:{age:97},event_id:"$9999999999999999999999999999999999999999999",room_id:"!999999999999999999:example.org"},i=new ze.b(n);return i.sender={name:this.props.displayName||this.props.userId,rawDisplayName:this.props.displayName,userId:this.props.userId,getAvatarUrl:function(){return We.c({avatarUrl:t.props.avatarUrl},32,32,"crop")},getMxcAvatarUrl:()=>this.props.avatarUrl},i}render(){const e=Ve()(this.props.className,{mx_IRCLayout:this.props.layout==Ge.a.IRC,mx_EventTilePreview_loader:!this.props.userId});if(!this.props.userId)return s.a.createElement("div",{className:e},s.a.createElement(R.a,null));const t=this.fakeEvent(this.state);return s.a.createElement("div",{className:e},s.a.createElement(He.a,{mxEvent:t,layout:this.props.layout,as:"div"}))}}var Ke=a(228);class Ye extends s.a.Component{constructor(e){super(e),i()(this,"onLayoutChange",e=>{const t=e.target.value;this.setState({layout:t}),C.b.setValue("layout",null,H.a.DEVICE,t),this.props.onLayoutChanged(t)}),this.state={layout:C.b.getValue("layout")}}render(){const e=Ve()("mx_LayoutSwitcher_RadioButton",{mx_LayoutSwitcher_RadioButton_selected:this.state.layout==Ge.a.IRC}),t=Ve()("mx_LayoutSwitcher_RadioButton",{mx_LayoutSwitcher_RadioButton_selected:this.state.layout==Ge.a.Group}),a=Ve()("mx_LayoutSwitcher_RadioButton",{mx_LayoutSwitcher_RadioButton_selected:this.state.layout===Ge.a.Bubble});return s.a.createElement("div",{className:"mx_SettingsTab_section mx_LayoutSwitcher"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Message layout")),s.a.createElement("div",{className:"mx_LayoutSwitcher_RadioButtons"},s.a.createElement("label",{className:e},s.a.createElement(qe,{className:"mx_LayoutSwitcher_RadioButton_preview",message:this.props.messagePreviewText,layout:Ge.a.IRC,userId:this.props.userId,displayName:this.props.displayName,avatarUrl:this.props.avatarUrl}),s.a.createElement(Ke.a,{name:"layout",value:Ge.a.IRC,checked:this.state.layout===Ge.a.IRC,onChange:this.onLayoutChange},Object(c.a)("IRC (Experimental)"))),s.a.createElement("label",{className:t},s.a.createElement(qe,{className:"mx_LayoutSwitcher_RadioButton_preview",message:this.props.messagePreviewText,layout:Ge.a.Group,userId:this.props.userId,displayName:this.props.displayName,avatarUrl:this.props.avatarUrl}),s.a.createElement(Ke.a,{name:"layout",value:Ge.a.Group,checked:this.state.layout==Ge.a.Group,onChange:this.onLayoutChange},Object(c.a)("Modern"))),s.a.createElement("label",{className:a},s.a.createElement(qe,{className:"mx_LayoutSwitcher_RadioButton_preview",message:this.props.messagePreviewText,layout:Ge.a.Bubble,userId:this.props.userId,displayName:this.props.displayName,avatarUrl:this.props.avatarUrl}),s.a.createElement(Ke.a,{name:"layout",value:Ge.a.Bubble,checked:this.state.layout==Ge.a.Bubble,onChange:this.onLayoutChange},Object(c.a)("Message bubbles")))))}}class Je extends r.Component{offset(e,t){const a=e.reduce((e,a)=>t>a?e+1:e,0);if(0===a)return 0;if(a===e.length)return 100;const n=e[a-1],i=e[a],r=1/(e.length-1);return 100*(a-1+(t-n)/(i-n))*r}render(){const e=this.props.values.map(e=>r.createElement($e,{active:e<=this.props.value,label:this.props.displayFunc(e),onClick:this.props.disabled?()=>{}:()=>this.props.onSelectionChange(e),key:e,disabled:this.props.disabled}));let t=null;if(!this.props.disabled){const e=this.offset(this.props.values,this.props.value);t=r.createElement("div",{className:"mx_Slider_selection"},r.createElement("div",{className:"mx_Slider_selectionDot",style:{left:"calc(-1.195em + "+e+"%)"}},r.createElement("div",{className:"mx_Slider_selectionText"},this.props.value)),r.createElement("hr",{style:{width:e+"%"}}))}return r.createElement("div",{className:"mx_Slider"},r.createElement("div",null,r.createElement("div",{className:"mx_Slider_bar"},r.createElement("hr",{onClick:this.props.disabled?()=>{}:this.onClick.bind(this)}),t),r.createElement("div",{className:"mx_Slider_dotContainer"},e)))}onClick(e){const t=e.target.clientWidth,a=e.nativeEvent.offsetX/t,n=this.props.values[Math.round(a*(this.props.values.length-1))];this.props.onSelectionChange(n)}}class $e extends r.PureComponent{render(){let e="mx_Slider_dot";return!this.props.disabled&&this.props.active&&(e+=" mx_Slider_dotActive"),r.createElement("span",{onClick:this.props.onClick,className:"mx_Slider_dotValue"},r.createElement("div",{className:e}),r.createElement("div",{className:"mx_Slider_labelContainer"},r.createElement("div",{className:"mx_Slider_label"},this.props.label)))}}var Qe=a(575);class Xe extends s.a.Component{constructor(e){super(e),i()(this,"MESSAGE_PREVIEW_TEXT",Object(c.a)("Hey you. You're the best!")),i()(this,"unmounted",!1),i()(this,"onFontSizeChanged",e=>{this.setState({fontSize:e.toString()}),C.b.setValue("baseFontSize",null,H.a.DEVICE,e-Qe.a.SIZE_DIFF)}),i()(this,"onValidateFontSize",async e=>{let{value:t}=e;const a=parseFloat(t),n=Qe.a.MIN_SIZE+Qe.a.SIZE_DIFF,i=Qe.a.MAX_SIZE+Qe.a.SIZE_DIFF;return isNaN(a)?{valid:!1,feedback:Object(c.a)("Size must be a number")}:n<=a&&a<=i?(C.b.setValue("baseFontSize",null,H.a.DEVICE,parseInt(t,10)-Qe.a.SIZE_DIFF),{valid:!0,feedback:Object(c.a)("Use between %(min)s pt and %(max)s pt",{min:n,max:i})}):{valid:!1,feedback:Object(c.a)("Custom font size can only be between %(min)s pt and %(max)s pt",{min:n,max:i})}}),this.state={fontSize:(C.b.getValue("baseFontSize",null)+Qe.a.SIZE_DIFF).toString(),useCustomFontSize:C.b.getValue("useCustomFontSize"),layout:C.b.getValue("layout"),userId:null,displayName:null,avatarUrl:null}}async componentDidMount(){const e=u.a.get(),t=e.getUserId(),a=await e.getProfileInfo(t);this.unmounted||this.setState({userId:t,displayName:a.displayname,avatarUrl:a.avatar_url})}componentWillUnmount(){this.unmounted=!0}render(){return s.a.createElement("div",{className:"mx_SettingsTab_section mx_FontScalingPanel"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Font size")),s.a.createElement(qe,{className:"mx_FontScalingPanel_preview",message:this.MESSAGE_PREVIEW_TEXT,layout:this.state.layout,userId:this.state.userId,displayName:this.state.displayName,avatarUrl:this.state.avatarUrl}),s.a.createElement("div",{className:"mx_FontScalingPanel_fontSlider"},s.a.createElement("div",{className:"mx_FontScalingPanel_fontSlider_smallText"},"Aa"),s.a.createElement(Je,{values:[13,14,15,16,18],value:parseInt(this.state.fontSize,10),onSelectionChange:this.onFontSizeChanged,displayFunc:e=>"",disabled:this.state.useCustomFontSize}),s.a.createElement("div",{className:"mx_FontScalingPanel_fontSlider_largeText"},"Aa")),s.a.createElement(Me.a,{name:"useCustomFontSize",level:H.a.ACCOUNT,onChange:e=>this.setState({useCustomFontSize:e}),useCheckbox:!0}),s.a.createElement(m.a,{type:"number",label:Object(c.a)("Font size"),autoComplete:"off",placeholder:this.state.fontSize.toString(),value:this.state.fontSize.toString(),id:"font_size_field",onValidate:this.onValidateFontSize,onChange:e=>this.setState({fontSize:e.target.value}),disabled:!this.state.useCustomFontSize,className:"mx_FontScalingPanel_customFontSizeField"}))}}var Ze=a(851),et=a(425);class tt extends s.a.Component{constructor(e){super(e),i()(this,"onSizeChange",e=>{const t=e.target.value;this.setState({size:t}),C.b.setValue("Images.size",null,H.a.ACCOUNT,t)}),this.state={size:C.b.getValue("Images.size")}}render(){return s.a.createElement("div",{className:"mx_SettingsTab_section mx_ImageSizePanel"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Image size in the timeline")),s.a.createElement("div",{className:"mx_ImageSizePanel_radios"},s.a.createElement("label",null,s.a.createElement("div",{className:"mx_ImageSizePanel_size mx_ImageSizePanel_sizeDefault"}),s.a.createElement(Ke.a,{name:"image_size",value:et.a.Normal,checked:this.state.size===et.a.Normal,onChange:this.onSizeChange},Object(c.a)("Default"))),s.a.createElement("label",null,s.a.createElement("div",{className:"mx_ImageSizePanel_size mx_ImageSizePanel_sizeLarge"}),s.a.createElement(Ke.a,{name:"image_size",value:et.a.Large,checked:this.state.size===et.a.Large,onChange:this.onSizeChange},Object(c.a)("Large")))))}}class at extends s.a.Component{constructor(e){super(e),i()(this,"MESSAGE_PREVIEW_TEXT",Object(c.a)("Hey you. You're the best!")),i()(this,"unmounted",!1),i()(this,"onLayoutChanged",e=>{this.setState({layout:e})}),this.state={useSystemFont:C.b.getValue("useSystemFont"),systemFont:C.b.getValue("systemFont"),showAdvanced:!1,layout:C.b.getValue("layout"),userId:null,displayName:null,avatarUrl:null}}async componentDidMount(){const e=u.a.get(),t=e.getUserId(),a=await e.getProfileInfo(t);this.unmounted||this.setState({userId:t,displayName:a.displayname,avatarUrl:a.avatar_url})}componentWillUnmount(){this.unmounted=!0}renderAdvancedSection(){if(!C.b.getValue(G.b.AdvancedSettings))return null;const e=h.b.get().brand,t=s.a.createElement(b.a,{kind:"link",onClick:()=>this.setState({showAdvanced:!this.state.showAdvanced})},this.state.showAdvanced?Object(c.a)("Hide advanced"):Object(c.a)("Show advanced"));let a;if(this.state.showAdvanced){const t=Object(c.a)("Set the name of a font installed on your system & %(brand)s will attempt to use it.",{brand:e});a=s.a.createElement(s.a.Fragment,null,s.a.createElement(Me.a,{name:"useCompactLayout",level:H.a.DEVICE,useCheckbox:!0}),s.a.createElement(Me.a,{name:"useSystemFont",level:H.a.DEVICE,useCheckbox:!0,onChange:e=>this.setState({useSystemFont:e})}),s.a.createElement(m.a,{className:"mx_AppearanceUserSettingsTab_systemFont",label:C.b.getDisplayName("systemFont"),onChange:e=>{this.setState({systemFont:e.target.value}),C.b.setValue("systemFont",null,H.a.DEVICE,e.target.value)},tooltipContent:t,forceTooltipVisible:!0,disabled:!this.state.useSystemFont,value:this.state.systemFont}))}return s.a.createElement("div",{className:"mx_SettingsTab_section mx_AppearanceUserSettingsTab_Advanced"},t,a)}render(){const e=h.b.get().brand;return s.a.createElement("div",{className:"mx_SettingsTab mx_AppearanceUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Customise your appearance")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Appearance Settings only affect this %(brand)s session.",{brand:e})),s.a.createElement(Ze.a,null),s.a.createElement(Ye,{userId:this.state.userId,displayName:this.state.displayName,avatarUrl:this.state.avatarUrl,messagePreviewText:this.MESSAGE_PREVIEW_TEXT,onLayoutChanged:this.onLayoutChanged}),s.a.createElement(Xe,null),this.renderAdvancedSection(),s.a.createElement(tt,null))}}var nt=a(7),it=a(114),rt=a(145),st=a(213),ot=a(337),ct=a(222);class lt extends s.a.PureComponent{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"onKeyBackupSessionsRemaining",e=>{this.setState({sessionsRemaining:e})}),i()(this,"onKeyBackupStatus",()=>{this.loadBackupStatus()}),i()(this,"startNewBackup",()=>{g.a.createDialogAsync(a.e(7).then(a.bind(null,875)),{onFinished:()=>{this.loadBackupStatus()}},null,!1,!0)}),i()(this,"deleteBackup",()=>{g.a.createDialog(de.a,{title:Object(c.a)("Delete Backup"),description:Object(c.a)("Are you sure? You will lose your encrypted messages if your keys are not backed up properly."),button:Object(c.a)("Delete Backup"),danger:!0,onFinished:e=>{e&&(this.setState({loading:!0}),u.a.get().deleteKeyBackupVersion(this.state.backupInfo.version).then(()=>{this.loadBackupStatus()}))}})}),i()(this,"restoreBackup",async()=>{g.a.createDialog(ot.a,null,null,!1,!0)}),i()(this,"resetSecretStorage",async()=>{this.setState({error:null});try{await Object(ct.b)(async()=>{},!0)}catch(e){if(d.a.error("Error resetting secret storage",e),this.unmounted)return;this.setState({error:e})}this.unmounted||this.loadBackupStatus()}),this.state={loading:!0,error:null,backupKeyStored:null,backupKeyCached:null,backupKeyWellFormed:null,secretStorageKeyInAccount:null,secretStorageReady:null,backupInfo:null,backupSigStatus:null,sessionsRemaining:0}}componentDidMount(){this.checkKeyBackupStatus(),u.a.get().on(rt.b.KeyBackupStatus,this.onKeyBackupStatus),u.a.get().on(rt.b.KeyBackupSessionsRemaining,this.onKeyBackupSessionsRemaining)}componentWillUnmount(){this.unmounted=!0,u.a.get()&&(u.a.get().removeListener(rt.b.KeyBackupStatus,this.onKeyBackupStatus),u.a.get().removeListener(rt.b.KeyBackupSessionsRemaining,this.onKeyBackupSessionsRemaining))}async checkKeyBackupStatus(){this.getUpdatedDiagnostics();try{const{backupInfo:e,trustInfo:t}=await u.a.get().checkKeyBackup();this.setState({loading:!1,error:null,backupInfo:e,backupSigStatus:t})}catch(e){if(d.a.log("Unable to fetch check backup status",e),this.unmounted)return;this.setState({loading:!1,error:e,backupInfo:null,backupSigStatus:null})}}async loadBackupStatus(){this.setState({loading:!0}),this.getUpdatedDiagnostics();try{const e=await u.a.get().getKeyBackupVersion(),t=await u.a.get().isKeyBackupTrusted(e);if(this.unmounted)return;this.setState({loading:!1,error:null,backupInfo:e,backupSigStatus:t})}catch(e){if(d.a.log("Unable to fetch key backup status",e),this.unmounted)return;this.setState({loading:!1,error:e,backupInfo:null,backupSigStatus:null})}}async getUpdatedDiagnostics(){const e=u.a.get(),t=e.crypto.secretStorage,a=!!await e.isKeyBackupKeyStored(),n=await e.crypto.getSessionBackupPrivateKey(),i=!!n,r=n instanceof Uint8Array,s=await t.hasKey(),o=await e.isSecretStorageReady();this.unmounted||this.setState({backupKeyStored:a,backupKeyCached:i,backupKeyWellFormed:r,secretStorageKeyInAccount:s,secretStorageReady:o})}render(){const{loading:e,error:t,backupKeyStored:a,backupKeyCached:n,backupKeyWellFormed:i,secretStorageKeyInAccount:r,secretStorageReady:o,backupInfo:l,backupSigStatus:d,sessionsRemaining:m}=this.state;let h,p,g;const v=[];if(t)h=s.a.createElement("div",{className:"error"},Object(c.a)("Unable to load key backup status"));else if(e)h=s.a.createElement(R.a,null);else if(l){let e,t=Object(c.a)("Restore from Backup");u.a.get().getKeyBackupEnabled()?h=s.a.createElement("p",null,"✅ ",Object(c.a)("This session is backing up your keys. ")):(h=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(c.a)("This session is <b>not backing up your keys</b>, but you do have an existing backup you can restore from and add to going forward.",{},{b:e=>s.a.createElement("b",null,e)})),s.a.createElement("p",null,Object(c.a)("Connect this session to key backup before signing out to avoid losing any keys that may only be on this session."))),t=Object(c.a)("Connect this session to Key Backup")),e=u.a.get().getKeyBackupEnabled()?m>0?s.a.createElement("div",null,Object(c.a)("Backing up %(sessionsRemaining)s keys...",{sessionsRemaining:m})," ",s.a.createElement("br",null)):s.a.createElement("div",null,Object(c.a)("All keys backed up")," ",s.a.createElement("br",null)):"";let a,n=d.sigs.map((e,t)=>{const a=e.device?e.device.getDisplayName()||e.device.deviceId:null,n=t=>s.a.createElement("span",{className:e.valid?"mx_SecureBackupPanel_sigValid":"mx_SecureBackupPanel_sigInvalid"},t),i=t=>s.a.createElement("span",{className:e.device&&e.deviceTrust.isVerified()?"mx_SecureBackupPanel_deviceVerified":"mx_SecureBackupPanel_deviceNotVerified"},t),r=e=>s.a.createElement("span",{className:"mx_SecureBackupPanel_deviceName"},a),o=e.device&&e.device.getFingerprint()===u.a.get().getDeviceEd25519Key(),l=e.crossSigningId&&e.deviceId===u.a.get().getCrossSigningId();let d;return e.valid&&l?d=Object(c.a)("Backup has a <validity>valid</validity> signature from this user",{},{validity:n}):!e.valid&&l?d=Object(c.a)("Backup has a <validity>invalid</validity> signature from this user",{},{validity:n}):e.crossSigningId?d=Object(c.a)("Backup has a signature from <verify>unknown</verify> user with ID %(deviceId)s",{deviceId:e.deviceId},{verify:i}):e.device?e.valid&&o?d=Object(c.a)("Backup has a <validity>valid</validity> signature from this session",{},{validity:n}):!e.valid&&o?d=Object(c.a)("Backup has an <validity>invalid</validity> signature from this session",{},{validity:n}):e.valid&&e.deviceTrust.isVerified()?d=Object(c.a)("Backup has a <validity>valid</validity> signature from <verify>verified</verify> session <device></device>",{},{validity:n,verify:i,device:r}):e.valid&&!e.deviceTrust.isVerified()?d=Object(c.a)("Backup has a <validity>valid</validity> signature from <verify>unverified</verify> session <device></device>",{},{validity:n,verify:i,device:r}):!e.valid&&e.deviceTrust.isVerified()?d=Object(c.a)("Backup has an <validity>invalid</validity> signature from <verify>verified</verify> session <device></device>",{},{validity:n,verify:i,device:r}):e.valid||e.deviceTrust.isVerified()||(d=Object(c.a)("Backup has an <validity>invalid</validity> signature from <verify>unverified</verify> session <device></device>",{},{validity:n,verify:i,device:r})):d=Object(c.a)("Backup has a signature from <verify>unknown</verify> session with ID %(deviceId)s",{deviceId:e.deviceId},{verify:i}),s.a.createElement("div",{key:t},d)});0===d.sigs.length&&(n=Object(c.a)("Backup is not signed by any of your sessions")),d.trusted_locally&&(a=Object(c.a)("This backup is trusted because it has been restored on this session")),p=s.a.createElement(s.a.Fragment,null,s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Backup version:")),s.a.createElement("td",null,l.version)),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Algorithm:")),s.a.createElement("td",null,l.algorithm))),g=s.a.createElement(s.a.Fragment,null,e,s.a.createElement("div",null,n),s.a.createElement("div",null,a)),v.push(s.a.createElement(b.a,{key:"restore",kind:"primary",onClick:this.restoreBackup},t)),Object(st.g)()||v.push(s.a.createElement(b.a,{key:"delete",kind:"danger",onClick:this.deleteBackup},Object(c.a)("Delete Backup")))}else h=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(c.a)("Your keys are <b>not being backed up from this session</b>.",{},{b:e=>s.a.createElement("b",null,e)})),s.a.createElement("p",null,Object(c.a)("Back up your keys before signing out to avoid losing them."))),v.push(s.a.createElement(b.a,{key:"setup",kind:"primary",onClick:this.startNewBackup},Object(c.a)("Set up")));r&&v.push(s.a.createElement(b.a,{key:"reset",kind:"danger",onClick:this.resetSecretStorage},Object(c.a)("Reset")));let f,y="";return n&&(y=", ",y+=i?Object(c.a)("well formed"):Object(c.a)("unexpected type")),v.length&&(f=s.a.createElement("div",{className:"mx_SecureBackupPanel_buttonRow"},v)),s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("Back up your encryption keys with your account data in case you lose access to your sessions. Your keys will be secured with a unique Security Key.")),h,s.a.createElement("details",null,s.a.createElement("summary",null,Object(c.a)("Advanced")),s.a.createElement("table",{className:"mx_SecureBackupPanel_statusList"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Backup key stored:")),s.a.createElement("td",null,!0===a?Object(c.a)("in secret storage"):Object(c.a)("not stored"))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Backup key cached:")),s.a.createElement("td",null,n?Object(c.a)("cached locally"):Object(c.a)("not found locally"),y)),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Secret storage public key:")),s.a.createElement("td",null,r?Object(c.a)("in account data"):Object(c.a)("not found"))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Secret storage:")),s.a.createElement("td",null,o?Object(c.a)("ready"):Object(c.a)("not ready"))),p)),g),f)}}var dt=e=>s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Encryption")),s.a.createElement(Me.a,{name:"e2ee.manuallyVerifyAllSessions",level:H.a.DEVICE}),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Individually verify each session used by a user to mark it as trusted, not trusting cross-signed devices.")));var ut=a(180);class mt extends s.a.Component{constructor(e){super(e),i()(this,"onExportE2eKeysClicked",()=>{g.a.createDialogAsync(a.e(6).then(a.bind(null,1515)),{matrixClient:u.a.get()})}),i()(this,"onImportE2eKeysClicked",()=>{g.a.createDialogAsync(a.e(30).then(a.bind(null,1544)),{matrixClient:u.a.get()})}),i()(this,"updateBlacklistDevicesFlag",e=>{u.a.get().setGlobalBlacklistUnverifiedDevices(e)})}render(){const e=u.a.get(),t=e.deviceId;let a=e.getDeviceEd25519Key();a=a?ut.e(a):Object(c.a)("<not supported>");let n,i=null;return e.isCryptoEnabled()&&(i=s.a.createElement("div",{className:"mx_CryptographyPanel_importExportButtons"},s.a.createElement(b.a,{kind:"primary",onClick:this.onExportE2eKeysClicked},Object(c.a)("Export E2E room keys")),s.a.createElement(b.a,{kind:"primary",onClick:this.onImportE2eKeysClicked},Object(c.a)("Import E2E room keys")))),C.b.isEnabled("blacklistUnverifiedDevices")&&(n=s.a.createElement(Me.a,{name:"blacklistUnverifiedDevices",level:H.a.DEVICE,onChange:this.updateBlacklistDevicesFlag})),s.a.createElement("div",{className:"mx_SettingsTab_section mx_CryptographyPanel"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Cryptography")),s.a.createElement("table",{className:"mx_SettingsTab_subsectionText mx_CryptographyPanel_sessionInfo"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Session ID:")),s.a.createElement("td",null,s.a.createElement("code",null,t))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Session key:")),s.a.createElement("td",null,s.a.createElement("code",null,s.a.createElement("b",null,a)))))),i,n)}}var ht,pt=a(430),gt=a(431),vt=a(586);function ft(){return(ft=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function bt(e){return r.createElement("svg",ft({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 14",role:"presentation","aria-hidden":!0},e),ht||(ht=r.createElement("path",{d:"M1.333.333C.6.333 0 .933 0 1.666l.007 2.12c0 .354.14.687.386.94L2.667 7 .393 9.286a1.332 1.332 0 00-.386.94L0 12.333c0 .733.6 1.333 1.333 1.333h5.334c.733 0 1.333-.6 1.333-1.333v-2.107c0-.353-.14-.693-.387-.94L5.333 7l2.274-2.267C7.86 4.48 8 4.14 8 3.786v-2.12C8 .933 7.4.333 6.667.333H1.333zm5.334 9.94v1.393c0 .367-.3.667-.667.667H2a.669.669 0 01-.667-.667v-1.393c0-.18.074-.347.194-.473L4 7.333l2.473 2.473c.12.12.194.294.194.467z",fill:"currentColor"})))}var yt=a(138),Et=a(146);let _t;!function(e){e.Verified="Verified",e.Unverified="Unverified",e.Inactive="Inactive"}(_t||(_t={}));const wt=e=>!!e.last_seen_ts&&e.last_seen_ts<Date.now()-7776e6,St={[_t.Verified]:e=>!!e.isVerified,[_t.Unverified]:e=>!e.isVerified,[_t.Inactive]:wt},Ot=(e,t)=>{const a=t.map(e=>St[e]);return a.length?e.filter(e=>a.every(t=>t(e))):e};var Ct;function xt(){return(xt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var kt;function jt(){return(jt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var Rt;function It(){return(It=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var Tt;function Nt(){return(Nt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var Dt;function Pt(){return(Pt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Mt(e){return r.createElement("svg",Pt({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),Dt||(Dt=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 3.05v6.22C2 15.63 9 17 9 17s7-1.37 7-7.73V3.05L9 1 2 3.05zm9.94 2.47c.19-.18.49-.17.67.02.16.18.16.45.02.63l-4.22 5.11-.03.04c-.28.34-.79.39-1.13.11a.29.29 0 01-.077-.067.912.912 0 00-.023-.023L5.34 9.26c-.2-.24-.18-.6.06-.8.2-.18.49-.18.7-.04l1.57 1.1 4.27-4z",fill:"currentColor"})))}var At;function Lt(){return(Lt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Ut(e){return r.createElement("svg",Lt({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),At||(At=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 9.27V3.05L9 1l7 2.05v6.22C16 15.63 9 17 9 17s-7-1.37-7-7.73zM8.92 4.4c-.57.04-.99.54-.94 1.11l.32 4c.03.35.3.62.65.65h.06c.37 0 .68-.28.71-.65l.32-4v-.16a1.06 1.06 0 00-1.12-.95zm.96 7.72a.88.88 0 11-1.76 0 .88.88 0 011.76 0z",fill:"currentColor"})))}var Ft=a(1494),Bt=a.n(Ft);let Vt;!function(e){e.Desktop="Desktop",e.Mobile="Mobile",e.Web="Web",e.Unknown="Unknown"}(Vt||(Vt={}));const zt=(e,t)=>e&&[e,t].filter(Boolean).join(" "),Wt=e=>{if(!e)return{deviceType:Vt.Unknown};const t=new Bt.a(e),a=t.getBrowser(),n=t.getDevice(),i=t.getOS(),r=((e,t,a,n)=>{var i;return"Electron"===a.name?Vt.Desktop:a.name?Vt.Web:"mobile"===t.type||null!==(i=n.name)&&void 0!==i&&i.includes("Android")||e.indexOf("; iOS ")>-1?Vt.Mobile:Vt.Unknown})(e,n,a,i),s=r===Vt.Web||r===Vt.Desktop,o=zt(i.name,s?void 0:i.version),c=zt(n.vendor,n.model),l=zt(a.name,a.version),{customDeviceModel:d,customDeviceOS:u}=r!==Vt.Unknown?(e=>{if(e.includes("Mozilla/"))return{};if(!e.includes("("))return{};const t=e.substring(e.indexOf("(")+1).split("; ");return{customDeviceModel:t[0]||void 0,customDeviceOS:t[1]||void 0}})(e):{};return{deviceType:r,deviceModel:c||d,deviceOperatingSystem:o||u,client:l}},Ht={[Vt.Desktop]:function(e){return r.createElement("svg",jt({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 19",role:"presentation","aria-hidden":!0},e),kt||(kt=r.createElement("path",{d:"M3 15.5c-.55 0-1.02-.196-1.412-.587A1.927 1.927 0 011 13.5v-11c0-.55.196-1.021.588-1.413A1.925 1.925 0 013 .5h16c.55 0 1.021.196 1.413.587.391.392.587.863.587 1.413v11c0 .55-.196 1.021-.587 1.413A1.928 1.928 0 0119 15.5H3zm0-2h16v-11H3v11zm-2 5a.965.965 0 01-.712-.288A.965.965 0 010 17.5c0-.283.096-.52.288-.712A.965.965 0 011 16.5h20c.283 0 .52.096.712.288A.965.965 0 0122 17.5c0 .283-.096.52-.288.712A.965.965 0 0121 18.5H1zm2-5v-11 11z",fill:"currentColor"})))},[Vt.Mobile]:function(e){return r.createElement("svg",Nt({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 23",role:"presentation","aria-hidden":!0},e),Tt||(Tt=r.createElement("path",{d:"M12 .51L2 .5c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-18c0-1.1-.9-1.99-2-1.99zm0 17.99H2v-14h10v14z",fill:"currentColor"})))},[Vt.Web]:function(e){return r.createElement("svg",It({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 17",role:"presentation","aria-hidden":!0},e),Rt||(Rt=r.createElement("path",{d:"M18 16.5H2c-.55 0-1.02-.196-1.412-.587A1.927 1.927 0 010 14.5v-12c0-.55.196-1.02.588-1.412A1.923 1.923 0 012 .5h16c.55 0 1.021.196 1.413.588.391.391.587.862.587 1.412v12c0 .55-.196 1.021-.587 1.413A1.928 1.928 0 0118 16.5zM2 4.5v10h16v-10H2z",fill:"currentColor"})))},[Vt.Unknown]:function(e){return r.createElement("svg",xt({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 23",role:"presentation","aria-hidden":!0},e),Ct||(Ct=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 22.5c6.075 0 11-4.925 11-11S17.075.5 11 .5 0 5.425 0 11.5s4.925 11 11 11zm0-4.24a1.375 1.375 0 100-2.75 1.375 1.375 0 000 2.75zM9.09 9.428A1.91 1.91 0 0111 7.518c1.048 0 1.91.862 1.91 1.91 0 .485-.208.659-1.026 1.224-.363.25-.86.598-1.246 1.108-.415.546-.67 1.227-.67 2.093h2.063c0-.424.113-.666.25-.846.164-.217.402-.4.775-.659l.124-.084c.676-.46 1.792-1.219 1.792-2.836A3.98 3.98 0 0011 5.456a3.972 3.972 0 00-3.973 3.972H9.09z",fill:"currentColor"})))}},Gt={[Vt.Desktop]:Object(c.a)("Desktop session"),[Vt.Mobile]:Object(c.a)("Mobile session"),[Vt.Web]:Object(c.a)("Web session"),[Vt.Unknown]:Object(c.a)("Unknown session type")},qt=e=>{let{isVerified:t,isSelected:a,deviceType:n}=e;const i=Ht[n]||Ht[Vt.Unknown],r=Gt[n]||Gt[Vt.Unknown];return s.a.createElement("div",{className:Ve()("mx_DeviceTypeIcon",{mx_DeviceTypeIcon_selected:a})},s.a.createElement("div",{className:"mx_DeviceTypeIcon_deviceIconWrapper"},s.a.createElement(i,{className:"mx_DeviceTypeIcon_deviceIcon",role:"img","aria-label":r})),t?s.a.createElement(Mt,{className:Ve()("mx_DeviceTypeIcon_verificationIcon","verified"),role:"img","aria-label":Object(c.a)("Verified")}):s.a.createElement(Ut,{className:Ve()("mx_DeviceTypeIcon_verificationIcon","unverified"),role:"img","aria-label":Object(c.a)("Unverified")}))};var Kt=a(563);const Yt=e=>{let{device:t}=e;return s.a.createElement(Et.a,{size:"h4"},t.display_name||t.device_id)},Jt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime();if(e+5184e5>=t){const t=new Date(e);return Object(yt.b)(t)}return Object(yt.j)(new Date(e))},$t=e=>{let{value:t,id:a}=e;return t?s.a.createElement("span",{"data-testid":"device-metadata-"+a},t):null};var Qt=e=>{let{device:t,children:a,isSelected:n,onClick:i}=e;const o=(e=>{if(wt(e))return{id:"inactive",value:s.a.createElement(s.a.Fragment,null,s.a.createElement(bt,{className:"mx_DeviceTile_inactiveIcon"}),Object(c.a)("Inactive for %(inactiveAgeDays)s+ days",{inactiveAgeDays:90})+` (${Jt(e.last_seen_ts)})`)}})(t),l=t.last_seen_ts&&`${Object(c.a)("Last activity")} ${Jt(t.last_seen_ts)}`,d=t.isVerified?Object(c.a)("Verified"):Object(c.a)("Unverified"),u=o?[o,{id:"lastSeenIp",value:t.last_seen_ip}]:[{id:"isVerified",value:d},{id:"lastActivity",value:l},{id:"lastSeenIp",value:t.last_seen_ip},{id:"deviceId",value:t.device_id}];return s.a.createElement("div",{className:Ve()("mx_DeviceTile",{mx_DeviceTile_interactive:!!i}),"data-testid":"device-tile-"+t.device_id,onClick:i},s.a.createElement(qt,{isVerified:t.isVerified,isSelected:n,deviceType:t.deviceType}),s.a.createElement("div",{className:"mx_DeviceTile_info"},s.a.createElement(Yt,{device:t}),s.a.createElement("div",{className:"mx_DeviceTile_metadata"},u.map((e,t)=>{let{id:a,value:n}=e;return n?s.a.createElement(r.Fragment,{key:a},!!t&&" · ",s.a.createElement($t,{id:a,value:n})):null}))),s.a.createElement("div",{className:"mx_DeviceTile_actions",onClick:Object(Kt.a)(()=>{})},a))};var Xt=e=>{let{children:t,device:a,isSelected:n,onSelect:i,onClick:r}=e;return s.a.createElement("div",{className:"mx_SelectableDeviceTile"},s.a.createElement(M.b,{kind:M.a.Solid,checked:n,onChange:i,className:"mx_SelectableDeviceTile_checkbox",id:"device-tile-checkbox-"+a.device_id,"data-testid":"device-tile-checkbox-"+a.device_id}),s.a.createElement(Qt,{device:a,onClick:r,isSelected:n},t))};function Zt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ea(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Zt(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class ta extends s.a.Component{constructor(e){super(e),i()(this,"onDeviceToggled",()=>{this.props.onDeviceToggled(this.props.device)}),i()(this,"onRename",()=>{this.setState({renaming:!0})}),i()(this,"onChangeDisplayName",e=>{this.setState({displayName:e.target.value})}),i()(this,"onRenameSubmit",async()=>{this.setState({renaming:!1}),await u.a.get().setDeviceDetails(this.props.device.device_id,{display_name:this.state.displayName}).catch(e=>{throw d.a.error("Error setting session display name",e),new Error(Object(c.a)("Failed to set display name"))}),this.props.onDeviceChange()}),i()(this,"onRenameCancel",()=>{this.setState({renaming:!1})}),i()(this,"onOwnDeviceSignOut",()=>{g.a.createDialog(vt.a,{},null,!1,!0)}),i()(this,"verify",async()=>{if(this.props.isOwnDevice)g.a.createDialog(pt.a,{onFinished:this.props.onDeviceChange});else{const e=u.a.get(),t=e.getUserId(),a=e.requestVerification(t,[this.props.device.device_id]);g.a.createDialog(gt.a,{verificationRequestPromise:a,member:e.getUser(t),onFinished:async()=>{(await a).cancel(),this.props.onDeviceChange()}})}}),this.state={renaming:!1,displayName:e.device.display_name}}render(){let e,t,a="";null!==this.props.verified&&(a=this.props.verified?"mx_E2EIcon_verified":"mx_E2EIcon_warning",!this.props.verified&&this.props.canBeVerified&&(e=s.a.createElement(b.a,{kind:"primary",onClick:this.verify},Object(c.a)("Verify")))),this.props.isOwnDevice&&(t=s.a.createElement(b.a,{kind:"danger_outline",onClick:this.onOwnDeviceSignOut},Object(c.a)("Sign Out")));const n=this.state.renaming?s.a.createElement("form",{className:"mx_DevicesPanel_renameForm",onSubmit:this.onRenameSubmit},s.a.createElement(m.a,{label:Object(c.a)("Display Name"),type:"text",value:this.state.displayName,autoComplete:"off",onChange:this.onChangeDisplayName,autoFocus:!0}),s.a.createElement(b.a,{onClick:this.onRenameSubmit,kind:"confirm_sm"}),s.a.createElement(b.a,{onClick:this.onRenameCancel,kind:"cancel_sm"})):s.a.createElement(s.a.Fragment,null,t,e,s.a.createElement(b.a,{kind:"primary_outline",onClick:this.onRename},Object(c.a)("Rename"))),i=ea(ea({},this.props.device),{},{isVerified:this.props.verified,deviceType:Vt.Unknown});return this.props.isOwnDevice?s.a.createElement("div",{className:Ve()("mx_DevicesPanel_device","mx_DevicesPanel_myDevice")},s.a.createElement("div",{className:"mx_DevicesPanel_deviceTrust"},s.a.createElement("span",{className:"mx_DevicesPanel_icon mx_E2EIcon "+a})),s.a.createElement(Qt,{device:i},n)):s.a.createElement("div",{className:"mx_DevicesPanel_device"},s.a.createElement(Xt,{device:i,onSelect:this.onDeviceToggled,isSelected:this.props.selected},n))}}const aa=(e,t)=>async a=>{await e.deleteMultipleDevices(t,a)},na=async(e,t,a)=>{if(t.length)try{await aa(e,t)(),a(!0,void 0)}catch(i){var n;if(401!==i.httpStatus||null===(n=i.data)||void 0===n||!n.flows)throw i;const r=t.length,s={[P.c.PHASE_PREAUTH]:{title:Object(c.a)("Use Single Sign On to continue"),body:Object(c.a)("Confirm logging out these devices by using Single Sign On to prove your identity.",{count:r}),continueText:Object(c.a)("Single Sign On"),continueKind:"primary"},[P.c.PHASE_POSTAUTH]:{title:Object(c.a)("Confirm signing out these devices",{count:r}),body:Object(c.a)("Click the button below to confirm signing out these devices.",{count:r}),continueText:Object(c.a)("Sign out devices",{count:r}),continueKind:"danger"}};g.a.createDialog(K.a,{title:Object(c.a)("Authentication"),matrixClient:e,authData:i.data,onFinished:a,makeRequest:aa(e,t),aestheticsForStagePhases:{[P.c.LOGIN_TYPE]:s,[P.c.UNSTABLE_LOGIN_TYPE]:s}})}};var ia=a(102);class ra extends s.a.Component{constructor(e){super(e),i()(this,"context",void 0),i()(this,"unmounted",!1),i()(this,"onDevicesUpdated",e=>{e.includes(this.context.getUserId())&&this.loadDevices()}),i()(this,"onDeviceSelectionToggled",e=>{if(this.unmounted)return;const t=e.device_id;this.setState((e,a)=>{const n=e.selectedDevices.slice(),i=n.indexOf(t);return-1===i?n.push(t):n.splice(i,1),{selectedDevices:n}})}),i()(this,"selectAll",e=>{this.setState((t,a)=>{const n=t.selectedDevices.slice();for(const t of e){const e=t.device_id;n.includes(e)||n.push(e)}return{selectedDevices:n}})}),i()(this,"deselectAll",e=>{this.setState((t,a)=>{const n=t.selectedDevices.slice();for(const t of e){const e=t.device_id,a=n.indexOf(e);-1!==a&&n.splice(a,1)}return{selectedDevices:n}})}),i()(this,"onDeleteClick",async()=>{if(0!==this.state.selectedDevices.length){this.setState({deleting:!0});try{await na(this.context,this.state.selectedDevices,e=>{e&&(this.setState({selectedDevices:[]}),this.loadDevices()),this.setState({deleting:!1})})}catch(e){d.a.error("Error deleting sessions",e),this.setState({deleting:!1})}}}),i()(this,"renderDevice",e=>{const t=this.context.getDeviceId(),a=this.state.devices.find(e=>e.device_id===t),n=e.device_id===t,i=a&&this.isDeviceVerified(a)||n;return s.a.createElement(ta,{key:e.device_id,device:e,selected:this.state.selectedDevices.includes(e.device_id),isOwnDevice:n,verified:this.isDeviceVerified(e),canBeVerified:i,onDeviceChange:this.loadDevices,onDeviceToggled:this.onDeviceSelectionToggled})}),this.state={devices:[],selectedDevices:[]},this.loadDevices=this.loadDevices.bind(this)}componentDidMount(){this.context.on(rt.b.DevicesUpdated,this.onDevicesUpdated),this.loadDevices()}componentWillUnmount(){this.context.off(rt.b.DevicesUpdated,this.onDevicesUpdated),this.unmounted=!0}loadDevices(){const e=this.context;e.getDevices().then(t=>{if(this.unmounted)return;const a=e.getStoredCrossSigningForUser(e.getUserId());this.setState((e,n)=>{const i=t.devices.map(e=>e.device_id),r=e.selectedDevices.filter(e=>i.includes(e));return{devices:t.devices||[],selectedDevices:r,crossSigningInfo:a}})},e=>{if(this.unmounted)return;let t;404==e.httpStatus?t=Object(c.a)("Your homeserver does not support device management."):(d.a.error("Error loading sessions:",e),t=Object(c.a)("Unable to load device list")),this.setState({deviceLoadError:t})})}deviceCompare(e,t){const a=(t.last_seen_ts||0)-(e.last_seen_ts||0);if(0!==a)return a;const n=e.device_id,i=t.device_id;return n<i?-1:n>i?1:0}isDeviceVerified(e){try{const t=this.context,a=t.getStoredDevice(t.getUserId(),e.device_id);return this.state.crossSigningInfo.checkDeviceTrust(this.state.crossSigningInfo,a,!1,!0).isCrossSigningVerified()}catch(e){return console.error("Error getting device cross-signing info",e),null}}render(){const e=s.a.createElement("div",{className:Ve()(this.props.className,"error")},this.state.deviceLoadError);if(void 0!==this.state.deviceLoadError)return e;const t=this.state.devices;if(void 0===t)return s.a.createElement(R.a,null);const a=this.context.getDeviceId(),n=t.find(e=>e.device_id===a);if(!n)return e;const i=t.filter(e=>e.device_id!==a);i.sort(this.deviceCompare);const r=[],o=[],l=[];for(const e of i){const t=this.isDeviceVerified(e);!0===t?r.push(e):!1===t?o.push(e):l.push(e)}const d=(e,t,a)=>{if(0===a.length)return s.a.createElement(s.a.Fragment,null);let n;if(a.length>1){const e=a.some(e=>this.state.selectedDevices.includes(e.device_id)),t=e?()=>{this.deselectAll(a)}:()=>{this.selectAll(a)},i=e?Object(c.a)("Deselect all"):Object(c.a)("Select all");n=s.a.createElement("div",{className:"mx_DevicesPanel_header_button"},s.a.createElement(b.a,{className:"mx_DevicesPanel_selectButton",kind:"secondary",onClick:t},i))}return s.a.createElement(s.a.Fragment,null,s.a.createElement("hr",null),s.a.createElement("div",{className:"mx_DevicesPanel_header"},s.a.createElement("div",{className:"mx_DevicesPanel_header_trust"},e),s.a.createElement("div",{className:"mx_DevicesPanel_header_title"},t),n),a.map(this.renderDevice))},u=d(s.a.createElement("span",{className:"mx_DevicesPanel_header_icon mx_E2EIcon mx_E2EIcon_verified"}),Object(c.a)("Verified devices"),r),m=d(s.a.createElement("span",{className:"mx_DevicesPanel_header_icon mx_E2EIcon mx_E2EIcon_warning"}),Object(c.a)("Unverified devices"),o),h=d(s.a.createElement(s.a.Fragment,null),Object(c.a)("Devices without encryption support"),l),p=this.state.deleting?s.a.createElement(R.a,{w:22,h:22}):s.a.createElement(b.a,{className:"mx_DevicesPanel_deleteButton",onClick:this.onDeleteClick,kind:"danger_outline",disabled:0===this.state.selectedDevices.length,"data-testid":"sign-out-devices-btn"},Object(c.a)("Sign out %(count)s selected devices",{count:this.state.selectedDevices.length})),g=i.length>0?s.a.createElement(s.a.Fragment,null,u,m,h,p):s.a.createElement(s.a.Fragment,null,s.a.createElement("hr",null),s.a.createElement("div",{className:"mx_DevicesPanel_noOtherDevices"},Object(c.a)("You aren't signed into any other devices."))),v=Ve()(this.props.className,"mx_DevicesPanel");return s.a.createElement("div",{className:v},s.a.createElement("div",{className:"mx_DevicesPanel_header"},s.a.createElement("div",{className:"mx_DevicesPanel_header_title"},Object(c.a)("This device"))),this.renderDevice(n),g)}}i()(ra,"contextType",ia.a);var sa=a(107),oa=a(115);class ca extends s.a.Component{constructor(){super(...arguments),i()(this,"onConfirm",()=>{this.props.onFinished(!0)}),i()(this,"onDecline",()=>{this.props.onFinished(!1)})}render(){return s.a.createElement(A.a,{className:"mx_ConfirmDestroyCrossSigningDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(c.a)("Destroy cross-signing keys?")},s.a.createElement("div",{className:"mx_ConfirmDestroyCrossSigningDialog_content"},s.a.createElement("p",null,Object(c.a)("Deleting cross-signing keys is permanent. Anyone you have verified with will see security alerts. You almost certainly don't want to do this, unless you've lost every device you can cross-sign from."))),s.a.createElement(oa.a,{primaryButton:Object(c.a)("Clear cross-signing keys"),onPrimaryButtonClick:this.onConfirm,primaryButtonClass:"danger",cancelButton:Object(c.a)("Cancel"),onCancel:this.onDecline}))}}class la extends s.a.PureComponent{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"onAccountData",e=>{const t=e.getType();(t.startsWith("m.cross_signing")||t.startsWith("m.secret_storage"))&&this.getUpdatedStatus()}),i()(this,"onBootstrapClick",()=>{this.state.crossSigningPrivateKeysInStorage?g.a.createDialog(pt.a,{},null,!1,!0):Object(ct.b)()}),i()(this,"onStatusChanged",()=>{this.getUpdatedStatus()}),i()(this,"bootstrapCrossSigning",async e=>{let{forceReset:t=!1}=e;this.setState({error:void 0});try{const e=u.a.get();await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:async t=>{const{finished:a}=g.a.createDialog(K.a,{title:Object(c.a)("Setting up keys"),matrixClient:e,makeRequest:t}),[n]=await a;if(!n)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:t})}catch(e){this.setState({error:e}),d.a.error("Error bootstrapping cross-signing",e)}this.unmounted||this.getUpdatedStatus()}),i()(this,"resetCrossSigning",()=>{g.a.createDialog(ca,{onFinished:e=>{e&&this.bootstrapCrossSigning({forceReset:!0})}})}),this.state={}}componentDidMount(){const e=u.a.get();e.on(sa.ClientEvent.AccountData,this.onAccountData),e.on(rt.b.UserTrustStatusChanged,this.onStatusChanged),e.on(rt.b.KeysChanged,this.onStatusChanged),this.getUpdatedStatus()}componentWillUnmount(){this.unmounted=!0;const e=u.a.get();e&&(e.removeListener(sa.ClientEvent.AccountData,this.onAccountData),e.removeListener(rt.b.UserTrustStatusChanged,this.onStatusChanged),e.removeListener(rt.b.KeysChanged,this.onStatusChanged))}async getUpdatedStatus(){const e=u.a.get(),t=e.getCrossSigningCacheCallbacks(),a=e.crypto.crossSigningInfo,n=e.crypto.secretStorage,i=Boolean(a.getId()),r=Boolean(await a.isStoredInSecretStorage(n)),s=!(!t||!await t.getCrossSigningKeyCache("master")),o=!(!t||!await t.getCrossSigningKeyCache("self_signing")),c=!(!t||!await t.getCrossSigningKeyCache("user_signing")),l=await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"),d=await e.isCrossSigningReady();this.setState({crossSigningPublicKeysOnDevice:i,crossSigningPrivateKeysInStorage:r,masterPrivateKeyCached:s,selfSigningPrivateKeyCached:o,userSigningPrivateKeyCached:c,homeserverSupportsCrossSigning:l,crossSigningReady:d})}render(){const{error:e,crossSigningPublicKeysOnDevice:t,crossSigningPrivateKeysInStorage:a,masterPrivateKeyCached:n,selfSigningPrivateKeyCached:i,userSigningPrivateKeyCached:r,homeserverSupportsCrossSigning:o,crossSigningReady:l}=this.state;let d,u;e&&(d=s.a.createElement("div",{className:"error"},e.toString())),u=void 0===o?s.a.createElement(R.a,null):o?l&&a?s.a.createElement("p",null,"✅ ",Object(c.a)("Cross-signing is ready for use.")):l&&!a?s.a.createElement("p",null,"⚠️ ",Object(c.a)("Cross-signing is ready but keys are not backed up.")):a?s.a.createElement("p",null,Object(c.a)("Your account has a cross-signing identity in secret storage, but it is not yet trusted by this session.")):s.a.createElement("p",null,Object(c.a)("Cross-signing is not set up.")):s.a.createElement("p",null,Object(c.a)("Your homeserver does not support cross-signing."));const m=t||a||n||i||r,h=[];if(!(t&&a&&n&&i&&r)&&o){let e=Object(c.a)("Set up Secure Backup");a&&(e=Object(c.a)("Verify this session")),h.push(s.a.createElement(b.a,{key:"setup",kind:"primary",onClick:this.onBootstrapClick},e))}let p;return m&&h.push(s.a.createElement(b.a,{key:"reset",kind:"danger",onClick:this.resetCrossSigning},Object(c.a)("Reset"))),h.length&&(p=s.a.createElement("div",{className:"mx_CrossSigningPanel_buttonRow"},h)),s.a.createElement("div",null,u,s.a.createElement("details",null,s.a.createElement("summary",null,Object(c.a)("Advanced")),s.a.createElement("table",{className:"mx_CrossSigningPanel_statusList"},s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Cross-signing public keys:")),s.a.createElement("td",null,t?Object(c.a)("in memory"):Object(c.a)("not found"))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Cross-signing private keys:")),s.a.createElement("td",null,a?Object(c.a)("in secret storage"):Object(c.a)("not found in storage"))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Master private key:")),s.a.createElement("td",null,n?Object(c.a)("cached locally"):Object(c.a)("not found locally"))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Self signing private key:")),s.a.createElement("td",null,i?Object(c.a)("cached locally"):Object(c.a)("not found locally"))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("User signing private key:")),s.a.createElement("td",null,r?Object(c.a)("cached locally"):Object(c.a)("not found locally"))),s.a.createElement("tr",null,s.a.createElement("td",null,Object(c.a)("Homeserver feature support:")),s.a.createElement("td",null,o?Object(c.a)("exists"):Object(c.a)("not found")))))),d,p)}}var da=a(283);class ua extends s.a.PureComponent{render(){return s.a.createElement(A.a,{hasCancel:!0,onFinished:this.props.onFinished.bind(null,!1),title:Object(c.a)("Reset event store?")},s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("You most likely do not want to reset your event index store"),s.a.createElement("br",null),Object(c.a)("If you do, please note that none of your messages will be deleted, but the search experience might be degraded for a few moments whilst the index is recreated"))),s.a.createElement(oa.a,{primaryButton:Object(c.a)("Reset event store"),onPrimaryButtonClick:this.props.onFinished.bind(null,!0),primaryButtonClass:"danger",cancelButton:Object(c.a)("Cancel"),onCancel:this.props.onFinished.bind(null,!1)}))}}class ma extends s.a.Component{constructor(e){super(e),i()(this,"updateCurrentRoom",async e=>{const t=da.a.get();let a;try{a=await t.getStats()}catch{return}this.setState({eventIndexSize:a.size,roomCount:a.roomCount})}),i()(this,"onManage",async()=>{g.a.createDialogAsync(a.e(32).then(a.bind(null,1545)),{onFinished:()=>{}},null,!1,!0)}),i()(this,"onEnable",async()=>{this.setState({enabling:!0}),await da.a.initEventIndex(),await da.a.get().addInitialCheckpoints(),da.a.get().startCrawler(),await C.b.setValue("enableEventIndexing",null,H.a.DEVICE,!0),await this.updateState()}),i()(this,"confirmEventStoreReset",()=>{const{close:e}=g.a.createDialog(ua,{onFinished:async t=>{t&&(await C.b.setValue("enableEventIndexing",null,H.a.DEVICE,!1),await da.a.deleteEventIndex(),await this.onEnable(),e())}})}),this.state={enabling:!1,eventIndexSize:0,roomCount:0,eventIndexingEnabled:C.b.getValueAt(H.a.DEVICE,"enableEventIndexing")}}componentWillUnmount(){const e=da.a.get();null!==e&&e.removeListener("changedCheckpoint",this.updateCurrentRoom)}componentDidMount(){this.updateState()}async updateState(){const e=da.a.get(),t=C.b.getValueAt(H.a.DEVICE,"enableEventIndexing");let a=0,n=0;if(null!==e){e.on("changedCheckpoint",this.updateCurrentRoom);try{const t=await e.getStats();a=t.size,n=t.roomCount}catch{}}this.setState({enabling:!1,eventIndexSize:a,roomCount:n,eventIndexingEnabled:t})}render(){let e=null;const t=h.b.get().brand;if(null!==da.a.get())e=s.a.createElement("div",null,s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Securely cache encrypted messages locally for them to appear in search results, using %(size)s to store messages from %(rooms)s rooms.",{size:Object(ut.a)(this.state.eventIndexSize,0),count:this.state.roomCount,rooms:Object(ut.d)(this.state.roomCount)})),s.a.createElement("div",null,s.a.createElement(b.a,{kind:"primary",onClick:this.onManage},Object(c.a)("Manage"))));else if(!this.state.eventIndexingEnabled&&da.a.supportIsInstalled())e=s.a.createElement("div",null,s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Securely cache encrypted messages locally for them to appear in search results.")),s.a.createElement("div",null,s.a.createElement(b.a,{kind:"primary",disabled:this.state.enabling,onClick:this.onEnable},Object(c.a)("Enable")),this.state.enabling?s.a.createElement(Se.a,null):s.a.createElement("div",null)));else if(da.a.platformHasSupport()&&!da.a.supportIsInstalled()){const a="https://github.com/vector-im/element-desktop/blob/develop/docs/native-node-modules.md#adding-seshat-for-search-in-e2e-encrypted-rooms";e=s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("%(brand)s is missing some components required for securely caching encrypted messages locally. If you'd like to experiment with this feature, build a custom %(brand)s Desktop with <nativeLink>search components added</nativeLink>.",{brand:t},{nativeLink:e=>s.a.createElement("a",{href:a,target:"_blank",rel:"noreferrer noopener"},e)}))}else e=da.a.platformHasSupport()?s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement("p",null,this.state.enabling?s.a.createElement(Se.a,null):Object(c.a)("Message search initialisation failed")),da.a.error&&s.a.createElement("details",null,s.a.createElement("summary",null,Object(c.a)("Advanced")),s.a.createElement("code",null,da.a.error.message),s.a.createElement("p",null,s.a.createElement(b.a,{key:"delete",kind:"danger",onClick:this.confirmEventStoreReset},Object(c.a)("Reset"))))):s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("%(brand)s can't securely cache encrypted messages locally while running in a web browser. Use <desktopLink>%(brand)s Desktop</desktopLink> for encrypted messages to appear in search results.",{brand:t},{desktopLink:e=>s.a.createElement("a",{href:"https://element.io/get-started",target:"_blank",rel:"noreferrer noopener"},e)}));return e}}var ha=a(166),pa=a(866),ga=a(305),va=a(870),fa=a(363);class ba extends s.a.Component{constructor(e){super(e)}render(){var e,t,a,n;const i=!(null===(e=this.props.versions)||void 0===e||null===(t=e.unstable_features)||void 0===t||!t["org.matrix.msc3882"]),r=!(null===(a=this.props.versions)||void 0===a||null===(n=a.unstable_features)||void 0===n||!n["org.matrix.msc3886"]);return C.b.getValue("feature_qr_signin_reciprocate_show")&&i&&r?s.a.createElement(fa.a,{heading:Object(c.a)("Sign in with QR code")},s.a.createElement("div",{className:"mx_LoginWithQRSection"},s.a.createElement("p",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("You can use this device to sign in a new device with a QR code. You will need to scan the QR code shown on this device with your device that's signed out.")),s.a.createElement(b.a,{onClick:this.props.onShowQr,kind:"primary"},Object(c.a)("Show QR code")))):null}}class ya extends s.a.Component{constructor(){super(...arguments),i()(this,"onUnignoreClicked",()=>{this.props.onUnignored(this.props.userId)})}render(){const e="mx_SecurityUserSettingsTab_ignoredUser_"+this.props.userId;return s.a.createElement("div",{className:"mx_SecurityUserSettingsTab_ignoredUser"},s.a.createElement(b.a,{onClick:this.onUnignoreClicked,kind:"primary_sm","aria-describedby":e,disabled:this.props.inProgress},Object(c.a)("Unignore")),s.a.createElement("span",{id:e},this.props.userId))}}class Ea extends s.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",e=>{let{action:t}=e;if("ignore_state_changed"===t){const e=u.a.get().getIgnoredUsers(),t=this.state.waitingUnignored.filter(t=>e.includes(t));this.setState({ignoredUserIds:e,waitingUnignored:t})}}),i()(this,"onMyMembership",(e,t)=>{e.isSpaceRoom()||("invite"===t?this.addInvitedRoom(e):this.state.invitedRoomIds.has(e.roomId)&&this.removeInvitedRoom(e.roomId))}),i()(this,"addInvitedRoom",e=>{this.setState(t=>{let{invitedRoomIds:a}=t;return{invitedRoomIds:new Set(a).add(e.roomId)}})}),i()(this,"removeInvitedRoom",e=>{this.setState(t=>{let{invitedRoomIds:a}=t;const n=new Set(a);return n.delete(e),{invitedRoomIds:n}})}),i()(this,"onUserUnignored",async e=>{const{ignoredUserIds:t,waitingUnignored:a}=this.state,n=t.filter(e=>!a.includes(e)),i=n.indexOf(e);-1!==i&&(n.splice(i,1),this.setState(t=>{let{waitingUnignored:a}=t;return{waitingUnignored:[...a,e]}}),u.a.get().setIgnoredUsers(n))}),i()(this,"getInvitedRooms",()=>u.a.get().getRooms().filter(e=>e.hasMembershipState(u.a.get().getUserId(),"invite"))),i()(this,"manageInvites",async e=>{this.setState({managingInvites:!0});const t=Array.from(this.state.invitedRoomIds),a=u.a.get(),n=e?a.joinRoom.bind(a):a.leave.bind(a);for(let e=0;e<t.length;e++){const a=t[e];await n(a).then(()=>{this.removeInvitedRoom(a)},async t=>{"M_LIMIT_EXCEEDED"===t.errcode?(await Object(nt.H)(t.retry_after_ms||2500),e--):d.a.warn(t)})}this.setState({managingInvites:!1})}),i()(this,"onAcceptAllInvitesClicked",()=>{this.manageInvites(!0)}),i()(this,"onRejectAllInvitesClicked",()=>{this.manageInvites(!1)}),i()(this,"onShowQRClicked",()=>{this.setState({showLoginWithQR:va.a.Show})}),i()(this,"onLoginWithQRFinished",()=>{this.setState({showLoginWithQR:null})});const t=new Set(this.getInvitedRooms().map(e=>e.roomId));this.state={ignoredUserIds:u.a.get().getIgnoredUsers(),waitingUnignored:[],managingInvites:!1,invitedRoomIds:t,showLoginWithQR:null}}componentDidMount(){this.dispatcherRef=L.a.register(this.onAction),u.a.get().on(it.d.MyMembership,this.onMyMembership),u.a.get().getVersions().then(e=>this.setState({versions:e}))}componentWillUnmount(){L.a.unregister(this.dispatcherRef),u.a.get().removeListener(it.d.MyMembership,this.onMyMembership)}renderIgnoredUsers(){const{waitingUnignored:e,ignoredUserIds:t}=this.state,a=null!=t&&t.length?t.map(t=>s.a.createElement(ya,{userId:t,onUnignored:this.onUserUnignored,key:t,inProgress:e.includes(t)})):Object(c.a)("You have no ignored users.");return s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Ignored users")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},a))}renderManageInvites(){const{invitedRoomIds:e}=this.state;return 0===e.size?null:s.a.createElement("div",{className:"mx_SettingsTab_section mx_SecurityUserSettingsTab_bulkOptions"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Bulk options")),s.a.createElement(b.a,{onClick:this.onAcceptAllInvitesClicked,kind:"primary",disabled:this.state.managingInvites},Object(c.a)("Accept all %(invitedRooms)s invites",{invitedRooms:e.size})),s.a.createElement(b.a,{onClick:this.onRejectAllInvitesClicked,kind:"danger",disabled:this.state.managingInvites},Object(c.a)("Reject all %(invitedRooms)s invites",{invitedRooms:e.size})),this.state.managingInvites?s.a.createElement(Se.a,null):s.a.createElement("div",null))}render(){const e=s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Secure Backup")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement(lt,null))),t=s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Message search")),s.a.createElement(ma,null)),a=s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Cross-signing")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement(la,null)));let n,i,r;if(Object(ga.c)()||(n=s.a.createElement("div",{className:"mx_SecurityUserSettingsTab_warning"},Object(c.a)("Your server admin has disabled end-to-end encryption by default in private rooms & Direct Messages."))),ha.a.instance.isEnabled()){const e=()=>{Object(pa.b)({primaryButton:Object(c.a)("Okay"),hasCancel:!1})};i=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Privacy")),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Analytics")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement("p",null,Object(c.a)("Share anonymous data to help us identify issues. Nothing personal. No third parties.")),s.a.createElement(b.a,{kind:"link",onClick:e},Object(c.a)("Learn more"))),ha.a.instance.isEnabled()&&s.a.createElement(Me.a,{name:"pseudonymousAnalyticsOptIn",level:H.a.ACCOUNT})),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Sessions")),s.a.createElement(Me.a,{name:"deviceClientInformationOptIn",level:H.a.ACCOUNT})))}if(C.b.getValue(G.b.AdvancedSettings)){const e=this.renderIgnoredUsers(),t=this.renderManageInvites(),a=C.b.isEnabled("e2ee.manuallyVerifyAllSessions")?s.a.createElement(dt,null):null;(e||t||a)&&(r=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Advanced")),s.a.createElement("div",{className:"mx_SettingsTab_section"},e,t,a)))}const o=C.b.getValue("feature_new_device_manager"),l=C.b.getValue("feature_qr_signin_reciprocate_show"),d=o?null:s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Where you're signed in")),s.a.createElement("div",{className:"mx_SettingsTab_section","data-testid":"devices-section"},s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Manage your signed-in devices below. A device's name is visible to people you communicate with.")),s.a.createElement(ra,null)),l?s.a.createElement(ba,{onShowQr:this.onShowQRClicked,versions:this.state.versions}):null),m=u.a.get();return l&&this.state.showLoginWithQR?s.a.createElement("div",{className:"mx_SettingsTab mx_SecurityUserSettingsTab"},s.a.createElement(va.b,{onFinished:this.onLoginWithQRFinished,mode:this.state.showLoginWithQR,client:m})):s.a.createElement("div",{className:"mx_SettingsTab mx_SecurityUserSettingsTab"},n,d,s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Encryption")),s.a.createElement("div",{className:"mx_SettingsTab_section"},e,t,a,s.a.createElement(mt,null)),i,r)}}var _a=a(210);class wa{static encodeActions(e){const t=e.notify,a=e.sound,n=e.highlight;if(t){const e=[_a.d.Notify];return a&&e.push({set_tweak:"sound",value:a}),n?e.push({set_tweak:"highlight"}):e.push({set_tweak:"highlight",value:!1}),e}return[_a.d.DontNotify]}static decodeActions(e){let t=!1,a=null,n=!1;for(let i=0;i<e.length;++i){const r=e[i];if(r===_a.d.Notify)t=!0;else if(r===_a.d.DontNotify)t=!1;else{if("object"!=typeof r)return null;if("sound"===r.set_tweak)a=r.value;else{if("highlight"!==r.set_tweak)return null;n=r.value}}}void 0===n&&(n=!0);const i={notify:t,highlight:n};return null!==a&&(i.sound=a),i}}const Sa=wa.encodeActions;class Oa{}let Ca;i()(Oa,"ACTION_NOTIFY",Sa({notify:!0})),i()(Oa,"ACTION_NOTIFY_DEFAULT_SOUND",Sa({notify:!0,sound:"default"})),i()(Oa,"ACTION_NOTIFY_RING_SOUND",Sa({notify:!0,sound:"ring"})),i()(Oa,"ACTION_HIGHLIGHT",Sa({notify:!0,highlight:!0})),i()(Oa,"ACTION_HIGHLIGHT_DEFAULT_SOUND",Sa({notify:!0,sound:"default",highlight:!0})),i()(Oa,"ACTION_DONT_NOTIFY",Sa({notify:!1})),i()(Oa,"ACTION_DISABLED",null),function(e){e.Off="off",e.On="on",e.Loud="loud"}(Ca||(Ca={}));class xa{static actionsFor(e){return e===Ca.On?Oa.ACTION_NOTIFY:e===Ca.Loud?Oa.ACTION_HIGHLIGHT_DEFAULT_SOUND:void 0}static contentRuleVectorStateKind(e){const t=wa.decodeActions(e.actions);if(!t)return null;let a=0;t.sound&&a++,t.highlight&&a++;let n=null;switch(a){case 0:n=Ca.On;break;case 2:n=Ca.Loud}return n}}i()(xa,"OFF",Ca.Off),i()(xa,"ON",Ca.On),i()(xa,"LOUD",Ca.Loud),i()(xa,"states",Ca);class ka{constructor(e){i()(this,"description",void 0),i()(this,"vectorStateToActions",void 0),this.description=e.description,this.vectorStateToActions=e.vectorStateToActions}ruleToVectorState(e){let t=!1;e&&(t=e.enabled);for(const a in xa.states){const n=xa.states[a],i=this.vectorStateToActions[n];if(i){if(t&&JSON.stringify(wa.decodeActions(e.actions))===JSON.stringify(wa.decodeActions(i)))return n}else if(!t)return n}d.a.error(`Cannot translate rule actions into Vector rule state. Rule: ${JSON.stringify(e)}, Expected: `+JSON.stringify(this.vectorStateToActions))}}const ja={".m.rule.contains_display_name":new ka({description:Object(c.c)("Messages containing my display name"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_HIGHLIGHT_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DISABLED}}),".m.rule.contains_user_name":new ka({description:Object(c.c)("Messages containing my username"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_HIGHLIGHT_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DISABLED}}),".m.rule.roomnotif":new ka({description:Object(c.c)("Messages containing @room"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_HIGHLIGHT,[Ca.Off]:Oa.ACTION_DISABLED}}),".m.rule.room_one_to_one":new ka({description:Object(c.c)("Messages in one-to-one chats"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_NOTIFY_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DONT_NOTIFY}}),".m.rule.encrypted_room_one_to_one":new ka({description:Object(c.c)("Encrypted messages in one-to-one chats"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_NOTIFY_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DONT_NOTIFY}}),".m.rule.message":new ka({description:Object(c.c)("Messages in group chats"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_NOTIFY_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DONT_NOTIFY}}),".m.rule.encrypted":new ka({description:Object(c.c)("Encrypted messages in group chats"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_NOTIFY_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DONT_NOTIFY}}),".m.rule.invite_for_me":new ka({description:Object(c.c)("When I'm invited to a room"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_NOTIFY_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DISABLED}}),".m.rule.call":new ka({description:Object(c.c)("Call invitation"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_NOTIFY_RING_SOUND,[Ca.Off]:Oa.ACTION_DISABLED}}),".m.rule.suppress_notices":new ka({description:Object(c.c)("Messages sent by bot"),vectorStateToActions:{[Ca.On]:Oa.ACTION_DISABLED,[Ca.Loud]:Oa.ACTION_NOTIFY_DEFAULT_SOUND,[Ca.Off]:Oa.ACTION_DONT_NOTIFY}}),".m.rule.tombstone":new ka({description:Object(c.c)("When rooms are upgraded"),vectorStateToActions:{[Ca.On]:Oa.ACTION_NOTIFY,[Ca.Loud]:Oa.ACTION_HIGHLIGHT,[Ca.Off]:Oa.ACTION_DISABLED}})};class Ra{static parseContentRules(e){const t=Ra.categoriseContentRules(e);return t.loud.length?{vectorState:Ca.Loud,rules:t.loud,externalRules:[...t.loud_but_disabled,...t.on,...t.on_but_disabled,...t.other]}:t.loud_but_disabled.length?{vectorState:Ca.Off,rules:t.loud_but_disabled,externalRules:[...t.on,...t.on_but_disabled,...t.other]}:t.on.length?{vectorState:Ca.On,rules:t.on,externalRules:[...t.on_but_disabled,...t.other]}:t.on_but_disabled.length?{vectorState:Ca.Off,rules:t.on_but_disabled,externalRules:t.other}:{vectorState:Ca.On,rules:[],externalRules:t.other}}static categoriseContentRules(e){const t={on:[],on_but_disabled:[],loud:[],loud_but_disabled:[],other:[]};for(const a in e.global)for(let n=0;n<Object.keys(e.global[a]).length;++n){const i=e.global[a][n];if("."!==i.rule_id[0]&&a===_a.e.ContentSpecific)switch(i.kind=a,xa.contentRuleVectorStateKind(i)){case Ca.On:i.enabled?t.on.push(i):t.on_but_disabled.push(i);break;case Ca.Loud:i.enabled?t.loud.push(i):t.loud_but_disabled.push(i);break;default:t.other.push(i)}}return t}}var Ia=a(864);const Ta=e=>{let{icon:t,label:a,onDeleteClick:n,disabled:i=!1}=e;return s.a.createElement("div",{className:"mx_Tag"},null==t?void 0:t(),a,n&&s.a.createElement(b.a,{className:"mx_Tag_delete",onClick:n,disabled:i},s.a.createElement(Ia.a,null)))};class Na extends s.a.PureComponent{constructor(e){super(e),i()(this,"onInputChange",e=>{this.setState({newTag:e.target.value})}),i()(this,"onAdd",e=>{e.preventDefault(),this.state.newTag&&(this.props.onAdd(this.state.newTag),this.setState({newTag:""}))}),this.state={newTag:""}}onRemove(e){this.props.onRemove(e)}render(){return s.a.createElement("div",{className:"mx_TagComposer"},s.a.createElement("form",{className:"mx_TagComposer_input",onSubmit:this.onAdd},s.a.createElement(m.a,{value:this.state.newTag,onChange:this.onInputChange,label:this.props.label||Object(c.a)("Keyword"),placeholder:this.props.placeholder||Object(c.a)("New keyword"),disabled:this.props.disabled,autoComplete:"off"}),s.a.createElement(b.a,{onClick:this.onAdd,kind:"primary",disabled:this.props.disabled},Object(c.a)("Add"))),s.a.createElement("div",{className:"mx_TagComposer_tags"},this.props.tags.map((e,t)=>s.a.createElement(Ta,{label:e,key:e,onDeleteClick:this.onRemove.bind(this,e),disabled:this.props.disabled}))))}}var Da,Pa,Ma=a(125),Aa=a(354);function La(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ua(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?La(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):La(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}!function(e){e.Loading="loading",e.Ready="ready",e.Persisting="persisting",e.Error="error"}(Da||(Da={})),function(e){e.Master="master",e.VectorGlobal="vector_global",e.VectorMentions="vector_mentions",e.VectorOther="vector_other",e.Other="other"}(Pa||(Pa={}));const Fa=Pa.VectorMentions,Ba=[_a.f.DM,_a.f.EncryptedDM,_a.f.Message,_a.f.EncryptedMessage,_a.f.ContainsDisplayName,_a.f.ContainsUserName,_a.f.AtRoomNotification,_a.f.InviteToSelf,_a.f.IncomingCall,_a.f.SuppressNotices,_a.f.Tombstone];class Va extends s.a.PureComponent{constructor(e){var t,a;super(e),a=this,i()(this,"settingWatchers",void 0),i()(this,"onMasterRuleChanged",async e=>{this.setState({phase:Da.Persisting});try{const t=this.state.masterPushRule;await u.a.get().setPushRuleEnabled("global",t.kind,t.rule_id,!e),await this.refreshFromServer()}catch(e){this.setState({phase:Da.Error}),d.a.error("Error updating master push rule:",e),this.showSaveError()}}),i()(this,"updateDeviceNotifications",async e=>{await C.b.setValue("deviceNotificationsEnabled",null,H.a.DEVICE,e)}),i()(this,"onEmailNotificationsChanged",async(e,t)=>{this.setState({phase:Da.Persisting});try{if(t)await u.a.get().setPusher({kind:"email",app_id:"m.email",pushkey:e,app_display_name:"Email Notifications",device_display_name:e,lang:navigator.language,data:{brand:h.b.get().brand},append:!0});else{const t=this.state.pushers.find(t=>"email"===t.kind&&t.pushkey===e);t.kind=null,await u.a.get().setPusher(t)}await this.refreshFromServer()}catch(e){this.setState({phase:Da.Error}),d.a.error("Error updating email pusher:",e),this.showSaveError()}}),i()(this,"onDesktopNotificationsChanged",async e=>{await C.b.setValue("notificationsEnabled",null,H.a.DEVICE,e)}),i()(this,"onDesktopShowBodyChanged",async e=>{await C.b.setValue("notificationBodyEnabled",null,H.a.DEVICE,e)}),i()(this,"onAudioNotificationsChanged",async e=>{await C.b.setValue("audioNotificationsEnabled",null,H.a.DEVICE,e)}),i()(this,"onRadioChecked",async(e,t)=>{this.setState({phase:Da.Persisting});try{const a=u.a.get();if("_keywords"===e.ruleId)for(const e of this.state.vectorKeywordRuleInfo.rules){let n,i;t===Ca.On?(1!==e.actions.length&&(i=xa.actionsFor(t)),this.state.vectorKeywordRuleInfo.vectorState===Ca.Off&&(n=!0)):t===Ca.Loud?(3!==e.actions.length&&(i=xa.actionsFor(t)),this.state.vectorKeywordRuleInfo.vectorState===Ca.Off&&(n=!0)):n=!1,i&&await a.setPushRuleActions("global",e.kind,e.rule_id,i),void 0!==n&&await a.setPushRuleEnabled("global",e.kind,e.rule_id,n)}else{const n=ja[e.ruleId].vectorStateToActions[t];n?(await a.setPushRuleActions("global",e.rule.kind,e.rule.rule_id,n),await a.setPushRuleEnabled("global",e.rule.kind,e.rule.rule_id,!0)):await a.setPushRuleEnabled("global",e.rule.kind,e.rule.rule_id,!1)}await this.refreshFromServer()}catch(e){this.setState({phase:Da.Error}),d.a.error("Error updating push rule:",e),this.showSaveError()}}),i()(this,"onClearNotificationsClicked",()=>{const e=u.a.get();e.getRooms().forEach(t=>{if(t.getUnreadNotificationCount()>0){const a=t.getLiveTimeline().getEvents();a.length&&e.sendReadReceipt(a[a.length-1])}})}),i()(this,"onKeywordAdd",e=>{const t=Object(fe.a)(this.state.vectorKeywordRuleInfo.rules);this.setState({phase:Da.Persisting,vectorKeywordRuleInfo:Ua(Ua({},this.state.vectorKeywordRuleInfo),{},{rules:[...this.state.vectorKeywordRuleInfo.rules,{pattern:e}]})},async()=>{await this.setKeywords(this.state.vectorKeywordRuleInfo.rules.map(e=>e.pattern),t)})}),i()(this,"onKeywordRemove",e=>{const t=Object(fe.a)(this.state.vectorKeywordRuleInfo.rules);this.setState({phase:Da.Persisting,vectorKeywordRuleInfo:Ua(Ua({},this.state.vectorKeywordRuleInfo),{},{rules:this.state.vectorKeywordRuleInfo.rules.filter(t=>t.pattern!==e)})},async()=>{await this.setKeywords(this.state.vectorKeywordRuleInfo.rules.map(e=>e.pattern),t)})}),this.state={phase:Da.Loading,deviceNotificationsEnabled:null===(t=C.b.getValue("deviceNotificationsEnabled"))||void 0===t||t,desktopNotifications:C.b.getValue("notificationsEnabled"),desktopShowBody:C.b.getValue("notificationBodyEnabled"),audioNotifications:C.b.getValue("audioNotificationsEnabled")},this.settingWatchers=[C.b.watchSetting("notificationsEnabled",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,,i]=t;return a.setState({desktopNotifications:i})})),C.b.watchSetting("deviceNotificationsEnabled",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,,i]=t;a.setState({deviceNotificationsEnabled:i})})),C.b.watchSetting("notificationBodyEnabled",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,,i]=t;return a.setState({desktopShowBody:i})})),C.b.watchSetting("audioNotificationsEnabled",null,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];let[,,,,i]=t;return a.setState({audioNotifications:i})}))]}get isInhibited(){var e;return null===(e=this.state.masterPushRule)||void 0===e?void 0:e.enabled}componentDidMount(){this.refreshFromServer(),this.refreshFromAccountData()}componentWillUnmount(){this.settingWatchers.forEach(e=>C.b.unwatchSetting(e))}componentDidUpdate(e,t){this.state.deviceNotificationsEnabled!==t.deviceNotificationsEnabled&&this.persistLocalNotificationSettings(this.state.deviceNotificationsEnabled)}async refreshFromServer(){try{const e=(await Promise.all([this.refreshRules(),this.refreshPushers(),this.refreshThreepids()])).reduce((e,t)=>Object.assign(t,e),{});this.setState(Ua(Ua({},e),{},{phase:Da.Ready}))}catch(e){d.a.error("Error setting up notifications for settings: ",e),this.setState({phase:Da.Error})}}async refreshFromAccountData(){const e=u.a.get(),t=e.getAccountData(Object(Aa.b)(e.deviceId));if(t){const e=!t.getContent().is_silenced;await this.updateDeviceNotifications(e)}}persistLocalNotificationSettings(e){const t=u.a.get();return t.setAccountData(Object(Aa.b)(t.deviceId),{is_silenced:!e})}async refreshRules(){const e=await u.a.get().getPushRules(),t={[_a.f.Master]:Pa.Master,[_a.f.DM]:Pa.VectorGlobal,[_a.f.EncryptedDM]:Pa.VectorGlobal,[_a.f.Message]:Pa.VectorGlobal,[_a.f.EncryptedMessage]:Pa.VectorGlobal,[_a.f.ContainsDisplayName]:Pa.VectorMentions,[_a.f.ContainsUserName]:Pa.VectorMentions,[_a.f.AtRoomNotification]:Pa.VectorMentions,[_a.f.InviteToSelf]:Pa.VectorOther,[_a.f.IncomingCall]:Pa.VectorOther,[_a.f.SuppressNotices]:Pa.VectorOther,[_a.f.Tombstone]:Pa.VectorOther},a={[Pa.Master]:[],[Pa.VectorGlobal]:[],[Pa.VectorMentions]:[],[Pa.VectorOther]:[],[Pa.Other]:[]};for(const i in e.global){const r=i;for(const i of e.global[r]){var n;const e=Object.assign(i,{kind:r}),s=null!==(n=t[e.rule_id])&&void 0!==n?n:Pa.Other;"."===e.rule_id[0]&&a[s].push(e)}}const i={};if(!(a.master.length>0))throw new Error("Failed to locate a master push rule");i.masterPushRule=a.master[0],i.vectorKeywordRuleInfo=Ra.parseContentRules(e),i.vectorPushRules={};const r=[Pa.VectorGlobal,Pa.VectorMentions,Pa.VectorOther];for(const e of r){i.vectorPushRules[e]=[];for(const t of a[e]){const a=ja[t.rule_id],n=a.ruleToVectorState(t);i.vectorPushRules[e].push({ruleId:t.rule_id,rule:t,vectorState:n,description:Object(c.a)(a.description)})}i.vectorPushRules[e].sort((e,t)=>{let a=Ba.indexOf(e.ruleId),n=Ba.indexOf(t.ruleId);return a<0&&(a=Ba.length),n<0&&(n=Ba.length),a-n}),e===Fa&&i.vectorPushRules[e].push({ruleId:"_keywords",description:Object(c.a)("Messages containing keywords"),vectorState:i.vectorKeywordRuleInfo.vectorState})}return i}refreshPushers(){return u.a.get().getPushers()}refreshThreepids(){return u.a.get().getThreePids()}showSaveError(){g.a.createDialog(v.a,{title:Object(c.a)("Error saving notification preferences"),description:Object(c.a)("An error occurred whilst saving your notification preferences.")})}async setKeywords(e,t){try{e=Array.from(new Set(e)).filter(e=>!!e);const a=Array.from(new Set(t.map(e=>e.pattern))).filter(e=>!!e),n=Object(Ma.a)(a,e);for(const e of n.removed)for(const a of t.filter(t=>t.pattern===e))await u.a.get().deletePushRule("global",a.kind,a.rule_id);let i=this.state.vectorKeywordRuleInfo.vectorState;i===Ca.Off&&(i=t.length?xa.contentRuleVectorStateKind(t[0]):Ca.On);const r=_a.e.ContentSpecific;for(const e of n.added)await u.a.get().addPushRule("global",r,e,{actions:xa.actionsFor(i),pattern:e}),i===Ca.Off&&await u.a.get().setPushRuleEnabled("global",r,e,!1);await this.refreshFromServer()}catch(e){this.setState({phase:Da.Error}),d.a.error("Error updating keyword push rules:",e),this.showSaveError()}}renderTopSection(){const e=s.a.createElement(De.a,{"data-test-id":"notif-master-switch",value:!this.isInhibited,label:Object(c.a)("Enable notifications for this account"),caption:Object(c.a)("Turn off to disable notifications on all your devices and sessions"),onChange:this.onMasterRuleChanged,disabled:this.state.phase===Da.Persisting});if(this.isInhibited)return e;const t=(this.state.threepids||[]).filter(e=>e.medium===q.Email).map(e=>s.a.createElement(De.a,{"data-test-id":"notif-email-switch",key:e.address,value:this.state.pushers.some(t=>"email"===t.kind&&t.pushkey===e.address),label:Object(c.a)("Enable email notifications for %(email)s",{email:e.address}),onChange:this.onEmailNotificationsChanged.bind(this,e.address),disabled:this.state.phase===Da.Persisting}));return s.a.createElement(s.a.Fragment,null,e,s.a.createElement(De.a,{"data-test-id":"notif-device-switch",value:this.state.deviceNotificationsEnabled,label:Object(c.a)("Enable notifications for this device"),onChange:e=>this.updateDeviceNotifications(e),disabled:this.state.phase===Da.Persisting}),this.state.deviceNotificationsEnabled&&s.a.createElement(s.a.Fragment,null,s.a.createElement(De.a,{"data-test-id":"notif-setting-notificationsEnabled",value:this.state.desktopNotifications,onChange:this.onDesktopNotificationsChanged,label:Object(c.a)("Enable desktop notifications for this session"),disabled:this.state.phase===Da.Persisting}),s.a.createElement(De.a,{"data-test-id":"notif-setting-notificationBodyEnabled",value:this.state.desktopShowBody,onChange:this.onDesktopShowBodyChanged,label:Object(c.a)("Show message in desktop notification"),disabled:this.state.phase===Da.Persisting}),s.a.createElement(De.a,{"data-test-id":"notif-setting-audioNotificationsEnabled",value:this.state.audioNotifications,onChange:this.onAudioNotificationsChanged,label:Object(c.a)("Enable audible notifications for this session"),disabled:this.state.phase===Da.Persisting})),t)}renderCategory(e){if(e!==Pa.VectorOther&&this.isInhibited)return null;let t,a;if(e===Pa.VectorOther&&u.a.get().getRooms().some(e=>e.getUnreadNotificationCount()>0)&&(t=s.a.createElement(b.a,{onClick:this.onClearNotificationsClicked,kind:"danger",className:"mx_UserNotifSettings_clearNotifsButton"},Object(c.a)("Clear notifications"))),e===Pa.VectorOther&&this.isInhibited)return t?s.a.createElement("div",{className:"mx_UserNotifSettings_floatingSection"},s.a.createElement("div",null,Object(c.a)("Other")),t):null;var n;e===Pa.VectorMentions&&(a=s.a.createElement(Na,{tags:null===(n=this.state.vectorKeywordRuleInfo)||void 0===n?void 0:n.rules.map(e=>e.pattern),onAdd:this.onKeywordAdd,onRemove:this.onKeywordRemove,disabled:this.state.phase===Da.Persisting,label:Object(c.a)("Keyword"),placeholder:Object(c.a)("New keyword")}));const i={[Ca.On]:Object(c.a)("On"),[Ca.Off]:Object(c.a)("Off"),[Ca.Loud]:Object(c.a)("Noisy")},r=(e,t)=>s.a.createElement(Ke.a,{key:e.ruleId+t,name:e.ruleId,checked:e.vectorState===t,onChange:this.onRadioChecked.bind(this,e,t),disabled:this.state.phase===Da.Persisting,"aria-label":i[t]}),o=this.state.vectorPushRules[e].map(t=>s.a.createElement("fieldset",{key:e+t.ruleId,"data-test-id":e+t.ruleId,className:"mx_UserNotifSettings_gridRowContainer"},s.a.createElement("legend",{className:"mx_UserNotifSettings_gridRowLabel"},t.description),r(t,Ca.Off),r(t,Ca.On),r(t,Ca.Loud)));let l;switch(e){case Pa.VectorGlobal:l=Object(c.a)("Global");break;case Pa.VectorMentions:l=Object(c.a)("Mentions & keywords");break;case Pa.VectorOther:l=Object(c.a)("Other");break;default:throw new Error("Developer error: Unnamed notifications section: "+e)}return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{"data-test-id":"notif-section-"+e,className:"mx_UserNotifSettings_grid"},s.a.createElement("span",{className:"mx_UserNotifSettings_gridRowLabel mx_UserNotifSettings_gridRowHeading"},l),s.a.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},i[Ca.Off]),s.a.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},i[Ca.On]),s.a.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},i[Ca.Loud]),o),t,a)}renderTargets(){if(this.isInhibited)return null;const e=this.state.pushers.map(e=>s.a.createElement("tr",{key:e.kind+e.pushkey},s.a.createElement("td",null,e.app_display_name),s.a.createElement("td",null,e.device_display_name)));return e.length?s.a.createElement("div",{className:"mx_UserNotifSettings_floatingSection"},s.a.createElement("div",null,Object(c.a)("Notification targets")),s.a.createElement("table",null,s.a.createElement("tbody",null,e))):null}render(){return this.state.phase===Da.Loading?s.a.createElement(R.a,null):this.state.phase===Da.Error?s.a.createElement("p",{"data-test-id":"error-message"},Object(c.a)("There was an error loading your notification settings.")):s.a.createElement("div",{className:"mx_UserNotifSettings"},this.renderTopSection(),this.renderCategory(Pa.VectorGlobal),this.renderCategory(Pa.VectorMentions),this.renderCategory(Pa.VectorOther),this.renderTargets())}}class za extends s.a.Component{render(){return s.a.createElement("div",{className:"mx_SettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Notifications")),s.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},s.a.createElement(Va,null)))}}var Wa=a(170),Ha=a(445);class Ga extends s.a.Component{constructor(e){super(e),i()(this,"onAutocompleteDelayChange",e=>{this.setState({autocompleteDelay:e.target.value}),C.b.setValue("autocompleteDelay",null,H.a.DEVICE,e.target.value)}),i()(this,"onReadMarkerInViewThresholdMs",e=>{this.setState({readMarkerInViewThresholdMs:e.target.value}),C.b.setValue("readMarkerInViewThresholdMs",null,H.a.DEVICE,e.target.value)}),i()(this,"onReadMarkerOutOfViewThresholdMs",e=>{this.setState({readMarkerOutOfViewThresholdMs:e.target.value}),C.b.setValue("readMarkerOutOfViewThresholdMs",null,H.a.DEVICE,e.target.value)}),i()(this,"onKeyboardShortcutsClicked",()=>{L.a.dispatch({action:U.a.ViewUserSettings,initialTabId:Wa.a.Keyboard})}),this.state={disablingReadReceiptsSupported:!1,autocompleteDelay:C.b.getValueAt(H.a.DEVICE,"autocompleteDelay").toString(10),readMarkerInViewThresholdMs:C.b.getValueAt(H.a.DEVICE,"readMarkerInViewThresholdMs").toString(10),readMarkerOutOfViewThresholdMs:C.b.getValueAt(H.a.DEVICE,"readMarkerOutOfViewThresholdMs").toString(10)}}async componentDidMount(){const e=u.a.get();this.setState({disablingReadReceiptsSupported:await e.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")||await e.isVersionSupported("v1.4")})}renderGroup(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H.a.ACCOUNT;return e.map(e=>{const a=!C.b.isEnabled(e);return s.a.createElement(Me.a,{key:e,name:e,level:t,disabled:a})})}render(){const e=C.b.getValue("FTUE.useCaseSelection"),t=Ga.ROOM_LIST_SETTINGS.filter(e=>"breadcrumbs"!==e||!C.b.getValue("feature_breadcrumbs_v2")).filter(t=>"FTUE.userOnboardingButton"!==t||Object(Ha.b)(e));return s.a.createElement("div",{className:"mx_SettingsTab mx_PreferencesUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Preferences")),t.length>0&&s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Room list")),this.renderGroup(t)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Spaces")),this.renderGroup(Ga.SPACES_SETTINGS,H.a.ACCOUNT)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Keyboard shortcuts")),s.a.createElement("div",{className:"mx_SettingsFlag"},Object(c.a)("To view all keyboard shortcuts, <a>click here</a>.",{},{a:e=>s.a.createElement(b.a,{kind:"link_inline",onClick:this.onKeyboardShortcutsClicked},e)})),this.renderGroup(Ga.KEYBINDINGS_SETTINGS)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Displaying time")),this.renderGroup(Ga.TIME_SETTINGS)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Presence")),s.a.createElement("span",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Share your activity and status with others.")),s.a.createElement(Me.a,{disabled:!this.state.disablingReadReceiptsSupported&&C.b.getValue("sendReadReceipts"),disabledDescription:Object(c.a)("Your server doesn't support disabling sending read receipts."),name:"sendReadReceipts",level:H.a.ACCOUNT}),this.renderGroup(Ga.PRESENCE_SETTINGS)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Composer")),this.renderGroup(Ga.COMPOSER_SETTINGS)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Code blocks")),this.renderGroup(Ga.CODE_BLOCKS_SETTINGS)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Images, GIFs and videos")),this.renderGroup(Ga.IMAGES_AND_VIDEOS_SETTINGS)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Timeline")),this.renderGroup(Ga.TIMELINE_SETTINGS)),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("General")),this.renderGroup(Ga.GENERAL_SETTINGS),s.a.createElement(Me.a,{name:"Electron.showTrayIcon",level:H.a.PLATFORM,hideIfCannotSet:!0}),s.a.createElement(Me.a,{name:"Electron.enableHardwareAcceleration",level:H.a.PLATFORM,hideIfCannotSet:!0,label:Object(c.a)("Enable hardware acceleration (restart %(appName)s to take effect)",{appName:h.b.get().brand})}),s.a.createElement(Me.a,{name:"Electron.alwaysShowMenuBar",level:H.a.PLATFORM,hideIfCannotSet:!0}),s.a.createElement(Me.a,{name:"Electron.autoLaunch",level:H.a.PLATFORM,hideIfCannotSet:!0}),s.a.createElement(Me.a,{name:"Electron.warnBeforeExit",level:H.a.PLATFORM,hideIfCannotSet:!0}),s.a.createElement(m.a,{label:Object(c.a)("Autocomplete delay (ms)"),type:"number",value:this.state.autocompleteDelay,onChange:this.onAutocompleteDelayChange}),s.a.createElement(m.a,{label:Object(c.a)("Read Marker lifetime (ms)"),type:"number",value:this.state.readMarkerInViewThresholdMs,onChange:this.onReadMarkerInViewThresholdMs}),s.a.createElement(m.a,{label:Object(c.a)("Read Marker off-screen lifetime (ms)"),type:"number",value:this.state.readMarkerOutOfViewThresholdMs,onChange:this.onReadMarkerOutOfViewThresholdMs})))}}i()(Ga,"ROOM_LIST_SETTINGS",["breadcrumbs","FTUE.userOnboardingButton"]),i()(Ga,"SPACES_SETTINGS",["Spaces.allRoomsInHome"]),i()(Ga,"KEYBINDINGS_SETTINGS",["ctrlFForSearch"]),i()(Ga,"PRESENCE_SETTINGS",["sendTypingNotifications"]),i()(Ga,"COMPOSER_SETTINGS",["MessageComposerInput.autoReplaceEmoji","MessageComposerInput.useMarkdown","MessageComposerInput.suggestEmoji","MessageComposerInput.ctrlEnterToSend","MessageComposerInput.surroundWith","MessageComposerInput.showStickersButton","MessageComposerInput.insertTrailingColon"]),i()(Ga,"TIME_SETTINGS",["showTwelveHourTimestamps","alwaysShowTimestamps"]),i()(Ga,"CODE_BLOCKS_SETTINGS",["enableSyntaxHighlightLanguageDetection","expandCodeByDefault","showCodeLineNumbers"]),i()(Ga,"IMAGES_AND_VIDEOS_SETTINGS",["urlPreviewsEnabled","autoplayGifs","autoplayVideo","showImages"]),i()(Ga,"TIMELINE_SETTINGS",["showTypingNotifications","showRedactions","showReadReceipts","showJoinLeaves","showDisplaynameChanges","showChatEffects","showAvatarChanges","Pill.shouldShowPillAvatar","TextualBody.enableBigEmoji","scrollToBottomOnMessageSent","useOnlyCurrentProfiles"]),i()(Ga,"GENERAL_SETTINGS",["promptBeforeInviteUnknownUsers"]);var qa=a(232);class Ka extends s.a.Component{constructor(e){super(e),i()(this,"refreshMediaDevices",async e=>{this.setState({mediaDevices:await qa.c.getDevices(),[qa.b.AudioOutput]:qa.c.getAudioOutput(),[qa.b.AudioInput]:qa.c.getAudioInput(),[qa.b.VideoInput]:qa.c.getVideoInput()}),e&&e.getTracks().forEach(e=>e.stop())}),i()(this,"requestMediaPermissions",async()=>{let e,t,a;try{e={video:!0,audio:!0},t=await navigator.mediaDevices.getUserMedia(e)}catch(n){if("NotFoundError"===n.name){e={audio:!0};try{t=await navigator.mediaDevices.getUserMedia(e)}catch(e){a=e}}else a=n}if(a){d.a.log("Failed to list userMedia devices",a);const e=h.b.get().brand;g.a.createDialog(v.a,{title:Object(c.a)("No media permissions"),description:Object(c.a)("You may need to manually permit %(brand)s to access your microphone/webcam",{brand:e})})}else this.refreshMediaDevices(t)}),i()(this,"setDevice",(e,t)=>{qa.c.instance.setDevice(e,t),this.setState({[t]:e})}),i()(this,"changeWebRtcMethod",e=>{u.a.get().setForceTURN(!e)}),i()(this,"changeFallbackICEServerAllowed",e=>{u.a.get().setFallbackICEServerAllowed(e)}),this.state={mediaDevices:null,[qa.b.AudioOutput]:null,[qa.b.AudioInput]:null,[qa.b.VideoInput]:null}}async componentDidMount(){await qa.c.hasAnyLabeledDevices()&&this.refreshMediaDevices()}renderDeviceOptions(e,t){return e.map(e=>s.a.createElement("option",{key:`${t}-${e.deviceId}`,value:e.deviceId},e.label))}renderDropdown(e,t){const a=this.state.mediaDevices[e].slice(0);if(0===a.length)return null;const n=(e=>e.some(e=>"default"===e.deviceId)?"default":(e.unshift({deviceId:"",label:Object(c.a)("Default Device")}),""))(a);return s.a.createElement(m.a,{element:"select",label:t,value:this.state[e]||n,onChange:t=>this.setDevice(t.target.value,e)},this.renderDeviceOptions(a,e))}render(){let e=null,t=null,a=null,n=null;return this.state.mediaDevices?this.state.mediaDevices&&(t=this.renderDropdown(qa.b.AudioOutput,Object(c.a)("Audio Output"))||s.a.createElement("p",null,Object(c.a)("No Audio Outputs detected")),a=this.renderDropdown(qa.b.AudioInput,Object(c.a)("Microphone"))||s.a.createElement("p",null,Object(c.a)("No Microphones detected")),n=this.renderDropdown(qa.b.VideoInput,Object(c.a)("Camera"))||s.a.createElement("p",null,Object(c.a)("No Webcams detected"))):e=s.a.createElement("div",{className:"mx_VoiceUserSettingsTab_missingMediaPermissions"},s.a.createElement("p",null,Object(c.a)("Missing media permissions, click the button below to request.")),s.a.createElement(b.a,{onClick:this.requestMediaPermissions,kind:"primary"},Object(c.a)("Request media permissions"))),s.a.createElement("div",{className:"mx_SettingsTab mx_VoiceUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Voice & Video")),s.a.createElement("div",{className:"mx_SettingsTab_section"},e,t,a,n,s.a.createElement(Me.a,{name:"VideoView.flipVideoHorizontally",level:H.a.ACCOUNT}),s.a.createElement(Me.a,{name:"webRtcAllowPeerToPeer",level:H.a.DEVICE,onChange:this.changeWebRtcMethod}),s.a.createElement(Me.a,{name:"fallbackICEServerAllowed",level:H.a.DEVICE,onChange:this.changeFallbackICEServerAllowed})))}}var Ya=a(187),Ja=a(103),$a=a.n(Ja),Qa=a(317),Xa=a(205);const Za=["action"];function en(){j.a.get().installUpdate()}const tn=[Qa.d.Ready,Qa.d.Error,Qa.d.NotAvailable];var an=()=>{const[e,t]=Object(r.useState)(null);Object(Xa.a)(L.a,e=>{let{action:a}=e,n=$a()(e,Za);a===U.a.CheckUpdates&&t(n)});const a=e&&!tn.includes(e.status);let n;return e&&(n=s.a.createElement("span",{className:"mx_UpdateCheckButton_summary"},function(e,t){switch(e){case Qa.d.Error:return Object(c.a)("Error encountered (%(errorDetail)s).",{errorDetail:t});case Qa.d.Checking:return Object(c.a)("Checking for an update...");case Qa.d.NotAvailable:return Object(c.a)("No update available.");case Qa.d.Downloading:return Object(c.a)("Downloading update...");case Qa.d.Ready:return Object(c.a)("New version available. <a>Update now.</a>",{},{a:e=>s.a.createElement(b.a,{kind:"link_inline",onClick:en},e)})}}(e.status,e.detail),a&&s.a.createElement(Se.a,null))),s.a.createElement(s.a.Fragment,null,s.a.createElement(b.a,{onClick:()=>{t(null),j.a.get().startUpdateCheck()},kind:"primary",disabled:a},Object(c.a)("Check for update")),n)},nn=a(250),rn=a(300);class sn extends s.a.Component{constructor(e){super(e),i()(this,"onClearCacheAndReload",e=>{j.a.get()&&(d.a.log("Clear cache & reload clicked"),u.a.get().stopClient(),u.a.get().store.deleteAllData().then(()=>{j.a.get().reload()}))}),i()(this,"onBugReport",e=>{g.a.createDialog(nn.a,{})}),i()(this,"onStartBotChat",e=>{this.props.closeSettingsFn(),Object(Ya.b)({dmUserId:h.b.get("welcome_user_id"),andView:!0})}),i()(this,"getVersionTextToCopy",()=>{const{appVersion:e,olmVersion:t}=this.getVersionInfo();return`${e}\n${t}`}),i()(this,"onKeyboardShortcutsClicked",()=>{L.a.dispatch({action:U.a.ViewUserSettings,initialTabId:Wa.a.Keyboard})}),this.state={appVersion:null,canUpdate:!1}}componentDidMount(){j.a.get().getAppVersion().then(e=>this.setState({appVersion:e})).catch(e=>{d.a.error("Error getting vector version: ",e)}),j.a.get().canSelfUpdate().then(e=>this.setState({canUpdate:e})).catch(e=>{d.a.error("Error getting self updatability: ",e)})}getVersionInfo(){const e=h.b.get().brand,t=this.state.appVersion||"unknown",a=u.a.get().olmVersion,n=a?`${a[0]}.${a[1]}.${a[2]}`:"<not-enabled>";return{appVersion:`${Object(c.a)("%(brand)s version:",{brand:e})} ${t}`,olmVersion:`${Object(c.a)("Olm version:")} ${n}`}}renderLegal(){const e=h.b.get().terms_and_conditions_links;if(!e)return null;const t=[];for(const a of e)t.push(s.a.createElement("div",{key:a.url},s.a.createElement("a",{href:a.url,rel:"noreferrer noopener",target:"_blank"},a.text)));return s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Legal")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},t))}renderCredits(){return s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Credits")),s.a.createElement("ul",{className:"mx_SettingsTab_subsectionText"},s.a.createElement("li",null,"The ",s.a.createElement("a",{href:"themes/element/img/backgrounds/lake.jpg",rel:"noreferrer noopener",target:"_blank"},"default cover photo")," is © ",s.a.createElement("a",{href:"https://www.flickr.com/golan",rel:"noreferrer noopener",target:"_blank"},"Jesús Roncero")," used under the terms of ",s.a.createElement("a",{href:"https://creativecommons.org/licenses/by-sa/4.0/",rel:"noreferrer noopener",target:"_blank"},"CC-BY-SA 4.0"),"."),s.a.createElement("li",null,"The ",s.a.createElement("a",{href:"https://github.com/matrix-org/twemoji-colr",rel:"noreferrer noopener",target:"_blank"},"twemoji-colr")," font is © ",s.a.createElement("a",{href:"https://mozilla.org",rel:"noreferrer noopener",target:"_blank"},"Mozilla Foundation")," used under the terms of ",s.a.createElement("a",{href:"https://www.apache.org/licenses/LICENSE-2.0",rel:"noreferrer noopener",target:"_blank"},"Apache 2.0"),"."),s.a.createElement("li",null,"The ",s.a.createElement("a",{href:"https://twemoji.twitter.com/",rel:"noreferrer noopener",target:"_blank"},"Twemoji")," emoji art is © ",s.a.createElement("a",{href:"https://twemoji.twitter.com/",rel:"noreferrer noopener",target:"_blank"},"Twitter, Inc and other contributors")," used under the terms of ",s.a.createElement("a",{href:"https://creativecommons.org/licenses/by/4.0/",rel:"noreferrer noopener",target:"_blank"},"CC-BY 4.0"),".")))}render(){const e=h.b.get().brand;let t=Object(c.a)("For help with using %(brand)s, click <a>here</a>.",{brand:e},{a:e=>s.a.createElement("a",{href:"https://element.io/help",rel:"noreferrer noopener",target:"_blank"},e)});h.b.get("welcome_user_id")&&Object(c.e)().startsWith("en")&&(t=s.a.createElement("div",null,Object(c.a)("For help with using %(brand)s, click <a>here</a> or start a chat with our bot using the button below.",{brand:e},{a:e=>s.a.createElement("a",{href:"https://element.io/help",rel:"noreferrer noopener",target:"_blank"},e)}),s.a.createElement("div",null,s.a.createElement(b.a,{onClick:this.onStartBotChat,kind:"primary"},Object(c.a)("Chat with %(brand)s Bot",{brand:e})))));let a,n=null;this.state.canUpdate&&(n=s.a.createElement(an,null)),h.b.get().bug_report_endpoint_url&&(a=s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Bug reporting")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("If you've submitted a bug via GitHub, debug logs can help us track down the problem. "),Object(c.a)("Debug logs contain application usage data including your username, the IDs or aliases of the rooms you have visited, which UI elements you last interacted with, and the usernames of other users. They do not contain messages.")),s.a.createElement(b.a,{onClick:this.onBugReport,kind:"primary"},Object(c.a)("Submit debug logs")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("To report a Matrix-related security issue, please read the Matrix.org <a>Security Disclosure Policy</a>.",{},{a:e=>s.a.createElement("a",{href:"https://matrix.org/security-disclosure-policy/",rel:"noreferrer noopener",target:"_blank"},e)}))));const{appVersion:i,olmVersion:r}=this.getVersionInfo();return s.a.createElement("div",{className:"mx_SettingsTab mx_HelpUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Help & About")),a,s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("FAQ")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},t),s.a.createElement(b.a,{kind:"primary",onClick:this.onKeyboardShortcutsClicked},Object(c.a)("Keyboard Shortcuts"))),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Versions")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement(rn.a,{getTextToCopy:this.getVersionTextToCopy},i,s.a.createElement("br",null),r,s.a.createElement("br",null)),n)),this.renderLegal(),this.renderCredits(),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Advanced")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement("div",null,Object(c.a)("Homeserver is")," ",s.a.createElement("code",null,u.a.get().getHomeserverUrl())),s.a.createElement("div",null,Object(c.a)("Identity server is")," ",s.a.createElement("code",null,u.a.get().getIdentityServerUrl())),s.a.createElement("details",null,s.a.createElement("summary",null,Object(c.a)("Access Token")),s.a.createElement("b",null,Object(c.a)("Your access token gives full access to your account. Do not share it with anyone.")),s.a.createElement(rn.a,{getTextToCopy:()=>u.a.get().getAccessToken()},u.a.get().getAccessToken())),s.a.createElement(b.a,{onClick:this.onClearCacheAndReload,kind:"danger"},Object(c.a)("Clear cache and reload")))))}}var on=a(482),cn=a(448);class ln extends s.a.Component{constructor(e){super(e),i()(this,"onPersonalRuleChanged",e=>{this.setState({newPersonalRule:e.target.value})}),i()(this,"onNewListChanged",e=>{this.setState({newList:e.target.value})}),i()(this,"onAddPersonalRule",async e=>{e.preventDefault(),e.stopPropagation();let t=cn.d;this.state.newPersonalRule.startsWith("@")&&(t=cn.e),this.setState({busy:!0});try{const e=await on.a.sharedInstance().getOrCreatePersonalList();await e.banEntity(t,this.state.newPersonalRule,Object(c.a)("Ignored/Blocked")),this.setState({newPersonalRule:""})}catch(e){d.a.error(e),g.a.createDialog(v.a,{title:Object(c.a)("Error adding ignored user/server"),description:Object(c.a)("Something went wrong. Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}),i()(this,"onSubscribeList",async e=>{e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});try{const e=await u.a.get().joinRoom(this.state.newList);await on.a.sharedInstance().subscribeToList(e.roomId),this.setState({newList:""})}catch(e){d.a.error(e),g.a.createDialog(v.a,{title:Object(c.a)("Error subscribing to list"),description:Object(c.a)("Please verify the room ID or address and try again.")})}finally{this.setState({busy:!1})}}),this.state={busy:!1,newPersonalRule:"",newList:""}}async removePersonalRule(e){this.setState({busy:!0});try{const t=on.a.sharedInstance().getPersonalList();await t.unbanEntity(e.kind,e.entity)}catch(e){d.a.error(e),g.a.createDialog(v.a,{title:Object(c.a)("Error removing ignored user/server"),description:Object(c.a)("Something went wrong. Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}async unsubscribeFromList(e){this.setState({busy:!0});try{await on.a.sharedInstance().unsubscribeFromList(e.roomId),await u.a.get().leave(e.roomId)}catch(e){d.a.error(e),g.a.createDialog(v.a,{title:Object(c.a)("Error unsubscribing from list"),description:Object(c.a)("Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}viewListRules(e){const t=u.a.get().getRoom(e.roomId),a=t?t.name:e.roomId,n=e=>{if(0===e.length)return s.a.createElement("i",null,Object(c.a)("None"));const t=[];for(const a of e)t.push(s.a.createElement("li",{key:a.kind+a.entity},s.a.createElement("code",null,a.entity)));return s.a.createElement("ul",null,t)};g.a.createDialog(de.a,{title:Object(c.a)("Ban list rules - %(roomName)s",{roomName:a}),description:s.a.createElement("div",null,s.a.createElement("h3",null,Object(c.a)("Server rules")),n(e.serverRules),s.a.createElement("h3",null,Object(c.a)("User rules")),n(e.userRules)),button:Object(c.a)("Close"),hasCancelButton:!1})}renderPersonalBanListRules(){const e=on.a.sharedInstance().getPersonalList(),t=e?[...e.userRules,...e.serverRules]:[];if(!e||t.length<=0)return s.a.createElement("i",null,Object(c.a)("You have not ignored anyone."));const a=[];for(const e of t)a.push(s.a.createElement("li",{key:e.entity,className:"mx_MjolnirUserSettingsTab_listItem"},s.a.createElement(b.a,{kind:"danger_sm",onClick:()=>this.removePersonalRule(e),disabled:this.state.busy},Object(c.a)("Remove"))," ",s.a.createElement("code",null,e.entity)));return s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("You are currently ignoring:")),s.a.createElement("ul",null,a))}renderSubscribedBanLists(){const e=on.a.sharedInstance().getPersonalList(),t=on.a.sharedInstance().lists.filter(t=>!e||e.roomId!==t.roomId);if(!t||t.length<=0)return s.a.createElement("i",null,Object(c.a)("You are not subscribed to any lists"));const a=[];for(const e of t){const t=u.a.get().getRoom(e.roomId),n=t?s.a.createElement("span",null,t.name," (",s.a.createElement("code",null,e.roomId),")"):s.a.createElement("code",null,"list.roomId");a.push(s.a.createElement("li",{key:e.roomId,className:"mx_MjolnirUserSettingsTab_listItem"},s.a.createElement(b.a,{kind:"danger_sm",onClick:()=>this.unsubscribeFromList(e),disabled:this.state.busy},Object(c.a)("Unsubscribe"))," ",s.a.createElement(b.a,{kind:"primary_sm",onClick:()=>this.viewListRules(e),disabled:this.state.busy},Object(c.a)("View rules"))," ",n))}return s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("You are currently subscribed to:")),s.a.createElement("ul",null,a))}render(){const e=h.b.get().brand;return s.a.createElement("div",{className:"mx_SettingsTab mx_MjolnirUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Ignored users")),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement("span",{className:"warning"},Object(c.a)("⚠ These settings are meant for advanced users.")),s.a.createElement("br",null),s.a.createElement("br",null),Object(c.a)("Add users and servers you want to ignore here. Use asterisks to have %(brand)s match any characters. For example, <code>@bot:*</code> would ignore all users that have the name 'bot' on any server.",{brand:e},{code:e=>s.a.createElement("code",null,e)}),s.a.createElement("br",null),s.a.createElement("br",null),Object(c.a)("Ignoring people is done through ban lists which contain rules for who to ban. Subscribing to a ban list means the users/servers blocked by that list will be hidden from you."))),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Personal ban list")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(c.a)("Your personal ban list holds all the users/servers you personally don't want to see messages from. After ignoring your first user/server, a new room will show up in your room list named 'My Ban List' - stay in this room to keep the ban list in effect.")),s.a.createElement("div",null,this.renderPersonalBanListRules()),s.a.createElement("div",null,s.a.createElement("form",{onSubmit:this.onAddPersonalRule,autoComplete:"off"},s.a.createElement(m.a,{type:"text",label:Object(c.a)("Server or user ID to ignore"),placeholder:Object(c.a)("eg: @bot:* or example.org"),value:this.state.newPersonalRule,onChange:this.onPersonalRuleChanged}),s.a.createElement(b.a,{type:"submit",kind:"primary",onClick:this.onAddPersonalRule,disabled:this.state.busy},Object(c.a)("Ignore"))))),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Subscribed lists")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},s.a.createElement("span",{className:"warning"},Object(c.a)("Subscribing to a ban list will cause you to join it!"))," ",s.a.createElement("span",null,Object(c.a)("If this isn't what you want, please use a different tool to ignore users."))),s.a.createElement("div",null,this.renderSubscribedBanLists()),s.a.createElement("div",null,s.a.createElement("form",{onSubmit:this.onSubscribeList,autoComplete:"off"},s.a.createElement(m.a,{type:"text",label:Object(c.a)("Room ID or address of ban list"),value:this.state.newList,onChange:this.onNewListChanged}),s.a.createElement(b.a,{type:"submit",kind:"primary",onClick:this.onSubscribeList,disabled:this.state.busy},Object(c.a)("Subscribe"))))))}}var dn=a(850),un=a(632),mn=a(784);const hn=Object.entries(ue.b).filter(e=>{let[t]=e;return t!==ue.c.LABS||h.b.get("show_labs_settings")}),pn=e=>{let{name:t}=e;const a=Object(un.a)(t),n=Object(un.b)(t);return a&&n?s.a.createElement("div",{className:"mx_KeyboardShortcut_shortcutRow"},a,s.a.createElement(mn.a,{value:n})):null},gn=e=>{let{categoryName:t,category:a}=e;return a.categoryLabel?s.a.createElement("div",{className:"mx_SettingsTab_section",key:t},s.a.createElement("div",{className:"mx_SettingsTab_subheading"},Object(c.a)(a.categoryLabel)),s.a.createElement("div",null," ",a.settingNames.map(e=>s.a.createElement(pn,{key:e,name:e}))," ")):null};var vn=()=>s.a.createElement("div",{className:"mx_SettingsTab mx_KeyboardUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(c.a)("Keyboard")),hn.map(e=>{let[t,a]=e;return s.a.createElement(gn,{key:t,categoryName:t,category:a})})),fn=a(834),bn=a(111);function yn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function En(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const _n=(e,t,a)=>{try{const n=e.getUserId();if(!n)throw new Error("No user id");const i=e.getStoredDevice(n,a.device_id);if(!i)throw new Error("No device info available");return t.checkDeviceTrust(t,i,!1,!0).isCrossSigningVerified()}catch(e){return d.a.error("Error getting device cross-signing info",e),null}},wn=(e,t)=>{const{name:a,version:n,url:i}=Object(fn.a)(e,t.device_id);return{appName:a,appVersion:n,url:i}};let Sn;!function(e){e.Unsupported="Unsupported",e.Default="Default"}(Sn||(Sn={}));const On=()=>{var e;const t=Object(r.useContext)(ia.a),a=t.getDeviceId(),n=t.getUserId(),[i,s]=Object(r.useState)({}),[o,l]=Object(r.useState)([]),[u,m]=Object(r.useState)(new Map),[h,p]=Object(r.useState)(!0),[g,v]=Object(r.useState)(!0),[f,b]=Object(r.useState)();Object(r.useEffect)(()=>{t.doesServerSupportUnstableFeature("org.matrix.msc3881").then(e=>{v(e)})},[t]);const y=Object(r.useCallback)(async()=>{p(!0);try{if(!n)throw new Error("Cannot fetch devices without user id");const e=await(async(e,t)=>{const{devices:a}=await e.getDevices(),n=e.getStoredCrossSigningForUser(t);return a.reduce((t,a)=>En(En({},t),{},{[a.device_id]:En(En(En({},a),{},{isVerified:_n(e,n,a)},wn(e,a)),Wt(a[sa.UNSTABLE_MSC3852_LAST_SEEN_UA.name]))}),{})})(t,n);s(e);const{pushers:a}=await t.getPushers();l(a);const i=new Map;Object.keys(e).forEach(e=>{const a=`${sa.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name}.${e}`,n=t.getAccountData(a);n&&i.set(e,n.getContent())}),m(i),p(!1)}catch(e){404==e.httpStatus?b(Sn.Unsupported):(d.a.error("Error loading sessions:",e),b(Sn.Default)),p(!1)}},[t,n]);Object(r.useEffect)(()=>{y()},[y]),Object(bn.a)(t,rt.b.DevicesUpdated,e=>{e.includes(n)&&y()}),Object(bn.a)(t,sa.ClientEvent.AccountData,e=>{const t=e.getType();if(t.startsWith(sa.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name)){const a=new Map(u),n=t.slice(t.lastIndexOf(".")+1);a.set(n,e.getContent()),m(a)}});const E=!(null===(e=i[a])||void 0===e||!e.isVerified)&&n?async e=>await t.requestVerification(n,[e]):void 0,_=Object(r.useCallback)(async(e,a)=>{const n=i[e];if(a!==(null==n?void 0:n.display_name))try{await t.setDeviceDetails(e,{display_name:a}),await y()}catch(e){throw d.a.error("Error setting session display name",e),new Error(Object(c.a)("Failed to set display name"))}},[t,i,y]),w=Object(r.useCallback)(async(e,a)=>{try{const n=o.find(t=>t[sa.PUSHER_DEVICE_ID.name]===e);n?await t.setPusher(En(En({},n),{},{[sa.PUSHER_ENABLED.name]:a})):u.has(e)&&await t.setLocalNotificationSettings(e,{is_silenced:!a})}catch(e){throw d.a.error("Error setting pusher state",e),new Error(Object(c.a)("Failed to set pusher state"))}finally{await y()}},[t,o,u,y]);return{devices:i,pushers:o,localNotificationSettings:u,currentDeviceId:a,isLoadingDeviceList:h,error:f,requestDeviceVerification:E,refreshDevices:y,saveDeviceName:_,setPushNotifications:w,supportsMSC3881:g}};var Cn,xn=a(99),kn=a(101),jn=a.n(kn);function Rn(){return(Rn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function In(e){return r.createElement("svg",Rn({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),Cn||(Cn=r.createElement("path",{d:"M4 8.818L7.125 12 14 5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}const Tn=["value","options","selectedLabel","className"],Nn=(e,t)=>a=>{const n=e.find(e=>{let{id:t}=e;return t===a});return n?t?`${t}: ${n.label}`:n.label:null},Dn=e=>{let{value:t,options:a,selectedLabel:n,className:i}=e,r=$a()(e,Tn);return s.a.createElement(k.a,jn()({},r,{value:t,className:Ve()("mx_FilterDropdown",i),getShortOption:Nn(a,n)}),a.map(e=>{let{id:a,label:n,description:i}=e;return s.a.createElement("div",{className:"mx_FilterDropdown_option","data-testid":"filter-option-"+a,key:a},a===t&&s.a.createElement(In,{className:"mx_FilterDropdown_optionSelectedIcon"}),s.a.createElement("span",{className:"mx_FilterDropdown_optionLabel"},n),!!i&&s.a.createElement("span",{className:"mx_FilterDropdown_optionDescription"},i))}))};var Pn=a(196);const Mn=["title","description"];var An=e=>{let{title:t,description:a}=e,n=$a()(e,Mn);return s.a.createElement(b.a,jn()({},n,{kind:"link_inline",onClick:()=>{g.a.createDialog(Pn.a,{title:t,description:a,button:Object(c.a)("Got it"),hasCloseButton:!0})},className:"mx_LearnMore_button"}),Object(c.a)("Learn more"))},Ln=a(726);const Un=e=>{let{device:t,saveDeviceName:a,stopEditing:n}=e;const[i,o]=Object(r.useState)(t.display_name||""),[l,d]=Object(r.useState)(!1),[u,h]=Object(r.useState)(null);Object(r.useEffect)(()=>{o(t.display_name||"")},[t.display_name]);const p=async e=>{d(!0),h(null),e.preventDefault();try{await a(i),n()}catch(e){h(Object(c.a)("Failed to set display name")),d(!1)}},g="device-rename-"+t.device_id,v="device-rename-description-"+t.device_id;return s.a.createElement("form",{"aria-disabled":l,className:"mx_DeviceDetailHeading_renameForm",onSubmit:p,method:"post"},s.a.createElement("p",{id:g,className:"mx_DeviceDetailHeading_renameFormHeading"},Object(c.a)("Rename session")),s.a.createElement("div",null,s.a.createElement(m.a,{"data-testid":"device-rename-input",type:"text",value:i,autoComplete:"off",onChange:e=>o(e.target.value),autoFocus:!0,disabled:l,"aria-labelledby":g,"aria-describedby":v,className:"mx_DeviceDetailHeading_renameFormInput",maxLength:100}),s.a.createElement(Ln.a,{id:v},Object(c.a)("Please be aware that session names are also visible to people you communicate with."),s.a.createElement(An,{title:Object(c.a)("Renaming sessions"),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(c.a)("Other users in direct messages and rooms that you join are able to view a full list of your sessions.")),s.a.createElement("p",null,Object(c.a)("This provides them with confidence that they are really speaking to you, but it also means they can see the session name you enter here.")))}),!!u&&s.a.createElement("span",{"data-testid":"device-rename-error",className:"mx_DeviceDetailHeading_renameFormError"},u))),s.a.createElement("div",{className:"mx_DeviceDetailHeading_renameFormButtons"},s.a.createElement(b.a,{onClick:p,kind:"primary","data-testid":"device-rename-submit-cta",disabled:l},Object(c.a)("Save")),s.a.createElement(b.a,{onClick:n,kind:"secondary","data-testid":"device-rename-cancel-cta",disabled:l},Object(c.a)("Cancel")),l&&s.a.createElement(R.a,{w:16,h:16})))},Fn=e=>{let{device:t,saveDeviceName:a}=e;const[n,i]=Object(r.useState)(!1);return n?s.a.createElement(Un,{device:t,saveDeviceName:a,stopEditing:()=>i(!1)}):s.a.createElement("div",{className:"mx_DeviceDetailHeading","data-testid":"device-detail-heading"},s.a.createElement(Et.a,{size:"h3"},t.display_name||t.device_id),s.a.createElement(b.a,{kind:"link_inline",onClick:()=>i(!0),className:"mx_DeviceDetailHeading_renameCta","data-testid":"device-heading-rename-cta"},Object(c.a)("Rename")))},Bn={[_t.Inactive]:bt,[_t.Verified]:Mt,[_t.Unverified]:Ut},Vn=e=>{let{variation:t}=e;const a=Bn[t];return s.a.createElement("div",{className:Ve()("mx_DeviceSecurityCard_icon",t)},s.a.createElement(a,{height:16,width:16}))};var zn=e=>{let{variation:t,heading:a,description:n,children:i}=e;return s.a.createElement("div",{className:"mx_DeviceSecurityCard"},s.a.createElement(Vn,{variation:t}),s.a.createElement("div",{className:"mx_DeviceSecurityCard_content"},s.a.createElement("p",{className:"mx_DeviceSecurityCard_heading"},a),s.a.createElement("p",{className:"mx_DeviceSecurityCard_description"},n),!!i&&s.a.createElement("div",{className:"mx_DeviceSecurityCard_actions"},i)))};const Wn={[_t.Verified]:{title:Object(c.a)("Verified sessions"),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(c.a)("Verified sessions have logged in with your credentials and then been verified, either using your secure passphrase or by cross-verifying.")),s.a.createElement("p",null,Object(c.a)("This means they hold encryption keys for your previous messages, and confirm to other users you are communicating with that these sessions are really you.")))},[_t.Unverified]:{title:Object(c.a)("Unverified sessions"),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(c.a)("Unverified sessions are sessions that have logged in with your credentials but have not been cross-verified.")),s.a.createElement("p",null,Object(c.a)("You should make especially certain that you recognise these sessions as they could represent an unauthorised use of your account.")))},[_t.Inactive]:{title:Object(c.a)("Inactive sessions"),description:s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(c.a)("Inactive sessions are sessions you have not used in some time, but they continue to receive encryption keys.")),s.a.createElement("p",null,Object(c.a)("Removing inactive sessions improves security and performance, and makes it easier for you to identify if a new session is suspicious.")))}},Hn=e=>{let{variation:t}=e;const{title:a,description:n}=Wn[t];return s.a.createElement(An,{title:a,description:n})},Gn=e=>{let{device:t,onVerifyDevice:a}=e;const n=t.isVerified?{variation:_t.Verified,heading:Object(c.a)("Verified session"),description:s.a.createElement(s.a.Fragment,null,Object(c.a)("This session is ready for secure messaging."),s.a.createElement(Hn,{variation:_t.Verified}))}:{variation:_t.Unverified,heading:Object(c.a)("Unverified session"),description:s.a.createElement(s.a.Fragment,null,Object(c.a)("Verify or sign out from this session for best security and reliability."),s.a.createElement(Hn,{variation:_t.Unverified}))};return s.a.createElement(zn,n,!t.isVerified&&!!a&&s.a.createElement(b.a,{kind:"primary",onClick:a,"data-testid":"verification-status-button-"+t.device_id},Object(c.a)("Verify session")))};function qn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Kn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):qn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Yn,Jn=e=>{let{device:t,pusher:a,localNotificationSettings:n,isSigningOut:i,onVerifyDevice:r,onSignOutDevice:o,saveDeviceName:l,setPushNotifications:d,supportsMSC3881:u}=e;const m=[{id:"session",values:[{label:Object(c.a)("Session ID"),value:t.device_id},{label:Object(c.a)("Last activity"),value:t.last_seen_ts&&Object(yt.b)(new Date(t.last_seen_ts))}]},{id:"application",heading:Object(c.a)("Application"),values:[{label:Object(c.a)("Name"),value:t.appName},{label:Object(c.a)("Version"),value:t.appVersion},{label:Object(c.a)("URL"),value:t.url}]},{id:"device",heading:Object(c.a)("Device"),values:[{label:Object(c.a)("Model"),value:t.deviceModel},{label:Object(c.a)("Operating system"),value:t.deviceOperatingSystem},{label:Object(c.a)("Browser"),value:t.client},{label:Object(c.a)("IP address"),value:t.last_seen_ip}]}].map(e=>Kn(Kn({},e),{},{values:e.values.filter(e=>!!e.value)})).filter(e=>e.values.length),h=!!a||!!n;return s.a.createElement("div",{className:"mx_DeviceDetails","data-testid":"device-detail-"+t.device_id},s.a.createElement("section",{className:"mx_DeviceDetails_section"},s.a.createElement(Fn,{device:t,saveDeviceName:l}),s.a.createElement(Gn,{device:t,onVerifyDevice:r})),s.a.createElement("section",{className:"mx_DeviceDetails_section"},s.a.createElement("p",{className:"mx_DeviceDetails_sectionHeading"},Object(c.a)("Session details")),m.map((e,t)=>{let{heading:a,values:n,id:i}=e;return s.a.createElement("table",{className:"mx_DeviceDetails_metadataTable",key:t,"data-testid":"device-detail-metadata-"+i},a&&s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,a))),s.a.createElement("tbody",null,n.map(e=>{let{label:t,value:a}=e;return s.a.createElement("tr",{key:t},s.a.createElement("td",{className:"mxDeviceDetails_metadataLabel"},t),s.a.createElement("td",{className:"mxDeviceDetails_metadataValue"},a))})))})),h&&s.a.createElement("section",{className:"mx_DeviceDetails_section mx_DeviceDetails_pushNotifications","data-testid":"device-detail-push-notification"},s.a.createElement(xe.a,{checked:function(e,t){return e?e[xn.f.name]:!n||!n.is_silenced}(a),disabled:function(e,t){return!n&&!(!e||u)}(a),onChange:e=>null==d?void 0:d(t.device_id,e),title:Object(c.a)("Toggle push notifications on this session."),"data-testid":"device-detail-push-notification-checkbox"}),s.a.createElement("p",{className:"mx_DeviceDetails_sectionHeading"},Object(c.a)("Push notifications"),s.a.createElement("small",{className:"mx_DeviceDetails_sectionSubheading"},Object(c.a)("Receive push notifications on this session.")))),s.a.createElement("section",{className:"mx_DeviceDetails_section"},s.a.createElement(b.a,{onClick:o,kind:"danger_inline",disabled:i,"data-testid":"device-detail-sign-out-cta"},s.a.createElement("span",{className:"mx_DeviceDetails_signOutButtonContent"},Object(c.a)("Sign out of this session"),i&&s.a.createElement(R.a,{w:16,h:16})))))};function $n(){return($n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Qn(e){return r.createElement("svg",$n({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 6",role:"presentation","aria-hidden":!0},e),Yn||(Yn=r.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeWidth:1.3},r.createElement("path",{d:"M1.5 1.5l3.859 3.254M9.132 1.56L5.359 4.754"}))))}const Xn=["isExpanded","onClick"];var Zn=e=>{let{isExpanded:t,onClick:a}=e,n=$a()(e,Xn);return s.a.createElement(b.a,jn()({},n,{"aria-label":Object(c.a)("Toggle device details"),kind:"icon",className:Ve()("mx_DeviceExpandDetailsButton",{mx_DeviceExpandDetailsButton_expanded:t}),onClick:a}),s.a.createElement(Qn,{className:"mx_DeviceExpandDetailsButton_icon"}))},ei=a(137),ti=a(237);const ai=["selectedDeviceCount","isAllSelected","toggleSelectAll","children"];var ni=e=>{let{selectedDeviceCount:t,isAllSelected:a,toggleSelectAll:n,children:i}=e,r=$a()(e,ai);const o=a?Object(c.a)("Deselect all"):Object(c.a)("Select all");return s.a.createElement("div",jn()({className:"mx_FilteredDeviceListHeader"},r),s.a.createElement(ti.a,{label:o,alignment:ei.a.Top},s.a.createElement(M.b,{kind:M.a.Solid,checked:a,onChange:n,id:"device-select-all-checkbox","data-testid":"device-select-all-checkbox","aria-label":o})),s.a.createElement("span",{className:"mx_FilteredDeviceListHeader_label"},t>0?Object(c.a)("%(selectedDeviceCount)s sessions selected",{selectedDeviceCount:t}):Object(c.a)("Sessions")),i)};const ii=(e,t)=>t.includes(e),ri=(e,t)=>(t.last_seen_ts||0)-(e.last_seen_ts||0),si={[_t.Verified]:{title:Object(c.a)("Verified sessions"),description:Object(c.a)("For best security, sign out from any session that you don't recognize or use anymore.")},[_t.Unverified]:{title:Object(c.a)("Unverified sessions"),description:Object(c.a)("Verify your sessions for enhanced secure messaging or sign out from those you don't recognize or use anymore.")},[_t.Inactive]:{title:Object(c.a)("Inactive sessions"),description:Object(c.a)("Consider signing out from old sessions (%(inactiveAgeDays)s days or older) you don't use anymore.",{inactiveAgeDays:90})}},oi=e=>{let{filter:t}=e;if((e=>Object.values(_t).includes(e))(t)){const{title:e,description:a}=si[t];return s.a.createElement("div",{className:"mx_FilteredDeviceList_securityCard"},s.a.createElement(zn,{variation:t,heading:e,description:s.a.createElement("span",null,a,s.a.createElement(Hn,{variation:t}))}))}return null},ci=e=>{let{filter:t,clearFilter:a}=e;return s.a.createElement("div",{className:"mx_FilteredDeviceList_noResults"},(e=>{switch(e){case _t.Verified:return Object(c.a)("No verified sessions found.");case _t.Unverified:return Object(c.a)("No unverified sessions found.");case _t.Inactive:return Object(c.a)("No inactive sessions found.");default:return Object(c.a)("No sessions found.")}})(t),!!t&&s.a.createElement(s.a.Fragment,null," ",s.a.createElement(b.a,{kind:"link_inline",onClick:a,"data-testid":"devices-clear-filter-btn"},Object(c.a)("Show all"))))},li=e=>{let{device:t,pusher:a,localNotificationSettings:n,isExpanded:i,isSigningOut:r,isSelected:o,onDeviceExpandToggle:c,onSignOutDevice:l,saveDeviceName:d,onRequestDeviceVerification:u,setPushNotifications:m,toggleSelected:h,supportsMSC3881:p}=e;return s.a.createElement("li",{className:"mx_FilteredDeviceList_listItem"},s.a.createElement(Xt,{isSelected:o,onSelect:h,onClick:c,device:t},r&&s.a.createElement(R.a,{w:16,h:16}),s.a.createElement(Zn,{isExpanded:i,onClick:c})),i&&s.a.createElement(Jn,{device:t,pusher:a,localNotificationSettings:n,isSigningOut:r,onVerifyDevice:u,onSignOutDevice:l,saveDeviceName:d,setPushNotifications:m,supportsMSC3881:p}))},di=Object(r.forwardRef)((e,t)=>{let{devices:a,pushers:n,localNotificationSettings:i,filter:r,expandedDeviceIds:o,signingOutDeviceIds:l,selectedDeviceIds:d,onFilterChange:u,onDeviceExpandToggle:m,saveDeviceName:h,onSignOutDevices:p,onRequestDeviceVerification:g,setPushNotifications:v,setSelectedDeviceIds:f,supportsMSC3881:y}=e;const E=((e,t)=>Ot(Object.values(e),t?[t]:[]).sort(ri))(a,r);function _(e){return n.find(t=>t[xn.e.name]===e.device_id)}const w=[{id:"ALL",label:Object(c.a)("All")},{id:_t.Verified,label:Object(c.a)("Verified"),description:Object(c.a)("Ready for secure messaging")},{id:_t.Unverified,label:Object(c.a)("Unverified"),description:Object(c.a)("Not ready for secure messaging")},{id:_t.Inactive,label:Object(c.a)("Inactive"),description:Object(c.a)("Inactive for %(inactiveAgeDays)s days or longer",{inactiveAgeDays:90})}],S=d.length>=E.length,O=!!l.length;return s.a.createElement("div",{className:"mx_FilteredDeviceList",ref:t},s.a.createElement(ni,{selectedDeviceCount:d.length,isAllSelected:S,toggleSelectAll:()=>{f(S?[]:E.map(e=>e.device_id))}},d.length?s.a.createElement(s.a.Fragment,null,s.a.createElement(b.a,{"data-testid":"sign-out-selection-cta",kind:"danger_inline",disabled:O,onClick:()=>p(d),className:"mx_FilteredDeviceList_headerButton"},O&&s.a.createElement(R.a,{w:16,h:16}),Object(c.a)("Sign out")),s.a.createElement(b.a,{"data-testid":"cancel-selection-cta",kind:"content_inline",disabled:O,onClick:()=>f([]),className:"mx_FilteredDeviceList_headerButton"},Object(c.a)("Cancel"))):s.a.createElement(Dn,{id:"device-list-filter",label:Object(c.a)("Filter devices"),value:r||"ALL",onOptionChange:e=>{u("ALL"===e?void 0:e)},options:w,selectedLabel:Object(c.a)("Show")})),E.length?s.a.createElement(oi,{filter:r}):s.a.createElement(ci,{filter:r,clearFilter:()=>u(void 0)}),s.a.createElement("ol",{className:"mx_FilteredDeviceList_list"},E.map(e=>s.a.createElement(li,{key:e.device_id,device:e,pusher:_(e),localNotificationSettings:i.get(e.device_id),isExpanded:o.includes(e.device_id),isSigningOut:l.includes(e.device_id),isSelected:ii(e.device_id,d),onDeviceExpandToggle:()=>m(e.device_id),onSignOutDevice:()=>p([e.device_id]),saveDeviceName:t=>h(e.device_id,t),onRequestDeviceVerification:g?()=>g(e.device_id):void 0,setPushNotifications:v,toggleSelected:()=>{return t=e.device_id,void(ii(t,d)?f(d.filter(e=>e!==t)):f([...d,t]));var t},supportsMSC3881:y}))))});var ui=a(820),mi=a(579),hi=a(117),pi=a(148);const gi=["options","title"],vi=e=>{let{options:t,title:a}=e,n=$a()(e,gi);const[i,r,o,c]=Object(hi.p)();return s.a.createElement(s.a.Fragment,null,s.a.createElement(hi.b,jn()({},n,{onClick:o,title:a,isExpanded:i,inputRef:r}),s.a.createElement(mi.a,{className:"mx_KebabContextMenu_icon"})),i&&s.a.createElement(pi.e,jn()({onFinished:c,compact:!0,rightAligned:!0,closeOnInteraction:!0},{left:(l=r.current.getBoundingClientRect()).left+window.scrollX+l.width,top:l.bottom+window.scrollY,chevronFace:hi.a.None}),s.a.createElement(pi.c,null,t)));var l},fi=e=>{let{onSignOutCurrentDevice:t,signOutAllOtherSessions:a,disabled:n}=e;const i=[s.a.createElement(pi.b,{key:"sign-out",label:Object(c.a)("Sign out"),onClick:t,isDestructive:!0}),...a?[s.a.createElement(pi.b,{key:"sign-out-all-others",label:Object(c.a)("Sign out all other sessions"),onClick:a,isDestructive:!0})]:[]];return s.a.createElement(ui.a,{heading:Object(c.a)("Current session")},s.a.createElement(vi,{disabled:n,title:Object(c.a)("Options"),options:i,"data-testid":"current-session-menu"}))};var bi=e=>{let{device:t,isLoading:a,isSigningOut:n,localNotificationSettings:i,setPushNotifications:o,onVerifyCurrentDevice:c,onSignOutCurrentDevice:l,signOutAllOtherSessions:d,saveDeviceName:u}=e;const[m,h]=Object(r.useState)(!1);return s.a.createElement(fa.a,{"data-testid":"current-session-section",heading:s.a.createElement(fi,{onSignOutCurrentDevice:l,signOutAllOtherSessions:d,disabled:a||!t||n})},a&&!t&&s.a.createElement(R.a,null),!!t&&s.a.createElement(s.a.Fragment,null,s.a.createElement(Qt,{device:t,onClick:()=>h(!m)},s.a.createElement(Zn,{"data-testid":"current-session-toggle-details",isExpanded:m,onClick:()=>h(!m)})),m&&s.a.createElement(Jn,{device:t,localNotificationSettings:i,setPushNotifications:o,isSigningOut:n,onVerifyDevice:c,onSignOutDevice:l,saveDeviceName:u}),s.a.createElement("br",null),s.a.createElement(Gn,{device:t,onVerifyDevice:c})))};var yi=e=>{let{devices:t,currentDeviceId:a,goToFilteredList:n}=e;const i=Object.values(t),r=Ot(i,[_t.Unverified]).filter(e=>e.device_id!==a).length,o=Ot(i,[_t.Inactive]).length;if(!(r|o))return null;return s.a.createElement(fa.a,{heading:Object(c.a)("Security recommendations"),description:Object(c.a)("Improve your account security by following these recommendations"),"data-testid":"security-recommendations-section"},!!r&&s.a.createElement(zn,{variation:_t.Unverified,heading:Object(c.a)("Unverified sessions"),description:s.a.createElement(s.a.Fragment,null,Object(c.a)("Verify your sessions for enhanced secure messaging or sign out from those you don't recognize or use anymore."),s.a.createElement(Hn,{variation:_t.Unverified}))},s.a.createElement(b.a,{kind:"link_inline",onClick:()=>n(_t.Unverified),"data-testid":"unverified-devices-cta"},Object(c.a)("View all")+` (${r})`)),!!o&&s.a.createElement(s.a.Fragment,null,!!r&&s.a.createElement("div",{className:"mx_SecurityRecommendations_spacing"}),s.a.createElement(zn,{variation:_t.Inactive,heading:Object(c.a)("Inactive sessions"),description:s.a.createElement(s.a.Fragment,null,Object(c.a)("Consider signing out from old sessions (%(inactiveAgeDays)s days or older) you don't use anymore",{inactiveAgeDays:90}),s.a.createElement(Hn,{variation:_t.Inactive}))},s.a.createElement(b.a,{kind:"link_inline",onClick:()=>n(_t.Inactive),"data-testid":"inactive-devices-cta"},Object(c.a)("View all")+` (${o})`))))},Ei=a(821),_i=a(218);function wi(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const Si=(e,t)=>{const[a,n]=Object(r.useState)([]);return{onSignOutCurrentDevice:()=>{g.a.createDialog(vt.a,{},void 0,!1,!0)},onSignOutOtherDevices:async i=>{if(!i.length)return;if(await(async e=>{const{finished:t}=g.a.createDialog(de.a,{title:Object(c.a)("Sign out"),description:s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("Are you sure you want to sign out of %(count)s sessions?",{count:e}))),cancelButton:Object(c.a)("Cancel"),button:Object(c.a)("Sign out")}),[a]=await t;return a})(i.length))try{n([...a,...i]),await na(e,i,async e=>{e&&await t(),n(a.filter(e=>!i.includes(e)))})}catch(e){d.a.error("Error deleting sessions",e),n(a.filter(e=>!i.includes(e)))}},signingOutDeviceIds:a}};var Oi=()=>{const{devices:e,pushers:t,localNotificationSettings:a,currentDeviceId:n,isLoadingDeviceList:i,requestDeviceVerification:o,refreshDevices:l,saveDeviceName:d,setPushNotifications:u,supportsMSC3881:m}=On(),[h,p]=Object(r.useState)(),[v,f]=Object(r.useState)([]),[b,y]=Object(r.useState)([]),E=Object(r.useRef)(null),_=Object(r.useRef)(),w=Object(r.useContext)(ia.a),S=w.getUserId(),O=S&&w.getUser(S)||void 0,x=Object(_i.a)(()=>w.getVersions(),[w]),{[n]:k}=e,j=$a()(e,[n].map(wi)),R=Object.keys(j).length>0,I=Object(r.useCallback)(e=>{if(!o)return;const t=o(e);g.a.createDialog(gt.a,{verificationRequestPromise:t,member:O,onFinished:async()=>{(await t).cancel(),await l()}})},[o,l,O]),{onSignOutCurrentDevice:T,onSignOutOtherDevices:N,signingOutDeviceIds:D}=Si(w,async()=>{await l(),y([])});Object(r.useEffect)(()=>()=>{clearTimeout(_.current)},[_]),Object(r.useEffect)(()=>{y([])},[h,y]);const P=R?()=>{N(Object.keys(j))}:void 0,[M,A]=Object(r.useState)(),L=C.b.getValue("feature_qr_signin_reciprocate_show"),U=Object(r.useCallback)(()=>{A(null)},[A]),F=Object(r.useCallback)(()=>{A(va.a.Show)},[A]);return L&&M?s.a.createElement(va.b,{mode:M,onFinished:U,client:w}):s.a.createElement(Ei.a,{heading:Object(c.a)("Sessions")},s.a.createElement(yi,{devices:e,goToFilteredList:e=>{p(e),clearTimeout(_.current),_.current=window.setTimeout(()=>{var e;return null===(e=E.current)||void 0===e?void 0:e.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})})},currentDeviceId:n}),s.a.createElement(bi,{device:k,localNotificationSettings:a.get(n),setPushNotifications:u,isSigningOut:D.includes(n),isLoading:i,saveDeviceName:e=>d(n,e),onVerifyCurrentDevice:()=>{g.a.createDialog(pt.a,{onFinished:l})},onSignOutCurrentDevice:T,signOutAllOtherSessions:P}),R&&s.a.createElement(fa.a,{heading:Object(c.a)("Other sessions"),description:Object(c.a)("For best security, verify your sessions and sign out from any session that you don't recognize or use anymore."),"data-testid":"other-sessions-section"},s.a.createElement(di,{devices:j,pushers:t,localNotificationSettings:a,filter:h,expandedDeviceIds:v,signingOutDeviceIds:D,selectedDeviceIds:b,setSelectedDeviceIds:y,onFilterChange:p,onDeviceExpandToggle:e=>{v.includes(e)?f(v.filter(t=>t!==e)):f([...v,e])},onRequestDeviceVerification:o?I:void 0,onSignOutDevices:N,saveDeviceName:d,setPushNotifications:u,ref:E,supportsMSC3881:m})),L?s.a.createElement(ba,{onShowQr:F,versions:x}):null)};class Ci extends s.a.Component{constructor(e){super(e),i()(this,"settingsWatchers",[]),i()(this,"mjolnirChanged",(e,t,a,n)=>{this.setState({mjolnirEnabled:n})}),i()(this,"sessionManagerChanged",(e,t,a,n)=>{this.setState({newSessionManagerEnabled:n})}),this.state={mjolnirEnabled:C.b.getValue("feature_mjolnir"),newSessionManagerEnabled:C.b.getValue("feature_new_device_manager")}}componentDidMount(){this.settingsWatchers=[C.b.watchSetting("feature_mjolnir",null,this.mjolnirChanged),C.b.watchSetting("feature_new_device_manager",null,this.sessionManagerChanged)]}componentWillUnmount(){this.settingsWatchers.forEach(e=>C.b.unwatchSetting(e))}getTabs(){const e=[];return e.push(new o.a(Wa.a.General,Object(c.c)("General"),"mx_UserSettingsDialog_settingsIcon",s.a.createElement(Te,{closeSettingsFn:this.props.onFinished}),"UserSettingsGeneral")),e.push(new o.a(Wa.a.Appearance,Object(c.c)("Appearance"),"mx_UserSettingsDialog_appearanceIcon",s.a.createElement(at,null),"UserSettingsAppearance")),e.push(new o.a(Wa.a.Notifications,Object(c.c)("Notifications"),"mx_UserSettingsDialog_bellIcon",s.a.createElement(za,null),"UserSettingsNotifications")),e.push(new o.a(Wa.a.Preferences,Object(c.c)("Preferences"),"mx_UserSettingsDialog_preferencesIcon",s.a.createElement(Ga,{closeSettingsFn:this.props.onFinished}),"UserSettingsPreferences")),e.push(new o.a(Wa.a.Keyboard,Object(c.c)("Keyboard"),"mx_UserSettingsDialog_keyboardIcon",s.a.createElement(vn,null),"UserSettingsKeyboard")),e.push(new o.a(Wa.a.Sidebar,Object(c.c)("Sidebar"),"mx_UserSettingsDialog_sidebarIcon",s.a.createElement(dn.a,null),"UserSettingsSidebar")),C.b.getValue(G.b.Voip)&&e.push(new o.a(Wa.a.Voice,Object(c.c)("Voice & Video"),"mx_UserSettingsDialog_voiceIcon",s.a.createElement(Ka,null),"UserSettingsVoiceVideo")),e.push(new o.a(Wa.a.Security,Object(c.c)("Security & Privacy"),"mx_UserSettingsDialog_securityIcon",s.a.createElement(Ea,{closeSettingsFn:this.props.onFinished}),"UserSettingsSecurityPrivacy")),this.state.newSessionManagerEnabled&&e.push(new o.a(Wa.a.SessionManager,Object(c.c)("Sessions"),"mx_UserSettingsDialog_securityIcon",s.a.createElement(Oi,null),void 0)),(h.b.get("show_labs_settings")||C.b.getFeatureSettingNames().some(e=>C.b.getBetaInfo(e)))&&e.push(new o.a(Wa.a.Labs,Object(c.c)("Labs"),"mx_UserSettingsDialog_labsIcon",s.a.createElement(Fe,null),"UserSettingsLabs")),this.state.mjolnirEnabled&&e.push(new o.a(Wa.a.Mjolnir,Object(c.c)("Ignored users"),"mx_UserSettingsDialog_mjolnirIcon",s.a.createElement(ln,null),"UserSettingMjolnir")),e.push(new o.a(Wa.a.Help,Object(c.c)("Help & About"),"mx_UserSettingsDialog_helpIcon",s.a.createElement(sn,{closeSettingsFn:()=>this.props.onFinished(!0)}),"UserSettingsHelpAbout")),e}render(){return s.a.createElement(A.a,{className:"mx_UserSettingsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(c.a)("Settings")},s.a.createElement("div",{className:"mx_SettingsDialog_content"},s.a.createElement(o.c,{tabs:this.getTabs(),initialTabId:this.props.initialTabId,screenName:"UserSettings"})))}}},1525:function(e,t,a){"use strict";a.d(t,"a",(function(){return ze}));var n=a(6),i=a.n(n),r=a(96),s=a.n(r),o=a(94),c=a(97),l=a(367),d=a(103),u=a.n(d),m=a(90),h=a.n(m),p=a(113),g=a(99),v=a(18),f=a(238),b=a(174),y=a(91),E=a(142),_=a(168),w=a(105),S=a(229),O=a(365),C=a(306),x=a(285),k=a(137),j=a(118),R=a(181),I=a(303),T=a(217),N=a(399),D=a(273),P=a(518),M=a(581),A=a(153),L=a(98),U=a(158),F=a(198),B=a(608);const V=["m.relates_to"];function z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function W(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?z(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):z(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var H;!function(e){e[e.CanSend=0]="CanSend",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent",e[e.Failed=3]="Failed"}(H||(H={}));const G=e=>{let{room:t,type:a,content:n,matrixClient:i,onFinished:r}=e;const[s,c]=Object(m.useState)(H.CanSend);let l,d,u,p=!1;return s===H.CanSend?(l="mx_ForwardList_canSend",t.maySendMessage()||(p=!0,d=Object(y.a)("You don't have permission to do this"))):s===H.Sending?(l="mx_ForwardList_sending",p=!0,d=Object(y.a)("Sending"),u=h.a.createElement("div",{className:"mx_ForwardList_sendIcon","aria-label":d})):s===H.Sent?(l="mx_ForwardList_sent",p=!0,d=Object(y.a)("Sent"),u=h.a.createElement("div",{className:"mx_ForwardList_sendIcon","aria-label":d})):(l="mx_ForwardList_sendFailed",p=!0,d=Object(y.a)("Failed to send"),u=h.a.createElement(T.a,{notification:I.a.RED_EXCLAMATION})),h.a.createElement("div",{className:"mx_ForwardList_entry"},h.a.createElement(j.a,{className:"mx_ForwardList_roomButton",onClick:e=>{o.a.dispatch({action:L.a.ViewRoom,room_id:t.roomId,metricsTrigger:"WebForwardShortcut",metricsViaKeyboard:"click"!==e.type}),r(!0)},title:Object(y.a)("Open room"),alignment:k.a.Top},h.a.createElement(x.a,{room:t,avatarSize:32}),h.a.createElement("span",{className:"mx_ForwardList_entry_name"},t.name),h.a.createElement(B.a,{component:"span",className:"mx_ForwardList_entry_detail",room:t})),h.a.createElement(j.a,{kind:s===H.Failed?"danger_outline":"primary_outline",className:"mx_ForwardList_sendButton "+l,onClick:async()=>{c(H.Sending);try{await i.sendEvent(t.roomId,a,n),c(H.Sent)}catch(e){c(H.Failed)}},disabled:p,title:d,alignment:k.a.Top},h.a.createElement("div",{className:"mx_ForwardList_sendLabel"},Object(y.a)("Send")),u))};var q=e=>{let{matrixClient:t,event:n,permalinkCreator:i,onFinished:r}=e;const o=t.getUserId(),[c,l]=Object(m.useState)({});Object(m.useEffect)(()=>{t.getProfileInfo(o).then(e=>l(e))},[t,o]);const{type:d,content:x}=(e=>{const t=e.getContent(),{"m.relates_to":a}=t,n=u()(t,V),i=b.a.matches(e.getType())?g.b.RoomMessage:e.getType();if(Object(U.k)(e)&&Object(F.f)(n)||b.a.matches(e.getType())){const t=v.d.findIn(n),a=Object(F.g)(e);return{type:i,content:W(W({},n),Object(f.makeLocationContent)(void 0,a,t||Date.now(),void 0,v.a.Pin))}}return{type:i,content:n}})(n),k=new p.b({type:"m.room.message",sender:o,content:x,unsigned:{age:97},event_id:"$9999999999999999999999999999999999999999999",room_id:n.getRoomId()});k.sender={name:c.displayname||o,rawDisplayName:c.displayname,userId:o,getAvatarUrl:function(){return Object(S.c)({avatarUrl:c.avatar_url},30,30,"crop")},getMxcAvatarUrl:()=>c.avatar_url};const[j,I]=Object(m.useState)(""),T=j.toLowerCase(),L=Object(E.b)("layout");let B=Object(m.useMemo)(()=>Object(N.b)(t.getVisibleRooms().filter(e=>"join"===e.getMyMembership()&&!e.isSpaceRoom())),[t]);T&&(B=new D.a(B,{keys:["name"],funcs:[e=>[e.getCanonicalAlias(),...e.getAltAliases()].filter(Boolean)],shouldMatchWordsOnly:!1}).match(T));const[z,H]=Object(m.useState)(20);return h.a.createElement(w.a,{title:Object(y.a)("Forward message"),className:"mx_ForwardDialog",contentId:"mx_ForwardList",onFinished:r,fixedWidth:!1},h.a.createElement("h3",null,Object(y.a)("Message preview")),h.a.createElement("div",{className:s()("mx_ForwardDialog_preview",{mx_IRCLayout:L==_.a.IRC})},h.a.createElement(O.a,{mxEvent:k,layout:L,permalinkCreator:i,as:"div"})),h.a.createElement("hr",null),h.a.createElement("div",{className:"mx_ForwardList",id:"mx_ForwardList"},h.a.createElement(C.a,{className:"mx_textinput_icon mx_textinput_search",placeholder:Object(y.a)("Search for rooms or people"),onSearch:I,autoFocus:!0}),h.a.createElement(R.a,{className:"mx_ForwardList_content"},B.length>0?h.a.createElement("div",{className:"mx_ForwardList_results"},h.a.createElement(P.a,{className:"mx_ForwardList_resultsList",truncateAt:z,createOverflowElement:function(e,t){const n=Object(y.a)("and %(count)s others...",{count:e});return h.a.createElement(M.b,{className:"mx_EntityTile_ellipsis",avatarJsx:h.a.createElement(A.a,{url:a(841).default,name:"...",width:36,height:36}),name:n,presenceState:"online",suppressOnHover:!0,onClick:()=>H(t)})},getChildren:(e,a)=>B.slice(e,a).map(e=>h.a.createElement(G,{key:e.roomId,room:e,type:d,content:x,matrixClient:t,onFinished:r})),getChildCount:()=>B.length})):h.a.createElement("span",{className:"mx_ForwardList_noResults"},Object(y.a)("No results")))))},K=a(92),Y=a(1),J=a(187),$=a(100),Q=a(753),X=a(95),Z=a(228),ee=a(115),te=a(108),ae=a(104),ne=a(842);const ie=["org.matrix.msc3215.room.moderation.moderated_by"];var re,se;!function(e){e.Disagreement="org.matrix.msc3215.abuse.nature.disagreement",e.Toxic="org.matrix.msc3215.abuse.nature.toxic",e.Illegal="org.matrix.msc3215.abuse.nature.illegal",e.Spam="org.matrix.msc3215.abuse.nature.spam",e.Other="org.matrix.msc3215.abuse.nature.other"}(re||(re={})),function(e){e.Admin="non-standard.abuse.nature.admin"}(se||(se={}));class oe extends h.a.Component{constructor(e){super(e),i()(this,"moderation",void 0),i()(this,"onIgnoreUserTooChanged",e=>{this.setState({ignoreUserToo:e})}),i()(this,"onReasonChange",e=>{let{target:{value:t}}=e;this.setState({reason:t})}),i()(this,"onNatureChosen",e=>{this.setState({nature:e.currentTarget.value})}),i()(this,"onCancel",()=>{this.props.onFinished(!1)}),i()(this,"onSubmit",async()=>{let e=this.state.reason||"";if(e=e.trim(),this.moderation){if(!this.state.nature||(this.state.nature==re.Other||this.state.nature==se.Admin)&&!e)return void this.setState({err:Object(y.a)("Please fill why you're reporting.")})}else if(!e)return void this.setState({err:Object(y.a)("Please fill why you're reporting.")});this.setState({busy:!0,err:null});try{const e=K.a.get(),t=this.props.mxEvent;if(this.moderation&&this.state.nature!==se.Admin){const a=this.state.nature,n=await Object(J.c)(e,this.moderation.moderationBotUserId);await e.sendEvent(n,"org.matrix.msc3215.abuse.report",{event_id:t.getId(),room_id:t.getRoomId(),moderated_by_id:this.moderation.moderationRoomId,nature:a,reporter:e.getUserId(),comment:this.state.reason.trim()})}else await e.reportEvent(t.getRoomId(),t.getId(),-100,this.state.reason.trim());this.state.ignoreUserToo&&await e.setIgnoredUsers([...e.getIgnoredUsers(),t.getSender()]),this.props.onFinished(!0)}catch(e){Y.a.error(e),this.setState({busy:!1,err:e.message})}});let t=null,a=null;if(X.b.getValue("feature_report_to_moderators")){const n=K.a.get().getRoom(e.mxEvent.getRoomId());for(const e of ie){const i=n.currentState.getStateEvents(e,e);if(!i)continue;if(Array.isArray(i))throw new TypeError(`getStateEvents(${e}, ${e}) should return at most one state event`);const r=i.event;if(!("content"in r)||"object"!=typeof r.content){console.debug("Moderation error","state event",e,"should have an object field `content`, got",r);continue}const s=r.content;"room_id"in s&&"string"==typeof s.room_id?"user_id"in s&&"string"==typeof s.user_id?(t=s.room_id,a=s.user_id):console.debug("Moderation error","state event",e,"should have a string field `content.user_id`, got",r):console.debug("Moderation error","state event",e,"should have a string field `content.room_id`, got",r)}t&&a&&(this.moderation={moderationRoomId:t,moderationBotUserId:a})}this.state={reason:"",busy:!1,err:null,nature:null,ignoreUserToo:!1}}render(){var e;let t=null;this.state.err&&(t=h.a.createElement("div",{className:"error"},this.state.err));let a=null;this.state.busy&&(a=h.a.createElement("div",{className:"progress"},h.a.createElement(ae.a,null)));const n=h.a.createElement(ne.a,{value:this.state.ignoreUserToo,label:Object(y.a)("Ignore user"),byline:Object(y.a)("Check if you want to hide all current and future messages from this user."),onChange:this.onIgnoreUserTooChanged,disabled:this.state.busy}),i=null===(e=$.b.getObject("report_event"))||void 0===e?void 0:e.get("admin_message_md","adminMessageMD");let r;if(i){const e=new Q.a(i).toHTML({externalLinks:!0});r=h.a.createElement("p",{dangerouslySetInnerHTML:{__html:e}})}if(this.moderation){const e=K.a.get(),i=$.b.get("validated_server_config").hsName;let r;switch(this.state.nature){case re.Disagreement:r=Object(y.a)("What this user is writing is wrong.\nThis will be reported to the room moderators.");break;case re.Toxic:r=Object(y.a)("This user is displaying toxic behaviour, for instance by insulting other users or sharing  adult-only content in a family-friendly room  or otherwise violating the rules of this room.\nThis will be reported to the room moderators.");break;case re.Illegal:r=Object(y.a)("This user is displaying illegal behaviour, for instance by doxing people or threatening violence.\nThis will be reported to the room moderators who may escalate this to legal authorities.");break;case re.Spam:r=Object(y.a)("This user is spamming the room with ads, links to ads or to propaganda.\nThis will be reported to the room moderators.");break;case se.Admin:r=e.isRoomEncrypted(this.props.mxEvent.getRoomId())?Object(y.a)("This room is dedicated to illegal or toxic content or the moderators fail to moderate illegal or toxic content.\nThis will be reported to the administrators of %(homeserver)s. The administrators will NOT be able to read the encrypted content of this room.",{homeserver:i}):Object(y.a)("This room is dedicated to illegal or toxic content or the moderators fail to moderate illegal or toxic content.\n This will be reported to the administrators of %(homeserver)s.",{homeserver:i});break;case re.Other:r=Object(y.a)("Any other reason. Please describe the problem.\nThis will be reported to the room moderators.");break;default:r=Object(y.a)("Please pick a nature and describe what makes this message abusive.")}return h.a.createElement(w.a,{className:"mx_ReportEventDialog",onFinished:this.props.onFinished,title:Object(y.a)("Report Content"),contentId:"mx_ReportEventDialog"},h.a.createElement("div",null,h.a.createElement(Z.a,{name:"nature",value:re.Disagreement,checked:this.state.nature==re.Disagreement,onChange:this.onNatureChosen},Object(y.a)("Disagree")),h.a.createElement(Z.a,{name:"nature",value:re.Toxic,checked:this.state.nature==re.Toxic,onChange:this.onNatureChosen},Object(y.a)("Toxic Behaviour")),h.a.createElement(Z.a,{name:"nature",value:re.Illegal,checked:this.state.nature==re.Illegal,onChange:this.onNatureChosen},Object(y.a)("Illegal Content")),h.a.createElement(Z.a,{name:"nature",value:re.Spam,checked:this.state.nature==re.Spam,onChange:this.onNatureChosen},Object(y.a)("Spam or propaganda")),h.a.createElement(Z.a,{name:"nature",value:se.Admin,checked:this.state.nature==se.Admin,onChange:this.onNatureChosen},Object(y.a)("Report the entire room")),h.a.createElement(Z.a,{name:"nature",value:re.Other,checked:this.state.nature==re.Other,onChange:this.onNatureChosen},Object(y.a)("Other")),h.a.createElement("p",null,r),h.a.createElement(te.a,{className:"mx_ReportEventDialog_reason",element:"textarea",label:Object(y.a)("Reason"),rows:5,onChange:this.onReasonChange,value:this.state.reason,disabled:this.state.busy}),a,t,n),h.a.createElement(ee.a,{primaryButton:Object(y.a)("Send report"),onPrimaryButtonClick:this.onSubmit,focus:!0,onCancel:this.onCancel,disabled:this.state.busy}))}return h.a.createElement(w.a,{className:"mx_ReportEventDialog",onFinished:this.props.onFinished,title:Object(y.a)("Report Content to Your Homeserver Administrator"),contentId:"mx_ReportEventDialog"},h.a.createElement("div",{className:"mx_ReportEventDialog",id:"mx_ReportEventDialog"},h.a.createElement("p",null,Object(y.a)("Reporting this message will send its unique 'event ID' to the administrator of your homeserver. If messages in this room are encrypted, your homeserver administrator will not be able to read the message text or view any files or images.")),r,h.a.createElement(te.a,{className:"mx_ReportEventDialog_reason",element:"textarea",label:Object(y.a)("Reason"),rows:5,onChange:this.onReasonChange,value:this.state.reason,disabled:this.state.busy}),a,t,n),h.a.createElement(ee.a,{primaryButton:Object(y.a)("Send report"),onPrimaryButtonClick:this.onSubmit,focus:!0,onCancel:this.onCancel,disabled:this.state.busy}))}}var ce=a(308),le=a(147),de=a(106),ue=a(252);let me;!function(e){e.Appearance="SPACE_PREFERENCE_APPEARANCE_TAB"}(me||(me={}));const he=e=>{let{space:t}=e;const a=Object(E.b)("Spaces.showPeopleInSpace",t.roomId);return h.a.createElement("div",{className:"mx_SettingsTab"},h.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(y.a)("Sections to show")),h.a.createElement("div",{className:"mx_SettingsTab_section"},h.a.createElement(le.b,{checked:!!a,onChange:e=>{X.b.setValue("Spaces.showPeopleInSpace",t.roomId,de.a.ROOM_ACCOUNT,!a)}},Object(y.a)("People")),h.a.createElement("p",null,Object(y.a)("This groups your chats with members of this space. Turning this off will hide those chats from your view of %(spaceName)s.",{spaceName:t.name}))))};var pe=e=>{let{space:t,initialTabId:a,onFinished:n}=e;const i=[new ce.a(me.Appearance,Object(y.c)("Appearance"),"mx_SpacePreferencesDialog_appearanceIcon",h.a.createElement(he,{space:t}))];return h.a.createElement(w.a,{className:"mx_SpacePreferencesDialog",hasCancel:!0,onFinished:n,title:Object(y.a)("Preferences"),fixedWidth:!1},h.a.createElement("h4",null,h.a.createElement(ue.a,{room:t})),h.a.createElement("div",{className:"mx_SettingsDialog_content"},h.a.createElement(ce.c,{tabs:i,initialTabId:a})))},ge=a(205),ve=a(93),fe=a(739),be=a(309),ye=a(450),Ee=a(582);var _e=e=>{var t;let{matrixClient:a,space:n,onFinished:i}=e;const[r,s]=Object(m.useState)(!1),[o,c]=Object(m.useState)(""),l=a.getUserId(),[d,u]=Object(m.useState)(null),p=n.currentState.maySendStateEvent(g.b.RoomAvatar,l),v=null!==d,[f,b]=Object(m.useState)(n.name),E=n.currentState.maySendStateEvent(g.b.RoomName,l),_=f!==n.name,w=null===(t=Object(Ee.a)(n))||void 0===t?void 0:t.text,[O,C]=Object(m.useState)(w),x=n.currentState.maySendStateEvent(g.b.RoomTopic,l),k=O!==w;return h.a.createElement("div",{className:"mx_SettingsTab"},h.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(y.a)("General")),h.a.createElement("div",null,Object(y.a)("Edit settings relating to your space.")),o&&h.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},o),h.a.createElement("div",{className:"mx_SettingsTab_section"},h.a.createElement(fe.b,{avatarUrl:Object(S.b)(n,80,80,"crop"),avatarDisabled:r||!p,setAvatar:u,name:f,nameDisabled:r||!E,setName:b,topic:O,topicDisabled:r||!x,setTopic:C}),h.a.createElement(ve.a,{onClick:()=>{u(null),b(n.name),C(w)},disabled:r||!(v||_||k),kind:"link"},Object(y.a)("Cancel")),h.a.createElement(ve.a,{onClick:async()=>{s(!0);const e=[];if(v&&(d?e.push((async()=>{const{content_uri:e}=await a.uploadContent(d);await a.sendStateEvent(n.roomId,g.b.RoomAvatar,{url:e},"")})()):e.push(a.sendStateEvent(n.roomId,g.b.RoomAvatar,{},""))),_&&e.push(a.setRoomName(n.roomId,f)),k){const t=Object(be.b)(O,{forceHTML:!1});e.push(a.setRoomTopic(n.roomId,O,t))}const t=await Promise.allSettled(e);s(!1);const i=t.filter(e=>"rejected"===e.status);i.length>0&&(Y.a.error("Failed to save space settings: ",i),c(Object(y.a)("Failed to save space settings.")))},disabled:r,kind:"primary"},r?Object(y.a)("Saving..."):Object(y.a)("Save Changes"))),h.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(y.a)("Leave Space")),h.a.createElement("div",{className:"mx_SettingsTab_section mx_SettingsTab_subsectionText"},h.a.createElement(ve.a,{kind:"danger",onClick:()=>{Object(ye.b)(n)}},Object(y.a)("Leave Space"))))},we=a(128),Se=a(885),Oe=a(359),Ce=a(203),xe=a(818),ke=a(894),je=a(316),Re=a(362),Ie=a(218);var Te=e=>{let{matrixClient:t,space:a,closeSettingsFn:n}=e;const[i,r]=Object(m.useState)(""),s=Object(Ie.a)(async()=>t.doesServerSupportUnstableFeature("org.matrix.msc3827.stable"),[t],!1),o=t.getUserId(),c=Object(je.a)(a,e=>e.getJoinRule()),[l,d]=Object(xe.a)(()=>{var e,t;return(null===(e=a.currentState.getStateEvents(g.b.RoomGuestAccess,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.guest_access)===we.a.CanJoin},e=>t.sendStateEvent(a.roomId,g.b.RoomGuestAccess,{guest_access:e?we.a.CanJoin:we.a.Forbidden},""),()=>r(Object(y.a)("Failed to update the guest access of this space"))),[u,p]=Object(xe.a)(()=>{var e,t;return(null===(e=a.currentState.getStateEvents(g.b.RoomHistoryVisibility,""))||void 0===e||null===(t=e.getContent())||void 0===t?void 0:t.history_visibility)||we.b.Shared},e=>t.sendStateEvent(a.roomId,g.b.RoomHistoryVisibility,{history_visibility:e},""),()=>r(Object(y.a)("Failed to update the history visibility of this space"))),[v,f]=Object(Oe.a)(),b=a.currentState.maySendStateEvent(g.b.RoomGuestAccess,o),E=a.currentState.maySendStateEvent(g.b.RoomHistoryVisibility,o),_=a.currentState.mayClientSendStateEvent(g.b.RoomCanonicalAlias,t),w=a.currentState.getStateEvents(g.b.RoomCanonicalAlias,"");let S,O;return c===we.c.Public&&(S=h.a.createElement("div",null,h.a.createElement(ve.a,{"data-test-id":"toggle-guest-access-btn",onClick:f,kind:"link",className:"mx_SettingsTab_showAdvanced"},v?Object(y.a)("Hide advanced"):Object(y.a)("Show advanced")),v&&h.a.createElement("div",{className:"mx_SettingsTab_toggleWithDescription"},h.a.createElement(Ce.a,{value:l,onChange:d,disabled:!b,label:Object(y.a)("Enable guest access")}),h.a.createElement("p",null,Object(y.a)("Guests can join a space without having an account."),h.a.createElement("br",null),Object(y.a)("This may be useful for public spaces."))))),a.getJoinRule()===we.c.Public&&(O=h.a.createElement(h.a.Fragment,null,h.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(y.a)("Address")),h.a.createElement(Se.a,{roomId:a.roomId,canSetCanonicalAlias:_,canSetAliases:!0,canonicalAliasEvent:w,hidePublishSetting:!s}))),h.a.createElement("div",{className:"mx_SettingsTab"},h.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(y.a)("Visibility")),i&&h.a.createElement("div",{"data-test-id":"space-settings-error",className:"mx_SpaceRoomView_errorText"},i),h.a.createElement(Re.a,{"data-test-id":"access-fieldset",legend:Object(y.a)("Access"),description:Object(y.a)("Decide who can view and join %(spaceName)s.",{spaceName:a.name})},h.a.createElement(ke.a,{room:a,onError:()=>r(Object(y.a)("Failed to update the visibility of this space")),closeSettingsFn:n}),S,h.a.createElement("div",{className:"mx_SettingsTab_toggleWithDescription"},h.a.createElement(Ce.a,{value:u===we.b.WorldReadable,onChange:e=>{p(e?we.b.WorldReadable:we.b.Shared)},disabled:!E,label:Object(y.a)("Preview Space")}),h.a.createElement("p",null,Object(y.a)("Allow people to preview your space before they join."),h.a.createElement("br",null),h.a.createElement("b",null,Object(y.a)("Recommended for public spaces."))))),O)},Ne=a(126),De=a(813),Pe=a(815);let Me;!function(e){e.General="SPACE_GENERAL_TAB",e.Visibility="SPACE_VISIBILITY_TAB",e.Roles="SPACE_ROLES_TAB",e.Advanced="SPACE_ADVANCED_TAB"}(Me||(Me={}));var Ae=e=>{let{matrixClient:t,space:a,onFinished:n}=e;Object(ge.a)(o.a,e=>{e.action===L.a.AfterLeaveRoom&&e.room_id===a.roomId&&n(!1)});const i=Object(m.useMemo)(()=>[new ce.a(Me.General,Object(y.c)("General"),"mx_SpaceSettingsDialog_generalIcon",h.a.createElement(_e,{matrixClient:t,space:a,onFinished:n})),new ce.a(Me.Visibility,Object(y.c)("Visibility"),"mx_SpaceSettingsDialog_visibilityIcon",h.a.createElement(Te,{matrixClient:t,space:a,closeSettingsFn:n})),new ce.a(Me.Roles,Object(y.c)("Roles & Permissions"),"mx_RoomSettingsDialog_rolesIcon",h.a.createElement(Pe.a,{roomId:a.roomId})),X.b.getValue(Ne.b.AdvancedSettings)?new ce.a(Me.Advanced,Object(y.c)("Advanced"),"mx_RoomSettingsDialog_warningIcon",h.a.createElement(De.a,{roomId:a.roomId,closeSettingsFn:n})):null].filter(Boolean),[t,a,n]);return h.a.createElement(w.a,{title:Object(y.a)("Space settings"),className:"mx_SpaceSettingsDialog",contentId:"mx_SpaceSettingsDialog",onFinished:n,fixedWidth:!1},h.a.createElement("div",{className:"mx_SpaceSettingsDialog_content",id:"mx_SpaceSettingsDialog",title:Object(y.a)("Settings - %(spaceName)s",{spaceName:a.name})},h.a.createElement(ce.c,{tabs:i})))},Le=a(889),Ue=a(350),Fe=a(127),Be=a(221),Ve=a(130);class ze{constructor(){i()(this,"isRegistered",!1),i()(this,"onDispatch",e=>{switch(e.action){case"open_room_settings":c.a.createDialog(l.c,{roomId:e.room_id||Ve.b.instance.roomViewStore.getRoomId(),initialTabId:e.initial_tab_id},null,!1,!0);break;case L.a.OpenForwardDialog:c.a.createDialog(q,{matrixClient:K.a.get(),event:e.event,permalinkCreator:e.permalinkCreator});break;case L.a.OpenReportEventDialog:c.a.createDialog(oe,{mxEvent:e.event},"mx_Dialog_reportEvent");break;case L.a.OpenSpacePreferences:c.a.createDialog(pe,{initialTabId:e.initalTabId,space:e.space},null,!1,!0);break;case L.a.OpenSpaceSettings:c.a.createDialog(Ae,{matrixClient:e.space.client,space:e.space},null,!1,!0);break;case L.a.OpenInviteDialog:c.a.createDialog(Le.a,{kind:e.kind,call:e.call,roomId:e.roomId},s()("mx_InviteDialog_flexWrapper",e.className),!1,!0).finished.then(t=>{var a;null===(a=e.onFinishedCallback)||void 0===a||a.call(e,t)});break;case L.a.OpenAddToExistingSpaceDialog:{const t=e.space;c.a.createDialog(Ue.d,{onCreateRoomClick:e=>{Object(Be.g)(t),Fe.b.trackInteraction("WebAddExistingToSpaceDialogCreateRoomButton",e)},onAddSubspaceClick:()=>Object(Be.f)(t),space:t,onFinished:e=>{e&&Ve.b.instance.roomViewStore.getRoomId()===t.roomId&&o.a.fire(L.a.UpdateSpaceHierarchy)}},"mx_AddExistingToSpaceDialog_wrapper");break}}})}prepare(){this.isRegistered||(o.a.register(this.onDispatch),this.isRegistered=!0)}}i()(ze,"instance",new ze)},1527:function(e,t,a){"use strict";a.d(t,"a",(function(){return A}));var n=a(6),i=a.n(n),r=a(1),s=a(145),o=a(107),c=a(92),l=a(94),d=a(91),u=a(219),m=a(165),h=a(98);var p=a(97),g=a(430),v=a(222),f=a(266),b=a(104);const y=e=>{switch(e){case S.SET_UP_ENCRYPTION:return Object(d.a)("Set up Secure Backup");case S.UPGRADE_ENCRYPTION:return Object(d.a)("Encryption upgrade available");case S.VERIFY_THIS_SESSION:return Object(d.a)("Verify this session")}},E=e=>{switch(e){case S.SET_UP_ENCRYPTION:case S.UPGRADE_ENCRYPTION:return"secure_backup";case S.VERIFY_THIS_SESSION:return"verification_warning"}},_=e=>{switch(e){case S.SET_UP_ENCRYPTION:return Object(d.a)("Continue");case S.UPGRADE_ENCRYPTION:return Object(d.a)("Upgrade");case S.VERIFY_THIS_SESSION:return Object(d.a)("Verify")}},w=e=>{switch(e){case S.SET_UP_ENCRYPTION:case S.UPGRADE_ENCRYPTION:return Object(d.a)("Safeguard against losing access to encrypted messages & data");case S.VERIFY_THIS_SESSION:return Object(d.a)("Other users may not trust it")}};let S;!function(e){e.SET_UP_ENCRYPTION="set_up_encryption",e.UPGRADE_ENCRYPTION="upgrade_encryption",e.VERIFY_THIS_SESSION="verify_this_session"}(S||(S={}));const O=()=>{A.sharedInstance().dismissEncryptionSetup()},C=e=>{var t;if(null!==(t=f.a.setupEncryptionNeeded)&&void 0!==t&&t.call(f.a,e))return;m.a.sharedInstance().addOrReplaceToast({key:"setupencryption",title:y(e),icon:E(e),props:{description:w(e),acceptLabel:_(e),onAccept:async()=>{if(e===S.VERIFY_THIS_SESSION)p.a.createDialog(g.a,{},null,!1,!0);else{const e=p.a.createDialog(b.a,null,"mx_Dialog_spinner",!1,!0);try{await Object(v.b)()}finally{e.close()}}},rejectLabel:Object(d.a)("Later"),onReject:O},component:u.a,priority:e===S.VERIFY_THIS_SESSION?95:40})},x=()=>{m.a.sharedInstance().dismissToast("setupencryption")};function k(e){return"unverified_session_"+e}const j=async e=>{const t=c.a.get(),a=await t.getDevice(e);m.a.sharedInstance().addOrReplaceToast({key:k(e),title:Object(d.a)("New login. Was this you?"),icon:"verification_warning",props:{description:a.display_name,detail:Object(d.a)("%(deviceId)s from %(ip)s",{deviceId:e,ip:a.last_seen_ip}),acceptLabel:Object(d.a)("Check your devices"),onAccept:()=>{A.sharedInstance().dismissUnverifiedSessions([e]),l.a.dispatch({action:h.a.ViewUserDeviceSettings})},rejectLabel:Object(d.a)("Later"),onReject:()=>{A.sharedInstance().dismissUnverifiedSessions([e])}},component:u.a,priority:80})},R=e=>{m.a.sharedInstance().dismissToast(k(e))};var I=a(213),T=a(331);var N=a(100),D=a(124),P=a(834),M=a(95);class A{constructor(){i()(this,"dispatcherRef",void 0),i()(this,"dismissed",new Set),i()(this,"dismissedThisDeviceToast",!1),i()(this,"keyBackupInfo",null),i()(this,"keyBackupFetchedAt",null),i()(this,"keyBackupStatusChecked",!1),i()(this,"ourDeviceIdsAtStart",null),i()(this,"displayingToastsForDeviceIds",new Set),i()(this,"running",!1),i()(this,"shouldRecordClientInformation",!1),i()(this,"deviceClientInformationSettingWatcherRef",void 0),i()(this,"onWillUpdateDevices",async(e,t)=>{if(t)return;const a=c.a.get().getUserId();e.includes(a)&&this.ensureDeviceIdsAtStartPopulated()}),i()(this,"onDevicesUpdated",e=>{e.includes(c.a.get().getUserId())&&this.recheck()}),i()(this,"onDeviceVerificationChanged",e=>{e===c.a.get().getUserId()&&this.recheck()}),i()(this,"onUserTrustStatusChanged",e=>{e===c.a.get().getUserId()&&this.recheck()}),i()(this,"onCrossSingingKeysChanged",()=>{this.recheck()}),i()(this,"onAccountData",e=>{(e.getType().startsWith("m.secret_storage.")||e.getType().startsWith("m.cross_signing.")||"m.megolm_backup.v1"===e.getType())&&this.recheck()}),i()(this,"onSync",(e,t)=>{"PREPARED"===e&&null===t&&this.recheck()}),i()(this,"onRoomStateEvents",e=>{e.getType()===o.EventType.RoomEncryption&&this.recheck()}),i()(this,"onAction",e=>{let{action:t}=e;t===h.a.OnLoggedIn&&(this.recheck(),this.updateClientInformation())}),i()(this,"checkKeyBackupStatus",async()=>{if(this.keyBackupStatusChecked)return;const e=c.a.get().getKeyBackupEnabled();this.keyBackupStatusChecked=null!==e,!1===e&&l.a.dispatch({action:h.a.ReportKeyBackupNotEnabled})}),i()(this,"onRecordClientInformationSettingChange",(e,t,a,n,i)=>{const r=this.shouldRecordClientInformation;this.shouldRecordClientInformation=!!i,this.shouldRecordClientInformation!==r&&this.updateClientInformation()}),i()(this,"updateClientInformation",async()=>{try{this.shouldRecordClientInformation?await Object(P.b)(c.a.get(),N.b.get(),D.a.get()):await Object(P.c)(c.a.get())}catch(e){r.a.error("Failed to update client information",e)}})}static sharedInstance(){return window.mxDeviceListener||(window.mxDeviceListener=new A),window.mxDeviceListener}start(){this.running=!0,c.a.get().on(s.b.WillUpdateDevices,this.onWillUpdateDevices),c.a.get().on(s.b.DevicesUpdated,this.onDevicesUpdated),c.a.get().on(s.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),c.a.get().on(s.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),c.a.get().on(s.b.KeysChanged,this.onCrossSingingKeysChanged),c.a.get().on(o.ClientEvent.AccountData,this.onAccountData),c.a.get().on(o.ClientEvent.Sync,this.onSync),c.a.get().on(o.RoomStateEvent.Events,this.onRoomStateEvents),this.shouldRecordClientInformation=M.b.getValue("deviceClientInformationOptIn"),this.deviceClientInformationSettingWatcherRef=M.b.watchSetting("deviceClientInformationOptIn",null,this.onRecordClientInformationSettingChange),this.dispatcherRef=l.a.register(this.onAction),this.recheck(),this.updateClientInformation()}stop(){this.running=!1,c.a.get()&&(c.a.get().removeListener(s.b.WillUpdateDevices,this.onWillUpdateDevices),c.a.get().removeListener(s.b.DevicesUpdated,this.onDevicesUpdated),c.a.get().removeListener(s.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),c.a.get().removeListener(s.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),c.a.get().removeListener(s.b.KeysChanged,this.onCrossSingingKeysChanged),c.a.get().removeListener(o.ClientEvent.AccountData,this.onAccountData),c.a.get().removeListener(o.ClientEvent.Sync,this.onSync),c.a.get().removeListener(o.RoomStateEvent.Events,this.onRoomStateEvents)),this.deviceClientInformationSettingWatcherRef&&M.b.unwatchSetting(this.deviceClientInformationSettingWatcherRef),this.dispatcherRef&&(l.a.unregister(this.dispatcherRef),this.dispatcherRef=null),this.dismissed.clear(),this.dismissedThisDeviceToast=!1,this.keyBackupInfo=null,this.keyBackupFetchedAt=null,this.keyBackupStatusChecked=!1,this.ourDeviceIdsAtStart=null,this.displayingToastsForDeviceIds=new Set}async dismissUnverifiedSessions(e){r.a.log("Dismissing unverified sessions: "+Array.from(e).join(","));for(const t of e)this.dismissed.add(t);this.recheck()}dismissEncryptionSetup(){this.dismissedThisDeviceToast=!0,this.recheck()}ensureDeviceIdsAtStartPopulated(){if(null===this.ourDeviceIdsAtStart){const e=c.a.get();this.ourDeviceIdsAtStart=new Set(e.getStoredDevicesForUser(e.getUserId()).map(e=>e.deviceId))}}async getKeyBackupInfo(){const e=(new Date).getTime();return(!this.keyBackupInfo||this.keyBackupFetchedAt<e-3e5)&&(this.keyBackupInfo=await c.a.get().getKeyBackupVersion(),this.keyBackupFetchedAt=e),this.keyBackupInfo}shouldShowSetupEncryptionToast(){if(Object(v.d)())return!1;const e=c.a.get();return e&&e.getRooms().some(t=>e.isRoomEncrypted(t.roomId))}async recheck(){if(!this.running)return;const e=c.a.get();if(!await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"))return;if(!e.isCryptoEnabled())return;if(!e.isInitialSyncComplete())return;const t=await e.isCrossSigningReady(),a=await e.isSecretStorageReady(),n=t&&a;if(this.dismissedThisDeviceToast||n)x(),this.checkKeyBackupStatus();else if(this.shouldShowSetupEncryptionToast())if(await e.downloadKeys([e.getUserId()]),!e.getCrossSigningId()&&e.getStoredCrossSigningForUser(e.getUserId()))C(S.VERIFY_THIS_SESSION),this.checkKeyBackupStatus();else{await this.getKeyBackupInfo()?C(S.UPGRADE_ENCRYPTION):(await e.waitForClientWellKnown(),Object(I.g)()&&function(){const e=window.matrixChat;return e&&e.state.view===T.a.LOGGED_IN}()?(x(),Object(v.b)()):C(S.SET_UP_ENCRYPTION))}this.ensureDeviceIdsAtStartPopulated();const i=new Set,s=new Set;if(t){const t=e.getStoredDevicesForUser(e.getUserId());for(const a of t){if(a.deviceId===e.deviceId)continue;(await e.checkDeviceTrust(e.getUserId(),a.deviceId)).isCrossSigningVerified()||this.dismissed.has(a.deviceId)||(this.ourDeviceIdsAtStart.has(a.deviceId)?i.add(a.deviceId):s.add(a.deviceId))}}var o;r.a.debug("Old unverified sessions: "+Array.from(i).join(",")),r.a.debug("New unverified sessions: "+Array.from(s).join(",")),r.a.debug("Currently showing toasts for: "+Array.from(this.displayingToastsForDeviceIds).join(",")),i.size>0?(o=i,m.a.sharedInstance().addOrReplaceToast({key:"reviewsessions",title:Object(d.a)("You have unverified logins"),icon:"verification_warning",props:{description:Object(d.a)("Review to ensure your account is safe"),acceptLabel:Object(d.a)("Review"),onAccept:()=>{A.sharedInstance().dismissUnverifiedSessions(o),l.a.dispatch({action:h.a.ViewUserDeviceSettings})},rejectLabel:Object(d.a)("Later"),onReject:()=>{A.sharedInstance().dismissUnverifiedSessions(o)}},component:u.a,priority:50})):m.a.sharedInstance().dismissToast("reviewsessions");for(const e of s)j(e);for(const e of this.displayingToastsForDeviceIds)s.has(e)||(r.a.debug("Hiding unverified session toast for "+e),R(e));this.displayingToastsForDeviceIds=s}}},1529:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(468),c=a(382),l=a(1),d=a(92),u=a(91),m=a(131),h=a(115);class p extends s.a.Component{render(){return s.a.createElement("div",null,s.a.createElement("h2",null,Object(u.a)("Verified!")),s.a.createElement("p",null,Object(u.a)("You've successfully verified this user.")),s.a.createElement("p",null,Object(u.a)("Secure messages with this user are end-to-end encrypted and not able to be read by third parties.")),s.a.createElement(h.a,{onPrimaryButtonClick:this.props.onDone,primaryButton:Object(u.a)("Got It"),hasCancel:!1}))}}class g extends s.a.Component{render(){return s.a.createElement("div",null,s.a.createElement("p",null,Object(u.a)("The other party cancelled the verification.")),s.a.createElement(h.a,{primaryButton:Object(u.a)("OK"),hasCancel:!1,onPrimaryButtonClick:this.props.onDone}))}}var v=a(153),f=a(104),b=a(831),y=a(105);class E extends s.a.Component{constructor(e){super(e),i()(this,"showSasEvent",void 0),i()(this,"onFinished",()=>{this.props.onFinished(3===this.state.phase)}),i()(this,"onCancelClick",()=>{this.props.onFinished(3===this.state.phase)}),i()(this,"onContinueClick",()=>{this.setState({phase:2}),this.props.verifier.verify().then(()=>{this.setState({phase:3})}).catch(e=>{l.a.log("Verification failed",e)})}),i()(this,"onVerifierShowSas",e=>{this.showSasEvent=e,this.setState({phase:1,sas:e.sas})}),i()(this,"onVerifierCancel",()=>{this.setState({phase:4})}),i()(this,"onSasMatchesClick",()=>{this.showSasEvent.confirm(),this.setState({phase:2})}),i()(this,"onVerifiedDoneClick",()=>{this.props.onFinished(!0)});let t=0;this.props.verifier.hasBeenCancelled&&(l.a.log("Verifier was cancelled in the background."),t=4),this.showSasEvent=null,this.state={phase:t,sasVerified:!1,opponentProfile:null,opponentProfileError:null,sas:null},this.props.verifier.on(o.b.ShowSas,this.onVerifierShowSas),this.props.verifier.on(c.c.Cancel,this.onVerifierCancel),this.fetchOpponentProfile()}componentWillUnmount(){4!==this.state.phase&&3!==this.state.phase&&this.props.verifier.cancel(new Error("User cancel")),this.props.verifier.removeListener(o.b.ShowSas,this.onVerifierShowSas)}async fetchOpponentProfile(){try{const e=await d.a.get().getProfileInfo(this.props.verifier.userId);this.setState({opponentProfile:e})}catch(e){this.setState({opponentProfileError:e})}}renderPhaseStart(){const e=this.props.verifier.userId===d.a.get().getUserId();let t;const a=this.state.opponentProfile;if(a){const e=a.avatar_url?Object(m.b)(a.avatar_url).getSquareThumbnailHttp(48):null;t=s.a.createElement("div",{className:"mx_IncomingSasDialog_opponentProfile"},s.a.createElement(v.a,{name:a.displayname,idName:this.props.verifier.userId,url:e,width:48,height:48,resizeMethod:"crop"}),s.a.createElement("h2",null,a.displayname))}else t=this.state.opponentProfileError?s.a.createElement("div",null,s.a.createElement(v.a,{name:this.props.verifier.userId.slice(1),idName:this.props.verifier.userId,width:48,height:48}),s.a.createElement("h2",null,this.props.verifier.userId)):s.a.createElement(f.a,null);const n=[s.a.createElement("p",{key:"p1"},Object(u.a)("Verify this user to mark them as trusted. Trusting users gives you extra peace of mind when using end-to-end encrypted messages.")),s.a.createElement("p",{key:"p2"},Object(u.a)("Verifying this user will mark their session as trusted, and also mark your session as trusted to them."))],i=[s.a.createElement("p",{key:"p1"},Object(u.a)("Verify this device to mark it as trusted. Trusting this device gives you and other users extra peace of mind when using end-to-end encrypted messages.")),s.a.createElement("p",{key:"p2"},Object(u.a)("Verifying this device will mark it as trusted, and users who have verified with you will trust this device."))];return s.a.createElement("div",null,t,e?i:n,s.a.createElement(h.a,{primaryButton:Object(u.a)("Continue"),hasCancel:!0,onPrimaryButtonClick:this.onContinueClick,onCancel:this.onCancelClick}))}renderPhaseShowSas(){return s.a.createElement(b.a,{sas:this.showSasEvent.sas,onCancel:this.onCancelClick,onDone:this.onSasMatchesClick,isSelf:this.props.verifier.userId===d.a.get().getUserId(),inDialog:!0})}renderPhaseWaitForPartnerToConfirm(){return s.a.createElement("div",null,s.a.createElement(f.a,null),s.a.createElement("p",null,Object(u.a)("Waiting for partner to confirm...")))}renderPhaseVerified(){return s.a.createElement(p,{onDone:this.onVerifiedDoneClick})}renderPhaseCancelled(){return s.a.createElement(g,{onDone:this.onCancelClick})}render(){let e;switch(this.state.phase){case 0:e=this.renderPhaseStart();break;case 1:e=this.renderPhaseShowSas();break;case 2:e=this.renderPhaseWaitForPartnerToConfirm();break;case 3:e=this.renderPhaseVerified();break;case 4:e=this.renderPhaseCancelled()}return s.a.createElement(y.a,{title:Object(u.a)("Incoming Verification Request"),onFinished:this.onFinished,fixedWidth:!1},e)}}},1530:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(96),i=a.n(n),r=a(90),s=a.n(r),o=a(91),c=a(434),l=a(101),d=a.n(l),u=a(103),m=a.n(u);const h=["children","className"];function p(e){let{children:t,className:a}=e,n=m()(e,h);const r=i()(a,"mx_SplashPage");return s.a.createElement("main",d()({},n,{className:r}),t)}var g=a(93);function v(e){let t,{useCase:a,onClick:n,selected:r}=e;switch(a){case c.a.PersonalMessaging:t=Object(o.a)("Friends and family");break;case c.a.WorkMessaging:t=Object(o.a)("Coworkers and teams");break;case c.a.CommunityMessaging:t=Object(o.a)("Online community members")}return s.a.createElement(g.a,{className:i()("mx_UseCaseSelectionButton",{mx_UseCaseSelectionButton_selected:r}),onClick:async()=>n(a)},s.a.createElement("div",{className:i()("mx_UseCaseSelectionButton_icon",{mx_UseCaseSelectionButton_messaging:a===c.a.PersonalMessaging,mx_UseCaseSelectionButton_work:a===c.a.WorkMessaging,mx_UseCaseSelectionButton_community:a===c.a.CommunityMessaging})}),s.a.createElement("span",null,t),s.a.createElement("div",{className:"mx_UseCaseSelectionButton_selectedIcon"}))}function f(e){let{onFinished:t}=e;const[a,n]=Object(r.useState)(null);return Object(r.useEffect)(()=>{if(a){let e=setTimeout(()=>{e=null,t(a)},1500);return()=>{clearTimeout(e),e=null}}},[a,t]),s.a.createElement(p,{className:i()("mx_UseCaseSelection",{mx_UseCaseSelection_selected:null!==a})},s.a.createElement("div",{className:"mx_UseCaseSelection_title mx_UseCaseSelection_slideIn"},s.a.createElement("h1",null,Object(o.a)("You're in"))),s.a.createElement("div",{className:"mx_UseCaseSelection_info mx_UseCaseSelection_slideInDelayed"},s.a.createElement("h2",null,Object(o.a)("Who will you chat to the most?")),s.a.createElement("h3",null,Object(o.a)("We'll help you get connected."))),s.a.createElement("div",{className:"mx_UseCaseSelection_options mx_UseCaseSelection_slideInDelayed"},s.a.createElement(v,{useCase:c.a.PersonalMessaging,selected:a===c.a.PersonalMessaging,onClick:n}),s.a.createElement(v,{useCase:c.a.WorkMessaging,selected:a===c.a.WorkMessaging,onClick:n}),s.a.createElement(v,{useCase:c.a.CommunityMessaging,selected:a===c.a.CommunityMessaging,onClick:n})),s.a.createElement("div",{className:"mx_UseCaseSelection_skip mx_UseCaseSelection_slideInDelayed"},s.a.createElement(g.a,{kind:"link",onClick:async()=>n(c.a.Skip)},Object(o.a)("Skip"))))}},1532:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(90),i=a.n(n),r=a(96),s=a.n(r),o=a(100),c=a(284),l=a(91),d=a(95),u=a(126),m=a(874),h=a(589);const p=`<a href="https://matrix.org" target="_blank" rel="noreferrer noopener">\n    <img width="79" height="34" alt="Matrix" style="padding-left: 1px;vertical-align: middle" src="${a(1503).default}"/>\n</a>`;Object(l.c)("Sign in with SSO");class g extends i.a.PureComponent{render(){const e=o.b.getObject("embedded_pages");let t=null;return e&&(t=e.get("welcome_url")),t||(t="welcome.html"),i.a.createElement(c.a,null,i.a.createElement("div",{className:s()("mx_Welcome",{mx_WelcomePage_registrationDisabled:!d.b.getValue(u.b.Registration)})},i.a.createElement(h.a,{className:"mx_WelcomePage",url:t,replaceMap:{"$riot:ssoUrl":"#/start_sso","$riot:casUrl":"#/start_cas",$matrixLogo:p,"[matrix]":p}}),i.a.createElement(m.a,null)))}}},1533:function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(96),c=a.n(o),l=a(1),d=a(107),u=a(91),m=a(97);class h{constructor(e,t){i()(this,"client",void 0),i()(this,"clientSecret",void 0),i()(this,"password",void 0),i()(this,"sessionId",void 0),i()(this,"logoutDevices",void 0),this.client=Object(d.createClient)({baseUrl:e,idBaseUrl:t}),this.clientSecret=this.client.generateClientSecret()}resetPassword(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.password=t,this.logoutDevices=a,this.client.requestPasswordEmailToken(e,this.clientSecret,1).then(e=>(this.sessionId=e.sid,e),(function(e){throw"M_THREEPID_NOT_FOUND"===e.errcode?e.message=Object(u.a)("This email address was not found"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}async checkEmailLinkClicked(){const e={sid:this.sessionId,client_secret:this.clientSecret};try{await this.client.setPassword({type:"m.login.email.identity",threepid_creds:e,threepidCreds:e},this.password,this.logoutDevices)}catch(e){throw 401===e.httpStatus?e.message=Object(u.a)("Failed to verify email address: make sure you clicked the link in the email"):404===e.httpStatus?e.message=Object(u.a)("Your email address does not appear to be associated with a Matrix ID on this Homeserver."):e.httpStatus&&(e.message+=` (Status ${e.httpStatus})`),e}}}var p,g,v=a(320),f=a(284),b=a(606),y=a(436),E=a(318),_=a(605),w=a(176),S=a(104),O=a(123),C=a(112),x=a(437),k=a(438),j=a(869),R=a(93),I=a(147);!function(e){e[e.Forgot=1]="Forgot",e[e.SendingEmail=2]="SendingEmail",e[e.EmailSent=3]="EmailSent",e[e.Done=4]="Done"}(p||(p={})),function(e){e.Email="field_email",e.Password="field_password",e.PasswordConfirm="field_password_confirm"}(g||(g={}));class T extends s.a.Component{constructor(){super(...arguments),i()(this,"reset",void 0),i()(this,"state",{phase:p.Forgot,email:"",password:"",password2:"",errorText:null,serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:"",serverSupportsControlOfDevicesLogout:!1,logoutDevices:!1}),i()(this,"onVerify",async e=>{if(e.preventDefault(),this.reset){if(!this.state.currentHttpRequest)try{await this.handleHttpRequest(this.reset.checkEmailLinkClicked()),this.setState({phase:p.Done})}catch(e){this.showErrorDialog(e.message)}}else l.a.error("onVerify called before submitPasswordReset!")}),i()(this,"onSubmitForm",async e=>{if(e.preventDefault(),this.state.currentHttpRequest)return;await this.handleHttpRequest(this.checkServerLiveliness(this.props.serverConfig));if(await this.verifyFieldsBeforeSubmit()){if(this.state.logoutDevices){const{finished:e}=m.a.createDialog(O.a,{title:Object(u.a)("Warning!"),description:s.a.createElement("div",null,s.a.createElement("p",null,this.state.serverSupportsControlOfDevicesLogout?Object(u.a)("Signing out your devices will delete the message encryption keys stored on them, making encrypted chat history unreadable."):Object(u.a)("Resetting your password on this homeserver will cause all of your devices to be signed out. This will delete the message encryption keys stored on them, making encrypted chat history unreadable.")),s.a.createElement("p",null,Object(u.a)("If you want to retain access to your chat history in encrypted rooms, set up Key Backup or export your message keys from one of your other devices before proceeding."))),button:Object(u.a)("Continue")}),[t]=await e;if(!t)return}this.submitPasswordReset(this.state.email,this.state.password,this.state.logoutDevices)}}),i()(this,"onInputChanged",(e,t)=>{let a=t.currentTarget.value;"email"===e&&(a=a.trim()),this.setState({[e]:a})}),i()(this,"onLoginClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onLoginClick()})}componentDidMount(){this.reset=null,this.checkServerLiveliness(this.props.serverConfig),this.checkServerCapabilities(this.props.serverConfig)}UNSAFE_componentWillReceiveProps(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||(this.checkServerLiveliness(e.serverConfig),this.checkServerCapabilities(e.serverConfig))}async checkServerLiveliness(e){try{await v.a.validateServerConfigWithStaticUrls(e.hsUrl,e.isUrl),this.setState({serverIsAlive:!0})}catch(e){this.setState(v.a.authComponentStateForError(e,"forgot_password"))}}async checkServerCapabilities(e){const t=Object(d.createClient)({baseUrl:e.hsUrl}),a=await t.doesServerSupportLogoutDevices();this.setState({logoutDevices:!a,serverSupportsControlOfDevicesLogout:a})}submitPasswordReset(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.setState({phase:p.SendingEmail}),this.reset=new h(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl),this.reset.resetPassword(e,t,a).then(()=>{this.setState({phase:p.EmailSent})},e=>{this.showErrorDialog(Object(u.a)("Failed to send email")+": "+e.message),this.setState({phase:p.Forgot})})}async verifyFieldsBeforeSubmit(){const e=[g.Email,g.Password,g.PasswordConfirm],t=[];for(const a of e){await this[a].validate({allowEmpty:!1})||t.push(this[a])}return 0===t.length||(t[0].focus(),t[0].validate({allowEmpty:!1,focused:!0}),!1)}showErrorDialog(e,t){m.a.createDialog(C.a,{title:t,description:e})}handleHttpRequest(e){return this.setState({currentHttpRequest:e}),e.finally(()=>{this.setState({currentHttpRequest:void 0})})}renderForgot(){let e=null;const t=this.state.errorText;let a;if(t&&(e=s.a.createElement("div",{className:"mx_Login_error"},t)),!this.state.serverIsAlive){const e=c()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});a=s.a.createElement("div",{className:e},this.state.serverDeadError)}return s.a.createElement("div",null,e,a,s.a.createElement(b.a,{serverConfig:this.props.serverConfig,onServerConfigChange:this.props.onServerConfigChange}),s.a.createElement("form",{onSubmit:this.onSubmitForm},s.a.createElement("div",{className:"mx_AuthBody_fieldRow"},s.a.createElement(y.a,{name:"reset_email",labelRequired:Object(u.c)("The email address linked to your account must be entered."),labelInvalid:Object(u.c)("The email address doesn't appear to be valid."),value:this.state.email,fieldRef:e=>this[g.Email]=e,autoFocus:!0,onChange:this.onInputChanged.bind(this,"email")})),s.a.createElement("div",{className:"mx_AuthBody_fieldRow"},s.a.createElement(E.a,{name:"reset_password",type:"password",label:Object(u.c)("New Password"),value:this.state.password,minScore:_.a,fieldRef:e=>this[g.Password]=e,onChange:this.onInputChanged.bind(this,"password"),autoComplete:"new-password"}),s.a.createElement(j.a,{name:"reset_password_confirm",label:Object(u.c)("Confirm"),labelRequired:Object(u.c)("A new password must be entered."),labelInvalid:Object(u.c)("New passwords must match each other."),value:this.state.password2,password:this.state.password,fieldRef:e=>this[g.PasswordConfirm]=e,onChange:this.onInputChanged.bind(this,"password2"),autoComplete:"new-password"})),this.state.serverSupportsControlOfDevicesLogout?s.a.createElement("div",{className:"mx_AuthBody_fieldRow"},s.a.createElement(I.b,{onChange:()=>this.setState({logoutDevices:!this.state.logoutDevices}),checked:this.state.logoutDevices},Object(u.a)("Sign out all devices"))):null,s.a.createElement("span",null,Object(u.a)("A verification email will be sent to your inbox to confirm setting your new password.")),s.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:Object(u.a)("Send Reset Email")})),s.a.createElement(R.a,{kind:"link",className:"mx_AuthBody_changeFlow",onClick:this.onLoginClick},Object(u.a)("Sign in instead")))}renderSendingEmail(){return s.a.createElement(S.a,null)}renderEmailSent(){return s.a.createElement("div",null,Object(u.a)("An email has been sent to %(emailAddress)s. Once you've followed the link it contains, click below.",{emailAddress:this.state.email}),s.a.createElement("br",null),s.a.createElement("input",{className:"mx_Login_submit",type:"button",onClick:this.onVerify,value:Object(u.a)("I have verified my email address")}),this.state.currentHttpRequest&&s.a.createElement("div",{className:"mx_Login_spinner"},s.a.createElement(w.a,{w:64,h:64})))}renderDone(){return s.a.createElement("div",null,s.a.createElement("p",null,Object(u.a)("Your password has been reset.")),this.state.logoutDevices?s.a.createElement("p",null,Object(u.a)("You have been logged out of all devices and will no longer receive push notifications. To re-enable notifications, sign in again on each device.")):null,s.a.createElement("input",{className:"mx_Login_submit",type:"button",onClick:this.props.onComplete,value:Object(u.a)("Return to login screen")}))}render(){let e;switch(this.state.phase){case p.Forgot:e=this.renderForgot();break;case p.SendingEmail:e=this.renderSendingEmail();break;case p.EmailSent:e=this.renderEmailSent();break;case p.Done:e=this.renderDone();break;default:e=s.a.createElement("div",{className:"mx_Login_spinner"},s.a.createElement(w.a,{w:64,h:64}))}return s.a.createElement(f.a,null,s.a.createElement(x.a,null),s.a.createElement(k.a,null,s.a.createElement("h1",null," ",Object(u.a)("Set a new password")," "),e))}}},1534:function(e,t,a){"use strict";a.d(t,"a",(function(){return y}));var n=a(90),i=a.n(n),r=a(284),s=a(873),o=a(6),c=a.n(o),l=a(1),d=a(92),u=a(91),m=a(97),h=a(282),p=a(115),g=a(105),v=a(104),f=a(226);class b extends i.a.PureComponent{constructor(e){super(e),c()(this,"doBootstrapUIAuth",async e=>{if(this.state.canUploadKeysWithPasswordOnly&&this.state.accountPassword)await e({type:"m.login.password",identifier:{type:"m.id.user",user:d.a.get().getUserId()},user:d.a.get().getUserId(),password:this.state.accountPassword});else if(this.props.tokenLogin)await e({});else{const t={[h.c.PHASE_PREAUTH]:{title:Object(u.a)("Use Single Sign On to continue"),body:Object(u.a)("To continue, use Single Sign On to prove your identity."),continueText:Object(u.a)("Single Sign On"),continueKind:"primary"},[h.c.PHASE_POSTAUTH]:{title:Object(u.a)("Confirm encryption setup"),body:Object(u.a)("Click the button below to confirm setting up encryption."),continueText:Object(u.a)("Confirm"),continueKind:"primary"}},{finished:a}=m.a.createDialog(f.a,{title:Object(u.a)("Setting up keys"),matrixClient:d.a.get(),makeRequest:e,aestheticsForStagePhases:{[h.c.LOGIN_TYPE]:t,[h.c.UNSTABLE_LOGIN_TYPE]:t}}),[n]=await a;if(!n)throw new Error("Cross-signing key upload auth canceled")}}),c()(this,"bootstrapCrossSigning",async()=>{this.setState({error:null});const e=d.a.get();try{await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:this.doBootstrapUIAuth}),this.props.onFinished(!0)}catch(e){if(this.props.tokenLogin)return void this.props.onFinished(!1);this.setState({error:e}),l.a.error("Error bootstrapping cross-signing",e)}}),c()(this,"onCancel",()=>{this.props.onFinished(!1)}),this.state={error:null,canUploadKeysWithPasswordOnly:!!e.accountPassword||null,accountPassword:e.accountPassword||""},this.state.accountPassword||this.queryKeyUploadAuth()}componentDidMount(){this.bootstrapCrossSigning()}async queryKeyUploadAuth(){try{await d.a.get().uploadDeviceSigningKeys(null,{}),l.a.log("uploadDeviceSigningKeys unexpectedly succeeded without UI auth!")}catch(e){if(!e.data||!e.data.flows)return void l.a.log("uploadDeviceSigningKeys advertised no flows!");const t=e.data.flows.some(e=>1===e.stages.length&&"m.login.password"===e.stages[0]);this.setState({canUploadKeysWithPasswordOnly:t})}}render(){let e;return e=this.state.error?i.a.createElement("div",null,i.a.createElement("p",null,Object(u.a)("Unable to set up keys")),i.a.createElement("div",{className:"mx_Dialog_buttons"},i.a.createElement(p.a,{primaryButton:Object(u.a)("Retry"),onPrimaryButtonClick:this.bootstrapCrossSigning,onCancel:this.onCancel}))):i.a.createElement("div",null,i.a.createElement(v.a,null)),i.a.createElement(g.a,{className:"mx_CreateCrossSigningDialog",onFinished:this.props.onFinished,title:Object(u.a)("Setting up keys"),hasCancel:!1,fixedWidth:!1},i.a.createElement("div",null,e))}}class y extends i.a.Component{render(){return i.a.createElement(r.a,null,i.a.createElement(s.a,null,i.a.createElement(b,{onFinished:this.props.onFinished,accountPassword:this.props.accountPassword,tokenLogin:this.props.tokenLogin})))}}},1535:function(e,t,a){"use strict";a.d(t,"a",(function(){return D}));var n=a(6),i=a.n(n),r=a(107),s=a(90),o=a.n(s),c=a(96),l=a.n(c),d=a(1),u=a(91),m=a(346),h=a(320),p=a(428),g=a(92),v=a(284),f=a(429),b=a(94),y=a(607),E=a(606),_=a(605),w=a(93),S=a(438),O=a(437),C=a(476),x=a(104),k=a(477);function j(e){var t,a;let{title:n,icon:i,serverPicker:r,children:c}=e;const l=Object(s.useContext)(k.a);if(!l)return null;const d=l.state.length?l.state[0]:null;return o.a.createElement(s.Fragment,null,null!==(t=null==d?void 0:d.icon)&&void 0!==t?t:i,o.a.createElement("h1",null,null!==(a=null==d?void 0:d.title)&&void 0!==a?a:n),c,!0!==(null==d?void 0:d.hideServerPicker)&&r)}var R=a(645),I=a(95);function T(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const N=function(){if(I.b.getValue("debug_registration")){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];d.a.log.call(console,"Registration debuglog:",...t)}};class D extends o.a.Component{constructor(e){super(e),i()(this,"loginLogic",void 0),i()(this,"latestServerConfig",void 0),i()(this,"unloadCallback",e=>{if(this.state.doingUIAuth)return e.preventDefault(),e.returnValue="",""}),i()(this,"onFormSubmit",async e=>{this.setState({errorText:"",busy:!0,formVals:e,doingUIAuth:!0})}),i()(this,"requestEmailToken",(e,t,a,n)=>this.state.matrixClient.requestRegisterEmailToken(e,t,a,this.props.makeRegistrationUrl({client_secret:t,hs_url:this.state.matrixClient.getHomeserverUrl(),is_url:this.state.matrixClient.getIdentityServerUrl(),session_id:n}))),i()(this,"onUIAuthFinished",async(e,t)=>{if(N("Registration: ui authentication finished: ",{success:e,response:t}),!e){let e=t.message||t.toString();if("M_RESOURCE_LIMIT_EXCEEDED"===t.errcode){const a=Object(m.a)(t.data.limit_type,t.data.admin_contact,{monthly_active_user:Object(u.c)("This homeserver has hit its Monthly Active User limit."),hs_blocked:Object(u.c)("This homeserver has been blocked by its administrator."),"":Object(u.c)("This homeserver has exceeded one of its resource limits.")}),n=Object(m.a)(t.data.limit_type,t.data.admin_contact,{"":Object(u.c)("Please <a>contact your service administrator</a> to continue using this service.")});e=o.a.createElement("div",null,o.a.createElement("p",null,a),o.a.createElement("p",null,n))}else if(t.required_stages&&t.required_stages.includes(r.AuthType.Msisdn)){let a=!1;for(const e of t.available_flows)a=a||e.stages.includes(r.AuthType.Msisdn);a||(e=Object(u.a)("This server does not support authentication with a phone number."))}else"M_USER_IN_USE"===t.errcode?e=Object(u.a)("Someone already has that username, please try another."):"M_THREEPID_IN_USE"===t.errcode&&(e=Object(u.a)("That e-mail address is already in use."));return void this.setState({busy:!1,doingUIAuth:!1,errorText:e})}g.a.setJustRegisteredUserId(t.user_id);const a={doingUIAuth:!1,registeredUsername:t.user_id,differentLoggedInUserId:null,completedNoSignin:!1,busy:!0},[n,i]=await p.b();n&&!i&&n!==t.user_id&&(d.a.log(`Found a session for ${n} but ${t.user_id} has just registered.`),a.differentLoggedInUserId=n);const s=Boolean(this.state.formVals.email),c=Boolean(t.access_token);N("Registration: ui auth finished:",{hasEmail:s,hasAccessToken:c}),s||!c||a.differentLoggedInUserId?(a.busy=!1,a.completedNoSignin=!0):(await this.props.onLoggedIn({userId:t.user_id,deviceId:t.device_id,homeserverUrl:this.state.matrixClient.getHomeserverUrl(),identityServerUrl:this.state.matrixClient.getIdentityServerUrl(),accessToken:t.access_token},this.state.formVals.password),this.setupPushers()),this.setState(a)}),i()(this,"onLoginClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onLoginClick()}),i()(this,"onGoToFormClicked",e=>{e.preventDefault(),e.stopPropagation(),this.replaceClient(this.props.serverConfig),this.setState({busy:!1,doingUIAuth:!1})}),i()(this,"makeRegisterRequest",e=>{const t={username:this.state.formVals.username,password:this.state.formVals.password,initial_device_display_name:this.props.defaultDeviceDisplayName,auth:void 0,inhibit_login:void 0};return e&&(t.auth=e),N("Registration: sending registration request:",e),this.state.matrixClient.registerRequest(t)}),i()(this,"onLoginClickWithCheck",async e=>{e.preventDefault();const t=await p.h({ignoreGuest:!0});return t||this.props.onLoginClick(),t}),this.state={busy:!1,errorText:null,formVals:{email:this.props.email},doingUIAuth:Boolean(this.props.sessionId),flows:null,completedNoSignin:!1,serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""};const{hsUrl:t,isUrl:a}=this.props.serverConfig;this.loginLogic=new f.a(t,a,null,{defaultDeviceDisplayName:"Element login check"})}componentDidMount(){this.replaceClient(this.props.serverConfig),window.addEventListener("beforeunload",this.unloadCallback)}componentWillUnmount(){window.removeEventListener("beforeunload",this.unloadCallback)}UNSAFE_componentWillReceiveProps(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this.replaceClient(e.serverConfig)}async replaceClient(e){this.latestServerConfig=e;const{hsUrl:t,isUrl:a}=e;this.setState({errorText:null,serverDeadError:null,serverErrorIsFatal:!1,busy:!0});try{if(await h.a.validateServerConfigWithStaticUrls(t,a),e!==this.latestServerConfig)return;this.setState({serverIsAlive:!0,serverErrorIsFatal:!1})}catch(t){if(e!==this.latestServerConfig)return;if(this.setState(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?T(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({busy:!1},h.a.authComponentStateForError(t,"register"))),this.state.serverErrorIsFatal)return}const n=Object(r.createClient)({baseUrl:t,idBaseUrl:a});let s;this.loginLogic.setHomeserverUrl(t),this.loginLogic.setIdentityServerUrl(a);try{const t=await this.loginLogic.getFlows();if(e!==this.latestServerConfig)return;s=t.find(e=>"m.login.sso"===e.type||"m.login.cas"===e.type)}catch(t){if(e!==this.latestServerConfig)return;d.a.error("Failed to get login flows to check for SSO support",t)}this.setState({matrixClient:n,ssoFlow:s,busy:!1});try{if(!this.state.doingUIAuth){if(await this.makeRegisterRequest(null),e!==this.latestServerConfig)return;d.a.log("Expecting 401 from register request but got success!")}}catch(t){if(e!==this.latestServerConfig)return;401===t.httpStatus?this.setState({flows:t.data.flows}):403===t.httpStatus||"M_FORBIDDEN"===t.errcode?s?b.a.dispatch({action:"start_login"}):this.setState({serverErrorIsFatal:!0,errorText:Object(u.a)("Registration has been disabled on this homeserver."),flows:[]}):(d.a.log("Unable to query for supported registration methods.",t),this.setState({errorText:Object(u.a)("Unable to query for supported registration methods."),flows:[]}))}}setupPushers(){if(!this.props.brand)return Promise.resolve();const e=g.a.get();return e.getPushers().then(t=>{const a=t.pushers;for(let t=0;t<a.length;++t)if("email"===a[t].kind){const n=a[t];n.data={brand:this.props.brand},e.setPusher(n).then(()=>{d.a.log("Set email branding to "+this.props.brand)},e=>{d.a.error("Couldn't set email branding: "+e)})}},e=>{d.a.error("Couldn't get pushers: "+e)})}getUIAuthInputs(){return{emailAddress:this.state.formVals.email,phoneCountry:this.state.formVals.phoneCountry,phoneNumber:this.state.formVals.phoneNumber}}renderRegisterComponent(){if(this.state.matrixClient&&this.state.doingUIAuth)return o.a.createElement(C.b,{matrixClient:this.state.matrixClient,makeRequest:this.makeRegisterRequest,onAuthFinished:this.onUIAuthFinished,inputs:this.getUIAuthInputs(),requestEmailToken:this.requestEmailToken,sessionId:this.props.sessionId,clientSecret:this.props.clientSecret,emailSid:this.props.idSid,poll:!0});if(!this.state.matrixClient&&!this.state.busy)return null;if(this.state.busy||!this.state.flows)return o.a.createElement("div",{className:"mx_AuthBody_spinner"},o.a.createElement(x.a,null));if(this.state.flows.length){let e;if(this.state.ssoFlow){let t;(this.state.ssoFlow.identity_providers||[]).length>1&&(t=o.a.createElement("h2",{className:"mx_AuthBody_centered"},Object(u.a)("Continue with %(ssoButtons)s",{ssoButtons:""}).trim())),e=o.a.createElement(o.a.Fragment,null,t,o.a.createElement(y.a,{matrixClient:this.loginLogic.createTemporaryClient(),flow:this.state.ssoFlow,loginType:"m.login.sso"===this.state.ssoFlow.type?"sso":"cas",fragmentAfterLogin:this.props.fragmentAfterLogin}),o.a.createElement("h2",{className:"mx_AuthBody_centered"},Object(u.a)("%(ssoButtons)s Or %(usernamePassword)s",{ssoButtons:"",usernamePassword:""}).trim()))}return o.a.createElement(o.a.Fragment,null,e,o.a.createElement(_.b,{defaultUsername:this.state.formVals.username,defaultEmail:this.state.formVals.email,defaultPhoneCountry:this.state.formVals.phoneCountry,defaultPhoneNumber:this.state.formVals.phoneNumber,defaultPassword:this.state.formVals.password,onRegisterClick:this.onFormSubmit,flows:this.state.flows,serverConfig:this.props.serverConfig,canSubmit:!this.state.serverErrorIsFatal,matrixClient:this.state.matrixClient}))}}render(){let e;const t=this.state.errorText;let a;if(t&&(e=o.a.createElement("div",{className:"mx_Login_error"},t)),!this.state.serverIsAlive){const e=l()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});a=o.a.createElement("div",{className:e},this.state.serverDeadError)}const n=o.a.createElement("span",{className:"mx_AuthBody_changeFlow"},Object(u.a)("Already have an account? <a>Sign in here</a>",{},{a:e=>o.a.createElement(w.a,{kind:"link_inline",onClick:this.onLoginClick},e)}));let i,r;if(this.state.doingUIAuth&&(i=o.a.createElement(w.a,{kind:"link",className:"mx_AuthBody_changeFlow",onClick:this.onGoToFormClicked},Object(u.a)("Go back"))),this.state.completedNoSignin){let e;e=this.state.differentLoggedInUserId?o.a.createElement("div",null,o.a.createElement("p",null,Object(u.a)("Your new account (%(newAccountId)s) is registered, but you're already logged into a different account (%(loggedInUserId)s).",{newAccountId:this.state.registeredUsername,loggedInUserId:this.state.differentLoggedInUserId})),o.a.createElement("p",null,o.a.createElement(w.a,{kind:"link_inline",onClick:async e=>{await this.onLoginClickWithCheck(e)&&b.a.dispatch({action:"view_welcome_page"})}},Object(u.a)("Continue with previous account")))):o.a.createElement("h2",null,Object(u.a)("<a>Log in</a> to your new account.",{},{a:e=>o.a.createElement(w.a,{kind:"link_inline",onClick:async e=>{await this.onLoginClickWithCheck(e)&&b.a.dispatch({action:"view_home_page"})}},e)})),r=o.a.createElement("div",null,o.a.createElement("h1",null,Object(u.a)("Registration Successful")),e)}else r=o.a.createElement(s.Fragment,null,o.a.createElement("div",{className:"mx_Register_mainContent"},o.a.createElement(j,{title:Object(u.a)("Create account"),serverPicker:o.a.createElement(E.a,{title:Object(u.a)("Host account on"),dialogTitle:Object(u.a)("Decide where your account is hosted"),serverConfig:this.props.serverConfig,onServerConfigChange:this.state.doingUIAuth?void 0:this.props.onServerConfigChange})},e,a),this.renderRegisterComponent()),o.a.createElement("div",{className:"mx_Register_footerActions"},i,n));return o.a.createElement(v.a,null,o.a.createElement(O.a,null),o.a.createElement(R.b,null,o.a.createElement(S.a,{flex:!0},r)))}}},1536:function(e,t,a){"use strict";a.d(t,"a",(function(){return A}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(178),c=a(96),l=a.n(c),d=a(1),u=a(91),m=a(429),h=a(100),p=a(346),g=a(320),v=a(284),f=a(124),b=a(95),y=a(126),E=a(93),_=a(169),w=a(108),S=a(591),O=a(436);const C=/^[0-9()\-\s]*$/;var x;!function(e){e.Email="login_field_email",e.MatrixId="login_field_mxid",e.Phone="login_field_phone",e.Password="login_field_phone"}(x||(x={}));class k extends s.a.PureComponent{constructor(e){super(e),i()(this,"onForgotPasswordClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onForgotPasswordClick()}),i()(this,"onSubmitForm",async e=>{e.preventDefault();if(!await this.verifyFieldsBeforeSubmit())return;let t="",a=null,n=null;switch(this.state.loginType){case x.Email:case x.MatrixId:t=this.props.username;break;case x.Phone:a=this.props.phoneCountry,n=this.props.phoneNumber}this.props.onSubmit(t,a,n,this.state.password)}),i()(this,"onUsernameChanged",e=>{this.props.onUsernameChanged(e.target.value)}),i()(this,"onUsernameBlur",e=>{this.props.onUsernameBlur(e.target.value)}),i()(this,"onLoginTypeChange",e=>{const t=e.target.value;this.setState({loginType:t}),this.props.onUsernameChanged("")}),i()(this,"onPhoneCountryChanged",e=>{this.props.onPhoneCountryChanged(e.iso2)}),i()(this,"onPhoneNumberChanged",e=>{this.props.onPhoneNumberChanged(e.target.value)}),i()(this,"onPasswordChanged",e=>{this.setState({password:e.target.value})}),i()(this,"validateUsernameRules",Object(_.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(u.a)("Enter username")}]})),i()(this,"onUsernameValidate",async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(x.MatrixId,t.valid),t}),i()(this,"onEmailValidate",e=>{this.markFieldValid(x.Email,e.valid)}),i()(this,"validatePhoneNumberRules",Object(_.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(u.a)("Enter phone number")},{key:"number",test:e=>{let{value:t}=e;return!t||C.test(t)},invalid:()=>Object(u.a)("That phone number doesn't look quite right, please check and try again")}]})),i()(this,"onPhoneNumberValidate",async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(x.Password,t.valid),t}),i()(this,"validatePasswordRules",Object(_.a)({rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(u.a)("Enter password")}]})),i()(this,"onPasswordValidate",async e=>{const t=await this.validatePasswordRules(e);return this.markFieldValid(x.Password,t.valid),t}),this.state={fieldValid:{},loginType:x.MatrixId,password:""}}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[this.state.loginType,x.Password];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise(e=>this.setState({},e)),this.allFieldsValid())return!0;const a=this.findFirstInvalidField(t);return!a||(a.focus(),a.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){const e=Object.keys(this.state.fieldValid);for(let t=0;t<e.length;++t)if(!this.state.fieldValid[e[t]])return!1;return!0}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:a}=this.state;a[e]=t,this.setState({fieldValid:a})}renderLoginField(e,t){const a={error:!1};switch(e){case x.Email:return a.error=this.props.loginIncorrect&&!this.props.username,s.a.createElement(O.a,{id:"mx_LoginForm_email",className:l()(a),name:"username",autoComplete:"email",type:"email",key:"email_input",placeholder:"joe@example.com",value:this.props.username,onChange:this.onUsernameChanged,onBlur:this.onUsernameBlur,disabled:this.props.busy,autoFocus:t,onValidate:this.onEmailValidate,fieldRef:e=>this[x.Email]=e});case x.MatrixId:return a.error=this.props.loginIncorrect&&!this.props.username,s.a.createElement(w.a,{id:"mx_LoginForm_username",className:l()(a),name:"username",autoComplete:"username",key:"username_input",type:"text",label:Object(u.a)("Username"),placeholder:Object(u.a)("Username").toLocaleLowerCase(),value:this.props.username,onChange:this.onUsernameChanged,onBlur:this.onUsernameBlur,disabled:this.props.busy,autoFocus:t,onValidate:this.onUsernameValidate,ref:e=>this[x.MatrixId]=e});case x.Phone:{a.error=this.props.loginIncorrect&&!this.props.phoneNumber;const e=s.a.createElement(S.a,{value:this.props.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChanged});return s.a.createElement(w.a,{id:"mx_LoginForm_phone",className:l()(a),name:"phoneNumber",autoComplete:"tel-national",key:"phone_input",type:"text",label:Object(u.a)("Phone"),value:this.props.phoneNumber,prefixComponent:e,onChange:this.onPhoneNumberChanged,disabled:this.props.busy,autoFocus:t,onValidate:this.onPhoneNumberValidate,ref:e=>this[x.Password]=e})}}}isLoginEmpty(){switch(this.state.loginType){case x.Email:case x.MatrixId:return!this.props.username;case x.Phone:return!this.props.phoneCountry||!this.props.phoneNumber}}render(){let e;this.props.onForgotPasswordClick&&(e=s.a.createElement(E.a,{className:"mx_Login_forgot",disabled:this.props.busy,kind:"link",onClick:this.onForgotPasswordClick},Object(u.a)("Forgot password?")));const t=l()({error:this.props.loginIncorrect&&!this.isLoginEmpty()}),a=!this.isLoginEmpty(),n=this.renderLoginField(this.state.loginType,!a);let i;return h.b.get().disable_3pid_login||(i=s.a.createElement("div",{className:"mx_Login_type_container"},s.a.createElement("label",{className:"mx_Login_type_label"},Object(u.a)("Sign in with")),s.a.createElement(w.a,{element:"select",value:this.state.loginType,onChange:this.onLoginTypeChange,disabled:this.props.busy},s.a.createElement("option",{key:x.MatrixId,value:x.MatrixId},Object(u.a)("Username")),s.a.createElement("option",{key:x.Email,value:x.Email},Object(u.a)("Email address")),s.a.createElement("option",{key:x.Password,value:x.Password},Object(u.a)("Phone"))))),s.a.createElement("div",null,s.a.createElement("form",{onSubmit:this.onSubmitForm},i,n,s.a.createElement(w.a,{id:"mx_LoginForm_password",className:t,autoComplete:"current-password",type:"password",name:"password",label:Object(u.a)("Password"),value:this.state.password,onChange:this.onPasswordChanged,disabled:this.props.busy,autoFocus:a,onValidate:this.onPasswordValidate,ref:e=>this[x.Password]=e}),e,!this.props.busy&&s.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:Object(u.a)("Sign in"),disabled:this.props.disableSubmit})))}}i()(k,"defaultProps",{onUsernameChanged:function(){},onUsernameBlur:function(){},onPhoneCountryChanged:function(){},onPhoneNumberChanged:function(){},loginIncorrect:!1,disableSubmit:!1});var j=a(176),R=a(104),I=a(607),T=a(606),N=a(438),D=a(437);function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}Object(u.c)("Invalid homeserver discovery response"),Object(u.c)("Failed to get autodiscovery configuration from server"),Object(u.c)("Invalid base_url for m.homeserver"),Object(u.c)("Homeserver URL does not appear to be a valid Matrix homeserver"),Object(u.c)("Invalid identity server discovery response"),Object(u.c)("Invalid base_url for m.identity_server"),Object(u.c)("Identity server URL does not appear to be a valid identity server"),Object(u.c)("General failure");class A extends s.a.PureComponent{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"loginLogic",void 0),i()(this,"stepRendererMap",void 0),i()(this,"isBusy",()=>this.state.busy||this.props.busy),i()(this,"onPasswordLogin",async(e,t,a,n)=>{if(!this.state.serverIsAlive){this.setState({busy:!0});let e=!0;try{await g.a.validateServerConfigWithStaticUrls(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl),this.setState({serverIsAlive:!0,errorText:""})}catch(t){const a=g.a.authComponentStateForError(t);this.setState(M({busy:!1,busyLoggingIn:!1},a)),e=!a.serverErrorIsFatal}if(!e)return}this.setState({busy:!0,busyLoggingIn:!0,errorText:null,loginIncorrect:!1}),this.loginLogic.loginViaPassword(e,t,a,n).then(e=>{this.setState({serverIsAlive:!0}),this.props.onLoggedIn(e,n)},t=>{if(this.unmounted)return;let a;const n=e.indexOf("@")>0;if(400===t.httpStatus&&n)a=Object(u.a)("This homeserver does not support login using email address.");else if("M_RESOURCE_LIMIT_EXCEEDED"===t.errcode){const e=Object(p.a)(t.data.limit_type,t.data.admin_contact,{monthly_active_user:Object(u.c)("This homeserver has hit its Monthly Active User limit."),hs_blocked:Object(u.c)("This homeserver has been blocked by its administrator."),"":Object(u.c)("This homeserver has exceeded one of its resource limits.")}),n=Object(p.a)(t.data.limit_type,t.data.admin_contact,{"":Object(u.c)("Please <a>contact your service administrator</a> to continue using this service.")});a=s.a.createElement("div",null,s.a.createElement("div",null,e),s.a.createElement("div",{className:"mx_Login_smallError"},n))}else a=401===t.httpStatus||403===t.httpStatus?"M_USER_DEACTIVATED"===t.errcode?Object(u.a)("This account has been deactivated."):h.b.get("disable_custom_urls")?s.a.createElement("div",null,s.a.createElement("div",null,Object(u.a)("Incorrect username and/or password.")),s.a.createElement("div",{className:"mx_Login_smallError"},Object(u.a)("Please note you are logging into the %(hs)s server, not matrix.org.",{hs:this.props.serverConfig.hsName}))):Object(u.a)("Incorrect username and/or password."):this.errorTextFromError(t);this.setState({busy:!1,busyLoggingIn:!1,errorText:a,loginIncorrect:401===t.httpStatus||403===t.httpStatus})})}),i()(this,"onUsernameChanged",e=>{this.setState({username:e})}),i()(this,"onUsernameBlur",async e=>{const t="@"===e[0];if(this.setState({username:e,busy:t,errorText:null,canTryLogin:!0}),t){const t=e.split(":").slice(1).join(":");try{const e=await g.a.validateServerName(t);this.props.onServerConfigChange(e),this.setState({busy:!1})}catch(e){d.a.error("Problem parsing URL or unhandled error doing .well-known discovery:",e);let t=Object(u.a)("Failed to perform homeserver discovery");e.translatedMessage&&(t=e.translatedMessage);let a=t,n={};g.a.isLivelinessError(e)&&(a=this.state.errorText,n=g.a.authComponentStateForError(e)),this.setState(M({busy:!1,errorText:a},n))}}}),i()(this,"onPhoneCountryChanged",e=>{this.setState({phoneCountry:e})}),i()(this,"onPhoneNumberChanged",e=>{this.setState({phoneNumber:e})}),i()(this,"onRegisterClick",e=>{e.preventDefault(),e.stopPropagation(),this.props.onRegisterClick()}),i()(this,"onTryRegisterClick",e=>{var t,a;const n=null===(t=this.state.flows)||void 0===t?void 0:t.find(e=>"m.login.password"===e.type),i=null===(a=this.state.flows)||void 0===a?void 0:a.find(e=>"m.login.sso"===e.type||"m.login.cas"===e.type);if(i&&!n){e.preventDefault(),e.stopPropagation();const t="m.login.sso"===i.type?"sso":"cas";f.a.get().startSingleSignOn(this.loginLogic.createTemporaryClient(),t,this.props.fragmentAfterLogin)}else this.onRegisterClick(e)}),i()(this,"isSupportedFlow",e=>!!this.stepRendererMap[e.type]||(d.a.log("Skipping flow",e,"due to unsupported login type",e.type),!1)),i()(this,"renderPasswordStep",()=>s.a.createElement(k,{onSubmit:this.onPasswordLogin,username:this.state.username,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber,onUsernameChanged:this.onUsernameChanged,onUsernameBlur:this.onUsernameBlur,onPhoneCountryChanged:this.onPhoneCountryChanged,onPhoneNumberChanged:this.onPhoneNumberChanged,onForgotPasswordClick:this.props.onForgotPasswordClick,loginIncorrect:this.state.loginIncorrect,serverConfig:this.props.serverConfig,disableSubmit:this.isBusy(),busy:this.props.isSyncing||this.state.busyLoggingIn})),i()(this,"renderSsoStep",e=>{const t=this.state.flows.find(t=>t.type==="m.login."+e);return s.a.createElement(I.a,{matrixClient:this.loginLogic.createTemporaryClient(),flow:t,loginType:e,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!this.state.flows.find(e=>"m.login.password"===e.type)})}),this.state={busy:!1,busyLoggingIn:null,errorText:null,loginIncorrect:!1,canTryLogin:!0,flows:null,username:e.defaultUsername?e.defaultUsername:"",phoneCountry:null,phoneNumber:"",serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""},this.stepRendererMap={"m.login.password":this.renderPasswordStep,"m.login.cas":()=>this.renderSsoStep("cas"),"m.login.sso":()=>this.renderSsoStep("sso")}}UNSAFE_componentWillMount(){this.initLoginLogic(this.props.serverConfig)}componentWillUnmount(){this.unmounted=!0}UNSAFE_componentWillReceiveProps(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this.initLoginLogic(e.serverConfig)}async initLoginLogic(e){let{hsUrl:t,isUrl:a}=e,n=!1;this.props.serverConfig.isDefault&&t===this.props.serverConfig.hsUrl&&a===this.props.serverConfig.isUrl&&(n=!0);const i=n?this.props.fallbackHsUrl:null,r=new m.a(t,a,i,{defaultDeviceDisplayName:this.props.defaultDeviceDisplayName});this.loginLogic=r,this.setState({busy:!0,loginIncorrect:!1});try{const{warning:e}=await g.a.validateServerConfigWithStaticUrls(t,a);e?this.setState(M(M({},g.a.authComponentStateForError(e)),{},{errorText:""})):this.setState({serverIsAlive:!0,errorText:""})}catch(e){this.setState(M({busy:!1},g.a.authComponentStateForError(e)))}r.getFlows().then(e=>{const t=e.filter(this.isSupportedFlow);t.length>0?this.setState({flows:t}):this.setState({errorText:Object(u.a)("This homeserver doesn't offer any login flows which are supported by this client.")})},e=>{this.setState({errorText:this.errorTextFromError(e),loginIncorrect:!1,canTryLogin:!1})}).finally(()=>{this.setState({busy:!1})})}errorTextFromError(e){let t=e.errcode;!t&&e.httpStatus&&(t="HTTP "+e.httpStatus);let a=Object(u.a)("There was a problem communicating with the homeserver, please try again later.")+(t?" ("+t+")":"");return e instanceof o.b&&(a="https:"!==window.location.protocol||!this.props.serverConfig.hsUrl.startsWith("http:")&&this.props.serverConfig.hsUrl.startsWith("http")?s.a.createElement("span",null,Object(u.a)("Can't connect to homeserver - please check your connectivity, ensure your <a>homeserver's SSL certificate</a> is trusted, and that a browser extension is not blocking requests.",{},{a:e=>s.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:this.props.serverConfig.hsUrl},e)})):s.a.createElement("span",null,Object(u.a)("Can't connect to homeserver via HTTP when an HTTPS URL is in your browser bar. Either use HTTPS or <a>enable unsafe scripts</a>.",{},{a:e=>s.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://www.google.com/search?&q=enable%20unsafe%20scripts"},e)}))),a}renderLoginComponentForFlows(){if(!this.state.flows)return null;const e=["m.login.password","m.login.sso"].map(e=>this.state.flows.find(t=>t.type===e)).filter(Boolean);return s.a.createElement(s.a.Fragment,null,e.map(e=>{const t=this.stepRendererMap[e.type];return s.a.createElement(s.a.Fragment,{key:e.type},t())}))}render(){const e=this.isBusy()&&!this.state.busyLoggingIn?s.a.createElement("div",{className:"mx_Login_loader"},s.a.createElement(R.a,null)):null,t=this.state.errorText;let a,n,i;if(t&&(a=s.a.createElement("div",{className:"mx_Login_error"},t)),!this.state.serverIsAlive){const e=l()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});n=s.a.createElement("div",{className:e},this.state.serverDeadError)}return this.props.isSyncing||this.state.busyLoggingIn?i=s.a.createElement("div",{className:"mx_AuthBody_paddedFooter"},s.a.createElement("div",{className:"mx_AuthBody_paddedFooter_title"},s.a.createElement(j.a,{w:20,h:20}),this.props.isSyncing?Object(u.a)("Syncing..."):Object(u.a)("Signing In...")),this.props.isSyncing&&s.a.createElement("div",{className:"mx_AuthBody_paddedFooter_subtitle"},Object(u.a)("If you've joined lots of rooms, this might take a while"))):b.b.getValue(y.b.Registration)&&(i=s.a.createElement("span",{className:"mx_AuthBody_changeFlow"},Object(u.a)("New? <a>Create account</a>",{},{a:e=>s.a.createElement(E.a,{kind:"link_inline",onClick:this.onTryRegisterClick},e)}))),s.a.createElement(v.a,null,s.a.createElement(D.a,{disableLanguageSelector:this.props.isSyncing||this.state.busyLoggingIn}),s.a.createElement(N.a,null,s.a.createElement("h1",null,Object(u.a)("Sign in"),e),a,n,s.a.createElement(T.a,{serverConfig:this.props.serverConfig,onServerConfigChange:this.props.onServerConfigChange}),this.renderLoginComponentForFlows(),i))}}},1537:function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return s}));var n=a(6),i=a.n(n),r=a(1);let s;!function(e){e.APP_STARTUP="mx_AppStartup",e.PAGE_CHANGE="mx_PageChange",e.RESEND_EVENT="mx_ResendEvent",e.SEND_E2EE_EVENT="mx_SendE2EEEvent",e.SEND_ATTACHMENT="mx_SendAttachment",e.SWITCH_ROOM="mx_SwithRoom",e.JUMP_TO_ROOM="mx_JumpToRoom",e.JOIN_ROOM="mx_JoinRoom",e.CREATE_DM="mx_CreateDM",e.PEEK_ROOM="mx_PeekRoom",e.VERIFY_E2EE_USER="mx_VerifyE2EEUser",e.LOGIN="mx_Login",e.REGISTER="mx_Register",e.SETUP_VOIP_CALL="mx_SetupVoIPCall"}(s||(s={}));class o{constructor(){i()(this,"START_PREFIX","start:"),i()(this,"STOP_PREFIX","stop:"),i()(this,"listeners",[]),i()(this,"entries",[])}static get instance(){return o._instance||(o._instance=new o),o._instance}start(e,t){if(!this.supportsPerformanceApi())return;const a=this.buildKey(e,t);performance.getEntriesByName(this.START_PREFIX+a).length>0?r.a.warn("Recording already started for: "+e):performance.mark(this.START_PREFIX+a)}stop(e,t){if(!this.supportsPerformanceApi())return;const a=this.buildKey(e,t);if(0===performance.getEntriesByName(this.START_PREFIX+a).length)return void r.a.warn("No recording started for: "+e);performance.mark(this.STOP_PREFIX+a),performance.measure(a,this.START_PREFIX+a,this.STOP_PREFIX+a),this.clear(e,t);const n=performance.getEntriesByName(a).pop();return this.entries.push(n),this.listeners.forEach(e=>{this.shouldEmit(e,n)&&e.callback([n])}),n}clear(e,t){if(!this.supportsPerformanceApi())return;const a=this.buildKey(e,t);performance.clearMarks(this.START_PREFIX+a),performance.clearMarks(this.STOP_PREFIX+a)}getEntries(){let{name:e,type:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.entries.filter(a=>{const n=!e||a.name===e,i=!t||a.entryType===t;return n&&i})}addPerformanceDataCallback(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.listeners.push(e),t){const t=this.entries.filter(t=>this.shouldEmit(e,t));t.length>0&&e.callback(t)}}removePerformanceDataCallback(e){e?this.listeners.splice(this.listeners.findIndex(t=>t.callback===e),1):this.listeners=[]}supportsPerformanceApi(){return void 0!==performance&&void 0!==performance.mark}shouldEmit(e,t){return!e.entryNames||e.entryNames.includes(t.name)}buildKey(e,t){return`${e}${t?":"+t:""}`}}i()(o,"_instance",void 0),window.mxPerformanceMonitor=o.instance,window.mxPerformanceEntryNames=s},1538:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(1),c=a(91),l=a(94),d=a(428),u=a(97),m=a(92),h=a(429),p=a(284),g=a(317),v=a(607),f=a(105),b=a(115);class y extends s.a.Component{constructor(){super(...arguments),i()(this,"onConfirm",()=>{this.props.onFinished(!0)}),i()(this,"onDecline",()=>{this.props.onFinished(!1)})}render(){return s.a.createElement(f.a,{className:"mx_ConfirmWipeDeviceDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(c.a)("Clear all data in this session?")},s.a.createElement("div",{className:"mx_ConfirmWipeDeviceDialog_content"},s.a.createElement("p",null,Object(c.a)("Clearing all data from this session is permanent. Encrypted messages will be lost unless their keys have been backed up."))),s.a.createElement(b.a,{primaryButton:Object(c.a)("Clear all data"),onPrimaryButtonClick:this.onConfirm,primaryButtonClass:"danger",cancelButton:Object(c.a)("Cancel"),onCancel:this.onDecline}))}}var E,_=a(108),w=a(93),S=a(104),O=a(437),C=a(438);!function(e){e[e.Loading=0]="Loading",e[e.Password=1]="Password",e[e.CAS=2]="CAS",e[e.SSO=3]="SSO",e[e.PasswordWithSocialSignOn=4]="PasswordWithSocialSignOn",e[e.Unsupported=5]="Unsupported"}(E||(E={}));const x={"m.login.password":E.Password,"m.login.cas":E.CAS,"m.login.sso":E.SSO};class k extends s.a.Component{constructor(e){super(e),i()(this,"onClearAll",()=>{u.a.createDialog(y,{onFinished:e=>{e&&(o.a.log("Clearing data from soft-logged-out session"),d.i())}})}),i()(this,"onPasswordChange",e=>{this.setState({password:e.target.value})}),i()(this,"onForgotPassword",()=>{l.a.dispatch({action:"start_password_recovery"})}),i()(this,"onPasswordLogin",async e=>{e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});const t=m.a.get().getHomeserverUrl(),a=m.a.get().getIdentityServerUrl(),n={identifier:{type:"m.id.user",user:m.a.get().getUserId()},password:this.state.password,device_id:m.a.get().getDeviceId()};let i=null;try{i=await Object(h.b)(t,a,"m.login.password",n)}catch(e){let t=Object(c.a)("Failed to re-authenticate due to a homeserver problem");return"M_FORBIDDEN"!==e.errcode||401!==e.httpStatus&&403!==e.httpStatus||(t=Object(c.a)("Incorrect password")),void this.setState({busy:!1,errorText:t})}d.e(i).catch(e=>{o.a.error(e),this.setState({busy:!1,errorText:Object(c.a)("Failed to re-authenticate")})})}),this.state={loginView:E.Loading,keyBackupNeeded:!0,busy:!1,password:"",errorText:"",flows:[]}}componentDidMount(){if(!d.g())return void l.a.dispatch({action:"start_login"});this.initLogin();const e=m.a.get();e.isCryptoEnabled()&&e.countSessionsNeedingBackup().then(e=>{this.setState({keyBackupNeeded:e>0})})}async initLogin(){const e=this.props.realQueryParams;if(e&&e.loginToken)return this.setState({loginView:E.Loading}),void this.trySsoLogin();const t=m.a.get(),a=(await t.loginFlows()).flows,n=a.map(e=>x[e.type]),i=n.includes(E.Password)&&n.includes(E.SSO),r=n.filter(e=>!!e)[0]||E.Unsupported,s=i?E.PasswordWithSocialSignOn:r;this.setState({flows:a,loginView:s})}async trySsoLogin(){this.setState({busy:!0});const e=localStorage.getItem(g.a),t=localStorage.getItem(g.c)||m.a.get().getIdentityServerUrl(),a={token:this.props.realQueryParams.loginToken,device_id:m.a.get().getDeviceId()};let n=null;try{n=await Object(h.b)(e,t,"m.login.token",a)}catch(e){return o.a.error(e),void this.setState({busy:!1,loginView:E.Unsupported})}d.e(n).then(()=>{this.props.onTokenLoginCompleted&&this.props.onTokenLoginCompleted()}).catch(e=>{o.a.error(e),this.setState({busy:!1,loginView:E.Unsupported})})}renderPasswordForm(e){let t=null;return this.state.errorText&&(t=s.a.createElement("span",{className:"mx_Login_error"},this.state.errorText)),s.a.createElement("form",{onSubmit:this.onPasswordLogin},e?s.a.createElement("p",null,e):null,t,s.a.createElement(_.a,{type:"password",label:Object(c.a)("Password"),onChange:this.onPasswordChange,value:this.state.password,disabled:this.state.busy}),s.a.createElement(w.a,{onClick:this.onPasswordLogin,kind:"primary",type:"submit",disabled:this.state.busy},Object(c.a)("Sign In")),s.a.createElement(w.a,{onClick:this.onForgotPassword,kind:"link"},Object(c.a)("Forgotten your password?")))}renderSsoForm(e){const t=this.state.loginView===E.CAS?"cas":"sso",a=this.state.flows.find(e=>e.type==="m.login."+t);return s.a.createElement("div",null,e?s.a.createElement("p",null,e):null,s.a.createElement(v.a,{matrixClient:m.a.get(),flow:a,loginType:t,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!this.state.flows.find(e=>"m.login.password"===e.type)}))}renderSignInSection(){if(this.state.loginView===E.Loading)return s.a.createElement(S.a,null);let e=null;return this.state.keyBackupNeeded&&(e=Object(c.a)("Regain access to your account and recover encryption keys stored in this session. Without them, you won't be able to read all of your secure messages in any session.")),this.state.loginView===E.Password?(e||(e=Object(c.a)("Enter your password to sign in and regain access to your account.")),this.renderPasswordForm(e)):this.state.loginView===E.SSO||this.state.loginView===E.CAS?(e||(e=Object(c.a)("Sign in and regain access to your account.")),this.renderSsoForm(e)):this.state.loginView===E.PasswordWithSocialSignOn?(e||(e=Object(c.a)("Sign in and regain access to your account.")),s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,e),this.renderSsoForm(null),s.a.createElement("h2",{className:"mx_AuthBody_centered"},Object(c.a)("%(ssoButtons)s Or %(usernamePassword)s",{ssoButtons:"",usernamePassword:""}).trim()),this.renderPasswordForm(null))):s.a.createElement("p",null,Object(c.a)("You cannot sign in to your account. Please contact your homeserver admin for more information."))}render(){return s.a.createElement(p.a,null,s.a.createElement(O.a,null),s.a.createElement(C.a,null,s.a.createElement("h1",null,Object(c.a)("You're signed out")),s.a.createElement("h2",null,Object(c.a)("Sign in")),s.a.createElement("div",null,this.renderSignInSection()),s.a.createElement("h2",null,Object(c.a)("Clear personal data")),s.a.createElement("p",null,Object(c.a)("Warning: Your personal data (including encryption keys) is still stored in this session. Clear it if you're finished using this session, or want to sign in to another account.")),s.a.createElement("div",null,s.a.createElement(w.a,{onClick:this.onClearAll,kind:"danger"},Object(c.a)("Clear all data")))))}}},220:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(6),i=a.n(n),r=a(207),s=a(122),o=a(116),c=a(99),l=a(171),d=a(94),u=a(92),m=a(91),h=a(131);class p extends l.a{constructor(){super(d.a,{displayName:window.localStorage.getItem("mx_profile_displayname"),avatarUrl:window.localStorage.getItem("mx_profile_avatar_url")}),i()(this,"monitoredUser",void 0),i()(this,"onProfileUpdate",Object(o.throttle)(async()=>{const e=await this.matrixClient.getProfileInfo(this.matrixClient.getUserId());e.displayname?window.localStorage.setItem("mx_profile_displayname",e.displayname):window.localStorage.removeItem("mx_profile_displayname"),e.avatar_url?window.localStorage.setItem("mx_profile_avatar_url",e.avatar_url):window.localStorage.removeItem("mx_profile_avatar_url"),await this.updateState({displayName:e.displayname,avatarUrl:e.avatar_url,fetchedAt:Date.now()})},200,{trailing:!0,leading:!0})),i()(this,"onStateEvents",async e=>{const t=u.a.get().getUserId();e.getType()===c.b.RoomMember&&e.getSender()===t&&e.getStateKey()===t&&await this.onProfileUpdate()})}static get instance(){return p.internalInstance}get displayName(){return this.matrixClient?this.matrixClient.isGuest()?Object(m.a)("Guest"):this.state.displayName?this.state.displayName:this.matrixClient.getUserId():this.state.displayName||null}get isProfileInfoFetched(){return!!this.state.fetchedAt}get avatarMxc(){return this.state.avatarUrl||null}getHttpAvatarUrl(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!this.avatarMxc)return null;const t=Object(h.b)(this.avatarMxc);return!e||e<=0?t.srcHttp:t.getSquareThumbnailHttp(e)}async onNotReady(){var e;this.monitoredUser&&(this.monitoredUser.removeListener(r.b.DisplayName,this.onProfileUpdate),this.monitoredUser.removeListener(r.b.AvatarUrl,this.onProfileUpdate)),null===(e=this.matrixClient)||void 0===e||e.removeListener(s.b.Events,this.onStateEvents),await this.reset({})}async onReady(){const e=this.matrixClient.getUserId();this.monitoredUser=this.matrixClient.getUser(e),this.monitoredUser&&(this.monitoredUser.on(r.b.DisplayName,this.onProfileUpdate),this.monitoredUser.on(r.b.AvatarUrl,this.onProfileUpdate)),this.matrixClient.on(s.b.Events,this.onStateEvents),await this.onProfileUpdate()}async onAction(e){}}i()(p,"internalInstance",(()=>{const e=new p;return e.start(),e})())},252:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(114),s=a(111);t.a=e=>{let{room:t,children:a}=e;const[o,c]=Object(n.useState)(null==t?void 0:t.name);return Object(s.c)(t,r.d.Name,()=>{c(null==t?void 0:t.name)}),Object(n.useEffect)(()=>{c(null==t?void 0:t.name)},[t]),a?a(o):i.a.createElement(i.a.Fragment,null,o||"")}},281:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.default=t.ReactReduxContext=void 0;var i=n(a(90)).default.createContext(null);t.ReactReduxContext=i;var r=i;t.default=r},283:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(1),s=a(124),o=a(8),c=a(160),l=a(150),d=a(114),u=a(122),m=a(7),h=a(99),p=a(119),g=a(92),v=a(95),f=a(106);class b extends o.EventEmitter{constructor(){super(...arguments),i()(this,"crawlerCheckpoints",[]),i()(this,"crawler",null),i()(this,"currentCheckpoint",null),i()(this,"onSync",async(e,t,a)=>{const n=s.a.get().getEventIndexingManager();if("PREPARED"===t&&"SYNCING"===e){return await n.isEventIndexEmpty()&&await this.addInitialCheckpoints(),void this.startCrawler()}"SYNCING"===t&&"SYNCING"===e&&await n.commitLiveEvents()}),i()(this,"onRoomTimeline",async(e,t,a,n,i)=>{if(!t)return;const r=g.a.get();return r.isRoomEncrypted(e.getRoomId())?e.isRedaction()?this.redactEvent(e):void(!a&&i&&i.liveEvent&&!e.isRedacted()&&(await r.decryptEventIfNeeded(e),await this.addLiveEventToIndex(e))):void 0}),i()(this,"onRoomStateEvent",async(e,t)=>{g.a.get().isRoomEncrypted(t.roomId)&&(e.getType()!==h.b.RoomEncryption||await this.isRoomIndexed(t.roomId)||(r.a.log("EventIndex: Adding a checkpoint for a newly encrypted room",t.roomId),this.addRoomCheckpoint(t.roomId,!0)))}),i()(this,"redactEvent",async e=>{const t=s.a.get().getEventIndexingManager();try{await t.deleteEvent(e.getAssociatedId())}catch(e){r.a.log("EventIndex: Error deleting event from index",e)}}),i()(this,"onTimelineReset",async(e,t,a)=>{null!==e&&g.a.get().isRoomEncrypted(e.roomId)&&(r.a.log("EventIndex: Adding a checkpoint because of a limited timeline",e.roomId),this.addRoomCheckpoint(e.roomId,!1))})}async init(){const e=s.a.get().getEventIndexingManager();this.crawlerCheckpoints=await e.loadCheckpoints(),r.a.log("EventIndex: Loaded checkpoints",this.crawlerCheckpoints),this.registerListeners()}registerListeners(){const e=g.a.get();e.on(p.b.Sync,this.onSync),e.on(d.d.Timeline,this.onRoomTimeline),e.on(d.d.TimelineReset,this.onTimelineReset),e.on(u.b.Events,this.onRoomStateEvent)}removeListeners(){const e=g.a.get();null!==e&&(e.removeListener(p.b.Sync,this.onSync),e.removeListener(d.d.Timeline,this.onRoomTimeline),e.removeListener(d.d.TimelineReset,this.onTimelineReset),e.removeListener(u.b.Events,this.onRoomStateEvent))}async addInitialCheckpoints(){const e=s.a.get().getEventIndexingManager(),t=g.a.get(),a=t.getRooms().filter(e=>t.isRoomEncrypted(e.roomId));r.a.log("EventIndex: Adding initial crawler checkpoints"),await Promise.all(a.map(async t=>{const a=t.getLiveTimeline().getPaginationToken(l.a.Backward),n={roomId:t.roomId,token:a,direction:l.a.Backward,fullCrawl:!0},i={roomId:t.roomId,token:a,direction:l.a.Forward};try{n.token&&(await e.addCrawlerCheckpoint(n),this.crawlerCheckpoints.push(n)),i.token&&(await e.addCrawlerCheckpoint(i),this.crawlerCheckpoints.push(i))}catch(e){r.a.log("EventIndex: Error adding initial checkpoints for room",t.roomId,n,i,e)}}))}isValidEvent(e){const t=[h.b.RoomMessage,h.b.RoomName,h.b.RoomTopic].includes(e.getType())&&!e.isRedacted()&&!e.isDecryptionFailure();let a=!0,n=!0;if(e.getType()!==h.b.RoomMessage||e.isRedacted())e.getType()!==h.b.RoomTopic||e.isRedacted()?e.getType()!==h.b.RoomName||e.isRedacted()||e.getContent().name||(n=!1):e.getContent().topic||(n=!1);else{const t=e.getContent().msgtype;a=!!t&&!t.startsWith("m.key.verification"),e.getContent().body||(n=!1)}return t&&a&&n}eventToJson(e){const t=e.toJSON(),a=e.isEncrypted()?t.decrypted:t;return e.isEncrypted()?(a.curve25519Key=e.getSenderKey(),a.ed25519Key=e.getClaimedEd25519Key(),a.algorithm=e.getWireContent().algorithm,a.forwardingCurve25519KeyChain=e.getForwardingCurve25519KeyChain()):(delete a.curve25519Key,delete a.ed25519Key,delete a.algorithm,delete a.forwardingCurve25519KeyChain),a}async addLiveEventToIndex(e){const t=s.a.get().getEventIndexingManager();if(!this.isValidEvent(e))return;const a=this.eventToJson(e),n={displayname:e.sender.rawDisplayName,avatar_url:e.sender.getMxcAvatarUrl()};await t.addEventToIndex(a,n)}emitNewCheckpoint(){this.emit("changedCheckpoint",this.currentRoom())}async addEventsFromLiveTimeline(e){const t=e.getEvents();for(let e=0;e<t.length;e++){const a=t[e];await this.addLiveEventToIndex(a)}}async addRoomCheckpoint(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=s.a.get().getEventIndexingManager(),n=g.a.get().getRoom(e);if(!n)return;const i=n.getLiveTimeline(),o=i.getPaginationToken(l.a.Backward);if(!o)return void await this.addEventsFromLiveTimeline(i);const c={roomId:n.roomId,token:o,fullCrawl:t,direction:l.a.Backward};r.a.log("EventIndex: Adding checkpoint",c);try{await a.addCrawlerCheckpoint(c)}catch(e){r.a.log("EventIndex: Error adding new checkpoint for room",n.roomId,c,e)}this.crawlerCheckpoints.push(c)}async crawlerFunc(){let e=!1;const t=g.a.get(),a=s.a.get().getEventIndexingManager();this.crawler={cancel:()=>{e=!0}};let n=!1;for(;!e;){let i=v.b.getValueAt(f.a.DEVICE,"crawlerSleepTime");if(i=Math.max(i,100),n&&(i=5e3),null!==this.currentCheckpoint&&(this.currentCheckpoint=null,this.emitNewCheckpoint()),await Object(m.H)(i),e)break;const s=this.crawlerCheckpoints.shift();if(void 0===s){n=!0;continue}this.currentCheckpoint=s,this.emitNewCheckpoint(),n=!1;const o=t.getEventMapper({preventReEmit:!0});let c;try{c=await t.createMessagesRequest(s.roomId,s.token,100,s.direction)}catch(e){if(403===e.httpStatus){r.a.log("EventIndex: Removing checkpoint as we don't have ","permissions to fetch messages from this room.",s);try{await a.removeCrawlerCheckpoint(s)}catch(e){r.a.log("EventIndex: Error removing checkpoint",s,e)}continue}r.a.log("EventIndex: Error crawling using checkpoint:",s,",",e),this.crawlerCheckpoints.push(s);continue}if(e){this.crawlerCheckpoints.push(s);break}if(0===c.chunk.length){r.a.log("EventIndex: Done with the checkpoint",s);try{await a.removeCrawlerCheckpoint(s)}catch(e){r.a.log("EventIndex: Error removing checkpoint",s,e)}continue}const l=c.chunk.map(o);let d=[];void 0!==c.state&&(d=c.state.map(o));const u={};d.forEach(e=>{e.event.content&&"join"===e.event.content.membership&&(u[e.event.sender]={displayname:e.event.content.displayname,avatar_url:e.event.content.avatar_url})});const h=l.filter(e=>e.isEncrypted()).map(e=>t.decryptEventIfNeeded(e,{isRetry:!0,emit:!1}));await Promise.all(h);const p=l.filter(this.isValidEvent),g=l.filter(e=>e.isRedaction()),b=p.map(e=>{const t=this.eventToJson(e);let a={};t.sender in u&&(a=u[t.sender]);return{event:t,profile:a}});let y;c.end&&(y={roomId:s.roomId,token:c.end,fullCrawl:s.fullCrawl,direction:s.direction});try{for(let e=0;e<g.length;e++){const t=g[e],n=t.getAssociatedId();n?await a.deleteEvent(n):r.a.warn("EventIndex: Redaction event doesn't contain a valid associated event id",t)}const e=await a.addHistoricEvents(b,y,s);if(!y){r.a.log("EventIndex: The server didn't return a valid ","new checkpoint, not continuing the crawl.",s);continue}!0===e&&!0!==y.fullCrawl?(r.a.log("EventIndex: Checkpoint had already all events","added, stopping the crawl",s),await a.removeCrawlerCheckpoint(y)):(!0===e&&r.a.log("EventIndex: Checkpoint had already all events","added, but continuing due to a full crawl",s),this.crawlerCheckpoints.push(y))}catch(e){r.a.log("EventIndex: Error during a crawl",e),this.crawlerCheckpoints.push(s)}}this.crawler=null}startCrawler(){null===this.crawler&&this.crawlerFunc()}stopCrawler(){null!==this.crawler&&this.crawler.cancel()}async close(){const e=s.a.get().getEventIndexingManager();this.removeListeners(),this.stopCrawler(),await e.closeEventIndex()}async search(e){return s.a.get().getEventIndexingManager().searchEventIndex(e)}async loadFileEvents(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.b.BACKWARDS;const i=g.a.get(),o=s.a.get().getEventIndexingManager(),d={roomId:e.roomId,limit:t};let u;a&&(d.fromEvent=a,d.direction=n);try{u=await o.loadFileEvents(d)}catch(e){return r.a.log("EventIndex: Error getting file events",e),[]}const m=i.getEventMapper();return u.map(t=>{const a=m(t.event),n=new c.a(e.roomId,a.getSender());n.name=t.profile.displayname+" ("+a.getSender()+")";const i=m({content:{membership:"join",avatar_url:t.profile.avatar_url,displayname:t.profile.displayname},type:h.b.RoomMember,event_id:a.getId()+":eventIndex",room_id:a.getRoomId(),sender:a.getSender(),origin_server_ts:a.getTs(),state_key:a.getSender()});return n.events.member=i,a.sender=n,a})}async populateFileTimeline(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:l.b.BACKWARDS;const o=await this.loadFileEvents(a,n,i,s);null===i&&(o.reverse(),s=s==l.b.BACKWARDS?l.b.FORWARDS:l.b.BACKWARDS),o.forEach(a=>{e.eventIdToTimeline(a.getId())||e.addEventToTimeline(a,t,s==l.b.BACKWARDS)});let c=!1,d="";return o.length>0&&(d=o[o.length-1].getId(),c=!0),r.a.log("EventIndex: Populating file panel with",o.length,"events and setting the pagination token to",d),t.setPaginationToken(d,l.b.BACKWARDS),c}paginateTimelineWindow(e,t,a,n){const i=t.getTimelineIndex(a);if(!i)return Promise.resolve(!1);if(i.pendingPaginate)return i.pendingPaginate;if(t.extend(a,n))return Promise.resolve(!0);const r=(async(e,t,a,n,i)=>{const r=t.timeline,s=r.getTimelineSet(),o=r.getPaginationToken(n),c=await this.populateFileTimeline(s,r,a,i,o,n);return t.pendingPaginate=null,e.extend(n,i),c})(t,i,e,a,n);return i.pendingPaginate=r,r}async getStats(){return s.a.get().getEventIndexingManager().getStats()}async isRoomIndexed(e){return s.a.get().getEventIndexingManager().isRoomIndexed(e)}currentRoom(){if(null===this.currentCheckpoint&&0===this.crawlerCheckpoints.length)return null;const e=g.a.get();return null!==this.currentCheckpoint?e.getRoom(this.currentCheckpoint.roomId):e.getRoom(this.crawlerCheckpoints[0].roomId)}crawlingRooms(){const e=new Set,t=new Set;this.crawlerCheckpoints.forEach((e,a)=>{t.add(e.roomId)}),null!==this.currentCheckpoint&&t.add(this.currentCheckpoint.roomId);const a=g.a.get();return a.getRooms().filter(e=>a.isRoomEncrypted(e.roomId)).forEach((t,a)=>{e.add(t.roomId)}),{crawlingRooms:t,totalRooms:e}}}class y{constructor(){i()(this,"index",null),i()(this,"error",null),i()(this,"_supportIsInstalled",!1)}async init(){const e=s.a.get().getEventIndexingManager();return e?(this._supportIsInstalled=await e.supportsEventIndexing(),this.supportIsInstalled()?v.b.getValueAt(f.a.DEVICE,"enableEventIndexing")?this.initEventIndex():(r.a.log("EventIndex: Event indexing is disabled, not initializing"),!1):(r.a.log("EventIndex: Event indexing isn't installed for the platform, not initializing."),!1)):(r.a.log("EventIndex: Platform doesn't support event indexing, not initializing."),!1)}async initEventIndex(){const e=new b,t=s.a.get().getEventIndexingManager(),a=g.a.get(),n=a.getUserId(),i=a.getDeviceId();try{await t.initEventIndex(n,i);const a=await t.getUserVersion(),s=await t.isEventIndexEmpty();s?await t.setUserVersion(1):0!==a||s||(await t.closeEventIndex(),await this.deleteEventIndex(),await t.initEventIndex(n,i),await t.setUserVersion(1)),r.a.log("EventIndex: Successfully initialized the event index"),await e.init()}catch(e){return r.a.log("EventIndex: Error initializing the event index",e),this.error=e,!1}return this.index=e,!0}platformHasSupport(){return null!==s.a.get().getEventIndexingManager()}supportIsInstalled(){return this._supportIsInstalled}get(){return this.index}start(){null!==this.index&&this.index.startCrawler()}stop(){null!==this.index&&this.index.stopCrawler()}async unset(){null!==this.index&&(await this.index.close(),this.index=null)}async deleteEventIndex(){const e=s.a.get().getEventIndexingManager();null!==e&&(await this.unset(),r.a.log("EventIndex: Deleting event index."),await e.deleteEventIndex())}}window.mxEventIndexPeg||(window.mxEventIndexPeg=new y);t.a=window.mxEventIndexPeg},318:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(96),c=a.n(o),l=a(100),d=a(169),u=a(91),m=a(108);class h extends r.PureComponent{constructor(){super(...arguments),i()(this,"validate",Object(d.a)({description:function(e){const t=e?e.score:0;return s.a.createElement("progress",{className:"mx_PassphraseField_progress",max:4,value:t})},deriveData:async e=>{let{value:t}=e;if(!t)return null;const{scorePassword:n}=await a.e(28).then(a.bind(null,878));return n(t)},rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(u.a)(this.props.labelEnterPassword)},{key:"complexity",test:async function(e,t){let{value:a}=e;if(!a)return!1;const n=t.score>=this.props.minScore;return l.b.get("dangerously_allow_unsafe_and_insecure_passwords")||n},valid:function(e){return e.score>=this.props.minScore?Object(u.a)(this.props.labelStrongPassword):Object(u.a)(this.props.labelAllowedButUnsafe)},invalid:function(e){if(!e)return null;const{feedback:t}=e;return t.warning||t.suggestions[0]||Object(u.a)("Keep going...")}}]})),i()(this,"onValidate",async e=>{const t=await this.validate(e);return this.props.onValidate&&this.props.onValidate(t),t})}render(){return s.a.createElement(m.a,{id:this.props.id,autoFocus:this.props.autoFocus,className:c()("mx_PassphraseField",this.props.className),ref:this.props.fieldRef,type:"password",autoComplete:"new-password",label:Object(u.a)(this.props.label),value:this.props.value,onChange:this.props.onChange,onValidate:this.onValidate})}}i()(h,"defaultProps",{label:Object(u.c)("Password"),labelEnterPassword:Object(u.c)("Enter password"),labelStrongPassword:Object(u.c)("Nice, strong password!"),labelAllowedButUnsafe:Object(u.c)("Password is allowed, but unsafe")}),t.a=h},320:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(90),i=a.n(n),r=a(290),s=a(1),o=a(91);var c=a(100),l=a(6),d=a.n(l);class u{constructor(){d()(this,"hsUrl",void 0),d()(this,"hsName",void 0),d()(this,"hsNameIsDifferent",void 0),d()(this,"isUrl",void 0),d()(this,"isDefault",void 0),d()(this,"isNameResolvable",void 0),d()(this,"warning",void 0)}}const m=[r.a.ERROR_INVALID_HOMESERVER,r.a.ERROR_INVALID_IDENTITY_SERVER];class h{static isLivelinessError(e){return!!e&&!!m.find(t=>"string"==typeof e?t===e:t===e.message)}static authComponentStateForError(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"login";if(!e)return{serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:null};let a=Object(o.a)("Cannot reach homeserver"),n=Object(o.a)("Ensure you have a stable internet connection, or get in touch with the server admin");if(!h.isLivelinessError(e)){const e=c.b.get().brand;a=Object(o.a)("Your %(brand)s is misconfigured",{brand:e}),n=Object(o.a)("Ask your %(brand)s admin to check <a>your config</a> for incorrect or duplicate entries.",{brand:e},{a:e=>i.a.createElement("a",{href:"https://github.com/vector-im/element-web/blob/master/docs/config.md",target:"_blank",rel:"noreferrer noopener"},e)})}let s=!0;return("string"==typeof e?e:e.message)===r.a.ERROR_INVALID_IDENTITY_SERVER&&(s=!1,a=Object(o.a)("Cannot reach identity server"),n="register"===t?Object(o.a)("You can register, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin."):"reset_password"===t?Object(o.a)("You can reset your password, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin."):Object(o.a)("You can log in, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin.")),{serverIsAlive:!1,serverErrorIsFatal:s,serverDeadError:i.a.createElement("div",null,i.a.createElement("strong",null,a),i.a.createElement("div",null,n))}}static async validateServerConfigWithStaticUrls(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)throw Object(o.i)(Object(o.c)("No homeserver URL provided"));const n={"m.homeserver":{base_url:e}};t&&(n["m.identity_server"]={base_url:t});const i=await r.a.fromDiscoveryConfig(n),s=new URL(e).hostname;return h.buildValidatedConfigFromDiscovery(s,i,a,!0)}static async validateServerName(e){const t=await r.a.findClientConfig(e);return h.buildValidatedConfigFromDiscovery(e,t)}static buildValidatedConfigFromDiscovery(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t||!t["m.homeserver"])throw s.a.error("Ended up in a state of not knowing which homeserver to connect to."),Object(o.i)(Object(o.c)("Unexpected error resolving homeserver configuration"));const i=t["m.homeserver"],l=t["m.identity_server"],d=c.b.get("validated_server_config");let m=d&&d.isUrl;if(l&&l.state===r.a.SUCCESS)m=l.base_url;else if(l&&l.state!==r.a.PROMPT){if(s.a.error("Error determining preferred identity server URL:",l),l.state===r.a.FAIL_ERROR){if(-1!==r.a.ALL_ERRORS.indexOf(l.error))throw Object(o.i)(l.error);throw Object(o.i)(Object(o.c)("Unexpected error resolving identity server configuration"))}i.error=r.a.ERROR_INVALID_IDENTITY_SERVER,l.base_url&&(m=l.base_url)}if(i.state!==r.a.SUCCESS&&(s.a.error("Error processing homeserver config:",i),!a||!h.isLivelinessError(i.error))){if(-1!==r.a.ALL_ERRORS.indexOf(i.error))throw Object(o.i)(i.error);throw Object(o.i)(Object(o.c)("Unexpected error resolving homeserver configuration"))}const p=i.base_url;let g=e||i.server_name;const v=new URL(p);if(g||(g=v.hostname),!g)throw s.a.error("Failed to parse homeserver name from homeserver URL"),Object(o.i)(Object(o.c)("Unexpected error resolving homeserver configuration"));return function(e,t){const a=new e;return Object.assign(a,t),a}(u,{hsUrl:p,hsName:g,hsNameIsDifferent:v.hostname!==g,isUrl:m,isDefault:!1,warning:i.error,isNameResolvable:!n})}}},364:function(e,t,a){(function(a){var n,i,r;i=[],void 0===(r="function"==typeof(n=function(){"use strict";function t(e,t,a){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="blob",n.onload=function(){o(n.response,t,a)},n.onerror=function(){console.error("could not download file")},n.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function i(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(a){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var r="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof a&&a.global===a?a:void 0,s=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=r.saveAs||("object"!=typeof window||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,a,s){var o=r.URL||r.webkitURL,c=document.createElement("a");a=a||e.name||"download",c.download=a,c.rel="noopener","string"==typeof e?(c.href=e,c.origin===location.origin?i(c):n(c.href)?t(e,a,s):i(c,c.target="_blank")):(c.href=o.createObjectURL(e),setTimeout((function(){o.revokeObjectURL(c.href)}),4e4),setTimeout((function(){i(c)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,a,r){if(a=a||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,r),a);else if(n(e))t(e,a,r);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){i(s)}))}}:function(e,a,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return t(e,a,n);var o="application/octet-stream"===e.type,c=/constructor/i.test(r.HTMLElement)||r.safari,l=/CriOS\/[\d]+/.test(navigator.userAgent);if((l||o&&c||s)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=l?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},d.readAsDataURL(e)}else{var u=r.URL||r.webkitURL,m=u.createObjectURL(e);i?i.location=m:location.href=m,i=null,setTimeout((function(){u.revokeObjectURL(m)}),4e4)}});r.saveAs=o.saveAs=o,e.exports=o})?n.apply(t,i):n)||(e.exports=r)}).call(this,a(30))},365:function(e,t,a){"use strict";var n,i=a(101),r=a.n(i),s=a(6),o=a.n(s),c=a(90),l=a.n(c),d=a(96),u=a.n(d),m=a(99),h=a(113),p=a(136),g=a(1),v=a(114),f=a(161),b=a(145),y=a(240);function E(){return(E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function _(e){return c.createElement("svg",E({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),n||(n=c.createElement("path",{d:"M12.528 6.54l.5-.498c1.377-1.378 3.598-1.391 4.96-.03 1.361 1.362 1.348 3.583-.03 4.96l-2.37 2.37c-1.378 1.378-3.599 1.391-4.96.03m.844 4.087l-.5.499c-1.377 1.378-3.598 1.391-4.96.03-1.361-1.362-1.348-3.583.03-4.96l2.37-2.37c1.378-1.378 3.599-1.391 4.96-.03",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round"})))}var w;function S(){return(S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function O(e){return c.createElement("svg",S({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0},e),w||(w=c.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M1 2.75A.75.75 0 011.75 2h.005a.75.75 0 010 1.5H1.75A.75.75 0 011 2.75zm2.495 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.005a.75.75 0 010 1.5h-.005a.75.75 0 01-.75-.75zM1 6.75A.75.75 0 011.75 6h8.5a.75.75 0 010 1.5h-8.5A.75.75 0 011 6.75zm0 3A.75.75 0 011.75 9h4.5a.75.75 0 010 1.5h-4.5A.75.75 0 011 9.75zm0 4a.75.75 0 01.75-.75h.005a.75.75 0 010 1.5H1.75a.75.75 0 01-.75-.75zm2.495 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.005a.75.75 0 010 1.5h-.005a.75.75 0 01-.75-.75z",clipRule:"evenodd"})))}var C=a(91),x=a(94),k=a(135),j=a(95),R=a(180),I=a(98),T=a(104),N=a(898),D=a(511),P=a(93),M=a(201),A=a(109),L=a(92);class U extends l.a.Component{constructor(e,t){super(e,t),o()(this,"context",void 0),o()(this,"unmounted",!1),o()(this,"room",void 0),o()(this,"blockquoteRef",l.a.createRef()),o()(this,"canCollapse",()=>this.state.events.length>1),o()(this,"collapse",()=>{this.initialize()}),o()(this,"onQuoteClick",async e=>{const t=[this.state.loadedEv,...this.state.events];let a=null;t.length>0&&(a=await this.getNextEvent(t[0])),this.setState({loadedEv:a,events:t}),x.a.fire(I.a.FocusSendMessageComposer)}),this.state={events:[],loadedEv:null,loading:!0,err:!1},this.room=this.matrixClient.getRoom(this.props.parentEv.getRoomId())}get matrixClient(){return L.a.get()}componentDidMount(){this.initialize(),this.trySetExpandableQuotes()}componentDidUpdate(){this.props.onHeightChanged(),this.trySetExpandableQuotes()}componentWillUnmount(){this.unmounted=!0}trySetExpandableQuotes(){if(void 0===this.props.isQuoteExpanded&&this.blockquoteRef.current){const e=this.blockquoteRef.current.querySelector(".mx_EventTile_body");if(e){const t=e.querySelector("code"),a=!!t&&t.offsetHeight>=60;(e.offsetHeight>=60||a)&&this.props.setQuoteExpanded(!1)}}}async initialize(){const{parentEv:e}=this.props,t=await this.getEvent(Object(M.b)(e));if(!this.unmounted)if(t){const e=await this.getNextEvent(t);this.setState({events:[t],loadedEv:e,loading:!1})}else this.setState({err:!0})}async getNextEvent(e){try{const t=Object(M.b)(e);return await this.getEvent(t)}catch(e){return null}}async getEvent(e){if(!e)return null;const t=this.room.findEventById(e);if(t)return t;try{await this.matrixClient.getEventTimeline(this.room.getUnfilteredTimelineSet(),e)}catch(e){return null}return this.room.findEventById(e)}getReplyChainColorClass(e){return Object(R.f)(e.getSender()).replace("Username","ReplyChain")}render(){let e=null;if(this.state.err)e=l.a.createElement("blockquote",{className:"mx_ReplyChain mx_ReplyChain_error"},Object(C.a)("Unable to load event that was replied to, it either does not exist or you do not have permission to view it."));else if(this.state.loadedEv&&Object(M.c)(this.state.events[0])){const t=this.state.loadedEv,a=this.matrixClient.getRoom(t.getRoomId());e=l.a.createElement("blockquote",{className:"mx_ReplyChain "+this.getReplyChainColorClass(t)},Object(C.a)("<a>In reply to</a> <pill>",{},{a:e=>l.a.createElement(P.a,{kind:"link_inline",className:"mx_ReplyChain_show",onClick:this.onQuoteClick},e),pill:l.a.createElement(D.b,{type:D.a.UserMention,room:a,url:Object(k.i)(t.getSender()),shouldShowPillAvatar:j.b.getValue("Pill.shouldShowPillAvatar")})}))}else if(this.props.forExport){const t=Object(M.b)(this.props.parentEv);e=l.a.createElement("p",{className:"mx_ReplyChain_Export"},Object(C.a)("In reply to <a>this message</a>",{},{a:e=>l.a.createElement("a",{className:"mx_reply_anchor",href:"#"+t,"scroll-to":t}," ",e," ")}))}else this.state.loading&&(e=l.a.createElement(T.a,{w:16,h:16}));const{isQuoteExpanded:t}=this.props,a=this.state.events.map(e=>{const a=u()({mx_ReplyChain:!0,[this.getReplyChainColorClass(e)]:!0,"mx_ReplyChain--expanded":!0===t,"mx_ReplyChain--collapsed":!1===t});return l.a.createElement("blockquote",{ref:this.blockquoteRef,className:a,key:e.getId()},l.a.createElement(N.a,{mxEvent:e,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator,toggleExpandedQuote:()=>this.props.setQuoteExpanded(!this.props.isQuoteExpanded),getRelationsForEvent:this.props.getRelationsForEvent}))});return l.a.createElement("div",{className:"mx_ReplyChain_wrapper"},l.a.createElement("div",null,e),l.a.createElement("div",null,a))}}o()(U,"contextType",A.b);var F=a(168),B=a(138),V=a(274),z=a(132),W=a(609),H=a(117),G=a(167),q=a(137),K=a(303),Y=a(217),J=a(124),$=a(141),Q=a(577),X=a(717),Z=a(237);class ee extends l.a.Component{constructor(e){super(e)}render(){return l.a.createElement(Z.a,{className:"mx_TooltipButton_container",tooltipClassName:"mx_TooltipButton_helpText",tooltipTargetClassName:"mx_TooltipButton",label:this.props.helpText},"?")}}var te,ae=a(174),ne=a(579);function ie(){return(ie=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function re(e){return c.createElement("svg",ie({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),te||(te=c.createElement("path",{d:"M3 14h12M5 10.5l7-7",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}var se,oe=a(837);function ce(){return(ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function le(e){return c.createElement("svg",ce({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 19",role:"presentation","aria-hidden":!0},e),se||(se=c.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.584 3.908A7.126 7.126 0 0116.086 8.75h1.545c.294 0 .47.328.307.573L15.68 12.71a.368.368 0 01-.612 0l-2.257-3.388a.368.368 0 01.307-.573h1.456a5.626 5.626 0 00-9.06-3.665 4.032 4.032 0 01-.203.15l-.015.01-.005.003-.002.001v.001h-.001l-.414-.625.414.625A.75.75 0 014.459 4l.004-.002a1.534 1.534 0 00.12-.09zm-1.16 6.342h1.457c.294 0 .47-.328.307-.573L2.93 6.29a.368.368 0 00-.612 0L.062 9.677a.368.368 0 00.307.573h1.545a7.126 7.126 0 0011.662 4.711.75.75 0 10-.963-1.15 5.626 5.626 0 01-9.188-3.562z",fill:"currentColor"})))}var de,ue;function me(){return(me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function he(e){return c.createElement("svg",me({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),de||(de=c.createElement("path",{fill:"currentColor",d:"M5 5.25a.75.75 0 000 1.5h8a.75.75 0 000-1.5H5zm0 3a.75.75 0 000 1.5h4a.75.75 0 100-1.5H5z"})),ue||(ue=c.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M3 .25A2.75 2.75 0 00.25 3v14a.75.75 0 001.2.6L4.916 15c.217-.162.48-.25.75-.25H15A2.75 2.75 0 0017.75 12V3A2.75 2.75 0 0015 .25H3zM1.75 3c0-.69.56-1.25 1.25-1.25h12c.69 0 1.25.56 1.25 1.25v9c0 .69-.56 1.25-1.25 1.25H5.666a2.75 2.75 0 00-1.65.55L1.75 15.5V3z",clipRule:"evenodd"})))}var pe;function ge(){return(ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ve(e){return c.createElement("svg",ge({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),pe||(pe=c.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z",fill:"currentColor"})))}var fe;function be(){return(be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ye(e){return c.createElement("svg",be({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 21.87 20.801",role:"presentation","aria-hidden":!0},e),fe||(fe=c.createElement("path",{fill:"currentColor",d:"M4.178 20.801l6.758-4.91 6.756 4.91-2.58-7.946 6.758-4.91h-8.352L10.936 0 8.354 7.945H0l6.758 4.91-2.58 7.946z"})))}var Ee,_e=a(838);function we(){return(we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Se(e){return c.createElement("svg",we({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 14",role:"presentation","aria-hidden":!0},e),Ee||(Ee=c.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M.22 8.494a.753.753 0 011.062-.002l3.724 3.7L8.718 8.48a.753.753 0 011.062-.002.747.747 0 01.002 1.06L5.54 13.78a.753.753 0 01-1.063.002L.221 9.552a.747.747 0 01-.002-1.058zm9.562-2.988a.753.753 0 01-1.062.002l-3.724-3.7L1.283 5.52a.753.753 0 01-1.062.002.747.747 0 01-.002-1.06L4.462.22A.753.753 0 015.524.218l4.257 4.23a.747.747 0 01.001 1.058z",clipRule:"evenodd"})))}var Oe;function Ce(){return(Ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function xe(e){return c.createElement("svg",Ce({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 14",role:"presentation","aria-hidden":!0},e),Oe||(Oe=c.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M.22.234A.753.753 0 011.281.232l3.724 3.7L8.718.22A.753.753 0 019.781.218a.747.747 0 01.001 1.06L5.54 5.52a.753.753 0 01-1.063.002L.221 1.292A.747.747 0 01.219.235zm9.562 13.532a.753.753 0 01-1.062.002l-3.724-3.7-3.713 3.712a.753.753 0 01-1.062.002.747.747 0 01-.002-1.06L4.462 8.48a.753.753 0 011.062-.002l4.257 4.23a.747.747 0 01.001 1.058z",clipRule:"evenodd"})))}var ke=a(158),je=a(580),Re=a(139),Ie=a(408),Te=a(452),Ne=a(791),De=a(790);class Pe extends l.a.PureComponent{constructor(e){super(e),o()(this,"downloader",new De.a),o()(this,"onDownloadClick",async()=>{if(this.state.loading)return;if(this.props.mediaEventHelperGet().media.isEncrypted&&this.setState({tooltip:Object(C.c)("Decrypting")}),this.setState({loading:!0}),this.state.blob)return this.doDownload();const e=await this.props.mediaEventHelperGet().sourceBlob.value;this.setState({blob:e}),await this.doDownload()}),this.state={loading:!1,tooltip:Object(C.c)("Downloading")}}async doDownload(){await this.downloader.download({blob:this.state.blob,name:this.props.mediaEventHelperGet().fileName}),this.setState({loading:!1})}render(){let e;this.state.loading&&(e=l.a.createElement(T.a,{w:18,h:18}));const t=u()({mx_MessageActionBar_iconButton:!0,mx_MessageActionBar_downloadButton:!0,mx_MessageActionBar_downloadSpinnerButton:!!e});return l.a.createElement(Re.b,{className:t,title:e?Object(C.a)(this.state.tooltip):Object(C.a)("Download"),onClick:this.onDownloadClick,disabled:!!e},l.a.createElement(Ne.Icon,null),e)}}var Me,Ae,Le=a(513),Ue=a(343),Fe=a(193),Be=a(110),Ve=a(170),ze=a(100);const We=JSON.parse(null!==(Me=null===(Ae=localStorage)||void 0===Ae?void 0:Ae.getItem("io_element_favouriteMessages"))&&void 0!==Me?Me:"[]");const He=e=>{let{mxEvent:t,getTile:a,getReplyChain:n,permalinkCreator:i,onFocusChange:s,getRelationsForEvent:o}=e;const[d,u,m,h]=Object(H.p)(),[p,g]=Object(Re.i)(u);Object(c.useEffect)(()=>{s(d)},[s,d]);const v=Object(c.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),m(),p()},[m,p]);let f;if(d){const e=a&&a(),s=n&&n(),c=u.current.getBoundingClientRect();f=l.a.createElement(W.a,r()({},Object(H.i)(c),{mxEvent:t,permalinkCreator:i,eventTileOps:e&&e.getEventTileOps?e.getEventTileOps():void 0,collapseReplyChain:s&&s.canCollapse()?s.collapse:void 0,onFinished:h,getRelationsForEvent:o}))}return l.a.createElement(l.a.Fragment,null,l.a.createElement(H.c,{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_optionsButton",title:Object(C.a)("Options"),onClick:v,onContextMenu:v,isExpanded:d,inputRef:u,onFocus:p,tabIndex:g?0:-1},l.a.createElement(ne.a,null)),f)},Ge=e=>{let{mxEvent:t,reactions:a,onFocusChange:n}=e;const[i,s,o,d]=Object(H.p)(),[u,m]=Object(Re.i)(s);let h;if(Object(c.useEffect)(()=>{n(i)},[n,i]),i){const e=s.current.getBoundingClientRect();h=l.a.createElement(H.n,r()({},Object(H.i)(e),{onFinished:d,managed:!1}),l.a.createElement(Le.a,{mxEvent:t,reactions:a,onFinished:d}))}const p=Object(c.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),o(),u()},[o,u]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(H.c,{className:"mx_MessageActionBar_iconButton",title:Object(C.a)("React"),onClick:p,onContextMenu:p,isExpanded:i,inputRef:s,onFocus:u,tabIndex:m?0:-1},l.a.createElement(oe.a,null)),h)},qe=e=>{var t;let{mxEvent:a}=e;const n=Object(c.useContext)(Ue.a),i=null==a||null===(t=a.getRelation())||void 0===t?void 0:t.rel_type,r=!!i&&i!==m.g.Thread,s=!localStorage.getItem("mx_seen_feature_thread"),o=j.b.getValue("feature_thread");if(!o&&!p.e.hasServerSideSupport)return null;const d=e=>{e.preventDefault(),e.stopPropagation(),s&&localStorage.setItem("mx_seen_feature_thread","true"),j.b.getValue("feature_thread")?a.getThread()&&!a.isThreadRoot?x.b.dispatch({action:I.a.ShowThread,rootEvent:a.getThread().rootEvent,initialEvent:a,scroll_into_view:!0,highlighted:!0,push:n.isCard}):x.b.dispatch({action:I.a.ShowThread,rootEvent:a,push:n.isCard}):x.a.dispatch({action:I.a.ViewUserSettings,initialTabId:Ve.a.Labs})};return l.a.createElement(Re.b,{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_threadButton",disabled:r,tooltip:l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},r?Object(C.a)("Can't create a thread from an event with an existing relation"):Object(C.a)("Reply in thread")),!r&&l.a.createElement("div",{className:"mx_Tooltip_sub"},j.b.getValue("feature_thread")?Object(C.a)("Beta feature"):Object(C.a)("Beta feature. Click to learn more."))),title:r?Object(C.a)("Can't create a thread from an event with an existing relation"):Object(C.a)("Reply in thread"),onClick:d,onContextMenu:d},l.a.createElement(he,null),s&&!o&&l.a.createElement("div",{className:"mx_Indicator"}))},Ke=e=>{let{mxEvent:t}=e;const{isFavourite:a,toggleFavourite:n}=function(){const[,e]=Object(c.useState)(),t=e=>We.includes(e);return{isFavourite:t,toggleFavourite:a=>{t(a)?We.splice(We.indexOf(a),1):We.push(a),localStorage.setItem("io_element_favouriteMessages",JSON.stringify(We)),e([])}}}(),i=t.getId(),r=u()("mx_MessageActionBar_iconButton mx_MessageActionBar_favouriteButton",{mx_MessageActionBar_favouriteButton_fillstar:a(i)}),s=Object(c.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),n(i)},[n,i]);return l.a.createElement(Re.b,{className:r,title:Object(C.a)("Favourite"),onClick:s,onContextMenu:s,"data-testid":i},l.a.createElement(ye,null))};class Ye extends l.a.PureComponent{constructor(){super(...arguments),o()(this,"onDecrypted",()=>{this.forceUpdate()}),o()(this,"onBeforeRedaction",()=>{this.forceUpdate()}),o()(this,"onSent",()=>{this.forceUpdate()}),o()(this,"onFocusChange",e=>{var t,a;null===(t=(a=this.props).onFocusChange)||void 0===t||t.call(a,e)}),o()(this,"onReplyClick",e=>{e.preventDefault(),e.stopPropagation(),x.a.dispatch({action:"reply_to_event",event:this.props.mxEvent,context:this.context.timelineRenderingType})}),o()(this,"onEditClick",e=>{e.preventDefault(),e.stopPropagation(),Object(ke.e)(this.props.mxEvent,this.context.timelineRenderingType,this.props.getRelationsForEvent)}),o()(this,"forbiddenThreadHeadMsgType",[m.d.KeyVerificationRequest]),o()(this,"onResendClick",e=>{e.preventDefault(),e.stopPropagation(),this.runActionOnFailedEv(e=>Ie.a.resend(e))}),o()(this,"onCancelClick",e=>{this.runActionOnFailedEv(e=>Ie.a.removeFromQueue(e),e=>Object(ke.b)(e.status))})}componentDidMount(){this.props.mxEvent.status&&this.props.mxEvent.status!==h.a.SENT&&this.props.mxEvent.on(h.c.Status,this.onSent);L.a.get().decryptEventIfNeeded(this.props.mxEvent),this.props.mxEvent.isBeingDecrypted()&&this.props.mxEvent.once(h.c.Decrypted,this.onDecrypted),this.props.mxEvent.on(h.c.BeforeRedaction,this.onBeforeRedaction)}componentWillUnmount(){this.props.mxEvent.off(h.c.Status,this.onSent),this.props.mxEvent.off(h.c.Decrypted,this.onDecrypted),this.props.mxEvent.off(h.c.BeforeRedaction,this.onBeforeRedaction)}get showReplyInThreadAction(){if(!j.b.getValue("feature_thread")&&!p.e.hasServerSideSupport)return null;if(!j.b.getBetaInfo("feature_thread")&&!j.b.getValue("feature_thread")&&!ze.b.get("show_labs_settings"))return!1;const e=this.context.timelineRenderingType!==A.a.Thread,t=!this.forbiddenThreadHeadMsgType.includes(this.props.mxEvent.getContent().msgtype)&&!ae.b.matches(this.props.mxEvent.getType());return e&&t}runActionOnFailedEv(e,t){t||(t=()=>!0);const a=this.props.mxEvent,n=a.replacingEvent(),i=[a.localRedactionEvent(),n,a];for(const a of i)if(a&&t(a)){e(a);break}}render(){const e=[];Object(ke.c)(this.props.mxEvent)&&e.push(l.a.createElement(Re.b,{className:"mx_MessageActionBar_iconButton",title:Object(C.a)("Edit"),onClick:this.onEditClick,onContextMenu:this.onEditClick,key:"edit"},l.a.createElement(re,null)));const t=l.a.createElement(Re.b,{className:"mx_MessageActionBar_iconButton",title:Object(C.a)("Delete"),onClick:this.onCancelClick,onContextMenu:this.onCancelClick,key:"cancel"},l.a.createElement(ve,null)),a=l.a.createElement(qe,{mxEvent:this.props.mxEvent,key:"reply_thread"}),n=this.props.mxEvent,i=n.replacingEvent()&&n.replacingEvent().status,r=n.localRedactionEvent()&&n.localRedactionEvent().status,s=Object(ke.b)(n.status)||Object(ke.b)(i)||Object(ke.b)(r),o=[n.status,i,r].includes(h.a.NOT_SENT);if(s&&o)e.splice(0,0,l.a.createElement(Re.b,{className:"mx_MessageActionBar_iconButton",title:Object(C.a)("Retry"),onClick:this.onResendClick,onContextMenu:this.onResendClick,key:"resend"},l.a.createElement(le,null))),e.push(t);else{if(Object(ke.j)(this.props.mxEvent)?(this.context.canSendMessages&&(this.showReplyInThreadAction&&e.splice(0,0,a),e.splice(0,0,l.a.createElement(Re.b,{className:"mx_MessageActionBar_iconButton",title:Object(C.a)("Reply"),onClick:this.onReplyClick,onContextMenu:this.onReplyClick,key:"reply"},l.a.createElement(_e.a,null)))),this.context.canReact&&e.splice(0,0,l.a.createElement(Ge,{mxEvent:this.props.mxEvent,reactions:this.props.reactions,onFocusChange:this.onFocusChange,key:"react"})),j.b.getValue("feature_favourite_messages")&&e.splice(-1,0,l.a.createElement(Ke,{key:"favourite",mxEvent:this.props.mxEvent})),Te.a.isEligible(this.props.mxEvent)&&e.splice(0,0,l.a.createElement(Pe,{mxEvent:this.props.mxEvent,mediaEventHelperGet:()=>{var e,t,a,n;return null===(e=(t=this.props).getTile)||void 0===e||null===(a=(n=e.call(t)).getMediaHelper)||void 0===a?void 0:a.call(n)},key:"download"}))):j.b.getValue("feature_thread")&&this.context.timelineRenderingType===A.a.Room&&this.props.mxEvent.getThread()&&e.unshift(a),s&&e.push(t),void 0!==this.props.isQuoteExpanded&&Object(M.c)(this.props.mxEvent)){const t=u()({mx_MessageActionBar_iconButton:!0,mx_MessageActionBar_expandCollapseMessageButton:!0}),a=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},this.props.isQuoteExpanded?Object(C.a)("Collapse quotes"):Object(C.a)("Expand quotes")),l.a.createElement("div",{className:"mx_Tooltip_sub"},Object(C.a)(Be.a[Fe.b.SHIFT])+" + "+Object(C.a)("Click")));e.push(l.a.createElement(Re.b,{className:t,title:this.props.isQuoteExpanded?Object(C.a)("Collapse quotes"):Object(C.a)("Expand quotes"),tooltip:a,onClick:this.props.toggleThreadExpanded,key:"expand"},this.props.isQuoteExpanded?l.a.createElement(xe,null):l.a.createElement(Se,null)))}e.push(l.a.createElement(He,{mxEvent:this.props.mxEvent,getReplyChain:this.props.getReplyChain,getTile:this.props.getTile,permalinkCreator:this.props.permalinkCreator,onFocusChange:this.onFocusChange,key:"menu",getRelationsForEvent:this.props.getRelationsForEvent}))}return l.a.createElement(je.a,{className:"mx_MessageActionBar","aria-label":Object(C.a)("Message Actions"),"aria-live":"off"},e)}}o()(Ye,"contextType",A.b);var Je=a(292),$e=a(298),Qe=a(157),Xe=a(102);class Ze extends l.a.PureComponent{render(){const{content:e,reactionEvents:t,mxEvent:a,visible:n}=this.props,i=this.context.getRoom(a.getRoomId());let r,s;if(i){const a=[];for(const e of t){const t=i.getMember(e.getSender()),n=t?t.name:e.getSender();a.push(n)}const n=Object(Qe.j)(e);r=l.a.createElement("div",null,Object(C.a)("<reactors/><reactedWith>reacted with %(shortName)s</reactedWith>",{shortName:n},{reactors:()=>l.a.createElement("div",{className:"mx_Tooltip_title"},Object(R.b)(a,6)),reactedWith:e=>n?l.a.createElement("div",{className:"mx_Tooltip_sub"},e):null}))}return r&&(s=l.a.createElement(q.b,{visible:n,label:r})),s}}o()(Ze,"contextType",Xe.a);class et extends l.a.PureComponent{constructor(){super(...arguments),o()(this,"context",void 0),o()(this,"state",{tooltipRendered:!1,tooltipVisible:!1}),o()(this,"onClick",()=>{const{mxEvent:e,myReactionEvent:t,content:a}=this.props;t?this.context.redactEvent(e.getRoomId(),t.getId()):(this.context.sendEvent(e.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:e.getId(),key:a}}),x.a.dispatch({action:"message_sent"}))}),o()(this,"onMouseOver",()=>{this.setState({tooltipRendered:!0,tooltipVisible:!0})}),o()(this,"onMouseLeave",()=>{this.setState({tooltipVisible:!1})})}render(){const{mxEvent:e,content:t,count:a,reactionEvents:n,myReactionEvent:i}=this.props,r=u()({mx_ReactionsRowButton:!0,mx_ReactionsRowButton_selected:!!i});let s;this.state.tooltipRendered&&(s=l.a.createElement(Ze,{mxEvent:this.props.mxEvent,content:t,reactionEvents:n,visible:this.state.tooltipVisible}));const o=this.context.getRoom(e.getRoomId());let c;if(o){const e=[];for(const t of n){const a=o.getMember(t.getSender());e.push((null==a?void 0:a.name)||t.getSender())}const a=Object(R.b)(e,6);c=t?Object(C.a)("%(reactors)s reacted with %(content)s",{reactors:a,content:t}):a}return l.a.createElement(P.a,{className:r,"aria-label":c,onClick:this.onClick,disabled:this.props.disabled,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave},l.a.createElement("span",{className:"mx_ReactionsRowButton_content","aria-hidden":"true"},t),l.a.createElement("span",{className:"mx_ReactionsRowButton_count","aria-hidden":"true"},a),s)}}o()(et,"contextType",Xe.a);const tt=e=>{let{mxEvent:t,reactions:a}=e;const[n,i,s,o]=Object(H.p)();let c;if(n){const e=i.current.getBoundingClientRect();c=l.a.createElement(H.n,r()({},Object(H.i)(e),{onFinished:o,managed:!1}),l.a.createElement(Le.a,{mxEvent:t,reactions:a,onFinished:o}))}return l.a.createElement(l.a.Fragment,null,l.a.createElement($e.a,{className:u()("mx_ReactionsRow_addReactionButton",{mx_ReactionsRow_addReactionButton_active:n}),title:Object(C.a)("Add reaction"),onClick:s,onContextMenu:e=>{e.preventDefault(),s()},isExpanded:n,inputRef:i}),c)};class at extends l.a.PureComponent{constructor(e,t){super(e,t),o()(this,"context",void 0),o()(this,"onDecrypted",()=>{this.forceUpdate()}),o()(this,"onReactionsChange",()=>{this.setState({myReactions:this.getMyReactions()}),this.forceUpdate()}),o()(this,"onShowAllClick",()=>{this.setState({showAll:!0})}),this.context=t,this.state={myReactions:this.getMyReactions(),showAll:!1}}componentDidMount(){const{mxEvent:e,reactions:t}=this.props;(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&e.once(h.c.Decrypted,this.onDecrypted),t&&(t.on(Je.b.Add,this.onReactionsChange),t.on(Je.b.Remove,this.onReactionsChange),t.on(Je.b.Redaction,this.onReactionsChange))}componentWillUnmount(){const{mxEvent:e,reactions:t}=this.props;e.off(h.c.Decrypted,this.onDecrypted),t&&(t.off(Je.b.Add,this.onReactionsChange),t.off(Je.b.Remove,this.onReactionsChange),t.off(Je.b.Redaction,this.onReactionsChange))}componentDidUpdate(e){e.reactions!==this.props.reactions&&(this.props.reactions.on(Je.b.Add,this.onReactionsChange),this.props.reactions.on(Je.b.Remove,this.onReactionsChange),this.props.reactions.on(Je.b.Redaction,this.onReactionsChange),this.onReactionsChange())}getMyReactions(){const e=this.props.reactions;if(!e)return null;const t=this.context.room.client.getUserId(),a=e.getAnnotationsBySender()[t];return a?[...a.values()]:null}render(){const{mxEvent:e,reactions:t}=this.props,{myReactions:a,showAll:n}=this.state;if(!t||!Object(ke.j)(e))return null;let i,r,s=t.getSortedAnnotationsByKey().map(t=>{let[n,i]=t;const r=i.size;if(!r)return null;const s=a&&a.find(e=>!e.isRedacted()&&e.getRelation().key===n);return l.a.createElement(et,{key:n,content:n,count:r,mxEvent:e,reactionEvents:i,myReactionEvent:s,disabled:!this.context.canReact||s&&!s.isRedacted()&&!this.context.canSelfRedact})}).filter(e=>!!e);return s.length?(s.length>9&&!n&&(s=s.slice(0,8),i=l.a.createElement(P.a,{kind:"link_inline",className:"mx_ReactionsRow_showAll",onClick:this.onShowAllClick},Object(C.a)("Show all"))),this.context.canReact&&(r=l.a.createElement(tt,{mxEvent:e,reactions:t})),l.a.createElement("div",{className:"mx_ReactionsRow",role:"toolbar","aria-label":Object(C.a)("Reactions")},s,i,r)):null}}o()(at,"contextType",A.b);var nt=a(578),it=a(595),rt=a(509),st=a(184),ot=a(195),ct=a(164),lt=a(152),dt=a(839),ut=a(483),mt=a(127),ht=a(97),pt=a(250),gt=a(514);class vt extends l.a.Component{constructor(e){super(e),o()(this,"onBugReport",()=>{ht.a.createDialog(pt.a,{label:"react-soft-crash-tile",error:this.state.error})}),o()(this,"onViewSource",()=>{ht.a.createDialog(gt.a,{mxEvent:this.props.mxEvent},"mx_Dialog_viewsource")}),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}render(){if(this.state.error){const{mxEvent:e}=this.props,t={mx_EventTile:!0,mx_EventTile_info:!0,mx_EventTile_content:!0,mx_EventTile_tileError:!0};let a,n;return ze.b.get().bug_report_endpoint_url&&(a=l.a.createElement(l.a.Fragment,null," ",l.a.createElement(P.a,{kind:"link",onClick:this.onBugReport},Object(C.a)("Submit logs")))),e&&j.b.getValue("developerMode")&&(n=l.a.createElement(l.a.Fragment,null," ",l.a.createElement(P.a,{onClick:this.onViewSource,kind:"link"},Object(C.a)("View Source")))),l.a.createElement("li",{className:u()(t),"data-layout":this.props.layout},l.a.createElement("div",{className:"mx_EventTile_line"},l.a.createElement("span",null,Object(C.a)("Can't load this message"),e&&` (${e.getType()})`,a,n)))}return this.props.children}}var ft=a(206),bt=a(103),yt=a.n(bt),Et=a(111),_t=a(218);const wt=["mxEvent","thread"],St=e=>{var t,a;let{thread:n,showDisplayname:i=!1}=e;const r=Object(c.useContext)(Xe.a),s=Object(Et.d)(n,p.f.Update,()=>n.replyToEvent),[o,d]=Object(c.useState)(null==s?void 0:s.getContent());Object(Et.c)(s,h.c.Replaced,()=>{d(s.getContent())});const u=(null==s?void 0:s.shouldAttemptDecryption())||(null==s?void 0:s.isBeingDecrypted());Object(Et.c)(u?s:null,h.c.Decrypted,()=>{d(s.getContent())});const m=Object(_t.a)(async()=>{if(s)return await r.decryptEventIfNeeded(s),it.a.instance.generatePreviewForEvent(s)},[s,o]);return m&&s?l.a.createElement(l.a.Fragment,null,l.a.createElement($.a,{member:s.sender,fallbackUserId:s.getSender(),width:24,height:24,className:"mx_ThreadSummary_avatar"}),i&&l.a.createElement("div",{className:"mx_ThreadSummary_sender"},null!==(t=null===(a=s.sender)||void 0===a?void 0:a.name)&&void 0!==t?t:s.getSender()),l.a.createElement("div",{className:"mx_ThreadSummary_content",title:m},l.a.createElement("span",{className:"mx_ThreadSummary_message-preview"},m))):null};var Ot=e=>{let{mxEvent:t,thread:a}=e,n=yt()(e,wt);const i=Object(c.useContext)(A.b),s=Object(c.useContext)(Ue.a),o=Object(Et.d)(a,p.f.Update,()=>a.length);if(!o)return null;let d=o;return i.narrow||(d=Object(C.a)("%(count)s reply",{count:o})),l.a.createElement(P.a,r()({},n,{className:"mx_ThreadSummary",onClick:e=>{x.a.dispatch({action:I.a.ShowThread,rootEvent:t,push:s.isCard}),mt.b.trackInteraction("WebRoomTimelineThreadSummaryButton",e)},"aria-label":Object(C.a)("Open thread")}),l.a.createElement("span",{className:"mx_ThreadSummary_replies_amount"},d),l.a.createElement(St,{thread:a,showDisplayname:!i.narrow}),l.a.createElement("div",{className:"mx_ThreadSummary_chevron"}))},Ct=a(155),xt=a.n(Ct);class kt extends l.a.Component{constructor(e){super(e),o()(this,"nodes",{}),o()(this,"children",void 0),this.updateChildren(this.props.children)}componentDidUpdate(){this.updateChildren(this.props.children)}applyStyles(e,t){Object.entries(t).forEach(t=>{let[a,n]=t;e.style[a]=n})}updateChildren(e){const t=this.children||{};this.children={},l.a.Children.toArray(e).forEach(e=>{if(t[e.key]){const a=t[e.key],n=xt.a.findDOMNode(this.nodes[a.key]);n&&n.style.left!==e.props.style.left&&this.applyStyles(n,{left:e.props.style.left}),this.children[e.key]=l.a.cloneElement(a,e.props,e.props.children)}else{const t={},a=e.props.style,n=this.props.startStyles;if(n.length>0){const e=n[0];t.style=e}t.ref=t=>this.collectNode(e.key,t,a),this.children[e.key]=l.a.cloneElement(e,t)}})}collectNode(e,t,a){if(t&&void 0===this.nodes[e]&&this.props.startStyles.length>0){const e=this.props.startStyles,n=xt.a.findDOMNode(t);for(let t=1;t<e.length;++t)this.applyStyles(n,e[t]);setTimeout(()=>{this.applyStyles(n,a)},0)}this.nodes[e]=t}render(){return l.a.createElement(l.a.Fragment,null,Object.values(this.children))}}o()(kt,"defaultProps",{startStyles:[]});var jt=a(512);class Rt extends l.a.PureComponent{constructor(e){super(e),o()(this,"avatar",Object(c.createRef)()),this.state={suppressDisplay:!this.props.suppressAnimation}}componentWillUnmount(){const e=this.props.readReceiptInfo;e&&(this.props.checkUnmounting&&this.props.checkUnmounting()||this.buildReadReceiptInfo(e))}componentDidMount(){this.state.suppressDisplay&&this.animateMarker()}componentDidUpdate(e){const t=e.offset!==this.props.offset,a=e.hidden!==this.props.hidden;(t||a)&&this.animateMarker()}buildReadReceiptInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this.avatar.current,a=t.offsetParent;if(!(a&&a instanceof HTMLElement))return g.a.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} has no valid horizontalContainer`),e.top=0,e.right=0,e.parent=null,e;const n=a.offsetParent;return n&&n instanceof HTMLElement?(e.top=t.offsetTop,e.right=t.getBoundingClientRect().right-a.getBoundingClientRect().right,e.parent=n,e):(g.a.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} has no valid verticalContainer`),e.top=0,e.right=0,e.parent=null,e)}readReceiptPosition(e){return e.parent?e.top+e.parent.getBoundingClientRect().top:(g.a.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} has no offsetParent`),0)}animateMarker(){const e=this.props.readReceiptInfo,t=this.buildReadReceiptInfo(),a=this.readReceiptPosition(t),n=e?this.readReceiptPosition(e):-Nt,i=[];null!=e&&e.right&&i.push({top:n-a,right:e.right}),i.push({top:n-a,right:0}),this.setState({suppressDisplay:!1,startStyles:i})}render(){if(this.state.suppressDisplay)return l.a.createElement("div",{ref:this.avatar});const e={right:Object(jt.a)(this.props.offset),top:"0px"};return l.a.createElement(kt,{startStyles:this.state.startStyles},l.a.createElement($.a,{member:this.props.member,fallbackUserId:this.props.fallbackUserId,"aria-hidden":"true","aria-live":"off",width:14,height:14,resizeMethod:"crop",style:e,inputRef:this.avatar,hideTitle:!0,tabIndex:-1}))}}var It=a(181);function Tt(e){const[t,a]=Object(c.useState)(!1);return[{showTooltip:()=>a(!0),hideTooltip:()=>a(!1)},l.a.createElement(q.b,r()({},e,{visible:t}))]}const Nt=16;function Dt(e){let{readReceipts:t,readReceiptMap:a,checkUnmounting:n,suppressAnimation:i,isTwelveHour:s}=e;const[o,c,d,u]=Object(H.p)(),m=t.length>4,h=m?3:4,p=function(e,t){return t?Object(C.a)("%(members)s and more",{members:e.join(", ")}):e.length>1?Object(C.a)("%(members)s and %(last)s",{last:e.pop(),members:e.join(", ")}):e.length?e[0]:null}(t.slice(0,h).map(e=>{var t,a;return null!==(t=null===(a=e.roomMember)||void 0===a?void 0:a.name)&&void 0!==t?t:e.userId}),m),[{showTooltip:g,hideTooltip:v},f]=Tt({label:l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},Object(C.a)("Seen by %(count)s people",{count:t.length})),l.a.createElement("div",{className:"mx_Tooltip_sub"},p)),alignment:q.a.TopRight});if(0===t.length)return l.a.createElement("div",{className:"mx_EventTile_msgOption"},l.a.createElement("div",{className:"mx_ReadReceiptGroup"},l.a.createElement("div",{className:"mx_ReadReceiptGroup_button"},l.a.createElement("span",{className:"mx_ReadReceiptGroup_container"}))));const b=t.map((e,t)=>{const{hidden:r,position:o}=function(e,t){return e<t?{hidden:!1,position:e}:{hidden:!0,position:0}}(t,h),c=e.userId;let d;return a&&(d=a[c],d||(d={},a[c]=d)),l.a.createElement(Rt,{key:c,member:e.roomMember,fallbackUserId:c,offset:10*o,hidden:r,readReceiptInfo:d,checkUnmounting:n,suppressAnimation:i,timestamp:e.ts,showTwelveHour:s})}).reverse();let y;const E=t.length-h;let _;if(E>0&&(y=l.a.createElement("span",{className:"mx_ReadReceiptGroup_remainder","aria-live":"off"},"+",E)),o){const e=c.current.getBoundingClientRect();_=l.a.createElement(H.n,r()({menuClassName:"mx_ReadReceiptGroup_popup",onFinished:u},Object(H.i)(e)),l.a.createElement(It.a,null,l.a.createElement(Mt,{className:"mx_ReadReceiptGroup_title"},Object(C.a)("Seen by %(count)s people",{count:t.length})),t.map(e=>l.a.createElement(Pt,r()({key:e.userId},e,{isTwelveHour:s,onAfterClick:u})))))}return l.a.createElement("div",{className:"mx_EventTile_msgOption"},l.a.createElement("div",{className:"mx_ReadReceiptGroup",role:"group","aria-label":Object(C.a)("Read receipts")},l.a.createElement(P.a,{className:"mx_ReadReceiptGroup_button",inputRef:c,"aria-label":p,"aria-haspopup":"true",onClick:d,onMouseOver:g,onMouseLeave:v,onFocus:g,onBlur:v},y,l.a.createElement("span",{className:"mx_ReadReceiptGroup_container",style:{width:10*Math.min(h,t.length)+Nt-10}},b)),f,_))}function Pt(e){var t,a;let{userId:n,roomMember:i,ts:r,isTwelveHour:s,onAfterClick:o}=e;const[{showTooltip:c,hideTooltip:d},u]=Tt({alignment:q.a.Top,tooltipClassName:"mx_ReadReceiptGroup_person--tooltip",label:l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},null!==(t=null==i?void 0:i.rawDisplayName)&&void 0!==t?t:n),l.a.createElement("div",{className:"mx_Tooltip_sub"},n))});return l.a.createElement(H.d,{className:"mx_ReadReceiptGroup_person",onClick:()=>{x.a.dispatch({action:I.a.ViewUser,member:null!=i?i:{userId:n},push:!1}),null==o||o()},onMouseOver:c,onMouseLeave:d,onFocus:c,onBlur:d,onWheel:d},l.a.createElement($.a,{member:i,fallbackUserId:n,width:24,height:24,"aria-hidden":"true","aria-live":"off",resizeMethod:"crop",hideTitle:!0}),l.a.createElement("div",{className:"mx_ReadReceiptGroup_name"},l.a.createElement("p",null,null!==(a=null==i?void 0:i.name)&&void 0!==a?a:n),l.a.createElement("p",{className:"mx_ReadReceiptGroup_secondary"},Object(B.b)(new Date(r),s))),u)}function Mt(e){let{className:t,children:a}=e;const n=Object(c.useRef)(),[i]=Object(Re.i)(n);return l.a.createElement("h3",{className:t,role:"menuitem",onFocus:i,tabIndex:-1,ref:n},a)}var At=a(186),Lt=a(172),Ut=a(527),Ft=a(246),Bt=a(481),Vt=a(200);var zt=a(721);function Wt(e){let{room:t,threadId:a}=e;const{symbol:n,count:i,color:r}=((e,t)=>{const[a,n]=Object(c.useState)(null),[i,r]=Object(c.useState)(0),[s,o]=Object(c.useState)(0);Object(Et.a)(e,v.d.UnreadNotifications,(e,a)=>{t&&t!==a||l()}),Object(Et.a)(e,v.d.Receipt,()=>l()),Object(Et.a)(e,v.d.Timeline,()=>l()),Object(Et.a)(e,v.d.Redaction,()=>l()),Object(Et.a)(e,v.d.LocalEchoUpdated,()=>l()),Object(Et.a)(e,v.d.MyMembership,()=>l());const l=Object(c.useCallback)(()=>{if(Object(Ut.b)(e,t).length>0)n("!"),r(1),o(ct.a.Unsent);else if(Object(Vt.b)(e.getMyMembership())===Vt.a.Invite)n("!"),r(1),o(ct.a.Red);else if(Object(Ft.b)(e.roomId)===Ft.a.Mute)n(null),r(0),o(ct.a.None);else{const a=Object(Ft.c)(e,v.b.Highlight,t),i=Object(Ft.c)(e,v.b.Total,t);if(r(i||a),n(null),a>0)o(ct.a.Red);else if(i>0)o(ct.a.Grey);else if(!t){const t=Object(Bt.a)(e);o(t?ct.a.Bold:ct.a.None)}}},[e,t]);return Object(c.useEffect)(()=>{l()},[l]),{symbol:a,count:i,color:s}})(t,a);return l.a.createElement(zt.a,{symbol:n,count:i,color:r})}function Ht(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Gt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(a),!0).forEach((function(t){o()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ht(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class qt extends l.a.Component{constructor(e,t){super(e,t),o()(this,"suppressReadReceiptAnimation",void 0),o()(this,"isListeningForReceipts",void 0),o()(this,"tile",l.a.createRef()),o()(this,"replyChain",l.a.createRef()),o()(this,"threadState",void 0),o()(this,"ref",Object(c.createRef)()),o()(this,"context",void 0),o()(this,"onThreadStateUpdate",()=>{var e;if(!this.supportsThreadNotifications){let t=null;switch(null===(e=this.threadState)||void 0===e?void 0:e.color){case ct.a.Grey:t=v.b.Total;break;case ct.a.Red:t=v.b.Highlight}this.setState({threadNotification:t})}}),o()(this,"updateThread",e=>{e===this.state.thread||this.supportsThreadNotifications||(this.threadState&&this.threadState.off(ot.b.Update,this.onThreadStateUpdate),this.setupNotificationListener(e)),this.setState({thread:e})}),o()(this,"onNewThread",e=>{if(e.id===this.props.mxEvent.getId()){this.updateThread(e);L.a.get().getRoom(this.props.mxEvent.getRoomId()).off(p.f.New,this.onNewThread)}}),o()(this,"viewInRoom",e=>{e.preventDefault(),e.stopPropagation(),x.a.dispatch({action:I.a.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:void 0})}),o()(this,"copyLinkToThread",async e=>{e.preventDefault(),e.stopPropagation();const{permalinkCreator:t,mxEvent:a}=this.props,n=t.forEvent(a.getId());await Object(lt.c)(n)}),o()(this,"onRoomReceipt",(e,t)=>{t===L.a.get().getRoom(this.props.mxEvent.getRoomId())&&(this.shouldShowSentReceipt||this.shouldShowSendingReceipt||this.isListeningForReceipts)&&this.forceUpdate(()=>{this.shouldShowSentReceipt||this.shouldShowSendingReceipt||(L.a.get().removeListener(v.d.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!1)})}),o()(this,"onDecrypted",()=>{this.verifyEvent(this.props.mxEvent),this.forceUpdate()}),o()(this,"onDeviceVerificationChanged",(e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent(this.props.mxEvent)}),o()(this,"onUserVerificationChanged",(e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent(this.props.mxEvent)}),o()(this,"onSenderProfileClick",()=>{x.a.dispatch({action:I.a.ComposerInsert,userId:this.props.mxEvent.getSender(),timelineRenderingType:this.context.timelineRenderingType})}),o()(this,"onRequestKeysClick",()=>{this.setState({previouslyRequestedKeys:!0}),L.a.get().cancelAndResendEventRoomKeyRequest(this.props.mxEvent)}),o()(this,"onPermalinkClicked",e=>{e.preventDefault(),x.a.dispatch({action:I.a.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:this.context.timelineRenderingType===A.a.Search?"MessageSearch":void 0})}),o()(this,"onActionBarFocusChange",e=>{this.setState({actionBarFocused:e})}),o()(this,"getTile",()=>this.tile.current),o()(this,"getReplyChain",()=>this.replyChain.current),o()(this,"getReactions",()=>{if(!this.props.showReactions||!this.props.getRelationsForEvent)return null;const e=this.props.mxEvent.getId();return this.props.getRelationsForEvent(e,"m.annotation","m.reaction")}),o()(this,"onReactionsCreated",(e,t)=>{"m.annotation"===e&&"m.reaction"===t&&this.setState({reactions:this.getReactions()})}),o()(this,"onContextMenu",e=>{this.showContextMenu(e)}),o()(this,"onTimestampContextMenu",e=>{var t;this.showContextMenu(e,null===(t=this.props.permalinkCreator)||void 0===t?void 0:t.forEvent(this.props.mxEvent.getId()))}),o()(this,"onCloseMenu",()=>{this.setState({contextMenu:null,actionBarFocused:!1})}),o()(this,"setQuoteExpanded",e=>{this.setState({isQuoteExpanded:e})});const a=this.thread;this.state={actionBarFocused:!1,verified:null,previouslyRequestedKeys:!1,reactions:this.getReactions(),contextMenu:null,hover:!1,thread:a},this.suppressReadReceiptAnimation=!0,this.isListeningForReceipts=!1}get isEligibleForSpecialReceipt(){if(this.props.readReceipts&&this.props.readReceipts.length>0)return!1;if(!this.props.mxEvent)return!1;if(!L.a.get().getRoom(this.props.mxEvent.getRoomId()))return!1;const e=L.a.get().getUserId();if(this.props.mxEvent.getSender()!==e)return!1;return!![m.b.Sticker,m.b.RoomMessage,m.b.RoomMessageEncrypted].includes(this.props.mxEvent.getType())}get shouldShowSentReceipt(){if(!this.isEligibleForSpecialReceipt)return!1;if(!this.props.lastSuccessful)return!1;if(this.props.eventSendStatus&&this.props.eventSendStatus!==h.a.SENT)return!1;const e=this.props.readReceipts||[],t=L.a.get().getUserId();return!e.some(e=>e.userId!==t)}get shouldShowSendingReceipt(){return!!this.isEligibleForSpecialReceipt&&!(!this.props.eventSendStatus||this.props.eventSendStatus===h.a.SENT)}UNSAFE_componentWillMount(){this.verifyEvent(this.props.mxEvent)}componentDidMount(){this.suppressReadReceiptAnimation=!1;const e=L.a.get();this.props.forExport||(e.on(b.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),e.on(b.b.UserTrustStatusChanged,this.onUserVerificationChanged),this.props.mxEvent.on(h.c.Decrypted,this.onDecrypted),dt.a.instance.addVisibleEvent(this.props.mxEvent),this.props.showReactions&&this.props.mxEvent.on(h.c.RelationsCreated,this.onReactionsCreated),(this.shouldShowSentReceipt||this.shouldShowSendingReceipt)&&(e.on(v.d.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!0)),j.b.getValue("feature_thread")&&(this.props.mxEvent.on(p.f.Update,this.updateThread),this.thread&&!this.supportsThreadNotifications&&this.setupNotificationListener(this.thread)),e.decryptEventIfNeeded(this.props.mxEvent);const t=e.getRoom(this.props.mxEvent.getRoomId());null==t||t.on(p.f.New,this.onNewThread)}get supportsThreadNotifications(){return L.a.get().canSupport.get(y.a.ThreadUnreadNotifications)!==y.b.Unsupported}setupNotificationListener(e){if(!this.supportsThreadNotifications){const t=st.a.instance.getThreadsRoomState(e.room);this.threadState=t.getThreadRoomState(e),this.threadState.on(ot.b.Update,this.onThreadStateUpdate),this.onThreadStateUpdate()}}UNSAFE_componentWillReceiveProps(e){e.eventSendStatus!==this.props.eventSendStatus&&this.verifyEvent(e.mxEvent)}shouldComponentUpdate(e,t){return!!Object(G.c)(this.state,t)||!this.propsEqual(this.props,e)}componentWillUnmount(){const e=L.a.get();e.removeListener(b.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),e.removeListener(b.b.UserTrustStatusChanged,this.onUserVerificationChanged),e.removeListener(v.d.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!1,this.props.mxEvent.removeListener(h.c.Decrypted,this.onDecrypted),this.props.showReactions&&this.props.mxEvent.removeListener(h.c.RelationsCreated,this.onReactionsCreated),j.b.getValue("feature_thread")&&this.props.mxEvent.off(p.f.Update,this.updateThread);const t=L.a.get().getRoom(this.props.mxEvent.getRoomId());null==t||t.off(p.f.New,this.onNewThread),this.threadState&&this.threadState.off(ot.b.Update,this.onThreadStateUpdate)}componentDidUpdate(){this.isListeningForReceipts||!this.shouldShowSentReceipt&&!this.shouldShowSendingReceipt||(L.a.get().on(v.d.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!0)}get thread(){var e;if(!j.b.getValue("feature_thread"))return null;let t=this.props.mxEvent.getThread();if(!t){const e=L.a.get().getRoom(this.props.mxEvent.getRoomId());t=null==e?void 0:e.findThreadForEvent(this.props.mxEvent)}return null!==(e=t)&&void 0!==e?e:null}renderThreadPanelSummary(){return this.state.thread?l.a.createElement("div",{className:"mx_ThreadPanel_replies"},l.a.createElement("span",{className:"mx_ThreadPanel_replies_amount"},this.state.thread.length),l.a.createElement(St,{thread:this.state.thread})):null}renderThreadInfo(){var e;return(null===(e=this.state.thread)||void 0===e?void 0:e.id)===this.props.mxEvent.getId()?l.a.createElement(Ot,{mxEvent:this.props.mxEvent,thread:this.state.thread,"data-testid":"thread-summary"}):this.context.timelineRenderingType===A.a.Search&&this.props.mxEvent.threadRootId?this.props.highlightLink?l.a.createElement("a",{className:"mx_ThreadSummary_icon",href:this.props.highlightLink},Object(C.a)("From a thread")):l.a.createElement("p",{className:"mx_ThreadSummary_icon"},Object(C.a)("From a thread")):void 0}async verifyEvent(e){if(!e.isEncrypted()||e.isRedacted())return;const t=L.a.get().getEventEncryptionInfo(e),a=e.getSender(),n=L.a.get().checkUserTrust(a);if(t.mismatchedSender)return void this.setState({verified:V.a.Warning},this.props.onHeightChanged);if(!n.isCrossSigningVerified())return void this.setState({verified:t.authenticated?V.a.Normal:V.a.Unauthenticated},this.props.onHeightChanged);const i=t.sender&&L.a.get().checkDeviceTrust(a,t.sender.deviceId);i?i.isVerified()?t.authenticated?this.setState({verified:V.a.Verified},this.props.onHeightChanged):this.setState({verified:V.a.Unauthenticated},this.props.onHeightChanged):this.setState({verified:V.a.Warning},this.props.onHeightChanged):this.setState({verified:V.a.Unknown},this.props.onHeightChanged)}propsEqual(e,t){const a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;for(let n=0;n<a.length;n++){const i=a[n];if(!t.hasOwnProperty(i))return!1;if("readReceipts"===i){const a=e[i],n=t[i];if(a===n)continue;if(!a||!n)return!1;if(a.length!==n.length)return!1;for(let e=0;e<a.length;e++){if(a[e].userId!==n[e].userId)return!1;if(a[e].roomMember!==n[e].roomMember)return!1}}else if(e[i]!==t[i])return!1}return!0}shouldHighlight(){if(this.props.forExport)return!1;if(this.context.timelineRenderingType===A.a.Notification)return!1;if(this.context.timelineRenderingType===A.a.ThreadsList)return!1;const e=L.a.get().getPushActionsForEvent(this.props.mxEvent.replacingEvent()||this.props.mxEvent);return!(!e||!e.tweaks)&&(this.props.mxEvent.getSender()!==L.a.get().credentials.userId&&e.tweaks.highlight)}renderE2EPadlock(){const e=this.props.mxEvent;if(!Object(At.a)(e.getRoomId())){if("m.bad.encrypted"===e.getContent().msgtype)return l.a.createElement(Jt,null);if(e.isEncrypted()&&!e.isRedacted())return this.state.verified===V.a.Normal||this.state.verified===V.a.Verified?void 0:this.state.verified===V.a.Unauthenticated?l.a.createElement(Zt,null):this.state.verified===V.a.Unknown?l.a.createElement(Xt,null):l.a.createElement($t,null);if(L.a.get().isRoomEncrypted(e.getRoomId())){if(e.status===h.a.ENCRYPTING)return;if(e.status===h.a.NOT_SENT)return;if(e.isState())return;if(e.isRedacted())return;return l.a.createElement(Qt,null)}return null}}showContextMenu(e,t){const a=e.target,n=a instanceof HTMLAnchorElement?a:a.closest("a");a instanceof HTMLImageElement||(J.a.get().allowOverridingNativeContextMenus()||!Object(lt.d)()&&!n)&&(this.props.editState||(e.preventDefault(),e.stopPropagation(),this.setState({contextMenu:{position:{left:e.clientX,top:e.clientY,bottom:e.clientY},link:(null==n?void 0:n.href)||t},actionBarFocused:!0})))}shouldHideEvent(){var e;return(null===(e=this.props.callEventGrouper)||void 0===e?void 0:e.hangupReason)===f.b.Replaced}renderContextMenu(){if(!this.state.contextMenu)return null;const e=this.getTile(),t=this.getReplyChain(),a=null!=e&&e.getEventTileOps?e.getEventTileOps():void 0,n=null!=t&&t.canCollapse()?t.collapse:void 0;return l.a.createElement(W.a,r()({},Object(H.j)(this.state.contextMenu.position),{mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator,eventTileOps:a,collapseReplyChain:n,onFinished:this.onCloseMenu,rightClick:!0,reactions:this.state.reactions,link:this.state.contextMenu.link,getRelationsForEvent:this.props.getRelationsForEvent}))}render(){var e,t,a;const n=this.props.mxEvent.getContent().msgtype,i=this.props.mxEvent.getType(),{hasRenderer:r,isBubbleMessage:s,isInfoMessage:o,isLeftAlignedBubbleMessage:c,noBubbleEvent:d,isSeeingThroughMessageHiddenForModeration:h}=Object(nt.a)(this.props.mxEvent,this.context.showHiddenEvents,this.shouldHideEvent()),{isQuoteExpanded:p}=this.state;if(!r){const{mxEvent:e}=this.props;return g.a.warn(`Event type not supported: type:${i} isState:${e.isState()}`),l.a.createElement("div",{className:"mx_EventTile mx_EventTile_info mx_MNoticeBody"},l.a.createElement("div",{className:"mx_EventTile_line"},Object(C.a)("This event could not be displayed")))}const v=Te.a.isEligible(this.props.mxEvent),f=u()("mx_EventTile_line",{mx_EventTile_mediaLine:v,mx_EventTile_image:this.props.mxEvent.getType()===m.b.RoomMessage&&this.props.mxEvent.getContent().msgtype===m.d.Image,mx_EventTile_sticker:this.props.mxEvent.getType()===m.b.Sticker,mx_EventTile_emote:this.props.mxEvent.getType()===m.b.RoomMessage&&this.props.mxEvent.getContent().msgtype===m.d.Emote}),b=-1!==["sending","queued","encrypting"].indexOf(this.props.eventSendStatus),y=Object(ft.d)(this.props.mxEvent)&&this.props.isRedacted,E=this.props.mxEvent.isDecryptionFailure();let w=this.props.continuation;this.context.timelineRenderingType!==A.a.Room&&this.context.timelineRenderingType!==A.a.Search&&this.context.timelineRenderingType!==A.a.Thread&&this.props.layout!==F.a.Bubble&&(w=!1);const S=!!this.props.editState,k=u()({mx_EventTile_bubbleContainer:s,mx_EventTile_leftAlignedBubble:c,mx_EventTile:!0,mx_EventTile_isEditing:S,mx_EventTile_info:o,mx_EventTile_12hr:this.props.isTwelveHour,mx_EventTile_sending:!S&&b,mx_EventTile_highlight:this.shouldHighlight(),mx_EventTile_selected:this.props.isSelectedEvent||this.state.contextMenu,mx_EventTile_continuation:w||i===m.b.CallInvite||Lt.d.CALL_EVENT_TYPE.matches(i),mx_EventTile_last:this.props.last,mx_EventTile_lastInSection:this.props.lastInSection,mx_EventTile_contextual:this.props.contextual,mx_EventTile_actionBarFocused:this.state.actionBarFocused,mx_EventTile_verified:!s&&this.state.verified===V.a.Verified,mx_EventTile_unverified:!s&&this.state.verified===V.a.Warning,mx_EventTile_unknown:!s&&this.state.verified===V.a.Unknown,mx_EventTile_bad:E,mx_EventTile_emote:n===m.d.Emote,mx_EventTile_noSender:this.props.hideSender,mx_EventTile_clamp:this.context.timelineRenderingType===A.a.ThreadsList,mx_EventTile_noBubble:d}),j=null!==this.props.eventSendStatus?"off":void 0;let R="#";this.props.permalinkCreator&&(R=this.props.permalinkCreator.forEvent(this.props.mxEvent.getId()));const T=this.props.mxEvent.status?void 0:this.props.mxEvent.getId();let N,D,W,H;if(this.context.timelineRenderingType===A.a.Notification?(W=24,H=!0):o?(W=14,H=!1):this.context.timelineRenderingType===A.a.ThreadsList||this.context.timelineRenderingType===A.a.Thread&&!this.props.continuation?(W=32,H=!0):i===m.b.RoomCreate||s?(W=0,H=!1):this.props.layout==F.a.IRC?(W=14,H=!0):this.props.continuation&&this.context.timelineRenderingType!==A.a.File||i===m.b.CallInvite||Lt.d.CALL_EVENT_TYPE.matches(i)?(W=0,H=!1):(W=30,H=!0),this.props.mxEvent.sender&&W){let e;e=this.props.mxEvent.getContent().third_party_invite?this.props.mxEvent.target:this.props.mxEvent.sender;const t=this.context.timelineRenderingType!==A.a.ThreadsList;N=l.a.createElement("div",{className:"mx_EventTile_avatar"},l.a.createElement($.a,{member:e,width:W,height:W,viewUserOnClick:t,forceHistorical:this.props.mxEvent.getType()===m.b.RoomMember}))}H&&!0!==this.props.hideSender&&(D=this.context.timelineRenderingType===A.a.Room||this.context.timelineRenderingType===A.a.Search||this.context.timelineRenderingType===A.a.Pinned||this.context.timelineRenderingType===A.a.Thread?l.a.createElement(Q.a,{onClick:this.onSenderProfileClick,mxEvent:this.props.mxEvent}):l.a.createElement(Q.a,{mxEvent:this.props.mxEvent}));const G=!S&&!this.props.forExport?l.a.createElement(Ye,{mxEvent:this.props.mxEvent,reactions:this.state.reactions,permalinkCreator:this.props.permalinkCreator,getTile:this.getTile,getReplyChain:this.getReplyChain,onFocusChange:this.onActionBarFocusChange,isQuoteExpanded:p,toggleThreadExpanded:()=>this.setQuoteExpanded(!p),getRelationsForEvent:this.props.getRelationsForEvent}):void 0,q=this.props.mxEvent.getTs()&&(this.props.alwaysShowTimestamps||this.props.last||this.state.hover||this.state.actionBarFocused||Boolean(this.state.contextMenu));let K=this.context.timelineRenderingType!==A.a.ThreadsList?this.props.mxEvent.getTs():null===(e=this.state.thread)||void 0===e||null===(t=e.replyToEvent)||void 0===t?void 0:t.getTs();"number"!=typeof K&&(K=this.props.mxEvent.getTs());const Y=l.a.createElement(X.a,{showRelative:this.context.timelineRenderingType===A.a.ThreadsList,showTwelveHour:this.props.isTwelveHour,ts:K}),J=q&&K?Y:null,Z=l.a.createElement("div",{className:"mx_EventTile_keyRequestInfo_tooltip_contents"},l.a.createElement("p",null,this.state.previouslyRequestedKeys?Object(C.a)("Your key share request has been sent - please check your other sessions for key share requests."):Object(C.a)("Key share requests are sent to your other sessions automatically. If you rejected or dismissed the key share request on your other sessions, click here to request the keys for this session again.")),l.a.createElement("p",null,Object(C.a)("If your other sessions do not have the key for this message you will not be able to decrypt them."))),te=this.state.previouslyRequestedKeys?Object(C.a)("Key request sent."):Object(C.a)("<requestLink>Re-request encryption keys</requestLink> from your other sessions.",{},{requestLink:e=>l.a.createElement(P.a,{className:"mx_EventTile_rerequestKeysCta",kind:"link_inline",tabIndex:0,onClick:this.onRequestKeysClick},e)}),ae=E&&!y?l.a.createElement("div",{className:"mx_EventTile_keyRequestInfo"},l.a.createElement("span",{className:"mx_EventTile_keyRequestInfo_text"},te),l.a.createElement(ee,{helpText:Z})):null;let ne;y||(ne=l.a.createElement(at,{mxEvent:this.props.mxEvent,reactions:this.state.reactions,key:"mx_EventTile_reactionsRow"}));const ie=l.a.createElement("a",{href:R,onClick:this.onPermalinkClicked,"aria-label":Object(B.l)(new Date(this.props.mxEvent.getTs()),this.props.isTwelveHour),onContextMenu:this.onTimestampContextMenu},J),re=this.props.layout===F.a.IRC,se=re?null:ie,oe=re?ie:null,ce=this.props.layout===F.a.Bubble?Y:null,le=!re&&!s&&this.renderE2EPadlock(),de=re&&!s&&this.renderE2EPadlock();let ue;var me,he;this.props.showReadReceipts&&(ue=this.shouldShowSentReceipt||this.shouldShowSendingReceipt?l.a.createElement(ta,{messageState:this.props.mxEvent.getAssociatedStatus()}):l.a.createElement(Dt,{readReceipts:null!==(me=this.props.readReceipts)&&void 0!==me?me:[],readReceiptMap:null!==(he=this.props.readReceiptMap)&&void 0!==he?he:{},checkUnmounting:this.props.checkUnmounting,suppressAnimation:this.suppressReadReceiptAnimation,isTwelveHour:this.props.isTwelveHour}));let pe;Object(ft.c)(this.props.mxEvent,this.context.showHiddenEvents)&&Object(M.c)(this.props.mxEvent)&&(pe=l.a.createElement(U,{parentEv:this.props.mxEvent,onHeightChanged:this.props.onHeightChanged,ref:this.replyChain,forExport:this.props.forExport,permalinkCreator:this.props.permalinkCreator,layout:this.props.layout,alwaysShowTimestamps:this.props.alwaysShowTimestamps||this.state.hover,isQuoteExpanded:p,setQuoteExpanded:this.setQuoteExpanded,getRelationsForEvent:this.props.getRelationsForEvent}));const ge=(null===(a=this.props.mxEvent)||void 0===a?void 0:a.getSender())===L.a.get().getUserId();switch(this.context.timelineRenderingType){case A.a.Notification:{const e=L.a.get().getRoom(this.props.mxEvent.getRoomId());return l.a.createElement(this.props.as||"li",{className:k,"aria-live":j,"aria-atomic":!0,"data-scroll-tokens":T},[l.a.createElement("div",{className:"mx_EventTile_roomName",key:"mx_EventTile_roomName"},l.a.createElement(z.a,{room:e,width:28,height:28}),l.a.createElement("a",{href:R,onClick:this.onPermalinkClicked},e?e.name:"")),l.a.createElement("div",{className:"mx_EventTile_senderDetails",key:"mx_EventTile_senderDetails"},N,l.a.createElement("a",{href:R,onClick:this.onPermalinkClicked,onContextMenu:this.onTimestampContextMenu},D,J)),l.a.createElement("div",{className:f,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),Object(ft.g)(A.a.Notification,Gt(Gt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:h,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents))])}case A.a.Thread:{const e=L.a.get().getRoom(this.props.mxEvent.getRoomId());return l.a.createElement(this.props.as||"li",{ref:this.ref,className:k,"aria-live":j,"aria-atomic":!0,"data-scroll-tokens":T,"data-has-reply":!!pe,"data-layout":this.props.layout,"data-self":ge,"data-event-id":this.props.mxEvent.getId(),onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1})},[l.a.createElement("div",{className:"mx_EventTile_roomName",key:"mx_EventTile_roomName"},l.a.createElement(z.a,{room:e,width:28,height:28}),l.a.createElement("a",{href:R,onClick:this.onPermalinkClicked},e?e.name:"")),l.a.createElement("div",{className:"mx_EventTile_senderDetails",key:"mx_EventTile_senderDetails"},N,D),l.a.createElement("div",{className:f,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),pe,Object(ft.g)(A.a.Thread,Gt(Gt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:h,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents),G,l.a.createElement("a",{href:R,onClick:this.onPermalinkClicked},J),ue),ne])}case A.a.ThreadsList:{const e=L.a.get().getRoom(this.props.mxEvent.getRoomId());return l.a.createElement(this.props.as||"li",{ref:this.ref,className:k,tabIndex:-1,"aria-live":j,"aria-atomic":"true","data-scroll-tokens":T,"data-layout":this.props.layout,"data-shape":this.context.timelineRenderingType,"data-self":ge,"data-has-reply":!!pe,"data-notification":this.supportsThreadNotifications?void 0:this.state.threadNotification,onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1}),onClick:e=>{x.a.dispatch({action:I.a.ShowThread,rootEvent:this.props.mxEvent,push:!0});const t=e.currentTarget,a=Array.from(t.parentElement.children).indexOf(t);mt.b.trackInteraction("WebThreadsPanelThreadItem",e,a)}},l.a.createElement(l.a.Fragment,null,D,N,J,l.a.createElement("div",{className:f,key:"mx_EventTile_line"},l.a.createElement("div",{className:"mx_EventTile_body"},this.props.mxEvent.isRedacted()?l.a.createElement(ut.a,{mxEvent:this.props.mxEvent}):it.a.instance.generatePreviewForEvent(this.props.mxEvent)),this.renderThreadPanelSummary()),l.a.createElement(je.a,{className:"mx_MessageActionBar","aria-label":Object(C.a)("Message Actions"),"aria-live":"off"},l.a.createElement(rt.a,{className:"mx_MessageActionBar_iconButton",onClick:this.viewInRoom,title:Object(C.a)("View in room"),key:"view_in_room"},l.a.createElement(O,null)),l.a.createElement(rt.a,{className:"mx_MessageActionBar_iconButton",onClick:this.copyLinkToThread,title:Object(C.a)("Copy link to thread"),key:"copy_link_to_thread"},l.a.createElement(_,null))),ue,l.a.createElement(Wt,{room:e,threadId:this.props.mxEvent.getId()})))}case A.a.File:return l.a.createElement(this.props.as||"li",{className:k,"aria-live":j,"aria-atomic":!0,"data-scroll-tokens":T},[l.a.createElement("div",{className:f,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),Object(ft.g)(A.a.File,Gt(Gt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:h,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents)),l.a.createElement("a",{className:"mx_EventTile_senderDetailsLink",key:"mx_EventTile_senderDetailsLink",href:R,onClick:this.onPermalinkClicked},l.a.createElement("div",{className:"mx_EventTile_senderDetails",onContextMenu:this.onTimestampContextMenu},D,J))]);default:return l.a.createElement(this.props.as||"li",{ref:this.ref,className:k,tabIndex:-1,"aria-live":j,"aria-atomic":"true","data-scroll-tokens":T,"data-layout":this.props.layout,"data-self":ge,"data-event-id":this.props.mxEvent.getId(),"data-has-reply":!!pe,onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1})},l.a.createElement(l.a.Fragment,null,oe,D,de,N,l.a.createElement("div",{className:f,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),se,le,pe,Object(ft.g)(this.context.timelineRenderingType,Gt(Gt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:h,timestamp:ce,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents),ae,G,this.props.layout===F.a.IRC&&l.a.createElement(l.a.Fragment,null,ne,this.renderThreadInfo())),this.props.layout!==F.a.IRC&&l.a.createElement(l.a.Fragment,null,ne,this.renderThreadInfo()),ue))}}}o()(qt,"defaultProps",{onHeightChanged:function(){},forExport:!1,layout:F.a.Group}),o()(qt,"contextType",A.b);const Kt=Object(c.forwardRef)((e,t)=>l.a.createElement(l.a.Fragment,null,l.a.createElement(vt,{mxEvent:e.mxEvent,layout:e.layout},l.a.createElement(qt,r()({ref:t},e)))));var Yt;t.a=Kt;function Jt(e){return l.a.createElement(ea,r()({title:Object(C.a)("This message cannot be decrypted"),icon:Yt.Warning},e))}function $t(e){return l.a.createElement(ea,r()({title:Object(C.a)("Encrypted by an unverified session"),icon:Yt.Warning},e))}function Qt(e){return l.a.createElement(ea,r()({title:Object(C.a)("Unencrypted"),icon:Yt.Warning},e))}function Xt(e){return l.a.createElement(ea,r()({title:Object(C.a)("Encrypted by a deleted session"),icon:Yt.Normal},e))}function Zt(e){return l.a.createElement(ea,r()({title:Object(C.a)("The authenticity of this encrypted message can't be guaranteed on this device."),icon:Yt.Normal},e))}!function(e){e.Normal="normal",e.Warning="warning"}(Yt||(Yt={}));class ea extends l.a.Component{constructor(e){super(e),o()(this,"onHoverStart",()=>{this.setState({hover:!0})}),o()(this,"onHoverEnd",()=>{this.setState({hover:!1})}),this.state={hover:!1}}render(){let e=null;this.state.hover&&(e=l.a.createElement(q.b,{className:"mx_EventTile_e2eIcon_tooltip",label:this.props.title}));const t="mx_EventTile_e2eIcon mx_EventTile_e2eIcon_"+this.props.icon;return l.a.createElement("div",{className:t,onMouseEnter:this.onHoverStart,onMouseLeave:this.onHoverEnd},e)}}function ta(e){let{messageState:t}=e;const a=!t||"sent"===t,n="not_sent"===t,i=u()({mx_EventTile_receiptSent:a,mx_EventTile_receiptSending:!a&&!n});let r=null;n&&(r=l.a.createElement(Y.a,{notification:K.a.RED_EXCLAMATION}));let s=Object(C.a)("Sending your message...");"encrypting"===t?s=Object(C.a)("Encrypting your message..."):a?s=Object(C.a)("Your message was sent"):n&&(s=Object(C.a)("Failed to send"));const[{showTooltip:o,hideTooltip:c},d]=Tt({label:s,alignment:q.a.TopRight});return l.a.createElement("div",{className:"mx_EventTile_msgOption"},l.a.createElement("div",{className:"mx_ReadReceiptGroup"},l.a.createElement("div",{className:"mx_ReadReceiptGroup_button",onMouseOver:o,onMouseLeave:c,onFocus:o,onBlur:c},l.a.createElement("span",{className:"mx_ReadReceiptGroup_container"},l.a.createElement("span",{className:i},r))),d))}},428:function(e,t,a){"use strict";(function(e){a.d(t,"h",(function(){return H})),a.d(t,"b",(function(){return G})),a.d(t,"a",(function(){return q})),a.d(t,"d",(function(){return K})),a.d(t,"c",(function(){return J})),a.d(t,"j",(function(){return X})),a.d(t,"k",(function(){return ee})),a.d(t,"e",(function(){return te})),a.d(t,"i",(function(){return se})),a.d(t,"l",(function(){return oe})),a.d(t,"g",(function(){return ce})),a.d(t,"f",(function(){return le})),a.d(t,"m",(function(){return he}));var n=a(107),i=a(260),r=a(291),s=a(1),o=a(92),c=a(266),l=a(283),d=a(630),u=a(243),m=a(573),h=a(1402),p=a(94),g=a(133),v=a(97),f=a(304),b=a(124),y=a(429),E=a(394),_=a(95),w=a(165),S=a(253),O=a(482),C=a(1527),x=a(525),k=a(317),j=a(835),R=a(166),I=a(154),T=a(1406),N=a(112),D=a(91),P=a(1407),M=a(1408),A=a(1409),L=a(1410),U=a(544),F=a(100),B=a(1525),V=a(98),z=a(479),W=a(130);async function H(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=e.enableGuest||!1;const a=e.guestHsUrl,n=e.guestIsUrl,i=e.fragmentQueryParams||{},r=e.defaultDeviceDisplayName;if(t&&!a&&(s.a.warn("Cannot enable guest access: can't determine HS URL to use"),t=!1),t&&i.guest_user_id&&i.guest_access_token)return s.a.log("Using guest access credentials"),ae({userId:i.guest_user_id,accessToken:i.guest_access_token,homeserverUrl:a,identityServerUrl:n,guest:!0},!0).then(()=>!0);return!!await X({ignoreGuest:Boolean(e.ignoreGuest)})||!!t&&Y(a,n,r)}catch(e){return!(e instanceof ne)&&Z(e)}}async function G(){const{hsUrl:e,userId:t,hasAccessToken:a,isGuest:n}=await J();return e&&t&&a?[t,n]:[null,null]}function q(e,t,a){if(!e.loginToken)return Promise.resolve(!1);const i=localStorage.getItem(k.a),r=localStorage.getItem(k.c);return i?Object(y.b)(i,r,"m.login.token",{token:e.loginToken,initial_device_display_name:t}).then((function(e){return s.a.log("Logged in with token"),me().then(async()=>(await ie(e),sessionStorage.setItem("mx_fresh_login",String(!0)),!0))})).catch(e=>(v.a.createDialog(N.a,{title:Object(D.a)("We couldn't log you in"),description:"ConnectionError"===e.name?Object(D.a)("Your homeserver was unreachable and was not able to log you in. Please try again. If this continues, please contact your homeserver administrator."):Object(D.a)("Your homeserver rejected your log in attempt. This could be due to things just taking too long. Please try again. If this continues, please contact your homeserver administrator."),button:Object(D.a)("Try again"),onFinished:e=>{if(e){const e=Object(n.createClient)({baseUrl:i,idBaseUrl:r}),t=localStorage.getItem(k.b)||void 0;b.a.get().startSingleSignOn(e,"sso",a,t)}}}),s.a.error("Failed to log in with login token:"),s.a.error(e),!1)):(s.a.warn("Cannot log in with token: can't determine HS URL to use"),v.a.createDialog(N.a,{title:Object(D.a)("We couldn't log you in"),description:Object(D.a)("We asked the browser to remember which homeserver you use to let you sign in, but unfortunately your browser has forgotten it. Go to the sign in page and try again."),button:Object(D.a)("Try again")}),Promise.resolve(!1))}function K(e){if(e.reason===i.c.TOGGLED_LAZY_LOADING)return Promise.resolve().then(()=>{const t=e.value;return new Promise(t?e=>{v.a.createDialog(P.a,{onFinished:e})}:e=>{v.a.createDialog(M.a,{onFinished:e,host:window.location.host})})}).then(()=>o.a.get().store.deleteAllData()).then(()=>{b.a.get().reload()})}function Y(e,t,a){s.a.log("Doing guest login on "+e);return Object(n.createClient)({baseUrl:e}).registerGuest({body:{initial_device_display_name:a}}).then(a=>(s.a.log("Registered as guest: "+a.user_id),ae({userId:a.user_id,deviceId:a.device_id,accessToken:a.access_token,homeserverUrl:e,identityServerUrl:t,guest:!0},!0).then(()=>!0)),e=>(s.a.error("Failed to register as guest",e),!1))}async function J(){const e=localStorage.getItem("mx_hs_url"),t=localStorage.getItem("mx_is_url");let a;try{a=await E.c("account","mx_access_token")}catch(e){s.a.error("StorageManager.idbLoad failed for account:mx_access_token",e)}if(!a&&(a=localStorage.getItem("mx_access_token"),a))try{await E.d("account","mx_access_token",a),localStorage.removeItem("mx_access_token")}catch(e){s.a.error("migration of access token to IndexedDB failed",e)}const n="true"===localStorage.getItem("mx_has_access_token")||!!a,i=localStorage.getItem("mx_user_id"),r=localStorage.getItem("mx_device_id");let o;return o=null!==localStorage.getItem("mx_is_guest")?"true"===localStorage.getItem("mx_is_guest"):"true"===localStorage.getItem("matrix-is-guest"),{hsUrl:e,isUrl:t,hasAccessToken:n,accessToken:a,userId:i,deviceId:r,isGuest:o}}async function $(e){const t=new Uint8Array(e.length);for(let a=0;a<e.length;a++)t[a]=e.charCodeAt(a);const a=await window.crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits"]);return t.fill(0),new Uint8Array(await window.crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(32),info:new Uint8Array(0)},a,256))}async function Q(){if(await new Promise(e=>{v.a.createDialog(L.a,{onFinished:e})}))throw await me(),new ne("Aborting login in progress because of storage inconsistency")}async function X(e){const t=null==e?void 0:e.ignoreGuest;if(!localStorage)return!1;const{hsUrl:a,isUrl:n,hasAccessToken:i,accessToken:o,userId:c,deviceId:l,isGuest:d}=await J();if(i&&!o&&await Q(),o&&c&&a){if(t&&d)return s.a.log("Ignoring stored guest account: "+c),!1;let e=o;const i=await b.a.get().getPickleKey(c,l);if(i){if(s.a.log("Got pickle key"),"string"!=typeof o){const t=await $(i);e=await Object(r.b)(o,t,"access_token"),t.fill(0)}}else s.a.log("No pickle key available");const u="true"===sessionStorage.getItem("mx_fresh_login");return sessionStorage.removeItem("mx_fresh_login"),s.a.log("Restoring session for "+c),await ae({userId:c,deviceId:l,accessToken:e,homeserverUrl:a,identityServerUrl:n,guest:d,pickleKey:i,freshLogin:u},!1),!0}return s.a.log("No previous session found."),!1}async function Z(e){s.a.error("Unable to load session",e);const t=v.a.createDialog(A.a,{error:e}),[a]=await t.finished;return a?(await me(),!1):H()}async function ee(e){e.freshLogin=!0,he();const t=e.userId&&e.deviceId?await b.a.get().createPickleKey(e.userId,e.deviceId):null;return t?s.a.log("Created pickle key"):s.a.log("Pickle key not created"),ae(Object.assign({},e,{pickleKey:t}),!0)}async function te(e){const t=o.a.get().getUserId(),a=o.a.get().getDeviceId();he(),localStorage.removeItem("mx_soft_logout"),re=!1;const n=e.userId!==t||e.deviceId!==a;return n&&s.a.warn("Clearing all data: Old session belongs to a different user/session"),e.pickleKey||(s.a.info("Lifecycle#hydrateSession: Pickle key not provided - trying to get one"),e.pickleKey=await b.a.get().getPickleKey(e.userId,e.deviceId)),ae(e,n)}async function ae(e,t){e.guest=Boolean(e.guest);const a=ce();s.a.log("setLoggedIn: mxid: "+e.userId+" deviceId: "+e.deviceId+" guest: "+e.guest+" hs: "+e.homeserverUrl+" softLogout: "+a," freshLogin: "+e.freshLogin),p.a.dispatch({action:"on_logging_in"},!0),t&&await me();const n=await E.a();n.dataInLocalStorage&&n.cryptoInited&&!n.dataInCryptoStore&&await Q(),o.a.replaceUsingCreds(e),Object(U.c)(e.userId),R.a.instance.isEnabled()&&R.a.instance.startListeningToSettingsChanges();const i=o.a.get();if(e.freshLogin&&_.b.getValue("feature_dehydration")){const t=await i.rehydrateDevice();t&&(e.deviceId=t),delete e.freshLogin}if(localStorage)try{await ie(e),sessionStorage.removeItem("mx_fresh_login")}catch(e){s.a.warn("Error using local storage: can't persist session!",e)}else s.a.warn("No local storage available: can't persist session!");return p.a.fire(V.a.OnLoggedIn),await de(!a),i}p.a.register(e=>{if(e.action===V.a.TriggerLogout)ue();else if(e.action===V.a.OverwriteLogin){ae(e.credentials,!0)}});class ne extends Error{}async function ie(e){var t;if(localStorage.setItem("mx_hs_url",e.homeserverUrl),e.identityServerUrl&&localStorage.setItem("mx_is_url",e.identityServerUrl),localStorage.setItem("mx_user_id",e.userId),localStorage.setItem("mx_is_guest",JSON.stringify(e.guest)),e.accessToken?localStorage.setItem("mx_has_access_token","true"):localStorage.deleteItem("mx_has_access_token"),e.pickleKey){let t;try{const a=await $(e.pickleKey);t=await Object(r.c)(e.accessToken,a,"access_token"),a.fill(0)}catch(e){s.a.warn("Could not encrypt access token",e)}try{await E.d("account","mx_access_token",t||e.accessToken)}catch(t){localStorage.setItem("mx_access_token",e.accessToken)}localStorage.setItem("mx_has_pickle_key",String(!0))}else{try{await E.d("account","mx_access_token",e.accessToken)}catch(t){localStorage.setItem("mx_access_token",e.accessToken)}"true"===localStorage.getItem("mx_has_pickle_key")&&s.a.error("Expected a pickle key, but none provided.  Encryption may not work.")}e.deviceId&&localStorage.setItem("mx_device_id",e.deviceId),null===(t=c.a.persistCredentials)||void 0===t||t.call(c.a,e),s.a.log("Session persisted for "+e.userId)}let re=!1;function se(){if(!o.a.get())return;if(R.a.instance.logout(),o.a.get().isGuest())return void e(()=>ue());re=!0;const t=o.a.get();b.a.get().destroyPickleKey(t.getUserId(),t.getDeviceId()),t.logout(!0).then(ue,e=>{s.a.warn("Failed to call logout API: token will not be invalidated",e),ue()})}function oe(){o.a.get()&&(localStorage.setItem("mx_soft_logout","true"),s.a.log("Soft logout initiated"),re=!0,p.a.dispatch({action:"on_client_not_viable"}),he(!1))}function ce(){return"true"===localStorage.getItem("mx_soft_logout")}function le(){return re}async function de(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];s.a.log("Lifecycle: Starting MatrixClient"),p.a.dispatch({action:"will_start_client"},!0),W.b.instance.typingStore.reset(),w.a.sharedInstance().reset(),B.a.instance.prepare(),u.default.start(),m.a.sharedInstance().start(),g.a.makeShared().start(),S.a.sharedInstance().startWatching(),f.b.instance.start(),I.b.instance.start(),O.a.sharedInstance().start(),e?(await l.a.init(),await o.a.start()):(s.a.warn("Caller requested only auxiliary services be started"),await o.a.assign()),_.b.runMigrations(),C.a.sharedInstance().start(),_.b.getValue("lowBandwidth")||h.a.start(),x.a.getInstance().start(),p.a.dispatch({action:"client_started"}),ce()&&oe()}async function ue(){var e;p.a.fire(V.a.OnLoggedOut,!0),he(),await me({deleteEverything:!0}),null===(e=T.a.onLoggedOutAndStorageCleared)||void 0===e||e.call(T.a),F.b.get().logout_redirect_url&&(s.a.log("Redirecting to external provider to finish logout"),setTimeout(()=>{window.location.href=F.b.get().logout_redirect_url},100)),re=!1}async function me(e){var t;if(window.localStorage){const t=j.a.instance.getWireInvites(),a=window.localStorage.getItem("mx_registration_time");window.localStorage.clear(),z.a.clear();try{await E.b("account","mx_access_token")}catch(e){s.a.error("idbDelete failed for account:mx_access_token",e)}null!=e&&e.deleteEverything||(t.forEach(e=>{const t=e.roomId;delete e.roomId,j.a.instance.storeInvite(t,e)}),a&&window.localStorage.setItem("mx_registration_time",a))}null===(t=window.sessionStorage)||void 0===t||t.clear();const a=Object(d.a)({baseUrl:""});await l.a.deleteEventIndex(),await a.clearStores()}function he(){var e;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];u.default.stop(),I.b.instance.stop(),m.a.sharedInstance().stop(),W.b.instance.typingStore.reset(),h.a.stop(),f.b.instance.stop(),S.a.sharedInstance().stopWatching(),O.a.sharedInstance().stop(),C.a.sharedInstance().stop(),null===(e=g.a.shared())||void 0===e||e.stop(),l.a.stop();const a=o.a.get();a&&(a.stopClient(),a.removeAllListeners(),t&&(o.a.unset(),l.a.unset()))}window.mxLoginWithAccessToken=async(e,t)=>{const a=Object(n.createClient)({baseUrl:e,accessToken:t}),{user_id:i}=await a.whoami();await ae({homeserverUrl:e,accessToken:t,userId:i},!0)}}).call(this,a(192).setImmediate)},429:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return l}));var n=a(6),i=a.n(n),r=a(107),s=a(1),o=a(266);class c{constructor(e,t,a,n){i()(this,"hsUrl",void 0),i()(this,"isUrl",void 0),i()(this,"fallbackHsUrl",void 0),i()(this,"flows",void 0),i()(this,"defaultDeviceDisplayName",void 0),i()(this,"tempClient",void 0),this.hsUrl=e,this.isUrl=t,this.fallbackHsUrl=a,this.flows=[],this.defaultDeviceDisplayName=n.defaultDeviceDisplayName,this.tempClient=null}getHomeserverUrl(){return this.hsUrl}getIdentityServerUrl(){return this.isUrl}setHomeserverUrl(e){this.tempClient=null,this.hsUrl=e}setIdentityServerUrl(e){this.tempClient=null,this.isUrl=e}createTemporaryClient(){return this.tempClient?this.tempClient:this.tempClient=Object(r.createClient)({baseUrl:this.hsUrl,idBaseUrl:this.isUrl})}async getFlows(){const e=this.createTemporaryClient(),{flows:t}=await e.loginFlows();return this.flows=t,this.flows}loginViaPassword(e,t,a,n){const i=e.indexOf("@")>0;let r;r=t&&a?{type:"m.id.phone",country:t,phone:a,number:a}:i?{type:"m.id.thirdparty",medium:"email",address:e}:{type:"m.id.user",user:e};const o={password:n,identifier:r,initial_device_display_name:this.defaultDeviceDisplayName},c=e=>l(this.fallbackHsUrl,this.isUrl,"m.login.password",o).catch(t=>{throw s.a.log("fallback HS login failed",t),e});let d=null;return l(this.hsUrl,this.isUrl,"m.login.password",o).catch(e=>{if(d=e,403===e.httpStatus&&this.fallbackHsUrl)return c(d);throw d}).catch(e=>{throw s.a.log("Login failed",e),e})}}async function l(e,t,a,n){var i;const c=Object(r.createClient)({baseUrl:e,idBaseUrl:t}),l=await c.login(a,n),d=l.well_known;d&&(d["m.homeserver"]&&d["m.homeserver"].base_url&&(e=d["m.homeserver"].base_url,s.a.log(`Overrode homeserver setting with ${e} from login response`)),d["m.identity_server"]&&d["m.identity_server"].base_url&&(t=d["m.identity_server"].base_url,s.a.log(`Overrode IS setting with ${t} from login response`)));const u={homeserverUrl:e,identityServerUrl:t,userId:l.user_id,deviceId:l.device_id,accessToken:l.access_token};return null===(i=o.a.examineLoginResponse)||void 0===i||i.call(o.a,l,u),u}},430:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(829),c=a(105),l=a(91),d=a(576);function u(e){return e===d.a.Done?a(1405).default:a(833).default}class m extends s.a.Component{constructor(e){super(e),i()(this,"store",void 0),i()(this,"onStoreUpdate",()=>{this.setState({icon:u(this.store.phase)})}),this.store=d.b.sharedInstance(),this.state={icon:u(this.store.phase)}}componentDidMount(){this.store.on("update",this.onStoreUpdate)}componentWillUnmount(){this.store.removeListener("update",this.onStoreUpdate)}render(){return s.a.createElement(c.a,{headerImage:this.state.icon,onFinished:this.props.onFinished,title:Object(l.a)("Verify this session")},s.a.createElement(o.a,{onFinished:this.props.onFinished}))}}},431:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(90),i=a.n(n),r=a(92),s=a(91),o=a(105),c=a(601);class l extends i.a.Component{constructor(e){super(e),this.state={verificationRequest:this.props.verificationRequest},this.props.verificationRequestPromise&&this.props.verificationRequestPromise.then(e=>{this.setState({verificationRequest:e})})}render(){const e=this.state.verificationRequest,t=e&&e.otherUserId,a=this.props.member||t&&r.a.get().getUser(t),n=e&&e.isSelfVerification?Object(s.a)("Verify other device"):Object(s.a)("Verification Request");return i.a.createElement(o.a,{className:"mx_InfoDialog",onFinished:this.props.onFinished,contentId:"mx_Dialog_content",title:n,hasCancel:!0},i.a.createElement(c.a,{layout:"dialog",verificationRequest:this.props.verificationRequest,verificationRequestPromise:this.props.verificationRequestPromise,onClose:this.props.onFinished,member:a,isRoomEncrypted:!1}))}}},432:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(6),i=a.n(n),r=a(114),s=a(7),o=a(119),c=a(95),l=a(171),d=a(94),u=a(125),m=a(106),h=a(98);class p extends l.a{constructor(){super(d.a),i()(this,"waitingRooms",[]),i()(this,"onMyMembership",async e=>{const t=c.b.getValue("breadcrumbs",null,!0);this.meetsRoomRequirement&&Object(s.s)(t)&&await c.b.setValue("breadcrumbs",null,m.a.ACCOUNT,!0)}),i()(this,"onRoom",async e=>{const t=this.waitingRooms.find(t=>t.roomId===e.roomId);t&&(this.waitingRooms.splice(this.waitingRooms.indexOf(t),1),Date.now()-t.addedTs>9e4||await this.appendRoom(e))}),c.b.monitorSetting("breadcrumb_rooms",null),c.b.monitorSetting("breadcrumbs",null),c.b.monitorSetting("feature_breadcrumbs_v2",null)}static get instance(){return p.internalInstance}get rooms(){return this.state.rooms||[]}get visible(){return this.state.enabled&&this.meetsRoomRequirement}get meetsRoomRequirement(){var e;return!!c.b.getValue("feature_breadcrumbs_v2")||(null===(e=this.matrixClient)||void 0===e?void 0:e.getVisibleRooms().length)>=20}async onAction(e){if(this.matrixClient)if(e.action===h.a.SettingUpdated)"breadcrumb_rooms"===e.settingName?await this.updateRooms():"breadcrumbs"!==e.settingName&&"feature_breadcrumbs_v2"!==e.settingName||await this.updateState({enabled:c.b.getValue("breadcrumbs",null)});else if(e.action===h.a.ViewRoom)if(e.auto_join&&!this.matrixClient.getRoom(e.room_id))this.waitingRooms.push({roomId:e.room_id,addedTs:Date.now()});else{const t=this.matrixClient.getRoom(e.room_id),a=null==t?void 0:t.getMyMembership();t&&"join"===a&&await this.appendRoom(t)}else if(e.action===h.a.JoinRoom){const t=this.matrixClient.getRoom(e.roomId);t&&await this.appendRoom(t)}}async onReady(){await this.updateRooms(),await this.updateState({enabled:c.b.getValue("breadcrumbs",null)}),this.matrixClient.on(r.d.MyMembership,this.onMyMembership),this.matrixClient.on(o.b.Room,this.onRoom)}async onNotReady(){this.matrixClient.removeListener(r.d.MyMembership,this.onMyMembership),this.matrixClient.removeListener(o.b.Room,this.onRoom)}async updateRooms(){let e=c.b.getValue("breadcrumb_rooms");e&&0!==e.length||(e=[]);const t=e.map(e=>this.matrixClient.getRoom(e)).filter(e=>!!e),a=this.state.rooms||[];Object(u.d)(t,a)&&await this.updateState({rooms:t})}async appendRoom(e){let t=!1;const a=(this.state.rooms||[]).slice(),n=this.matrixClient.getRoomUpgradeHistory(e.roomId);if(n.length>1){e=n[n.length-1];for(let e=0;e<n.length-1;e++){const i=a.findIndex(t=>t.roomId===n[e].roomId);-1!==i&&(a.splice(i,1),t=!0)}}const i=a.findIndex(t=>t.roomId===e.roomId);if(0!==i&&(-1!==i&&a.splice(i,1),a.splice(0,0,e),t=!0),a.length>20&&(a.splice(20,a.length-20),t=!0),t){await this.updateState({rooms:a});const e=a.map(e=>e.roomId);e.length>0&&await c.b.setValue("breadcrumb_rooms",null,m.a.ACCOUNT,e)}}}i()(p,"internalInstance",(()=>{const e=new p;return e.start(),e})())},433:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return o}));var n=a(1),i=a(213),r=a(16);function s(e){const t=new r.a(e).get("embedded_pages");let a=t?new r.a(t).get("home_url"):null;var s;(a||(a=e.welcomePageUrl,a&&n.a.warn("You are using a deprecated config option: `welcomePageUrl`. Please use `embedded_pages.home_url` instead, per https://github.com/vector-im/element-web/issues/21428")),a)||(a=null===(s=Object(i.d)())||void 0===s?void 0:s.home_url);return a}function o(e){const t=new r.a(e).get("embedded_pages");return!!t&&!0===new r.a(t).get("login_for_welcome")}},434:function(e,t,a){"use strict";let n;a.d(t,"a",(function(){return n})),function(e){e.PersonalMessaging="PersonalMessaging",e.WorkMessaging="WorkMessaging",e.CommunityMessaging="CommunityMessaging",e.Skip="Skip"}(n||(n={}))},435:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(1),c=a(91),l=a(92),d=a(124),u=a(97),m=a(100),h=a(250),p=a(93);class g extends s.a.PureComponent{constructor(e){super(e),i()(this,"onClearCacheAndReload",()=>{d.a.get()&&(l.a.get().stopClient(),l.a.get().store.deleteAllData().then(()=>{d.a.get().reload()}))}),i()(this,"onBugReport",()=>{u.a.createDialog(h.a,{label:"react-soft-crash",error:this.state.error})}),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){let{componentStack:a}=t;o.a.error(e),o.a.error("The above error occurred while React was rendering the following components:",a)}render(){if(this.state.error){const e="https://github.com/vector-im/element-web/issues/new/choose";let t,a;return m.b.get().bug_report_endpoint_url&&(t=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(c.a)("Please <newIssueLink>create a new issue</newIssueLink> on GitHub so that we can investigate this bug.",{},{newIssueLink:t=>s.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:e},t)})),s.a.createElement("p",null,Object(c.a)("If you've submitted a bug via GitHub, debug logs can help us track down the problem. "),Object(c.a)("Debug logs contain application usage data including your username, the IDs or aliases of the rooms you have visited, which UI elements you last interacted with, and the usernames of other users. They do not contain messages.")),s.a.createElement(p.a,{onClick:this.onBugReport,kind:"primary"},Object(c.a)("Submit debug logs")))),l.a.get()&&(a=s.a.createElement(p.a,{onClick:this.onClearCacheAndReload,kind:"danger"},Object(c.a)("Clear cache and reload"))),s.a.createElement("div",{className:"mx_ErrorBoundary"},s.a.createElement("div",{className:"mx_ErrorBoundary_body"},s.a.createElement("h1",null,Object(c.a)("Something went wrong!")),t,a))}return this.props.children}}},436:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(108),c=a(91),l=a(169),d=a(295);class u extends r.PureComponent{constructor(){super(...arguments),i()(this,"validate",Object(l.a)({rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(c.a)(this.props.labelRequired)},{key:"email",test:e=>{let{value:t}=e;return!t||d.a(t)},invalid:()=>Object(c.a)(this.props.labelInvalid)}]})),i()(this,"onValidate",async e=>{let t=this.validate;this.props.validationRules&&(t=this.props.validationRules);const a=await t(e);return this.props.onValidate&&this.props.onValidate(a),a})}render(){return s.a.createElement(o.a,{id:this.props.id,ref:this.props.fieldRef,type:"text",label:Object(c.a)(this.props.label),value:this.props.value,autoFocus:this.props.autoFocus,onChange:this.props.onChange,onValidate:this.onValidate})}}i()(u,"defaultProps",{label:Object(c.c)("Email"),labelRequired:Object(c.c)("Enter email address"),labelInvalid:Object(c.c)("Doesn't look like a valid email address")}),t.a=u},437:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(90),i=a.n(n),r=a(1504),s=a(874);class o extends i.a.Component{render(){return i.a.createElement("div",{className:"mx_AuthHeader"},i.a.createElement(r.a,null),i.a.createElement(s.a,{disabled:this.props.disableLanguageSelector}))}}},438:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(96),i=a.n(n),r=a(90),s=a.n(r);function o(e){let{flex:t,children:a}=e;return s.a.createElement("main",{className:i()("mx_AuthBody",{mx_AuthBody_flex:t})},a)}},445:function(e,t,a){"use strict";a.d(t,"b",(function(){return it})),a.d(t,"a",(function(){return rt}));var n=a(90),i=a.n(n),r=a(107),s=a(92),o=a(111);var c=a(142),l=a(1),d=a(243),u=a(133);function m(e,t){const[a,i]=Object(n.useState)(e),o=s.a.get(),c=function(e){const t=Object(n.useRef)(e);return t.current=e,Object(n.useCallback)((function(){return t.current(...arguments)}),[])}(t);return Object(n.useEffect)(()=>{if(a)return;let e=null,t=!0;const n=async()=>{null!==e&&(clearTimeout(e),e=null),i(await c(o)),t&&(e=setTimeout(n,5e3))};return n().catch(e=>l.a.warn("could not update user onboarding context",e)),o.on(r.ClientEvent.AccountData,n),()=>{t=!1,o.off(r.ClientEvent.AccountData,n),null!==e&&(clearTimeout(e),e=null)}},[o,c,a]),a}var h,p,g,v,f,b,y,E,_,w,S,O,C,x,k,j,R,I,T,N,D,P,M,A,L,U,F;function B(){return(B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function V(e){return n.createElement("svg",B({viewBox:"0 0 564 168",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),h||(h=n.createElement("defs",null,n.createElement("radialGradient",{id:"f-droid_svg__a",cx:113,cy:-12.89,r:59.662,gradientTransform:"matrix(0 1.9611 -1.9778 0 5.51 -198.6)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#fff",stopOpacity:.098,offset:0}),n.createElement("stop",{stopColor:"#fff",stopOpacity:0,offset:1})))),p||(p=n.createElement("path",{d:"M22 2h520c11.08 0 20 8.92 20 20v124c0 11.08-8.92 20-20 20H22c-11.08 0-20-8.92-20-20V22C2 10.92 10.92 2 22 2z",stroke:"#a6a6a6",strokeWidth:4})),g||(g=n.createElement("path",{d:"M199.26 45.46v-6.682h-5.499v-2.766h8.831v10.681q-1.949 1.383-4.299 2.1-2.349.7-5.015.7-5.832 0-9.131-3.4-3.283-3.415-3.283-9.497 0-6.099 3.283-9.498 3.3-3.416 9.131-3.416 2.433 0 4.616.6 2.2.6 4.049 1.766v3.583q-1.867-1.583-3.966-2.383-2.1-.8-4.416-.8-4.565 0-6.865 2.55-2.283 2.549-2.283 7.598 0 5.032 2.283 7.581 2.3 2.55 6.865 2.55 1.783 0 3.183-.3 1.4-.317 2.516-.967zm9.48-21.33h15.729v2.833h-12.364v7.365h11.847v2.832h-11.847v9.015h12.664v2.832H208.74zm18.12 0h21.045v2.833h-8.831v22.045h-3.383V26.963h-8.83zm35.14 0h3.366v24.877H262zm6.61 0h21.045v2.833h-8.831v22.045h-3.383V26.963h-8.83zm45.24 2.28q-3.666 0-5.832 2.733-2.15 2.732-2.15 7.448 0 4.699 2.15 7.431 2.166 2.733 5.832 2.733t5.799-2.733q2.15-2.732 2.15-7.431 0-4.716-2.15-7.448-2.133-2.733-5.799-2.733zm0-2.733q5.232 0 8.365 3.516 3.132 3.5 3.132 9.398 0 5.882-3.132 9.397-3.133 3.5-8.365 3.5-5.249 0-8.398-3.5-3.132-3.499-3.132-9.397t3.132-9.398q3.15-3.516 8.398-3.516zm16.76.453h4.532l11.031 20.812V24.13h3.266v24.877h-4.532l-11.031-20.812v20.812h-3.266z",fill:"#fff","aria-label":"GET IT ON"})),v||(v=n.createElement("path",{d:"M180.81 136v-8.118l7.19-1.391V78.017l-7.19-1.392v-8.164h53.762v18.508h-10.391l-.603-8.071h-22.034v18.6h23.657v10.438h-23.657v18.555l7.236 1.391V136zm62.16-23.66v-10.437h26.162v10.437zM277.29 136v-8.118l7.283-1.53v-48.15l-7.283-1.577v-8.164h29.641q9.045 0 15.957 4.268 6.912 4.221 10.762 11.736 3.897 7.468 3.897 17.163v1.252q0 9.602-3.85 17.117-3.804 7.468-10.67 11.736-6.865 4.268-15.91 4.268zm20.828-10.344h8.303q5.613 0 9.51-2.922 3.896-2.97 5.937-8.118 2.087-5.149 2.087-11.736v-1.299q0-6.68-2.087-11.782-2.041-5.149-5.938-8.025-3.896-2.922-9.509-2.922h-8.303zM344.79 136v-8.118l6.494-1.391V95.366l-7.19-1.392V85.81h19.807l.51 6.216.093 1.113q1.856-4.082 4.593-6.17 2.736-2.087 6.54-2.087 1.206 0 2.644.232 1.438.186 2.551.51l-1.438 12.478-6.726-.37q-2.876-.14-4.685.974-1.763 1.113-3.154 3.2v24.585l6.494 1.392V136zm63.08.98q-7.422 0-12.756-3.247t-8.164-9q-2.83-5.797-2.83-13.312v-.974q0-7.469 2.83-13.22 2.83-5.799 8.118-9.046 5.334-3.293 12.71-3.293 7.468 0 12.756 3.293 5.288 3.247 8.117 9t2.83 13.266v.974q0 7.515-2.83 13.313-2.83 5.752-8.117 9-5.289 3.247-12.664 3.247zm0-10.391q3.525 0 5.752-1.902t3.293-5.288q1.067-3.433 1.067-7.979v-.974q0-4.453-1.067-7.839-1.066-3.433-3.34-5.335-2.226-1.948-5.798-1.948-3.479 0-5.752 1.948-2.273 1.902-3.34 5.335-1.02 3.386-1.02 7.84v.973q0 4.546 1.02 7.979 1.067 3.433 3.34 5.334 2.273 1.856 5.845 1.856zM437.1 136v-8.118l6.54-1.391V95.366l-7.236-1.392V85.81h20.781v40.681l6.494 1.392V136zm6.077-60.813v-11.55h14.009v11.55zm44.293 61.793q-5.984 0-10.298-3.062-4.268-3.107-6.54-8.627-2.273-5.567-2.273-12.988v-.975q0-7.932 2.273-13.87 2.319-5.937 6.586-9.23 4.268-3.34 10.205-3.34 4.129 0 7.237 1.67 3.108 1.623 5.38 4.638V73.198l-7.236-1.391v-8.164h20.781v62.854l6.494 1.391v8.118h-18.23l-1.02-6.123q-2.366 3.479-5.66 5.288-3.246 1.81-7.7 1.81zm4.036-10.53q2.83 0 4.963-1.206 2.134-1.206 3.572-3.479v-21.292q-1.392-2.412-3.526-3.71-2.133-1.346-4.917-1.346-3.386 0-5.566 2.04-2.134 1.995-3.154 5.567-.974 3.572-.974 8.303v.975q0 6.587 2.226 10.39 2.227 3.758 7.376 3.758z",fill:"#fff","aria-label":"F-Droid"})),f||(f=n.createElement("path",{d:"M146.34 25.898l-11.184 14.474",fill:"#8ab000",stroke:"#769616",strokeLinecap:"round",strokeWidth:6.579})),b||(b=n.createElement("path",{d:"M146.29 22.477c1.192.032 2.003.497 2.579 1.182-5.332 6.34-6.232 7.344-13.513 16.37-2.684 3.472-5.479 1.677-2.795-1.794l11.184-14.474a3.26 3.26 0 012.545-1.284z",color:"#000",fill:"#fff",fillOpacity:.298})),y||(y=n.createElement("path",{d:"M148.89 23.793a3.29 3.29 0 01.058 4.095l-11.184 14.474c-2.684 3.474-3.026-1.61-3.026-1.61s9.829-11.87 14.153-16.959z",color:"#000",fill:"#263238",fillOpacity:.2})),E||(E=n.createElement("path",{d:"M147 23.003c1.153 0 2.526.374 2.168 2.103-.27 1.318-12.263 15.984-12.263 15.984-2.684 3.47-6.563 1.779-3.879-1.693l11.142-14.4c.685-.763 1.603-1.957 2.832-1.994z",color:"#000",fill:"#8ab000"})),_||(_=n.createElement("path",{d:"M33.653 25.898l11.184 14.474",fill:"#8ab000",stroke:"#769616",strokeLinecap:"round",strokeWidth:6.579})),w||(w=n.createElement("path",{d:"M33.711 22.477c-1.192.032-2.003.497-2.579 1.182 5.332 6.34 6.232 7.344 13.513 16.37 2.684 3.472 5.479 1.677 2.795-1.794L36.256 23.76a3.26 3.26 0 00-2.545-1.284z",color:"#000",fill:"#fff",fillOpacity:.298})),S||(S=n.createElement("path",{d:"M31.108 23.793a3.29 3.29 0 00-.058 4.095l11.184 14.474c2.684 3.474 3.026-1.61 3.026-1.61s-9.829-11.87-14.153-16.959z",color:"#000",fill:"#263238",fillOpacity:.2})),O||(O=n.createElement("path",{d:"M32.993 23.003c-1.153 0-2.526.374-2.168 2.103.27 1.318 12.263 15.984 12.263 15.984 2.684 3.47 6.563 1.779 3.879-1.693l-11.142-14.4c-.685-.763-1.603-1.957-2.832-1.994z",color:"#000",fill:"#8ab000"})),C||(C=n.createElement("path",{d:"M47.893 35.109h84.211a7.878 7.878 0 017.895 7.894v18.211a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895v-18.21a7.878 7.878 0 017.895-7.895z",fill:"#aeea00"})),x||(x=n.createElement("path",{d:"M47.893 42.74h84.211a7.878 7.878 0 017.895 7.895v10.526a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V50.635a7.878 7.878 0 017.895-7.895z",fill:"#263238",fillOpacity:.2})),k||(k=n.createElement("path",{d:"M47.893 35.109h84.211a7.878 7.878 0 017.895 7.894V53.53a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V43.003a7.878 7.878 0 017.895-7.894z",fill:"#fff",fillOpacity:.298})),j||(j=n.createElement("path",{d:"M47.893 38.003h84.211c4.374 0 7.895 2.883 7.895 6.462v15.079c0 3.58-3.521 6.462-7.895 6.462H47.893c-4.374 0-7.895-2.882-7.895-6.462V44.465c0-3.58 3.521-6.462 7.895-6.462z",fill:"#aeea00"})),R||(R=n.createElement("path",{d:"M47.893 71.944h84.211a7.878 7.878 0 017.895 7.895v52.211a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V79.839a7.878 7.878 0 017.895-7.895z",fill:"#1976d2"})),I||(I=n.createElement("path",{d:"M47.893 105.89h84.211a7.878 7.878 0 017.895 7.895v18.42a7.878 7.878 0 01-7.895 7.896H47.893a7.878 7.878 0 01-7.895-7.895v-18.421a7.878 7.878 0 017.895-7.895z",fill:"#263238",fillOpacity:.2})),T||(T=n.createElement("path",{d:"M47.893 71.681h84.211a7.878 7.878 0 017.895 7.895v18.421a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V79.576a7.878 7.878 0 017.895-7.895z",fill:"#fff",fillOpacity:.2})),N||(N=n.createElement("path",{d:"M47.893 75.102h84.211c4.374 0 7.895 3.19 7.895 7.154v47.693c0 3.963-3.521 7.153-7.895 7.153H47.893c-4.374 0-7.895-3.19-7.895-7.153V82.256c0-3.963 3.521-7.154 7.895-7.154z",fill:"#1976d2"})),D||(D=n.createElement("path",{d:"M89.998 89.714c-7.579 0-14 5.224-15.876 12.237h8.455a8.46 8.46 0 017.421-4.342 8.495 8.495 0 018.553 8.553 8.495 8.495 0 01-8.553 8.552 8.471 8.471 0 01-7.71-4.868h-8.3c1.69 7.279 8.242 12.763 16.01 12.763 9.038 0 16.449-7.41 16.449-16.448 0-9.037-7.41-16.448-16.448-16.448z",color:"#000",fill:"#0d47a1"})),P||(P=n.createElement("path",{d:"M115.13 106.16a25.132 25.132 0 01-25.132 25.132 25.132 25.132 0 01-25.131-25.132 25.132 25.132 0 0125.131-25.132 25.132 25.132 0 0125.132 25.132z",fill:"none",stroke:"#0d47a1",strokeLinecap:"round",strokeWidth:5})),M||(M=n.createElement("path",{d:"M73.55 52.477a8.882 10.197 0 01-8.88 10.198 8.882 10.197 0 01-8.882-10.198 8.882 10.197 0 018.881-10.197 8.882 10.197 0 018.882 10.197z",fill:"#263238",fillOpacity:.2})),A||(A=n.createElement("path",{d:"M73.55 53.793a8.882 8.882 0 01-8.88 8.882 8.882 8.882 0 01-8.882-8.882 8.882 8.882 0 018.881-8.882 8.882 8.882 0 018.882 8.882z",fill:"#fff"})),L||(L=n.createElement("path",{d:"M124.87 52.477a8.882 10.197 0 01-8.882 10.198 8.882 10.197 0 01-8.881-10.198 8.882 10.197 0 018.881-10.197 8.882 10.197 0 018.882 10.197z",fill:"#263238",fillOpacity:.2})),U||(U=n.createElement("path",{d:"M124.87 53.793a8.882 8.882 0 01-8.882 8.882 8.882 8.882 0 01-8.881-8.882 8.882 8.882 0 018.881-8.882 8.882 8.882 0 018.882 8.882z",fill:"#fff"})),F||(F=n.createElement("path",{d:"M33.71 22.47a3.29 3.29 0 00-2.662 5.336l9.474 12.262a7.894 7.894 0 00-.527 2.824v18.211a7.877 7.877 0 007.895 7.895h84.21a7.877 7.877 0 007.895-7.895v-18.21c0-1-.19-1.95-.525-2.827l9.472-12.26a3.29 3.29 0 00-2.433-5.334 3.29 3.29 0 00-2.772 1.31l-9.013 11.666a7.91 7.91 0 00-2.623-.45H47.89c-.922 0-1.8.163-2.621.45l-9.016-11.666a3.29 3.29 0 00-2.543-1.312zm14.18 49.527a7.877 7.877 0 00-7.894 7.894v52.211a7.877 7.877 0 007.894 7.895h84.211a7.877 7.877 0 007.894-7.895v-52.21a7.877 7.877 0 00-7.894-7.895z",color:"#000",fill:"url(#f-droid_svg__a)",fillRule:"evenodd"})))}var z,W,H,G,q,K,Y,J,$,Q,X,Z,ee,te,ae,ne,ie,re,se,oe,ce,le;function de(){return(de=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ue(e){return n.createElement("svg",de({viewBox:"0 0 180 53.332",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),z||(z=n.createElement("defs",null,n.createElement("linearGradient",{id:"google-play_svg__a",x2:1,gradientTransform:"scale(-31.64 31.64) rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#00a0ff",offset:0}),n.createElement("stop",{stopColor:"#00a1ff",offset:.007}),n.createElement("stop",{stopColor:"#00beff",offset:.26}),n.createElement("stop",{stopColor:"#00d2ff",offset:.512}),n.createElement("stop",{stopColor:"#00dfff",offset:.76}),n.createElement("stop",{stopColor:"#00e3ff",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__b",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#ffe000",offset:0}),n.createElement("stop",{stopColor:"#ffbd00",offset:.409}),n.createElement("stop",{stopColor:"orange",offset:.775}),n.createElement("stop",{stopColor:"#ff9c00",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__c",x2:1,gradientTransform:"scale(-42.903 42.903) rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#ff3a44",offset:0}),n.createElement("stop",{stopColor:"#c31162",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__d",x2:1,gradientTransform:"scale(19.156 -19.156) rotate(-44.998 .238 -.62)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#32a071",offset:0}),n.createElement("stop",{stopColor:"#2da771",offset:.069}),n.createElement("stop",{stopColor:"#15cf74",offset:.476}),n.createElement("stop",{stopColor:"#06e775",offset:.801}),n.createElement("stop",{stopColor:"#00f076",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__e",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#ccb300",offset:0}),n.createElement("stop",{stopColor:"#cc9700",offset:.409}),n.createElement("stop",{stopColor:"#cc8400",offset:.775}),n.createElement("stop",{stopColor:"#cc7d00",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__f",x2:1,gradientTransform:"scale(-42.903 42.903) rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#cc2e36",offset:0}),n.createElement("stop",{stopColor:"#9c0e4e",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__g",x2:1,gradientTransform:"scale(-31.64 31.64) rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#008de0",offset:0}),n.createElement("stop",{stopColor:"#008de0",offset:.007}),n.createElement("stop",{stopColor:"#00a7e0",offset:.26}),n.createElement("stop",{stopColor:"#00b8e0",offset:.512}),n.createElement("stop",{stopColor:"#00c4e0",offset:.76}),n.createElement("stop",{stopColor:"#00c7e0",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__h",x2:1,gradientTransform:"scale(-42.903 42.903) rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#e0333c",offset:0}),n.createElement("stop",{stopColor:"#ab0f56",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__i",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#e0c500",offset:0}),n.createElement("stop",{stopColor:"#e0a600",offset:.409}),n.createElement("stop",{stopColor:"#e09100",offset:.775}),n.createElement("stop",{stopColor:"#e08900",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__j",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#ffe840",offset:0}),n.createElement("stop",{stopColor:"#ffce40",offset:.409}),n.createElement("stop",{stopColor:"#ffbc40",offset:.775}),n.createElement("stop",{stopColor:"#ffb540",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__k",x2:1,gradientTransform:"scale(-31.64 31.64) rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#40b8ff",offset:0}),n.createElement("stop",{stopColor:"#40b9ff",offset:.007}),n.createElement("stop",{stopColor:"#40ceff",offset:.26}),n.createElement("stop",{stopColor:"#40ddff",offset:.512}),n.createElement("stop",{stopColor:"#40e7ff",offset:.76}),n.createElement("stop",{stopColor:"#40eaff",offset:1})),n.createElement("linearGradient",{id:"google-play_svg__l",x2:1,gradientTransform:"scale(19.156 -19.156) rotate(-44.998 .238 -.62)",gradientUnits:"userSpaceOnUse"},n.createElement("stop",{stopColor:"#65b895",offset:0}),n.createElement("stop",{stopColor:"#62bd95",offset:.069}),n.createElement("stop",{stopColor:"#50db97",offset:.476}),n.createElement("stop",{stopColor:"#44ed98",offset:.801}),n.createElement("stop",{stopColor:"#40f498",offset:1})))),W||(W=n.createElement("path",{d:"M173.33 53.332H6.67c-3.667 0-6.667-3-6.667-6.667V6.668c0-3.667 3-6.667 6.667-6.667h166.66c3.667 0 6.667 3 6.667 6.667v39.997c0 3.666-3 6.666-6.667 6.666"})),H||(H=n.createElement("path",{d:"M101.93 17.465v-5.118l-.044-1.544-.202.074 4.107 6.588h1.28V9.199h-1.295v4.816l.044 1.544.202-.074-3.927-6.286h-1.458v8.266",fill:"#fff"})),G||(G=n.createElement("path",{d:"M173.33 0H6.67C3.003 0 .003 3 .003 6.666v40c0 3.666 3 6.666 6.667 6.666h166.66c3.667 0 6.667-3 6.667-6.667V6.668c0-3.667-3-6.667-6.667-6.667m0 1.067c3.088 0 5.6 2.512 5.6 5.6v39.997c0 3.087-2.512 5.6-5.6 5.6H6.67a5.607 5.607 0 01-5.6-5.6v-40c0-3.087 2.512-5.6 5.6-5.6h166.66",fill:"#a6a6a6"})),q||(q=n.createElement("path",{d:"M63.356 13.657c0-.203-.02-.41-.058-.628l-.02-.11h-4.121v1.229h3.038v-.134l-.133-.011c-.058.67-.272 1.176-.632 1.537-.573.571-1.276.853-2.14.854-.81 0-1.499-.28-2.092-.85-.587-.568-.88-1.294-.881-2.212.001-.917.294-1.643.881-2.21.593-.571 1.281-.85 2.092-.851.902.002 1.582.3 2.088.901l.094.112.806-.807.086-.087-.079-.093c-.327-.39-.764-.7-1.3-.93a4.259 4.259 0 00-1.695-.347c-1.185-.001-2.208.416-3.038 1.24-.833.823-1.252 1.857-1.251 3.072-.001 1.215.418 2.25 1.252 3.073.829.824 1.852 1.24 3.037 1.24 1.234 0 2.258-.41 3.036-1.226l-.003.002c.691-.69 1.034-1.622 1.033-2.764M69.502 9.2h-4.937v8.265h4.937v-1.25h-3.643v-2.27h3.286v-1.227h-3.286v-2.27h3.643m4.335 0h2.234v-1.25h-5.764v1.25h2.235v7.017h1.295m7.239 0V9.199h-1.294v8.266m5.853-7.017h2.235v-1.25h-5.764v1.25h2.234v7.017h1.295m6.652-4.132c0-.903.284-1.627.85-2.203.57-.575 1.252-.858 2.078-.86.825.002 1.509.285 2.078.86.566.576.85 1.3.85 2.203s-.284 1.627-.85 2.202c-.57.576-1.253.858-2.078.86-.826-.002-1.508-.284-2.076-.86s-.852-1.3-.852-2.202zm5.957 3.058c.808-.83 1.217-1.86 1.216-3.058 0-1.193-.41-2.22-1.221-3.054-.813-.837-1.83-1.26-3.024-1.259-1.2-.001-2.221.42-3.028 1.254-.81.83-1.217 1.86-1.216 3.059-.001 1.199.406 2.228 1.214 3.06s1.83 1.253 3.03 1.251c1.2.002 2.22-.419 3.029-1.253m-7.387 12.612c-3.136 0-5.693 2.384-5.693 5.67 0 3.266 2.557 5.67 5.693 5.67s5.691-2.405 5.691-5.67c0-3.287-2.555-5.67-5.691-5.67zm0 2.232c1.719 0 3.2 1.397 3.2 3.438 0 2.019-1.481 3.435-3.2 3.435-1.718 0-3.201-1.416-3.201-3.435 0-2.041 1.483-3.438 3.201-3.438zm-12.422-2.232c-3.136 0-5.693 2.384-5.693 5.67 0 3.266 2.557 5.67 5.693 5.67s5.693-2.405 5.693-5.67c0-3.287-2.557-5.67-5.693-5.67zm0 2.232c1.718 0 3.201 1.397 3.201 3.438 0 2.019-1.483 3.435-3.201 3.435-1.719 0-3.2-1.416-3.2-3.435 0-2.041 1.481-3.438 3.2-3.438zm-14.772-.494v2.407h5.757c-.172 1.353-.623 2.34-1.31 3.028-.838.838-2.148 1.762-4.447 1.762-3.544 0-6.315-2.857-6.315-6.401s2.771-6.402 6.315-6.402c1.912 0 3.308.752 4.34 1.719l1.696-1.697c-1.439-1.375-3.35-2.427-6.036-2.427-4.854 0-8.935 3.952-8.935 8.807s4.08 8.806 8.935 8.806c2.621 0 4.597-.859 6.143-2.47 1.59-1.59 2.084-3.823 2.084-5.627 0-.56-.043-1.074-.129-1.504zm55.554-1.74c-2.921 0-5.348 2.3-5.348 5.672 0 3.179 2.405 5.67 5.627 5.67 2.6 0 4.105-1.59 4.727-2.514l-1.934-1.287c-.644.946-1.525 1.566-2.793 1.566-1.267 0-2.17-.578-2.75-1.716l7.582-3.137-.256-.645c-.472-1.268-1.912-3.609-4.855-3.609zm.086 2.191c.989 0 1.826.495 2.105 1.203l-5.068 2.106c-.065-2.191 1.696-3.309 2.963-3.309zm-9.126 8.807h2.493V23.332h-2.492zm-7.15-10.996c-2.835 0-5.434 2.49-5.434 5.691 0 3.18 2.599 5.65 5.434 5.65 1.353 0 2.428-.602 2.986-1.29h.086v.816c0 2.17-1.16 3.33-3.03 3.33-1.524 0-2.47-1.095-2.856-2.02l-2.17.903c.624 1.504 2.278 3.352 5.027 3.352 2.921 0 5.39-1.72 5.39-5.908v-10.18h-2.36v.921h-.087c-.558-.666-1.633-1.265-2.986-1.265zm.215 2.232c1.697 0 3.03 1.461 3.03 3.46 0 1.975-1.333 3.414-3.03 3.414-1.72 0-3.158-1.439-3.158-3.415 0-1.997 1.44-3.459 3.158-3.459zm26.545-7.904v16.668h2.486v-6.315h3.475c2.758 0 5.469-1.997 5.469-5.177s-2.711-5.176-5.47-5.176zm2.486 2.32h3.54c1.86 0 2.915 1.54 2.915 2.858 0 1.29-1.056 2.855-2.916 2.855h-3.539zm18.914 3.321c-1.8 0-3.667.792-4.44 2.55l2.21.923c.472-.922 1.349-1.223 2.273-1.223 1.286 0 2.594.773 2.615 2.144v.172c-.45-.257-1.414-.642-2.594-.642-2.38 0-4.804 1.308-4.804 3.752 0 2.23 1.951 3.668 4.138 3.668 1.673 0 2.596-.751 3.176-1.631h.084v1.287h2.402v-6.39c0-2.96-2.208-4.61-5.06-4.61zm.385 5.938c1.095 0 1.608.236 2.273.558-.193 1.544-1.52 2.639-2.957 2.639l-.002-.002c-.815 0-1.951-.405-1.951-1.414 0-1.286 1.416-1.781 2.637-1.781zm13.415-5.575l-2.852 7.227h-.085l-2.96-7.227h-2.68l4.438 10.1-2.53 5.619h2.596l6.84-15.719zm-22.4 10.664h2.488V23.331h-2.488z",fill:"#fff"})),K||(K=n.createElement("path",{d:"M14.007 43.191l-.099-.095c-.388-.41-.617-1.047-.617-1.873v.194V11.93v.203c0-.894.267-1.567.714-1.97l16.516 16.515-16.515 16.515m-.71-31.48v-.004.003m0-.01",fill:"url(#google-play_svg__a)"})),Y||(Y=n.createElement("path",{d:"M36.025 32.378l.126-.071 6.522-3.706c.622-.354 1.036-.782 1.243-1.236-.206.454-.621.883-1.243 1.236l-6.522 3.706-.126.071m.002-.195l-5.506-5.507 5.505-5.506 6.647 3.776c.844.48 1.318 1.098 1.397 1.73v.002c-.08.63-.553 1.248-1.397 1.728l-6.646 3.777",fill:"url(#google-play_svg__b)"})),J||(J=n.createElement("path",{d:"M15.184 43.819a1.723 1.723 0 00.002 0 2.515 2.515 0 00-.002 0m0-.195c-.46 0-.863-.15-1.177-.433l16.515-16.516 5.506 5.507L16.68 43.176c-.536.304-1.043.447-1.494.447m-1.182-.241a1.814 1.814 0 01-.086-.084l.086.084",fill:"url(#google-play_svg__c)"})),$||($=n.createElement("path",{d:"M30.52 26.676L14.004 10.16a1.716 1.716 0 011.177-.433c.452 0 .96.145 1.496.449L36.025 21.17l-5.506 5.506m5.63-5.63L16.677 9.98c-.536-.304-1.044-.448-1.496-.448h-.005.007c.451 0 .959.144 1.494.448L36.15 21.045",fill:"url(#google-play_svg__d)"})),Q||(Q=n.createElement("path",{d:"M15.313 43.811c.42-.024.883-.168 1.371-.445l19.353-10.995-19.353 10.994c-.487.277-.952.42-1.371.445m-1.301-.43l-.004-.004a.038.038 0 01.004.004m-.09-.088l-.009-.008c.004.002.006.006.009.008"})),X||(X=n.createElement("path",{d:"M36.025 32.378l.126-.071-.126.071",fill:"url(#google-play_svg__e)"})),Z||(Z=n.createElement("path",{d:"M15.185 43.819c-.461 0-.864-.15-1.178-.434a.038.038 0 00-.005-.003l-.086-.084-.008-.008.099-.1c.314.284.716.434 1.177.434.451 0 .958-.144 1.494-.448l19.348-10.994.124.124-.126.072L16.677 43.37c-.488.276-.952.42-1.37.444a2.515 2.515 0 01-.123.004",fill:"url(#google-play_svg__f)"})),ee||(ee=n.createElement("path",{d:"M13.914 43.285c-.388-.411-.617-1.049-.617-1.874 0 .825.23 1.462.617 1.873"})),te||(te=n.createElement("path",{d:"M13.908 43.29c-.388-.41-.617-1.047-.617-1.873v-.194c0 .825.23 1.462.617 1.873l.099.095-.099.099",fill:"url(#google-play_svg__g)"})),ae||(ae=n.createElement("path",{d:"M13.908 43.29l.099-.1v.001l-.099.099",fill:"url(#google-play_svg__h)"})),ne||(ne=n.createElement("path",{d:"M36.151 32.307l-.124-.124 6.646-3.777c.844-.48 1.318-1.098 1.397-1.728 0 .231-.051.463-.154.688-.207.453-.62.882-1.243 1.235l-6.522 3.706",fill:"url(#google-play_svg__i)"})),ie||(ie=n.createElement("path",{d:"M44.083 26.667c0-.698-.467-1.395-1.398-1.924l-6.523-3.707 6.523 3.706c.932.53 1.399 1.228 1.398 1.925",fill:"#404040"})),re||(re=n.createElement("path",{d:"M44.07 26.675c-.08-.632-.553-1.25-1.397-1.73l-6.647-3.775.124-.124 6.523 3.706c.93.529 1.397 1.226 1.397 1.923",fill:"url(#google-play_svg__j)"})),se||(se=n.createElement("path",{d:"M13.297 11.917v-.002.002m.006-.217v-.003.003m0-.006v-.006.006m0-.008c.077-1.37.822-2.16 1.876-2.165a1.715 1.715 0 00-1.166.433l-.004.003c-.033.03-.064.061-.095.093-.35.37-.57.925-.61 1.636",fill:"#404040"})),oe||(oe=n.createElement("path",{d:"M13.291 12.132v-.204c0-.073.002-.145.006-.215V11.7c.04-.71.261-1.265.61-1.635l.098.097c-.447.404-.714 1.077-.714 1.97m.712-2.16l.003-.004-.003.003",fill:"url(#google-play_svg__k)"})),ce||(ce=n.createElement("path",{d:"M15.178 9.521h.004-.004",fill:"#404040"})),le||(le=n.createElement("path",{d:"M36.025 21.17L16.677 10.176c-.536-.304-1.044-.448-1.496-.448-.46 0-.863.15-1.177.432l-.097-.097a1.78 1.78 0 01.095-.094l.003-.003c.312-.28.71-.43 1.166-.433h.01c.452 0 .96.144 1.496.448l19.472 11.064-.125.125",fill:"url(#google-play_svg__l)"})))}var me,he,pe;function ge(){return(ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ve(e){return n.createElement("svg",ge({viewBox:"0 0 159.55 53.333",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),me||(me=n.createElement("path",{d:"M146.84.001H12.71c-.489 0-.972 0-1.46.003-.407.002-.812.01-1.224.016-.888.023-1.786.077-2.672.236a8.876 8.876 0 00-2.535.836A8.58 8.58 0 001.09 4.825a8.782 8.782 0 00-.833 2.538c-.16.883-.216 1.776-.24 2.669-.012.409-.013.82-.02 1.228v30.818c.007.414.008.815.02 1.23.024.893.08 1.786.24 2.669.155.893.418 1.73.833 2.539a8.28 8.28 0 001.571 2.152 8.356 8.356 0 002.158 1.571 8.95 8.95 0 002.535.842c.886.158 1.784.21 2.672.235.412.01.817.015 1.225.015.488.002.97.002 1.46.002h134.13c.48 0 .966 0 1.445-.002.408 0 .824-.006 1.23-.015.894-.025 1.79-.077 2.667-.235a9.083 9.083 0 002.544-.842 8.417 8.417 0 002.157-1.57 8.556 8.556 0 001.573-2.153c.41-.809.676-1.646.826-2.54.165-.882.216-1.775.249-2.669.004-.414.004-.815.004-1.229.01-.484.01-.966.01-1.458V12.715c0-.488 0-.972-.01-1.455 0-.409 0-.82-.004-1.228-.033-.893-.084-1.786-.25-2.67a8.763 8.763 0 00-.825-2.537 8.626 8.626 0 00-1.573-2.162 8.641 8.641 0 00-2.157-1.57 9.02 9.02 0 00-2.544-.837c-.877-.159-1.773-.213-2.667-.236-.406-.006-.822-.014-1.23-.016C147.807 0 147.322 0 146.84 0",fill:"#b2b1b1"})),he||(he=n.createElement("path",{d:"M11.267 52.166c-.407 0-.803-.005-1.206-.014-.745-.021-1.63-.062-2.492-.217a7.847 7.847 0 01-2.21-.731 7.214 7.214 0 01-1.862-1.355 7.092 7.092 0 01-1.36-1.862 7.616 7.616 0 01-.724-2.21c-.163-.897-.205-1.807-.222-2.5-.01-.28-.02-1.217-.02-1.217v-30.8s.012-.922.02-1.193c.017-.698.059-1.607.22-2.495.143-.818.38-1.54.725-2.216.354-.7.808-1.325 1.353-1.864a7.423 7.423 0 011.87-1.363 7.762 7.762 0 012.204-.726c.898-.16 1.808-.2 2.5-.219l1.204-.016h137.02l1.217.017c.684.017 1.595.057 2.48.217.802.14 1.53.38 2.227.73.684.35 1.31.808 1.855 1.354a7.38 7.38 0 011.365 1.873c.344.681.577 1.403.715 2.198.153.841.2 1.705.23 2.517.004.377.004.783.004 1.187.012.5.012.975.012 1.455V40.62c0 .485 0 .957-.012 1.434 0 .434 0 .831-.005 1.24-.028.785-.076 1.648-.228 2.47a7.664 7.664 0 01-.72 2.228 7.297 7.297 0 01-1.353 1.847 7.268 7.268 0 01-1.866 1.363 7.855 7.855 0 01-2.225.733c-.853.155-1.737.197-2.492.218-.39.009-.8.014-1.197.014l-1.445.003-135.58-.003",fill:"#040403"})),pe||(pe=n.createElement("path",{d:"M33.032 27.068c-.034-3.668 3.002-5.452 3.141-5.536-1.72-2.507-4.385-2.85-5.321-2.877-2.239-.235-4.41 1.34-5.551 1.34-1.162 0-2.92-1.317-4.81-1.278-2.436.038-4.715 1.448-5.964 3.638-2.579 4.464-.656 11.026 1.814 14.633 1.236 1.769 2.68 3.742 4.57 3.672 1.85-.077 2.54-1.18 4.773-1.18 2.212 0 2.86 1.18 4.788 1.135 1.984-.032 3.235-1.775 4.427-3.559 1.428-2.026 2.002-4.02 2.024-4.123-.046-.016-3.854-1.469-3.891-5.865m-3.643-10.786c.994-1.244 1.675-2.936 1.486-4.654-1.44.064-3.24.995-4.276 2.213-.918 1.072-1.738 2.83-1.526 4.481 1.618.12 3.278-.816 4.316-2.04m21.362 17.839h5.002l-2.466-7.261h-.068zm5.658 2.066h-6.312l-1.515 4.475h-2.673l5.977-16.557h2.778l5.977 16.557h-2.718l-1.514-4.475m14.596-1.56c0-2.444-1.263-4.05-3.19-4.05-1.893 0-3.166 1.64-3.166 4.05 0 2.432 1.273 4.061 3.166 4.061 1.927 0 3.19-1.595 3.19-4.061zm2.547 0c0 3.751-2.008 6.161-5.038 6.161-1.72 0-3.086-.77-3.798-2.112h-.057v5.98h-2.478V28.591h2.398v2.007h.046c.689-1.295 2.157-2.134 3.844-2.134 3.063 0 5.083 2.422 5.083 6.162m10.738.001c0-2.444-1.263-4.05-3.19-4.05-1.893 0-3.166 1.64-3.166 4.05 0 2.432 1.273 4.061 3.166 4.061 1.927 0 3.19-1.595 3.19-4.061zm2.547 0c0 3.751-2.008 6.161-5.038 6.161-1.72 0-3.086-.77-3.798-2.112h-.057v5.98h-2.478V28.591h2.398v2.007h.046c.689-1.295 2.157-2.134 3.844-2.134 3.063 0 5.083 2.422 5.083 6.162m8.78 1.422c.184 1.642 1.78 2.72 3.96 2.72 2.088 0 3.59-1.078 3.59-2.558 0-1.285-.906-2.055-3.052-2.582l-2.146-.517c-3.04-.735-4.451-2.157-4.451-4.463 0-2.857 2.489-4.82 6.024-4.82 3.499 0 5.897 1.963 5.978 4.82h-2.501c-.15-1.653-1.516-2.65-3.512-2.65s-3.362 1.01-3.362 2.477c0 1.171.873 1.86 3.007 2.387l1.824.448c3.397.804 4.808 2.168 4.808 4.59 0 3.097-2.467 5.038-6.392 5.038-3.671 0-6.15-1.895-6.31-4.89h2.536m15.514-10.314v2.857h2.296v1.962h-2.296v6.655c0 1.034.46 1.515 1.469 1.515.253 0 .655-.035.815-.057v1.95c-.274.07-.826.115-1.376.115-2.444 0-3.397-.918-3.397-3.26v-6.918h-1.755V28.59h1.755v-2.857h2.49m12.551 8.894c0-2.605-1.194-4.143-3.202-4.143-2.007 0-3.2 1.55-3.2 4.143 0 2.616 1.193 4.142 3.2 4.142 2.008 0 3.202-1.526 3.202-4.142zm-8.927 0c0-3.798 2.237-6.184 5.725-6.184 3.5 0 5.727 2.386 5.727 6.184 0 3.809-2.215 6.185-5.727 6.185-3.51 0-5.725-2.376-5.725-6.185m13.495-6.036h2.363v2.055h.058c.378-1.367 1.48-2.182 2.903-2.182.356 0 .653.047.85.093v2.318c-.197-.082-.633-.15-1.114-.15-1.595 0-2.582 1.079-2.582 2.777v7.16h-2.478V28.591m9.218 4.922h6.035c-.058-1.847-1.239-3.064-2.96-3.064-1.71 0-2.948 1.24-3.075 3.064zm8.376 3.603c-.333 2.192-2.467 3.696-5.197 3.696-3.512 0-5.692-2.353-5.692-6.128 0-3.786 2.192-6.242 5.588-6.242 3.34 0 5.44 2.294 5.44 5.954v.85h-8.527v.15c0 2.064 1.298 3.418 3.248 3.418 1.376 0 2.456-.654 2.788-1.698h2.352M48.803 18.473h1.5c1.664 0 2.623-1.037 2.623-2.862 0-1.797-.975-2.845-2.623-2.845h-1.5zm1.638-6.831c2.36 0 3.744 1.45 3.744 3.953 0 2.542-1.374 4.003-3.744 4.003h-2.873v-7.956h2.873m9.583 4.951c0-1.301-.584-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.026 0 1.61-.76 1.61-2.067zm-4.443 0c0-1.936 1.08-3.115 2.833-3.115 1.748 0 2.829 1.18 2.829 3.115 0 1.946-1.076 3.12-2.83 3.12-1.758 0-2.832-1.174-2.832-3.12m13.188 3.005H67.54l-1.24-4.422h-.095l-1.235 4.422h-1.218l-1.654-6.004h1.201l1.076 4.581h.088l1.234-4.58h1.138l1.234 4.58h.094l1.07-4.58h1.185l-1.649 6.003m3.042-6.004h1.14v.954h.089c.291-.667.888-1.07 1.791-1.07 1.34 0 2.078.805 2.078 2.233v3.887h-1.184v-3.59c0-.965-.42-1.444-1.296-1.444s-1.434.585-1.434 1.522v3.512h-1.184v-6.004m6.986-2.344h1.185v8.347h-1.185V11.25m7.276 5.343c0-1.301-.585-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.025 0 1.61-.76 1.61-2.067zm-4.444 0c0-1.936 1.08-3.115 2.833-3.115 1.749 0 2.83 1.18 2.83 3.115 0 1.946-1.076 3.12-2.83 3.12-1.758 0-2.833-1.174-2.833-3.12m10.769.794v-.501l-1.466.093c-.827.056-1.202.337-1.202.866 0 .54.47.855 1.113.855.894 0 1.555-.569 1.555-1.313zm-3.86.513c0-1.08.805-1.703 2.234-1.792l1.626-.094v-.518c0-.634-.42-.992-1.23-.992-.66 0-1.119.243-1.25.667h-1.147c.12-1.031 1.09-1.693 2.453-1.693 1.505 0 2.354.75 2.354 2.018v4.102h-1.14v-.844h-.095c-.357.601-1.014.943-1.803.943-1.158 0-2.001-.7-2.001-1.797m7.82-1.307c0 1.273.6 2.04 1.604 2.04 1 0 1.617-.778 1.617-2.035 0-1.251-.624-2.04-1.617-2.04-.997 0-1.604.772-1.604 2.035zm-1.224 0c0-1.897.976-3.1 2.492-3.1.822 0 1.516.392 1.842 1.054h.088V11.25h1.185v8.347h-1.135v-.948h-.094c-.358.656-1.058 1.047-1.886 1.047-1.527 0-2.492-1.201-2.492-3.103m14.953 0c0-1.301-.584-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.026 0 1.61-.76 1.61-2.067zm-4.443 0c0-1.936 1.08-3.115 2.833-3.115 1.748 0 2.829 1.18 2.829 3.115 0 1.946-1.076 3.12-2.83 3.12-1.757 0-2.832-1.174-2.832-3.12m7.252-2.999h1.141v.954h.089c.291-.667.888-1.07 1.791-1.07 1.34 0 2.078.805 2.078 2.233v3.887h-1.184v-3.59c0-.965-.42-1.444-1.296-1.444s-1.434.585-1.434 1.522v3.512h-1.184v-6.004m11.793-1.494v1.521h1.3v.999h-1.3v3.087c0 .629.258.904.849.904.182 0 .286-.011.451-.027v.987c-.193.032-.414.06-.644.06-1.318 0-1.843-.464-1.843-1.621v-3.39h-.953v-.999h.953V12.1h1.187m2.919-.85h1.175v3.308h.094c.291-.673.925-1.075 1.83-1.075 1.279 0 2.068.81 2.068 2.238v3.876h-1.186v-3.583c0-.96-.447-1.445-1.284-1.445-.972 0-1.512.612-1.512 1.522v3.506h-1.185V11.25m7.914 4.792h3.033c-.028-.943-.601-1.555-1.479-1.555-.876 0-1.488.617-1.554 1.555zm4.168 1.935c-.27 1.075-1.23 1.737-2.602 1.737-1.72 0-2.773-1.18-2.773-3.1 0-1.918 1.076-3.136 2.768-3.136 1.67 0 2.679 1.142 2.679 3.026v.414h-4.24v.067c.04 1.052.652 1.72 1.598 1.72.719 0 1.21-.26 1.43-.728h1.14",fill:"#fff"})))}var fe=a(91),be=a(100),ye=a(93),Ee=a(411),_e=a(146),we=a(105);const Se="https://play.google.com/store/apps/details?id=im.vector.app",Oe=e=>{var t,a,n,r,s;let{onFinished:o}=e;const c=be.b.get("brand"),l=be.b.getObject("desktop_builds"),d=be.b.getObject("mobile_builds"),u=null!==(t=null==d?void 0:d.get("ios"))&&void 0!==t?t:"https://apps.apple.com/app/vector/id1083446067",m=null!==(a=null!==(n=null==d?void 0:d.get("android"))&&void 0!==n?n:null==d?void 0:d.get("fdroid"))&&void 0!==a?a:Se,h=null!==(r=null==d?void 0:d.get("android"))&&void 0!==r?r:Se,p=null!==(s=null==d?void 0:d.get("fdroid"))&&void 0!==s?s:"https://f-droid.org/repository/browse/?fdid=im.vector.app";return i.a.createElement(we.a,{title:Object(fe.a)("Download %(brand)s",{brand:c}),className:"mx_AppDownloadDialog",fixedWidth:!0,onFinished:o},(null==l?void 0:l.get("available"))&&i.a.createElement("div",{className:"mx_AppDownloadDialog_desktop"},i.a.createElement(_e.a,{size:"h3"},Object(fe.a)("Download %(brand)s Desktop",{brand:c})),i.a.createElement(ye.a,{kind:"primary",element:"a",href:null==l?void 0:l.get("url"),target:"_blank",onClick:()=>{}},Object(fe.a)("Download %(brand)s Desktop",{brand:c}))),i.a.createElement("div",{className:"mx_AppDownloadDialog_mobile"},i.a.createElement("div",{className:"mx_AppDownloadDialog_app"},i.a.createElement(_e.a,{size:"h3"},Object(fe.a)("iOS")),i.a.createElement(Ee.a,{data:u,margin:0,width:172}),i.a.createElement("div",{className:"mx_AppDownloadDialog_info"},Object(fe.a)("%(qrCode)s or %(appLinks)s",{appLinks:"",qrCode:""})),i.a.createElement("div",{className:"mx_AppDownloadDialog_links"},i.a.createElement(ye.a,{element:"a",href:u,target:"_blank","aria-label":Object(fe.a)("Download on the App Store"),onClick:()=>{}},i.a.createElement(ve,null)))),i.a.createElement("div",{className:"mx_AppDownloadDialog_app"},i.a.createElement(_e.a,{size:"h3"},Object(fe.a)("Android")),i.a.createElement(Ee.a,{data:m,margin:0,width:172}),i.a.createElement("div",{className:"mx_AppDownloadDialog_info"},Object(fe.a)("%(qrCode)s or %(appLinks)s",{appLinks:"",qrCode:""})),i.a.createElement("div",{className:"mx_AppDownloadDialog_links"},i.a.createElement(ye.a,{element:"a",href:h,target:"_blank","aria-label":Object(fe.a)("Get it on Google Play"),onClick:()=>{}},i.a.createElement(ue,null)),i.a.createElement(ye.a,{element:"a",href:p,target:"_blank","aria-label":Object(fe.a)("Get it on F-Droid"),onClick:()=>{}},i.a.createElement(V,null))))),i.a.createElement("div",{className:"mx_AppDownloadDialog_legal"},i.a.createElement("p",null,Object(fe.a)("App Store® and the Apple logo® are trademarks of Apple Inc.")),i.a.createElement("p",null,Object(fe.a)("Google Play and the Google Play logo are trademarks of Google LLC."))))};var Ce=a(170),xe=a(98),ke=a(94),je=a(97),Re=a(127),Ie=a(434);const Te=e=>{Re.b.trackInteraction("WebUserOnboardingTaskSendDm",e),ke.a.dispatch({action:"view_create_chat"})},Ne=[{id:"create-account",title:Object(fe.a)("Create account"),description:Object(fe.a)("You made it!"),completed:()=>!0},{id:"find-friends",title:Object(fe.a)("Find and invite your friends"),description:Object(fe.a)("It’s what you’re here for, so lets get to it"),completed:e=>e.hasDmRooms,relevant:[Ie.a.PersonalMessaging,Ie.a.Skip],action:{label:Object(fe.a)("Find friends"),onClick:Te}},{id:"find-coworkers",title:Object(fe.a)("Find and invite your co-workers"),description:Object(fe.a)("Get stuff done by finding your teammates"),completed:e=>e.hasDmRooms,relevant:[Ie.a.WorkMessaging],action:{label:Object(fe.a)("Find people"),onClick:Te}},{id:"find-community-members",title:Object(fe.a)("Find and invite your community members"),description:Object(fe.a)("Get stuff done by finding your teammates"),completed:e=>e.hasDmRooms,relevant:[Ie.a.CommunityMessaging],action:{label:Object(fe.a)("Find people"),onClick:Te}},{id:"download-apps",title:()=>Object(fe.a)("Download %(brand)s",{brand:be.b.get("brand")}),description:()=>Object(fe.a)("Don’t miss a thing by taking %(brand)s with you",{brand:be.b.get("brand")}),completed:e=>e.hasDevices,action:{label:Object(fe.a)("Download apps"),onClick:e=>{Re.b.trackInteraction("WebUserOnboardingTaskDownloadApps",e),je.a.createDialog(Oe,{},"mx_AppDownloadDialog_wrapper",!1,!0)}}},{id:"setup-profile",title:Object(fe.a)("Set up your profile"),description:Object(fe.a)("Make sure people know it’s really you"),completed:e=>e.hasAvatar,action:{label:Object(fe.a)("Your profile"),onClick:e=>{Re.b.trackInteraction("WebUserOnboardingTaskSetupProfile",e),ke.a.dispatch({action:xe.a.ViewUserSettings,initialTabId:Ce.a.General})}}},{id:"permission-notifications",title:Object(fe.a)("Turn on notifications"),description:Object(fe.a)("Don’t miss a reply or important message"),completed:e=>e.hasNotificationsEnabled,action:{label:Object(fe.a)("Enable notifications"),onClick:e=>{Re.b.trackInteraction("WebUserOnboardingTaskEnableNotifications",e),d.Notifier.setEnabled(!0)},hideOnComplete:!0}}];var De=a(433),Pe=a(181),Me=a(589),Ae=a(153),Le=a(220),Ue=a(120),Fe=a(102),Be=a(860);const Ve=e=>{Re.b.trackInteraction("WebHomeCreateChatButton",e),ke.a.dispatch({action:"view_create_chat"})},ze=e=>{Re.b.trackInteraction("WebHomeExploreRoomsButton",e),ke.a.fire(xe.a.ViewRoomDirectory)},We=e=>{Re.b.trackInteraction("WebHomeCreateRoomButton",e),ke.a.dispatch({action:"view_create_room"})},He=e=>({displayName:Le.a.instance.displayName||e,avatarUrl:Le.a.instance.getHttpAvatarUrl(Be.a)}),Ge=()=>{const e=Object(n.useContext)(Fe.a),t=e.getUserId(),[a,i]=Object(n.useState)(He(t));return Object(o.a)(Le.a.instance,Ue.b,()=>{i(He(t))}),n.createElement("div",null,n.createElement(Be.b,{hasAvatar:!!a.avatarUrl,hasAvatarLabel:Object(fe.b)("Great, that'll help people know it's you"),noAvatarLabel:Object(fe.b)("Add a photo so people know it's you."),setAvatarUrl:t=>e.setAvatarUrl(t),isUserAvatar:!0,onClick:e=>Re.b.trackInteraction("WebHomeMiniAvatarUploadButton",e)},n.createElement(Ae.a,{idName:t,name:a.displayName,url:a.avatarUrl,width:Be.a,height:Be.a,resizeMethod:"crop"})),n.createElement("h1",null,Object(fe.b)("Welcome %(name)s",{name:a.displayName})),n.createElement("h2",null,Object(fe.b)("Now, let's help you get started")))};var qe=e=>{let{justRegistered:t=!1}=e;const a=be.b.get(),i=Object(De.a)(a);if(i)return n.createElement(Me.a,{className:"mx_HomePage",url:i,scrollbar:!0});let r;if(t||!Le.a.instance.getHttpAvatarUrl(Be.a))r=n.createElement(Ge,null);else{var s;const e=be.b.getObject("branding"),t=null!==(s=null==e?void 0:e.get("auth_header_logo_url"))&&void 0!==s?s:"themes/element/img/logos/element-logo.svg";r=n.createElement(n.Fragment,null,n.createElement("img",{src:t,alt:a.brand}),n.createElement("h1",null,Object(fe.b)("Welcome to %(appName)s",{appName:a.brand})),n.createElement("h2",null,Object(fe.b)("Own your conversations.")))}return n.createElement(Pe.a,{className:"mx_HomePage mx_HomePage_default",element:"main"},n.createElement("div",{className:"mx_HomePage_default_wrapper"},r,n.createElement("div",{className:"mx_HomePage_default_buttons"},n.createElement(ye.a,{onClick:Ve,className:"mx_HomePage_button_sendDm"},Object(fe.b)("Send a Direct Message")),n.createElement(ye.a,{onClick:ze,className:"mx_HomePage_button_explore"},Object(fe.b)("Explore Public Rooms")),n.createElement(ye.a,{onClick:We,className:"mx_HomePage_button_createGroup"},Object(fe.b)("Create a Group Chat")))))};const Ke=e=>{Re.b.trackInteraction("WebUserOnboardingHeaderSendDm",e),ke.a.dispatch({action:"view_create_chat"})};function Ye(e){let t,i,r,s,{useCase:o}=e;switch(o){case Ie.a.PersonalMessaging:t=Object(fe.a)("Secure messaging for friends and family"),i=Object(fe.a)("With free end-to-end encrypted messaging, and unlimited voice and video calls, %(brand)s is a great way to stay in touch.",{brand:be.b.get("brand")}),r=a(861),s=Object(fe.a)("Start your first chat");break;case Ie.a.WorkMessaging:t=Object(fe.a)("Secure messaging for work"),i=Object(fe.a)("With free end-to-end encrypted messaging, and unlimited voice and video calls, %(brand)s is a great way to stay in touch.",{brand:be.b.get("brand")}),r=a(1469),s=Object(fe.a)("Find your co-workers");break;case Ie.a.CommunityMessaging:t=Object(fe.a)("Community ownership"),i=Object(fe.a)("Keep ownership and control of community discussion.\nScale to support millions, with powerful moderation and interoperability."),r=a(1470),s=Object(fe.a)("Find your people");break;default:t=Object(fe.a)("Welcome to %(brand)s",{brand:be.b.get("brand")}),i=Object(fe.a)("With free end-to-end encrypted messaging, and unlimited voice and video calls, %(brand)s is a great way to stay in touch.",{brand:be.b.get("brand")}),r=a(861),s=Object(fe.a)("Start your first chat")}return n.createElement("div",{className:"mx_UserOnboardingHeader"},n.createElement("div",{className:"mx_UserOnboardingHeader_content"},n.createElement(_e.a,{size:"h1"},t,n.createElement("span",{className:"mx_UserOnboardingHeader_dot"},".")),n.createElement("p",null,i),n.createElement(ye.a,{onClick:Ke,kind:"primary"},s)),n.createElement("img",{className:"mx_UserOnboardingHeader_image",src:r,alt:""}))}var Je=a(449),$e=a(584),Qe=a(349);function Xe(){return Object(Qe.a)()?i.a.createElement("div",{className:"mx_UserOnboardingFeedback"},i.a.createElement("div",{className:"mx_UserOnboardingFeedback_content"},i.a.createElement(_e.a,{size:"h4",className:"mx_UserOnboardingFeedback_title"},Object(fe.a)("How are you finding %(brand)s so far?",{brand:be.b.get("brand")})),i.a.createElement("div",{className:"mx_UserOnboardingFeedback_text"},Object(fe.a)("We’d appreciate any feedback on how you’re finding %(brand)s.",{brand:be.b.get("brand")}))),i.a.createElement(ye.a,{kind:"primary_outline",className:"mx_UserOnboardingFeedback_action",onClick:()=>{je.a.createDialog($e.a,{feature:"use-case-selection"})}},Object(fe.a)("Feedback"))):null}var Ze=a(96),et=a.n(Ze);function tt(e){let{task:t,completed:a=!1}=e;const i="function"==typeof t.title?t.title():t.title,r="function"==typeof t.description?t.description():t.description;return n.createElement("li",{className:et()("mx_UserOnboardingTask",{mx_UserOnboardingTask_completed:a})},n.createElement("div",{className:"mx_UserOnboardingTask_number",role:"checkbox","aria-disabled":"true","aria-checked":a,"aria-labelledby":"mx_UserOnboardingTask_"+t.id}),n.createElement("div",{id:"mx_UserOnboardingTask_"+t.id,className:"mx_UserOnboardingTask_content"},n.createElement(_e.a,{size:"h4",className:"mx_UserOnboardingTask_title"},i),n.createElement("div",{className:"mx_UserOnboardingTask_description"},r)),t.action&&(!t.action.hideOnComplete||!a)&&n.createElement(ye.a,{element:"a",className:"mx_UserOnboardingTask_action",kind:"primary_outline",href:t.action.href,target:"_blank",onClick:t.action.onClick},t.action.label))}function at(e){let{completedTasks:t,waitingTasks:a}=e;const i=t.length,r=a.length,s=i+r,o=Object(n.useMemo)(()=>[...t.map(e=>[e,!0]),...a.map(e=>[e,!1])],[t,a]);return n.createElement("div",{className:"mx_UserOnboardingList"},n.createElement("div",{className:"mx_UserOnboardingList_header"},n.createElement(_e.a,{size:"h3",className:"mx_UserOnboardingList_title"},r>0?Object(fe.a)("Only %(count)s steps to go",{count:r}):Object(fe.a)("You did it!")),n.createElement("div",{className:"mx_UserOnboardingList_hint"},Object(fe.a)("Complete these to get the most out of %(brand)s",{brand:be.b.get("brand")}))),n.createElement("div",{className:"mx_UserOnboardingList_progress"},n.createElement(Je.a,{value:i,max:s,animated:!0}),0===r&&n.createElement(Xe,null)),n.createElement("ol",{className:"mx_UserOnboardingList_list"},o.map(e=>{let[t,a]=e;return n.createElement(tt,{key:t.id,completed:a,task:t})})))}const nt=new Date(1656633600);function it(e){return null!==e||s.a.userRegisteredAfter(nt)}function rt(e){let{justRegistered:t=!1}=e;const a=be.b.get(),i=Object(De.a)(a),l=Object(c.b)("FTUE.useCaseSelection"),h=function(){const e=m(!1,async e=>{const t=await e.getProfileInfo(e.getUserId());return Boolean(null==t?void 0:t.avatar_url)}),t=m(!1,async e=>{const t=e.getDeviceId(),a=await e.getDevices();return Boolean(a.devices.find(e=>e.device_id!==t))}),a=m(!1,async()=>{var e;const t=null!==(e=u.a.shared().getUniqueRoomsWithIndividuals())&&void 0!==e?e:{};return Boolean(Object.keys(t).length)}),i=m(!1,async()=>d.Notifier.isPossible());return Object(n.useMemo)(()=>({hasAvatar:e,hasDevices:t,hasDmRooms:a,hasNotificationsEnabled:i}),[e,t,a,i])}(),[p,g]=function(e){var t;const a=null!==(t=Object(c.b)("FTUE.useCaseSelection"))&&void 0!==t?t:Ie.a.Skip,i=Object(n.useMemo)(()=>Ne.filter(e=>!e.relevant||e.relevant.includes(a)),[a]),r=i.filter(t=>e&&t.completed(e));return[r,i.filter(e=>!r.includes(e))]}(h),v=function(){const e=s.a.get();return Object(o.b)(e,r.ClientEvent.Sync,()=>e.isInitialSyncComplete())}(),[f,b]=Object(n.useState)(!1);return Object(n.useEffect)(()=>{if(v){let e=setTimeout(()=>{e=null,b(!0)},2800);return()=>{clearTimeout(e),e=null}}b(!1)},[v,b]),it(l)?i?n.createElement(Me.a,{className:"mx_HomePage",url:i,scrollbar:!0}):n.createElement(Pe.a,{className:"mx_UserOnboardingPage"},n.createElement(Ye,{useCase:l}),f&&n.createElement(at,{completedTasks:p,waitingTasks:g})):n.createElement(qe,{justRegistered:t})}},576:function(e,t,a){"use strict";a.d(t,"a",(function(){return g})),a.d(t,"b",(function(){return v}));var n=a(6),i=a.n(n),r=a(8),s=a.n(r),o=a(211),c=a(1),l=a(145),d=a(92),u=a(222),m=a(97),h=a(226),p=a(91);let g;!function(e){e[e.Loading=0]="Loading",e[e.Intro=1]="Intro",e[e.Busy=2]="Busy",e[e.Done=3]="Done",e[e.ConfirmSkip=4]="ConfirmSkip",e[e.Finished=5]="Finished",e[e.ConfirmReset=6]="ConfirmReset"}(g||(g={}));class v extends s.a{constructor(){super(...arguments),i()(this,"started",void 0),i()(this,"phase",void 0),i()(this,"verificationRequest",void 0),i()(this,"backupInfo",void 0),i()(this,"keyId",void 0),i()(this,"keyInfo",void 0),i()(this,"hasDevicesToVerifyAgainst",void 0),i()(this,"onUserTrustStatusChanged",e=>{if(e!==d.a.get().getUserId())return;d.a.get().getCrossSigningId()&&(this.phase=g.Done,this.emit("update"))}),i()(this,"onVerificationRequest",e=>{this.setActiveVerificationRequest(e)}),i()(this,"onVerificationRequestChange",()=>{if(this.verificationRequest.cancelled)this.verificationRequest.off(o.l.Change,this.onVerificationRequestChange),this.verificationRequest=null,this.emit("update");else if(this.verificationRequest.phase===o.b){this.verificationRequest.off(o.l.Change,this.onVerificationRequestChange),this.verificationRequest=null;const e=d.a.get().getCrossSigningId();this.phase=e?g.Done:g.Busy,this.emit("update")}})}static sharedInstance(){return window.mxSetupEncryptionStore||(window.mxSetupEncryptionStore=new v),window.mxSetupEncryptionStore}start(){if(this.started)return;this.started=!0,this.phase=g.Loading,this.verificationRequest=null,this.backupInfo=null,this.keyId=null,this.keyInfo=null;const e=d.a.get();e.on(l.b.VerificationRequest,this.onVerificationRequest),e.on(l.b.UserTrustStatusChanged,this.onUserTrustStatusChanged);const t=e.getVerificationRequestsToDeviceInProgress(e.getUserId());t.length&&this.setActiveVerificationRequest(t[t.length-1]),this.fetchKeyInfo()}stop(){var e;this.started&&(this.started=!1,null===(e=this.verificationRequest)||void 0===e||e.off(o.l.Change,this.onVerificationRequestChange),d.a.get()&&(d.a.get().removeListener(l.b.VerificationRequest,this.onVerificationRequest),d.a.get().removeListener(l.b.UserTrustStatusChanged,this.onUserTrustStatusChanged)))}async fetchKeyInfo(){if(!this.started)return;const e=d.a.get(),t=await e.isSecretStored("m.cross_signing.master");null===t||0===Object.keys(t).length?(this.keyId=null,this.keyInfo=null):(this.keyId=Object.keys(t)[0],this.keyInfo=t[this.keyId]);const a=await e.getDehydratedDevice(),n=e.getUserId(),i=e.getStoredCrossSigningForUser(n);this.hasDevicesToVerifyAgainst=e.getStoredDevicesForUser(n).some(e=>e.getIdentityKey()&&(!a||e.deviceId!=a.device_id)&&i.checkDeviceTrust(i,e,!1,!0).isCrossSigningVerified()),this.phase=g.Intro,this.emit("update")}async usePassPhrase(){this.phase=g.Busy,this.emit("update");const e=d.a.get();try{const t=await e.getKeyBackupVersion();this.backupInfo=t,this.emit("update"),await new Promise((a,n)=>{Object(u.b)(async()=>{await e.checkOwnCrossSigningTrust(),a(),t&&await e.restoreKeyBackupWithSecretStorage(t)}).catch(n)}),e.getCrossSigningId()&&(this.phase=g.Done,this.emit("update"))}catch(e){e instanceof u.a||c.a.log(e),this.phase=g.Intro,this.emit("update")}}skip(){this.phase=g.ConfirmSkip,this.emit("update")}skipConfirm(){this.phase=g.Finished,this.emit("update")}returnAfterSkip(){this.phase=g.Intro,this.emit("update")}reset(){this.phase=g.ConfirmReset,this.emit("update")}async resetConfirm(){try{await Object(u.b)(async()=>{const e=d.a.get();await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:async t=>{const{finished:a}=m.a.createDialog(h.a,{title:Object(p.a)("Setting up keys"),matrixClient:e,makeRequest:t}),[n]=await a;if(!n)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:!0}),this.phase=g.Finished},!0)}catch(e){c.a.error("Error resetting cross-signing",e),this.phase=g.Intro}this.emit("update")}returnAfterReset(){this.phase=g.Intro,this.emit("update")}done(){this.phase=g.Finished,this.emit("update"),d.a.get().crypto.cancelAndResendAllOutgoingKeyRequests()}async setActiveVerificationRequest(e){this.started&&e.otherUserId===d.a.get().getUserId()&&(this.verificationRequest&&this.verificationRequest.off(o.l.Change,this.onVerificationRequestChange),this.verificationRequest=e,await e.accept(),e.on(o.l.Change,this.onVerificationRequestChange),this.emit("update"))}lostKeys(){return!this.hasDevicesToVerifyAgainst&&!this.keyInfo}}},577:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(99),c=a(102),l=a(836),d=a(109),u=a(95),m=a(92);class h extends s.a.PureComponent{constructor(){super(...arguments),i()(this,"context",void 0)}render(){const{mxEvent:e,onClick:t}=this.props,a=e.getContent().msgtype;let n=e.sender;if(u.b.getValue("useOnlyCurrentProfiles")){const t=m.a.get().getRoom(e.getRoomId());t&&(n=t.getMember(e.getSender()))}return s.a.createElement(d.b.Consumer,null,i=>a===o.d.Emote&&i.timelineRenderingType!==d.a.ThreadsList?null:s.a.createElement(l.a,{fallbackName:e.getSender()||"",onClick:t,member:n,colored:!0,emphasizeDisplayName:!0}))}}i()(h,"contextType",c.a)},578:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(99),i=a(144),r=a(174),s=a(95),o=a(206),c=a(92),l=a(158),d=a(172);function u(e,t,a){const u=e.getContent().msgtype,m=e.getType();let h=!1;if(s.b.getValue("feature_msc3531_hide_messages_pending_moderation"))switch(Object(l.h)(e)){case l.a.VISIBLE_FOR_ALL:case l.a.HIDDEN_TO_CURRENT_USER:break;case l.a.SEE_THROUGH_FOR_CURRENT_USER:h=!0}let p=Object(o.e)(e,c.a.get(),t),g=m.startsWith("m.key.verification")||m===n.b.RoomMessage&&(null==u?void 0:u.startsWith("m.key.verification"))||m===n.b.RoomCreate||m===n.b.RoomEncryption||p===o.b;const v=!g&&(m===n.b.CallInvite||d.d.CALL_EVENT_TYPE.matches(m));let f=!(g||v||m===n.b.RoomMessage||m===n.b.RoomMessageEncrypted||m===n.b.Sticker||m===n.b.RoomCreate||i.M_POLL_START.matches(m)||r.b.matches(m));const b=m===n.b.RoomMessage&&u===n.d.Emote||i.M_POLL_START.matches(m)||r.b.matches(m)||Object(l.k)(e);return!a&&Object(o.c)(e,t)||(p=Object(o.e)(e,c.a.get(),t,!0),p===o.a&&(g=!1,f=!0)),{hasRenderer:!!p,isInfoMessage:f,isBubbleMessage:g,isLeftAlignedBubbleMessage:v,noBubbleEvent:b,isSeeingThroughMessageHiddenForModeration:h}}},579:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n,i,r,s=a(90);function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function c(e){return s.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),n||(n=s.createElement("circle",{cx:4.25,cy:9,r:1.25,fill:"currentColor"})),i||(i=s.createElement("circle",{cx:9,cy:9,r:1.25,fill:"currentColor"})),r||(r=s.createElement("circle",{cx:13.75,cy:9,r:1.25,fill:"currentColor"})))}},580:function(e,t,a){"use strict";var n=a(101),i=a.n(n),r=a(103),s=a.n(r),o=a(90),c=a.n(o),l=a(139),d=a(121),u=a(110);const m=["children"];t.a=e=>{let{children:t}=e,a=s()(e,m);return c.a.createElement(l.d,{handleHomeEnd:!0,handleLeftRight:!0,onKeyDown:e=>{const t=e.target;if("INPUT"===t.tagName)return;let a=!0;switch(Object(d.a)().getAccessibilityAction(e)){case u.h.ArrowUp:case u.h.ArrowDown:t.hasAttribute("aria-haspopup")&&t.click();break;default:a=!1}a&&(e.preventDefault(),e.stopPropagation())}},e=>{let{onKeyDownHandler:n}=e;return c.a.createElement("div",i()({},a,{onKeyDown:n,role:"toolbar"}),t)})}},581:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return f}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(96),c=a.n(o),l=a(93),d=a(91),u=a(274),m=a(153),h=a(840);let p;!function(e){e.Admin="admin",e.Moderator="moderator"}(p||(p={}));const g={[p.Admin]:Object(d.c)("Admin"),[p.Moderator]:Object(d.c)("Mod")},v={offline:"mx_EntityTile_offline",online:"mx_EntityTile_online",unavailable:"mx_EntityTile_unavailable"};class f extends s.a.PureComponent{constructor(e){super(e),this.state={hover:!1}}render(){const e={mx_EntityTile:!0,mx_EntityTile_noHover:this.props.suppressOnHover};this.props.className&&(e[this.props.className]=!0);var t,n;let i;e[(t=this.props.presenceState,n=this.props.presenceLastActiveAgo,!1===this.props.showPresence?"mx_EntityTile_online_beenactive":"offline"===t?n?v.offline+"_beenactive":v.offline+"_neveractive":t?v[t]:v.offline+"_neveractive")]=!0;const r=this.props.nameJSX||this.props.name;if(this.props.suppressOnHover)i=this.props.subtextLabel?s.a.createElement("div",{className:"mx_EntityTile_details"},s.a.createElement("div",{className:"mx_EntityTile_name"},r),s.a.createElement("span",{className:"mx_EntityTile_subtext"},this.props.subtextLabel)):s.a.createElement("div",{className:"mx_EntityTile_name"},r);else{const e=this.props.presenceLastActiveAgo?Date.now()-(this.props.presenceLastTs-this.props.presenceLastActiveAgo):-1;let t=null;this.props.showPresence&&(t=s.a.createElement(h.a,{activeAgo:e,currentlyActive:this.props.presenceCurrentlyActive,presenceState:this.props.presenceState})),this.props.subtextLabel&&(t=s.a.createElement("span",{className:"mx_EntityTile_subtext"},this.props.subtextLabel)),i=s.a.createElement("div",{className:"mx_EntityTile_details"},s.a.createElement("div",{className:"mx_EntityTile_name"},r),t)}let o,p;this.props.showInviteButton&&(o=s.a.createElement("div",{className:"mx_EntityTile_invite"},s.a.createElement("img",{src:a(1411).default,width:"16",height:"16"})));const f=this.props.powerStatus;if(f){const e=Object(d.a)(g[f]);p=s.a.createElement("div",{className:"mx_EntityTile_power"},e)}let b;const{e2eStatus:y}=this.props;y&&(b=s.a.createElement(u.b,{status:y,isUser:!0,bordered:!0}));const E=this.props.avatarJsx||s.a.createElement(m.a,{name:this.props.name,width:36,height:36,"aria-hidden":"true"});return s.a.createElement("div",null,s.a.createElement(l.a,{className:c()(e),title:this.props.title,onClick:this.props.onClick},s.a.createElement("div",{className:"mx_EntityTile_avatar"},E,b),i,p,o))}}i()(f,"defaultProps",{onClick:()=>{},presenceState:"offline",presenceLastActiveAgo:0,presenceLastTs:0,showInviteButton:!1,suppressOnHover:!1,showPresence:!0})},582:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return l}));var n=a(90),i=a(99),r=a(122),s=a(238),o=a(111);const c=e=>{var t,a;const n=null==e||null===(t=e.currentState)||void 0===t||null===(a=t.getStateEvents(i.b.RoomTopic,""))||void 0===a?void 0:a.getContent();return n?Object(s.parseTopicContent)(n):null};function l(e){const[t,a]=Object(n.useState)(c(e));return Object(o.c)(e.currentState,r.b.Events,t=>{t.getType()===i.b.RoomTopic&&a(c(e))}),Object(n.useEffect)(()=>{a(c(e))},[e]),t}},583:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(90);const i=e=>{const t=Object(n.useRef)(null);return[Object(n.useCallback)(e=>{t.current=e},[]),Object(n.useCallback)((a,n)=>{t.current===a&&e(n)},[e])]}},584:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(123),s=a(91),o=a(108),c=a(93),l=a(100),d=a(97),u=a(250),m=a(196),h=a(348),p=a(359),g=a(147);t.a=e=>{const t=Object(n.useRef)(),[a,v]=Object(n.useState)(""),[f,b]=Object(p.a)(!1);Object(n.useEffect)(()=>{var e;null===(e=t.current)||void 0===e||e.focus()},[]);const y=()=>{e.onFinished(),d.a.createDialog(u.a,{})},E=l.b.get().bug_report_endpoint_url,_=!!E;let w;E&&(w=i.a.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_rateApp"},i.a.createElement("h3",null,Object(s.a)("Comment")),i.a.createElement("p",null,Object(s.a)("Your platform and username will be noted to help us use your feedback as much as we can.")),i.a.createElement(o.a,{id:"feedbackComment",label:Object(s.a)("Feedback"),type:"text",autoComplete:"off",value:a,element:"textarea",onChange:e=>{v(e.target.value)},ref:t}),i.a.createElement(g.b,{checked:f,onChange:b},Object(s.a)("You may contact me if you want to follow up or to let me test out upcoming ideas"))));let S=null;return E&&(S=i.a.createElement("p",{className:"mx_FeedbackDialog_section_microcopy"},Object(s.a)("PRO TIP: If you start a bug, please submit <debugLogsLink>debug logs</debugLogsLink> to help us track down the problem.",{},{debugLogsLink:e=>i.a.createElement(c.a,{kind:"link_inline",onClick:y},e)}))),i.a.createElement(r.a,{className:"mx_FeedbackDialog",hasCancelButton:!!_,title:Object(s.a)("Feedback"),description:i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_reportBug"},i.a.createElement("h3",null,Object(s.a)("Report a bug")),i.a.createElement("p",null,Object(s.a)("Please view <existingIssuesLink>existing bugs on Github</existingIssuesLink> first. No match? <newIssueLink>Start a new one</newIssueLink>.",{},{existingIssuesLink:e=>i.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://github.com/vector-im/element-web/issues?q=is%3Aopen+is%3Aissue+sort%3Areactions-%2B1-desc"},e),newIssueLink:e=>i.a.createElement("a",{target:"_blank",rel:"noreferrer noopener",href:"https://github.com/vector-im/element-web/issues/new/choose"},e)})),S),w),button:_?Object(s.a)("Send feedback"):Object(s.a)("Go back"),buttonDisabled:_&&!a,onFinished:t=>{if(_&&t){if(E){const t=e.feature?e.feature+"-feedback":"feedback";Object(h.c)(E,t,a,f)}d.a.createDialog(m.a,{title:Object(s.a)("Feedback sent"),description:Object(s.a)("Thank you!")})}e.onFinished()}})}},585:function(e,t,a){"use strict";var n=a(101),i=a.n(n),r=a(103),s=a.n(r),o=a(90),c=a.n(o),l=a(99),d=a(148),u=a(91),m=a(221),h=a(450),p=a(102),g=a(94),v=a(231),f=a(95),b=a(142),y=a(98),E=a(189),_=a(126),w=a(127);const S=["space","hideHeader","onFinished"];t.a=e=>{let{space:t,hideHeader:a,onFinished:n}=e,r=s()(e,S);const O=Object(o.useContext)(p.a).getUserId();let C=null;if("public"===t.getJoinRule()||t.canInvite(O)){const e=e=>{e.preventDefault(),e.stopPropagation(),Object(m.i)(t),n()};C=c.a.createElement(d.b,{"data-test-id":"invite-option",className:"mx_SpacePanel_contextMenu_inviteButton",iconClassName:"mx_SpacePanel_iconInvite",label:Object(u.a)("Invite"),onClick:e})}let x=null,k=null;if(Object(m.d)(t)){const e=e=>{e.preventDefault(),e.stopPropagation(),Object(m.k)(t),n()};x=c.a.createElement(d.b,{"data-test-id":"settings-option",iconClassName:"mx_SpacePanel_iconSettings",label:Object(u.a)("Settings"),onClick:e})}else{const e=e=>{e.preventDefault(),e.stopPropagation(),Object(h.b)(t),n()};k=c.a.createElement(d.b,{"data-test-id":"leave-option",iconClassName:"mx_SpacePanel_iconLeave",className:"mx_IconizedContextMenu_option_red",label:Object(u.a)("Leave space"),onClick:e})}let j=null;if(f.b.getValue("developerMode")){const e=e=>{e.preventDefault(),e.stopPropagation(),g.a.dispatch({action:y.a.ViewRoom,room_id:t.roomId,forceTimeline:!0,metricsTrigger:void 0}),n()};j=c.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconSettings",label:Object(u.a)("See room timeline (devtools)"),onClick:e})}const R=Object(b.a)("feature_video_rooms"),I=Object(b.a)("feature_element_call_video_rooms"),T=t.currentState.maySendStateEvent(l.b.SpaceChild,O),N=T&&Object(E.a)(_.a.CreateRooms),D=N&&R,P=T&&Object(E.a)(_.a.CreateSpaces);let M=null;if(N||P){const e=e=>{e.preventDefault(),e.stopPropagation(),w.b.trackInteraction("WebSpaceContextMenuNewRoomItem",e),Object(m.g)(t),n()},a=e=>{e.preventDefault(),e.stopPropagation(),Object(m.g)(t,I?l.i.UnstableCall:l.i.ElementVideo),n()},i=e=>{e.preventDefault(),e.stopPropagation(),Object(m.h)(t),n()};M=c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{"data-test-id":"add-to-space-header",className:"mx_SpacePanel_contextMenu_separatorLabel"},Object(u.a)("Add")),N&&c.a.createElement(d.b,{"data-test-id":"new-room-option",iconClassName:"mx_SpacePanel_iconPlus",label:Object(u.a)("Room"),onClick:e}),D&&c.a.createElement(d.b,{"data-test-id":"new-video-room-option",iconClassName:"mx_SpacePanel_iconPlus",label:Object(u.a)("Video room"),onClick:a},c.a.createElement(v.a,null)),P&&c.a.createElement(d.b,{"data-test-id":"new-subspace-option",iconClassName:"mx_SpacePanel_iconPlus",label:Object(u.a)("Space"),onClick:i},c.a.createElement(v.a,null)))}const A=e=>{e.preventDefault(),e.stopPropagation(),g.a.dispatch({action:y.a.ViewRoom,room_id:t.roomId,metricsTrigger:void 0}),n()};return c.a.createElement(d.e,i()({},r,{onFinished:n,className:"mx_SpacePanel_contextMenu",compact:!0}),!a&&c.a.createElement("div",{className:"mx_SpacePanel_contextMenu_header"},t.name),c.a.createElement(d.c,{first:!0},c.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconHome",label:Object(u.a)("Space home"),onClick:e=>{w.b.trackInteraction("WebSpaceContextMenuHomeItem",e),A(e)}}),C,c.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconExplore",label:N?Object(u.a)("Manage & explore rooms"):Object(u.a)("Explore rooms"),onClick:e=>{w.b.trackInteraction("WebSpaceContextMenuExploreRoomsItem",e),A(e)}}),c.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconPreferences",label:Object(u.a)("Preferences"),onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(m.j)(t),n()}}),x,k,j,M))}},586:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(1),c=a(97),l=a(94),d=a(91),u=a(92),m=a(337),h=a(123),p=a(105),g=a(104),v=a(115);class f extends s.a.Component{constructor(e){super(e),i()(this,"onExportE2eKeysClicked",()=>{c.a.createDialogAsync(a.e(6).then(a.bind(null,1515)),{matrixClient:u.a.get()})}),i()(this,"onFinished",e=>{e&&l.a.dispatch({action:"logout"}),this.props.onFinished(e)}),i()(this,"onSetRecoveryMethodClick",()=>{this.state.backupInfo?c.a.createDialog(m.a,null,null,!1,!0):c.a.createDialogAsync(a.e(7).then(a.bind(null,875)),null,null,!1,!0),this.props.onFinished(!0)}),i()(this,"onLogoutConfirm",()=>{l.a.dispatch({action:"logout"}),this.props.onFinished(!0)});const t=u.a.get(),n=t.isCryptoEnabled()&&!t.getKeyBackupEnabled();this.state={shouldLoadBackupStatus:n,loading:n,backupInfo:null,error:null},n&&this.loadBackupStatus()}async loadBackupStatus(){try{const e=await u.a.get().getKeyBackupVersion();this.setState({loading:!1,backupInfo:e})}catch(e){o.a.log("Unable to fetch key backup status",e),this.setState({loading:!1,error:e})}}render(){if(this.state.shouldLoadBackupStatus){const e=s.a.createElement("div",null,s.a.createElement("p",null,Object(d.a)("Encrypted messages are secured with end-to-end encryption. Only you and the recipient(s) have the keys to read these messages.")),s.a.createElement("p",null,Object(d.a)("When you sign out, these keys will be deleted from this device, which means you won't be able to read encrypted messages unless you have the keys for them on your other devices, or backed them up to the server.")),s.a.createElement("p",null,Object(d.a)("Back up your keys before signing out to avoid losing them.")));let t;if(this.state.loading)t=s.a.createElement(g.a,null);else{let a;a=this.state.backupInfo?Object(d.a)("Connect this session to Key Backup"):Object(d.a)("Start using Key Backup"),t=s.a.createElement("div",null,s.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},e),s.a.createElement(v.a,{primaryButton:a,hasCancel:!1,onPrimaryButtonClick:this.onSetRecoveryMethodClick,focus:!0},s.a.createElement("button",{onClick:this.onLogoutConfirm},Object(d.a)("I don't want my encrypted messages"))),s.a.createElement("details",null,s.a.createElement("summary",null,Object(d.a)("Advanced")),s.a.createElement("p",null,s.a.createElement("button",{onClick:this.onExportE2eKeysClicked},Object(d.a)("Manually export keys")))))}return s.a.createElement(p.a,{title:Object(d.a)("You'll lose access to your encrypted messages"),contentId:"mx_Dialog_content",hasCancel:!0,onFinished:this.onFinished},t)}return s.a.createElement(h.a,{hasCancelButton:!0,title:Object(d.a)("Sign out"),description:Object(d.a)("Are you sure you want to sign out?"),button:Object(d.a)("Sign out"),onFinished:this.onFinished})}}i()(f,"defaultProps",{onFinished:function(){}})},587:function(e,t,a){"use strict";t.__esModule=!0,t.createSubscription=function(e,t){var a,r=i;function s(){c.onStateChange&&c.onStateChange()}function o(){var i,o,c;a||(a=t?t.addNestedSub(s):e.subscribe(s),i=(0,n.getBatch)(),o=null,c=null,r={clear:function(){o=null,c=null},notify:function(){i((function(){for(var e=o;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],t=o;t;)e.push(t),t=t.next;return e},subscribe:function(e){var t=!0,a=c={callback:e,next:null,prev:c};return a.prev?a.prev.next=a:o=a,function(){t&&null!==o&&(t=!1,a.next?a.next.prev=a.prev:c=a.prev,a.prev?a.prev.next=a.next:o=a.next)}}})}var c={addNestedSub:function(e){return o(),r.subscribe(e)},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:s,isSubscribed:function(){return Boolean(a)},trySubscribe:o,tryUnsubscribe:function(){a&&(a(),a=void 0,r.clear(),r=i)},getListeners:function(){return r}};return c};var n=a(852);var i={notify:function(){},get:function(){return[]}}},588:function(e,t,a){"use strict";t.__esModule=!0,t.useIsomorphicLayoutEffect=void 0;var n=a(90),i="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?n.useLayoutEffect:n.useEffect;t.useIsomorphicLayoutEffect=i},589:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(401),c=a.n(o),l=a(96),d=a.n(l),u=a(1),m=a(91),h=a(94),p=a(92),g=a(102),v=a(181);class f extends s.a.PureComponent{constructor(e,t){super(e,t),i()(this,"unmounted",!1),i()(this,"dispatcherRef",null),i()(this,"onAction",e=>{"client_started"===e.action&&this.forceUpdate()}),this.state={page:""}}translate(e){return c()(Object(m.a)(e))}async fetchEmbed(){let e;try{e=await fetch(this.props.url,{method:"GET"})}catch(e){if(this.unmounted)return;return u.a.warn("Error loading page: "+e),void this.setState({page:Object(m.a)("Couldn't load page")})}if(this.unmounted)return;if(!e.ok)return u.a.warn("Error loading page: "+e.status),void this.setState({page:Object(m.a)("Couldn't load page")});let t=(await e.text()).replace(/_t\(['"]([\s\S]*?)['"]\)/gm,(e,t)=>this.translate(t));this.props.replaceMap&&Object.keys(this.props.replaceMap).forEach(e=>{t=t.split(e).join(this.props.replaceMap[e])}),this.setState({page:t})}componentDidMount(){this.unmounted=!1,this.props.url&&(this.fetchEmbed(),this.dispatcherRef=h.a.register(this.onAction))}componentWillUnmount(){this.unmounted=!0,null!==this.dispatcherRef&&h.a.unregister(this.dispatcherRef)}render(){const e=this.context||p.a.get(),t=!e||e.isGuest(),a=this.props.className,n=d()({[a]:!0,[a+"_guest"]:t,[a+"_loggedIn"]:!!e}),i=s.a.createElement("div",{className:a+"_body",dangerouslySetInnerHTML:{__html:this.state.page}});return this.props.scrollbar?s.a.createElement(v.a,{className:n},i):s.a.createElement("div",{className:n},i)}}i()(f,"contextType",g.a)},590:function(e,t,a){"use strict";a.d(t,"a",(function(){return b}));var n=a(6),i=a.n(n),r=a(150),s=a(364),o=a(1),c=a(1479),l=a.n(c),d=a(92),u=a(862),m=a(652),h=a(131),p=a(138),g=a(158),v=a(91),f=a(100);class b{constructor(e,t,a,n){if(this.room=e,this.exportType=t,this.exportOptions=a,this.setProgressText=n,i()(this,"files",[]),i()(this,"client",void 0),i()(this,"cancelled",!1),a.maxSize<1048576||a.maxSize>8388608e3||a.numberOfMessages>10**8)throw new Error("Invalid export options");this.client=d.a.get(),window.addEventListener("beforeunload",this.onBeforeUnload)}get destinationFileName(){return this.makeFileNameNoExtension(f.b.get().brand)+".zip"}onBeforeUnload(e){return e.preventDefault(),e.returnValue=Object(v.a)("Are you sure you want to exit during this export?")}updateProgress(e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&o.a.log(e),t&&this.setProgressText(e)}addFile(e,t){const a={name:e,blob:t};this.files.push(a)}makeFileNameNoExtension(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"matrix";const a=l()(null!==(e=this.room.name)&&void 0!==e?e:Object(v.a)("Unnamed Room")).trim()||"Unnamed Room",n=Object(p.f)(new Date).replace(/:/g,"-");return`${l()(t)} - ${a} - Chat Export - ${n}`}async downloadZIP(){const e=this.destinationFileName,t=e.substring(0,e.length-4),{default:n}=await a.e(35).then(a.t.bind(null,1516,7)),i=new n;if(this.cancelled)return this.cleanUp();this.updateProgress(Object(v.a)("Generating a ZIP"));for(const e of this.files)i.file(t+"/"+e.name,e.blob);const r=await i.generateAsync({type:"blob"});Object(s.saveAs)(r,e)}cleanUp(){return o.a.log("Cleaning up..."),window.removeEventListener("beforeunload",this.onBeforeUnload),""}async cancelExport(){o.a.log("Cancelling export..."),this.cancelled=!0}downloadPlainText(e,t){const a=new Blob([t],{type:"text/plain"});Object(s.saveAs)(a,e)}setEventMetadata(e){const t=this.client.getRoom(this.room.roomId).currentState;return e.sender=t.getSentinelMember(e.getSender()),"m.room.member"===e.getType()&&(e.target=t.getSentinelMember(e.getStateKey())),e}getLimit(){let e;switch(this.exportType){case u.b.LastNMessages:e=this.exportOptions.numberOfMessages;break;case u.b.Timeline:e=40;break;default:e=10**8}return e}async getRequiredEvents(){const e=this.client.getEventMapper();let t=null,a=this.getLimit();const n=[];for(;a;){const i=Math.min(a,1e3),s=await this.client.createMessagesRequest(this.room.roomId,t,i,r.a.Backward);if(this.cancelled)return this.cleanUp(),[];if(0===s.chunk.length)break;a-=s.chunk.length;const o=s.chunk.map(e);for(const e of o)n.push(e);this.exportType===u.b.LastNMessages?this.updateProgress(Object(v.a)("Fetched %(count)s events out of %(total)s",{count:n.length,total:this.exportOptions.numberOfMessages})):this.updateProgress(Object(v.a)("Fetched %(count)s events so far",{count:n.length})),t=s.end}for(let e=0;e<Math.floor(n.length/2);e++)[n[e],n[n.length-e-1]]=[n[n.length-e-1],n[e]];const i=n.filter(e=>e.isEncrypted()).map(e=>this.client.decryptEventIfNeeded(e,{isRetry:!0,emit:!1}));await Promise.all(i);for(let e=0;e<n.length;e++)this.setEventMetadata(n[e]);return n}async getMediaBlob(e){let t;try{const a=e.isEncrypted(),n=e.getContent();if(a&&n.hasOwnProperty("file")&&"m.sticker"!==e.getType())t=await Object(m.a)(n.file);else{const e=Object(h.a)(n),a=await fetch(e.srcHttp);t=await a.blob()}}catch(e){o.a.log("Error decrypting media")}return t}splitFileName(e){const t=e.lastIndexOf(".");if(-1===t)return[e,""];return[e.slice(0,t),"."+e.slice(t+1)]}getFilePath(e){let t;switch(e.getContent().msgtype){case"m.image":t="images";break;case"m.video":t="videos";break;case"m.audio":t="audio";break;default:t="m.sticker"===e.getType()?"stickers":"files"}const a=Object(p.e)(new Date(e.getTs()));let[n,i]=this.splitFileName(e.getContent().body);return"m.sticker"===e.getType()&&(i=".png"),Object(g.l)(e)&&(i=".ogg"),t+"/"+n+"-"+a+i}isReply(e){const t=(e.isEncrypted()?e.event.content:e.getContent())["m.relates_to"];return!(!t||!t["m.in_reply_to"])}isAttachment(e){const t=["m.sticker","m.image","m.file","m.video","m.audio"];return e.getType()===t[0]||t.includes(e.getContent().msgtype)}}},591:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(868),c=a(100),l=a(91),d=a(248);const u={};for(const e of o.a)u[e.iso2]=e;function m(e,t){return"+"===e[0]&&(e=e.slice(1)),0==t.name.toUpperCase().indexOf(e.toUpperCase())||(t.iso2==e.toUpperCase()||-1!==t.prefix.indexOf(e))}class h extends s.a.Component{constructor(e){super(e),i()(this,"onSearchChange",e=>{this.setState({searchQuery:e})}),i()(this,"onOptionChange",e=>{this.props.onOptionChange(u[e])}),i()(this,"getShortOption",e=>{if(!this.props.isSmall)return;let t;return this.props.showPrefix&&(t="+"+u[e].prefix),s.a.createElement("span",{className:"mx_CountryDropdown_shortOption"},this.flagImgForIso2(e),t)});let t=o.a[0];const a=c.b.get("default_country_code");if(a){const e=o.a.find(e=>e.iso2===a.toUpperCase());e&&(t=e)}this.state={searchQuery:"",defaultCountry:t}}componentDidMount(){this.props.value||this.props.onOptionChange(this.state.defaultCountry)}flagImgForIso2(e){return s.a.createElement("div",{className:"mx_Dropdown_option_emoji"},Object(o.b)(e))}render(){let e;if(this.state.searchQuery){if(e=o.a.filter(m.bind(this,this.state.searchQuery)),2==this.state.searchQuery.length&&u[this.state.searchQuery.toUpperCase()]){const t=u[this.state.searchQuery.toUpperCase()];e=e.filter(e=>e.iso2!=t.iso2),e.unshift(t)}}else e=o.a;const t=e.map(e=>s.a.createElement("div",{className:"mx_CountryDropdown_option",key:e.iso2},this.flagImgForIso2(e.iso2),Object(l.a)(e.name)," (+",e.prefix,")")),a=this.props.value||this.state.defaultCountry.iso2;return s.a.createElement(d.a,{id:"mx_CountryDropdown",className:this.props.className+" mx_CountryDropdown",onOptionChange:this.onOptionChange,onSearchChange:this.onSearchChange,menuWidth:298,getShortOption:this.getShortOption,value:a,searchEnabled:!0,disabled:this.props.disabled,label:Object(l.a)("Country Dropdown")},t)}}},596:function(e,t,a){"use strict";a.d(t,"b",(function(){return me})),a.d(t,"a",(function(){return he}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(155),c=a.n(o),l=a(96),d=a.n(l),u=a(99),m=a(1),h=a(122),p=a(174),g=a(7),v=a(339),f=a(138),b=a(92),y=a(95),E=a(109),_=a(168),w=a(91),S=a(365),O=a(294);class C extends s.a.Component{constructor(e){super(e),i()(this,"onMouseDown",e=>{this.setState({location:{currentX:e.clientX,currentY:e.clientY}}),document.addEventListener("mousemove",this.state.onMouseMove),document.addEventListener("mouseup",this.state.onMouseUp)}),i()(this,"onMouseUp",e=>{document.removeEventListener("mousemove",this.state.onMouseMove),document.removeEventListener("mouseup",this.state.onMouseUp),this.props.onMouseUp(e)}),this.state={onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this),location:{currentX:0,currentY:0}}}onMouseMove(e){const t=this.props.dragFunc(this.state.location,e);this.setState({location:t})}render(){return s.a.createElement("div",{className:this.props.className,onMouseDown:this.onMouseDown.bind(this)})}}var x=a(106);class k extends s.a.Component{constructor(e){super(e),i()(this,"dragFunc",(e,t)=>{const a=t.clientX-e.currentX,n=this.state.width+a;return n<this.props.minWidth||n>this.props.maxWidth?e:(this.setState({width:n}),this.updateCSSWidth.bind(this)(n),{currentX:t.clientX,currentY:e.currentY})}),this.state={width:y.b.getValue("ircDisplayNameWidth",this.props.roomId),IRCLayoutRoot:null}}componentDidMount(){this.setState({IRCLayoutRoot:document.querySelector(".mx_IRCLayout")},()=>this.updateCSSWidth(this.state.width))}updateCSSWidth(e){this.state.IRCLayoutRoot.style.setProperty("--name-width",e+"px")}onMoueUp(e){this.props.roomId&&y.b.setValue("ircDisplayNameWidth",this.props.roomId,x.a.ROOM_DEVICE,this.state.width)}render(){return s.a.createElement(C,{className:"mx_ProfileResizer",dragFunc:this.dragFunc.bind(this),onMouseUp:this.onMoueUp.bind(this)})}}var j=a(133),R=a(863),I=a(150),T=a(279);var N=()=>{var e;const{room:t}=Object(r.useContext)(E.b),a=t.getLiveTimeline().getState(I.b.BACKWARDS),n=a.getStateEvents("m.room.encryption")[0],i=null===(e=a.getStateEvents("m.room.history_visibility")[0])||void 0===e?void 0:e.getContent().history_visibility;let o;return"invited"==i?o=Object(w.a)("You don't have permission to view messages from before you were invited."):"joined"==i?o=Object(w.a)("You don't have permission to view messages from before you joined."):n&&(o=Object(w.a)("Encrypted messages before this point are unavailable.")),s.a.createElement(T.a,{className:"mx_HistoryTile",title:Object(w.a)("You can't see earlier messages"),subtitle:o})},D=a(94),P=a(114),M=a(160);function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const a=[],n=Object.keys(e.currentState.members);for(let i=0;i<n.length;++i){const r=n[i];e.currentState.members[r].typing&&-1===t.indexOf(r)&&a.push(e.currentState.members[r])}return a}var L=a(302),U=a(141),F=a(152);class B extends s.a.Component{constructor(){var e;super(...arguments),i()(this,"state",{usersTyping:(e=this.props.room,A(e,[b.a.get().getUserId()])),delayedStopTypingTimers:{}}),i()(this,"isVisible",()=>B.isVisible(this.state)),i()(this,"onRoomTimeline",(e,t)=>{if((null==t?void 0:t.roomId)===this.props.room.roomId){const t=e.getSender(),a=this.state.usersTyping.filter(e=>e.userId!==t);a.length!==this.state.usersTyping.length&&this.setState({usersTyping:a}),this.abortUserTimer(t)}}),i()(this,"onRoomMemberTyping",()=>{const e=function(e){return A(e,[b.a.get().getUserId()].concat(b.a.get().getIgnoredUsers()))}(this.props.room);this.setState({delayedStopTypingTimers:this.updateDelayedStopTypingTimers(e),usersTyping:e})})}componentDidMount(){b.a.get().on(M.b.Typing,this.onRoomMemberTyping),b.a.get().on(P.d.Timeline,this.onRoomTimeline)}componentDidUpdate(e,t){const a=B.isVisible(t),n=B.isVisible(this.state);this.props.onShown&&!a&&n?this.props.onShown():this.props.onHidden&&a&&!n&&this.props.onHidden()}componentWillUnmount(){const e=b.a.get();e&&(e.removeListener(M.b.Typing,this.onRoomMemberTyping),e.removeListener(P.d.Timeline,this.onRoomTimeline)),Object.values(this.state.delayedStopTypingTimers).forEach(e=>e.abort())}static isVisible(e){return 0!==e.usersTyping.length||0!==Object.keys(e.delayedStopTypingTimers).length}updateDelayedStopTypingTimers(e){const t=this.state.usersTyping.filter(t=>!e.some(e=>t.userId===e.userId)),a=e.filter(e=>!this.state.usersTyping.some(t=>e.userId===t.userId));a.forEach(e=>{const t=this.state.delayedStopTypingTimers[e.userId];t&&t.abort()});let n=Object.assign({},this.state.delayedStopTypingTimers);return n=a.reduce((e,t)=>(delete e[t.userId],e),n),n=t.reduce((e,t)=>{if(!e[t.userId]){const a=new L.a(5e3);e[t.userId]=a,a.start(),a.finished().then(()=>this.removeUserTimer(t.userId),()=>{})}return e},n),n}abortUserTimer(e){const t=this.state.delayedStopTypingTimers[e];t&&(t.abort(),this.removeUserTimer(e))}removeUserTimer(e){if(this.state.delayedStopTypingTimers[e]){const t=Object.assign({},this.state.delayedStopTypingTimers);delete t[e],this.setState({delayedStopTypingTimers:t})}}renderTypingIndicatorAvatars(e,t){let a=0;e.length>t&&(a=e.length-t+1,e=e.slice(0,t-1));const n=e.map(e=>s.a.createElement(U.a,{key:e.userId,member:e,width:24,height:24,resizeMethod:"crop",viewUserOnClick:!0,"aria-live":"off"}));return a>0&&n.push(s.a.createElement("span",{className:"mx_WhoIsTypingTile_remainingAvatarPlaceholder",key:"others"},"+",a)),n}render(){let e=this.state.usersTyping;const t=Object.keys(this.state.delayedStopTypingTimers).map(e=>this.props.room.getMember(e));e=e.concat(t),e.sort((e,t)=>Object(F.a)(e.name,t.name));const a=function(e,t){let a=0;if(e.length>t&&(a=e.length-t+1),0===e.length)return"";if(1===e.length)return Object(w.a)("%(displayName)s is typing …",{displayName:e[0].name});const n=e.map(e=>e.name);if(a>=1)return Object(w.a)("%(names)s and %(count)s others are typing …",{names:n.slice(0,t-1).join(", "),count:a});{const e=n.pop();return Object(w.a)("%(names)s and %(lastPerson)s are typing …",{names:n.join(", "),lastPerson:e})}}(e,this.props.whoIsTypingLimit);return a?s.a.createElement("li",{className:"mx_WhoIsTypingTile","aria-atomic":"true"},s.a.createElement("div",{className:"mx_WhoIsTypingTile_avatars"},this.renderTypingIndicatorAvatars(e,this.props.whoIsTypingLimit)),s.a.createElement("div",{className:"mx_WhoIsTypingTile_label"},a)):null}}i()(B,"defaultProps",{whoIsTypingLimit:3});var V=a(413),z=a(116),W=a(359),H=a(93);var G=e=>{let{events:t,children:a,threshold:n=3,onToggle:i,startExpanded:o=!1,summaryMembers:c=[],summaryText:l,layout:d=_.a.Group,"data-testid":u}=e;const[h,p]=Object(W.a)(o);Object(r.useEffect)(()=>{i&&i()},[h]);const g=t.map(e=>e.getId()).join(",");if(t.length<n)return s.a.createElement("li",{className:"mx_GenericEventListSummary","data-scroll-tokens":g,"data-expanded":!0,"data-layout":d},s.a.createElement("ol",{className:"mx_GenericEventListSummary_unstyledList"},a));let v;if(h)v=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_GenericEventListSummary_line"}," "),s.a.createElement("ol",{className:"mx_GenericEventListSummary_unstyledList"},a));else{const e=Object(z.uniqBy)(c.filter(e=>!(null==e||!e.getMxcAvatarUrl)||(m.a.error("EventListSummary given null summaryMember, termites may be afoot eating event senders",c),!1)),e=>e.getMxcAvatarUrl()).map(e=>s.a.createElement(U.a,{key:e.userId,member:e,width:14,height:14}));v=s.a.createElement("div",{className:"mx_EventTile_line"},s.a.createElement("div",{className:"mx_EventTile_info"},s.a.createElement("span",{className:"mx_GenericEventListSummary_avatars",onClick:p},e),s.a.createElement("span",{className:"mx_TextualEvent mx_GenericEventListSummary_summary"},l)))}return s.a.createElement("li",{className:"mx_GenericEventListSummary","data-scroll-tokens":g,"data-expanded":h+"","data-layout":d,"data-testid":u},s.a.createElement(H.a,{kind:"link_inline",className:"mx_GenericEventListSummary_toggle",onClick:p,"aria-expanded":h},h?Object(w.a)("collapse"):Object(w.a)("expand")),v)},q=a(180),K=a(199),Y=a(151),J=a(705),$=a(143);const Q=()=>{$.a.instance.setCard({phase:Y.a.PinnedMessages},!1)},X=[u.b.RoomMember];var Z;!function(e){e.Joined="joined",e.Left="left",e.JoinedAndLeft="joined_and_left",e.LeftAndJoined="left_and_joined",e.InviteReject="invite_reject",e.InviteWithdrawal="invite_withdrawal",e.Invited="invited",e.Banned="banned",e.Unbanned="unbanned",e.Kicked="kicked",e.ChangedName="changed_name",e.ChangedAvatar="changed_avatar",e.NoChange="no_change",e.ServerAcl="server_acl",e.ChangedPins="pinned_messages",e.MessageRemoved="message_removed",e.HiddenEvent="hidden_event"}(Z||(Z={}));class ee extends s.a.Component{constructor(){super(...arguments),i()(this,"context",void 0)}shouldComponentUpdate(e){return e.events.length!==this.props.events.length||e.events.length<this.props.threshold||e.layout!==this.props.layout}generateSummary(e,t){const a=t.map(t=>{const a=e[t],n=this.renderNameList(a),i=t.split(","),r=ee.getCanonicalTransitions(i),s=ee.coalesceRepeatedTransitions(r).map(e=>ee.getDescriptionForTransition(e.transitionType,a.length,e.repeats)),o=Object(q.b)(s);return Object(w.a)("%(nameList)s %(transitionList)s",{nameList:n,transitionList:o})});return a?Object(J.a)(a,", "):null}renderNameList(e){return Object(q.b)(e,this.props.summaryLength)}static getCanonicalTransitions(e){const t={[Z.Joined]:{after:Z.Left,newTransition:Z.JoinedAndLeft},[Z.Left]:{after:Z.Joined,newTransition:Z.LeftAndJoined}},a=[];for(let n=0;n<e.length;n++){const i=e[n],r=e[n+1];let s=i;n<e.length-1&&t[i]&&t[i].after===r&&(s=t[i].newTransition,n++),a.push(s)}return a}static coalesceRepeatedTransitions(e){const t=[];for(let a=0;a<e.length;a++)t.length>0&&t[t.length-1].transitionType===e[a]?t[t.length-1].repeats+=1:t.push({transitionType:e[a],repeats:1});return t}static getDescriptionForTransition(e,t,a){let n=null;switch(e){case Z.Joined:n=t>1?Object(w.a)("%(severalUsers)sjoined %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)sjoined %(count)s times",{oneUser:"",count:a});break;case Z.Left:n=t>1?Object(w.a)("%(severalUsers)sleft %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)sleft %(count)s times",{oneUser:"",count:a});break;case Z.JoinedAndLeft:n=t>1?Object(w.a)("%(severalUsers)sjoined and left %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)sjoined and left %(count)s times",{oneUser:"",count:a});break;case Z.LeftAndJoined:n=t>1?Object(w.a)("%(severalUsers)sleft and rejoined %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)sleft and rejoined %(count)s times",{oneUser:"",count:a});break;case Z.InviteReject:n=t>1?Object(w.a)("%(severalUsers)srejected their invitations %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)srejected their invitation %(count)s times",{oneUser:"",count:a});break;case Z.InviteWithdrawal:n=t>1?Object(w.a)("%(severalUsers)shad their invitations withdrawn %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)shad their invitation withdrawn %(count)s times",{oneUser:"",count:a});break;case Z.Invited:n=t>1?Object(w.a)("were invited %(count)s times",{count:a}):Object(w.a)("was invited %(count)s times",{count:a});break;case Z.Banned:n=t>1?Object(w.a)("were banned %(count)s times",{count:a}):Object(w.a)("was banned %(count)s times",{count:a});break;case Z.Unbanned:n=t>1?Object(w.a)("were unbanned %(count)s times",{count:a}):Object(w.a)("was unbanned %(count)s times",{count:a});break;case Z.Kicked:n=t>1?Object(w.a)("were removed %(count)s times",{count:a}):Object(w.a)("was removed %(count)s times",{count:a});break;case Z.ChangedName:n=t>1?Object(w.a)("%(severalUsers)schanged their name %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)schanged their name %(count)s times",{oneUser:"",count:a});break;case Z.ChangedAvatar:n=t>1?Object(w.a)("%(severalUsers)schanged their avatar %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)schanged their avatar %(count)s times",{oneUser:"",count:a});break;case Z.NoChange:n=t>1?Object(w.a)("%(severalUsers)smade no changes %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)smade no changes %(count)s times",{oneUser:"",count:a});break;case Z.ServerAcl:n=t>1?Object(w.a)("%(severalUsers)schanged the server ACLs %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)schanged the server ACLs %(count)s times",{oneUser:"",count:a});break;case Z.ChangedPins:n=t>1?Object(w.a)("%(severalUsers)schanged the <a>pinned messages</a> for the room %(count)s times",{severalUsers:"",count:a},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:Q},e)}):Object(w.a)("%(oneUser)schanged the <a>pinned messages</a> for the room %(count)s times",{oneUser:"",count:a},{a:e=>s.a.createElement(H.a,{kind:"link_inline",onClick:Q},e)});break;case Z.MessageRemoved:n=t>1?Object(w.a)("%(severalUsers)sremoved a message %(count)s times",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)sremoved a message %(count)s times",{oneUser:"",count:a});break;case Z.HiddenEvent:n=t>1?Object(w.a)("%(severalUsers)ssent %(count)s hidden messages",{severalUsers:"",count:a}):Object(w.a)("%(oneUser)ssent %(count)s hidden messages",{oneUser:"",count:a})}return n}static getTransitionSequence(e){return e.map(ee.getTransition)}static getTransition(e){if(e.mxEvent.isRedacted())return Z.MessageRemoved;switch(e.mxEvent.getType()){case u.b.RoomThirdPartyInvite:return Object(K.c)(e.mxEvent)?Z.Invited:Z.InviteWithdrawal;case u.b.RoomServerAcl:return Z.ServerAcl;case u.b.RoomPinnedEvents:return Z.ChangedPins;case u.b.RoomMember:switch(e.mxEvent.getContent().membership){case"invite":return Z.Invited;case"ban":return Z.Banned;case"join":return"join"===e.mxEvent.getPrevContent().membership?e.mxEvent.getContent().displayname!==e.mxEvent.getPrevContent().displayname?Z.ChangedName:e.mxEvent.getContent().avatar_url!==e.mxEvent.getPrevContent().avatar_url?Z.ChangedAvatar:Z.NoChange:Z.Joined;case"leave":if(e.mxEvent.getSender()===e.mxEvent.getStateKey())return"invite"===e.mxEvent.getPrevContent().membership?Z.InviteReject:Z.Left;switch(e.mxEvent.getPrevContent().membership){case"invite":return Z.InviteWithdrawal;case"ban":return Z.Unbanned;default:return Z.Kicked}default:return null}default:return Z.HiddenEvent}}getAggregate(e){const t={},a={};return Object.keys(e).forEach(n=>{const i=e[n][0],r=i.displayName,s=ee.getTransitionSequence(e[n]).join(",");t[s]||(t[s]=[],a[s]=-1),t[s].push(r),(-1===a[s]||i.index<a[s])&&(a[s]=i.index)}),{names:t,indices:a}}render(){const e=this.props.events,t=new Map,a={};e.forEach((e,n)=>{const i=e.getType();let r=e.getSender();if(i===u.b.RoomMember)r=e.getStateKey();else if(e.isRedacted()){var s,o;r=null===(s=e.getUnsigned())||void 0===s||null===(o=s.redacted_because)||void 0===o?void 0:o.sender}a[r]||(a[r]=[]);let c=r;if(i===u.b.RoomThirdPartyInvite)c=e.getContent().display_name,e.sender&&t.set(r,e.sender);else if(e.isRedacted()){var l;const e=null===(l=this.context)||void 0===l?void 0:l.room.getMember(r);e&&(c=e.name,t.set(r,e))}else e.target&&X.includes(i)?(c=e.target.name,t.set(r,e.target)):e.sender&&(c=e.sender.name,t.set(r,e.sender));a[r].push({mxEvent:e,displayName:c,index:n})});const n=this.getAggregate(a),i=Object.keys(n.names).sort((e,t)=>n.indices[e]-n.indices[t]);return s.a.createElement(G,{"data-testid":this.props["data-testid"],events:this.props.events,threshold:this.props.threshold,onToggle:this.props.onToggle,startExpanded:this.props.startExpanded,children:this.props.children,summaryMembers:[...t.values()],layout:this.props.layout,summaryText:this.generateSummary(n.names,i)})}}i()(ee,"contextType",E.b),i()(ee,"defaultProps",{summaryLength:1,threshold:3,avatarsMaxLength:5,layout:_.a.Group});var te=a(455),ae=a(435),ne=a(104),ie=a(98),re=a(578),se=a(206),oe=a(783),ce=a(158),le=a(235);const de=[u.b.Sticker,u.b.RoomMessage],ue=[u.b.RoomMember,u.b.RoomThirdPartyInvite,u.b.RoomServerAcl,u.b.RoomPinnedEvents];function me(e,t,a,n,i){return i!==E.a.ThreadsList&&(!(null==e||!e.sender||!t.sender)&&(!(t.getTs()-e.getTs()>3e5)&&(t.isRedacted()===e.isRedacted()&&(!!(t.getType()===e.getType()||de.includes(t.getType())&&de.includes(e.getType()))&&(t.sender.userId===e.sender.userId&&t.sender.name===e.sender.name&&t.sender.getMxcAvatarUrl()===e.sender.getMxcAvatarUrl()&&((!n||!Object(ce.i)(t)&&!Object(ce.i)(e)||i===E.a.Thread)&&!!Object(se.c)(e,a)))))))}class he extends s.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"readReceiptMap",{}),i()(this,"readReceiptsByEvent",{}),i()(this,"readReceiptsByUserId",{}),i()(this,"_showHiddenEvents",void 0),i()(this,"threadsEnabled",void 0),i()(this,"isMounted",!1),i()(this,"readMarkerNode",Object(r.createRef)()),i()(this,"whoIsTyping",Object(r.createRef)()),i()(this,"scrollPanel",Object(r.createRef)()),i()(this,"showTypingNotificationsWatcherRef",void 0),i()(this,"eventTiles",{}),i()(this,"grouperKeyMap",new WeakMap),i()(this,"calculateRoomMembersCount",()=>{this.setState({hideSender:this.shouldHideSender()})}),i()(this,"onShowTypingNotificationsChange",()=>{this.setState({showTypingNotifications:y.b.getValue("showTypingNotifications")})}),i()(this,"isUnmounting",()=>!this.isMounted),i()(this,"collectGhostReadMarker",e=>{e&&requestAnimationFrame(()=>{e.style.width="10%",e.style.opacity="0"})}),i()(this,"onGhostTransitionEnd",e=>{const t=e.target.dataset.eventid;this.setState({ghostReadMarkers:this.state.ghostReadMarkers.filter(e=>e!==t)})}),i()(this,"collectEventTile",(e,t)=>{this.eventTiles[e]=t}),i()(this,"onHeightChanged",()=>{const e=this.scrollPanel.current;e&&e.checkScroll()}),i()(this,"onTypingShown",()=>{const e=this.scrollPanel.current;e.checkScroll(),e&&e.getScrollState().stuckAtBottom&&e.preventShrinking()}),i()(this,"onTypingHidden",()=>{const e=this.scrollPanel.current;e&&(e.updatePreventShrinking(),e.checkScroll())}),this.state={ghostReadMarkers:[],showTypingNotifications:y.b.getValue("showTypingNotifications"),hideSender:this.shouldHideSender()},this._showHiddenEvents=y.b.getValue("showHiddenEventsInTimeline"),this.threadsEnabled=y.b.getValue("feature_thread"),this.showTypingNotificationsWatcherRef=y.b.watchSetting("showTypingNotifications",null,this.onShowTypingNotificationsChange)}componentDidMount(){var e;this.calculateRoomMembersCount(),null===(e=this.props.room)||void 0===e||e.currentState.on(h.b.Update,this.calculateRoomMembersCount),this.isMounted=!0}componentWillUnmount(){var e;this.isMounted=!1,null===(e=this.props.room)||void 0===e||e.currentState.off(h.b.Update,this.calculateRoomMembersCount),y.b.unwatchSetting(this.showTypingNotificationsWatcherRef)}componentDidUpdate(e,t){if(e.layout!==this.props.layout&&this.calculateRoomMembersCount(),e.readMarkerVisible&&this.props.readMarkerEventId!==e.readMarkerEventId){const t=this.state.ghostReadMarkers;t.push(e.readMarkerEventId),this.setState({ghostReadMarkers:t})}const a=this.pendingEditItem;if(!this.props.editState&&this.props.room&&a){const e=this.props.room.findEventById(a);D.a.dispatch({action:ie.a.EditEvent,event:null!=e&&e.isRedacted()?null:e,timelineRenderingType:this.context.timelineRenderingType})}}shouldHideSender(){var e;return(null===(e=this.props.room)||void 0===e?void 0:e.getInvitedAndJoinedMemberCount())<=2&&this.props.layout===_.a.Bubble}getNodeForEventId(e){var t,a;if(this.eventTiles)return null===(t=this.eventTiles[e])||void 0===t||null===(a=t.ref)||void 0===a?void 0:a.current}getTileForEventId(e){if(this.eventTiles)return this.eventTiles[e]}isAtBottom(){var e;return null===(e=this.scrollPanel.current)||void 0===e?void 0:e.isAtBottom()}getScrollState(){var e,t;return null!==(e=null===(t=this.scrollPanel.current)||void 0===t?void 0:t.getScrollState())&&void 0!==e?e:null}getReadMarkerPosition(){const e=this.readMarkerNode.current,t=this.scrollPanel.current;if(!e||!t)return null;const a=c.a.findDOMNode(t).getBoundingClientRect(),n=e.getBoundingClientRect();return n.bottom+2<a.top?-1:n.top<a.bottom?0:1}scrollToTop(){this.scrollPanel.current&&this.scrollPanel.current.scrollToTop()}scrollToBottom(){this.scrollPanel.current&&this.scrollPanel.current.scrollToBottom()}scrollRelative(e){this.scrollPanel.current&&this.scrollPanel.current.scrollRelative(e)}handleScrollKey(e){this.scrollPanel.current&&this.scrollPanel.current.handleScrollKey(e)}scrollToEvent(e,t,a){this.scrollPanel.current&&this.scrollPanel.current.scrollToToken(e,t,a)}scrollToEventIfNeeded(e){const t=this.getNodeForEventId(e);t&&t.scrollIntoView({block:"nearest",behavior:"instant"})}get showHiddenEvents(){var e,t;return null!==(e=null===(t=this.context)||void 0===t?void 0:t.showHiddenEvents)&&void 0!==e?e:this._showHiddenEvents}shouldShowEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.props.hideThreadedMessages&&this.threadsEnabled&&this.props.room){const{shouldLiveInRoom:t}=this.props.room.eventShouldLiveIn(e,this.props.events);if(!t)return!1}return!b.a.get().isUserIgnored(e.getSender())&&(!(!this.showHiddenEvents||t)||!!Object(se.c)(e,this.showHiddenEvents)&&(this.props.highlightedEventId===e.getId()||!Object(v.a)(e,this.context)))}readMarkerForEvent(e,t){const a=!t&&this.props.readMarkerVisible;if(this.props.readMarkerEventId===e){let t;return a&&(t=s.a.createElement("hr",{className:"mx_RoomView_myReadMarker",style:{opacity:1,width:"99%"}})),s.a.createElement("li",{key:"readMarker_"+e,ref:this.readMarkerNode,className:"mx_RoomView_myReadMarker_container","data-scroll-tokens":e},t)}if(this.state.ghostReadMarkers.includes(e)){const t=s.a.createElement("hr",{className:"mx_RoomView_myReadMarker",ref:this.collectGhostReadMarker,onTransitionEnd:this.onGhostTransitionEnd,"data-eventid":e});return s.a.createElement("li",{key:"_readuptoghost_"+e,className:"mx_RoomView_myReadMarker_container"},t)}return null}getNextEventInfo(e,t){return{nextEvent:t<e.length-1?e[t+1]:null,nextTile:e.slice(t+1).find(e=>this.shouldShowEvent(e))}}get pendingEditItem(){if(this.props.room)try{return localStorage.getItem(Object(oe.a)(this.props.room.roomId,this.context.timelineRenderingType))}catch(e){return void m.a.error(e)}}getEventTiles(){let e,t,a=-1;for(e=this.props.events.length-1;e>=0;e--){const n=this.props.events[e];if(this.shouldShowEvent(n)&&(void 0===t&&(t=n),!n.status)){a=e;break}}const n=[];let i=null;this.readReceiptsByEvent={},this.props.showReadReceipts&&(this.readReceiptsByEvent=this.getReadReceiptsByShownEvent());let r=null;for(e=0;e<this.props.events.length;e++){const s=this.props.events[e],o=s.getId(),c=s===t,{nextEvent:l,nextTile:d}=this.getNextEventInfo(this.props.events,e);if(r){if(r.shouldGroup(s)){r.add(s);continue}n.push(...r.getTiles()),i=r.getNewPrevEvent(),r=null}for(const e of fe)if(e.canStartGroup(this,s)&&!this.props.disableGrouping){r=new e(this,s,i,t,l,d);break}if(!r){this.shouldShowEvent(s)&&(n.push(...this.getTilesForEvent(i,s,c,!1,l,d)),i=s);const t=this.readMarkerForEvent(o,e>=a);t&&n.push(t)}}return r&&n.push(...r.getTiles()),n}getTilesForEvent(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;const c=[],l=(null===(a=this.props.editState)||void 0===a?void 0:a.getEvent().getId())===t.getId();let d=t.getTs(),u=t.getDate();t.status&&(u=new Date,d=u.getTime());const m=this.wantsDateSeparator(e,u);if(m&&!i&&this.props.room){const e=s.a.createElement("li",{key:d},s.a.createElement(te.a,{key:d,roomId:this.props.room.roomId,ts:d}));c.push(e)}let h=!0;if(o){const e=o;h=this.wantsDateSeparator(t,e.getDate()||new Date)||t.getSender()!==e.getSender()||Object(re.a)(e,this.showHiddenEvents).isInfoMessage||!me(t,e,this.showHiddenEvents,this.threadsEnabled,this.context.timelineRenderingType)}const p=!m&&me(e,t,this.showHiddenEvents,this.threadsEnabled,this.context.timelineRenderingType),g=t.getId(),v=g===this.props.highlightedEventId,f=this.readReceiptsByEvent[g];let y=!1;const E=e=>!e||"sent"===e,_=E(t.getAssociatedStatus()),w=r&&this.shouldShowEvent(r);(!w&&_||w&&_&&!E(r.getAssociatedStatus()))&&(y=!0),o&&o!==r&&E(o.getAssociatedStatus())&&(y=!1),y=y&&t.getSender()===b.a.get().getUserId();const O=this.props.callEventGroupers.get(t.getContent().call_id);return c.push(s.a.createElement(S.a,{key:t.getTxnId()||g,as:"li",ref:this.collectEventTile.bind(this,g),alwaysShowTimestamps:this.props.alwaysShowTimestamps,mxEvent:t,continuation:p,isRedacted:t.isRedacted(),replacingEventId:t.replacingEventId(),editState:l&&this.props.editState,onHeightChanged:this.onHeightChanged,readReceipts:f,readReceiptMap:this.readReceiptMap,showUrlPreview:this.props.showUrlPreview,checkUnmounting:this.isUnmounting,eventSendStatus:t.getAssociatedStatus(),isTwelveHour:this.props.isTwelveHour,permalinkCreator:this.props.permalinkCreator,last:n,lastInSection:h,lastSuccessful:y,isSelectedEvent:v,getRelationsForEvent:this.props.getRelationsForEvent,showReactions:this.props.showReactions,layout:this.props.layout,showReadReceipts:this.props.showReadReceipts,callEventGrouper:O,hideSender:this.state.hideSender})),c}wantsDateSeparator(e,t){return this.context.timelineRenderingType!==E.a.ThreadsList&&(null==e?!this.props.canBackPaginate:Object(f.m)(e.getDate(),t))}getReadReceiptsForEvent(e){const t=b.a.get().credentials.userId,{room:a}=this.props;if(!a)return null;const n=this.context.threadId?a.getThread(this.context.threadId):a,i=[];return n?(n.getReceiptsForEvent(e).forEach(e=>{if(!e.userId||!Object(g.u)(e.type)||e.userId===t)return;if(b.a.get().isUserIgnored(e.userId))return;const n=a.getMember(e.userId);i.push({userId:e.userId,roomMember:n,ts:e.data?e.data.ts:0})}),i):(m.a.debug("Discarding request, could not find the receiptDestination for event: "+this.context.threadId),i)}getReadReceiptsByShownEvent(){const e={},t={};let a;for(const n of this.props.events){if(this.shouldShowEvent(n)&&(a=n.getId()),!a)continue;const i=e[a]||[],r=this.getReadReceiptsForEvent(n);e[a]=i.concat(r);for(const e of r)t[e.userId]={lastShownEventId:a,receipt:e}}for(const a in this.readReceiptsByUserId){if(t[a])continue;const{lastShownEventId:n,receipt:i}=this.readReceiptsByUserId[a],r=e[n]||[];e[n]=r.concat(i),t[a]={lastShownEventId:n,receipt:i}}this.readReceiptsByUserId=t;for(const t in e)e[t].sort((e,t)=>t.ts-e.ts);return e}updateTimelineMinHeight(){const e=this.scrollPanel.current;if(e){const t=e.isAtBottom(),a=this.whoIsTyping.current,n=a&&a.isVisible();t&&n&&e.preventShrinking()}}onTimelineReset(){const e=this.scrollPanel.current;e&&e.clearPreventShrinking()}render(){let e,t;this.props.backPaginating&&(e=s.a.createElement("li",{key:"_topSpinner"},s.a.createElement(ne.a,null))),this.props.forwardPaginating&&(t=s.a.createElement("li",{key:"_bottomSpinner"},s.a.createElement(ne.a,null)));const a=this.props.hidden?{display:"none"}:{};let n;this.props.room&&this.state.showTypingNotifications&&this.context.timelineRenderingType===E.a.Room&&(n=s.a.createElement(B,{room:this.props.room,onShown:this.onTypingShown,onHidden:this.onTypingHidden,ref:this.whoIsTyping}));let i=null;this.props.layout==_.a.IRC&&(i=s.a.createElement(k,{minWidth:20,maxWidth:600,roomId:this.props.room?this.props.room.roomId:null}));const r=d()(this.props.className,{mx_MessagePanel_narrow:this.context.narrow});return s.a.createElement(ae.a,null,s.a.createElement(V.a,{ref:this.scrollPanel,className:r,onScroll:this.props.onScroll,onFillRequest:this.props.onFillRequest,onUnfillRequest:this.props.onUnfillRequest,style:a,stickyBottom:this.props.stickyBottom,resizeNotifier:this.props.resizeNotifier,fixedChildren:i},e,this.getEventTiles(),n,t))}}i()(he,"contextType",E.b),i()(he,"defaultProps",{disableGrouping:!1});class pe{constructor(e,t,a,n,r,s){this.panel=e,this.event=t,this.prevEvent=a,this.lastShownEvent=n,this.nextEvent=r,this.nextEventTile=s,i()(this,"events",[]),i()(this,"ejectedEvents",[]),i()(this,"readMarker",void 0),this.readMarker=e.readMarkerForEvent(t.getId(),t===n)}}i()(pe,"canStartGroup",(e,t)=>!0);class ge extends pe{shouldGroup(e){const t=this.panel,a=this.event;if(!t.shouldShowEvent(e))return!0;if(t.wantsDateSeparator(this.event,e.getDate()))return!1;if(e.getType()===u.b.RoomMember&&(e.getStateKey()!==a.getSender()||"join"!==e.getContent().membership))return!1;const n=e.getType();return!p.b.matches(n)&&(le.f!==n&&!(!e.isState()||e.getSender()!==a.getSender()))}add(e){const t=this.panel;this.readMarker=this.readMarker||t.readMarkerForEvent(e.getId(),e===this.lastShownEvent),t.shouldShowEvent(e)&&(e.getType()===u.b.RoomEncryption?this.ejectedEvents.push(e):this.events.push(e))}getTiles(){if(!this.events||!this.events.length)return[];const e=this.panel,t=[],a=this.event,n=this.lastShownEvent;if(e.wantsDateSeparator(this.prevEvent,a.getDate())){const e=a.getTs();t.push(s.a.createElement("li",{key:e+"~"},s.a.createElement(te.a,{roomId:a.getRoomId(),ts:e})))}e.shouldShowEvent(a)&&t.push(...e.getTilesForEvent(a,a));for(const i of this.ejectedEvents)t.push(...e.getTilesForEvent(a,i,a===n,!0));const i=this.events.map(t=>e.getTilesForEvent(t,t,t===n,!0)).reduce((e,t)=>e.concat(t),[]),r=this.events[this.events.length-1];let o;const c=r.getRoomId(),l=r.sender?r.sender.name:r.getSender();return o=j.a.shared().getUserIdForRoomId(c)?Object(w.a)("%(creator)s created this DM.",{creator:l}):Object(w.a)("%(creator)s created and configured the room.",{creator:l}),t.push(s.a.createElement(R.a,{key:"newroomintro"})),t.push(s.a.createElement(G,{key:"roomcreationsummary",events:this.events,onToggle:e.onHeightChanged,summaryMembers:[r.sender],summaryText:o,layout:this.panel.props.layout},i)),this.readMarker&&t.push(this.readMarker),t}getNewPrevEvent(){return this.event}}i()(ge,"canStartGroup",(function(e,t){return t.getType()===u.b.RoomCreate}));class ve extends pe{constructor(e,t,a,n,i,r){super(e,t,a,n,i,r),this.panel=e,this.event=t,this.prevEvent=a,this.lastShownEvent=n,this.events=[t]}shouldGroup(e){return!this.panel.shouldShowEvent(e)||!this.panel.wantsDateSeparator(this.events[0],e.getDate())&&(!(!e.isState()||!ue.includes(e.getType()))||(!!e.isRedacted()||!(!this.panel.showHiddenEvents||this.panel.shouldShowEvent(e,!0))))}add(e){(e.getType()!==u.b.RoomMember||Object(O.a)(e,this.panel.showHiddenEvents))&&(this.readMarker=this.readMarker||this.panel.readMarkerForEvent(e.getId(),e===this.lastShownEvent),(this.panel.showHiddenEvents||this.panel.shouldShowEvent(e))&&this.events.push(e))}generateKey(){return"eventlistsummary-"+this.events[0].getId()}getTiles(){var e;if(null===(e=this.events)||void 0===e||!e.length)return[];const t=this.panel,a=this.lastShownEvent,n=[];if(t.wantsDateSeparator(this.prevEvent,this.events[0].getDate())){const e=this.events[0].getTs();n.push(s.a.createElement("li",{key:e+"~"},s.a.createElement(te.a,{roomId:this.events[0].getRoomId(),ts:e})))}const i=this.events.find(e=>this.panel.grouperKeyMap.get(e)),r=i?this.panel.grouperKeyMap.get(i):this.generateKey();i||this.panel.grouperKeyMap.set(this.events[0],r);let o=!1,c=this.events.map((e,n)=>(e.getId()===t.props.highlightedEventId&&(o=!0),t.getTilesForEvent(0===n?this.prevEvent:this.events[n-1],e,e===a,!0,this.nextEvent,this.nextEventTile))).reduce((e,t)=>e.concat(t),[]);return 0===c.length&&(c=null),this.panel.props.canBackPaginate||this.prevEvent||n.push(s.a.createElement(N,{key:"historytile"})),n.push(s.a.createElement(ee,{key:r,"data-testid":r,events:this.events,onToggle:t.onHeightChanged,startExpanded:o,layout:this.panel.props.layout},c)),this.readMarker&&n.push(this.readMarker),n}getNewPrevEvent(){return this.events[this.events.length-1]}}i()(ve,"canStartGroup",(function(e,t){return!!e.shouldShowEvent(t)&&(!(!t.isState()||!ue.includes(t.getType()))||(!!t.isRedacted()||!(!e.showHiddenEvents||e.shouldShowEvent(t,!0))))}));const fe=[ge,ve]},597:function(e,t,a){"use strict";a.d(t,"a",(function(){return m})),a.d(t,"b",(function(){return h})),a.d(t,"c",(function(){return p})),a.d(t,"d",(function(){return g}));var n,i,r=a(6),s=a.n(r),o=a(144),c=a(240),l=a(1),d=a(7);!function(e){e.Start="m.login.start",e.Finish="m.login.finish",e.Progress="m.login.progress"}(n||(n={})),function(e){e.Success="success",e.Failure="failure",e.Verified="verified",e.Declined="declined",e.Unsupported="unsupported"}(i||(i={}));const u=new o.UnstableValue("login_token","org.matrix.msc3906.login_token");class m{constructor(e,t,a){this.channel=e,this.client=t,this.onFailure=a,s()(this,"newDeviceId",void 0),s()(this,"newDeviceKey",void 0),s()(this,"ourIntent",g.RECIPROCATE_LOGIN_ON_EXISTING_DEVICE),s()(this,"_code",void 0)}get code(){return this._code}async generateCode(){this._code||(this._code=JSON.stringify(await this.channel.generateCode(this.ourIntent)))}async startAfterShowingCode(){const e=await this.channel.connect();l.a.info(`Connected to secure channel with checksum: ${e} our intent is ${this.ourIntent}`);if((await Object(c.c)(await this.client.getVersions())).get(c.a.LoginTokenRequest)===c.b.Unsupported)return l.a.info("Server doesn't support MSC3882"),await this.send({type:n.Finish,outcome:i.Unsupported}),void await this.cancel(p.HomeserverLacksSupport);await this.send({type:n.Progress,protocols:[u.name]}),l.a.info("Waiting for other device to chose protocol");const{type:t,protocol:a,outcome:r}=await this.receive();if(t!==n.Finish)if(t===n.Progress){if(a&&u.matches(a))return e;await this.cancel(p.UnsupportedAlgorithm)}else await this.cancel(p.Unknown);else switch(null!=r?r:""){case"unsupported":await this.cancel(p.UnsupportedAlgorithm);break;default:await this.cancel(p.Unknown)}}async receive(){return await this.channel.receive()}async send(e){await this.channel.send(e)}async declineLoginOnExistingDevice(){l.a.info("User declined sign in"),await this.send({type:n.Finish,outcome:i.Declined})}async approveLoginOnExistingDevice(e){await this.send({type:n.Progress,login_token:e,homeserver:this.client.baseUrl}),l.a.info("Waiting for outcome");const t=await this.receive();if(!t)return;const{outcome:a,device_id:i,device_key:r}=t;if("success"!==a)throw new Error("Linking failed");return this.newDeviceId=i,this.newDeviceKey=r,i}async verifyAndCrossSignDevice(e){if(!this.client.crypto)throw new Error("Crypto not available on client");if(!this.newDeviceId)throw new Error("No new device ID set");if(e.getFingerprint()!==this.newDeviceKey)throw new Error(`New device has different keys than expected: ${this.newDeviceKey} vs ${e.getFingerprint()}`);const t=this.client.getUserId();if(!t)throw new Error("No user ID set");l.a.info(`Marking device ${this.newDeviceId} as verified`);const a=await this.client.crypto.setDeviceVerification(t,this.newDeviceId,!0,!1,!0),r=this.client.crypto.crossSigningInfo.getId("master");return await this.send({type:n.Finish,outcome:i.Verified,verifying_device_id:this.client.getDeviceId(),verifying_device_key:this.client.getDeviceEd25519Key(),master_key:r}),a}async verifyNewDeviceOnExistingDevice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;if(!this.newDeviceId)throw new Error("No new device to sign");if(!this.newDeviceKey)return void l.a.info("No new device key to sign");if(!this.client.crypto)throw new Error("Crypto not available on client");const t=this.client.getUserId();if(!t)throw new Error("No user ID set");let a=this.client.crypto.getStoredDevice(t,this.newDeviceId);if(a||(l.a.info("Going to wait for new device to be online"),await Object(d.H)(e),a=this.client.crypto.getStoredDevice(t,this.newDeviceId)),a)return await this.verifyAndCrossSignDevice(a);throw new Error("Device not online within timeout")}async cancel(e){var t;null===(t=this.onFailure)||void 0===t||t.call(this,e),await this.channel.cancel(e)}async close(){await this.channel.close()}}class h extends Error{constructor(e,t){super(e),this.code=t}}let p,g;!function(e){e.UserDeclined="user_declined",e.OtherDeviceNotSignedIn="other_device_not_signed_in",e.OtherDeviceAlreadySignedIn="other_device_already_signed_in",e.Unknown="unknown",e.Expired="expired",e.UserCancelled="user_cancelled",e.InvalidCode="invalid_code",e.UnsupportedAlgorithm="unsupported_algorithm",e.DataMismatch="data_mismatch",e.UnsupportedTransport="unsupported_transport",e.HomeserverLacksSupport="homeserver_lacks_support"}(p||(p={})),function(e){e.LOGIN_ON_NEW_DEVICE="login.start",e.RECIPROCATE_LOGIN_ON_EXISTING_DEVICE="login.reciprocate"}(g||(g={}))},600:function(e,t,a){"use strict";a.d(t,"a",(function(){return A})),a.d(t,"b",(function(){return L}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(128),c=a(1),l=a(92),d=a(94),u=a(97),m=a(91),h=a(100),p=a(728),g=a(95),v=a(891),f=a(93),b=a(112),y=a(123),E=a(105);class _ extends s.a.Component{constructor(e){super(e),i()(this,"input",Object(r.createRef)()),i()(this,"onClearClick",()=>{this.setState({value:""}),this.input.current&&(this.input.current.focus(),this.props.onClear&&this.props.onClear())}),i()(this,"onChange",e=>{this.input.current&&(this.setState({value:e.target.value}),this.props.onChange&&this.props.onChange(e.target.value))}),i()(this,"onKeyUp",e=>{"Enter"==e.key&&this.props.showJoinButton&&this.props.onJoinClick&&this.props.onJoinClick(this.state.value)}),i()(this,"onJoinButtonClick",()=>{this.props.onJoinClick&&this.props.onJoinClick(this.state.value)}),this.state={value:this.props.initialText||""}}render(){let e;return{mx_DirectorySearchBox:!0}[this.props.className]=!0,this.props.showJoinButton&&(e=s.a.createElement(f.a,{className:"mx_DirectorySearchBox_joinButton",onClick:this.onJoinButtonClick},Object(m.a)("Join"))),s.a.createElement("div",{className:`mx_DirectorySearchBox ${this.props.className} mx_textinput`},s.a.createElement("input",{type:"text",name:"dirsearch",value:this.state.value,className:"mx_textinput_icon mx_textinput_search",ref:this.input,onChange:this.onChange,onKeyUp:this.onKeyUp,placeholder:this.props.placeholder,autoFocus:!0}),e,s.a.createElement(f.a,{className:"mx_DirectorySearchBox_clear",onClick:this.onClearClick}))}}var w=a(413),S=a(104),O=a(255),C=a(127),x=a(153),k=a(131),j=a(157),R=a(102);const I=e=>{let{room:t,showRoom:a,removeFromDirectory:n}=e;const i=Object(r.useContext)(R.a),[o,c]=Object(r.useState)(null),[l,d]=Object(r.useState)(""),[u,h]=Object(r.useState)(""),[p,g]=Object(r.useState)(!1),v=i.isGuest();Object(r.useEffect)(()=>{const e=i.getRoom(t.room_id);g("join"===(null==e?void 0:e.getMyMembership()));let a=t.name||L(t)||Object(m.a)("Unnamed room");a.length>80&&(a=a.substring(0,80)+"..."),d(a);let n=t.topic||"";n.length>800&&(n=n.substring(0,800)+"..."),n=Object(j.f)(n),h(n),t.avatar_url&&c(Object(k.b)(t.avatar_url).getSquareThumbnailHttp(32))},[t,i]);const b=Object(r.useCallback)(e=>{e.shiftKey&&(e.preventDefault(),null==n||n(t))},[t,n]),y=Object(r.useCallback)(e=>{a(t,null,!1,!0),e.stopPropagation()},[t,a]),E=Object(r.useCallback)(e=>{a(t),e.stopPropagation()},[t,a]),_=Object(r.useCallback)(e=>{a(t,null,!0),e.stopPropagation()},[t,a]);let w,S;return p||!t.world_readable&&!v||(w=s.a.createElement(f.a,{kind:"secondary",onClick:y},Object(m.a)("Preview"))),p?S=s.a.createElement(f.a,{kind:"secondary",onClick:E},Object(m.a)("View")):v||(S=s.a.createElement(f.a,{kind:"primary",onClick:_},Object(m.a)("Join"))),s.a.createElement("div",{role:"listitem",className:"mx_RoomDirectory_listItem"},s.a.createElement("div",{onMouseDown:b,className:"mx_RoomDirectory_roomAvatar"},s.a.createElement(x.a,{width:32,height:32,resizeMethod:"crop",name:l,idName:l,url:o})),s.a.createElement("div",{onMouseDown:b,className:"mx_RoomDirectory_roomDescription"},s.a.createElement("div",{className:"mx_RoomDirectory_name"},l)," ",s.a.createElement("div",{className:"mx_RoomDirectory_topic",dangerouslySetInnerHTML:{__html:u}}),s.a.createElement("div",{className:"mx_RoomDirectory_alias"},L(t))),s.a.createElement("div",{onMouseDown:b,className:"mx_RoomDirectory_roomMemberCount"},t.num_joined_members),s.a.createElement("div",{onMouseDown:b,className:"mx_RoomDirectory_preview"},w),s.a.createElement("div",{onMouseDown:b,className:"mx_RoomDirectory_join"},S))};var T=a(305),N=a(729);function D(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function P(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?D(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):D(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const M="mx_last_room_directory_instance";class A extends s.a.Component{constructor(e){var t;super(e),t=this,i()(this,"unmounted",!1),i()(this,"nextBatch",null),i()(this,"filterTimeout",void 0),i()(this,"protocols",void 0),i()(this,"refreshRoomList",()=>{this.nextBatch=null,this.setState({publicRooms:[],loading:!0}),this.getMoreRooms()}),i()(this,"removeFromDirectory",e=>{const t=L(e),a=e.name||t||Object(m.a)("Unnamed room");let n;n=t?Object(m.a)("Delete the room address %(alias)s and remove %(name)s from the directory?",{alias:t,name:a}):Object(m.a)("Remove %(name)s from the directory?",{name:a}),u.a.createDialog(y.a,{title:Object(m.a)("Remove from Directory"),description:n,onFinished:n=>{if(!n)return;const i=u.a.createDialog(S.a);let r=Object(m.a)("remove %(name)s from the directory.",{name:a});l.a.get().setRoomDirectoryVisibility(e.room_id,o.f.Private).then(()=>{if(t)return r=Object(m.a)("delete the address."),l.a.get().deleteAlias(t)}).then(()=>{i.close(),this.refreshRoomList()},e=>{i.close(),this.refreshRoomList(),c.a.error("Failed to "+r+": "+e),u.a.createDialog(b.a,{title:Object(m.a)("Error"),description:e&&e.message?e.message:Object(m.a)("The server may be unavailable or overloaded")})})}})}),i()(this,"onOptionChange",e=>{this.nextBatch=null,this.setState({publicRooms:[],serverConfig:e,error:null},this.refreshRoomList),localStorage.setItem("mx_last_room_directory_server",e.roomServer),e.instanceId?localStorage.setItem(M,e.instanceId):localStorage.removeItem(M)}),i()(this,"onFillRequest",e=>e||!this.nextBatch?Promise.resolve(!1):this.getMoreRooms()),i()(this,"onFilterChange",e=>{this.setState({filterString:(null==e?void 0:e.trim())||""}),this.filterTimeout&&clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.filterTimeout=null,this.refreshRoomList()},700)}),i()(this,"onFilterClear",()=>{this.setState({filterString:""},this.refreshRoomList),this.filterTimeout&&clearTimeout(this.filterTimeout)}),i()(this,"onJoinFromSearchClick",e=>{const t=l.a.get();try{var a,n;Object(T.b)(t,e,{instanceId:null===(a=this.state.serverConfig)||void 0===a?void 0:a.instanceId,roomServer:null===(n=this.state.serverConfig)||void 0===n?void 0:n.roomServer,protocols:this.protocols,metricsTrigger:"RoomDirectory"})}catch(e){if(!(e instanceof N.a))throw e;u.a.createDialog(b.a,{title:e.message,description:e.description})}}),i()(this,"onCreateRoomClick",e=>{this.onFinished(),d.a.dispatch({action:"view_create_room",public:!0,defaultName:this.state.filterString.trim()}),C.b.trackInteraction("WebRoomDirectoryCreateRoomButton",e)}),i()(this,"onRoomClick",(function(e,a){var n;let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];t.onFinished();const s=l.a.get();Object(T.d)(s,e,{roomAlias:a,autoJoin:i,shouldPeek:r,roomServer:null===(n=t.state.serverConfig)||void 0===n?void 0:n.roomServer,metricsTrigger:"RoomDirectory"})})),i()(this,"onFinished",()=>{this.props.onFinished(!1)});let a=!0;l.a.get()?l.a.get().getThirdpartyProtocols().then(e=>{var t,a,n,i,r,s,o;this.protocols=e;const c=l.a.getHomeserverName(),d=null!==(t=localStorage.getItem("mx_last_room_directory_server"))&&void 0!==t?t:void 0,u=null!==(a=localStorage.getItem(M))&&void 0!==a?a:void 0;let m=c;(null!==(n=h.b.getObject("room_directory"))&&void 0!==n&&null!==(i=n.get("servers"))&&void 0!==i&&i.includes(d)||null!==(r=g.b.getValue("room_directory_servers"))&&void 0!==r&&r.includes(d))&&(m=d);let v=void 0;if(m!==c||u!==p.a&&!Object.values(this.protocols).some(e=>e.instances.some(e=>e.instance_id===u))||(v=u),(null===(s=this.state.serverConfig)||void 0===s?void 0:s.instanceId)!==v||(null===(o=this.state.serverConfig)||void 0===o?void 0:o.roomServer)!==m)return this.setState({protocolsLoading:!1,serverConfig:m?{instanceId:v,roomServer:m}:null}),void this.refreshRoomList();this.setState({protocolsLoading:!1})},e=>{if(c.a.warn("error loading third party protocols: "+e),this.setState({protocolsLoading:!1}),l.a.get().isGuest())return;const t=h.b.get().brand;this.setState({error:Object(m.a)("%(brand)s failed to get the protocol list from the homeserver. The homeserver may be too old to support third party networks.",{brand:t})})}):a=!1;let n=null;const r=localStorage.getItem("mx_last_room_directory_server");var s;r&&(n={roomServer:r,instanceId:null!==(s=localStorage.getItem(M))&&void 0!==s?s:void 0});this.state={publicRooms:[],loading:!0,error:null,serverConfig:n,filterString:this.props.initialText||"",protocolsLoading:a}}componentDidMount(){this.refreshRoomList()}componentWillUnmount(){this.filterTimeout&&clearTimeout(this.filterTimeout),this.unmounted=!0}getMoreRooms(){var e,t,a;if(!l.a.get())return Promise.resolve(!1);this.setState({loading:!0});const n=this.state.filterString,i=null===(e=this.state.serverConfig)||void 0===e?void 0:e.roomServer,r=this.nextBatch,s={limit:20};if(i!=l.a.getHomeserverName()&&(s.server=i),(null===(t=this.state.serverConfig)||void 0===t?void 0:t.instanceId)===p.a)s.include_all_networks=!0;else if(null!==(a=this.state.serverConfig)&&void 0!==a&&a.instanceId){var o;s.third_party_instance_id=null===(o=this.state.serverConfig)||void 0===o?void 0:o.instanceId}return this.nextBatch&&(s.since=this.nextBatch),n&&(s.filter={generic_search_term:n}),l.a.get().publicRooms(s).then(e=>{var t,a;return n==this.state.filterString&&i==(null===(t=this.state.serverConfig)||void 0===t?void 0:t.roomServer)&&r==this.nextBatch&&(!this.unmounted&&(this.nextBatch=null!==(a=e.next_batch)&&void 0!==a?a:null,this.setState(t=>P(P({},t),{},{publicRooms:[...t.publicRooms,...e.chunk||[]],loading:!1})),Boolean(e.next_batch)))},e=>{var t;if(n!=this.state.filterString||i!=(null===(t=this.state.serverConfig)||void 0===t?void 0:t.roomServer)||r!=this.nextBatch)return!1;if(this.unmounted)return!1;c.a.error("Failed to get publicRooms: %s",JSON.stringify(e));const a=h.b.get().brand;return this.setState({loading:!1,error:Object(m.a)("%(brand)s failed to get the public room list.",{brand:a})+(e&&e.message)?e.message:Object(m.a)("The homeserver may be unavailable or overloaded.")}),!1})}stringLooksLikeId(e,t){let a=/^#[^\s]+:[^\s]/;return t&&t.regexp&&(a=new RegExp(t.regexp)),a.test(e)}render(){let e,t;if(this.state.error)e=this.state.error;else if(this.state.protocolsLoading)e=s.a.createElement(S.a,null);else{const t=(this.state.publicRooms||[]).map(e=>s.a.createElement(I,{key:e.room_id,room:e,showRoom:this.onRoomClick,removeFromDirectory:this.removeFromDirectory}));let a;this.state.loading&&(a=s.a.createElement(S.a,null));const n=s.a.createElement(s.a.Fragment,null,s.a.createElement("hr",null),s.a.createElement(f.a,{kind:"primary",onClick:this.onCreateRoomClick,className:"mx_RoomDirectory_newRoom"},Object(m.a)("Create new room")));let i,r;0!==t.length||this.state.loading?(i=s.a.createElement("div",{className:"mx_RoomDirectory_table"},t),this.state.loading||this.nextBatch||(r=n)):r=s.a.createElement(s.a.Fragment,null,s.a.createElement("h5",null,Object(m.a)('No results for "%(query)s"',{query:this.state.filterString.trim()})),s.a.createElement("p",null,Object(m.a)("Try different words or check for typos. Some results may not be visible as they're private and you need an invite to join them.")),n),e=s.a.createElement(w.a,{className:"mx_RoomDirectory_tableWrapper",onFillRequest:this.onFillRequest,stickyBottom:!1,startAtBottom:!1},i,a,r&&s.a.createElement("div",{className:"mx_RoomDirectory_footer"},r))}if(!this.state.protocolsLoading){var a,n,i;const e=Object(p.c)(this.protocols,null===(a=this.state.serverConfig)||void 0===a?void 0:a.instanceId);let c;if(e&&this.protocols&&this.protocols[e]&&this.protocols[e].location_fields.length>0&&this.protocols[e].field_types){const t=this.protocols[e].location_fields.slice(-1)[0];c=this.protocols[e].field_types[t]}let l=Object(m.a)("Find a room…");var r;if(null!==(n=this.state.serverConfig)&&void 0!==n&&n.instanceId&&(null===(i=this.state.serverConfig)||void 0===i?void 0:i.instanceId)!==p.a)c&&(l=c.placeholder);else l=Object(m.a)("Find a room… (e.g. %(exampleRoom)s)",{exampleRoom:"#example:"+(null===(r=this.state.serverConfig)||void 0===r?void 0:r.roomServer)});let d=this.stringLooksLikeId(this.state.filterString,c);if(e){var o;const t=Object(p.b)(this.protocols,null===(o=this.state.serverConfig)||void 0===o?void 0:o.instanceId);t&&null!==Object(T.a)(this.state.filterString,this.protocols[e],t)||(d=!1)}t=s.a.createElement("div",{className:"mx_RoomDirectory_listheader"},s.a.createElement(_,{className:"mx_RoomDirectory_searchbox",onChange:this.onFilterChange,onClear:this.onFilterClear,onJoinClick:this.onJoinFromSearchClick,placeholder:l,showJoinButton:d,initialText:this.props.initialText}),s.a.createElement(v.a,{protocols:this.protocols,config:this.state.serverConfig,setConfig:this.onOptionChange}))}const c=Object(m.a)("If you can't find the room you're looking for, ask for an invite or <a>create a new room</a>.",{},{a:e=>s.a.createElement(f.a,{kind:"link_inline",onClick:this.onCreateRoomClick},e)}),l=Object(m.a)("Explore rooms");return s.a.createElement(E.a,{className:"mx_RoomDirectory_dialog",hasCancel:!0,onFinished:this.onFinished,title:l,screenName:"RoomDirectory"},s.a.createElement("div",{className:"mx_RoomDirectory"},c,s.a.createElement("div",{className:"mx_RoomDirectory_list"},t,e)))}}function L(e){return Object(O.a)(e.canonical_alias,e.aliases)}},601:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(211),s=a(830),o=a(6),c=a.n(o),l=a(145),d=a(381),u=a(468),m=a(1),h=a(92),p=a(411);class g extends i.a.PureComponent{render(){return i.a.createElement(p.a,{data:[{data:this.props.qrCodeData.getBuffer(),mode:"byte"}],className:"mx_VerificationQRCode",width:196})}}var v=a(91),f=a(100),b=a(274),y=a(104),E=a(93),_=a(831);class w extends i.a.PureComponent{constructor(e){super(e),c()(this,"hasVerifier",void 0),c()(this,"onReciprocateYesClick",()=>{this.setState({reciprocateButtonClicked:!0}),this.state.reciprocateQREvent.confirm()}),c()(this,"onReciprocateNoClick",()=>{this.setState({reciprocateButtonClicked:!0}),this.state.reciprocateQREvent.cancel()}),c()(this,"startSAS",async()=>{this.setState({emojiButtonClicked:!0});const e=this.props.request.beginKeyVerification(l.e.SAS);try{await e.verify()}catch(e){m.a.error(e)}}),c()(this,"onSasMatchesClick",()=>{this.state.sasEvent.confirm()}),c()(this,"onSasMismatchesClick",()=>{this.state.sasEvent.mismatch()}),c()(this,"updateVerifierState",()=>{const{request:e}=this.props,t=e.verifier.sasEvent,a=e.verifier.reciprocateQREvent;e.verifier.off(u.b.ShowSas,this.updateVerifierState),e.verifier.off(d.b.ShowReciprocateQr,this.updateVerifierState),this.setState({sasEvent:t,reciprocateQREvent:a})}),c()(this,"onRequestChange",async()=>{const{request:e}=this.props,t=this.hasVerifier;if(this.hasVerifier=!!e.verifier,!t&&this.hasVerifier){e.verifier.on(u.b.ShowSas,this.updateVerifierState),e.verifier.on(d.b.ShowReciprocateQr,this.updateVerifierState);try{await e.verifier.verify()}catch(e){m.a.error("error verify",e)}}}),this.state={},this.hasVerifier=!1}renderQRPhase(){const{member:e,request:t}=this.props,a=t.otherPartySupportsMethod(l.e.SAS),n=t.otherPartySupportsMethod(d.d),r=f.b.get().brand,s=a||n?null:i.a.createElement("p",null,Object(v.a)("The device you are trying to verify doesn't support scanning a QR code or emoji verification, which is what %(brand)s supports. Try with a different client.",{brand:r}));if("dialog"===this.props.layout){let e,r;n&&(e=i.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_startOption"},i.a.createElement("p",null,Object(v.a)("Scan this unique code")),i.a.createElement(g,{qrCodeData:t.qrCodeData}))),a&&(r=i.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_startOption"},i.a.createElement("p",null,Object(v.a)("Compare unique emoji")),i.a.createElement("span",{className:"mx_VerificationPanel_QRPhase_helpText"},Object(v.a)("Compare a unique set of emoji if you don't have a camera on either device")),i.a.createElement(E.a,{disabled:this.state.emojiButtonClicked,onClick:this.startSAS,kind:"primary"},Object(v.a)("Start"))));const o=e&&r?i.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_betweenText"},Object(v.a)("%(qrCode)s or %(emojiCompare)s",{emojiCompare:"",qrCode:""})):null;return i.a.createElement("div",null,Object(v.a)("Verify this device by completing one of the following:"),i.a.createElement("div",{className:"mx_VerificationPanel_QRPhase_startOptions"},e,o,r,s))}let o,c;if(n&&(o=i.a.createElement("div",{className:"mx_UserInfo_container"},i.a.createElement("h3",null,Object(v.a)("Verify by scanning")),i.a.createElement("p",null,Object(v.a)("Ask %(displayName)s to scan your code:",{displayName:e.displayName||e.name||e.userId})),i.a.createElement("div",{className:"mx_VerificationPanel_qrCode"},i.a.createElement(g,{qrCodeData:t.qrCodeData})))),a){const e=this.state.emojiButtonClicked,t=n?Object(v.a)("If you can't scan the code above, verify by comparing unique emoji."):Object(v.a)("Verify by comparing unique emoji.");c=i.a.createElement("div",{className:"mx_UserInfo_container"},i.a.createElement("h3",null,Object(v.a)("Verify by emoji")),i.a.createElement("p",null,t),i.a.createElement(E.a,{disabled:e,kind:"primary",className:"mx_UserInfo_wideButton mx_VerificationPanel_verifyByEmojiButton",onClick:this.startSAS},Object(v.a)("Verify by emoji")))}const u=s?i.a.createElement("div",{className:"mx_UserInfo_container"},s):null;return i.a.createElement(i.a.Fragment,null,o,c,u)}getDevice(){const e=this.props.request&&this.props.request.channel.deviceId;return h.a.get().getStoredDevice(h.a.get().getUserId(),e)}renderQRReciprocatePhase(){const{member:e,request:t}=this.props,a=t.isSelfVerification?Object(v.a)("Almost there! Is your other device showing the same shield?"):Object(v.a)("Almost there! Is %(displayName)s showing the same shield?",{displayName:e.displayName||e.name||e.userId});let n;return n=this.state.reciprocateQREvent?i.a.createElement(i.a.Fragment,null,i.a.createElement("p",null,a),i.a.createElement(b.b,{isUser:!0,status:b.a.Verified,size:128,hideTooltip:!0}),i.a.createElement("div",{className:"mx_VerificationPanel_reciprocateButtons"},i.a.createElement(E.a,{kind:"danger",disabled:this.state.reciprocateButtonClicked,onClick:this.onReciprocateNoClick},Object(v.a)("No")),i.a.createElement(E.a,{kind:"primary",disabled:this.state.reciprocateButtonClicked,onClick:this.onReciprocateYesClick},Object(v.a)("Yes")))):i.a.createElement("p",null,i.a.createElement(y.a,null)),i.a.createElement("div",{className:"mx_UserInfo_container mx_VerificationPanel_reciprocate_section"},i.a.createElement("h3",null,Object(v.a)("Verify by scanning")),n)}renderVerifiedPhase(){const{member:e,request:t}=this.props;let a,n;if(t.isSelfVerification||(a=this.props.isRoomEncrypted?Object(v.a)("Verify all users in a room to ensure it's secure."):Object(v.a)("In encrypted rooms, verify all users to ensure it's secure.")),t.isSelfVerification){const e=this.getDevice();e?n=Object(v.a)("You've successfully verified %(deviceName)s (%(deviceId)s)!",{deviceName:e?e.getDisplayName():"",deviceId:this.props.request.channel.deviceId}):(m.a.warn("Verified device we don't know about: "+this.props.request.channel.deviceId),n=Object(v.a)("You've successfully verified your device!"))}else n=Object(v.a)("You've successfully verified %(displayName)s!",{displayName:e.displayName||e.name||e.userId});return i.a.createElement("div",{className:"mx_UserInfo_container mx_VerificationPanel_verified_section"},i.a.createElement("p",null,n),i.a.createElement(b.b,{isUser:!0,status:b.a.Verified,size:128,hideTooltip:!0}),a?i.a.createElement("p",null,a):null,i.a.createElement(E.a,{kind:"primary",className:"mx_UserInfo_wideButton",onClick:this.props.onClose},Object(v.a)("Got it")))}renderCancelledPhase(){const{member:e,request:t}=this.props;let a,n;return a=t.isSelfVerification?Object(v.a)("Start verification again from the notification."):Object(v.a)("Start verification again from their profile."),"m.timeout"===t.cancellationCode?n=Object(v.a)("Verification timed out.")+" "+a:t.cancellingUserId===t.otherUserId?(n=t.isSelfVerification?Object(v.a)("You cancelled verification on your other device."):Object(v.a)("%(displayName)s cancelled verification.",{displayName:e.displayName||e.name||e.userId}),n=`${n} ${a}`):n=Object(v.a)("You cancelled verification.")+" "+a,i.a.createElement("div",{className:"mx_UserInfo_container"},i.a.createElement("h3",null,Object(v.a)("Verification cancelled")),i.a.createElement("p",null,n),i.a.createElement(E.a,{kind:"primary",className:"mx_UserInfo_wideButton",onClick:this.props.onClose},Object(v.a)("Got it")))}render(){const{member:e,phase:t,request:a}=this.props,n=e.displayName||e.name||e.userId;switch(t){case r.g.Ready:return this.renderQRPhase();case r.g.Started:switch(a.chosenMethod){case l.e.RECIPROCATE_QR_CODE:return this.renderQRReciprocatePhase();case l.e.SAS:{const e=this.state.sasEvent?i.a.createElement(_.a,{displayName:n,device:this.getDevice(),sas:this.state.sasEvent.sas,onCancel:this.onSasMismatchesClick,onDone:this.onSasMatchesClick,inDialog:this.props.inDialog,isSelf:a.isSelfVerification}):i.a.createElement(y.a,null);return i.a.createElement("div",{className:"mx_UserInfo_container"},e)}default:return null}case r.g.Done:return this.renderVerifiedPhase();case r.g.Cancelled:return this.renderCancelledPhase()}return m.a.error("VerificationPanel unhandled phase:",t),null}componentDidMount(){const{request:e}=this.props;if(e.on(r.l.Change,this.onRequestChange),e.verifier){const t=e.verifier.sasEvent,a=e.verifier.reciprocateQREvent;this.setState({sasEvent:t,reciprocateQREvent:a})}this.onRequestChange()}componentWillUnmount(){const{request:e}=this.props;e.verifier&&(e.verifier.off(u.b.ShowSas,this.updateVerifierState),e.verifier.off(d.b.ShowReciprocateQr,this.updateVerifierState)),e.off(r.l.Change,this.onRequestChange)}}var S=a(187),O=a(111),C=a(97),x=a(151),k=a(143),j=a(112);const R=["m.key_mismatch","m.user_error","m.mismatched_sas"];t.a=e=>{const{verificationRequest:t,verificationRequestPromise:o,member:c,onClose:l,layout:d,isRoomEncrypted:u}=e,[m,p]=Object(n.useState)(t),[g,f]=Object(n.useState)(!1),[b,y]=Object(n.useState)(null==m?void 0:m.phase);Object(n.useEffect)(()=>{p(t),t&&(f(!1),y(t.phase))},[t]),Object(n.useEffect)(()=>{o&&async function(){f(!0);const e=await o;f(!1),p(e),y(e.phase)}()},[o]);const E=Object(n.useCallback)(()=>{m&&m.cancelled&&R.includes(m.cancellationCode)?C.a.createDialog(j.a,{headerImage:a(833).default,title:Object(v.a)("Your messages are not secure"),description:i.a.createElement("div",null,Object(v.a)("One of the following may be compromised:"),i.a.createElement("ul",null,i.a.createElement("li",null,Object(v.a)("Your homeserver")),i.a.createElement("li",null,Object(v.a)("The homeserver the user you're verifying is connected to")),i.a.createElement("li",null,Object(v.a)("Yours, or the other users' internet connection")),i.a.createElement("li",null,Object(v.a)("Yours, or the other users' session")))),onFinished:l}):m&&y(m.phase)},[l,m]);Object(O.c)(m,r.l.Change,E);const _=Object(n.useCallback)(async()=>{f(!0);const e=h.a.get(),t=await Object(S.c)(e,c.userId),a=await e.requestVerificationDM(c.userId,t);p(a),y(a.phase),k.a.instance.currentCard.phase!=x.a.EncryptionPanel&&k.a.instance.pushCard({phase:x.a.EncryptionPanel,state:{member:c,verificationRequest:a}}),k.a.instance.isOpen||k.a.instance.togglePanel(null)},[c]),I=!m&&g||m&&(b===r.d||b===r.f||void 0===b),T=m?m.isSelfVerification:c.userId===h.a.get().getUserId();if(!m||I){const e=!m&&g||m&&m.initiatedByMe;return i.a.createElement(s.b,{isRoomEncrypted:u,onStartVerification:_,member:c,isSelfVerification:T,waitingForOtherParty:I&&e,waitingForNetwork:I&&!e,inDialog:"dialog"===d})}return i.a.createElement(w,{isRoomEncrypted:u,layout:d,onClose:l,member:c,request:m,key:m.channel.transactionId,inDialog:"dialog"===d,phase:b})}},605:function(e,t,a){"use strict";a.d(t,"a",(function(){return k})),a.d(t,"b",(function(){return j}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(1),c=a(107),l=a(295),d=a(868),u=a(97),m=a(91),h=a(100),p=a(848),g=a(169),v=a(436),f=a(318),b=a(108),y=a(105),E=a(115);var _,w,S=e=>{let{onFinished:t}=e;const[a,n]=Object(r.useState)(""),i=Object(r.useRef)(),s=async e=>{if(e.preventDefault(),a){if(!await i.current.validate({}))return i.current.focus(),void i.current.validate({focused:!0})}t(!0,a)};return r.createElement(y.a,{title:Object(m.a)("Continuing without email"),className:"mx_RegistrationEmailPromptDialog",contentId:"mx_RegistrationEmailPromptDialog",onFinished:()=>t(!1),fixedWidth:!1},r.createElement("div",{className:"mx_Dialog_content",id:"mx_RegistrationEmailPromptDialog"},r.createElement("p",null,Object(m.a)("Just a heads up, if you don't add an email and forget your password, you could <b>permanently lose access to your account</b>.",{},{b:e=>r.createElement("b",null,e)})),r.createElement("form",{onSubmit:s},r.createElement(v.a,{fieldRef:i,autoFocus:!0,label:Object(m.c)("Email (optional)"),value:a,onChange:e=>{const t=e.target;n(t.value)}}))),r.createElement(E.a,{primaryButton:Object(m.a)("Continue"),onPrimaryButtonClick:s,hasCancel:!1}))},O=a(591),C=a(869),x=a(166);!function(e){e.Email="field_email",e.PhoneNumber="field_phone_number",e.Username="field_username",e.Password="field_password",e.PasswordConfirm="field_password_confirm"}(_||(_={})),function(e){e[e.Unknown=0]="Unknown",e[e.Available=1]="Available",e[e.Unavailable=2]="Unavailable",e[e.Error=3]="Error",e[e.Invalid=4]="Invalid"}(w||(w={}));const k=3;class j extends s.a.PureComponent{constructor(e){super(e),i()(this,"onSubmit",async e=>{if(e.preventDefault(),e.persist(),!this.props.canSubmit)return;if(await this.verifyFieldsBeforeSubmit())if(""===this.state.email){if(!this.showEmail())return void this.doSubmit(e);u.a.createDialog(S,{onFinished:async(t,a)=>{t&&this.setState({email:a},()=>{this.doSubmit(e)})}})}else this.doSubmit(e)}),i()(this,"onEmailChange",e=>{this.setState({email:e.target.value.trim()})}),i()(this,"onEmailValidate",e=>{this.markFieldValid(_.Email,e.valid)}),i()(this,"validateEmailRules",Object(g.a)({description:()=>Object(m.a)("Use an email address to recover your account"),hideDescriptionIfValid:!0,rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!this.authStepIsRequired("m.login.email.identity")||!!t},invalid:()=>Object(m.a)("Enter email address (required on this homeserver)")},{key:"email",test:e=>{let{value:t}=e;return!t||l.a(t)},invalid:()=>Object(m.a)("Doesn't look like a valid email address")}]})),i()(this,"onPasswordChange",e=>{this.setState({password:e.target.value})}),i()(this,"onPasswordValidate",e=>{this.markFieldValid(_.Password,e.valid)}),i()(this,"onPasswordConfirmChange",e=>{this.setState({passwordConfirm:e.target.value})}),i()(this,"onPasswordConfirmValidate",e=>{this.markFieldValid(_.PasswordConfirm,e.valid)}),i()(this,"onPhoneCountryChange",e=>{this.setState({phoneCountry:e.iso2})}),i()(this,"onPhoneNumberChange",e=>{this.setState({phoneNumber:e.target.value})}),i()(this,"onPhoneNumberValidate",async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(_.PhoneNumber,t.valid),t}),i()(this,"validatePhoneNumberRules",Object(g.a)({description:()=>Object(m.a)("Other users can invite you to rooms using your contact details"),hideDescriptionIfValid:!0,rules:[{key:"required",test(e){let{value:t,allowEmpty:a}=e;return a||!this.authStepIsRequired("m.login.msisdn")||!!t},invalid:()=>Object(m.a)("Enter phone number (required on this homeserver)")},{key:"email",test:e=>{let{value:t}=e;return!t||Object(d.c)(t)},invalid:()=>Object(m.a)("That phone number doesn't look quite right, please check and try again")}]})),i()(this,"onUsernameChange",e=>{this.setState({username:e.target.value})}),i()(this,"onUsernameValidate",async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(_.Username,t.valid),t}),i()(this,"validateUsernameRules",Object(g.a)({description:(e,t)=>{if(!t.every(e=>{let{key:t,valid:a}=e;return"available"===t||a}))return Object(m.a)("Use lowercase letters, numbers, dashes and underscores only")},hideDescriptionIfValid:!0,async deriveData(e){let{value:t}=e;if(!t)return w.Unknown;try{return await this.props.matrixClient.isUsernameAvailable(t)?w.Available:w.Unavailable}catch(e){return e instanceof c.MatrixError&&"M_INVALID_USERNAME"===e.errcode?w.Invalid:w.Error}},rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(m.a)("Enter username")},{key:"safeLocalpart",test:(e,t)=>{let{value:a}=e;return(!a||p.a.test(a))&&t!==w.Invalid},invalid:()=>Object(m.a)("Some characters not allowed")},{key:"available",final:!0,test:async(e,t)=>{let{value:a}=e;return!a||t===w.Available},invalid:e=>e===w.Error?Object(m.a)("Unable to check if username has been taken. Try again later."):Object(m.a)("Someone already has that username. Try another or if it is you, sign in below.")}]})),this.state={fieldValid:{},phoneCountry:this.props.defaultPhoneCountry,username:this.props.defaultUsername||"",email:this.props.defaultEmail||"",phoneNumber:this.props.defaultPhoneNumber||"",password:this.props.defaultPassword||"",passwordConfirm:this.props.defaultPassword||"",passwordComplexity:null}}doSubmit(e){x.a.instance.setAuthenticationType("Password");const t=this.state.email.trim(),a=this.props.onRegisterClick({username:this.state.username.trim(),password:this.state.password.trim(),email:t,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber});a&&(e.target.disabled=!0,a.finally((function(){e.target.disabled=!1})))}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[_.Username,_.Password,_.PasswordConfirm,_.Email,_.PhoneNumber];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise(e=>this.setState({},e)),this.allFieldsValid())return!0;const a=this.findFirstInvalidField(t);return!a||(a.focus(),a.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){const e=Object.keys(this.state.fieldValid);for(let t=0;t<e.length;++t)if(!this.state.fieldValid[e[t]])return!1;return!0}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:a}=this.state;a[e]=t,this.setState({fieldValid:a})}authStepIsRequired(e){return this.props.flows.every(t=>t.stages.includes(e))}authStepIsUsed(e){return this.props.flows.some(t=>t.stages.includes(e))}showEmail(){return!!this.authStepIsUsed("m.login.email.identity")}showPhoneNumber(){return!(h.b.get().disable_3pid_login||!this.authStepIsUsed("m.login.msisdn"))}renderEmail(){if(!this.showEmail())return null;const e=this.authStepIsRequired("m.login.email.identity")?Object(m.c)("Email"):Object(m.c)("Email (optional)");return s.a.createElement(v.a,{fieldRef:e=>this[_.Email]=e,label:e,value:this.state.email,validationRules:this.validateEmailRules.bind(this),onChange:this.onEmailChange,onValidate:this.onEmailValidate})}renderPassword(){return s.a.createElement(f.a,{id:"mx_RegistrationForm_password",fieldRef:e=>this[_.Password]=e,minScore:k,value:this.state.password,onChange:this.onPasswordChange,onValidate:this.onPasswordValidate})}renderPasswordConfirm(){return s.a.createElement(C.a,{id:"mx_RegistrationForm_passwordConfirm",fieldRef:e=>this[_.PasswordConfirm]=e,autoComplete:"new-password",value:this.state.passwordConfirm,password:this.state.password,onChange:this.onPasswordConfirmChange,onValidate:this.onPasswordConfirmValidate})}renderPhoneNumber(){if(!this.showPhoneNumber())return null;const e=this.authStepIsRequired("m.login.msisdn")?Object(m.a)("Phone"):Object(m.a)("Phone (optional)"),t=s.a.createElement(O.a,{value:this.state.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChange});return s.a.createElement(b.a,{ref:e=>this[_.PhoneNumber]=e,type:"text",label:e,value:this.state.phoneNumber,prefixComponent:t,onChange:this.onPhoneNumberChange,onValidate:this.onPhoneNumberValidate})}renderUsername(){return s.a.createElement(b.a,{id:"mx_RegistrationForm_username",ref:e=>this[_.Username]=e,type:"text",autoFocus:!0,label:Object(m.a)("Username"),placeholder:Object(m.a)("Username").toLocaleLowerCase(),value:this.state.username,onChange:this.onUsernameChange,onValidate:this.onUsernameValidate})}render(){const e=s.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:Object(m.a)("Register"),disabled:!this.props.canSubmit});let t=null;return this.showEmail()&&(t=this.showPhoneNumber()?s.a.createElement("div",null,Object(m.a)("Add an email to be able to reset your password.")," ",Object(m.a)("Use email or phone to optionally be discoverable by existing contacts.")):s.a.createElement("div",null,Object(m.a)("Add an email to be able to reset your password.")," ",Object(m.a)("Use email to optionally be discoverable by existing contacts."))),s.a.createElement("div",null,s.a.createElement("form",{onSubmit:this.onSubmit},s.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderUsername()),s.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderPassword(),this.renderPasswordConfirm()),s.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderEmail(),this.renderPhoneNumber()),t,e))}}i()(j,"defaultProps",{onValidationChange:o.a.error,canSubmit:!0})},606:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(93),s=a(91),o=a(216),c=a(100),l=a(97),d=a(6),u=a.n(d),m=a(290),h=a(1),p=a(320),g=a(105),v=a(108),f=a(228),b=a(169);class y extends i.a.PureComponent{constructor(e){super(e),u()(this,"defaultServer",void 0),u()(this,"fieldRef",Object(n.createRef)()),u()(this,"validatedConf",void 0),u()(this,"onDefaultChosen",()=>{this.setState({defaultChosen:!0})}),u()(this,"onOtherChosen",()=>{this.setState({defaultChosen:!1})}),u()(this,"onHomeserverChange",e=>{this.setState({otherHomeserver:e.target.value})}),u()(this,"validate",Object(b.a)({deriveData:async e=>{let{value:t}=e,a=t.trim();if(!a.includes("://"))try{const e=await m.a.findClientConfig(a);return this.validatedConf=p.a.buildValidatedConfigFromDiscovery(a,e),{}}catch(e){h.a.error(`Attempted ${a} as a server_name but it failed`,e)}a.includes("://")||(a="https://"+a);try{return this.validatedConf=await p.a.validateServerConfigWithStaticUrls(a),{}}catch(e){h.a.error(e);if(p.a.authComponentStateForError(e).serverErrorIsFatal){let t=Object(s.a)("Unable to validate homeserver");return e.translatedMessage&&(t=e.translatedMessage),{error:t}}try{return this.validatedConf=await p.a.validateServerConfigWithStaticUrls(a,null,!0),{}}catch(e){return h.a.error(e),{error:Object(s.a)("Invalid URL")}}}},rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(s.a)("Specify a homeserver")},{key:"valid",test:async function(e,t){let{value:a}=e,{error:n}=t;return!a||!n},invalid:function(e){let{error:t}=e;return t}}]})),u()(this,"onHomeserverValidate",e=>this.validate(e)),u()(this,"onSubmit",async e=>{e.preventDefault();if(!await this.fieldRef.current.validate({allowEmpty:!1})&&!this.state.defaultChosen)return this.fieldRef.current.focus(),void this.fieldRef.current.validate({allowEmpty:!1,focused:!0});this.props.onFinished(this.state.defaultChosen?this.defaultServer:this.validatedConf)});const t=c.b.get();this.defaultServer=t.validated_server_config;const{serverConfig:a}=this.props;let i="";a.isDefault||(i=a.isNameResolvable&&a.hsName?a.hsName:a.hsUrl),this.state={defaultChosen:a.isDefault,otherHomeserver:i}}render(){let e;"matrix.org"===this.defaultServer.hsName&&(e=Object(s.a)("Matrix.org is the biggest public homeserver in the world, so it's a good place for many."));let t=this.defaultServer.hsName;return this.defaultServer.hsNameIsDifferent&&(t=i.a.createElement(o.a,{class:"mx_Login_underlinedServerName",tooltip:this.defaultServer.hsUrl},this.defaultServer.hsName)),i.a.createElement(g.a,{title:this.props.title||Object(s.a)("Sign into your homeserver"),className:"mx_ServerPickerDialog",contentId:"mx_ServerPickerDialog",onFinished:this.props.onFinished,fixedWidth:!1,hasCancel:!0},i.a.createElement("form",{className:"mx_Dialog_content",id:"mx_ServerPickerDialog",onSubmit:this.onSubmit},i.a.createElement("p",null,Object(s.a)("We call the places where you can host your account 'homeservers'.")," ",e),i.a.createElement(f.a,{name:"defaultChosen",value:"true",checked:this.state.defaultChosen,onChange:this.onDefaultChosen},t),i.a.createElement(f.a,{name:"defaultChosen",value:"false",className:"mx_ServerPickerDialog_otherHomeserverRadio",checked:!this.state.defaultChosen,onChange:this.onOtherChosen,childrenInLabel:!1,"aria-label":Object(s.a)("Other homeserver")},i.a.createElement(v.a,{type:"text",className:"mx_ServerPickerDialog_otherHomeserver",label:Object(s.a)("Other homeserver"),onChange:this.onHomeserverChange,onFocus:this.onOtherChosen,ref:this.fieldRef,onValidate:this.onHomeserverValidate,value:this.state.otherHomeserver,validateOnChange:!1,validateOnFocus:!1,autoFocus:!0,id:"mx_homeserverInput"})),i.a.createElement("p",null,Object(s.a)("Use your preferred Matrix homeserver if you have one, or host your own.")),i.a.createElement(r.a,{className:"mx_ServerPickerDialog_continue",kind:"primary",onClick:this.onSubmit},Object(s.a)("Continue")),i.a.createElement("h2",null,Object(s.a)("Learn more")),i.a.createElement("a",{href:"https://matrix.org/faq/#what-is-a-homeserver%3F",target:"_blank",rel:"noreferrer noopener"},Object(s.a)("About homeservers"))))}}var E=a(196);const _=()=>{const e=c.b.get().brand;l.a.createDialog(E.a,{title:Object(s.a)("Server Options"),description:Object(s.a)("You can use the custom server options to sign into other Matrix servers by specifying a different homeserver URL. This allows you to use %(brand)s with an existing Matrix account on a different homeserver.",{brand:e}),button:Object(s.a)("Dismiss"),hasCloseButton:!1,fixedWidth:!1},"mx_ServerPicker_helpDialog")};t.a=e=>{let{title:t,dialogTitle:a,serverConfig:n,onServerConfigChange:d}=e;const u=c.b.get("disable_custom_urls");let m;if(!u&&d){const e=()=>{((e,t,a)=>{l.a.createDialog(y,{title:e,serverConfig:t,onFinished:a})})(a,n,e=>{e&&d(e)})};m=i.a.createElement(r.a,{className:"mx_ServerPicker_change",kind:"link",onClick:e},Object(s.a)("Edit"))}let h,p=n.isNameResolvable?n.hsName:n.hsUrl;return n.hsNameIsDifferent&&(p=i.a.createElement(o.a,{class:"mx_Login_underlinedServerName",tooltip:n.hsUrl},n.hsName)),"matrix.org"===n.hsName&&(h=i.a.createElement("span",{className:"mx_ServerPicker_desc"},Object(s.a)("Join millions for free on the largest public server"))),i.a.createElement("div",{className:"mx_ServerPicker"},i.a.createElement("h2",null,t||Object(s.a)("Homeserver")),u?null:i.a.createElement(r.a,{className:"mx_ServerPicker_help",onClick:_,"aria-label":Object(s.a)("Help")}),i.a.createElement("span",{className:"mx_ServerPicker_server",title:"string"==typeof p?p:void 0},p),m,h)}},607:function(e,t,a){"use strict";var n=a(101),i=a.n(n),r=a(103),s=a.n(r),o=a(90),c=a.n(o),l=a(116),d=a(96),u=a.n(d);new(a(4).c)("delegated_oidc_compatibility","org.matrix.msc3824.delegated_oidc_compatibility");let m,h;!function(e){e.Gitlab="gitlab",e.Github="github",e.Apple="apple",e.Google="google",e.Facebook="facebook",e.Twitter="twitter"}(m||(m={})),function(e){e.LOGIN="login",e.REGISTER="register"}(h||(h={}));var p=a(124),g=a(93),v=a(91),f=a(118),b=a(131),y=a(166);const E=["matrixClient","loginType","fragmentAfterLogin","idp","primary","mini"],_=e=>{let{matrixClient:t,loginType:n,fragmentAfterLogin:r,idp:o,primary:l,mini:d}=e,h=s()(e,E);const _=o?Object(v.a)("Continue with %(provider)s",{provider:o.name}):Object(v.a)("Sign in with single sign-on"),w=()=>{var e;const a=(e=>{switch(e){case m.Apple:return"Apple";case m.Facebook:return"Facebook";case m.Github:return"GitHub";case m.Gitlab:return"GitLab";case m.Google:return"Google";default:return"SSO"}})(null!==(e=null==o?void 0:o.brand)&&void 0!==e?e:"");y.a.instance.setAuthenticationType(a),p.a.get().startSingleSignOn(t,n,r,null==o?void 0:o.id)};let S,O;const C=o?(e=>{switch(e){case m.Apple:return a(1505).default;case m.Facebook:return a(1506).default;case m.Github:return a(1507).default;case m.Gitlab:return a(1508).default;case m.Google:return a(1509).default;case m.Twitter:return a(1510).default;default:return null}})(o.brand):null;if(C){const e=o.brand.split(".").pop();O="mx_SSOButton_brand_"+e,S=c.a.createElement("img",{src:C,height:"24",width:"24",alt:e})}else if("string"==typeof(null==o?void 0:o.icon)&&o.icon.startsWith("mxc://")){const e=Object(b.b)(o.icon,t).getSquareThumbnailHttp(24);S=c.a.createElement("img",{src:e,height:"24",width:"24",alt:o.name})}const x=u()("mx_SSOButton",{[O]:O,mx_SSOButton_mini:d,mx_SSOButton_default:!o,mx_SSOButton_primary:l});return d?c.a.createElement(f.a,i()({},h,{title:_,className:x,onClick:w}),S):c.a.createElement(g.a,i()({},h,{className:x,onClick:w}),S,_)};t.a=e=>{let{matrixClient:t,flow:a,loginType:n,fragmentAfterLogin:i,primary:r}=e;const s=a.identity_providers||[];if(s.length<2)return c.a.createElement("div",{className:"mx_SSOButtons"},c.a.createElement(_,{matrixClient:t,loginType:n,fragmentAfterLogin:i,idp:s[0],primary:r}));const o=Math.ceil(s.length/6),d=Math.ceil(s.length/o);return c.a.createElement("div",{className:"mx_SSOButtons"},Object(l.chunk)(s,d).map(e=>c.a.createElement("div",{key:e[0].id,className:"mx_SSOButtons_row"},e.map(e=>c.a.createElement(_,{key:e.id,matrixClient:t,loginType:n,fragmentAfterLogin:i,idp:e,mini:!0,primary:r})))))}},608:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(6),i=a.n(n),r=a(103),s=a.n(r),o=a(90),c=a.n(o),l=a(149),d=a(91),u=a(133);const m=["room","component"];function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function g(e){let{room:t,component:a}=e,n=s()(e,m);const i=function(e){const t=u.a.shared().getUserIdForRoomId(e.roomId),a=e.getMembers().length>2;if(!e.isSpaceRoom()&&t&&!a)return{details:t};const[n,i,...r]=l.a.instance.getKnownParents(e.roomId);if(i&&(null==r||!r.length)){var s,o;const t=null===(s=e.client.getRoom(n))||void 0===s?void 0:s.name,a=null===(o=e.client.getRoom(i))||void 0===o?void 0:o.name;return{details:Object(d.a)("%(space1Name)s and %(space2Name)s",{space1Name:t,space2Name:a}),ariaLabel:Object(d.a)("In spaces %(space1Name)s and %(space2Name)s.",{space1Name:t,space2Name:a})}}if(n){var c;const t=null===(c=e.client.getRoom(n))||void 0===c?void 0:c.name,a=r.length;return{details:Object(d.a)("%(spaceName)s and %(count)s others",{spaceName:t,count:a}),ariaLabel:Object(d.a)("In %(spaceName)s and %(count)s other spaces.",{spaceName:t,count:a})}}return{details:e.getCanonicalAlias()}}(t);return i?c.a.createElement(null!=a?a:"div",p(p({},n),{},{"aria-label":i.ariaLabel}),[i.details]):null}},829:function(e,t,a){"use strict";a.d(t,"a",(function(){return v}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(1),c=a(91),l=a(92),d=a(97),u=a(431),m=a(576),h=a(601),p=a(93),g=a(104);class v extends s.a.Component{constructor(e){super(e),i()(this,"onStoreUpdate",()=>{const e=m.b.sharedInstance();e.phase!==m.a.Finished?this.setState({phase:e.phase,verificationRequest:e.verificationRequest,backupInfo:e.backupInfo,lostKeys:e.lostKeys()}):this.props.onFinished()}),i()(this,"onUsePassphraseClick",async()=>{m.b.sharedInstance().usePassPhrase()}),i()(this,"onVerifyClick",()=>{const e=l.a.get(),t=e.getUserId(),a=e.requestVerification(t);this.props.onFinished(),d.a.createDialog(u.a,{verificationRequestPromise:a,member:e.getUser(t),onFinished:async()=>{(await a).cancel(),this.props.onFinished()}})}),i()(this,"onSkipConfirmClick",()=>{m.b.sharedInstance().skipConfirm()}),i()(this,"onSkipBackClick",()=>{m.b.sharedInstance().returnAfterSkip()}),i()(this,"onResetClick",e=>{e.preventDefault();m.b.sharedInstance().reset()}),i()(this,"onResetConfirmClick",()=>{this.props.onFinished();m.b.sharedInstance().resetConfirm()}),i()(this,"onResetBackClick",()=>{m.b.sharedInstance().returnAfterReset()}),i()(this,"onDoneClick",()=>{m.b.sharedInstance().done()}),i()(this,"onEncryptionPanelClose",()=>{this.props.onFinished()});const t=m.b.sharedInstance();t.on("update",this.onStoreUpdate),t.start(),this.state={phase:t.phase,verificationRequest:t.verificationRequest,backupInfo:t.backupInfo,lostKeys:t.lostKeys()}}componentWillUnmount(){const e=m.b.sharedInstance();e.off("update",this.onStoreUpdate),e.stop()}render(){const{phase:e,lostKeys:t}=this.state;if(this.state.verificationRequest)return s.a.createElement(h.a,{layout:"dialog",verificationRequest:this.state.verificationRequest,onClose:this.onEncryptionPanelClose,member:l.a.get().getUser(this.state.verificationRequest.otherUserId),isRoomEncrypted:!1});if(e===m.a.Intro){if(t)return s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("It looks like you don't have a Security Key or any other devices you can verify against.  This device will not be able to access old encrypted messages. In order to verify your identity on this device, you'll need to reset your verification keys.")),s.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},s.a.createElement(p.a,{kind:"primary",onClick:this.onResetConfirmClick},Object(c.a)("Proceed with reset"))));{const e=m.b.sharedInstance();let t,n,i;return e.keyInfo&&(a=e.keyInfo,Boolean(a.passphrase&&a.passphrase.salt&&a.passphrase.iterations))?t=Object(c.a)("Verify with Security Key or Phrase"):e.keyInfo&&(t=Object(c.a)("Verify with Security Key")),t&&(n=s.a.createElement(p.a,{kind:"primary",onClick:this.onUsePassphraseClick},t)),e.hasDevicesToVerifyAgainst&&(i=s.a.createElement(p.a,{kind:"primary",onClick:this.onVerifyClick},Object(c.a)("Verify with another device"))),s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("Verify your identity to access encrypted messages and prove your identity to others.")),s.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},i,n),s.a.createElement("div",{className:"mx_SetupEncryptionBody_reset"},Object(c.a)("Forgotten or lost all recovery methods? <a>Reset all</a>",null,{a:e=>s.a.createElement(p.a,{kind:"link_inline",className:"mx_SetupEncryptionBody_reset_link",onClick:this.onResetClick},e)})))}}if(e===m.a.Done){let e;return e=this.state.backupInfo?s.a.createElement("p",null,Object(c.a)("Your new device is now verified. It has access to your encrypted messages, and other users will see it as trusted.")):s.a.createElement("p",null,Object(c.a)("Your new device is now verified. Other users will see it as trusted.")),s.a.createElement("div",null,s.a.createElement("div",{className:"mx_CompleteSecurity_heroIcon mx_E2EIcon_verified"}),e,s.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},s.a.createElement(p.a,{kind:"primary",onClick:this.onDoneClick},Object(c.a)("Done"))))}return e===m.a.ConfirmSkip?s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("Without verifying, you won't have access to all your messages and may appear as untrusted to others.")),s.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},s.a.createElement(p.a,{kind:"danger_outline",onClick:this.onSkipConfirmClick},Object(c.a)("I'll verify later")),s.a.createElement(p.a,{kind:"primary",onClick:this.onSkipBackClick},Object(c.a)("Go Back")))):e===m.a.ConfirmReset?s.a.createElement("div",null,s.a.createElement("p",null,Object(c.a)("Resetting your verification keys cannot be undone. After resetting, you won't have access to old encrypted messages, and any friends who have previously verified you will see security warnings until you re-verify with them.")),s.a.createElement("p",null,Object(c.a)("Please only proceed if you're sure you've lost all of your other devices and your security key.")),s.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},s.a.createElement(p.a,{kind:"danger_outline",onClick:this.onResetConfirmClick},Object(c.a)("Proceed with reset")),s.a.createElement(p.a,{kind:"primary",onClick:this.onResetBackClick},Object(c.a)("Go Back")))):e===m.a.Busy||e===m.a.Loading?s.a.createElement(g.a,null):void o.a.log("SetupEncryptionBody: Unknown phase "+e);var a}}},830:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(90),i=a.n(n),r=a(91),s=a(93),o=a(104);const c=e=>{let{text:t}=e;return i.a.createElement("div",{className:"mx_EncryptionInfo_spinner"},i.a.createElement(o.a,null),t)};t.b=e=>{let t,a,{waitingForOtherParty:n,waitingForNetwork:o,member:l,onStartVerification:d,isRoomEncrypted:u,inDialog:m,isSelfVerification:h}=e;if(n&&h)t=i.a.createElement("div",null,Object(r.a)("To proceed, please accept the verification request on your other device."));else if(n||o){let e;e=n?Object(r.a)("Waiting for %(displayName)s to accept…",{displayName:l.displayName||l.name||l.userId}):Object(r.a)("Accepting…"),t=i.a.createElement(c,{text:e})}else t=i.a.createElement(s.a,{kind:"primary",className:"mx_UserInfo_wideButton mx_UserInfo_startVerification",onClick:d},Object(r.a)("Start Verification"));return a=u?i.a.createElement("div",null,i.a.createElement("p",null,Object(r.a)("Messages in this room are end-to-end encrypted.")),i.a.createElement("p",null,Object(r.a)("Your messages are secured and only you and the recipient have the unique keys to unlock them."))):i.a.createElement("div",null,i.a.createElement("p",null,Object(r.a)("Messages in this room are not end-to-end encrypted.")),i.a.createElement("p",null,Object(r.a)("In encrypted rooms, your messages are secured and only you and the recipient have the unique keys to unlock them."))),m?t:i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{"data-test-id":"encryption-info-description",className:"mx_UserInfo_container"},i.a.createElement("h3",null,Object(r.a)("Encryption")),a),i.a.createElement("div",{className:"mx_UserInfo_container"},i.a.createElement("h3",null,Object(r.a)("Verify User")),i.a.createElement("div",null,i.a.createElement("p",null,Object(r.a)("For extra security, verify this user by checking a one-time code on both of your devices.")),i.a.createElement("p",null,Object(r.a)("To be secure, do this in person or use a trusted way to communicate.")),t)))}},831:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(91),c=a(830),l=a(93),d=a(832);class u extends s.a.Component{constructor(e){super(e),i()(this,"onMatchClick",()=>{this.setState({pending:!0}),this.props.onDone()}),i()(this,"onDontMatchClick",()=>{this.setState({cancelling:!0}),this.props.onCancel()}),this.state={pending:!1}}componentWillMount(){Object(d.a)()}render(){let e,t,a;if(this.props.sas.emoji){const a=this.props.sas.emoji.map((e,t)=>{return s.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_block",key:t},s.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_emoji"},e[0]),s.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_label"},Object(o.a)((a=e[1]).charAt(0).toUpperCase()+a.slice(1))));var a});e=s.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas"},a.slice(0,4),s.a.createElement("div",{className:"mx_VerificationShowSas_emojiSas_break"}),a.slice(4)),t=this.props.isSelf?Object(o.a)("Confirm the emoji below are displayed on both devices, in the same order:"):Object(o.a)("Verify this user by confirming the following emoji appear on their screen.")}else{if(!this.props.sas.decimal)return s.a.createElement("div",null,Object(o.a)("Unable to find a supported verification method."),s.a.createElement(l.a,{kind:"primary",onClick:this.props.onCancel},Object(o.a)("Cancel")));{const a=this.props.sas.decimal.map((e,t)=>s.a.createElement("span",{key:t},e));e=s.a.createElement("div",{className:"mx_VerificationShowSas_decimalSas"},a),t=this.props.isSelf?Object(o.a)("Verify this device by confirming the following number appears on its screen."):Object(o.a)("Verify this user by confirming the following number appears on their screen.")}}if(this.state.pending&&this.props.isSelf){let e;e=this.props.device?Object(o.a)("Waiting for you to verify on your other device, %(deviceName)s (%(deviceId)s)…",{deviceName:this.props.device?this.props.device.getDisplayName():"",deviceId:this.props.device?this.props.device.deviceId:""}):Object(o.a)("Waiting for you to verify on your other device…"),a=s.a.createElement("p",null,e)}else if(this.state.pending||this.state.cancelling){let e;if(this.state.pending){const{displayName:t}=this.props;e=Object(o.a)("Waiting for %(displayName)s to verify…",{displayName:t})}else e=Object(o.a)("Cancelling…");a=s.a.createElement(c.a,{text:e})}else a=s.a.createElement("div",{className:"mx_VerificationShowSas_buttonRow"},s.a.createElement(l.a,{onClick:this.onDontMatchClick,kind:"danger"},Object(o.a)("They don't match")),s.a.createElement(l.a,{onClick:this.onMatchClick,kind:"primary"},Object(o.a)("They match")));return s.a.createElement("div",{className:"mx_VerificationShowSas"},s.a.createElement("p",null,t),e,s.a.createElement("p",null,this.props.isSelf?"":Object(o.a)("To be secure, do this in person or use a trusted way to communicate.")),a)}}Object(o.c)("Dog"),Object(o.c)("Cat"),Object(o.c)("Lion"),Object(o.c)("Horse"),Object(o.c)("Unicorn"),Object(o.c)("Pig"),Object(o.c)("Elephant"),Object(o.c)("Rabbit"),Object(o.c)("Panda"),Object(o.c)("Rooster"),Object(o.c)("Penguin"),Object(o.c)("Turtle"),Object(o.c)("Fish"),Object(o.c)("Octopus"),Object(o.c)("Butterfly"),Object(o.c)("Flower"),Object(o.c)("Tree"),Object(o.c)("Cactus"),Object(o.c)("Mushroom"),Object(o.c)("Globe"),Object(o.c)("Moon"),Object(o.c)("Cloud"),Object(o.c)("Fire"),Object(o.c)("Banana"),Object(o.c)("Apple"),Object(o.c)("Strawberry"),Object(o.c)("Corn"),Object(o.c)("Pizza"),Object(o.c)("Cake"),Object(o.c)("Heart"),Object(o.c)("Smiley"),Object(o.c)("Robot"),Object(o.c)("Hat"),Object(o.c)("Glasses"),Object(o.c)("Spanner"),Object(o.c)("Santa"),Object(o.c)("Thumbs up"),Object(o.c)("Umbrella"),Object(o.c)("Hourglass"),Object(o.c)("Clock"),Object(o.c)("Gift"),Object(o.c)("Light bulb"),Object(o.c)("Book"),Object(o.c)("Pencil"),Object(o.c)("Paperclip"),Object(o.c)("Scissors"),Object(o.c)("Lock"),Object(o.c)("Key"),Object(o.c)("Hammer"),Object(o.c)("Telephone"),Object(o.c)("Flag"),Object(o.c)("Train"),Object(o.c)("Bicycle"),Object(o.c)("Aeroplane"),Object(o.c)("Rocket"),Object(o.c)("Trophy"),Object(o.c)("Ball"),Object(o.c)("Guitar"),Object(o.c)("Trumpet"),Object(o.c)("Bell"),Object(o.c)("Anchor"),Object(o.c)("Headphones"),Object(o.c)("Folder"),Object(o.c)("Pin")},832:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(1);async function i(){n.a.log("Checking for COLR support");const{userAgent:e}=navigator;if(e.includes("Firefox"))return n.a.log("Browser is Firefox - assuming COLR is supported"),!0;if(!e.includes("Chrome")&&e.includes("Safari"))return function(e){n.a.log("Browser is Safari - checking version for COLR support");try{const t=e.match(/Mac OS X ([\d|_]+).*Version\/([\d|.]+).*Safari/);if(t){const e=t[1],a=t[2],i=e.split("_").map(e=>parseInt(e,10)),r=a.split(".").map(e=>parseInt(e,10)),s=i[0]>=10&&i[1]>=14&&r[0]>=12;return n.a.log(`COLR support on Safari requires macOS 10.14 and Safari 12, detected Safari ${a} on macOS ${e}, COLR supported: `+s),s}}catch(e){n.a.error("Error in Safari COLR version check",e)}return n.a.warn("Couldn't determine Safari version to check COLR font support, assuming no."),!1}(e);try{const e=document.createElement("canvas"),t=e.getContext("2d"),a=new Image,i=`\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="100" style="background:#fff;fill:#000;">\n            <style type="text/css">\n                @font-face {\n                    font-family: "chromacheck-colr";\n                    src: url(data:application/x-font-woff;base64,${"d09GRgABAAAAAAKAAAwAAAAAAowAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABDT0xSAAACVAAAABYAAAAYAAIAJUNQQUwAAAJsAAAAEgAAABLJAAAQT1MvMgAAAYAAAAA6AAAAYBfxJ0pjbWFwAAABxAAAACcAAAAsAAzpM2dseWYAAAH0AAAAGgAAABoNIh0kaGVhZAAAARwAAAAvAAAANgxLumdoaGVhAAABTAAAABUAAAAkCAEEAmhtdHgAAAG8AAAABgAAAAYEAAAAbG9jYQAAAewAAAAGAAAABgANAABtYXhwAAABZAAAABsAAAAgAg4AHW5hbWUAAAIQAAAAOAAAAD4C5wsecG9zdAAAAkgAAAAMAAAAIAADAAB4AWNgZGAAYQ5+qdB4fpuvDNIsDCBwaQGTAIi+VlscBaJZGMDiHAxMIAoAtjIF/QB4AWNgZGBgYQACOAkUQQWMAAGRABAAAAB4AWNgZGBgYGJgAdMMUJILJMQgAWICAAH3AC4AeAFjYGFhYJzAwMrAwDST6QwDA0M/hGZ8zWDMyMmAChgFkDgKQMBw4CXDSwYWEBdIYgAFBgYA/8sIdAAABAAAAAAAAAB4AWNgYGBkYAZiBgYeBhYGBSDNAoRA/kuG//8hpDgjWJ4BAFVMBiYAAAAAAAANAAAAAQAAAAAEAAQAAAMAABEhESEEAPwABAD8AAAAeAEtxgUNgAAAAMHHIQTShTlOAty9/4bf7AARCwlBNhBw4L/43qXjYGUmf19TMuLcj/BJL3XfBg54AWNgZsALAAB9AAR4AWNgYGAEYj4gFgGygGwICQACOwAoAAAAAAABAAEAAQAAAA4AAAAAyP8AAA=="}) format("woff");\n                }\n            </style>\n            <text x="0" y="0" font-size="20">\n                <tspan font-family="chromacheck-colr" x="0" dy="20">&#xe900;</tspan>\n            </text>\n        </svg>`;e.width=20,e.height=100,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i),n.a.log("Waiting for COLR SVG to load"),await new Promise(e=>a.onload=e),n.a.log("Drawing canvas to detect COLR support"),t.drawImage(a,0,0);const r=200===t.getImageData(10,10,1,1).data[0];return n.a.log("Canvas check revealed COLR is supported? "+r),r}catch(e){return n.a.error("Couldn't load COLR font",e),!1}}let r=!1;async function s(){if(!r)if(r=!0,await i()){const e=`url('${a(1403)}')`;document.fonts.add(new FontFace("Twemoji",e,{})),document.fonts.add(new FontFace("Twemoji",e,{weight:"600"})),document.fonts.add(new FontFace("Twemoji",e,{weight:"700"}))}else{const e=`url('${a(1404)}')`;document.fonts.add(new FontFace("Twemoji",e,{})),document.fonts.add(new FontFace("Twemoji",e,{weight:"600"})),document.fonts.add(new FontFace("Twemoji",e,{weight:"700"}))}}},833:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 9.27V3.05L9 1l7 2.05v6.22C16 15.63 9 17 9 17s-7-1.37-7-7.73zM8.92 4.4c-.57.04-.99.54-.94 1.11l.32 4c.03.35.3.62.65.65h.06c.37 0 .68-.28.71-.65l.32-4v-.16a1.06 1.06 0 00-1.12-.95zm.96 7.72a.88.88 0 11-1.76 0 .88.88 0 011.76 0z",fill:"#020202"})))}t.default="img/e2e/warning-deprecated.78bb264.svg"},834:function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return r})),a.d(t,"a",(function(){return o}));const n=e=>"io.element.matrix_client_information."+e,i=async(e,t,a)=>{const i=e.getDeviceId(),{brand:r}=t,s=await a.getAppVersion(),o=n(i),c=(()=>{if(window.electron)return;const e=new URL(window.location.href);return[e.host,e.pathname.replace(/\/$/,"")].join("")})();await e.setAccountData(o,{name:r,version:s,url:c})},r=async e=>{const t=e.getDeviceId(),a=n(t),i=o(e,t);(i.name||i.version||i.url)&&await e.setAccountData(a,{})},s=e=>e&&"string"==typeof e?e:void 0,o=(e,t)=>{const a=e.getAccountData(n(t));if(!a)return{};const{name:i,version:r,url:o}=a.getContent();return{name:s(i),version:s(r),url:s(o)}}},835:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return l}));var n=a(6),i=a.n(n),r=a(8),s=a.n(r),o=a(720);function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}class l extends s.a{static get instance(){return l._instance||(l._instance=new l),l._instance}storeInvite(e,t){const a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({roomId:e},t),n=this.generateIdOf(a);return localStorage.setItem("mx_threepid_invite_"+n,JSON.stringify(a)),this.translateInvite(a)}getWireInvites(){const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);a.startsWith("mx_threepid_invite_")&&e.push(JSON.parse(localStorage.getItem(a)))}return e}getInvites(){return this.getWireInvites().map(e=>this.translateInvite(e))}pickBestInvite(){return this.getInvites()[0]}resolveInvite(e){localStorage.removeItem("mx_threepid_invite_"+e.id)}generateIdOf(t){return o.base32.stringify(e.from(JSON.stringify(t)))}translateInvite(e){return{id:this.generateIdOf(e),roomId:e.roomId,toEmail:e.email,signUrl:e.signurl,roomName:e.room_name,roomAvatarUrl:e.room_avatar_url,inviterName:e.inviter_name}}translateToWireFormat(e){return{email:e.toEmail,signurl:e.signUrl,room_name:e.roomName,room_avatar_url:e.roomAvatarUrl,inviter_name:e.inviterName}}}i()(l,"_instance",void 0)}).call(this,a(31).Buffer)},836:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(90),i=a.n(n),r=a(96),s=a.n(r),o=a(180),c=a(230);class l extends i.a.Component{render(){const{fallbackName:e,member:t,colored:a,emphasizeDisplayName:n,onClick:r}=this.props,l=(null==t?void 0:t.rawDisplayName)||e,d=null==t?void 0:t.userId;let u,m;a&&(u=Object(o.f)(e)),null!=t&&t.disambiguate&&d&&(m=i.a.createElement("span",{className:"mx_DisambiguatedProfile_mxid"},c.a.getDisplayUserIdentifier(d,{withDisplayName:!0,roomId:t.roomId})));const h=s()({mx_DisambiguatedProfile_displayName:n,[u]:!0});return i.a.createElement("div",{className:"mx_DisambiguatedProfile",onClick:r},i.a.createElement("span",{className:h,dir:"auto"},l),m)}}},837:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20 1a1 1 0 00-1 1v2h-2a1 1 0 100 2h2v2a1 1 0 102 0V6h2a1 1 0 100-2h-2V2a1 1 0 00-1-1zM7 9.5C7 8.67 7.67 8 8.5 8s1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5zm8.5 1.5c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zM12 17.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5zM4 12a8 8 0 019.774-7.803 1 1 0 10.442-1.95A10.03 10.03 0 0012 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10c0-.212-.007-.423-.02-.632a1 1 0 10-1.996.125A8 8 0 114 12z",fill:"currentColor"})))}},838:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n,i,r=a(90);function s(){return(s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function o(e){return r.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),n||(n=r.createElement("path",{d:"M10.066 14.25h1.57c1.858 0 3.364-1.567 3.364-3.5s-1.506-3.5-3.364-3.5H4.534",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"})),i||(i=r.createElement("path",{d:"M6.524 3.75L3 7.286l3.524 3.535",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}},839:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(6),i=a.n(n),r=a(166);class s{constructor(e,t){this.failedEventId=e,this.errorCode=t,i()(this,"ts",void 0),this.ts=Date.now()}}class o{constructor(e,t){if(this.fn=e,this.errorCodeMapFn=t,i()(this,"failures",new Map),i()(this,"visibleEvents",new Set),i()(this,"visibleFailures",new Map),i()(this,"failureCounts",{}),i()(this,"trackedEvents",new Set),i()(this,"checkInterval",null),i()(this,"trackInterval",null),!e||"function"!=typeof e)throw new Error("DecryptionFailureTracker requires tracking function");if("function"!=typeof t)throw new Error("DecryptionFailureTracker second constructor argument should be a function")}static get instance(){return o.internalInstance}eventDecrypted(e,t){"m.megolm.v1.aes-sha2"==e.getWireContent().algorithm&&(t?this.addDecryptionFailure(new s(e.getId(),t.code)):this.removeDecryptionFailuresForEvent(e))}addVisibleEvent(e){const t=e.getId();this.trackedEvents.has(t)||(this.visibleEvents.add(t),this.failures.has(t)&&!this.visibleFailures.has(t)&&this.visibleFailures.set(t,this.failures.get(t)))}addDecryptionFailure(e){const t=e.failedEventId;this.trackedEvents.has(t)||(this.failures.set(t,e),this.visibleEvents.has(t)&&!this.visibleFailures.has(t)&&this.visibleFailures.set(t,e))}removeDecryptionFailuresForEvent(e){const t=e.getId();this.failures.delete(t),this.visibleFailures.delete(t)}start(){this.checkInterval=setInterval(()=>this.checkFailures(Date.now()),o.CHECK_INTERVAL_MS),this.trackInterval=setInterval(()=>this.trackFailures(),o.TRACK_INTERVAL_MS)}stop(){clearInterval(this.checkInterval),clearInterval(this.trackInterval),this.failures=new Map,this.visibleEvents=new Set,this.visibleFailures=new Map,this.failureCounts={}}checkFailures(e){const t=new Set,a=new Map;for(const[n,i]of this.visibleFailures)e>i.ts+o.GRACE_PERIOD_MS?(t.add(i),this.trackedEvents.add(n)):a.set(n,i);this.visibleFailures=a,this.aggregateFailures(t)}aggregateFailures(e){for(const t of e){const e=t.errorCode;this.failureCounts[e]=(this.failureCounts[e]||0)+1}}trackFailures(){for(const e of Object.keys(this.failureCounts))if(this.failureCounts[e]>0){const t=this.errorCodeMapFn(e);this.fn(this.failureCounts[e],t,e),this.failureCounts[e]=0}}}i()(o,"internalInstance",new o((e,t,a)=>{for(let n=0;n<e;n++)r.a.instance.trackEvent({eventName:"Error",domain:"E2EE",name:t,context:"mxc_crypto_error_type_"+a})},e=>{switch(e){case"MEGOLM_UNKNOWN_INBOUND_SESSION_ID":return"OlmKeysNotSentError";case"OLM_UNKNOWN_MESSAGE_INDEX":return"OlmIndexError";case void 0:return"OlmUnspecifiedError";default:return"UnknownError"}})),i()(o,"TRACK_INTERVAL_MS",6e4),i()(o,"CHECK_INTERVAL_MS",5e3),i()(o,"GRACE_PERIOD_MS",4e3)},840:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(4),c=a(91);const l=new o.c("busy","org.matrix.msc3026.busy");class d extends s.a.Component{getDuration(e){if(!e)return;const t=Math.round(e/1e3),a=t%60,n=Math.round(t/60)%60,i=Math.round(t/3600)%24,r=Math.round(t/86400);return t<60?t<0?Object(c.a)("%(duration)ss",{duration:0}):Object(c.a)("%(duration)ss",{duration:a}):t<3600?Object(c.a)("%(duration)sm",{duration:n}):t<86400?Object(c.a)("%(duration)sh",{duration:i}):Object(c.a)("%(duration)sd",{duration:r})}getPrettyPresence(e,t,a){if(l.matches(e))return Object(c.a)("Busy");if(!a&&void 0!==t&&t>0){const a=this.getDuration(t);return"online"===e?Object(c.a)("Online for %(duration)s",{duration:a}):"unavailable"===e?Object(c.a)("Idle for %(duration)s",{duration:a}):"offline"===e?Object(c.a)("Offline for %(duration)s",{duration:a}):Object(c.a)("Unknown for %(duration)s",{duration:a})}return"online"===e?Object(c.a)("Online"):"unavailable"===e?Object(c.a)("Idle"):"offline"===e?Object(c.a)("Offline"):Object(c.a)("Unknown")}render(){return s.a.createElement("div",{className:"mx_PresenceLabel"},this.getPrettyPresence(this.props.presenceState,this.props.activeAgo,this.props.currentlyActive))}}i()(d,"defaultProps",{activeAgo:-1,presenceState:null})},841:function(e,t,a){"use strict";a.r(t),a.d(t,"Icon",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("g",{fill:"none",fillRule:"evenodd"},i.createElement("path",{fill:"#ECECEC",d:"M0 0h24v24H0z"}),i.createElement("path",{d:"M7.338 13.154c.504 0 .826-.378.826-.882 0-.518-.322-.882-.826-.882-.49 0-.826.364-.826.882-.014.504.336.882.826.882zm4.662 0c.504 0 .84-.378.84-.882-.014-.518-.336-.882-.826-.882-.49 0-.84.364-.84.882-.014.504.336.882.826.882zm4.662 0c.518 0 .84-.378.84-.882 0-.518-.336-.882-.826-.882-.49 0-.84.364-.84.882 0 .504.336.882.826.882z",fill:"#454545"}))))}t.default="img/ellipsis.c2118e5.svg"},842:function(e,t,a){"use strict";var n=a(90),i=a.n(n),r=a(147);t.a=e=>{let{value:t,label:a,byline:n,disabled:s,onChange:o}=e;return i.a.createElement("label",{className:"mx_LabelledCheckbox"},i.a.createElement(r.b,{disabled:s,checked:t,onChange:e=>o(e.target.checked)}),i.a.createElement("div",{className:"mx_LabelledCheckbox_labels"},i.a.createElement("span",{className:"mx_LabelledCheckbox_label"},a),n?i.a.createElement("span",{className:"mx_LabelledCheckbox_byline"},n):null))}},843:function(e,t,a){"use strict";var n=a(242),i=function(){function e(t,a){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._dispatcher=function(e){e&&e.length||n(!1),!1;return e[0].getDispatcher()}(t);var r=t.map((function(e){return e.getDispatchToken()}));this._dispatchToken=this._dispatcher.register((function(e){i._dispatcher.waitFor(r),a()}))}return e.prototype.release=function(){this._dispatcher.unregister(this._dispatchToken)},e}();e.exports=i},844:function(e,t,a){"use strict";var n=a(845),i=a(1425),r=a(242),s=function(e){function t(a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.call(this,a),this._state=this.getInitialState()}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getState=function(){return this._state},t.prototype.getInitialState=function(){return i("FluxReduceStore","getInitialState")},t.prototype.reduce=function(e,t){return i("FluxReduceStore","reduce")},t.prototype.areEqual=function(e,t){return e===t},t.prototype.__invokeOnDispatch=function(e){this.__changed=!1;var t=this._state,a=this.reduce(t,e);void 0===a&&r(!1),this.areEqual(t,a)||(this._state=a,this.__emitChange()),this.__changed&&this.__emitter.emit(this.__changeEvent)},t}(n);e.exports=s},845:function(e,t,a){"use strict";var n=a(1420).EventEmitter,i=a(242),r=function(){function e(t){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.__className=this.constructor.name,this.__changed=!1,this.__changeEvent="change",this.__dispatcher=t,this.__emitter=new n,this._dispatchToken=t.register((function(e){a.__invokeOnDispatch(e)}))}return e.prototype.addListener=function(e){return this.__emitter.addListener(this.__changeEvent,e)},e.prototype.getDispatcher=function(){return this.__dispatcher},e.prototype.getDispatchToken=function(){return this._dispatchToken},e.prototype.hasChanged=function(){return this.__dispatcher.isDispatching()||i(!1),this.__changed},e.prototype.__emitChange=function(){this.__dispatcher.isDispatching()||i(!1),this.__changed=!0},e.prototype.__invokeOnDispatch=function(e){this.__changed=!1,this.__onDispatch(e),this.__changed&&this.__emitter.emit(this.__changeEvent)},e.prototype.__onDispatch=function(e){i(!1)},e}();e.exports=r},846:function(e,t,a){"use strict";var n=function(e){function t(a,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e.call(this,a),this.listener=n,this.context=i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(a(1422));e.exports=n},847:function(e,t,a){"use strict";e.exports=function(e,t,a,n,i,r,s,o){if(!e){var c;if(void 0===t)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[a,n,i,r,s,o],d=0;(c=new Error(t.replace(/%s/g,(function(){return l[d++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},848:function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return u}));var n=a(90),i=a.n(n),r=a(94),s=a(97),o=a(91),c=a(123),l=a(98);const d=/^[a-z0-9=_\-./]+$/;async function u(e){void 0===e&&(e={});const t=s.a.createDialog(c.a,{hasCancelButton:!0,quitOnly:!0,title:Object(o.a)("Sign In or Create Account"),description:Object(o.a)("Use your account or create a new one to continue."),button:Object(o.a)("Create Account"),extraButtons:[i.a.createElement("button",{key:"start_login",onClick:()=>{t.close(),r.a.dispatch({action:"start_login",screenAfterLogin:e.screen_after})}},Object(o.a)("Sign In"))],onFinished:t=>{t?r.a.dispatch({action:"start_registration",screenAfterLogin:e.screen_after}):e.go_home_on_cancel?r.a.dispatch({action:l.a.ViewHomePage}):e.go_welcome_on_cancel&&r.a.dispatch({action:"view_welcome_page"})}})}},849:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(6),i=a.n(n),r=a(99);class s{constructor(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.root=e,this.pageSize=t,this.maxDepth=a,this.suggestedOnly=n,i()(this,"viaMap",new Map),i()(this,"backRefs",new Map),i()(this,"roomMap",new Map),i()(this,"loadRequest",void 0),i()(this,"nextBatch",void 0),i()(this,"_rooms",void 0),i()(this,"serverSupportError",void 0)}get noSupport(){return!!this.serverSupportError}get canLoadMore(){return!!this.serverSupportError||!!this.nextBatch||!this._rooms}get loading(){return!!this.loadRequest}get rooms(){return this._rooms}async load(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pageSize;if(this.loadRequest)return this.loadRequest.then(e=>e.rooms);this.loadRequest=this.root.client.getRoomHierarchy(this.root.roomId,t,this.maxDepth,this.suggestedOnly,this.nextBatch);try{({rooms:e,next_batch:this.nextBatch}=await this.loadRequest)}catch(e){if("M_UNRECOGNIZED"!==e.errcode)throw e;return this.serverSupportError=e,[]}finally{this.loadRequest=void 0}return this._rooms?this._rooms=this._rooms.concat(e):this._rooms=e,e.forEach(e=>{this.roomMap.set(e.room_id,e),e.children_state.forEach(t=>{if(t.type!==r.b.SpaceChild)return;const a=t.state_key;if(this.backRefs.has(a)||this.backRefs.set(a,[]),this.backRefs.get(a).push(e.room_id),Array.isArray(t.content.via)){this.viaMap.has(a)||this.viaMap.set(a,new Set);const e=this.viaMap.get(a);t.content.via.forEach(t=>e.add(t))}})}),e}getRelation(e,t){var a;return null===(a=this.roomMap.get(e))||void 0===a?void 0:a.children_state.find(e=>e.state_key===t)}isSuggested(e,t){var a;return null===(a=this.getRelation(e,t))||void 0===a?void 0:a.content.suggested}removeRelation(e,t){const a=this.backRefs.get(t);1===(null==a?void 0:a.length)?this.backRefs.delete(t):null!=a&&a.length&&this.backRefs.set(t,a.filter(t=>t!==e));const n=this.roomMap.get(e);n&&(n.children_state=n.children_state.filter(e=>e.state_key!==t))}}},850:function(e,t,a){"use strict";a.d(t,"b",(function(){return v}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(91),c=a(95),l=a(106),d=a(147),u=a(142),m=a(177),h=a(127);function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function g(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}const v=(e,t)=>a=>{const n=c.b.getValue("Spaces.enabledMetaSpaces");c.b.setValue("Spaces.enabledMetaSpaces",null,l.a.ACCOUNT,g(g({},n),{},{[e]:a.target.checked})),h.b.trackInteraction(t,a,[m.a.Home,null,m.a.Favourites,m.a.People,m.a.Orphans].indexOf(e))};t.a=()=>{const{[m.a.Home]:e,[m.a.Favourites]:t,[m.a.People]:a,[m.a.Orphans]:n}=Object(u.b)("Spaces.enabledMetaSpaces"),i=Object(u.b)("Spaces.allRoomsInHome");return s.a.createElement("div",{className:"mx_SettingsTab mx_SidebarUserSettingsTab"},s.a.createElement("div",{className:"mx_SettingsTab_heading"},Object(o.a)("Sidebar")),s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("div",{className:"mx_SettingsTab_subheading"},Object(o.a)("Spaces to show")),s.a.createElement("div",{className:"mx_SettingsTab_subsectionText"},Object(o.a)("Spaces are ways to group rooms and people. Alongside the spaces you're in, you can use some pre-built ones too.")),s.a.createElement(d.b,{checked:!!e,onChange:v(m.a.Home,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_homeCheckbox",disabled:e},Object(o.a)("Home")),s.a.createElement("div",{className:"mx_SidebarUserSettingsTab_checkboxMicrocopy"},Object(o.a)("Home is useful for getting an overview of everything.")),s.a.createElement(d.b,{checked:i,disabled:!e,onChange:e=>{c.b.setValue("Spaces.allRoomsInHome",null,l.a.ACCOUNT,e.target.checked),h.b.trackInteraction("WebSettingsSidebarTabSpacesCheckbox",e,1)},className:"mx_SidebarUserSettingsTab_homeAllRoomsCheckbox"},Object(o.a)("Show all rooms")),s.a.createElement("div",{className:"mx_SidebarUserSettingsTab_checkboxMicrocopy"},Object(o.a)("Show all your rooms in Home, even if they're in a space.")),s.a.createElement(d.b,{checked:!!t,onChange:v(m.a.Favourites,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_favouritesCheckbox"},Object(o.a)("Favourites")),s.a.createElement("div",{className:"mx_SidebarUserSettingsTab_checkboxMicrocopy"},Object(o.a)("Group all your favourite rooms and people in one place.")),s.a.createElement(d.b,{checked:!!a,onChange:v(m.a.People,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_peopleCheckbox"},Object(o.a)("People")),s.a.createElement("div",{className:"mx_SidebarUserSettingsTab_checkboxMicrocopy"},Object(o.a)("Group all your people in one place.")),s.a.createElement(d.b,{checked:!!n,onChange:v(m.a.Orphans,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_orphansCheckbox"},Object(o.a)("Rooms outside of a space")),s.a.createElement("div",{className:"mx_SidebarUserSettingsTab_checkboxMicrocopy"},Object(o.a)("Group all your rooms that aren't part of a space in one place."))))}},851:function(e,t,a){"use strict";a.d(t,"a",(function(){return w}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(1),c=a(91),l=a(95),d=a(280),u=a(427),m=a(93),h=a(94),p=a(98),g=a(147),v=a(108),f=a(311),b=a(106),y=a(127);function E(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function _(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?E(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):E(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class w extends s.a.Component{constructor(e){super(e),i()(this,"themeTimer",void 0),i()(this,"onThemeChange",e=>{if(this.state.theme===e)return;y.b.trackInteraction("WebSettingsAppearanceTabThemeSelector");const t=l.b.getValue("theme");l.b.setValue("theme",null,b.a.DEVICE,e).catch(()=>{h.a.dispatch({action:p.a.RecheckTheme}),this.setState({theme:t})}),this.setState({theme:e}),h.a.dispatch({action:p.a.RecheckTheme,forceTheme:e})}),i()(this,"onUseSystemThemeChanged",e=>{this.setState({useSystemTheme:e}),l.b.setValue("use_system_theme",null,b.a.DEVICE,e),h.a.dispatch({action:p.a.RecheckTheme})}),i()(this,"onAddCustomTheme",async()=>{let e=l.b.getValue("custom_themes");e||(e=[]),e=e.map(e=>e),this.themeTimer&&clearTimeout(this.themeTimer);try{const t=await fetch(this.state.customThemeUrl),a=await t.json();if(!a||"string"!=typeof a.name||"object"!=typeof a.colors)return void this.setState({customThemeMessage:{text:Object(c.a)("Invalid theme schema."),isError:!0}});e.push(a)}catch(e){return o.a.error(e),void this.setState({customThemeMessage:{text:Object(c.a)("Error downloading theme information."),isError:!0}})}await l.b.setValue("custom_themes",null,b.a.ACCOUNT,e),this.setState({customThemeUrl:"",customThemeMessage:{text:Object(c.a)("Theme added!"),isError:!1}}),this.themeTimer=setTimeout(()=>{this.setState({customThemeMessage:{text:"",isError:!1}})},3e3)}),i()(this,"onCustomThemeChange",e=>{this.setState({customThemeUrl:e.target.value})}),this.state=_(_({},w.calculateThemeState()),{},{customThemeUrl:"",customThemeMessage:{isError:!1,text:""}})}static calculateThemeState(){const e=l.b.getValue("theme"),t=l.b.getValueAt(b.a.DEVICE,"use_system_theme",null,!1,!0),a=l.b.getValueAt(b.a.DEVICE,"theme",null,!1,!0);return t?{theme:e,useSystemTheme:!0}:a?{theme:e,useSystemTheme:!1}:{theme:e,useSystemTheme:l.b.getValueAt(b.a.DEVICE,"use_system_theme")}}renderHighContrastCheckbox(){if(!this.state.useSystemTheme&&(Object(d.c)(this.state.theme)||Object(d.g)(this.state.theme)))return s.a.createElement("div",null,s.a.createElement(g.b,{checked:Object(d.g)(this.state.theme),onChange:e=>this.highContrastThemeChanged(e.target.checked)},Object(c.a)("Use high contrast")))}highContrastThemeChanged(e){let t;t=e?Object(d.c)(this.state.theme):Object(d.d)(this.state.theme),t&&this.onThemeChange(t)}render(){let e,t;if((new u.a).isSystemThemeSupported()&&(e=s.a.createElement("div",null,s.a.createElement(g.b,{checked:this.state.useSystemTheme,onChange:e=>this.onUseSystemThemeChanged(e.target.checked)},l.b.getDisplayName("use_system_theme")))),l.b.getValue("feature_custom_themes")){let e=null;this.state.customThemeMessage.text&&(e=this.state.customThemeMessage.isError?s.a.createElement("div",{className:"text-error"},this.state.customThemeMessage.text):s.a.createElement("div",{className:"text-success"},this.state.customThemeMessage.text)),t=s.a.createElement("div",{className:"mx_SettingsTab_section"},s.a.createElement("form",{onSubmit:this.onAddCustomTheme},s.a.createElement(v.a,{label:Object(c.a)("Custom theme URL"),type:"text",id:"mx_GeneralUserSettingsTab_customThemeInput",autoComplete:"off",onChange:this.onCustomThemeChange,value:this.state.customThemeUrl}),s.a.createElement(m.a,{onClick:this.onAddCustomTheme,type:"submit",kind:"primary_sm",disabled:!this.state.customThemeUrl.trim()},Object(c.a)("Add theme")),e))}const a=Object(d.f)();return s.a.createElement("div",{className:"mx_SettingsTab_section mx_ThemeChoicePanel"},s.a.createElement("span",{className:"mx_SettingsTab_subheading"},Object(c.a)("Theme")),e,s.a.createElement("div",{className:"mx_ThemeSelectors"},s.a.createElement(f.a,{name:"theme",definitions:a.map(e=>({value:e.id,label:e.name,disabled:this.state.useSystemTheme,className:"mx_ThemeSelector_"+e.id})),onChange:this.onThemeChange,value:this.apparentSelectedThemeId(),outlined:!0})),this.renderHighContrastCheckbox(),t)}apparentSelectedThemeId(){if(this.state.useSystemTheme)return;const e=Object(d.d)(this.state.theme);return e||this.state.theme}}},852:function(e,t,a){"use strict";t.__esModule=!0,t.setBatch=t.getBatch=void 0;var n=function(e){e()};t.setBatch=function(e){return n=e};t.getBatch=function(){return n}},853:function(e,t,a){"use strict";var n=a(140).default,i=a(212).default;t.__esModule=!0,t.default=function(e,t){void 0===t&&(t={});var a=t,n=a.getDisplayName,i=void 0===n?function(e){return"ConnectAdvanced("+e+")"}:n,u=a.methodName,w=void 0===u?"connectAdvanced":u,S=a.renderCountProp,O=void 0===S?void 0:S,C=a.shouldHandleStateChanges,x=void 0===C||C,k=a.storeKey,j=void 0===k?"store":k,R=(a.withRef,a.forwardRef),I=void 0!==R&&R,T=a.context,N=void 0===T?m.ReactReduxContext:T,D=(0,s.default)(a,h);0;var P=N;return function(t){var a=t.displayName||t.name||"Component",n=i(a),u=(0,r.default)({},D,{getDisplayName:i,methodName:w,renderCountProp:O,shouldHandleStateChanges:x,storeKey:j,displayName:n,wrappedComponentName:a,WrappedComponent:t}),m=D.pure;var h=m?c.useMemo:function(e){return e()};function S(a){var n=(0,c.useMemo)((function(){var e=a.reactReduxForwardedRef,t=(0,s.default)(a,p);return[a.context,e,t]}),[a]),i=n[0],o=n[1],m=n[2],w=(0,c.useMemo)((function(){return i&&i.Consumer&&(0,l.isContextConsumer)(c.default.createElement(i.Consumer,null))?i:P}),[i,P]),S=(0,c.useContext)(w),O=Boolean(a.store)&&Boolean(a.store.getState)&&Boolean(a.store.dispatch);Boolean(S)&&Boolean(S.store);var C=O?a.store:S.store,k=(0,c.useMemo)((function(){return function(t){return e(t.dispatch,u)}(C)}),[C]),j=(0,c.useMemo)((function(){if(!x)return v;var e=(0,d.createSubscription)(C,O?null:S.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[C,O,S]),R=j[0],I=j[1],T=(0,c.useMemo)((function(){return O?S:(0,r.default)({},S,{subscription:R})}),[O,S,R]),N=(0,c.useReducer)(f,g,_),D=N[0][0],M=N[1];if(D&&D.error)throw D.error;var A=(0,c.useRef)(),L=(0,c.useRef)(m),U=(0,c.useRef)(),F=(0,c.useRef)(!1),B=h((function(){return U.current&&m===L.current?U.current:k(C.getState(),m)}),[C,D,m]);b(y,[L,A,F,m,B,U,I]),b(E,[x,C,R,k,L,A,F,U,I,M],[C,R,k]);var V=(0,c.useMemo)((function(){return c.default.createElement(t,(0,r.default)({},B,{ref:o}))}),[o,t,B]);return(0,c.useMemo)((function(){return x?c.default.createElement(w.Provider,{value:T},V):V}),[w,V,T])}var C=m?c.default.memo(S):S;if(C.WrappedComponent=t,C.displayName=S.displayName=n,I){var k=c.default.forwardRef((function(e,t){return c.default.createElement(C,(0,r.default)({},e,{reactReduxForwardedRef:t}))}));return k.displayName=n,k.WrappedComponent=t,(0,o.default)(k,t)}return(0,o.default)(C,t)}};var r=n(a(101)),s=n(a(372)),o=n(a(1448)),c=i(a(90)),l=a(1451),d=a(587),u=a(588),m=a(281),h=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],p=["reactReduxForwardedRef"],g=[],v=[null,null];function f(e,t){var a=e[1];return[t.payload,a+1]}function b(e,t,a){(0,u.useIsomorphicLayoutEffect)((function(){return e.apply(void 0,t)}),a)}function y(e,t,a,n,i,r,s){e.current=n,t.current=i,a.current=!1,r.current&&(r.current=null,s())}function E(e,t,a,n,i,r,s,o,c,l){if(e){var d=!1,u=null,m=function(){if(!d){var e,a,m=t.getState();try{e=n(m,i.current)}catch(e){a=e,u=e}a||(u=null),e===r.current?s.current||c():(r.current=e,o.current=e,s.current=!0,l({type:"STORE_UPDATED",payload:{error:a}}))}};a.onStateChange=m,a.trySubscribe(),m();return function(){if(d=!0,a.tryUnsubscribe(),a.onStateChange=null,u)throw u}}}var _=function(){return[null,0]}},854:function(e,t,a){"use strict";function n(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.__esModule=!0,t.default=function(e,t){if(n(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return!1;for(var r=0;r<a.length;r++)if(!Object.prototype.hasOwnProperty.call(t,a[r])||!n(e[a[r]],t[a[r]]))return!1;return!0}},855:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.getDependsOnOwnProps=i,t.wrapMapToPropsConstant=function(e){return function(t,a){var n=e(t,a);function i(){return n}return i.dependsOnOwnProps=!1,i}},t.wrapMapToPropsFunc=function(e,t){return function(t,a){a.displayName;var n=function(e,t){return n.dependsOnOwnProps?n.mapToProps(e,t):n.mapToProps(e)};return n.dependsOnOwnProps=!0,n.mapToProps=function(t,a){n.mapToProps=e,n.dependsOnOwnProps=i(e);var r=n(t,a);return"function"==typeof r&&(n.mapToProps=r,n.dependsOnOwnProps=i(r),r=n(t,a)),r},n}};n(a(856));function i(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},856:function(e,t,a){"use strict";var n=a(140).default;t.__esModule=!0,t.default=function(e,t,a){(0,i.default)(e)||(0,r.default)(a+"() in "+t+" must return a plain object. Instead received "+e+".")};var i=n(a(1456)),r=n(a(857))},857:function(e,t,a){"use strict";t.__esModule=!0,t.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},858:function(e,t,a){"use strict";t.__esModule=!0,t.createStoreHook=s,t.useStore=void 0;var n=a(90),i=a(281),r=a(859);function s(e){void 0===e&&(e=i.ReactReduxContext);var t=e===i.ReactReduxContext?r.useReduxContext:function(){return(0,n.useContext)(e)};return function(){return t().store}}var o=s();t.useStore=o},859:function(e,t,a){"use strict";t.__esModule=!0,t.useReduxContext=function(){0;return(0,n.useContext)(i.ReactReduxContext)};var n=a(90),i=a(281)},860:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(96),i=a.n(n),r=a(99),s=a(90),o=a.n(s),c=a(102),l=a(109),d=a(562),u=a(265),m=a(93),h=a(104);const p=52;t.b=e=>{var t;let{hasAvatar:a,hasAvatarLabel:n,noAvatarLabel:p,setAvatarUrl:g,isUserAvatar:v,children:f,onClick:b}=e;const y=Object(s.useContext)(c.a),[E,_]=Object(s.useState)(!1),[w,S]=Object(s.useState)(!1),[O,C]=Object(s.useState)(!1);Object(d.c)(()=>{C(!0)},3e3),Object(d.c)(()=>{C(!1)},13e3);const x=Object(s.useRef)(),k=a||E?n:p,{room:j}=Object(s.useContext)(l.b);if(!(v||(null==j||null===(t=j.currentState)||void 0===t?void 0:t.maySendStateEvent(r.b.RoomAvatar,y.getUserId()))))return o.a.createElement(o.a.Fragment,null,f);const R=!!k&&(w||O);return o.a.createElement(o.a.Fragment,null,o.a.createElement("input",{type:"file",ref:x,className:"mx_MiniAvatarUploader_input",onClick:e=>{Object(u.a)(e),null==b||b(e)},onChange:async e=>{var t;if(null===(t=e.target.files)||void 0===t||!t.length)return;_(!0);const a=e.target.files[0],{content_uri:n}=await y.uploadContent(a);await g(n),_(!1)},accept:"image/*"}),o.a.createElement(m.a,{className:i()("mx_MiniAvatarUploader",{mx_MiniAvatarUploader_busy:E,mx_MiniAvatarUploader_hasAvatar:a}),disabled:E,onClick:()=>{x.current.click()},onMouseOver:()=>S(!0),onMouseLeave:()=>S(!1)},f,o.a.createElement("div",{className:"mx_MiniAvatarUploader_indicator"},E?o.a.createElement(h.a,{w:20,h:20}):o.a.createElement("div",{className:"mx_MiniAvatarUploader_cameraIcon"})),o.a.createElement("div",{className:i()("mx_Tooltip",{mx_Tooltip_visible:R,mx_Tooltip_invisible:!R})},o.a.createElement("div",{className:"mx_Tooltip_chevron"}),k)))}},861:function(e,t){e.exports="img/user-onboarding/PersonalMessaging.d386442.png"},862:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return s})),a.d(t,"d",(function(){return o}));var n=a(91);let i,r;!function(e){e.Html="Html",e.PlainText="PlainText",e.Json="Json"}(i||(i={})),function(e){e.Timeline="Timeline",e.Beginning="Beginning",e.LastNMessages="LastNMessages"}(r||(r={}));const s=e=>{switch(e){case i.Html:return Object(n.a)("HTML");case i.Json:return Object(n.a)("JSON");case i.PlainText:return Object(n.a)("Plain Text");default:throw new Error("Unknown format")}},o=e=>{switch(e){case r.Beginning:return Object(n.a)("From the beginning");case r.LastNMessages:return Object(n.a)("Specify a number of messages");case r.Timeline:return Object(n.a)("Current Timeline");default:throw new Error("Unknown type: "+e)}}},863:function(e,t,a){"use strict";(function(e){var n=a(90),i=a.n(n),r=a(99),s=a(102),o=a(109),c=a(133),l=a(91),d=a(93),u=a(860),m=a(132),h=a(94),p=a(98),g=a(149),v=a(221),f=a(279),b=a(367),y=a(92),E=a(189),_=a(126),w=a(305),S=a(299);t.a=()=>{var t;const a=Object(n.useContext)(s.a),{room:O,roomId:C}=Object(n.useContext)(o.b),x=O instanceof S.b,k=x?null===(t=O.targets[0])||void 0===t?void 0:t.userId:c.a.shared().getUserIdForRoomId(C);let j;if(k){let e,t=Object(l.a)("This is the beginning of your direct message history with <displayName/>.");x?t=Object(l.a)("Send your first message to invite <displayName/> to chat"):O.getJoinedMemberCount()+O.getInvitedMemberCount()===2&&(e=Object(l.a)("Only the two of you are in this conversation, unless either of you invites anyone to join."));const a=null==O?void 0:O.getMember(k),n=(null==O?void 0:O.name)||(null==a?void 0:a.rawDisplayName)||k;j=i.a.createElement(i.a.Fragment,null,i.a.createElement(m.a,{room:O,width:u.a,height:u.a,onClick:()=>{h.a.dispatch({action:p.a.ViewUser,member:a||{userId:k}})}}),i.a.createElement("h2",null,O.name),i.a.createElement("p",null,Object(l.a)(t,{},{displayName:()=>i.a.createElement("b",null,n)})),e&&i.a.createElement("p",null,e))}else{var R,I,T,N,D,P,M;const t=O&&"join"===O.getMyMembership(),n=null===(R=O.currentState.getStateEvents(r.b.RoomTopic,""))||void 0===R||null===(I=R.getContent())||void 0===I?void 0:I.topic,s=t&&O.currentState.maySendStateEvent(r.b.RoomTopic,a.getUserId()),o=()=>{h.a.dispatch({action:"open_room_settings",room_id:C},!0),e(()=>{window.document.getElementById("profileTopic").focus()})};let c;s&&n?c=Object(l.a)("Topic: %(topic)s (<a>edit</a>)",{topic:n},{a:e=>i.a.createElement(d.a,{kind:"link_inline",onClick:o},e)}):n?c=Object(l.a)("Topic: %(topic)s ",{topic:n}):s&&(c=Object(l.a)("<a>Add a topic</a> to help people know what it is about.",{},{a:e=>i.a.createElement(d.a,{kind:"link_inline",onClick:o},e)}));const p=null===(T=O.currentState.getStateEvents(r.b.RoomCreate,""))||void 0===T?void 0:T.getSender(),f=(null==O||null===(N=O.getMember(p))||void 0===N?void 0:N.rawDisplayName)||p;let b,y,w;b=p===a.getUserId()?Object(l.a)("You created this room."):Object(l.a)("%(displayName)s created this room.",{displayName:f}),null!==(D=g.a.instance.activeSpaceRoom)&&void 0!==D&&D.canInvite(a.getUserId())&&g.a.instance.isRoomInSpace(g.a.instance.activeSpace,O.roomId)&&(y=g.a.instance.activeSpaceRoom),y&&Object(E.a)(_.a.InviteUsers)?w=i.a.createElement("div",{className:"mx_NewRoomIntro_buttons"},i.a.createElement(d.a,{className:"mx_NewRoomIntro_inviteButton",kind:"primary",onClick:()=>{Object(v.i)(y)}},Object(l.a)("Invite to %(spaceName)s",{spaceName:y.name})),O.canInvite(a.getUserId())&&i.a.createElement(d.a,{className:"mx_NewRoomIntro_inviteButton",kind:"primary_outline",onClick:()=>{h.a.dispatch({action:"view_invite",roomId:C})}},Object(l.a)("Invite to just this room"))):O.canInvite(a.getUserId())&&Object(E.a)(_.a.InviteUsers)&&(w=i.a.createElement("div",{className:"mx_NewRoomIntro_buttons"},i.a.createElement(d.a,{className:"mx_NewRoomIntro_inviteButton",kind:"primary",onClick:()=>{h.a.dispatch({action:"view_invite",roomId:C})}},Object(l.a)("Invite to this room"))));const S=null===(P=O.currentState.getStateEvents(r.b.RoomAvatar,""))||void 0===P||null===(M=P.getContent())||void 0===M?void 0:M.url;let x=i.a.createElement(m.a,{room:O,width:u.a,height:u.a,viewAvatarOnClick:!!S});S||(x=i.a.createElement(u.b,{hasAvatar:!1,noAvatarLabel:Object(l.a)("Add a photo, so people can easily spot your room."),setAvatarUrl:e=>a.sendStateEvent(C,r.b.RoomAvatar,{url:e},"")},x)),j=i.a.createElement(i.a.Fragment,null,x,i.a.createElement("h2",null,O.name),i.a.createElement("p",null,b," ",Object(l.a)("This is the start of <roomName/>.",{},{roomName:()=>i.a.createElement("b",null,O.name)})),i.a.createElement("p",null,c),w)}const A=Object(l.a)("Your private messages are normally encrypted, but this room isn't. Usually this is due to an unsupported device or method being used, like email invites.");let L;O.currentState.mayClientSendStateEvent(r.b.RoomEncryption,y.a.get())&&!x&&(L=i.a.createElement(d.a,{kind:"link_inline",onClick:function(e){e.preventDefault(),h.a.dispatch({action:"open_room_settings",initial_tab_id:b.b})}},Object(l.a)("Enable encryption in settings.")));const U=i.a.createElement("span",null," ",A," ",L," ");return i.a.createElement("li",{className:"mx_NewRoomIntro"},!function(e,t){const a=e.isRoomEncrypted(t.roomId);return"public"===t.getJoinRule()||!Object(w.c)()||a}(a,O)&&i.a.createElement(f.a,{className:"mx_cryptoEvent mx_cryptoEvent_icon_warning",title:Object(l.a)("End-to-end encryption isn't enabled"),subtitle:U}),j)}}).call(this,a(192).setImmediate)},864:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n,i=a(90);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function s(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 10",role:"presentation","aria-hidden":!0},e),n||(n=i.createElement("path",{d:"M1 1l8 8M9.001 1l-8 8",stroke:"currentColor",strokeWidth:1.6,strokeLinecap:"round"})))}},865:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"c",(function(){return y})),a.d(t,"b",(function(){return E}));var n=a(90),i=a.n(n),r=a(91),s=a(100),o=a(94),c=a(93),l=a(219),d=a(165),u=a(866),m=a(98),h=a(95);const p=()=>{o.a.dispatch({action:m.a.PseudonymousAnalyticsAccept})},g=()=>{o.a.dispatch({action:m.a.PseudonymousAnalyticsReject})},v=()=>{Object(u.b)({onFinished:e=>{e===u.a.Primary&&p()},primaryButton:Object(r.a)("Enable")})},f=()=>{Object(u.b)({onFinished:e=>{e===u.a.Primary?p():e===u.a.Cancel&&g()},primaryButton:Object(r.a)("That's fine"),cancelButton:Object(r.a)("Stop")})};function b(){return s.b.get("privacy_policy_url")}const y=()=>{var e;const t=h.b.getValue("analyticsOptIn",null,!0);let a;if(t)a={description:Object(r.a)("You previously consented to share anonymous usage data with us. We're updating how that works."),acceptLabel:Object(r.a)("That's fine"),onAccept:p,rejectLabel:Object(r.a)("Learn more"),onReject:f};else{if(null!=t)return;{const e=e=>i.a.createElement(c.a,{kind:"link_inline",onClick:v},e);a={description:Object(r.a)("Share anonymous data to help us identify issues. Nothing personal. No third parties. <LearnMoreLink>Learn More</LearnMoreLink>",{},{LearnMoreLink:e}),acceptLabel:Object(r.a)("Yes"),onAccept:p,rejectLabel:Object(r.a)("No"),onReject:g}}}const n=null!==(e=s.b.get("analytics_owner"))&&void 0!==e?e:s.b.get().brand;d.a.sharedInstance().addOrReplaceToast({key:"analytics",title:Object(r.a)("Help improve %(analyticsOwner)s",{analyticsOwner:n}),props:a,component:l.a,className:"mx_AnalyticsToast",priority:10})},E=()=>{d.a.sharedInstance().dismissToast("analytics")}},866:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return v}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(105),c=a(91),l=a(115),d=a(97),u=a(100),m=a(865);function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}let p;!function(e){e[e.Primary=0]="Primary",e[e.Cancel=1]="Cancel"}(p||(p={}));const g=e=>{let{onFinished:t,analyticsOwner:a,privacyPolicyUrl:n,primaryButton:i,cancelButton:r,hasCancel:d}=e;const u=n?s.a.createElement("span",null,Object(c.a)("You can read all our terms <PrivacyPolicyUrl>here</PrivacyPolicyUrl>",{},{PrivacyPolicyUrl:e=>s.a.createElement("a",{href:n,rel:"norefferer noopener",target:"_blank"},e,s.a.createElement("span",{className:"mx_AnalyticsPolicyLink"}))})):"";return s.a.createElement(o.a,{className:"mx_AnalyticsLearnMoreDialog",contentId:"mx_AnalyticsLearnMore",title:Object(c.a)("Help improve %(analyticsOwner)s",{analyticsOwner:a}),onFinished:t},s.a.createElement("div",{className:"mx_Dialog_content"},s.a.createElement("div",{className:"mx_AnalyticsLearnMore_image_holder"}),s.a.createElement("div",{className:"mx_AnalyticsLearnMore_copy"},Object(c.a)("Help us identify issues and improve %(analyticsOwner)s by sharing anonymous usage data. To understand how people use multiple devices, we'll generate a random identifier, shared by your devices.",{analyticsOwner:a})),s.a.createElement("ul",{className:"mx_AnalyticsLearnMore_bullets"},s.a.createElement("li",null,Object(c.a)("We <Bold>don't</Bold> record or profile any account data",{},{Bold:e=>s.a.createElement("b",null,e)})),s.a.createElement("li",null,Object(c.a)("We <Bold>don't</Bold> share information with third parties",{},{Bold:e=>s.a.createElement("b",null,e)})),s.a.createElement("li",null,Object(c.a)("You can turn this off anytime in settings"))),u),s.a.createElement(l.a,{primaryButton:i,cancelButton:r,onPrimaryButtonClick:()=>t&&t(p.Primary),onCancel:()=>t&&t(p.Cancel),hasCancel:d}))},v=e=>{var t;const a=Object(m.a)(),n=null!==(t=u.b.get("analytics_owner"))&&void 0!==t?t:u.b.get("brand");d.a.createDialog(g,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({privacyPolicyUrl:a,analyticsOwner:n},e),"mx_AnalyticsLearnMoreDialog_wrapper")}},867:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(91),c=a(95),l=a(104),d=a(248);class u extends s.a.Component{constructor(e){super(e),i()(this,"onSearchChange",e=>{this.setState({searchQuery:e})}),this.state={searchQuery:"",langs:null}}componentDidMount(){if(o.d().then(e=>{e.sort((function(e,t){return e.label<t.label?-1:e.label>t.label?1:0})),this.setState({langs:e})}).catch(()=>{this.setState({langs:[{value:"en",label:"English"}]})}),!this.props.value){const e=o.h();this.props.onOptionChange(e)}}render(){if(null===this.state.langs)return s.a.createElement(l.a,null);let e;e=this.state.searchQuery?this.state.langs.filter(e=>function(e,t){return!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e)):this.state.langs;const t=e.map(e=>s.a.createElement("div",{key:e.value},e.label));let a=c.b.getValue("language",null,!0),n=null;return a||(a=navigator.language||navigator.userLanguage),n=this.props.value||a,s.a.createElement(d.a,{id:"mx_LanguageDropdown",className:this.props.className,onOptionChange:this.props.onOptionChange,onSearchChange:this.onSearchChange,searchEnabled:!0,value:n,label:Object(o.a)("Language Dropdown"),disabled:this.props.disabled},t)}}},868:function(e,t,a){"use strict";a.d(t,"c",(function(){return r})),a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return l}));var n=a(91);const i=/^[0-9 -.]+$/;function r(e){return i.test(e)}const s=127462-"A".charCodeAt(0),o=/^[A-Z]{2}$/,c=e=>o.test(e)?String.fromCodePoint(...e.split("").map(e=>s+e.charCodeAt(0))):"",l=[{iso2:"GB",name:Object(n.c)("United Kingdom"),prefix:"44"},{iso2:"US",name:Object(n.c)("United States"),prefix:"1"},{iso2:"AF",name:Object(n.c)("Afghanistan"),prefix:"93"},{iso2:"AX",name:Object(n.c)("Åland Islands"),prefix:"358"},{iso2:"AL",name:Object(n.c)("Albania"),prefix:"355"},{iso2:"DZ",name:Object(n.c)("Algeria"),prefix:"213"},{iso2:"AS",name:Object(n.c)("American Samoa"),prefix:"1"},{iso2:"AD",name:Object(n.c)("Andorra"),prefix:"376"},{iso2:"AO",name:Object(n.c)("Angola"),prefix:"244"},{iso2:"AI",name:Object(n.c)("Anguilla"),prefix:"1"},{iso2:"AQ",name:Object(n.c)("Antarctica"),prefix:"672"},{iso2:"AG",name:Object(n.c)("Antigua & Barbuda"),prefix:"1"},{iso2:"AR",name:Object(n.c)("Argentina"),prefix:"54"},{iso2:"AM",name:Object(n.c)("Armenia"),prefix:"374"},{iso2:"AW",name:Object(n.c)("Aruba"),prefix:"297"},{iso2:"AU",name:Object(n.c)("Australia"),prefix:"61"},{iso2:"AT",name:Object(n.c)("Austria"),prefix:"43"},{iso2:"AZ",name:Object(n.c)("Azerbaijan"),prefix:"994"},{iso2:"BS",name:Object(n.c)("Bahamas"),prefix:"1"},{iso2:"BH",name:Object(n.c)("Bahrain"),prefix:"973"},{iso2:"BD",name:Object(n.c)("Bangladesh"),prefix:"880"},{iso2:"BB",name:Object(n.c)("Barbados"),prefix:"1"},{iso2:"BY",name:Object(n.c)("Belarus"),prefix:"375"},{iso2:"BE",name:Object(n.c)("Belgium"),prefix:"32"},{iso2:"BZ",name:Object(n.c)("Belize"),prefix:"501"},{iso2:"BJ",name:Object(n.c)("Benin"),prefix:"229"},{iso2:"BM",name:Object(n.c)("Bermuda"),prefix:"1"},{iso2:"BT",name:Object(n.c)("Bhutan"),prefix:"975"},{iso2:"BO",name:Object(n.c)("Bolivia"),prefix:"591"},{iso2:"BA",name:Object(n.c)("Bosnia"),prefix:"387"},{iso2:"BW",name:Object(n.c)("Botswana"),prefix:"267"},{iso2:"BV",name:Object(n.c)("Bouvet Island"),prefix:"47"},{iso2:"BR",name:Object(n.c)("Brazil"),prefix:"55"},{iso2:"IO",name:Object(n.c)("British Indian Ocean Territory"),prefix:"246"},{iso2:"VG",name:Object(n.c)("British Virgin Islands"),prefix:"1"},{iso2:"BN",name:Object(n.c)("Brunei"),prefix:"673"},{iso2:"BG",name:Object(n.c)("Bulgaria"),prefix:"359"},{iso2:"BF",name:Object(n.c)("Burkina Faso"),prefix:"226"},{iso2:"BI",name:Object(n.c)("Burundi"),prefix:"257"},{iso2:"KH",name:Object(n.c)("Cambodia"),prefix:"855"},{iso2:"CM",name:Object(n.c)("Cameroon"),prefix:"237"},{iso2:"CA",name:Object(n.c)("Canada"),prefix:"1"},{iso2:"CV",name:Object(n.c)("Cape Verde"),prefix:"238"},{iso2:"BQ",name:Object(n.c)("Caribbean Netherlands"),prefix:"599"},{iso2:"KY",name:Object(n.c)("Cayman Islands"),prefix:"1"},{iso2:"CF",name:Object(n.c)("Central African Republic"),prefix:"236"},{iso2:"TD",name:Object(n.c)("Chad"),prefix:"235"},{iso2:"CL",name:Object(n.c)("Chile"),prefix:"56"},{iso2:"CN",name:Object(n.c)("China"),prefix:"86"},{iso2:"CX",name:Object(n.c)("Christmas Island"),prefix:"61"},{iso2:"CC",name:Object(n.c)("Cocos (Keeling) Islands"),prefix:"61"},{iso2:"CO",name:Object(n.c)("Colombia"),prefix:"57"},{iso2:"KM",name:Object(n.c)("Comoros"),prefix:"269"},{iso2:"CG",name:Object(n.c)("Congo - Brazzaville"),prefix:"242"},{iso2:"CD",name:Object(n.c)("Congo - Kinshasa"),prefix:"243"},{iso2:"CK",name:Object(n.c)("Cook Islands"),prefix:"682"},{iso2:"CR",name:Object(n.c)("Costa Rica"),prefix:"506"},{iso2:"HR",name:Object(n.c)("Croatia"),prefix:"385"},{iso2:"CU",name:Object(n.c)("Cuba"),prefix:"53"},{iso2:"CW",name:Object(n.c)("Curaçao"),prefix:"599"},{iso2:"CY",name:Object(n.c)("Cyprus"),prefix:"357"},{iso2:"CZ",name:Object(n.c)("Czech Republic"),prefix:"420"},{iso2:"CI",name:Object(n.c)("Côte d’Ivoire"),prefix:"225"},{iso2:"DK",name:Object(n.c)("Denmark"),prefix:"45"},{iso2:"DJ",name:Object(n.c)("Djibouti"),prefix:"253"},{iso2:"DM",name:Object(n.c)("Dominica"),prefix:"1"},{iso2:"DO",name:Object(n.c)("Dominican Republic"),prefix:"1"},{iso2:"EC",name:Object(n.c)("Ecuador"),prefix:"593"},{iso2:"EG",name:Object(n.c)("Egypt"),prefix:"20"},{iso2:"SV",name:Object(n.c)("El Salvador"),prefix:"503"},{iso2:"GQ",name:Object(n.c)("Equatorial Guinea"),prefix:"240"},{iso2:"ER",name:Object(n.c)("Eritrea"),prefix:"291"},{iso2:"EE",name:Object(n.c)("Estonia"),prefix:"372"},{iso2:"ET",name:Object(n.c)("Ethiopia"),prefix:"251"},{iso2:"FK",name:Object(n.c)("Falkland Islands"),prefix:"500"},{iso2:"FO",name:Object(n.c)("Faroe Islands"),prefix:"298"},{iso2:"FJ",name:Object(n.c)("Fiji"),prefix:"679"},{iso2:"FI",name:Object(n.c)("Finland"),prefix:"358"},{iso2:"FR",name:Object(n.c)("France"),prefix:"33"},{iso2:"GF",name:Object(n.c)("French Guiana"),prefix:"594"},{iso2:"PF",name:Object(n.c)("French Polynesia"),prefix:"689"},{iso2:"TF",name:Object(n.c)("French Southern Territories"),prefix:"262"},{iso2:"GA",name:Object(n.c)("Gabon"),prefix:"241"},{iso2:"GM",name:Object(n.c)("Gambia"),prefix:"220"},{iso2:"GE",name:Object(n.c)("Georgia"),prefix:"995"},{iso2:"DE",name:Object(n.c)("Germany"),prefix:"49"},{iso2:"GH",name:Object(n.c)("Ghana"),prefix:"233"},{iso2:"GI",name:Object(n.c)("Gibraltar"),prefix:"350"},{iso2:"GR",name:Object(n.c)("Greece"),prefix:"30"},{iso2:"GL",name:Object(n.c)("Greenland"),prefix:"299"},{iso2:"GD",name:Object(n.c)("Grenada"),prefix:"1"},{iso2:"GP",name:Object(n.c)("Guadeloupe"),prefix:"590"},{iso2:"GU",name:Object(n.c)("Guam"),prefix:"1"},{iso2:"GT",name:Object(n.c)("Guatemala"),prefix:"502"},{iso2:"GG",name:Object(n.c)("Guernsey"),prefix:"44"},{iso2:"GN",name:Object(n.c)("Guinea"),prefix:"224"},{iso2:"GW",name:Object(n.c)("Guinea-Bissau"),prefix:"245"},{iso2:"GY",name:Object(n.c)("Guyana"),prefix:"592"},{iso2:"HT",name:Object(n.c)("Haiti"),prefix:"509"},{iso2:"HM",name:Object(n.c)("Heard & McDonald Islands"),prefix:"672"},{iso2:"HN",name:Object(n.c)("Honduras"),prefix:"504"},{iso2:"HK",name:Object(n.c)("Hong Kong"),prefix:"852"},{iso2:"HU",name:Object(n.c)("Hungary"),prefix:"36"},{iso2:"IS",name:Object(n.c)("Iceland"),prefix:"354"},{iso2:"IN",name:Object(n.c)("India"),prefix:"91"},{iso2:"ID",name:Object(n.c)("Indonesia"),prefix:"62"},{iso2:"IR",name:Object(n.c)("Iran"),prefix:"98"},{iso2:"IQ",name:Object(n.c)("Iraq"),prefix:"964"},{iso2:"IE",name:Object(n.c)("Ireland"),prefix:"353"},{iso2:"IM",name:Object(n.c)("Isle of Man"),prefix:"44"},{iso2:"IL",name:Object(n.c)("Israel"),prefix:"972"},{iso2:"IT",name:Object(n.c)("Italy"),prefix:"39"},{iso2:"JM",name:Object(n.c)("Jamaica"),prefix:"1"},{iso2:"JP",name:Object(n.c)("Japan"),prefix:"81"},{iso2:"JE",name:Object(n.c)("Jersey"),prefix:"44"},{iso2:"JO",name:Object(n.c)("Jordan"),prefix:"962"},{iso2:"KZ",name:Object(n.c)("Kazakhstan"),prefix:"7"},{iso2:"KE",name:Object(n.c)("Kenya"),prefix:"254"},{iso2:"KI",name:Object(n.c)("Kiribati"),prefix:"686"},{iso2:"XK",name:Object(n.c)("Kosovo"),prefix:"383"},{iso2:"KW",name:Object(n.c)("Kuwait"),prefix:"965"},{iso2:"KG",name:Object(n.c)("Kyrgyzstan"),prefix:"996"},{iso2:"LA",name:Object(n.c)("Laos"),prefix:"856"},{iso2:"LV",name:Object(n.c)("Latvia"),prefix:"371"},{iso2:"LB",name:Object(n.c)("Lebanon"),prefix:"961"},{iso2:"LS",name:Object(n.c)("Lesotho"),prefix:"266"},{iso2:"LR",name:Object(n.c)("Liberia"),prefix:"231"},{iso2:"LY",name:Object(n.c)("Libya"),prefix:"218"},{iso2:"LI",name:Object(n.c)("Liechtenstein"),prefix:"423"},{iso2:"LT",name:Object(n.c)("Lithuania"),prefix:"370"},{iso2:"LU",name:Object(n.c)("Luxembourg"),prefix:"352"},{iso2:"MO",name:Object(n.c)("Macau"),prefix:"853"},{iso2:"MK",name:Object(n.c)("Macedonia"),prefix:"389"},{iso2:"MG",name:Object(n.c)("Madagascar"),prefix:"261"},{iso2:"MW",name:Object(n.c)("Malawi"),prefix:"265"},{iso2:"MY",name:Object(n.c)("Malaysia"),prefix:"60"},{iso2:"MV",name:Object(n.c)("Maldives"),prefix:"960"},{iso2:"ML",name:Object(n.c)("Mali"),prefix:"223"},{iso2:"MT",name:Object(n.c)("Malta"),prefix:"356"},{iso2:"MH",name:Object(n.c)("Marshall Islands"),prefix:"692"},{iso2:"MQ",name:Object(n.c)("Martinique"),prefix:"596"},{iso2:"MR",name:Object(n.c)("Mauritania"),prefix:"222"},{iso2:"MU",name:Object(n.c)("Mauritius"),prefix:"230"},{iso2:"YT",name:Object(n.c)("Mayotte"),prefix:"262"},{iso2:"MX",name:Object(n.c)("Mexico"),prefix:"52"},{iso2:"FM",name:Object(n.c)("Micronesia"),prefix:"691"},{iso2:"MD",name:Object(n.c)("Moldova"),prefix:"373"},{iso2:"MC",name:Object(n.c)("Monaco"),prefix:"377"},{iso2:"MN",name:Object(n.c)("Mongolia"),prefix:"976"},{iso2:"ME",name:Object(n.c)("Montenegro"),prefix:"382"},{iso2:"MS",name:Object(n.c)("Montserrat"),prefix:"1"},{iso2:"MA",name:Object(n.c)("Morocco"),prefix:"212"},{iso2:"MZ",name:Object(n.c)("Mozambique"),prefix:"258"},{iso2:"MM",name:Object(n.c)("Myanmar"),prefix:"95"},{iso2:"NA",name:Object(n.c)("Namibia"),prefix:"264"},{iso2:"NR",name:Object(n.c)("Nauru"),prefix:"674"},{iso2:"NP",name:Object(n.c)("Nepal"),prefix:"977"},{iso2:"NL",name:Object(n.c)("Netherlands"),prefix:"31"},{iso2:"NC",name:Object(n.c)("New Caledonia"),prefix:"687"},{iso2:"NZ",name:Object(n.c)("New Zealand"),prefix:"64"},{iso2:"NI",name:Object(n.c)("Nicaragua"),prefix:"505"},{iso2:"NE",name:Object(n.c)("Niger"),prefix:"227"},{iso2:"NG",name:Object(n.c)("Nigeria"),prefix:"234"},{iso2:"NU",name:Object(n.c)("Niue"),prefix:"683"},{iso2:"NF",name:Object(n.c)("Norfolk Island"),prefix:"672"},{iso2:"KP",name:Object(n.c)("North Korea"),prefix:"850"},{iso2:"MP",name:Object(n.c)("Northern Mariana Islands"),prefix:"1"},{iso2:"NO",name:Object(n.c)("Norway"),prefix:"47"},{iso2:"OM",name:Object(n.c)("Oman"),prefix:"968"},{iso2:"PK",name:Object(n.c)("Pakistan"),prefix:"92"},{iso2:"PW",name:Object(n.c)("Palau"),prefix:"680"},{iso2:"PS",name:Object(n.c)("Palestine"),prefix:"970"},{iso2:"PA",name:Object(n.c)("Panama"),prefix:"507"},{iso2:"PG",name:Object(n.c)("Papua New Guinea"),prefix:"675"},{iso2:"PY",name:Object(n.c)("Paraguay"),prefix:"595"},{iso2:"PE",name:Object(n.c)("Peru"),prefix:"51"},{iso2:"PH",name:Object(n.c)("Philippines"),prefix:"63"},{iso2:"PN",name:Object(n.c)("Pitcairn Islands"),prefix:"870"},{iso2:"PL",name:Object(n.c)("Poland"),prefix:"48"},{iso2:"PT",name:Object(n.c)("Portugal"),prefix:"351"},{iso2:"PR",name:Object(n.c)("Puerto Rico"),prefix:"1"},{iso2:"QA",name:Object(n.c)("Qatar"),prefix:"974"},{iso2:"RO",name:Object(n.c)("Romania"),prefix:"40"},{iso2:"RU",name:Object(n.c)("Russia"),prefix:"7"},{iso2:"RW",name:Object(n.c)("Rwanda"),prefix:"250"},{iso2:"RE",name:Object(n.c)("Réunion"),prefix:"262"},{iso2:"WS",name:Object(n.c)("Samoa"),prefix:"685"},{iso2:"SM",name:Object(n.c)("San Marino"),prefix:"378"},{iso2:"SA",name:Object(n.c)("Saudi Arabia"),prefix:"966"},{iso2:"SN",name:Object(n.c)("Senegal"),prefix:"221"},{iso2:"RS",name:Object(n.c)("Serbia"),prefix:"381 p"},{iso2:"SC",name:Object(n.c)("Seychelles"),prefix:"248"},{iso2:"SL",name:Object(n.c)("Sierra Leone"),prefix:"232"},{iso2:"SG",name:Object(n.c)("Singapore"),prefix:"65"},{iso2:"SX",name:Object(n.c)("Sint Maarten"),prefix:"1"},{iso2:"SK",name:Object(n.c)("Slovakia"),prefix:"421"},{iso2:"SI",name:Object(n.c)("Slovenia"),prefix:"386"},{iso2:"SB",name:Object(n.c)("Solomon Islands"),prefix:"677"},{iso2:"SO",name:Object(n.c)("Somalia"),prefix:"252"},{iso2:"ZA",name:Object(n.c)("South Africa"),prefix:"27"},{iso2:"GS",name:Object(n.c)("South Georgia & South Sandwich Islands"),prefix:"500"},{iso2:"KR",name:Object(n.c)("South Korea"),prefix:"82"},{iso2:"SS",name:Object(n.c)("South Sudan"),prefix:"211"},{iso2:"ES",name:Object(n.c)("Spain"),prefix:"34"},{iso2:"LK",name:Object(n.c)("Sri Lanka"),prefix:"94"},{iso2:"BL",name:Object(n.c)("St. Barthélemy"),prefix:"590"},{iso2:"SH",name:Object(n.c)("St. Helena"),prefix:"290 n"},{iso2:"KN",name:Object(n.c)("St. Kitts & Nevis"),prefix:"1"},{iso2:"LC",name:Object(n.c)("St. Lucia"),prefix:"1"},{iso2:"MF",name:Object(n.c)("St. Martin"),prefix:"590"},{iso2:"PM",name:Object(n.c)("St. Pierre & Miquelon"),prefix:"508"},{iso2:"VC",name:Object(n.c)("St. Vincent & Grenadines"),prefix:"1"},{iso2:"SD",name:Object(n.c)("Sudan"),prefix:"249"},{iso2:"SR",name:Object(n.c)("Suriname"),prefix:"597"},{iso2:"SJ",name:Object(n.c)("Svalbard & Jan Mayen"),prefix:"47"},{iso2:"SZ",name:Object(n.c)("Swaziland"),prefix:"268"},{iso2:"SE",name:Object(n.c)("Sweden"),prefix:"46"},{iso2:"CH",name:Object(n.c)("Switzerland"),prefix:"41"},{iso2:"SY",name:Object(n.c)("Syria"),prefix:"963"},{iso2:"ST",name:Object(n.c)("São Tomé & Príncipe"),prefix:"239"},{iso2:"TW",name:Object(n.c)("Taiwan"),prefix:"886"},{iso2:"TJ",name:Object(n.c)("Tajikistan"),prefix:"992"},{iso2:"TZ",name:Object(n.c)("Tanzania"),prefix:"255"},{iso2:"TH",name:Object(n.c)("Thailand"),prefix:"66"},{iso2:"TL",name:Object(n.c)("Timor-Leste"),prefix:"670"},{iso2:"TG",name:Object(n.c)("Togo"),prefix:"228"},{iso2:"TK",name:Object(n.c)("Tokelau"),prefix:"690"},{iso2:"TO",name:Object(n.c)("Tonga"),prefix:"676"},{iso2:"TT",name:Object(n.c)("Trinidad & Tobago"),prefix:"1"},{iso2:"TN",name:Object(n.c)("Tunisia"),prefix:"216"},{iso2:"TR",name:Object(n.c)("Turkey"),prefix:"90"},{iso2:"TM",name:Object(n.c)("Turkmenistan"),prefix:"993"},{iso2:"TC",name:Object(n.c)("Turks & Caicos Islands"),prefix:"1"},{iso2:"TV",name:Object(n.c)("Tuvalu"),prefix:"688"},{iso2:"VI",name:Object(n.c)("U.S. Virgin Islands"),prefix:"1"},{iso2:"UG",name:Object(n.c)("Uganda"),prefix:"256"},{iso2:"UA",name:Object(n.c)("Ukraine"),prefix:"380"},{iso2:"AE",name:Object(n.c)("United Arab Emirates"),prefix:"971"},{iso2:"UY",name:Object(n.c)("Uruguay"),prefix:"598"},{iso2:"UZ",name:Object(n.c)("Uzbekistan"),prefix:"998"},{iso2:"VU",name:Object(n.c)("Vanuatu"),prefix:"678"},{iso2:"VA",name:Object(n.c)("Vatican City"),prefix:"39"},{iso2:"VE",name:Object(n.c)("Venezuela"),prefix:"58"},{iso2:"VN",name:Object(n.c)("Vietnam"),prefix:"84"},{iso2:"WF",name:Object(n.c)("Wallis & Futuna"),prefix:"681"},{iso2:"EH",name:Object(n.c)("Western Sahara"),prefix:"212"},{iso2:"YE",name:Object(n.c)("Yemen"),prefix:"967"},{iso2:"ZM",name:Object(n.c)("Zambia"),prefix:"260"},{iso2:"ZW",name:Object(n.c)("Zimbabwe"),prefix:"263"}]},869:function(e,t,a){"use strict";var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(108),c=a(169),l=a(91);class d extends r.PureComponent{constructor(){super(...arguments),i()(this,"validate",Object(c.a)({rules:[{key:"required",test:e=>{let{value:t,allowEmpty:a}=e;return a||!!t},invalid:()=>Object(l.a)(this.props.labelRequired)},{key:"match",test:e=>{let{value:t}=e;return!t||t===this.props.password},invalid:()=>Object(l.a)(this.props.labelInvalid)}]})),i()(this,"onValidate",async e=>{const t=await this.validate(e);return this.props.onValidate&&this.props.onValidate(t),t})}render(){return s.a.createElement(o.a,{id:this.props.id,ref:this.props.fieldRef,type:"password",label:Object(l.a)(this.props.label),autoComplete:this.props.autoComplete,value:this.props.value,onChange:this.props.onChange,onValidate:this.onValidate})}}i()(d,"defaultProps",{label:Object(l.c)("Confirm password"),labelRequired:Object(l.c)("Confirm password"),labelInvalid:Object(l.c)("Passwords don't match")}),t.a=d},870:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return E})),a.d(t,"b",(function(){return w}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(597),c=a(1495),l=a(1496),d=a(1),u=a(91),m=a(93),h=a(411),p=a(104),g=a(1497),v=a(1498),f=a(417),b=a(1499),y=a(1500);let E;var _;!function(e){e.Show="show"}(E||(E={})),function(e){e[e.Loading=0]="Loading",e[e.ShowingQR=1]="ShowingQR",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected",e[e.WaitingForDevice=4]="WaitingForDevice",e[e.Verifying=5]="Verifying",e[e.Error=6]="Error"}(_||(_={}));class w extends s.a.Component{constructor(e){super(e),i()(this,"approveLogin",async()=>{if(!this.state.rendezvous)throw new Error("Rendezvous not found");this.setState({phase:_.Loading});try{d.a.info("Requesting login token");const{login_token:e}=await Object(y.a)(this.props.client.requestLoginToken,{matrixClient:this.props.client,title:Object(u.a)("Sign in new device")})();this.setState({phase:_.WaitingForDevice});if(!await this.state.rendezvous.approveLoginOnExistingDevice(e))return;if(!this.props.client.crypto)return void this.props.onFinished(!0);await this.state.rendezvous.verifyNewDeviceOnExistingDevice(),this.props.onFinished(!0)}catch(e){d.a.error("Error whilst approving sign in",e),this.setState({phase:_.Error,failureReason:o.c.Unknown})}}),i()(this,"generateCode",async()=>{let e;try{const t=new c.a({onFailure:this.onFailure,client:this.props.client}),a=new l.a(t,void 0,this.onFailure);e=new o.a(a,this.props.client,this.onFailure),await e.generateCode(),this.setState({phase:_.ShowingQR,rendezvous:e,failureReason:void 0})}catch(e){return d.a.error("Error whilst generating QR code",e),void this.setState({phase:_.Error,failureReason:o.c.HomeserverLacksSupport})}try{const t=await e.startAfterShowingCode();this.setState({phase:_.Connected,confirmationDigits:t})}catch(e){d.a.error("Error whilst doing QR login",e),this.state.phase!==_.Error&&this.setState({phase:_.Error,failureReason:o.c.Unknown})}}),i()(this,"onFailure",e=>{d.a.info("Rendezvous failed: "+e),this.setState({phase:_.Error,failureReason:e})}),i()(this,"cancelClicked",async e=>{var t;e.preventDefault(),await(null===(t=this.state.rendezvous)||void 0===t?void 0:t.cancel(o.c.UserCancelled)),this.reset(),this.props.onFinished(!1)}),i()(this,"declineClicked",async e=>{var t;e.preventDefault(),await(null===(t=this.state.rendezvous)||void 0===t?void 0:t.declineLoginOnExistingDevice()),this.reset(),this.props.onFinished(!1)}),i()(this,"tryAgainClicked",async e=>{e.preventDefault(),this.reset(),await this.updateMode(this.props.mode)}),i()(this,"onBackClick",async()=>{var e;await(null===(e=this.state.rendezvous)||void 0===e?void 0:e.cancel(o.c.UserCancelled)),this.props.onFinished(!1)}),i()(this,"cancelButton",()=>s.a.createElement(m.a,{kind:"primary_outline",onClick:this.cancelClicked},Object(u.a)("Cancel"))),i()(this,"simpleSpinner",e=>s.a.createElement("div",{className:"mx_LoginWithQR_spinner"},s.a.createElement("div",null,s.a.createElement(p.a,null),e&&s.a.createElement("p",null,e)))),this.state={phase:_.Loading}}componentDidMount(){this.updateMode(this.props.mode).then(()=>{})}componentDidUpdate(e){e.mode!==this.props.mode&&this.updateMode(this.props.mode).then(()=>{})}async updateMode(e){this.setState({phase:_.Loading}),this.state.rendezvous&&(this.state.rendezvous.onFailure=void 0,await this.state.rendezvous.cancel(o.c.UserCancelled),this.setState({rendezvous:void 0})),e===E.Show&&await this.generateCode()}componentWillUnmount(){this.state.rendezvous&&(this.state.rendezvous.onFailure=void 0,this.state.rendezvous.cancel(o.c.UserCancelled).then(()=>{}))}reset(){this.setState({rendezvous:void 0,confirmationDigits:void 0,failureReason:void 0})}render(){let t,a,n,i,r,c=!0,l=!1;switch(this.state.phase){case _.Error:switch(this.state.failureReason){case o.c.Expired:r=Object(u.a)("The linking wasn't completed in the required time.");break;case o.c.InvalidCode:r=Object(u.a)("The scanned code is invalid.");break;case o.c.UnsupportedAlgorithm:r=Object(u.a)("Linking with this device is not supported.");break;case o.c.UserDeclined:r=Object(u.a)("The request was declined on the other device.");break;case o.c.OtherDeviceAlreadySignedIn:r=Object(u.a)("The other device is already signed in.");break;case o.c.OtherDeviceNotSignedIn:r=Object(u.a)("The other device isn't signed in.");break;case o.c.UserCancelled:r=Object(u.a)("The request was cancelled.");break;case o.c.Unknown:r=Object(u.a)("An unexpected error occurred.");break;case o.c.HomeserverLacksSupport:r=Object(u.a)("The homeserver doesn't support signing in another device.");break;default:r=Object(u.a)("The request was cancelled.")}t=Object(u.a)("Connection failed"),l=!0,a=s.a.createElement(f.Icon,{className:"error"}),c=!1,n=s.a.createElement("p",{"data-testid":"cancellation-message"},r),i=s.a.createElement(s.a.Fragment,null,s.a.createElement(m.a,{kind:"primary",onClick:this.tryAgainClicked},Object(u.a)("Try again")),this.cancelButton());break;case _.Connected:t=Object(u.a)("Devices connected"),a=s.a.createElement(v.a,{className:"normal"}),c=!1,n=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(u.a)("Check that the code below matches with your other device:")),s.a.createElement("div",{className:"mx_LoginWithQR_confirmationDigits"},this.state.confirmationDigits),s.a.createElement("div",{className:"mx_LoginWithQR_confirmationAlert"},s.a.createElement("div",null,s.a.createElement(b.a,null)),s.a.createElement("div",null,Object(u.a)("By approving access for this device, it will have full access to your account.")))),i=s.a.createElement(s.a.Fragment,null,s.a.createElement(m.a,{"data-testid":"decline-login-button",kind:"primary_outline",onClick:this.declineClicked},Object(u.a)("Cancel")),s.a.createElement(m.a,{"data-testid":"approve-login-button",kind:"primary",onClick:this.approveLogin},Object(u.a)("Approve")));break;case _.ShowingQR:if(t=Object(u.a)("Sign in with QR code"),this.state.rendezvous){const t=s.a.createElement("div",{className:"mx_LoginWithQR_qrWrapper"},s.a.createElement(h.a,{data:[{data:e.from(this.state.rendezvous.code),mode:"byte"}],className:"mx_QRCode"}));n=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,Object(u.a)("Scan the QR code below with your device that's signed out.")),s.a.createElement("ol",null,s.a.createElement("li",null,Object(u.a)("Start at the sign in screen")),s.a.createElement("li",null,Object(u.a)("Select 'Scan QR code'")),s.a.createElement("li",null,Object(u.a)("Review and approve the sign in"))),t)}else n=this.simpleSpinner(),i=this.cancelButton();break;case _.Loading:n=this.simpleSpinner();break;case _.Connecting:n=this.simpleSpinner(Object(u.a)("Connecting...")),i=this.cancelButton();break;case _.WaitingForDevice:n=this.simpleSpinner(Object(u.a)("Waiting for device to sign in")),i=this.cancelButton();break;case _.Verifying:t=Object(u.a)("Success"),l=!0,n=this.simpleSpinner(Object(u.a)("Completing set up of your new device"))}return s.a.createElement("div",{"data-testid":"login-with-qr",className:"mx_LoginWithQR"},s.a.createElement("div",{className:l?"mx_LoginWithQR_centreTitle":""},c?s.a.createElement(m.a,{"data-testid":"back-button",className:"mx_LoginWithQR_BackButton",onClick:this.onBackClick,title:"Back"},s.a.createElement(g.a,null)):null,s.a.createElement("h1",null,a,t)),s.a.createElement("div",{className:"mx_LoginWithQR_main"},n),s.a.createElement("div",{className:"mx_LoginWithQR_buttons"},i))}}}).call(this,a(31).Buffer)},871:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return u}));var n=a(6),i=a.n(n),r=a(144),s=a(1),o=a(7),c=a(597),l=a(178);const d=new r.UnstableValue("http.v1","org.matrix.msc3886.http.v1");class u{constructor(e){let{onFailure:t,client:a,fallbackRzServer:n,fetchFn:r}=e;i()(this,"uri",void 0),i()(this,"etag",void 0),i()(this,"expiresAt",void 0),i()(this,"client",void 0),i()(this,"fallbackRzServer",void 0),i()(this,"fetchFn",void 0),i()(this,"cancelled",!1),i()(this,"_ready",!1),i()(this,"onFailure",void 0),this.fetchFn=r,this.onFailure=t,this.client=a,this.fallbackRzServer=n}get ready(){return this._ready}async details(){if(!this.uri)throw new Error("Rendezvous not set up");return{type:d.name,uri:this.uri}}fetch(t,a){return this.fetchFn?this.fetchFn(t,a):e.fetch(t,a)}async getPostEndpoint(){try{if(await this.client.doesServerSupportUnstableFeature("org.matrix.msc3886"))return`${this.client.baseUrl}${l.a.Unstable}/org.matrix.msc3886/rendezvous`}catch(e){s.a.warn("Failed to get unstable features",e)}return this.fallbackRzServer}async send(e){var t,a;if(this.cancelled)return;const n=this.uri?"PUT":"POST",i=null!==(t=this.uri)&&void 0!==t?t:await this.getPostEndpoint();if(!i)throw new Error("Invalid rendezvous URI");const r={"content-type":"application/json"};this.etag&&(r["if-match"]=this.etag);const s=await this.fetch(i,{method:n,headers:r,body:JSON.stringify(e)});if(404===s.status)return this.cancel(c.c.Unknown);if(this.etag=null!==(a=s.headers.get("etag"))&&void 0!==a?a:void 0,"POST"===n){var o;const e=s.headers.get("location");if(!e)throw new Error("No rendezvous URI given");const t=s.headers.get("expires");t&&(this.expiresAt=new Date(t));const a=null!==(o=s.url)&&void 0!==o?o:i;this.uri=new URL(e,`${a}${a.endsWith("/")?"":"/"}`).href,this._ready=!0}}async receive(){if(!this.uri)throw new Error("Rendezvous not set up");for(;;){if(this.cancelled)return;const a={};this.etag&&(a["if-none-match"]=this.etag);const n=await this.fetch(this.uri,{method:"GET",headers:a});if(404===n.status)return void this.cancel(c.c.Unknown);var e;if("application/json"!==n.headers.get("content-type"))this.etag=null!==(e=n.headers.get("etag"))&&void 0!==e?e:void 0;else if(200===n.status){var t;return this.etag=null!==(t=n.headers.get("etag"))&&void 0!==t?t:void 0,n.json()}await Object(o.H)(1e3)}}async cancel(e){var t;if(e===c.c.Unknown&&this.expiresAt&&this.expiresAt.getTime()<Date.now()&&(e=c.c.Expired),this.cancelled=!0,this._ready=!1,null===(t=this.onFailure)||void 0===t||t.call(this,e),this.uri&&e===c.c.UserDeclined)try{await this.fetch(this.uri,{method:"DELETE"})}catch(e){s.a.warn(e)}}}}).call(this,a(30))},872:function(e,t,a){"use strict";(function(e){a.d(t,"a",(function(){return d}));var n=a(6),i=a.n(n),r=a(597),s=a(162),o=a(380),c=a(625);const l=new(a(4).c)("m.rendezvous.v1.curve25519-aes-sha256","org.matrix.msc3903.rendezvous.v1.curve25519-aes-sha256");class d{constructor(t,a,n){this.transport=t,this.theirPublicKey=a,this.onFailure=n,i()(this,"olmSAS",void 0),i()(this,"ourPublicKey",void 0),i()(this,"aesKey",void 0),i()(this,"connected",!1),this.olmSAS=new e.Olm.SAS,this.ourPublicKey=Object(s.decodeBase64)(this.olmSAS.get_pubkey())}async generateCode(e){if(this.transport.ready)throw new Error("Code already generated");await this.transport.send({algorithm:l.name});return{rendezvous:{algorithm:l.name,key:Object(s.encodeBase64)(this.ourPublicKey),transport:await this.transport.details()},intent:e}}async connect(){if(this.connected)throw new Error("Channel already connected");if(!this.olmSAS)throw new Error("Channel closed");const e=!this.theirPublicKey;if(e){const e=await this.transport.receive();if(!e)throw new Error("No response from other device");const t=e,{key:a,algorithm:n}=t;if(!n||!l.matches(n)||!a)throw new r.b("Unsupported algorithm: "+n,r.c.UnsupportedAlgorithm);this.theirPublicKey=Object(s.decodeBase64)(a)}else await this.transport.send({algorithm:l.name,key:Object(s.encodeBase64)(this.ourPublicKey)});this.connected=!0,this.olmSAS.set_their_key(Object(s.encodeBase64)(this.theirPublicKey));const t=e?this.ourPublicKey:this.theirPublicKey,a=e?this.theirPublicKey:this.ourPublicKey;let n=l.name;n+="|"+Object(s.encodeBase64)(t),n+="|"+Object(s.encodeBase64)(a);const i=this.olmSAS.generate_bytes(n,32);this.aesKey=await async function(e){if(!o.c)throw new Error("Web Crypto is not available");return o.c.importKey("raw",e,{name:"AES-GCM"},!1,["encrypt","decrypt"])}(i),i.fill(0);const d=this.olmSAS.generate_bytes(n,5);return Object(c.a)(Array.from(d)).join("-")}async encrypt(e){if(!o.c)throw new Error("Web Crypto is not available");const t=new Uint8Array(32);o.b.getRandomValues(t);const a=(new o.a).encode(JSON.stringify(e)),n=await o.c.encrypt({name:"AES-GCM",iv:t,tagLength:128},this.aesKey,a);return{iv:Object(s.encodeBase64)(t),ciphertext:Object(s.encodeBase64)(n)}}async send(e){if(!this.olmSAS)throw new Error("Channel closed");if(!this.aesKey)throw new Error("Shared secret not set up");return this.transport.send(await this.encrypt(e))}async decrypt(e){let{iv:t,ciphertext:a}=e;if(!a||!t)throw new Error("Missing ciphertext and/or iv");const n=Object(s.decodeBase64)(a);if(!o.c)throw new Error("Web Crypto is not available");const i=await o.c.decrypt({name:"AES-GCM",iv:Object(s.decodeBase64)(t),tagLength:128},this.aesKey,n);return JSON.parse((new TextDecoder).decode(new Uint8Array(i)))}async receive(){if(!this.olmSAS)throw new Error("Channel closed");if(!this.aesKey)throw new Error("Shared secret not set up");const e=await this.transport.receive();if(!e)return;const t=e;if(t.ciphertext&&t.iv)return this.decrypt(t);throw new Error("Data received but no ciphertext")}async close(){this.olmSAS&&(this.olmSAS.free(),this.olmSAS=void 0)}async cancel(e){try{await this.transport.cancel(e)}finally{await this.close()}}}}).call(this,a(30))},873:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(90),i=a.n(n);class r extends i.a.PureComponent{render(){return i.a.createElement("div",{className:"mx_CompleteSecurityBody"},this.props.children)}}},874:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(90),i=a.n(n),r=a(100),s=a(91),o=a(95),c=a(124),l=a(106),d=a(867);function u(e){Object(s.e)()!==e&&(o.b.setValue("language",null,l.a.DEVICE,e),c.a.get().reload())}function m(e){let{disabled:t}=e;return r.b.get("disable_login_language_selector")?i.a.createElement("div",null):i.a.createElement(d.a,{className:"mx_AuthBody_language",onOptionChange:u,value:Object(s.e)(),disabled:t})}},891:function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var n=a(6),i=a.n(n),r=a(116),s=a(90),o=a.n(s),c=a(407),l=a(91),d=a(92),u=a(97),m=a(100),h=a(106),p=a(95),g=a(101),v=a.n(g),f=a(96),b=a.n(f),y=a(117);function E(e){let{label:t,description:a,onClick:n,isSelected:i,adornment:r}=e;return o.a.createElement(c.a,{active:i,className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--item",onClick:n},o.a.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},o.a.createElement("span",null,t),o.a.createElement("span",null,a)),r)}function _(e){let{label:t,description:a,adornment:n,children:i}=e;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--header"},o.a.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},o.a.createElement("span",null,t),o.a.createElement("span",null,a)),n),i)}function w(e){return"options"in e}function S(e){let{value:t,onChange:a,options:n,selectedLabel:i,onOpen:r,onClose:s,toKey:c,className:l,AdditionalOptions:d}=e;const[u,m,h,p]=Object(y.p)(),g=n.flatMap(e=>w(e)?[e,...e.options]:[e]).find(e=>c?c(e.key)===c(t):e.key===t);let f;f=n&&w(n[0])?o.a.createElement(o.a.Fragment,null,n.map(e=>{var t;return o.a.createElement(_,{key:null!==(t=null==c?void 0:c(e.key))&&void 0!==t?t:e.key,label:e.label,description:e.description,adornment:e.adornment},e.options.map(e=>{var t;return o.a.createElement(E,{key:null!==(t=null==c?void 0:c(e.key))&&void 0!==t?t:e.key,label:e.label,description:e.description,onClick:t=>{a(e.key),p(),null==s||s(t)},adornment:e.adornment,isSelected:e===g})}))})):o.a.createElement(o.a.Fragment,null,n.map(e=>{var t;return o.a.createElement(E,{key:null!==(t=null==c?void 0:c(e.key))&&void 0!==t?t:e.key,label:e.label,description:e.description,onClick:t=>{a(e.key),p(),null==s||s(t)},adornment:e.adornment,isSelected:e===g})}));const S=u?o.a.createElement(y.n,v()({onFinished:p,chevronFace:y.a.Top,wrapperClassName:b()("mx_GenericDropdownMenu_wrapper",l)},Object(y.i)(m.current.getBoundingClientRect())),f,d&&o.a.createElement(d,{menuDisplayed:u,openMenu:h,closeMenu:p})):null;return o.a.createElement(o.a.Fragment,null,o.a.createElement(y.b,{className:"mx_GenericDropdownMenu_button",inputRef:m,isExpanded:u,onClick:e=>{h(),null==r||r(e)}},i(g)),S)}var O=a(519),C=a(93),x=a(169);function k(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const j=Object(x.a)({deriveData:async e=>{let{value:t}=e;try{return await d.a.get().publicRooms({limit:1,server:t}),{}}catch(e){return{error:e}}},rules:[{key:"required",test:async e=>{let{value:t}=e;return!!t},invalid:()=>Object(l.a)("Enter a server name")},{key:"available",final:!0,test:async(e,t)=>{let{error:a}=t;return!a},valid:()=>Object(l.a)("Looks good"),invalid:e=>{let{error:t}=e;return"M_FORBIDDEN"===(null==t?void 0:t.errcode)?Object(l.a)("You are not allowed to view this server's rooms list"):Object(l.a)("Can't find this server or its room list")}}]});function R(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];for(const t of a)e.delete(t)}function I(){var e,t;const[a,n]=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const[i,r]=Object(s.useState)(p.b.getValue(e,null!=a?a:void 0,n)),o=Object(s.useCallback)(async n=>{r(n),p.b.setValue(e,a,t,n)},[t,a,e]);return Object(s.useEffect)(()=>{const t=p.b.watchSetting(e,a,()=>{r(p.b.getValue(e,a,n))});return()=>{p.b.unwatchSetting(t)}},[e,a,n]),[i,o]}("room_directory_servers",h.a.ACCOUNT),i=d.a.getHomeserverName(),r=new Set(null!==(e=null===(t=m.b.getObject("room_directory"))||void 0===t?void 0:t.get("servers"))&&void 0!==e?e:[]);R(r,i);const o=new Set(a);return R(o,i),R(o,...r),{allServers:[i,...Array.from(r).sort(),...Array.from(o).sort()],homeServer:i,userDefinedServers:Array.from(o).sort(),setUserDefinedServers:n}}const T=e=>{let{protocols:t,config:a,setConfig:n}=e;const{allServers:d,homeServer:m,userDefinedServers:h,setUserDefinedServers:p}=I(),g=d.map(e=>function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?k(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):k(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({key:{roomServer:e,instanceId:null},label:e,description:e===m?Object(l.a)("Your server"):null,options:[{key:{roomServer:e,instanceId:void 0},label:Object(l.a)("Matrix")},...e===m&&t?Object.values(t).flatMap(e=>e.instances).map(t=>({key:{roomServer:e,instanceId:t.instance_id},label:t.desc})):[]]},h.includes(e)?{adornment:o.a.createElement(C.a,{className:"mx_NetworkDropdown_removeServer",alt:Object(l.a)("Remove server “%(roomServer)s”",{roomServer:e}),onClick:()=>p(Object(r.without)(h,e))})}:{})),v=Object(s.useCallback)(e=>{let{closeMenu:t}=e;return o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"mx_GenericDropdownMenu_divider"}),o.a.createElement(c.a,{active:!1,className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--item",onClick:async()=>{t();const{finished:e}=u.a.createDialog(O.a,{title:Object(l.a)("Add a new server"),description:Object(l.a)("Enter the name of a new server you want to explore."),button:Object(l.a)("Add"),hasCancel:!1,placeholder:Object(l.a)("Server name"),validator:j,fixedWidth:!1},"mx_NetworkDropdown_dialog"),[a,i]=await e;a&&(d.includes(i)||(p([...h,i]),n({roomServer:i})))}},o.a.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},o.a.createElement("span",{className:"mx_NetworkDropdown_addServer"},Object(l.a)("Add new server…")))))},[d,n,p,h]);return o.a.createElement(S,{className:"mx_NetworkDropdown_wrapper",value:a,toKey:e=>e?`${e.roomServer}-${e.instanceId}`:"null",options:g,onChange:e=>n(e),selectedLabel:e=>null!=e&&e.key?Object(l.a)("Show: %(instance)s rooms (%(server)s)",{server:e.key.roomServer,instance:e.key.instanceId?e.label:"Matrix"}):Object(l.a)("Show: Matrix rooms"),AdditionalOptions:v})}},898:function(e,t,a){"use strict";a.d(t,"a",(function(){return x}));var n=a(6),i=a.n(n),r=a(90),s=a.n(r),o=a(96),c=a.n(o),l=a(113),d=a(99),u=a(1),m=a(91),h=a(94),p=a(98),g=a(577),v=a(610),f=a(412);class b extends v.a{constructor(){super(...arguments),i()(this,"onClick",e=>{e.preventDefault()})}wrapImage(e,t){return t}getFileBody(){const e=this.props.mxEvent.getType()===d.b.Sticker;return Object(f.a)(this.props.mxEvent.getContent(),e?Object(m.a)("Sticker"):Object(m.a)("Image"),!e)}getBanner(e){return null}render(){if(this.state.error)return super.render();const e=this.props.mxEvent.getContent(),t=this.messageContent(this.state.contentUrl,this.state.thumbUrl,e,44),a=this.getFileBody(),n=s.a.createElement(g.a,{mxEvent:this.props.mxEvent});return s.a.createElement("div",{className:"mx_MImageReplyBody"},t,s.a.createElement("div",{className:"mx_MImageReplyBody_info"},s.a.createElement("div",{className:"mx_MImageReplyBody_sender"},n),s.a.createElement("div",{className:"mx_MImageReplyBody_filename"},a)))}}var y=a(158),E=a(578),_=a(313),w=a(802),S=a(206);function O(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?O(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):O(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}class x extends s.a.PureComponent{constructor(){super(...arguments),i()(this,"anchorElement",Object(r.createRef)()),i()(this,"onDecrypted",()=>{this.forceUpdate(),this.props.onHeightChanged&&this.props.onHeightChanged()}),i()(this,"onEventRequiresUpdate",()=>{this.forceUpdate()}),i()(this,"onClick",e=>{const t=e.target;"a"===t.tagName.toLowerCase()&&null!==t.closest("a")&&t!==this.anchorElement.current||(e.preventDefault(),this.props.toggleExpandedQuote&&e.shiftKey?this.props.toggleExpandedQuote():h.a.dispatch({action:p.a.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:void 0}))})}componentDidMount(){this.props.mxEvent.on(l.c.Decrypted,this.onDecrypted),this.props.mxEvent.on(l.c.BeforeRedaction,this.onEventRequiresUpdate),this.props.mxEvent.on(l.c.Replaced,this.onEventRequiresUpdate)}componentWillUnmount(){this.props.mxEvent.removeListener(l.c.Decrypted,this.onDecrypted),this.props.mxEvent.removeListener(l.c.BeforeRedaction,this.onEventRequiresUpdate),this.props.mxEvent.removeListener(l.c.Replaced,this.onEventRequiresUpdate)}render(){const e=this.props.mxEvent,t=e.getContent().msgtype,a=e.getType(),{hasRenderer:n,isInfoMessage:i,isSeeingThroughMessageHiddenForModeration:r}=Object(E.a)(e,!1);if(!n){const{mxEvent:e}=this.props;return u.a.warn(`Event type not supported: type:${e.getType()} isState:${e.isState()}`),s.a.createElement("div",{className:"mx_ReplyTile mx_ReplyTile_info mx_MNoticeBody"},Object(m.a)("This event could not be displayed"))}const o=c()("mx_ReplyTile",{mx_ReplyTile_info:i&&!e.isRedacted(),mx_ReplyTile_audio:t===d.d.Audio,mx_ReplyTile_video:t===d.d.Video});let l,h="#";this.props.permalinkCreator&&(h=this.props.permalinkCreator.forEvent(e.getId()));!i&&t!==d.d.Image&&a!==d.b.Sticker&&a!==d.b.RoomCreate&&(l=s.a.createElement(g.a,{mxEvent:e}));const p={[d.d.Image]:b,[d.d.Audio]:Object(y.l)(e)?w.a:_.a,[d.d.Video]:_.a},v={[d.b.Sticker]:b};return s.a.createElement("div",{className:o},s.a.createElement("a",{href:h,onClick:this.onClick,ref:this.anchorElement},l,Object(S.f)(C(C({},this.props),{},{ref:null,showUrlPreview:!1,overrideBodyTypes:p,overrideEventTypes:v,maxImageHeight:96,isSeeingThroughMessageHiddenForModeration:r,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),!1)))}}i()(x,"defaultProps",{onHeightChanged:()=>{}})}}]);
//# sourceMappingURL=vendors~element-web-app.js.map